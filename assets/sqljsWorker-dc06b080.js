var vl=Object.defineProperty;var bl=(z,Q,ae)=>Q in z?vl(z,Q,{enumerable:!0,configurable:!0,writable:!0,value:ae}):z[Q]=ae;var U=(z,Q,ae)=>(bl(z,typeof Q!="symbol"?Q+"":Q,ae),ae),Uo=(z,Q,ae)=>{if(!Q.has(z))throw TypeError("Cannot "+ae)};var i=(z,Q,ae)=>(Uo(z,Q,"read from private field"),ae?ae.call(z):Q.get(z)),w=(z,Q,ae)=>{if(Q.has(z))throw TypeError("Cannot add the same private member more than once");Q instanceof WeakSet?Q.add(z):Q.set(z,ae)},g=(z,Q,ae,sr)=>(Uo(z,Q,"write to private field"),sr?sr.call(z,ae):Q.set(z,ae),ae);var j=(z,Q,ae)=>(Uo(z,Q,"access private method"),ae);(function(){var Jr,it,cr,ee,_i,nt,_,W,I,Wt,Vr,is,$r,hr,dr,ns,ic,ss,nc,os,sc,lr,ln,Li,Jo,as,oc,Pi,K,Bi,jr,zr,pr,Mi,Vo,Vt,Gr,$t,mr,yr,b,Kr,Hr,Ve,Xr,Zr,ei,ti,pt,ri,jt,Fi,$o,ii,ni,zt,H,Nr,kt,Qi,st,Se,Ne,Y,de,X,$e,J,Ce,_e,Re,ps,se,We,je,ze,ge,si,yt,Nt,Tt,ot,Kt,It,oi,St,ji,ms,ac,ys,uc,Ns,cc,ws,hc,zi,jo,Gi,Ht,vs,dc,Yt,br,ke,at,gr,ut,Fe,ci,Ps,Ki,zo,Hi,Go,xr,Xt,gs,hi,Or,di,xs,lc,Yi,uu,Xi,cu;"use strict";function z(t){return typeof t>"u"||t===void 0}function Q(t){return typeof t=="string"}function ae(t){return typeof t=="number"}function sr(t){return typeof t=="boolean"}function Bs(t){return t===null}function fc(t){return t instanceof Date}function pc(t){return typeof t=="bigint"}function Ue(t){return typeof t=="function"}function ht(t){return typeof t=="object"&&t!==null}function a(t){return Object.freeze(t)}function _t(t){return Array.isArray(t)}function Ar(t){return t}const ue=a({is(t){return t.kind==="AlterTableNode"},create(t){return a({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return a({...t,...e})},cloneWithColumnAlteration(t,e){return a({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),ie=a({is(t){return t.kind==="IdentifierNode"},create(t){return a({kind:"IdentifierNode",name:t})}}),Rt=a({is(t){return t.kind==="CreateIndexNode"},create(t){return a({kind:"CreateIndexNode",name:ie.create(t)})},cloneWith(t,e){return a({...t,...e})},cloneWithColumns(t,e){return a({...t,columns:[...t.columns||[],...e]})}}),Ko=a({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return a({kind:"CreateSchemaNode",schema:ie.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),mc=["preserve rows","delete rows","drop"],tt=a({is(t){return t.kind==="CreateTableNode"},create(t){return a({kind:"CreateTableNode",table:t,columns:a([])})},cloneWithColumn(t,e){return a({...t,columns:a([...t.columns,e])})},cloneWithConstraint(t,e){return a({...t,constraints:t.constraints?a([...t.constraints,e]):a([e])})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWith(t,e){return a({...t,...e})}}),Lt=a({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return a({kind:"SchemableIdentifierNode",identifier:ie.create(t)})},createWithSchema(t,e){return a({kind:"SchemableIdentifierNode",schema:ie.create(t),identifier:ie.create(e)})}}),fn=a({is(t){return t.kind==="DropIndexNode"},create(t,e){return a({kind:"DropIndexNode",name:Lt.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Ms=a({is(t){return t.kind==="DropSchemaNode"},create(t,e){return a({kind:"DropSchemaNode",schema:ie.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Fs=a({is(t){return t.kind==="DropTableNode"},create(t,e){return a({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return a({...t,...e})}}),Pt=a({is(t){return t.kind==="AliasNode"},create(t,e){return a({kind:"AliasNode",node:t,alias:e})}}),Bt=a({is(t){return t.kind==="TableNode"},create(t){return a({kind:"TableNode",table:Lt.create(t)})},createWithSchema(t,e){return a({kind:"TableNode",table:Lt.createWithSchema(t,e)})}});function He(t){return ht(t)&&Ue(t.toOperationNode)}function yc(t){return ht(t)&&"expressionType"in t&&He(t)}function Nc(t){return ht(t)&&"expression"in t&&Q(t.alias)&&He(t)}const xt=a({is(t){return t.kind==="SelectModifierNode"},create(t){return a({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return a({kind:"SelectModifierNode",rawModifier:t})}}),Mt=a({is(t){return t.kind==="AndNode"},create(t,e){return a({kind:"AndNode",left:t,right:e})}}),Er=a({is(t){return t.kind==="OrNode"},create(t,e){return a({kind:"OrNode",left:t,right:e})}}),Qs=a({is(t){return t.kind==="OnNode"},create(t){return a({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return a({...t,on:e==="And"?Mt.create(t.on,r):Er.create(t.on,r)})}}),yi=a({is(t){return t.kind==="JoinNode"},create(t,e){return a({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return a({kind:"JoinNode",joinType:t,table:e,on:Qs.create(r)})},cloneWithOn(t,e){return a({...t,on:t.on?Qs.cloneWithOperation(t.on,"And",e):Qs.create(e)})}}),Ni=a({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return a({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),wc=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp"],vc=["+","-","*","/","%","^","&","|","#","<<",">>"],Ho=["->","->>"],bc=[...wc,...vc,"&&","||"],gc=["not","-",...["exists","not exists"]],xc=[...bc,...Ho,...gc,"between","between symmetric"],or=a({is(t){return t.kind==="OperatorNode"},create(t){return a({kind:"OperatorNode",operator:t})}});function Yo(t){return Q(t)&&Ho.includes(t)}const ce=a({is(t){return t.kind==="ColumnNode"},create(t){return a({kind:"ColumnNode",column:ie.create(t)})}}),Us=a({is(t){return t.kind==="SelectAllNode"},create(){return a({kind:"SelectAllNode"})}}),pn=a({is(t){return t.kind==="ReferenceNode"},create(t,e){return a({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return a({kind:"ReferenceNode",table:t,column:Us.create()})}});class Oc{constructor(e){w(this,Jr,void 0);g(this,Jr,e)}get dynamicReference(){return i(this,Jr)}get refType(){}toOperationNode(){return ra(i(this,Jr))}}Jr=new WeakMap;function Xo(t){return ht(t)&&He(t)&&Q(t.dynamicReference)}const Js=a({is(t){return t.kind==="OrderByItemNode"},create(t,e){return a({kind:"OrderByItemNode",orderBy:t,direction:e})}}),Ee=a({is(t){return t.kind==="RawNode"},create(t,e){return a({kind:"RawNode",sqlFragments:a(t),parameters:a(e)})},createWithSql(t){return Ee.create([t],[])},createWithChild(t){return Ee.create(["",""],[t])},createWithChildren(t){return Ee.create(new Array(t.length+1).fill(""),t)}});function Zo(t){return t==="asc"||t==="desc"}function mn(t){if(t.length===2)return[Vs(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>Vs(r)):[Vs(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function Vs(t,e){const r=qc(t);if(Js.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return Js.create(r,ea(e))}function qc(t){if(Wi(t))return Mr(t);if(Xo(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!Zo(r))throw new Error(`Invalid order by direction: ${r}`);return Js.create(Ot(e),ea(r))}return Ot(t)}function ea(t){if(t)return t==="asc"||t==="desc"?Ee.createWithSql(t):t.toOperationNode()}const $s=a({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return a({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return a({...t,traversal:e})}}),ta=a({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return a({kind:"JSONOperatorChainNode",operator:t,values:a([])})},cloneWithValue(t,e){return a({...t,values:a([...t.values,e])})}}),js=a({is(t){return t.kind==="JSONPathNode"},create(t){return a({kind:"JSONPathNode",inOperator:t,pathLegs:a([])})},cloneWithLeg(t,e){return a({...t,pathLegs:a([...t.pathLegs,e])})}});function ra(t){return Q(t)?Ot(t):t.toOperationNode()}function wi(t){return _t(t)?t.map(e=>rt(e)):[rt(t)]}function rt(t){return Wi(t)?Mr(t):ra(t)}function Cc(t,e){const r=Ot(t);if(Yo(e))return $s.create(r,ta.create(or.create(e)));const u=e.slice(0,-1);if(Yo(u))return $s.create(r,js.create(or.create(u)));throw new Error(`Invalid JSON operator: ${e}`)}function Ot(t){const e=".";if(!t.includes(e))return pn.create(ce.create(t));const r=t.split(e).map(zs);if(r.length===3)return kc(r);if(r.length===2)return Tc(r);throw new Error(`invalid column reference ${t}`)}function Wc(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(zs);return Pt.create(Ot(r),ie.create(u))}else return Ot(t)}function ia(t){return ce.create(t)}function na(t){const e=" ";if(t.includes(e)){const[r,u]=t.split(e).map(zs);if(!Zo(u))throw new Error(`invalid order direction "${u}" next to "${r}"`);return mn([r,u])[0]}else return ia(t)}function kc(t){const[e,r,u]=t;return pn.create(ce.create(u),Bt.createWithSchema(e,r))}function Tc(t){const[e,r]=t;return pn.create(ce.create(r),Bt.create(e))}function zs(t){return t.trim()}const sa=a({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return a({kind:"PrimitiveValueListNode",values:a([...t])})}}),Gs=a({is(t){return t.kind==="ValueListNode"},create(t){return a({kind:"ValueListNode",values:a(t)})}}),dt=a({is(t){return t.kind==="ValueNode"},create(t){return a({kind:"ValueNode",value:t})},createImmediate(t){return a({kind:"ValueNode",value:t,immediate:!0})}});function oa(t){return _t(t)?Ic(t):De(t)}function De(t){return Wi(t)?Mr(t):dt.create(t)}function Ks(t){return ae(t)||sr(t)||Bs(t)}function Hs(t){if(!Ks(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return dt.createImmediate(t)}function Ic(t){return t.some(Wi)?Gs.create(t.map(e=>De(e))):sa.create(t)}const Dr=a({is(t){return t.kind==="ParensNode"},create(t){return a({kind:"ParensNode",node:t})}});function Te(t){if(t.length===3)return vi(t[0],t[1],t[2]);if(t.length===1)return De(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function vi(t,e,r){return Sc(e)&&ua(r)?Ni.create(rt(t),Xs(e),dt.createImmediate(r)):Ni.create(rt(t),Xs(e),oa(r))}function qt(t,e,r){return Ni.create(rt(t),Xs(e),rt(r))}function aa(t,e){return Ys(Object.entries(t).filter(([,r])=>!z(r)).map(([r,u])=>vi(r,ua(u)?"is":"=",u)),e)}function Ys(t,e){const r=e==="and"?Mt.create:Er.create;if(t.length===0)return dt.createImmediate(e==="and");let u=ca(t[0]);for(let d=1;d<t.length;++d)u=r(u,ca(t[d]));return t.length>1?Dr.create(u):u}function Sc(t){return t==="is"||t==="is not"}function ua(t){return Bs(t)||sr(t)}function Xs(t){if(Q(t)&&xc.includes(t))return or.create(t);if(He(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function ca(t){return He(t)?t.toOperationNode():t}const _r=a({is(t){return t.kind==="OrderByNode"},create(t){return a({kind:"OrderByNode",items:a([...t])})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),ha=a({is(t){return t.kind==="PartitionByNode"},create(t){return a({kind:"PartitionByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),Zs=a({is(t){return t.kind==="OverNode"},create(){return a({kind:"OverNode"})},cloneWithOrderByItems(t,e){return a({...t,orderBy:t.orderBy?_r.cloneWithItems(t.orderBy,e):_r.create(e)})},cloneWithPartitionByItems(t,e){return a({...t,partitionBy:t.partitionBy?ha.cloneWithItems(t.partitionBy,e):ha.create(e)})}}),yn=a({is(t){return t.kind==="FromNode"},create(t){return a({kind:"FromNode",froms:a(t)})},cloneWithFroms(t,e){return a({...t,froms:a([...t.froms,...e])})}}),da=a({is(t){return t.kind==="GroupByNode"},create(t){return a({kind:"GroupByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),la=a({is(t){return t.kind==="HavingNode"},create(t){return a({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return a({...t,having:e==="And"?Mt.create(t.having,r):Er.create(t.having,r)})}}),B=a({is(t){return t.kind==="SelectQueryNode"},create(t){return a({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return a({kind:"SelectQueryNode",from:yn.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})},cloneWithDistinctOn(t,e){return a({...t,distinctOn:t.distinctOn?a([...t.distinctOn,...e]):a(e)})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWithOrderByItems(t,e){return a({...t,orderBy:t.orderBy?_r.cloneWithItems(t.orderBy,e):_r.create(e)})},cloneWithGroupByItems(t,e){return a({...t,groupBy:t.groupBy?da.cloneWithItems(t.groupBy,e):da.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithOffset(t,e){return a({...t,offset:e})},cloneWithHaving(t,e){return a({...t,having:t.having?la.cloneWithOperation(t.having,"And",e):la.create(e)})},cloneWithSetOperations(t,e){return a({...t,setOperations:t.setOperations?a([...t.setOperations,...e]):a([...e])})},cloneWithoutSelections(t){return a({...t,selections:[]})},cloneWithoutLimit(t){return a({...t,limit:void 0})},cloneWithoutOffset(t){return a({...t,offset:void 0})},cloneWithoutOrderBy(t){return a({...t,orderBy:void 0})}});function M(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}const Di=class Di{constructor(e){w(this,it,void 0);g(this,it,a(e))}on(...e){return new Di({...i(this,it),joinNode:yi.cloneWithOn(i(this,it).joinNode,Te(e))})}onRef(e,r,u){return new Di({...i(this,it),joinNode:yi.cloneWithOn(i(this,it).joinNode,qt(e,r,u))})}onTrue(){return new Di({...i(this,it),joinNode:yi.cloneWithOn(i(this,it).joinNode,Ee.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return i(this,it).joinNode}};it=new WeakMap;let Nn=Di;M(Nn,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const Ac=a({is(t){return t.kind==="PartitionByItemNode"},create(t){return a({kind:"PartitionByItemNode",partitionBy:t})}});function Ec(t){return wi(t).map(Ac.create)}const ts=class ts{constructor(e){w(this,cr,void 0);g(this,cr,a(e))}orderBy(e,r){return new ts({overNode:Zs.cloneWithOrderByItems(i(this,cr).overNode,mn([e,r]))})}partitionBy(e){return new ts({overNode:Zs.cloneWithPartitionByItems(i(this,cr).overNode,Ec(e))})}$call(e){return e(this)}toOperationNode(){return i(this,cr).overNode}};cr=new WeakMap;let wn=ts;M(wn,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const bi=a({is(t){return t.kind==="SelectionNode"},create(t){return a({kind:"SelectionNode",selection:t})},createSelectAll(){return a({kind:"SelectionNode",selection:Us.create()})},createSelectAllFromTable(t){return a({kind:"SelectionNode",selection:pn.createSelectAll(t)})}});function ar(t){return Ue(t)?ar(t(Br())):_t(t)?t.map(e=>fa(e)):[fa(t)]}function fa(t){return Q(t)?bi.create(Wc(t)):Xo(t)?bi.create(t.toOperationNode()):bi.create(Ea(t))}function gi(t){return t?Array.isArray(t)?t.map(pa):[pa(t)]:[bi.createSelectAll()]}function pa(t){if(Q(t))return bi.createSelectAllFromTable(Me(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const Dc=a({is(t){return t.kind==="ValuesNode"},create(t){return a({kind:"ValuesNode",values:a(t)})}}),_c=a({is(t){return t.kind==="DefaultInsertValueNode"},create(){return a({kind:"DefaultInsertValueNode"})}});function Rc(t){const e=Ue(t)?t(Br()):t,r=_t(e)?e:a([e]);return Lc(r)}function Lc(t){const e=Pc(t);return[a([...e.keys()].map(ce.create)),Dc.create(t.map(r=>Bc(r,e)))]}function Pc(t){const e=new Map;for(const r of t){const u=Object.keys(r);for(const d of u)!e.has(d)&&r[d]!==void 0&&e.set(d,e.size)}return e}function Bc(t,e){const r=Object.keys(t),u=Array.from({length:e.size});let d=!1;for(const x of r){const C=e.get(x);if(z(C))continue;const P=t[x];(z(P)||Wi(P))&&(d=!0),u[C]=P}if(r.length<e.size||d){const x=_c.create();return Gs.create(u.map(C=>z(C)?x:De(C)))}return sa.create(u)}const lt=a({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return a({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return a({...t,...e})}}),vn=a({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return a({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return a({...t,from:t.from?yn.cloneWithFroms(t.from,e):yn.create(e)})},cloneWithUpdates(t,e){return a({...t,updates:t.updates?a([...t.updates,...e]):e})}}),ma=a({is(t){return t.kind==="UsingNode"},create(t){return a({kind:"UsingNode",tables:a(t)})},cloneWithTables(t,e){return a({...t,tables:a([...t.tables,...e])})}}),xi=a({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return a({kind:"DeleteQueryNode",from:yn.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return a({...t,orderBy:t.orderBy?_r.cloneWithItems(t.orderBy,e):_r.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithUsing(t,e){return a({...t,using:t.using!==void 0?ma.cloneWithTables(t.using,e):ma.create(e)})}}),Pe=a({is(t){return t.kind==="WhereNode"},create(t){return a({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return a({...t,where:e==="And"?Mt.create(t.where,r):Er.create(t.where,r)})}}),ya=a({is(t){return t.kind==="ReturningNode"},create(t){return a({kind:"ReturningNode",selections:a(t)})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})}}),Mc=a({is(t){return t.kind==="ExplainNode"},create(t,e){return a({kind:"ExplainNode",format:t,options:e})}}),L=a({is(t){return B.is(t)||lt.is(t)||vn.is(t)||xi.is(t)},cloneWithWhere(t,e){return a({...t,where:t.where?Pe.cloneWithOperation(t.where,"And",e):Pe.create(e)})},cloneWithJoin(t,e){return a({...t,joins:t.joins?a([...t.joins,e]):a([e])})},cloneWithReturning(t,e){return a({...t,returning:t.returning?ya.cloneWithSelections(t.returning,e):ya.create(e)})},cloneWithoutWhere(t){return a({...t,where:void 0})},cloneWithExplain(t,e,r){return a({...t,explain:Mc.create(e,r==null?void 0:r.toOperationNode())})}}),Fc=a({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return a({kind:"ColumnUpdateNode",column:t,value:e})}});function eo(t){const e=Ue(t)?t(Br()):t;return Object.entries(e).filter(([r,u])=>u!==void 0).map(([r,u])=>Fc.create(ce.create(r),De(u)))}const Qc=a({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return a({kind:"OnDuplicateKeyNode",updates:t})}});class Uc{constructor(e,r){U(this,"insertId");U(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class bn extends Error{constructor(r){super("no result");U(this,"node");this.node=r}}function gn(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Je=a({is(t){return t.kind==="OnConflictNode"},create(){return a({kind:"OnConflictNode"})},cloneWith(t,e){return a({...t,...e})},cloneWithIndexWhere(t,e){return a({...t,indexWhere:t.indexWhere?Pe.cloneWithOperation(t.indexWhere,"And",e):Pe.create(e)})},cloneWithIndexOrWhere(t,e){return a({...t,indexWhere:t.indexWhere?Pe.cloneWithOperation(t.indexWhere,"Or",e):Pe.create(e)})},cloneWithUpdateWhere(t,e){return a({...t,updateWhere:t.updateWhere?Pe.cloneWithOperation(t.updateWhere,"And",e):Pe.create(e)})},cloneWithUpdateOrWhere(t,e){return a({...t,updateWhere:t.updateWhere?Pe.cloneWithOperation(t.updateWhere,"Or",e):Pe.create(e)})},cloneWithoutIndexWhere(t){return a({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return a({...t,updateWhere:void 0})}}),Ct=class Ct{constructor(e){w(this,ee,void 0);g(this,ee,a(e))}column(e){const r=ce.create(e);return new Ct({...i(this,ee),onConflictNode:Je.cloneWith(i(this,ee).onConflictNode,{columns:i(this,ee).onConflictNode.columns?a([...i(this,ee).onConflictNode.columns,r]):a([r])})})}columns(e){const r=e.map(ce.create);return new Ct({...i(this,ee),onConflictNode:Je.cloneWith(i(this,ee).onConflictNode,{columns:i(this,ee).onConflictNode.columns?a([...i(this,ee).onConflictNode.columns,...r]):a(r)})})}constraint(e){return new Ct({...i(this,ee),onConflictNode:Je.cloneWith(i(this,ee).onConflictNode,{constraint:ie.create(e)})})}expression(e){return new Ct({...i(this,ee),onConflictNode:Je.cloneWith(i(this,ee).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Ct({...i(this,ee),onConflictNode:Je.cloneWithIndexWhere(i(this,ee).onConflictNode,Te(e))})}whereRef(e,r,u){return new Ct({...i(this,ee),onConflictNode:Je.cloneWithIndexWhere(i(this,ee).onConflictNode,qt(e,r,u))})}clearWhere(){return new Ct({...i(this,ee),onConflictNode:Je.cloneWithoutIndexWhere(i(this,ee).onConflictNode)})}doNothing(){return new Na({...i(this,ee),onConflictNode:Je.cloneWith(i(this,ee).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new On({...i(this,ee),onConflictNode:Je.cloneWith(i(this,ee).onConflictNode,{updates:eo(e)})})}$call(e){return e(this)}};ee=new WeakMap;let xn=Ct;M(xn,"don't await OnConflictBuilder instances.");class Na{constructor(e){w(this,_i,void 0);g(this,_i,a(e))}toOperationNode(){return i(this,_i).onConflictNode}}_i=new WeakMap,M(Na,"don't await OnConflictDoNothingBuilder instances.");const Ri=class Ri{constructor(e){w(this,nt,void 0);g(this,nt,a(e))}where(...e){return new Ri({...i(this,nt),onConflictNode:Je.cloneWithUpdateWhere(i(this,nt).onConflictNode,Te(e))})}whereRef(e,r,u){return new Ri({...i(this,nt),onConflictNode:Je.cloneWithUpdateWhere(i(this,nt).onConflictNode,qt(e,r,u))})}clearWhere(){return new Ri({...i(this,nt),onConflictNode:Je.cloneWithoutUpdateWhere(i(this,nt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return i(this,nt).onConflictNode}};nt=new WeakMap;let On=Ri;M(On,"don't await OnConflictUpdateBuilder instances.");const Ie=class Ie{constructor(e){w(this,_,void 0);g(this,_,a(e))}values(e){const[r,u]=Rc(e);return new Ie({...i(this,_),queryNode:lt.cloneWith(i(this,_).queryNode,{columns:r,values:u})})}columns(e){return new Ie({...i(this,_),queryNode:lt.cloneWith(i(this,_).queryNode,{columns:a(e.map(ce.create))})})}expression(e){return new Ie({...i(this,_),queryNode:lt.cloneWith(i(this,_).queryNode,{values:Mr(e)})})}ignore(){return new Ie({...i(this,_),queryNode:lt.cloneWith(i(this,_).queryNode,{ignore:!0})})}onConflict(e){return new Ie({...i(this,_),queryNode:lt.cloneWith(i(this,_).queryNode,{onConflict:e(new xn({onConflictNode:Je.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Ie({...i(this,_),queryNode:lt.cloneWith(i(this,_).queryNode,{onDuplicateKey:Qc.create(eo(e))})})}returning(e){return new Ie({...i(this,_),queryNode:L.cloneWithReturning(i(this,_).queryNode,ar(e))})}returningAll(){return new Ie({...i(this,_),queryNode:L.cloneWithReturning(i(this,_).queryNode,gi())})}$call(e){return e(this)}$if(e,r){return e?r(this):new Ie({...i(this,_)})}$castTo(){return new Ie(i(this,_))}$narrowType(){return new Ie(i(this,_))}$assertType(){return new Ie(i(this,_))}withPlugin(e){return new Ie({...i(this,_),executor:i(this,_).executor.withPlugin(e)})}toOperationNode(){return i(this,_).executor.transformQuery(i(this,_).queryNode,i(this,_).queryId)}compile(){return i(this,_).executor.compileQuery(this.toOperationNode(),i(this,_).queryId)}async execute(){const e=this.compile(),r=e.query,u=await i(this,_).executor.executeQuery(e,i(this,_).queryId);return i(this,_).executor.adapter.supportsReturning&&r.returning?u.rows:[new Uc(u.insertId,u.numAffectedRows??u.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bn){const r=await this.executeTakeFirst();if(r===void 0)throw gn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,_).executor.stream(r,e,i(this,_).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new Ie({...i(this,_),queryNode:L.cloneWithExplain(i(this,_).queryNode,e,r)}).execute()}};_=new WeakMap;let Oi=Ie;M(Oi,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Jc{constructor(e){U(this,"numDeletedRows");this.numDeletedRows=e}}const wa=a({is(t){return t.kind==="LimitNode"},create(t){return a({kind:"LimitNode",limit:dt.create(t)})}}),ye=class ye{constructor(e){w(this,W,void 0);g(this,W,a(e))}where(...e){return new ye({...i(this,W),queryNode:L.cloneWithWhere(i(this,W).queryNode,Te(e))})}whereRef(e,r,u){return new ye({...i(this,W),queryNode:L.cloneWithWhere(i(this,W).queryNode,qt(e,r,u))})}clearWhere(){return new ye({...i(this,W),queryNode:L.cloneWithoutWhere(i(this,W).queryNode)})}using(e){return new ye({...i(this,W),queryNode:xi.cloneWithUsing(i(this,W).queryNode,ki(e))})}innerJoin(...e){return new ye({...i(this,W),queryNode:L.cloneWithJoin(i(this,W).queryNode,Be("InnerJoin",e))})}leftJoin(...e){return new ye({...i(this,W),queryNode:L.cloneWithJoin(i(this,W).queryNode,Be("LeftJoin",e))})}rightJoin(...e){return new ye({...i(this,W),queryNode:L.cloneWithJoin(i(this,W).queryNode,Be("RightJoin",e))})}fullJoin(...e){return new ye({...i(this,W),queryNode:L.cloneWithJoin(i(this,W).queryNode,Be("FullJoin",e))})}returning(e){return new ye({...i(this,W),queryNode:L.cloneWithReturning(i(this,W).queryNode,ar(e))})}returningAll(e){return new ye({...i(this,W),queryNode:L.cloneWithReturning(i(this,W).queryNode,gi(e))})}orderBy(e,r){return new ye({...i(this,W),queryNode:xi.cloneWithOrderByItems(i(this,W).queryNode,mn([e,r]))})}limit(e){return new ye({...i(this,W),queryNode:xi.cloneWithLimit(i(this,W).queryNode,wa.create(e))})}$call(e){return e(this)}$if(e,r){return e?r(this):new ye({...i(this,W)})}$castTo(){return new ye(i(this,W))}$narrowType(){return new ye(i(this,W))}$assertType(){return new ye(i(this,W))}withPlugin(e){return new ye({...i(this,W),executor:i(this,W).executor.withPlugin(e)})}toOperationNode(){return i(this,W).executor.transformQuery(i(this,W).queryNode,i(this,W).queryId)}compile(){return i(this,W).executor.compileQuery(this.toOperationNode(),i(this,W).queryId)}async execute(){const e=this.compile(),r=e.query,u=await i(this,W).executor.executeQuery(e,i(this,W).queryId);return i(this,W).executor.adapter.supportsReturning&&r.returning?u.rows:[new Jc(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bn){const r=await this.executeTakeFirst();if(r===void 0)throw gn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,W).executor.stream(r,e,i(this,W).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new ye({...i(this,W),queryNode:L.cloneWithExplain(i(this,W).queryNode,e,r)}).execute()}};W=new WeakMap;let qn=ye;M(qn,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Vc{constructor(e,r){U(this,"numUpdatedRows");U(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}const we=class we{constructor(e){w(this,I,void 0);g(this,I,a(e))}where(...e){return new we({...i(this,I),queryNode:L.cloneWithWhere(i(this,I).queryNode,Te(e))})}whereRef(e,r,u){return new we({...i(this,I),queryNode:L.cloneWithWhere(i(this,I).queryNode,qt(e,r,u))})}clearWhere(){return new we({...i(this,I),queryNode:L.cloneWithoutWhere(i(this,I).queryNode)})}from(e){return new we({...i(this,I),queryNode:vn.cloneWithFromItems(i(this,I).queryNode,ki(e))})}innerJoin(...e){return new we({...i(this,I),queryNode:L.cloneWithJoin(i(this,I).queryNode,Be("InnerJoin",e))})}leftJoin(...e){return new we({...i(this,I),queryNode:L.cloneWithJoin(i(this,I).queryNode,Be("LeftJoin",e))})}rightJoin(...e){return new we({...i(this,I),queryNode:L.cloneWithJoin(i(this,I).queryNode,Be("RightJoin",e))})}fullJoin(...e){return new we({...i(this,I),queryNode:L.cloneWithJoin(i(this,I).queryNode,Be("FullJoin",e))})}set(e){return new we({...i(this,I),queryNode:vn.cloneWithUpdates(i(this,I).queryNode,eo(e))})}returning(e){return new we({...i(this,I),queryNode:L.cloneWithReturning(i(this,I).queryNode,ar(e))})}returningAll(){return new we({...i(this,I),queryNode:L.cloneWithReturning(i(this,I).queryNode,gi())})}$call(e){return e(this)}$if(e,r){return e?r(this):new we({...i(this,I)})}$castTo(){return new we(i(this,I))}$narrowType(){return new we(i(this,I))}$assertType(){return new we(i(this,I))}withPlugin(e){return new we({...i(this,I),executor:i(this,I).executor.withPlugin(e)})}toOperationNode(){return i(this,I).executor.transformQuery(i(this,I).queryNode,i(this,I).queryId)}compile(){return i(this,I).executor.compileQuery(this.toOperationNode(),i(this,I).queryId)}async execute(){const e=this.compile(),r=e.query,u=await i(this,I).executor.executeQuery(e,i(this,I).queryId);return i(this,I).executor.adapter.supportsReturning&&r.returning?u.rows:[new Vc(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0),u.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bn){const r=await this.executeTakeFirst();if(r===void 0)throw gn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,I).executor.stream(r,e,i(this,I).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new we({...i(this,I),queryNode:L.cloneWithExplain(i(this,I).queryNode,e,r)}).execute()}};I=new WeakMap;let Cn=we;M(Cn,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const va=a({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return a({kind:"CommonTableExpressionNameNode",table:Bt.create(t),columns:e?a(e.map(ce.create)):void 0})}}),Wn=a({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return a({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return a({...t,...e})}}),rs=class rs{constructor(e){w(this,Wt,void 0);g(this,Wt,a(e))}materialized(){return new rs({...i(this,Wt),node:Wn.cloneWith(i(this,Wt).node,{materialized:!0})})}notMaterialized(){return new rs({...i(this,Wt),node:Wn.cloneWith(i(this,Wt).node,{materialized:!1})})}toOperationNode(){return i(this,Wt).node}};Wt=new WeakMap;let kn=rs;M(kn,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function ba(t,e){const r=e(eh()).toOperationNode();return Ue(t)?t($c(r)).toOperationNode():Wn.create(ga(t),r)}function $c(t){return e=>new kn({node:Wn.create(ga(e),t)})}function ga(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],u=e[1].split(",").map(d=>d.trim());return va.create(r,u)}else return va.create(t)}const Tn=a({is(t){return t.kind==="WithNode"},create(t,e){return a({kind:"WithNode",expressions:a([t]),...e})},cloneWithExpression(t,e){return a({...t,expressions:a([...t.expressions,e])})}}),xa=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function jc(t){let e="";for(let r=0;r<t;++r)e+=zc();return e}function zc(){return xa[~~(Math.random()*xa.length)]}function G(){return new Gc}class Gc{constructor(){w(this,Vr,void 0)}get queryId(){return i(this,Vr)===void 0&&g(this,Vr,jc(8)),i(this,Vr)}}Vr=new WeakMap;function xl(t){return t}class to{constructor(){U(this,"nodeStack",[]);w(this,is,a({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),a(r)}transformNodeImpl(e){return i(this,is)[e.kind](e)}transformNodeList(e){return e&&a(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:a([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}is=new WeakMap;const Kc=a({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});class Hc extends to{constructor(r){super();w(this,ns);w(this,ss);w(this,os);w(this,lr);w(this,Li);w(this,as);w(this,$r,void 0);w(this,hr,new Set);w(this,dr,new Set);g(this,$r,r)}transformNodeImpl(r){if(!j(this,ns,ic).call(this,r))return super.transformNodeImpl(r);const u=j(this,os,sc).call(this,r);for(const x of u)i(this,dr).add(x);const d=j(this,ss,nc).call(this,r);for(const x of d)i(this,hr).add(x);const m=super.transformNodeImpl(r);for(const x of d)i(this,hr).delete(x);for(const x of u)i(this,dr).delete(x);return m}transformSchemableIdentifier(r){const u=super.transformSchemableIdentifier(r);return u.schema||!i(this,hr).has(r.identifier.name)?u:{...u,schema:ie.create(i(this,$r))}}transformReferences(r){const u=super.transformReferences(r);return u.table.table.schema?u:{...u,table:Bt.createWithSchema(i(this,$r),u.table.table.identifier.name)}}}$r=new WeakMap,hr=new WeakMap,dr=new WeakMap,ns=new WeakSet,ic=function(r){return r.kind in Kc},ss=new WeakSet,nc=function(r){const u=new Set;if("name"in r&&r.name&&Lt.is(r.name)&&j(this,Li,Jo).call(this,r.name,u),"from"in r&&r.from)for(const d of r.from.froms)j(this,lr,ln).call(this,d,u);if("into"in r&&r.into&&j(this,lr,ln).call(this,r.into,u),"table"in r&&r.table&&j(this,lr,ln).call(this,r.table,u),"joins"in r&&r.joins)for(const d of r.joins)j(this,lr,ln).call(this,d.table,u);return u},os=new WeakSet,sc=function(r){const u=new Set;return"with"in r&&r.with&&j(this,as,oc).call(this,r.with,u),u},lr=new WeakSet,ln=function(r,u){const d=Bt.is(r)?r:Pt.is(r)&&Bt.is(r.node)?r.node:null;d&&j(this,Li,Jo).call(this,d.table,u)},Li=new WeakSet,Jo=function(r,u){const d=r.identifier.name;!i(this,hr).has(d)&&!i(this,dr).has(d)&&u.add(d)},as=new WeakSet,oc=function(r,u){for(const d of r.expressions){const m=d.name.table.table.identifier.name;i(this,dr).has(m)||u.add(m)}};class qi{constructor(e){w(this,Pi,void 0);g(this,Pi,new Hc(e))}transformQuery(e){return i(this,Pi).transformNode(e.node)}async transformResult(e){return e.result}}Pi=new WeakMap;const fr=class fr{constructor(e){w(this,K,void 0);g(this,K,a(e))}selectFrom(e){return An({queryId:G(),executor:i(this,K).executor,queryNode:B.createFrom(ki(e),i(this,K).withNode)})}selectNoFrom(e){return An({queryId:G(),executor:i(this,K).executor,queryNode:B.cloneWithSelections(B.create(i(this,K).withNode),ar(e))})}insertInto(e){return new Oi({queryId:G(),executor:i(this,K).executor,queryNode:lt.create(Me(e),i(this,K).withNode)})}replaceInto(e){return new Oi({queryId:G(),executor:i(this,K).executor,queryNode:lt.create(Me(e),i(this,K).withNode,!0)})}deleteFrom(e){return new qn({queryId:G(),executor:i(this,K).executor,queryNode:xi.create(ki(e),i(this,K).withNode)})}updateTable(e){return new Cn({queryId:G(),executor:i(this,K).executor,queryNode:vn.create(Ti(e),i(this,K).withNode)})}with(e,r){const u=ba(e,r);return new fr({...i(this,K),withNode:i(this,K).withNode?Tn.cloneWithExpression(i(this,K).withNode,u):Tn.create(u)})}withRecursive(e,r){const u=ba(e,r);return new fr({...i(this,K),withNode:i(this,K).withNode?Tn.cloneWithExpression(i(this,K).withNode,u):Tn.create(u,{recursive:!0})})}withPlugin(e){return new fr({...i(this,K),executor:i(this,K).executor.withPlugin(e)})}withoutPlugins(){return new fr({...i(this,K),executor:i(this,K).executor.withoutPlugins()})}withSchema(e){return new fr({...i(this,K),executor:i(this,K).executor.withPluginAtFront(new qi(e))})}};K=new WeakMap;let In=fr;class Oa{constructor(){w(this,Bi,void 0);w(this,jr,void 0);w(this,zr,void 0);U(this,"resolve",e=>{i(this,jr)&&i(this,jr).call(this,e)});U(this,"reject",e=>{i(this,zr)&&i(this,zr).call(this,e)});g(this,Bi,new Promise((e,r)=>{g(this,zr,r),g(this,jr,e)}))}get promise(){return i(this,Bi)}}Bi=new WeakMap,jr=new WeakMap,zr=new WeakMap;const qa=new Set;function Yc(t){qa.has(t)||(qa.add(t),console.log(t))}const Xc=a([]);class Ca{constructor(e=Xc){w(this,Mi);w(this,pr,void 0);g(this,pr,e)}get plugins(){return i(this,pr)}transformQuery(e,r){for(const u of i(this,pr)){const d=u.transformQuery({node:e,queryId:r});if(d.kind===e.kind)e=d;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${d.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async u=>{const d=await u.executeQuery(e),m=await j(this,Mi,Vo).call(this,d,r);return Zc(d,m),m})}async*stream(e,r,u){const d=new Oa,m=new Oa;this.provideConnection(async C=>(d.resolve(C),await m.promise)).catch(C=>d.reject(C));const x=await d.promise;try{for await(const C of x.streamQuery(e,r))yield await j(this,Mi,Vo).call(this,C,u)}finally{m.resolve()}}}pr=new WeakMap,Mi=new WeakSet,Vo=async function(e,r){for(const u of i(this,pr))e=await u.transformResult({result:e,queryId:r});return e};function Zc(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Yc("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class Rr extends Ca{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new Rr([...this.plugins,e])}withPlugins(e){return new Rr([...this.plugins,...e])}withPluginAtFront(e){return new Rr([e,...this.plugins])}withoutPlugins(){return new Rr([])}}const ro=new Rr;function eh(){return new In({executor:ro})}function th(t,e){return new Nn({joinNode:yi.create(t,Ti(e))})}function rh(){return new wn({overNode:Zs.create()})}function Be(t,e){if(e.length===3)return nh(t,e[0],e[1],e[2]);if(e.length===2)return ih(t,e[0],e[1]);throw new Error("not implemented")}function ih(t,e,r){return r(th(t,e)).toOperationNode()}function nh(t,e,r,u){return yi.createWithOn(t,Ti(e),qt(r,"=",u))}const sh=a({is(t){return t.kind==="OffsetNode"},create(t){return a({kind:"OffsetNode",offset:dt.create(t)})}}),oh=a({is(t){return t.kind==="GroupByItemNode"},create(t){return a({kind:"GroupByItemNode",groupBy:t})}});function ah(t){return t=Ue(t)?t(Br()):t,wi(t).map(oh.create)}const Wa=a({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return a({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function Lr(t,e,r){return Ue(e)&&(e=e(uo())),_t(e)||(e=[e]),e.map(u=>Wa.create(t,Mr(u),r))}const No=class No{constructor(e){w(this,Vt,void 0);g(this,Vt,e)}get expressionType(){}as(e){return new io(this,e)}or(...e){return new no(Er.create(i(this,Vt),Te(e)))}and(...e){return new so(Mt.create(i(this,Vt),Te(e)))}$castTo(){return new No(i(this,Vt))}toOperationNode(){return i(this,Vt)}};Vt=new WeakMap;let te=No;class io{constructor(e,r){w(this,Gr,void 0);w(this,$t,void 0);g(this,Gr,e),g(this,$t,r)}get expression(){return i(this,Gr)}get alias(){return i(this,$t)}toOperationNode(){return Pt.create(i(this,Gr).toOperationNode(),He(i(this,$t))?i(this,$t).toOperationNode():ie.create(i(this,$t)))}}Gr=new WeakMap,$t=new WeakMap;const us=class us{constructor(e){w(this,mr,void 0);g(this,mr,e)}get expressionType(){}as(e){return new io(this,e)}or(...e){return new us(Er.create(i(this,mr),Te(e)))}$castTo(){return new us(i(this,mr))}toOperationNode(){return Dr.create(i(this,mr))}};mr=new WeakMap;let no=us;const cs=class cs{constructor(e){w(this,yr,void 0);g(this,yr,e)}get expressionType(){}as(e){return new io(this,e)}and(...e){return new cs(Mt.create(i(this,yr),Te(e)))}$castTo(){return new cs(i(this,yr))}toOperationNode(){return Dr.create(i(this,yr))}};yr=new WeakMap;let so=cs;const k=class k{constructor(e){w(this,b,void 0);g(this,b,a(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new k({...i(this,b),queryNode:L.cloneWithWhere(i(this,b).queryNode,Te(e))})}whereRef(e,r,u){return new k({...i(this,b),queryNode:L.cloneWithWhere(i(this,b).queryNode,qt(e,r,u))})}having(...e){return new k({...i(this,b),queryNode:B.cloneWithHaving(i(this,b).queryNode,Te(e))})}havingRef(e,r,u){return new k({...i(this,b),queryNode:B.cloneWithHaving(i(this,b).queryNode,qt(e,r,u))})}select(e){return new k({...i(this,b),queryNode:B.cloneWithSelections(i(this,b).queryNode,ar(e))})}distinctOn(e){return new k({...i(this,b),queryNode:B.cloneWithDistinctOn(i(this,b).queryNode,wi(e))})}modifyFront(e){return new k({...i(this,b),queryNode:B.cloneWithFrontModifier(i(this,b).queryNode,xt.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.createWithExpression(e.toOperationNode()))})}distinct(){return new k({...i(this,b),queryNode:B.cloneWithFrontModifier(i(this,b).queryNode,xt.create("Distinct"))})}forUpdate(){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.create("ForUpdate"))})}forShare(){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.create("ForShare"))})}forKeyShare(){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.create("ForKeyShare"))})}forNoKeyUpdate(){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.create("ForNoKeyUpdate"))})}skipLocked(){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.create("SkipLocked"))})}noWait(){return new k({...i(this,b),queryNode:B.cloneWithEndModifier(i(this,b).queryNode,xt.create("NoWait"))})}selectAll(e){return new k({...i(this,b),queryNode:B.cloneWithSelections(i(this,b).queryNode,gi(e))})}innerJoin(...e){return new k({...i(this,b),queryNode:L.cloneWithJoin(i(this,b).queryNode,Be("InnerJoin",e))})}leftJoin(...e){return new k({...i(this,b),queryNode:L.cloneWithJoin(i(this,b).queryNode,Be("LeftJoin",e))})}rightJoin(...e){return new k({...i(this,b),queryNode:L.cloneWithJoin(i(this,b).queryNode,Be("RightJoin",e))})}fullJoin(...e){return new k({...i(this,b),queryNode:L.cloneWithJoin(i(this,b).queryNode,Be("FullJoin",e))})}innerJoinLateral(...e){return new k({...i(this,b),queryNode:L.cloneWithJoin(i(this,b).queryNode,Be("LateralInnerJoin",e))})}leftJoinLateral(...e){return new k({...i(this,b),queryNode:L.cloneWithJoin(i(this,b).queryNode,Be("LateralLeftJoin",e))})}orderBy(...e){return new k({...i(this,b),queryNode:B.cloneWithOrderByItems(i(this,b).queryNode,mn(e))})}groupBy(e){return new k({...i(this,b),queryNode:B.cloneWithGroupByItems(i(this,b).queryNode,ah(e))})}limit(e){return new k({...i(this,b),queryNode:B.cloneWithLimit(i(this,b).queryNode,wa.create(e))})}offset(e){return new k({...i(this,b),queryNode:B.cloneWithOffset(i(this,b).queryNode,sh.create(e))})}union(e){return new k({...i(this,b),queryNode:B.cloneWithSetOperations(i(this,b).queryNode,Lr("union",e,!1))})}unionAll(e){return new k({...i(this,b),queryNode:B.cloneWithSetOperations(i(this,b).queryNode,Lr("union",e,!0))})}intersect(e){return new k({...i(this,b),queryNode:B.cloneWithSetOperations(i(this,b).queryNode,Lr("intersect",e,!1))})}intersectAll(e){return new k({...i(this,b),queryNode:B.cloneWithSetOperations(i(this,b).queryNode,Lr("intersect",e,!0))})}except(e){return new k({...i(this,b),queryNode:B.cloneWithSetOperations(i(this,b).queryNode,Lr("except",e,!1))})}exceptAll(e){return new k({...i(this,b),queryNode:B.cloneWithSetOperations(i(this,b).queryNode,Lr("except",e,!0))})}as(e){return new ka(this,e)}clearSelect(){return new k({...i(this,b),queryNode:B.cloneWithoutSelections(i(this,b).queryNode)})}clearWhere(){return new k({...i(this,b),queryNode:L.cloneWithoutWhere(i(this,b).queryNode)})}clearLimit(){return new k({...i(this,b),queryNode:B.cloneWithoutLimit(i(this,b).queryNode)})}clearOffset(){return new k({...i(this,b),queryNode:B.cloneWithoutOffset(i(this,b).queryNode)})}clearOrderBy(){return new k({...i(this,b),queryNode:B.cloneWithoutOrderBy(i(this,b).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new k({...i(this,b)})}$castTo(){return new k(i(this,b))}$narrowType(){return new k(i(this,b))}$assertType(){return new k(i(this,b))}$asTuple(){return new te(this.toOperationNode())}withPlugin(e){return new k({...i(this,b),executor:i(this,b).executor.withPlugin(e)})}toOperationNode(){return i(this,b).executor.transformQuery(i(this,b).queryNode,i(this,b).queryId)}compile(){return i(this,b).executor.compileQuery(this.toOperationNode(),i(this,b).queryId)}async execute(){const e=this.compile();return(await i(this,b).executor.executeQuery(e,i(this,b).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=bn){const r=await this.executeTakeFirst();if(r===void 0)throw gn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,b).executor.stream(r,e,i(this,b).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new k({...i(this,b),queryNode:L.cloneWithExplain(i(this,b).queryNode,e,r)}).execute()}};b=new WeakMap;let Sn=k;M(Sn,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function An(t){return new Sn(t)}class ka{constructor(e,r){w(this,Kr,void 0);w(this,Hr,void 0);g(this,Kr,e),g(this,Hr,r)}get expression(){return i(this,Kr)}get alias(){return i(this,Hr)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Pt.create(i(this,Kr).toOperationNode(),ie.create(i(this,Hr)))}}Kr=new WeakMap,Hr=new WeakMap,M(ka,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const Pr=a({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return a({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return a({...t,distinct:!0})},cloneWithFilter(t,e){return a({...t,filter:t.filter?Pe.cloneWithOperation(t.filter,"And",e):Pe.create(e)})},cloneWithOrFilter(t,e){return a({...t,filter:t.filter?Pe.cloneWithOperation(t.filter,"Or",e):Pe.create(e)})},cloneWithOver(t,e){return a({...t,over:e})}}),uh=a({is(t){return t.kind==="FunctionNode"},create(t,e){return a({kind:"FunctionNode",func:t,arguments:e})}}),Yr=class Yr{constructor(e){w(this,Ve,void 0);g(this,Ve,a(e))}get expressionType(){}as(e){return new ch(this,e)}distinct(){return new Yr({...i(this,Ve),aggregateFunctionNode:Pr.cloneWithDistinct(i(this,Ve).aggregateFunctionNode)})}filterWhere(...e){return new Yr({...i(this,Ve),aggregateFunctionNode:Pr.cloneWithFilter(i(this,Ve).aggregateFunctionNode,Te(e))})}filterWhereRef(e,r,u){return new Yr({...i(this,Ve),aggregateFunctionNode:Pr.cloneWithFilter(i(this,Ve).aggregateFunctionNode,qt(e,r,u))})}over(e){const r=rh();return new Yr({...i(this,Ve),aggregateFunctionNode:Pr.cloneWithOver(i(this,Ve).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return i(this,Ve).aggregateFunctionNode}};Ve=new WeakMap;let Ci=Yr;M(Ci,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class ch{constructor(e,r){w(this,Xr,void 0);w(this,Zr,void 0);g(this,Xr,e),g(this,Zr,r)}get expression(){return i(this,Xr)}get alias(){return i(this,Zr)}toOperationNode(){return Pt.create(i(this,Xr).toOperationNode(),ie.create(i(this,Zr)))}}Xr=new WeakMap,Zr=new WeakMap;function Ta(){const t=(r,u)=>new te(uh.create(r,wi(u))),e=(r,u)=>new Ci({aggregateFunctionNode:Pr.create(r,u?wi(u):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(r,...u){return t("coalesce",[r,...u])},count(r){return e("count",[r])},countAll(r){return new Ci({aggregateFunctionNode:Pr.create("count",gi(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])}})}const hh=a({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return a({kind:"UnaryOperationNode",operator:t,operand:e})}});function dh(t,e){return hh.create(or.create(t),rt(e))}const oo=a({is(t){return t.kind==="WhenNode"},create(t){return a({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return a({...t,result:e})}}),ft=a({is(t){return t.kind==="CaseNode"},create(t){return a({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return a({...t,when:a(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return a({...t,when:t.when?a([...t.when.slice(0,-1),oo.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return a({...t,...e})}});class Ia{constructor(e){w(this,ei,void 0);g(this,ei,a(e))}when(...e){return new Sa({...i(this,ei),node:ft.cloneWithWhen(i(this,ei).node,oo.create(Te(e)))})}}ei=new WeakMap;class Sa{constructor(e){w(this,ti,void 0);g(this,ti,a(e))}then(e){return new lh({...i(this,ti),node:ft.cloneWithThen(i(this,ti).node,Ks(e)?Hs(e):De(e))})}}ti=new WeakMap;class lh{constructor(e){w(this,pt,void 0);g(this,pt,a(e))}when(...e){return new Sa({...i(this,pt),node:ft.cloneWithWhen(i(this,pt).node,oo.create(Te(e)))})}else(e){return new fh({...i(this,pt),node:ft.cloneWith(i(this,pt).node,{else:Ks(e)?Hs(e):De(e)})})}end(){return new te(ft.cloneWith(i(this,pt).node,{isStatement:!1}))}endCase(){return new te(ft.cloneWith(i(this,pt).node,{isStatement:!0}))}}pt=new WeakMap;class fh{constructor(e){w(this,ri,void 0);g(this,ri,a(e))}end(){return new te(ft.cloneWith(i(this,ri).node,{isStatement:!1}))}endCase(){return new te(ft.cloneWith(i(this,ri).node,{isStatement:!0}))}}ri=new WeakMap;const ph=a({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return a({kind:"JSONPathLegNode",type:t,value:e})}});class ao{constructor(e){w(this,Fi);w(this,jt,void 0);g(this,jt,e)}at(e){return j(this,Fi,$o).call(this,"ArrayLocation",e)}key(e){return j(this,Fi,$o).call(this,"Member",e)}}jt=new WeakMap,Fi=new WeakSet,$o=function(e,r){return new mh($s.cloneWithTraversal(i(this,jt),js.is(i(this,jt).traversal)?js.cloneWithLeg(i(this,jt).traversal,ph.create(e,r)):ta.cloneWithValue(i(this,jt).traversal,dt.createImmediate(r))))};class mh extends ao{constructor(r){super(r);w(this,ii,void 0);g(this,ii,r)}get expressionType(){}as(r){return new yh(this,r)}$castTo(){return new ao(i(this,ii))}toOperationNode(){return i(this,ii)}}ii=new WeakMap;class yh{constructor(e,r){w(this,ni,void 0);w(this,zt,void 0);g(this,ni,e),g(this,zt,r)}get expression(){return i(this,ni)}get alias(){return i(this,zt)}toOperationNode(){return Pt.create(i(this,ni).toOperationNode(),He(i(this,zt))?i(this,zt).toOperationNode():ie.create(i(this,zt)))}}ni=new WeakMap,zt=new WeakMap;const Aa=a({is(t){return t.kind==="TupleNode"},create(t){return a({kind:"TupleNode",values:a(t)})}});function uo(t=ro){function e(d,m,x){return new te(vi(d,m,x))}function r(d,m){return new te(dh(d,m))}const u=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(d){return An({queryId:G(),executor:t,queryNode:B.createFrom(ki(d))})},selectNoFrom(d){return An({queryId:G(),executor:t,queryNode:B.cloneWithSelections(B.create(),ar(d))})},case(d){return new Ia({node:ft.create(z(d)?void 0:rt(d))})},ref(d,m){return z(m)?new te(Ot(d)):new ao(Cc(d,m))},val(d){return new te(oa(d))},refTuple(...d){return new te(Aa.create(d.map(rt)))},tuple(...d){return new te(Aa.create(d.map(De)))},lit(d){return new te(Hs(d))},cmpr(d,m,x){return new te(vi(d,m,x))},bxp(d,m,x){return new te(vi(d,m,x))},unary:r,not(d){return r("not",d)},exists(d){return r("exists",d)},neg(d){return r("-",d)},between(d,m,x){return new te(Ni.create(rt(d),or.create("between"),Mt.create(De(m),De(x))))},betweenSymmetric(d,m,x){return new te(Ni.create(rt(d),or.create("between symmetric"),Mt.create(De(m),De(x))))},and(d){return _t(d)?new te(Ys(d,"and")):new te(aa(d,"and"))},or(d){return _t(d)?new te(Ys(d,"or")):new te(aa(d,"or"))},parens(...d){const m=Te(d);return Dr.is(m)?new te(m):new te(Dr.create(m))},withSchema(d){return uo(t.withPluginAtFront(new qi(d)))}});return u.fn=Ta(),u.eb=u,u}function Br(t){return uo()}function Mr(t){if(He(t))return t.toOperationNode();if(Ue(t))return t(Br()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function Ea(t){if(He(t))return t.toOperationNode();if(Ue(t))return t(Br()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Wi(t){return yc(t)||Nc(t)||Ue(t)}function ki(t){return _t(t)?t.map(e=>Ti(e)):[Ti(t)]}function Ti(t){return Q(t)?Nh(t):Ea(t)}function Nh(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(Da);return Pt.create(Me(r),ie.create(u))}else return Me(t)}function Me(t){const e=".";if(t.includes(e)){const[r,u]=t.split(e).map(Da);return Bt.createWithSchema(r,u)}else return Bt.create(t)}function Da(t){return t.trim()}const _a=a({is(t){return t.kind==="AddColumnNode"},create(t){return a({kind:"AddColumnNode",column:t})}}),he=a({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return a({kind:"ColumnDefinitionNode",column:ce.create(t),dataType:e})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):[e]})},cloneWith(t,e){return a({...t,...e})}}),Ra=a({is(t){return t.kind==="DropColumnNode"},create(t){return a({kind:"DropColumnNode",column:ce.create(t)})}}),La=a({is(t){return t.kind==="RenameColumnNode"},create(t,e){return a({kind:"RenameColumnNode",column:ce.create(t),renameTo:ce.create(e)})}}),co=a({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return a({kind:"CheckConstraintNode",expression:t,name:e?ie.create(e):void 0})}}),wh=["no action","restrict","cascade","set null","set default"],En=a({is(t){return t.kind==="ReferencesNode"},create(t,e){return a({kind:"ReferencesNode",table:t,columns:a([...e])})},cloneWithOnDelete(t,e){return a({...t,onDelete:e})},cloneWithOnUpdate(t,e){return a({...t,onUpdate:e})}});function Pa(t){return He(t)?t.toOperationNode():dt.createImmediate(t)}const Dn=a({is(t){return t.kind==="GeneratedNode"},create(t){return a({kind:"GeneratedNode",...t})},createWithExpression(t){return a({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return a({...t,...e})}}),vh=a({is(t){return t.kind==="DefaultValueNode"},create(t){return a({kind:"DefaultValueNode",defaultValue:t})}});function _n(t){if(wh.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}const be=class be{constructor(e){w(this,H,void 0);g(this,H,e)}autoIncrement(){return new be(he.cloneWith(i(this,H),{autoIncrement:!0}))}primaryKey(){return new be(he.cloneWith(i(this,H),{primaryKey:!0}))}references(e){const r=Ot(e);if(!r.table||Us.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new be(he.cloneWith(i(this,H),{references:En.create(r.table,[r.column])}))}onDelete(e){if(!i(this,H).references)throw new Error("on delete constraint can only be added for foreign keys");return new be(he.cloneWith(i(this,H),{references:En.cloneWithOnDelete(i(this,H).references,_n(e))}))}onUpdate(e){if(!i(this,H).references)throw new Error("on update constraint can only be added for foreign keys");return new be(he.cloneWith(i(this,H),{references:En.cloneWithOnUpdate(i(this,H).references,_n(e))}))}unique(){return new be(he.cloneWith(i(this,H),{unique:!0}))}notNull(){return new be(he.cloneWith(i(this,H),{notNull:!0}))}unsigned(){return new be(he.cloneWith(i(this,H),{unsigned:!0}))}defaultTo(e){return new be(he.cloneWith(i(this,H),{defaultTo:vh.create(Pa(e))}))}check(e){return new be(he.cloneWith(i(this,H),{check:co.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new be(he.cloneWith(i(this,H),{generated:Dn.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new be(he.cloneWith(i(this,H),{generated:Dn.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new be(he.cloneWith(i(this,H),{generated:Dn.create({identity:!0,byDefault:!0})}))}stored(){if(!i(this,H).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new be(he.cloneWith(i(this,H),{generated:Dn.cloneWith(i(this,H).generated,{stored:!0})}))}modifyFront(e){return new be(he.cloneWithFrontModifier(i(this,H),e.toOperationNode()))}modifyEnd(e){return new be(he.cloneWithEndModifier(i(this,H),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return i(this,H)}};H=new WeakMap;let Ft=be;M(Ft,"don't await ColumnDefinitionBuilder instances directly.");const Ba=a({is(t){return t.kind==="ModifyColumnNode"},create(t){return a({kind:"ModifyColumnNode",column:t})}}),bh=a({is(t){return t.kind==="DataTypeNode"},create(t){return a({kind:"DataTypeNode",dataType:t})}});function Fr(t){return He(t)?t.toOperationNode():bh.create(t)}const Rn=a({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,u){return a({kind:"ForeignKeyConstraintNode",columns:t,references:En.create(e,r),name:u?ie.create(u):void 0})},cloneWith(t,e){return a({...t,...e})}}),hs=class hs{constructor(e){w(this,Nr,void 0);g(this,Nr,e)}onDelete(e){return new hs(Rn.cloneWith(i(this,Nr),{onDelete:_n(e)}))}onUpdate(e){return new hs(Rn.cloneWith(i(this,Nr),{onUpdate:_n(e)}))}$call(e){return e(this)}toOperationNode(){return i(this,Nr)}};Nr=new WeakMap;let Ii=hs;M(Ii,"don't await ForeignKeyConstraintBuilder instances directly.");const Ln=a({is(t){return t.kind==="AddConstraintNode"},create(t){return a({kind:"AddConstraintNode",constraint:t})}}),Ma=a({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return a({kind:"UniqueConstraintNode",columns:a(t.map(ce.create)),name:e?ie.create(e):void 0})}}),Pn=a({is(t){return t.kind==="DropConstraintNode"},create(t){return a({kind:"DropConstraintNode",constraintName:ie.create(t)})},cloneWith(t,e){return a({...t,...e})}}),Si=a({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return a({kind:"AlterColumnNode",column:ce.create(t),[e]:r})}});class ho{constructor(e){w(this,kt,void 0);g(this,kt,e)}setDataType(e){return new Ai(Si.create(i(this,kt),"dataType",Fr(e)))}setDefault(e){return new Ai(Si.create(i(this,kt),"setDefault",Pa(e)))}dropDefault(){return new Ai(Si.create(i(this,kt),"dropDefault",!0))}setNotNull(){return new Ai(Si.create(i(this,kt),"setNotNull",!0))}dropNotNull(){return new Ai(Si.create(i(this,kt),"dropNotNull",!0))}$call(e){return e(this)}}kt=new WeakMap;class Ai{constructor(e){w(this,Qi,void 0);g(this,Qi,e)}toOperationNode(){return i(this,Qi)}}Qi=new WeakMap;class Qr{constructor(e){w(this,st,void 0);g(this,st,a(e))}toOperationNode(){return i(this,st).executor.transformQuery(i(this,st).node,i(this,st).queryId)}compile(){return i(this,st).executor.compileQuery(this.toOperationNode(),i(this,st).queryId)}async execute(){await i(this,st).executor.executeQuery(this.compile(),i(this,st).queryId)}}st=new WeakMap,M(Qr,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");const ds=class ds{constructor(e){w(this,Se,void 0);g(this,Se,a(e))}onDelete(e){return new ds({...i(this,Se),constraintBuilder:i(this,Se).constraintBuilder.onDelete(e)})}onUpdate(e){return new ds({...i(this,Se),constraintBuilder:i(this,Se).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return i(this,Se).executor.transformQuery(ue.cloneWithTableProps(i(this,Se).node,{addConstraint:Ln.create(i(this,Se).constraintBuilder.toOperationNode())}),i(this,Se).queryId)}compile(){return i(this,Se).executor.compileQuery(this.toOperationNode(),i(this,Se).queryId)}async execute(){await i(this,Se).executor.executeQuery(this.compile(),i(this,Se).queryId)}};Se=new WeakMap;let Bn=ds;M(Bn,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");const Ui=class Ui{constructor(e){w(this,Ne,void 0);g(this,Ne,a(e))}ifExists(){return new Ui({...i(this,Ne),node:ue.cloneWithTableProps(i(this,Ne).node,{dropConstraint:Pn.cloneWith(i(this,Ne).node.dropConstraint,{ifExists:!0})})})}cascade(){return new Ui({...i(this,Ne),node:ue.cloneWithTableProps(i(this,Ne).node,{dropConstraint:Pn.cloneWith(i(this,Ne).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Ui({...i(this,Ne),node:ue.cloneWithTableProps(i(this,Ne).node,{dropConstraint:Pn.cloneWith(i(this,Ne).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return i(this,Ne).executor.transformQuery(i(this,Ne).node,i(this,Ne).queryId)}compile(){return i(this,Ne).executor.compileQuery(this.toOperationNode(),i(this,Ne).queryId)}async execute(){await i(this,Ne).executor.executeQuery(this.compile(),i(this,Ne).queryId)}};Ne=new WeakMap;let Mn=Ui;M(Mn,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const Fa=a({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return a({kind:"PrimaryKeyConstraintNode",columns:a(t.map(ce.create)),name:e?ie.create(e):void 0})}});class Qa{constructor(e){w(this,Y,void 0);g(this,Y,a(e))}renameTo(e){return new Qr({...i(this,Y),node:ue.cloneWithTableProps(i(this,Y).node,{renameTo:Me(e)})})}setSchema(e){return new Qr({...i(this,Y),node:ue.cloneWithTableProps(i(this,Y).node,{setSchema:ie.create(e)})})}alterColumn(e,r){const u=r(new ho(e));return new Qt({...i(this,Y),node:ue.cloneWithColumnAlteration(i(this,Y).node,u.toOperationNode())})}dropColumn(e){return new Qt({...i(this,Y),node:ue.cloneWithColumnAlteration(i(this,Y).node,Ra.create(e))})}renameColumn(e,r){return new Qt({...i(this,Y),node:ue.cloneWithColumnAlteration(i(this,Y).node,La.create(e,r))})}addColumn(e,r,u=Ar){const d=u(new Ft(he.create(e,Fr(r))));return new Qt({...i(this,Y),node:ue.cloneWithColumnAlteration(i(this,Y).node,_a.create(d.toOperationNode()))})}modifyColumn(e,r,u=Ar){const d=u(new Ft(he.create(e,Fr(r))));return new Qt({...i(this,Y),node:ue.cloneWithColumnAlteration(i(this,Y).node,Ba.create(d.toOperationNode()))})}addUniqueConstraint(e,r){return new Qr({...i(this,Y),node:ue.cloneWithTableProps(i(this,Y).node,{addConstraint:Ln.create(Ma.create(r,e))})})}addCheckConstraint(e,r){return new Qr({...i(this,Y),node:ue.cloneWithTableProps(i(this,Y).node,{addConstraint:Ln.create(co.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,u,d){return new Bn({...i(this,Y),constraintBuilder:new Ii(Rn.create(r.map(ce.create),Me(u),d.map(ce.create),e))})}addPrimaryKeyConstraint(e,r){return new Qr({...i(this,Y),node:ue.cloneWithTableProps(i(this,Y).node,{addConstraint:Ln.create(Fa.create(r,e))})})}dropConstraint(e){return new Mn({...i(this,Y),node:ue.cloneWithTableProps(i(this,Y).node,{dropConstraint:Pn.create(e)})})}$call(e){return e(this)}}Y=new WeakMap;const wr=class wr{constructor(e){w(this,de,void 0);g(this,de,a(e))}alterColumn(e,r){const u=r(new ho(e));return new wr({...i(this,de),node:ue.cloneWithColumnAlteration(i(this,de).node,u.toOperationNode())})}dropColumn(e){return new wr({...i(this,de),node:ue.cloneWithColumnAlteration(i(this,de).node,Ra.create(e))})}renameColumn(e,r){return new wr({...i(this,de),node:ue.cloneWithColumnAlteration(i(this,de).node,La.create(e,r))})}addColumn(e,r,u=Ar){const d=u(new Ft(he.create(e,Fr(r))));return new wr({...i(this,de),node:ue.cloneWithColumnAlteration(i(this,de).node,_a.create(d.toOperationNode()))})}modifyColumn(e,r,u=Ar){const d=u(new Ft(he.create(e,Fr(r))));return new wr({...i(this,de),node:ue.cloneWithColumnAlteration(i(this,de).node,Ba.create(d.toOperationNode()))})}toOperationNode(){return i(this,de).executor.transformQuery(i(this,de).node,i(this,de).queryId)}compile(){return i(this,de).executor.compileQuery(this.toOperationNode(),i(this,de).queryId)}async execute(){await i(this,de).executor.executeQuery(this.compile(),i(this,de).queryId)}};de=new WeakMap;let Qt=wr;M(Qa,"don't await AlterTableBuilder instances"),M(ho,"don't await AlterColumnBuilder instances"),M(Qt,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Ua extends to{transformValue(e){return{...super.transformValue(e),immediate:!0}}}const mt=class mt{constructor(e){w(this,X,void 0);g(this,X,a(e))}ifNotExists(){return new mt({...i(this,X),node:Rt.cloneWith(i(this,X).node,{ifNotExists:!0})})}unique(){return new mt({...i(this,X),node:Rt.cloneWith(i(this,X).node,{unique:!0})})}on(e){return new mt({...i(this,X),node:Rt.cloneWith(i(this,X).node,{table:Me(e)})})}column(e){return new mt({...i(this,X),node:Rt.cloneWithColumns(i(this,X).node,[na(e)])})}columns(e){return new mt({...i(this,X),node:Rt.cloneWithColumns(i(this,X).node,e.map(na))})}expression(e){return new mt({...i(this,X),node:Rt.cloneWithColumns(i(this,X).node,[e.toOperationNode()])})}using(e){return new mt({...i(this,X),node:Rt.cloneWith(i(this,X).node,{using:Ee.createWithSql(e)})})}where(...e){const r=new Ua;return new mt({...i(this,X),node:L.cloneWithWhere(i(this,X).node,r.transformNode(Te(e)))})}$call(e){return e(this)}toOperationNode(){return i(this,X).executor.transformQuery(i(this,X).node,i(this,X).queryId)}compile(){return i(this,X).executor.compileQuery(this.toOperationNode(),i(this,X).queryId)}async execute(){await i(this,X).executor.executeQuery(this.compile(),i(this,X).queryId)}};X=new WeakMap;let Fn=mt;M(Fn,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");const wo=class wo{constructor(e){w(this,$e,void 0);g(this,$e,a(e))}ifNotExists(){return new wo({...i(this,$e),node:Ko.cloneWith(i(this,$e).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,$e).executor.transformQuery(i(this,$e).node,i(this,$e).queryId)}compile(){return i(this,$e).executor.compileQuery(this.toOperationNode(),i(this,$e).queryId)}async execute(){await i(this,$e).executor.executeQuery(this.compile(),i(this,$e).queryId)}};$e=new WeakMap;let Qn=wo;M(Qn,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function gh(t){if(mc.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}const Ye=class Ye{constructor(e){w(this,J,void 0);g(this,J,a(e))}temporary(){return new Ye({...i(this,J),node:tt.cloneWith(i(this,J).node,{temporary:!0})})}onCommit(e){return new Ye({...i(this,J),node:tt.cloneWith(i(this,J).node,{onCommit:gh(e)})})}ifNotExists(){return new Ye({...i(this,J),node:tt.cloneWith(i(this,J).node,{ifNotExists:!0})})}addColumn(e,r,u=Ar){const d=u(new Ft(he.create(e,Fr(r))));return new Ye({...i(this,J),node:tt.cloneWithColumn(i(this,J).node,d.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Ye({...i(this,J),node:tt.cloneWithConstraint(i(this,J).node,Fa.create(r,e))})}addUniqueConstraint(e,r){return new Ye({...i(this,J),node:tt.cloneWithConstraint(i(this,J).node,Ma.create(r,e))})}addCheckConstraint(e,r){return new Ye({...i(this,J),node:tt.cloneWithConstraint(i(this,J).node,co.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,u,d,m=Ar){const x=m(new Ii(Rn.create(r.map(ce.create),Me(u),d.map(ce.create),e)));return new Ye({...i(this,J),node:tt.cloneWithConstraint(i(this,J).node,x.toOperationNode())})}modifyFront(e){return new Ye({...i(this,J),node:tt.cloneWithFrontModifier(i(this,J).node,e.toOperationNode())})}modifyEnd(e){return new Ye({...i(this,J),node:tt.cloneWithEndModifier(i(this,J).node,e.toOperationNode())})}$call(e){return e(this)}toOperationNode(){return i(this,J).executor.transformQuery(i(this,J).node,i(this,J).queryId)}compile(){return i(this,J).executor.compileQuery(this.toOperationNode(),i(this,J).queryId)}async execute(){await i(this,J).executor.executeQuery(this.compile(),i(this,J).queryId)}};J=new WeakMap;let Un=Ye;M(Un,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");const Ji=class Ji{constructor(e){w(this,Ce,void 0);g(this,Ce,a(e))}on(e){return new Ji({...i(this,Ce),node:fn.cloneWith(i(this,Ce).node,{table:Me(e)})})}ifExists(){return new Ji({...i(this,Ce),node:fn.cloneWith(i(this,Ce).node,{ifExists:!0})})}cascade(){return new Ji({...i(this,Ce),node:fn.cloneWith(i(this,Ce).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Ce).executor.transformQuery(i(this,Ce).node,i(this,Ce).queryId)}compile(){return i(this,Ce).executor.compileQuery(this.toOperationNode(),i(this,Ce).queryId)}async execute(){await i(this,Ce).executor.executeQuery(this.compile(),i(this,Ce).queryId)}};Ce=new WeakMap;let Jn=Ji;M(Jn,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");const ls=class ls{constructor(e){w(this,_e,void 0);g(this,_e,a(e))}ifExists(){return new ls({...i(this,_e),node:Ms.cloneWith(i(this,_e).node,{ifExists:!0})})}cascade(){return new ls({...i(this,_e),node:Ms.cloneWith(i(this,_e).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,_e).executor.transformQuery(i(this,_e).node,i(this,_e).queryId)}compile(){return i(this,_e).executor.compileQuery(this.toOperationNode(),i(this,_e).queryId)}async execute(){await i(this,_e).executor.executeQuery(this.compile(),i(this,_e).queryId)}};_e=new WeakMap;let Vn=ls;M(Vn,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");const fs=class fs{constructor(e){w(this,Re,void 0);g(this,Re,a(e))}ifExists(){return new fs({...i(this,Re),node:Fs.cloneWith(i(this,Re).node,{ifExists:!0})})}cascade(){return new fs({...i(this,Re),node:Fs.cloneWith(i(this,Re).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Re).executor.transformQuery(i(this,Re).node,i(this,Re).queryId)}compile(){return i(this,Re).executor.compileQuery(this.toOperationNode(),i(this,Re).queryId)}async execute(){await i(this,Re).executor.executeQuery(this.compile(),i(this,Re).queryId)}};Re=new WeakMap;let $n=fs;M($n,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Ut=a({is(t){return t.kind==="CreateViewNode"},create(t){return a({kind:"CreateViewNode",name:Lt.create(t)})},cloneWith(t,e){return a({...t,...e})}});class xh{constructor(){w(this,ps,new Ua)}transformQuery(e){return i(this,ps).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}ps=new WeakMap;const Gt=class Gt{constructor(e){w(this,se,void 0);g(this,se,a(e))}temporary(){return new Gt({...i(this,se),node:Ut.cloneWith(i(this,se).node,{temporary:!0})})}materialized(){return new Gt({...i(this,se),node:Ut.cloneWith(i(this,se).node,{materialized:!0})})}ifNotExists(){return new Gt({...i(this,se),node:Ut.cloneWith(i(this,se).node,{ifNotExists:!0})})}orReplace(){return new Gt({...i(this,se),node:Ut.cloneWith(i(this,se).node,{orReplace:!0})})}columns(e){return new Gt({...i(this,se),node:Ut.cloneWith(i(this,se).node,{columns:e.map(ia)})})}as(e){const r=e.withPlugin(new xh).toOperationNode();return new Gt({...i(this,se),node:Ut.cloneWith(i(this,se).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return i(this,se).executor.transformQuery(i(this,se).node,i(this,se).queryId)}compile(){return i(this,se).executor.compileQuery(this.toOperationNode(),i(this,se).queryId)}async execute(){await i(this,se).executor.executeQuery(this.compile(),i(this,se).queryId)}};se=new WeakMap;let jn=Gt;M(jn,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const zn=a({is(t){return t.kind==="DropViewNode"},create(t){return a({kind:"DropViewNode",name:Lt.create(t)})},cloneWith(t,e){return a({...t,...e})}}),Vi=class Vi{constructor(e){w(this,We,void 0);g(this,We,a(e))}materialized(){return new Vi({...i(this,We),node:zn.cloneWith(i(this,We).node,{materialized:!0})})}ifExists(){return new Vi({...i(this,We),node:zn.cloneWith(i(this,We).node,{ifExists:!0})})}cascade(){return new Vi({...i(this,We),node:zn.cloneWith(i(this,We).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,We).executor.transformQuery(i(this,We).node,i(this,We).queryId)}compile(){return i(this,We).executor.compileQuery(this.toOperationNode(),i(this,We).queryId)}async execute(){await i(this,We).executor.executeQuery(this.compile(),i(this,We).queryId)}};We=new WeakMap;let Gn=Vi;M(Gn,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Ja=a({is(t){return t.kind==="CreateTypeNode"},create(t){return a({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return a({...t,enum:Gs.create(e.map(r=>dt.createImmediate(r)))})}}),vo=class vo{constructor(e){w(this,je,void 0);g(this,je,a(e))}toOperationNode(){return i(this,je).executor.transformQuery(i(this,je).node,i(this,je).queryId)}asEnum(e){return new vo({...i(this,je),node:Ja.cloneWithEnum(i(this,je).node,e)})}$call(e){return e(this)}compile(){return i(this,je).executor.compileQuery(this.toOperationNode(),i(this,je).queryId)}async execute(){await i(this,je).executor.executeQuery(this.compile(),i(this,je).queryId)}};je=new WeakMap;let Kn=vo;M(Kn,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Va=a({is(t){return t.kind==="DropTypeNode"},create(t){return a({kind:"DropTypeNode",name:t})},cloneWith(t,e){return a({...t,...e})}}),bo=class bo{constructor(e){w(this,ze,void 0);g(this,ze,a(e))}ifExists(){return new bo({...i(this,ze),node:Va.cloneWith(i(this,ze).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ze).executor.transformQuery(i(this,ze).node,i(this,ze).queryId)}compile(){return i(this,ze).executor.compileQuery(this.toOperationNode(),i(this,ze).queryId)}async execute(){await i(this,ze).executor.executeQuery(this.compile(),i(this,ze).queryId)}};ze=new WeakMap;let Hn=bo;M(Hn,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function $a(t){const e=".";if(t.includes(e)){const r=t.split(e).map(Oh);if(r.length===2)return Lt.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return Lt.create(t)}function Oh(t){return t.trim()}const $i=class $i{constructor(e){w(this,ge,void 0);g(this,ge,e)}createTable(e){return new Un({queryId:G(),executor:i(this,ge),node:tt.create(Me(e))})}dropTable(e){return new $n({queryId:G(),executor:i(this,ge),node:Fs.create(Me(e))})}createIndex(e){return new Fn({queryId:G(),executor:i(this,ge),node:Rt.create(e)})}dropIndex(e){return new Jn({queryId:G(),executor:i(this,ge),node:fn.create(e)})}createSchema(e){return new Qn({queryId:G(),executor:i(this,ge),node:Ko.create(e)})}dropSchema(e){return new Vn({queryId:G(),executor:i(this,ge),node:Ms.create(e)})}alterTable(e){return new Qa({queryId:G(),executor:i(this,ge),node:ue.create(Me(e))})}createView(e){return new jn({queryId:G(),executor:i(this,ge),node:Ut.create(e)})}dropView(e){return new Gn({queryId:G(),executor:i(this,ge),node:zn.create(e)})}createType(e){return new Kn({queryId:G(),executor:i(this,ge),node:Ja.create($a(e))})}dropType(e){return new Hn({queryId:G(),executor:i(this,ge),node:Va.create($a(e))})}withPlugin(e){return new $i(i(this,ge).withPlugin(e))}withoutPlugins(){return new $i(i(this,ge).withoutPlugins())}withSchema(e){return new $i(i(this,ge).withPluginAtFront(new qi(e)))}};ge=new WeakMap;let lo=$i;class qh{ref(e){return new Oc(e)}}class Ch{constructor(e){w(this,si,void 0);g(this,si,e)}async provideConnection(e){const r=await i(this,si).acquireConnection();try{return await e(r)}finally{await i(this,si).releaseConnection(r)}}}si=new WeakMap;const vr=class vr extends Ca{constructor(r,u,d,m=[]){super(m);w(this,yt,void 0);w(this,Nt,void 0);w(this,Tt,void 0);g(this,yt,r),g(this,Nt,u),g(this,Tt,d)}get adapter(){return i(this,Nt)}compileQuery(r){return i(this,yt).compileQuery(r)}provideConnection(r){return i(this,Tt).provideConnection(r)}withPlugins(r){return new vr(i(this,yt),i(this,Nt),i(this,Tt),[...this.plugins,...r])}withPlugin(r){return new vr(i(this,yt),i(this,Nt),i(this,Tt),[...this.plugins,r])}withPluginAtFront(r){return new vr(i(this,yt),i(this,Nt),i(this,Tt),[r,...this.plugins])}withConnectionProvider(r){return new vr(i(this,yt),i(this,Nt),r,[...this.plugins])}withoutPlugins(){return new vr(i(this,yt),i(this,Nt),i(this,Tt),[])}};yt=new WeakMap,Nt=new WeakMap,Tt=new WeakMap;let fo=vr;function ja(){return typeof performance<"u"&&Ue(performance.now)?performance.now():Date.now()}class Wh{constructor(e,r){w(this,ms);w(this,ys);w(this,Ns);w(this,ws);w(this,zi);w(this,ot,void 0);w(this,Kt,void 0);w(this,It,void 0);w(this,oi,void 0);w(this,St,void 0);w(this,ji,new WeakSet);g(this,oi,!1),g(this,ot,e),g(this,Kt,r)}async init(){if(i(this,St))throw new Error("driver has already been destroyed");i(this,It)||g(this,It,i(this,ot).init().then(()=>{g(this,oi,!0)}).catch(e=>(g(this,It,void 0),Promise.reject(e)))),await i(this,It)}async acquireConnection(){if(i(this,St))throw new Error("driver has already been destroyed");i(this,oi)||await this.init();const e=await i(this,ot).acquireConnection();return i(this,ji).has(e)||(j(this,ms,ac).call(this)&&j(this,ys,uc).call(this,e),i(this,ji).add(e)),e}async releaseConnection(e){await i(this,ot).releaseConnection(e)}beginTransaction(e,r){return i(this,ot).beginTransaction(e,r)}commitTransaction(e){return i(this,ot).commitTransaction(e)}rollbackTransaction(e){return i(this,ot).rollbackTransaction(e)}async destroy(){i(this,It)&&(await i(this,It),i(this,St)||g(this,St,i(this,ot).destroy().catch(e=>(g(this,St,void 0),Promise.reject(e)))),await i(this,St))}}ot=new WeakMap,Kt=new WeakMap,It=new WeakMap,oi=new WeakMap,St=new WeakMap,ji=new WeakMap,ms=new WeakSet,ac=function(){return i(this,Kt).isLevelEnabled("query")||i(this,Kt).isLevelEnabled("error")},ys=new WeakSet,uc=function(e){const r=e.executeQuery;e.executeQuery=async u=>{const d=ja();try{return await r.call(e,u)}catch(m){throw await j(this,Ns,cc).call(this,m,u,d),m}finally{await j(this,ws,hc).call(this,u,d)}}},Ns=new WeakSet,cc=async function(e,r,u){await i(this,Kt).error(()=>({level:"error",error:e,query:r,queryDurationMillis:j(this,zi,jo).call(this,u)}))},ws=new WeakSet,hc=async function(e,r){await i(this,Kt).query(()=>({level:"query",query:e,queryDurationMillis:j(this,zi,jo).call(this,r)}))},zi=new WeakSet,jo=function(e){return ja()-e};class za{constructor(e){w(this,vs);w(this,Gi,void 0);w(this,Ht,void 0);g(this,Gi,e)}async provideConnection(e){for(;i(this,Ht);)await i(this,Ht);const r=j(this,vs,dc).call(this,e);return g(this,Ht,r.then(()=>{g(this,Ht,void 0)}).catch(()=>{g(this,Ht,void 0)})),r}}Gi=new WeakMap,Ht=new WeakMap,vs=new WeakSet,dc=async function(e){return await e(i(this,Gi))};const kh=["read uncommitted","read committed","repeatable read","serializable"];a(["query","error"]);class Th{constructor(e){w(this,Yt,void 0);w(this,br,void 0);Ue(e)?(g(this,br,e),g(this,Yt,a({query:!0,error:!0}))):(g(this,br,Ih),g(this,Yt,a({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return i(this,Yt)[e]}async query(e){i(this,Yt).query&&await i(this,br).call(this,e())}async error(e){i(this,Yt).error&&await i(this,br).call(this,e())}}Yt=new WeakMap,br=new WeakMap;function Ih(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function Sh(t){return ht(t)&&Ue(t.compile)}const ai=class ai extends In{constructor(r){let u,d;if(Ah(r))u={executor:r.executor},d={...r};else{const m=r.dialect,x=m.createDriver(),C=m.createQueryCompiler(),P=m.createAdapter(),h=new Th(r.log??[]),oe=new Wh(x,h),q=new Ch(oe),Z=new fo(C,P,q,r.plugins??[]);u={executor:Z},d={config:r,executor:Z,dialect:m,driver:oe}}super(u);w(this,ke,void 0);g(this,ke,a(d))}get schema(){return new lo(i(this,ke).executor)}get dynamic(){return new qh}get introspection(){return i(this,ke).dialect.createIntrospector(this.withoutPlugins())}case(r){return new Ia({node:ft.create(z(r)?void 0:Mr(r))})}get fn(){return Ta()}transaction(){return new Yn({...i(this,ke)})}connection(){return new Ga({...i(this,ke)})}withPlugin(r){return new ai({...i(this,ke),executor:i(this,ke).executor.withPlugin(r)})}withoutPlugins(){return new ai({...i(this,ke),executor:i(this,ke).executor.withoutPlugins()})}withSchema(r){return new ai({...i(this,ke),executor:i(this,ke).executor.withPluginAtFront(new qi(r))})}withTables(){return new ai({...i(this,ke)})}async destroy(){await i(this,ke).driver.destroy()}get isTransaction(){return!1}getExecutor(){return i(this,ke).executor}executeQuery(r,u=G()){const d=Sh(r)?r.compile():r;return this.getExecutor().executeQuery(d,u)}};ke=new WeakMap;let Ei=ai;const ui=class ui extends Ei{constructor(r){super(r);w(this,at,void 0);g(this,at,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new ui({...i(this,at),executor:i(this,at).executor.withPlugin(r)})}withoutPlugins(){return new ui({...i(this,at),executor:i(this,at).executor.withoutPlugins()})}withSchema(r){return new ui({...i(this,at),executor:i(this,at).executor.withPluginAtFront(new qi(r))})}withTables(){return new ui({...i(this,at)})}};at=new WeakMap;let po=ui;function Ah(t){return ht(t)&&ht(t.config)&&ht(t.driver)&&ht(t.executor)&&ht(t.dialect)}class Ga{constructor(e){w(this,gr,void 0);g(this,gr,a(e))}async execute(e){return i(this,gr).executor.provideConnection(async r=>{const u=i(this,gr).executor.withConnectionProvider(new za(r)),d=new Ei({...i(this,gr),executor:u});return await e(d)})}}gr=new WeakMap,M(Ga,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");const go=class go{constructor(e){w(this,ut,void 0);g(this,ut,a(e))}setIsolationLevel(e){return new go({...i(this,ut),isolationLevel:e})}async execute(e){const{isolationLevel:r,...u}=i(this,ut),d={isolationLevel:r};return Eh(d),i(this,ut).executor.provideConnection(async m=>{const x=i(this,ut).executor.withConnectionProvider(new za(m)),C=new po({...u,executor:x});try{await i(this,ut).driver.beginTransaction(m,d);const P=await e(C);return await i(this,ut).driver.commitTransaction(m),P}catch(P){throw await i(this,ut).driver.rollbackTransaction(m),P}})}};ut=new WeakMap;let Yn=go;M(Yn,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function Eh(t){if(t.isolationLevel&&!kh.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}const bs=class bs{constructor(e){w(this,ci);w(this,Ki);w(this,Hi);w(this,Fe,void 0);g(this,Fe,a(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Ka(this,e)}$castTo(){return new bs({...i(this,Fe)})}withPlugin(e){return new bs({...i(this,Fe),plugins:i(this,Fe).plugins!==void 0?a([...i(this,Fe).plugins,e]):a([e])})}toOperationNode(){return j(this,Ki,zo).call(this,j(this,ci,Ps).call(this))}compile(e){return j(this,Hi,Go).call(this,j(this,ci,Ps).call(this,e))}async execute(e){const r=j(this,ci,Ps).call(this,e);return r.executeQuery(j(this,Hi,Go).call(this,r),i(this,Fe).queryId)}};Fe=new WeakMap,ci=new WeakSet,Ps=function(e){const r=e!==void 0?e.getExecutor():ro;return i(this,Fe).plugins!==void 0?r.withPlugins(i(this,Fe).plugins):r},Ki=new WeakSet,zo=function(e){return e.transformQuery(i(this,Fe).rawNode,i(this,Fe).queryId)},Hi=new WeakSet,Go=function(e){return e.compileQuery(j(this,Ki,zo).call(this,e),i(this,Fe).queryId)};let Xn=bs;function Jt(t){return new Xn(t)}M(Xn,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class Ka{constructor(e,r){w(this,xr,void 0);w(this,Xt,void 0);g(this,xr,e),g(this,Xt,r)}get expression(){return i(this,xr)}get alias(){return i(this,Xt)}get rawBuilder(){return i(this,xr)}toOperationNode(){return Pt.create(i(this,xr).toOperationNode(),He(i(this,Xt))?i(this,Xt).toOperationNode():ie.create(i(this,Xt)))}}xr=new WeakMap,Xt=new WeakMap,M(Ka,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const ne=Object.assign((t,...e)=>Jt({queryId:G(),rawNode:Ee.create(t,(e==null?void 0:e.map(De))??[])}),{ref(t){return Jt({queryId:G(),rawNode:Ee.createWithChild(Ot(t))})},val(t){return Jt({queryId:G(),rawNode:Ee.createWithChild(De(t))})},value(t){return this.val(t)},table(t){return Jt({queryId:G(),rawNode:Ee.createWithChild(Me(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",Jt({queryId:G(),rawNode:Ee.create(e,t.map(ie.create))})},lit(t){return Jt({queryId:G(),rawNode:Ee.createWithChild(dt.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return Jt({queryId:G(),rawNode:Ee.createWithSql(t)})},join(t,e=ne`, `){const r=new Array(2*t.length-1),u=e.toOperationNode();for(let d=0;d<t.length;++d)r[2*d]=De(t[d]),d!==t.length-1&&(r[2*d+1]=u);return Jt({queryId:G(),rawNode:Ee.createWithChildren(r)})}});class Dh{constructor(){U(this,"nodeStack",[]);w(this,gs,a({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this)}));U(this,"visitNode",e=>{this.nodeStack.push(e),i(this,gs)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}gs=new WeakMap;class _h extends Dh{constructor(){super(...arguments);w(this,hi,"");w(this,Or,[])}get numParameters(){return i(this,Or).length}compileQuery(r){return g(this,hi,""),g(this,Or,[]),this.visitNode(r),a({query:r,sql:this.getSql(),parameters:[...i(this,Or)]})}getSql(){return i(this,hi)}visitSelectQuery(r){var d,m;const u=this.parentNode!==void 0&&!Dr.is(this.parentNode)&&!lt.is(this.parentNode)&&!Ut.is(this.parentNode)&&!Wa.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),(d=r.frontModifiers)!=null&&d.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),(m=r.endModifiers)!=null&&m.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),u&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,u=", "){const d=r.length-1;for(let m=0;m<=d;m++)this.visitNode(r[m]),m<d&&this.append(u)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const u=this.nodeStack.find(L.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const u=this.nodeStack.find(L.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!Q(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:u}=r;for(let d=0;d<u.length;++d)this.appendValue(u[d]),d!==u.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(Lh[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:u,parameters:d}=r;for(let m=0;m<u.length;++m)this.append(u[m]),d.length>m&&this.visitNode(d[m])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const u=this.nodeStack.find(L.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),sr(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileList(r.columnAlterations)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(Rh[r.modifier])}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return or.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const u of r.pathLegs)this.visitNode(u);this.append("'")}visitJSONPathLeg(r){const u=r.type==="ArrayLocation";this.append(u?"[":"."),this.append(String(r.value)),u&&this.append("]")}visitJSONOperatorChain(r){for(let u=0,d=r.values.length;u<d;u++)u===d-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[u])}append(r){g(this,hi,i(this,hi)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const u=this.getLeftIdentifierWrapper(),d=this.getRightIdentifierWrapper();let m="";for(const x of r)m+=x,x===u?m+=u:x===d&&(m+=d);return m}addParameter(r){i(this,Or).push(r)}appendImmediateValue(r){if(Q(r))this.append(`'${r}'`);else if(ae(r)||sr(r))this.append(r.toString());else if(Bs(r))this.append("null");else if(fc(r))this.appendImmediateValue(r.toISOString());else if(pc(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((u,d)=>u.modifier&&d.modifier?Ha[u.modifier]-Ha[d.modifier]:1),a(r)}}hi=new WeakMap,Or=new WeakMap;const Rh=a({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),Ha=a({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Lh=a({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),ur=a({raw(t,e=[]){return a({sql:t,query:Ee.createWithSql(t),parameters:a(e)})}}),Ph=/"/g;class Bh extends _h{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(Ph,'""')}visitDefaultInsertValue(e){this.append("null")}}const Ya="kysely_migration",Xa="kysely_migration_lock";a({__noMigrations__:!0});class Mh{constructor(e){w(this,xs);w(this,di,void 0);g(this,di,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=i(this,di).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",Ya).where("name","!=",Xa));const u=await r.execute();return Promise.all(u.map(({name:d})=>j(this,xs,lc).call(this,d)))}async getMetadata(e){return{tables:await this.getTables(e)}}}di=new WeakMap,xs=new WeakSet,lc=async function(e){var x,C,P,h,oe,q;const r=i(this,di),u=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),d=(q=(oe=(h=(P=(C=(x=u.sql)==null?void 0:x.split(/[\(\),]/))==null?void 0:C.find(Z=>Z.toLowerCase().includes("autoincrement")))==null?void 0:P.trimStart())==null?void 0:h.split(/\s+/))==null?void 0:oe[0])==null?void 0:q.replace(/["`]/g,""),m=await r.selectFrom(ne`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:u.type==="view",columns:m.map(Z=>({name:Z.name,dataType:Z.type,isNullable:!Z.notnull,isAutoIncrementing:Z.name===d,hasDefaultValue:Z.dflt_value!=null}))}};class Fh{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var Qh=class{createQueryCompiler(){return new Bh}createAdapter(){return new Fh}createIntrospector(t){return new Mh(t)}},Uh=(uu=class{constructor(){w(this,Yi,new Jh);U(this,"connection")}async acquireConnection(){return await i(this,Yi).lock(),this.connection}async beginTransaction(t){await t.executeQuery(ur.raw("begin"))}async commitTransaction(t){await t.executeQuery(ur.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(ur.raw("rollback"))}async releaseConnection(){i(this,Yi).unlock()}},Yi=new WeakMap,uu),Jh=class{constructor(){U(this,"promise");U(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t==null||t()}},Vh=class{streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}async executeQuery(t){const{parameters:e,sql:r,query:u}=t;return["SelectQueryNode","RawNode"].includes(u.kind)?{rows:await this.query(r,e)}:{rows:[],...await this.exec(r,e)}}};function $h({func:t,delay:e,maxCalls:r}){let u,d=0,m=null;function x(){u&&clearTimeout(u),d=0,m=null}function C(){d>=r?(t(m),x()):(u&&clearTimeout(u),u=setTimeout(()=>{t(m),x(),u=void 0},e))}return P=>{d++,m=P,u===void 0&&d===0?(t(P),d++):C()}}var jh=class extends Uh{constructor(e){super();U(this,"config");U(this,"db");this.config=e}async init(){var e,r,u,d,m,x;if(this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,!this.db)throw new Error("no database");this.connection=new zh(this.db,(e=this.config.onWrite)==null?void 0:e.func,(r=this.config.onWrite)==null?void 0:r.isThrottle,(u=this.config.onWrite)==null?void 0:u.maxCalls,(d=this.config.onWrite)==null?void 0:d.delay),await((x=(m=this.config).onCreateConnection)==null?void 0:x.call(m,this.connection))}async beginTransaction(e){await e.executeQuery(ur.raw("begin")),e.transactionNum++}async commitTransaction(e){await e.executeQuery(ur.raw("commit")),e.transactionNum--}async rollbackTransaction(e){await e.executeQuery(ur.raw("rollback")),e.transactionNum--}async destroy(){var e;(e=this.db)==null||e.close()}},zh=class extends Vh{constructor(e,r,u=!1,d=1e3,m=2e3){super();U(this,"db");U(this,"onWrite");U(this,"transactionNum",0);this.db=e,this.onWrite=r?u?$h({func:r,maxCalls:d,delay:m}):r:void 0}query(e,r){const u=this.db.prepare(e);u.bind(r);const d=[];for(;u.step();)d.push(u.getAsObject());return u.free(),d}exec(e,r){this.db.run(e,r);const u=BigInt(this.query("SELECT last_insert_rowid() as id")[0].id),d=BigInt(this.db.getRowsModified());return this.transactionNum===0&&this.onWrite&&this.onWrite(this.db.export()),{numAffectedRows:d,insertId:u}}},Gh=(cu=class extends Qh{constructor(e){super();w(this,Xi,void 0);g(this,Xi,e)}createDriver(){return new jh(i(this,Xi))}},Xi=new WeakMap,cu);function Kh(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Hh(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function u(){return this instanceof u?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(u){var d=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(r,u,d.get?d:{enumerable:!0,get:function(){return t[u]}})}),r}var Za={exports:{}},Yh={},Xh=Object.freeze({__proto__:null,default:Yh}),Zn=Hh(Xh);(function(t,e){var r=void 0,u=function(d){return r||(r=new Promise(function(m,x){var C=typeof d<"u"?d:{},P=C.onAbort;C.onAbort=function(n){x(new Error(n)),P&&P(n)},C.postRun=C.postRun||[],C.postRun.push(function(){m(C)}),t=void 0;var h;h||(h=typeof C<"u"?C:{}),h.onRuntimeInitialized=function(){function n(f,v){switch(typeof v){case"boolean":yl(f,v?1:0);break;case"number":fl(f,v);break;case"string":pl(f,v,-1,-1);break;case"object":if(v===null)tc(f);else if(v.length!=null){var O=Qo(v);ml(f,O,v.length,-1),_s(O)}else Ls(f,"Wrong API use : tried to return a value of an unknown type ("+v+").",-1);break;default:tc(f)}}function s(f,v){for(var O=[],T=0;T<f;T+=1){var R=At(v+4*T,"i32"),$=ul(R);if($===1||$===2)R=ll(R);else if($===3)R=hl(R);else if($===4){$=R,R=cl($),$=dl($);for(var gt=new Uint8Array(R),Ke=0;Ke<R;Ke+=1)gt[Ke]=ve[$+Ke];R=gt}else R=null;O.push(R)}return O}function o(f,v){this.La=f,this.db=v,this.Ja=1,this.fb=[]}function c(f,v){if(this.db=v,v=fi(f)+1,this.Ya=Ds(v),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");Wr(f,vt,this.Ya,v),this.eb=this.Ya,this.Ua=this.ib=null}function l(f){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),f!=null){var v=this.filename,O="/",T=v;if(O&&(O=typeof O=="string"?O:nn(O),T=v?Et(O+"/"+v):O),v=Uu(!0,!0),T=Ws(T,(v!==void 0?v:438)&4095|32768,0),f){if(typeof f=="string"){O=Array(f.length);for(var R=0,$=f.length;R<$;++R)O[R]=f.charCodeAt(R);f=O}Ts(T,v|146),O=mi(T,577),Mu(O,f,0,f.length,0),Do(O),Ts(T,v)}}this.handleError(A(this.filename,p)),this.db=At(p,"i32"),Nl(this.db),this.Za={},this.Na={}}var p=nr(4),y=h.cwrap,A=y("sqlite3_open","number",["string","number"]),V=y("sqlite3_close_v2","number",["number"]),F=y("sqlite3_exec","number",["number","string","number","number","number"]),me=y("sqlite3_changes","number",["number"]),Dt=y("sqlite3_prepare_v2","number",["number","string","number","number","number"]),Hu=y("sqlite3_sql","string",["number"]),$d=y("sqlite3_normalized_sql","string",["number"]),Yu=y("sqlite3_prepare_v2","number",["number","number","number","number","number"]),jd=y("sqlite3_bind_text","number",["number","number","number","number","number"]),Xu=y("sqlite3_bind_blob","number",["number","number","number","number","number"]),zd=y("sqlite3_bind_double","number",["number","number","number"]),Gd=y("sqlite3_bind_int","number",["number","number","number"]),Kd=y("sqlite3_bind_parameter_index","number",["number","string"]),Hd=y("sqlite3_step","number",["number"]),Yd=y("sqlite3_errmsg","string",["number"]),Xd=y("sqlite3_column_count","number",["number"]),Zd=y("sqlite3_data_count","number",["number"]),el=y("sqlite3_column_double","number",["number","number"]),Zu=y("sqlite3_column_text","string",["number","number"]),tl=y("sqlite3_column_blob","number",["number","number"]),rl=y("sqlite3_column_bytes","number",["number","number"]),il=y("sqlite3_column_type","number",["number","number"]),nl=y("sqlite3_column_name","string",["number","number"]),sl=y("sqlite3_reset","number",["number"]),ol=y("sqlite3_clear_bindings","number",["number"]),al=y("sqlite3_finalize","number",["number"]),ec=y("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),ul=y("sqlite3_value_type","number",["number"]),cl=y("sqlite3_value_bytes","number",["number"]),hl=y("sqlite3_value_text","string",["number"]),dl=y("sqlite3_value_blob","number",["number"]),ll=y("sqlite3_value_double","number",["number"]),fl=y("sqlite3_result_double","",["number","number"]),tc=y("sqlite3_result_null","",["number"]),pl=y("sqlite3_result_text","",["number","string","number","number"]),ml=y("sqlite3_result_blob","",["number","number","number","number"]),yl=y("sqlite3_result_int","",["number","number"]),Ls=y("sqlite3_result_error","",["number","string","number"]),rc=y("sqlite3_aggregate_context","number",["number","number"]),Nl=y("RegisterExtensionFunctions","number",["number"]);o.prototype.bind=function(f){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(f)?this.xb(f):f!=null&&typeof f=="object"?this.yb(f):!0},o.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var f=Hd(this.La);switch(f){case 100:return!0;case 101:return!1;default:throw this.db.handleError(f)}},o.prototype.sb=function(f){return f==null&&(f=this.Ja,this.Ja+=1),el(this.La,f)},o.prototype.Cb=function(f){if(f==null&&(f=this.Ja,this.Ja+=1),f=Zu(this.La,f),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(f)},o.prototype.Db=function(f){return f==null&&(f=this.Ja,this.Ja+=1),Zu(this.La,f)},o.prototype.getBlob=function(f){f==null&&(f=this.Ja,this.Ja+=1);var v=rl(this.La,f);f=tl(this.La,f);for(var O=new Uint8Array(v),T=0;T<v;T+=1)O[T]=ve[f+T];return O},o.prototype.get=function(f,v){v=v||{},f!=null&&this.bind(f)&&this.step(),f=[];for(var O=Zd(this.La),T=0;T<O;T+=1)switch(il(this.La,T)){case 1:var R=v.useBigInt?this.Cb(T):this.sb(T);f.push(R);break;case 2:f.push(this.sb(T));break;case 3:f.push(this.Db(T));break;case 4:f.push(this.getBlob(T));break;default:f.push(null)}return f},o.prototype.getColumnNames=function(){for(var f=[],v=Xd(this.La),O=0;O<v;O+=1)f.push(nl(this.La,O));return f},o.prototype.getAsObject=function(f,v){f=this.get(f,v),v=this.getColumnNames();for(var O={},T=0;T<v.length;T+=1)O[v[T]]=f[T];return O},o.prototype.getSQL=function(){return Hu(this.La)},o.prototype.getNormalizedSQL=function(){return $d(this.La)},o.prototype.run=function(f){return f!=null&&this.bind(f),this.step(),this.reset()},o.prototype.nb=function(f,v){v==null&&(v=this.Ja,this.Ja+=1),f=bu(f);var O=Qo(f);this.fb.push(O),this.db.handleError(jd(this.La,v,O,f.length-1,0))},o.prototype.wb=function(f,v){v==null&&(v=this.Ja,this.Ja+=1);var O=Qo(f);this.fb.push(O),this.db.handleError(Xu(this.La,v,O,f.length,0))},o.prototype.mb=function(f,v){v==null&&(v=this.Ja,this.Ja+=1),this.db.handleError((f===(f|0)?Gd:zd)(this.La,v,f))},o.prototype.zb=function(f){f==null&&(f=this.Ja,this.Ja+=1),Xu(this.La,f,0,0,0)},o.prototype.ob=function(f,v){switch(v==null&&(v=this.Ja,this.Ja+=1),typeof f){case"string":this.nb(f,v);return;case"number":this.mb(f,v);return;case"bigint":this.nb(f.toString(),v);return;case"boolean":this.mb(f+0,v);return;case"object":if(f===null){this.zb(v);return}if(f.length!=null){this.wb(f,v);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+f+")."},o.prototype.yb=function(f){var v=this;return Object.keys(f).forEach(function(O){var T=Kd(v.La,O);T!==0&&v.ob(f[O],T)}),!0},o.prototype.xb=function(f){for(var v=0;v<f.length;v+=1)this.ob(f[v],v+1);return!0},o.prototype.reset=function(){return this.freemem(),ol(this.La)===0&&sl(this.La)===0},o.prototype.freemem=function(){for(var f;(f=this.fb.pop())!==void 0;)_s(f)},o.prototype.free=function(){this.freemem();var f=al(this.La)===0;return delete this.db.Za[this.La],this.La=0,f},c.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var f=cn(),v=nr(4);rn(p),rn(v);try{this.db.handleError(Yu(this.db.db,this.eb,-1,p,v)),this.eb=At(v,"i32");var O=At(p,"i32");return O===0?(this.gb(),{done:!0}):(this.Ua=new o(O,this.db),this.db.Za[O]=this.Ua,{value:this.Ua,done:!1})}catch(T){throw this.ib=qe(this.eb),this.gb(),T}finally{hn(f)}},c.prototype.gb=function(){_s(this.Ya),this.Ya=null},c.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:qe(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(c.prototype[Symbol.iterator]=function(){return this}),l.prototype.run=function(f,v){if(!this.db)throw"Database closed";if(v){f=this.prepare(f,v);try{f.step()}finally{f.free()}}else this.handleError(F(this.db,f,0,0,p));return this},l.prototype.exec=function(f,v,O){if(!this.db)throw"Database closed";var T=cn(),R=null;try{var $=fi(f)+1,gt=nr($);Wr(f,ve,gt,$);var Ke=gt,Ze=nr(4);for(f=[];At(Ke,"i8")!==0;){rn(p),rn(Ze),this.handleError(Yu(this.db,Ke,-1,p,Ze));var et=At(p,"i32");if(Ke=At(Ze,"i32"),et!==0){for($=null,R=new o(et,this),v!=null&&R.bind(v);R.step();)$===null&&($={columns:R.getColumnNames(),values:[]},f.push($)),$.values.push(R.get(null,O));R.free()}}return f}catch(dn){throw R&&R.free(),dn}finally{hn(T)}},l.prototype.each=function(f,v,O,T,R){typeof v=="function"&&(T=O,O=v,v=void 0),f=this.prepare(f,v);try{for(;f.step();)O(f.getAsObject(null,R))}finally{f.free()}if(typeof T=="function")return T()},l.prototype.prepare=function(f,v){if(rn(p),this.handleError(Dt(this.db,f,-1,p,0)),f=At(p,"i32"),f===0)throw"Nothing to prepare";var O=new o(f,this);return v!=null&&O.bind(v),this.Za[f]=O},l.prototype.iterateStatements=function(f){return new c(f,this)},l.prototype.export=function(){Object.values(this.Za).forEach(function(v){v.free()}),Object.values(this.Na).forEach(un),this.Na={},this.handleError(V(this.db));var f=Qd(this.filename);return this.handleError(A(this.filename,p)),this.db=At(p,"i32"),f},l.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(f){f.free()}),Object.values(this.Na).forEach(un),this.Na={},this.handleError(V(this.db)),Du("/"+this.filename),this.db=null)},l.prototype.handleError=function(f){if(f===0)return null;throw f=Yd(this.db),Error(f)},l.prototype.getRowsModified=function(){return me(this.db)},l.prototype.create_function=function(f,v){Object.prototype.hasOwnProperty.call(this.Na,f)&&(un(this.Na[f]),delete this.Na[f]);var O=Fo(function(T,R,$){R=s(R,$);try{var gt=v.apply(null,R)}catch(Ke){Ls(T,Ke,-1);return}n(T,gt)},"viii");return this.Na[f]=O,this.handleError(ec(this.db,f,v.length,1,0,O,0,0,0)),this},l.prototype.create_aggregate=function(f,v){var O=v.init||function(){return null},T=v.finalize||function(Ze){return Ze},R=v.step;if(!R)throw"An aggregate function must have a step function in "+f;var $={};Object.hasOwnProperty.call(this.Na,f)&&(un(this.Na[f]),delete this.Na[f]),v=f+"__finalize",Object.hasOwnProperty.call(this.Na,v)&&(un(this.Na[v]),delete this.Na[v]);var gt=Fo(function(Ze,et,dn){var Sr=rc(Ze,1);Object.hasOwnProperty.call($,Sr)||($[Sr]=O()),et=s(et,dn),et=[$[Sr]].concat(et);try{$[Sr]=R.apply(null,et)}catch(wl){delete $[Sr],Ls(Ze,wl,-1)}},"viii"),Ke=Fo(function(Ze){var et=rc(Ze,1);try{var dn=T($[et])}catch(Sr){delete $[et],Ls(Ze,Sr,-1);return}n(Ze,dn),delete $[et]},"vi");return this.Na[f]=gt,this.Na[v]=Ke,this.handleError(ec(this.db,f,R.length-1,1,0,0,gt,Ke,0)),this},h.Database=l};var oe=Object.assign({},h),q="./this.program",Z=typeof window=="object",Ge=typeof importScripts=="function",wt=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",xe="",Ae,Oe,le,Le,li,qr;wt?(xe=Ge?Zn.dirname(xe)+"/":__dirname+"/",qr=()=>{li||(Le=Zn,li=Zn)},Ae=function(n,s){return qr(),n=li.normalize(n),Le.readFileSync(n,s?void 0:"utf8")},le=n=>(n=Ae(n,!0),n.buffer||(n=new Uint8Array(n)),n),Oe=(n,s,o)=>{qr(),n=li.normalize(n),Le.readFile(n,function(c,l){c?o(c):s(l.buffer)})},1<process.argv.length&&(q=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=h,h.inspect=function(){return"[Emscripten Module object]"}):(Z||Ge)&&(Ge?xe=self.location.href:typeof document<"u"&&document.currentScript&&(xe=document.currentScript.src),xe=xe.indexOf("blob:")!==0?xe.substr(0,xe.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Ae=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(null),s.responseText},Ge&&(le=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),Oe=(n,s,o)=>{var c=new XMLHttpRequest;c.open("GET",n,!0),c.responseType="arraybuffer",c.onload=()=>{c.status==200||c.status==0&&c.response?s(c.response):o()},c.onerror=o,c.send(null)});var hu=h.print||console.log.bind(console),Cr=h.printErr||console.warn.bind(console);Object.assign(h,oe),oe=null,h.thisProgram&&(q=h.thisProgram);var Zi;h.wasmBinary&&(Zi=h.wasmBinary),h.noExitRuntime,typeof WebAssembly!="object"&&er("no native wasm support detected");var xo,du=!1,lu=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function en(n,s,o){var c=s+o;for(o=s;n[o]&&!(o>=c);)++o;if(16<o-s&&n.buffer&&lu)return lu.decode(n.subarray(s,o));for(c="";s<o;){var l=n[s++];if(l&128){var p=n[s++]&63;if((l&224)==192)c+=String.fromCharCode((l&31)<<6|p);else{var y=n[s++]&63;l=(l&240)==224?(l&15)<<12|p<<6|y:(l&7)<<18|p<<12|y<<6|n[s++]&63,65536>l?c+=String.fromCharCode(l):(l-=65536,c+=String.fromCharCode(55296|l>>10,56320|l&1023))}}else c+=String.fromCharCode(l)}return c}function qe(n,s){return n?en(vt,n,s):""}function Wr(n,s,o,c){if(!(0<c))return 0;var l=o;c=o+c-1;for(var p=0;p<n.length;++p){var y=n.charCodeAt(p);if(55296<=y&&57343>=y){var A=n.charCodeAt(++p);y=65536+((y&1023)<<10)|A&1023}if(127>=y){if(o>=c)break;s[o++]=y}else{if(2047>=y){if(o+1>=c)break;s[o++]=192|y>>6}else{if(65535>=y){if(o+2>=c)break;s[o++]=224|y>>12}else{if(o+3>=c)break;s[o++]=240|y>>18,s[o++]=128|y>>12&63}s[o++]=128|y>>6&63}s[o++]=128|y&63}}return s[o]=0,o-l}function fi(n){for(var s=0,o=0;o<n.length;++o){var c=n.charCodeAt(o);127>=c?s++:2047>=c?s+=2:55296<=c&&57343>=c?(s+=4,++o):s+=3}return s}var Oo,ve,vt,Os,S,fe,qo,Co;function fu(){var n=xo.buffer;Oo=n,h.HEAP8=ve=new Int8Array(n),h.HEAP16=Os=new Int16Array(n),h.HEAP32=S=new Int32Array(n),h.HEAPU8=vt=new Uint8Array(n),h.HEAPU16=new Uint16Array(n),h.HEAPU32=fe=new Uint32Array(n),h.HEAPF32=qo=new Float32Array(n),h.HEAPF64=Co=new Float64Array(n)}var Zt,pu=[],mu=[],yu=[];function Sd(){var n=h.preRun.shift();pu.unshift(n)}var kr=0,tn=null;function er(n){throw h.onAbort&&h.onAbort(n),n="Aborted("+n+")",Cr(n),du=!0,new WebAssembly.RuntimeError(n+". Build with -sASSERTIONS for more info.")}function Nu(){return Xe.startsWith("data:application/octet-stream;base64,")}var Xe;if(Xe="sql-wasm.wasm",!Nu()){var wu=Xe;Xe=h.locateFile?h.locateFile(wu,xe):xe+wu}function vu(){var n=Xe;try{if(n==Xe&&Zi)return new Uint8Array(Zi);if(le)return le(n);throw"both async and sync fetching of the wasm failed"}catch(s){er(s)}}function Ad(){if(!Zi&&(Z||Ge)){if(typeof fetch=="function"&&!Xe.startsWith("file://"))return fetch(Xe,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+Xe+"'";return n.arrayBuffer()}).catch(function(){return vu()});if(Oe)return new Promise(function(n,s){Oe(Xe,function(o){n(new Uint8Array(o))},s)})}return Promise.resolve().then(function(){return vu()})}var E,pe;function Wo(n){for(;0<n.length;)n.shift()(h)}function At(n,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return ve[n>>0];case"i8":return ve[n>>0];case"i16":return Os[n>>1];case"i32":return S[n>>2];case"i64":return S[n>>2];case"float":return qo[n>>2];case"double":return Co[n>>3];case"*":return fe[n>>2];default:er("invalid type for getValue: "+s)}return null}function rn(n){var s="i32";switch(s.endsWith("*")&&(s="*"),s){case"i1":ve[n>>0]=0;break;case"i8":ve[n>>0]=0;break;case"i16":Os[n>>1]=0;break;case"i32":S[n>>2]=0;break;case"i64":pe=[0,(E=0,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[n>>2]=pe[0],S[n+4>>2]=pe[1];break;case"float":qo[n>>2]=0;break;case"double":Co[n>>3]=0;break;case"*":fe[n>>2]=0;break;default:er("invalid type for setValue: "+s)}}var ko=(n,s)=>{for(var o=0,c=n.length-1;0<=c;c--){var l=n[c];l==="."?n.splice(c,1):l===".."?(n.splice(c,1),o++):o&&(n.splice(c,1),o--)}if(s)for(;o;o--)n.unshift("..");return n},Et=n=>{var s=n.charAt(0)==="/",o=n.substr(-1)==="/";return(n=ko(n.split("/").filter(c=>!!c),!s).join("/"))||s||(n="."),n&&o&&(n+="/"),(s?"/":"")+n},Ed=n=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(n).slice(1);return n=s[0],s=s[1],!n&&!s?".":(s&&(s=s.substr(0,s.length-1)),n+s)},qs=n=>{if(n==="/")return"/";n=Et(n),n=n.replace(/\/$/,"");var s=n.lastIndexOf("/");return s===-1?n:n.substr(s+1)};function Dd(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var n=new Uint8Array(1);return()=>(crypto.getRandomValues(n),n[0])}if(wt)try{var s=Zn;return()=>s.randomBytes(1)[0]}catch{}return()=>er("randomDevice")}function Cs(){for(var n="",s=!1,o=arguments.length-1;-1<=o&&!s;o--){if(s=0<=o?arguments[o]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";n=s+"/"+n,s=s.charAt(0)==="/"}return n=ko(n.split("/").filter(c=>!!c),!s).join("/"),(s?"/":"")+n||"."}function bu(n,s){var o=Array(fi(n)+1);return n=Wr(n,o,0,o.length),s&&(o.length=n),o}var gu=[];function xu(n,s){gu[n]={input:[],output:[],Xa:s},Ao(n,_d)}var _d={open:function(n){var s=gu[n.node.rdev];if(!s)throw new N(43);n.tty=s,n.seekable=!1},close:function(n){n.tty.Xa.fsync(n.tty)},fsync:function(n){n.tty.Xa.fsync(n.tty)},read:function(n,s,o,c){if(!n.tty||!n.tty.Xa.tb)throw new N(60);for(var l=0,p=0;p<c;p++){try{var y=n.tty.Xa.tb(n.tty)}catch{throw new N(29)}if(y===void 0&&l===0)throw new N(6);if(y==null)break;l++,s[o+p]=y}return l&&(n.node.timestamp=Date.now()),l},write:function(n,s,o,c){if(!n.tty||!n.tty.Xa.jb)throw new N(60);try{for(var l=0;l<c;l++)n.tty.Xa.jb(n.tty,s[o+l])}catch{throw new N(29)}return c&&(n.node.timestamp=Date.now()),l}},Rd={tb:function(n){if(!n.input.length){var s=null;if(wt){var o=Buffer.alloc(256),c=0;try{c=Le.readSync(process.stdin.fd,o,0,256,-1)}catch(l){if(l.toString().includes("EOF"))c=0;else throw l}0<c?s=o.slice(0,c).toString("utf-8"):s=null}else typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`));if(!s)return null;n.input=bu(s,!0)}return n.input.shift()},jb:function(n,s){s===null||s===10?(hu(en(n.output,0)),n.output=[]):s!=0&&n.output.push(s)},fsync:function(n){n.output&&0<n.output.length&&(hu(en(n.output,0)),n.output=[])}},Ld={jb:function(n,s){s===null||s===10?(Cr(en(n.output,0)),n.output=[]):s!=0&&n.output.push(s)},fsync:function(n){n.output&&0<n.output.length&&(Cr(en(n.output,0)),n.output=[])}},D={Qa:null,Ra:function(){return D.createNode(null,"/",16895,0)},createNode:function(n,s,o,c){if((o&61440)===24576||(o&61440)===4096)throw new N(63);return D.Qa||(D.Qa={dir:{node:{Pa:D.Ga.Pa,Oa:D.Ga.Oa,lookup:D.Ga.lookup,ab:D.Ga.ab,rename:D.Ga.rename,unlink:D.Ga.unlink,rmdir:D.Ga.rmdir,readdir:D.Ga.readdir,symlink:D.Ga.symlink},stream:{Ta:D.Ha.Ta}},file:{node:{Pa:D.Ga.Pa,Oa:D.Ga.Oa},stream:{Ta:D.Ha.Ta,read:D.Ha.read,write:D.Ha.write,lb:D.Ha.lb,bb:D.Ha.bb,cb:D.Ha.cb}},link:{node:{Pa:D.Ga.Pa,Oa:D.Ga.Oa,readlink:D.Ga.readlink},stream:{}},pb:{node:{Pa:D.Ga.Pa,Oa:D.Ga.Oa},stream:Fd}}),o=Wu(n,s,o,c),(o.mode&61440)===16384?(o.Ga=D.Qa.dir.node,o.Ha=D.Qa.dir.stream,o.Ia={}):(o.mode&61440)===32768?(o.Ga=D.Qa.file.node,o.Ha=D.Qa.file.stream,o.Ma=0,o.Ia=null):(o.mode&61440)===40960?(o.Ga=D.Qa.link.node,o.Ha=D.Qa.link.stream):(o.mode&61440)===8192&&(o.Ga=D.Qa.pb.node,o.Ha=D.Qa.pb.stream),o.timestamp=Date.now(),n&&(n.Ia[s]=o,n.timestamp=o.timestamp),o},Jb:function(n){return n.Ia?n.Ia.subarray?n.Ia.subarray(0,n.Ma):new Uint8Array(n.Ia):new Uint8Array(0)},qb:function(n,s){var o=n.Ia?n.Ia.length:0;o>=s||(s=Math.max(s,o*(1048576>o?2:1.125)>>>0),o!=0&&(s=Math.max(s,256)),o=n.Ia,n.Ia=new Uint8Array(s),0<n.Ma&&n.Ia.set(o.subarray(0,n.Ma),0))},Gb:function(n,s){if(n.Ma!=s)if(s==0)n.Ia=null,n.Ma=0;else{var o=n.Ia;n.Ia=new Uint8Array(s),o&&n.Ia.set(o.subarray(0,Math.min(s,n.Ma))),n.Ma=s}},Ga:{Pa:function(n){var s={};return s.dev=(n.mode&61440)===8192?n.id:1,s.ino=n.id,s.mode=n.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=n.rdev,(n.mode&61440)===16384?s.size=4096:(n.mode&61440)===32768?s.size=n.Ma:(n.mode&61440)===40960?s.size=n.link.length:s.size=0,s.atime=new Date(n.timestamp),s.mtime=new Date(n.timestamp),s.ctime=new Date(n.timestamp),s.Ab=4096,s.blocks=Math.ceil(s.size/s.Ab),s},Oa:function(n,s){s.mode!==void 0&&(n.mode=s.mode),s.timestamp!==void 0&&(n.timestamp=s.timestamp),s.size!==void 0&&D.Gb(n,s.size)},lookup:function(){throw Io[44]},ab:function(n,s,o,c){return D.createNode(n,s,o,c)},rename:function(n,s,o){if((n.mode&61440)===16384){try{var c=Tr(s,o)}catch{}if(c)for(var l in c.Ia)throw new N(55)}delete n.parent.Ia[n.name],n.parent.timestamp=Date.now(),n.name=o,s.Ia[o]=n,s.timestamp=n.parent.timestamp,n.parent=s},unlink:function(n,s){delete n.Ia[s],n.timestamp=Date.now()},rmdir:function(n,s){var o=Tr(n,s),c;for(c in o.Ia)throw new N(55);delete n.Ia[s],n.timestamp=Date.now()},readdir:function(n){var s=[".",".."],o;for(o in n.Ia)n.Ia.hasOwnProperty(o)&&s.push(o);return s},symlink:function(n,s,o){return n=D.createNode(n,s,41471,0),n.link=o,n},readlink:function(n){if((n.mode&61440)!==40960)throw new N(28);return n.link}},Ha:{read:function(n,s,o,c,l){var p=n.node.Ia;if(l>=n.node.Ma)return 0;if(n=Math.min(n.node.Ma-l,c),8<n&&p.subarray)s.set(p.subarray(l,l+n),o);else for(c=0;c<n;c++)s[o+c]=p[l+c];return n},write:function(n,s,o,c,l,p){if(s.buffer===ve.buffer&&(p=!1),!c)return 0;if(n=n.node,n.timestamp=Date.now(),s.subarray&&(!n.Ia||n.Ia.subarray)){if(p)return n.Ia=s.subarray(o,o+c),n.Ma=c;if(n.Ma===0&&l===0)return n.Ia=s.slice(o,o+c),n.Ma=c;if(l+c<=n.Ma)return n.Ia.set(s.subarray(o,o+c),l),c}if(D.qb(n,l+c),n.Ia.subarray&&s.subarray)n.Ia.set(s.subarray(o,o+c),l);else for(p=0;p<c;p++)n.Ia[l+p]=s[o+p];return n.Ma=Math.max(n.Ma,l+c),c},Ta:function(n,s,o){if(o===1?s+=n.position:o===2&&(n.node.mode&61440)===32768&&(s+=n.node.Ma),0>s)throw new N(28);return s},lb:function(n,s,o){D.qb(n.node,s+o),n.node.Ma=Math.max(n.node.Ma,s+o)},bb:function(n,s,o,c,l){if((n.node.mode&61440)!==32768)throw new N(43);if(n=n.node.Ia,l&2||n.buffer!==Oo){if((0<o||o+s<n.length)&&(n.subarray?n=n.subarray(o,o+s):n=Array.prototype.slice.call(n,o,o+s)),o=!0,s=65536*Math.ceil(s/65536),(l=Gu(65536,s))?(vt.fill(0,l,l+s),s=l):s=0,!s)throw new N(48);ve.set(n,s)}else o=!1,s=n.byteOffset;return{Fb:s,vb:o}},cb:function(n,s,o,c,l){if((n.node.mode&61440)!==32768)throw new N(43);return l&2||D.Ha.write(n,s,0,c,o,!1),0}}},To=null,Ou={},tr=[],Pd=1,rr=null,qu=!0,N=null,Io={},Qe=(n,s={})=>{if(n=Cs("/",n),!n)return{path:"",node:null};if(s=Object.assign({rb:!0,kb:0},s),8<s.kb)throw new N(32);n=ko(n.split("/").filter(y=>!!y),!1);for(var o=To,c="/",l=0;l<n.length;l++){var p=l===n.length-1;if(p&&s.parent)break;if(o=Tr(o,n[l]),c=Et(c+"/"+n[l]),o.Va&&(!p||p&&s.rb)&&(o=o.Va.root),!p||s.Sa){for(p=0;(o.mode&61440)===40960;)if(o=_u(c),c=Cs(Ed(c),o),o=Qe(c,{kb:s.kb+1}).node,40<p++)throw new N(32)}}return{path:c,node:o}},nn=n=>{for(var s;;){if(n===n.parent)return n=n.Ra.ub,s?n[n.length-1]!=="/"?n+"/"+s:n+s:n;s=s?n.name+"/"+s:n.name,n=n.parent}},So=(n,s)=>{for(var o=0,c=0;c<s.length;c++)o=(o<<5)-o+s.charCodeAt(c)|0;return(n+o>>>0)%rr.length},Cu=n=>{var s=So(n.parent.id,n.name);if(rr[s]===n)rr[s]=n.Wa;else for(s=rr[s];s;){if(s.Wa===n){s.Wa=n.Wa;break}s=s.Wa}},Tr=(n,s)=>{var o;if(o=(o=pi(n,"x"))?o:n.Ga.lookup?0:2)throw new N(o,n);for(o=rr[So(n.id,s)];o;o=o.Wa){var c=o.name;if(o.parent.id===n.id&&c===s)return o}return n.Ga.lookup(n,s)},Wu=(n,s,o,c)=>(n=new ju(n,s,o,c),s=So(n.parent.id,n.name),n.Wa=rr[s],rr[s]=n),Bd={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},ku=n=>{var s=["r","w","rw"][n&3];return n&512&&(s+="w"),s},pi=(n,s)=>{if(qu)return 0;if(!s.includes("r")||n.mode&292){if(s.includes("w")&&!(n.mode&146)||s.includes("x")&&!(n.mode&73))return 2}else return 2;return 0},Tu=(n,s)=>{try{return Tr(n,s),20}catch{}return pi(n,"wx")},Iu=(n,s,o)=>{try{var c=Tr(n,s)}catch(l){return l.Ka}if(n=pi(n,"wx"))return n;if(o){if((c.mode&61440)!==16384)return 54;if(c===c.parent||nn(c)==="/")return 10}else if((c.mode&61440)===16384)return 31;return 0},Md=(n=0)=>{for(;4096>=n;n++)if(!tr[n])return n;throw new N(33)},Su=(n,s)=>(an||(an=function(){this.$a={}},an.prototype={},Object.defineProperties(an.prototype,{object:{get:function(){return this.node},set:function(o){this.node=o}},flags:{get:function(){return this.$a.flags},set:function(o){this.$a.flags=o}},position:{get:function(){return this.$a.position},set:function(o){this.$a.position=o}}})),n=Object.assign(new an,n),s=Md(s),n.fd=s,tr[s]=n),Fd={open:n=>{n.Ha=Ou[n.node.rdev].Ha,n.Ha.open&&n.Ha.open(n)},Ta:()=>{throw new N(70)}},Ao=(n,s)=>{Ou[n]={Ha:s}},Au=(n,s)=>{var o=s==="/",c=!s;if(o&&To)throw new N(10);if(!o&&!c){var l=Qe(s,{rb:!1});if(s=l.path,l=l.node,l.Va)throw new N(10);if((l.mode&61440)!==16384)throw new N(54)}s={type:n,Kb:{},ub:s,Eb:[]},n=n.Ra(s),n.Ra=s,s.root=n,o?To=n:l&&(l.Va=s,l.Ra&&l.Ra.Eb.push(s))},Ws=(n,s,o)=>{var c=Qe(n,{parent:!0}).node;if(n=qs(n),!n||n==="."||n==="..")throw new N(28);var l=Tu(c,n);if(l)throw new N(l);if(!c.Ga.ab)throw new N(63);return c.Ga.ab(c,n,s,o)},bt=(n,s)=>Ws(n,(s!==void 0?s:511)&1023|16384,0),ks=(n,s,o)=>{typeof o>"u"&&(o=s,s=438),Ws(n,s|8192,o)},Eo=(n,s)=>{if(!Cs(n))throw new N(44);var o=Qe(s,{parent:!0}).node;if(!o)throw new N(44);s=qs(s);var c=Tu(o,s);if(c)throw new N(c);if(!o.Ga.symlink)throw new N(63);o.Ga.symlink(o,s,n)},Eu=n=>{var s=Qe(n,{parent:!0}).node;n=qs(n);var o=Tr(s,n),c=Iu(s,n,!0);if(c)throw new N(c);if(!s.Ga.rmdir)throw new N(63);if(o.Va)throw new N(10);s.Ga.rmdir(s,n),Cu(o)},Du=n=>{var s=Qe(n,{parent:!0}).node;if(!s)throw new N(44);n=qs(n);var o=Tr(s,n),c=Iu(s,n,!1);if(c)throw new N(c);if(!s.Ga.unlink)throw new N(63);if(o.Va)throw new N(10);s.Ga.unlink(s,n),Cu(o)},_u=n=>{if(n=Qe(n).node,!n)throw new N(44);if(!n.Ga.readlink)throw new N(28);return Cs(nn(n.parent),n.Ga.readlink(n))},sn=(n,s)=>{if(n=Qe(n,{Sa:!s}).node,!n)throw new N(44);if(!n.Ga.Pa)throw new N(63);return n.Ga.Pa(n)},Ru=n=>sn(n,!0),Ts=(n,s)=>{if(n=typeof n=="string"?Qe(n,{Sa:!0}).node:n,!n.Ga.Oa)throw new N(63);n.Ga.Oa(n,{mode:s&4095|n.mode&-4096,timestamp:Date.now()})},Lu=(n,s)=>{if(0>s)throw new N(28);if(n=typeof n=="string"?Qe(n,{Sa:!0}).node:n,!n.Ga.Oa)throw new N(63);if((n.mode&61440)===16384)throw new N(31);if((n.mode&61440)!==32768)throw new N(28);var o=pi(n,"w");if(o)throw new N(o);n.Ga.Oa(n,{size:s,timestamp:Date.now()})},mi=(n,s,o)=>{if(n==="")throw new N(44);if(typeof s=="string"){var c=Bd[s];if(typeof c>"u")throw Error("Unknown file open mode: "+s);s=c}if(o=s&64?(typeof o>"u"?438:o)&4095|32768:0,typeof n=="object")var l=n;else{n=Et(n);try{l=Qe(n,{Sa:!(s&131072)}).node}catch{}}if(c=!1,s&64)if(l){if(s&128)throw new N(20)}else l=Ws(n,o,0),c=!0;if(!l)throw new N(44);if((l.mode&61440)===8192&&(s&=-513),s&65536&&(l.mode&61440)!==16384)throw new N(54);if(!c&&(o=l?(l.mode&61440)===40960?32:(l.mode&61440)===16384&&(ku(s)!=="r"||s&512)?31:pi(l,ku(s)):44))throw new N(o);return s&512&&!c&&Lu(l,0),s&=-131713,l=Su({node:l,path:nn(l),flags:s,seekable:!0,position:0,Ha:l.Ha,Ib:[],error:!1}),l.Ha.open&&l.Ha.open(l),!h.logReadFiles||s&1||(Is||(Is={}),n in Is||(Is[n]=1)),l},Do=n=>{if(n.fd===null)throw new N(8);n.hb&&(n.hb=null);try{n.Ha.close&&n.Ha.close(n)}catch(s){throw s}finally{tr[n.fd]=null}n.fd=null},Pu=(n,s,o)=>{if(n.fd===null)throw new N(8);if(!n.seekable||!n.Ha.Ta)throw new N(70);if(o!=0&&o!=1&&o!=2)throw new N(28);n.position=n.Ha.Ta(n,s,o),n.Ib=[]},Bu=(n,s,o,c,l)=>{if(0>c||0>l)throw new N(28);if(n.fd===null)throw new N(8);if((n.flags&2097155)===1)throw new N(8);if((n.node.mode&61440)===16384)throw new N(31);if(!n.Ha.read)throw new N(28);var p=typeof l<"u";if(!p)l=n.position;else if(!n.seekable)throw new N(70);return s=n.Ha.read(n,s,o,c,l),p||(n.position+=s),s},Mu=(n,s,o,c,l)=>{if(0>c||0>l)throw new N(28);if(n.fd===null)throw new N(8);if(!(n.flags&2097155))throw new N(8);if((n.node.mode&61440)===16384)throw new N(31);if(!n.Ha.write)throw new N(28);n.seekable&&n.flags&1024&&Pu(n,0,2);var p=typeof l<"u";if(!p)l=n.position;else if(!n.seekable)throw new N(70);return s=n.Ha.write(n,s,o,c,l,void 0),p||(n.position+=s),s},Qd=n=>{var s,o=mi(n,o||0);n=sn(n).size;var c=new Uint8Array(n);return Bu(o,c,0,n,0),s=c,Do(o),s},Fu=()=>{N||(N=function(n,s){this.node=s,this.Hb=function(o){this.Ka=o},this.Hb(n),this.message="FS error"},N.prototype=Error(),N.prototype.constructor=N,[44].forEach(n=>{Io[n]=new N(n),Io[n].stack="<generic error, no stack>"}))},Qu,Uu=(n,s)=>{var o=0;return n&&(o|=365),s&&(o|=146),o},on=(n,s,o)=>{n=Et("/dev/"+n);var c=Uu(!!s,!!o);_o||(_o=64);var l=_o++<<8|0;Ao(l,{open:p=>{p.seekable=!1},close:()=>{o&&o.buffer&&o.buffer.length&&o(10)},read:(p,y,A,V)=>{for(var F=0,me=0;me<V;me++){try{var Dt=s()}catch{throw new N(29)}if(Dt===void 0&&F===0)throw new N(6);if(Dt==null)break;F++,y[A+me]=Dt}return F&&(p.node.timestamp=Date.now()),F},write:(p,y,A,V)=>{for(var F=0;F<V;F++)try{o(y[A+F])}catch{throw new N(29)}return V&&(p.node.timestamp=Date.now()),F}}),ks(n,c,l)},_o,re={},an,Is;function Ir(n,s,o){if(s.charAt(0)==="/")return s;if(n=n===-100?"/":ct(n).path,s.length==0){if(!o)throw new N(44);return n}return Et(n+"/"+s)}function Ss(n,s,o){try{var c=n(s)}catch(l){if(l&&l.node&&Et(s)!==Et(nn(l.node)))return-54;throw l}return S[o>>2]=c.dev,S[o+8>>2]=c.ino,S[o+12>>2]=c.mode,fe[o+16>>2]=c.nlink,S[o+20>>2]=c.uid,S[o+24>>2]=c.gid,S[o+28>>2]=c.rdev,pe=[c.size>>>0,(E=c.size,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[o+40>>2]=pe[0],S[o+44>>2]=pe[1],S[o+48>>2]=4096,S[o+52>>2]=c.blocks,pe=[Math.floor(c.atime.getTime()/1e3)>>>0,(E=Math.floor(c.atime.getTime()/1e3),1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[o+56>>2]=pe[0],S[o+60>>2]=pe[1],fe[o+64>>2]=0,pe=[Math.floor(c.mtime.getTime()/1e3)>>>0,(E=Math.floor(c.mtime.getTime()/1e3),1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[o+72>>2]=pe[0],S[o+76>>2]=pe[1],fe[o+80>>2]=0,pe=[Math.floor(c.ctime.getTime()/1e3)>>>0,(E=Math.floor(c.ctime.getTime()/1e3),1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[o+88>>2]=pe[0],S[o+92>>2]=pe[1],fe[o+96>>2]=0,pe=[c.ino>>>0,(E=c.ino,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[o+104>>2]=pe[0],S[o+108>>2]=pe[1],0}var As=void 0;function Es(){return As+=4,S[As-4>>2]}function ct(n){if(n=tr[n],!n)throw new N(8);return n}function Ro(n){return fe[n>>2]+4294967296*S[n+4>>2]}function Ju(n){var s=fi(n)+1,o=Ds(s);return o&&Wr(n,ve,o,s),o}function Ud(n,s,o){function c(V){return(V=V.toTimeString().match(/\(([A-Za-z ]+)\)$/))?V[1]:"GMT"}var l=new Date().getFullYear(),p=new Date(l,0,1),y=new Date(l,6,1);l=p.getTimezoneOffset();var A=y.getTimezoneOffset();S[n>>2]=60*Math.max(l,A),S[s>>2]=+(l!=A),n=c(p),s=c(y),n=Ju(n),s=Ju(s),A<l?(fe[o>>2]=n,fe[o+4>>2]=s):(fe[o>>2]=s,fe[o+4>>2]=n)}function Lo(n,s,o){Lo.Bb||(Lo.Bb=!0,Ud(n,s,o))}var Vu;Vu=wt?()=>{var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}:()=>performance.now();var Po={};function $u(){if(!Bo){var n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:q||"./this.program"},s;for(s in Po)Po[s]===void 0?delete n[s]:n[s]=Po[s];var o=[];for(s in n)o.push(s+"="+n[s]);Bo=o}return Bo}var Bo,ir=void 0,Mo=[];function Fo(n,s){if(!ir){ir=new WeakMap;var o=Zt.length;if(ir)for(var c=0;c<0+o;c++){var l=Zt.get(c);l&&ir.set(l,c)}}if(ir.has(n))return ir.get(n);if(Mo.length)o=Mo.pop();else{try{Zt.grow(1)}catch(A){throw A instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":A}o=Zt.length-1}try{Zt.set(o,n)}catch(A){if(!(A instanceof TypeError))throw A;if(typeof WebAssembly.Function=="function"){c=WebAssembly.Function,l={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"};for(var p={parameters:[],results:s[0]=="v"?[]:[l[s[0]]]},y=1;y<s.length;++y)p.parameters.push(l[s[y]]);s=new c(p,n)}else{for(c=[1,96],l=s.slice(0,1),s=s.slice(1),p={i:127,p:127,j:126,f:125,d:124},y=s.length,128>y?c.push(y):c.push(y%128|128,y>>7),y=0;y<s.length;++y)c.push(p[s[y]]);l=="v"?c.push(0):c.push(1,p[l]),s=[0,97,115,109,1,0,0,0,1],l=c.length,128>l?s.push(l):s.push(l%128|128,l>>7),s.push.apply(s,c),s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),s=new WebAssembly.Module(new Uint8Array(s)),s=new WebAssembly.Instance(s,{e:{f:n}}).exports.f}Zt.set(o,s)}return ir.set(n,o),o}function un(n){ir.delete(Zt.get(n)),Mo.push(n)}function Qo(n){var s=Ds(n.length);return n.subarray||n.slice||(n=new Uint8Array(n)),vt.set(n,s),s}function Jd(n,s,o,c){var l={string:F=>{var me=0;if(F!=null&&F!==0){var Dt=(F.length<<2)+1;me=nr(Dt),Wr(F,vt,me,Dt)}return me},array:F=>{var me=nr(F.length);return ve.set(F,me),me}};n=h["_"+n];var p=[],y=0;if(c)for(var A=0;A<c.length;A++){var V=l[o[A]];V?(y===0&&(y=cn()),p[A]=V(c[A])):p[A]=c[A]}return o=n.apply(null,p),o=function(F){return y!==0&&hn(y),s==="string"?qe(F):s==="boolean"?!!F:F}(o)}function ju(n,s,o,c){n||(n=this),this.parent=n,this.Ra=n.Ra,this.Va=null,this.id=Pd++,this.name=s,this.mode=o,this.Ga={},this.Ha={},this.rdev=c}Object.defineProperties(ju.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(n){n?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(n){n?this.mode|=146:this.mode&=-147}}}),Fu(),rr=Array(4096),Au(D,"/"),bt("/tmp"),bt("/home"),bt("/home/web_user"),(()=>{bt("/dev"),Ao(259,{read:()=>0,write:(s,o,c,l)=>l}),ks("/dev/null",259),xu(1280,Rd),xu(1536,Ld),ks("/dev/tty",1280),ks("/dev/tty1",1536);var n=Dd();on("random",n),on("urandom",n),bt("/dev/shm"),bt("/dev/shm/tmp")})(),(()=>{bt("/proc");var n=bt("/proc/self");bt("/proc/self/fd"),Au({Ra:()=>{var s=Wu(n,"fd",16895,73);return s.Ga={lookup:(o,c)=>{var l=tr[+c];if(!l)throw new N(8);return o={parent:null,Ra:{ub:"fake"},Ga:{readlink:()=>l.path}},o.parent=o}},s}},"/proc/self/fd")})();var Vd={a:function(n,s,o,c){er("Assertion failed: "+qe(n)+", at: "+[s?qe(s):"unknown filename",o,c?qe(c):"unknown function"])},h:function(n,s){try{return n=qe(n),Ts(n,s),0}catch(o){if(typeof re>"u"||!(o instanceof N))throw o;return-o.Ka}},H:function(n,s,o){try{if(s=qe(s),s=Ir(n,s),o&-8)return-28;var c=Qe(s,{Sa:!0}).node;return c?(n="",o&4&&(n+="r"),o&2&&(n+="w"),o&1&&(n+="x"),n&&pi(c,n)?-2:0):-44}catch(l){if(typeof re>"u"||!(l instanceof N))throw l;return-l.Ka}},i:function(n,s){try{var o=tr[n];if(!o)throw new N(8);return Ts(o.node,s),0}catch(c){if(typeof re>"u"||!(c instanceof N))throw c;return-c.Ka}},g:function(n){try{var s=tr[n];if(!s)throw new N(8);var o=s.node,c=typeof o=="string"?Qe(o,{Sa:!0}).node:o;if(!c.Ga.Oa)throw new N(63);return c.Ga.Oa(c,{timestamp:Date.now()}),0}catch(l){if(typeof re>"u"||!(l instanceof N))throw l;return-l.Ka}},b:function(n,s,o){As=o;try{var c=ct(n);switch(s){case 0:var l=Es();return 0>l?-28:Su(c,l).fd;case 1:case 2:return 0;case 3:return c.flags;case 4:return l=Es(),c.flags|=l,0;case 5:return l=Es(),Os[l+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return S[zu()>>2]=28,-1;default:return-28}}catch(p){if(typeof re>"u"||!(p instanceof N))throw p;return-p.Ka}},G:function(n,s){try{var o=ct(n);return Ss(sn,o.path,s)}catch(c){if(typeof re>"u"||!(c instanceof N))throw c;return-c.Ka}},l:function(n,s,o){try{if(s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN,isNaN(s))return-61;var c=tr[n];if(!c)throw new N(8);if(!(c.flags&2097155))throw new N(28);return Lu(c.node,s),0}catch(l){if(typeof re>"u"||!(l instanceof N))throw l;return-l.Ka}},B:function(n,s){try{if(s===0)return-28;var o=fi("/")+1;return s<o?-68:(Wr("/",vt,n,s),o)}catch(c){if(typeof re>"u"||!(c instanceof N))throw c;return-c.Ka}},E:function(n,s){try{return n=qe(n),Ss(Ru,n,s)}catch(o){if(typeof re>"u"||!(o instanceof N))throw o;return-o.Ka}},y:function(n,s,o){try{return s=qe(s),s=Ir(n,s),s=Et(s),s[s.length-1]==="/"&&(s=s.substr(0,s.length-1)),bt(s,o),0}catch(c){if(typeof re>"u"||!(c instanceof N))throw c;return-c.Ka}},D:function(n,s,o,c){try{s=qe(s);var l=c&256;return s=Ir(n,s,c&4096),Ss(l?Ru:sn,s,o)}catch(p){if(typeof re>"u"||!(p instanceof N))throw p;return-p.Ka}},v:function(n,s,o,c){As=c;try{s=qe(s),s=Ir(n,s);var l=c?Es():0;return mi(s,o,l).fd}catch(p){if(typeof re>"u"||!(p instanceof N))throw p;return-p.Ka}},t:function(n,s,o,c){try{if(s=qe(s),s=Ir(n,s),0>=c)return-28;var l=_u(s),p=Math.min(c,fi(l)),y=ve[o+p];return Wr(l,vt,o,c+1),ve[o+p]=y,p}catch(A){if(typeof re>"u"||!(A instanceof N))throw A;return-A.Ka}},s:function(n){try{return n=qe(n),Eu(n),0}catch(s){if(typeof re>"u"||!(s instanceof N))throw s;return-s.Ka}},F:function(n,s){try{return n=qe(n),Ss(sn,n,s)}catch(o){if(typeof re>"u"||!(o instanceof N))throw o;return-o.Ka}},p:function(n,s,o){try{return s=qe(s),s=Ir(n,s),o===0?Du(s):o===512?Eu(s):er("Invalid flags passed to unlinkat"),0}catch(c){if(typeof re>"u"||!(c instanceof N))throw c;return-c.Ka}},o:function(n,s,o){try{if(s=qe(s),s=Ir(n,s,!0),o){var c=Ro(o),l=S[o+8>>2];p=1e3*c+l/1e6,o+=16,c=Ro(o),l=S[o+8>>2],y=1e3*c+l/1e6}else var p=Date.now(),y=p;n=p;var A=Qe(s,{Sa:!0}).node;return A.Ga.Oa(A,{timestamp:Math.max(n,y)}),0}catch(V){if(typeof re>"u"||!(V instanceof N))throw V;return-V.Ka}},e:function(){return Date.now()},j:function(n,s){n=new Date(1e3*Ro(n)),S[s>>2]=n.getSeconds(),S[s+4>>2]=n.getMinutes(),S[s+8>>2]=n.getHours(),S[s+12>>2]=n.getDate(),S[s+16>>2]=n.getMonth(),S[s+20>>2]=n.getFullYear()-1900,S[s+24>>2]=n.getDay();var o=new Date(n.getFullYear(),0,1);S[s+28>>2]=(n.getTime()-o.getTime())/864e5|0,S[s+36>>2]=-(60*n.getTimezoneOffset());var c=new Date(n.getFullYear(),6,1).getTimezoneOffset();o=o.getTimezoneOffset(),S[s+32>>2]=(c!=o&&n.getTimezoneOffset()==Math.min(o,c))|0},w:function(n,s,o,c,l,p){try{var y=ct(c);if(s&2&&!(o&2)&&(y.flags&2097155)!==2)throw new N(2);if((y.flags&2097155)===1)throw new N(2);if(!y.Ha.bb)throw new N(43);var A=y.Ha.bb(y,n,l,s,o),V=A.Fb;return S[p>>2]=A.vb,V}catch(F){if(typeof re>"u"||!(F instanceof N))throw F;return-F.Ka}},x:function(n,s,o,c,l,p){try{var y=ct(l);if(o&2){var A=vt.slice(n,n+s);y&&y.Ha.cb&&y.Ha.cb(y,A,p,s,c)}}catch(V){if(typeof re>"u"||!(V instanceof N))throw V;return-V.Ka}},n:Lo,q:function(){return 2147483648},d:Vu,c:function(n){var s=vt.length;if(n>>>=0,2147483648<n)return!1;for(var o=1;4>=o;o*=2){var c=s*(1+.2/o);c=Math.min(c,n+100663296);var l=Math;c=Math.max(n,c),l=l.min.call(l,2147483648,c+(65536-c%65536)%65536);e:{try{xo.grow(l-Oo.byteLength+65535>>>16),fu();var p=1;break e}catch{}p=void 0}if(p)return!0}return!1},z:function(n,s){var o=0;return $u().forEach(function(c,l){var p=s+o;for(l=fe[n+4*l>>2]=p,p=0;p<c.length;++p)ve[l++>>0]=c.charCodeAt(p);ve[l>>0]=0,o+=c.length+1}),0},A:function(n,s){var o=$u();fe[n>>2]=o.length;var c=0;return o.forEach(function(l){c+=l.length+1}),fe[s>>2]=c,0},f:function(n){try{var s=ct(n);return Do(s),0}catch(o){if(typeof re>"u"||!(o instanceof N))throw o;return o.Ka}},m:function(n,s){try{var o=ct(n);return ve[s>>0]=o.tty?2:(o.mode&61440)===16384?3:(o.mode&61440)===40960?7:4,0}catch(c){if(typeof re>"u"||!(c instanceof N))throw c;return c.Ka}},u:function(n,s,o,c){try{e:{var l=ct(n);n=s;for(var p=s=0;p<o;p++){var y=fe[n>>2],A=fe[n+4>>2];n+=8;var V=Bu(l,ve,y,A);if(0>V){var F=-1;break e}if(s+=V,V<A)break}F=s}return fe[c>>2]=F,0}catch(me){if(typeof re>"u"||!(me instanceof N))throw me;return me.Ka}},k:function(n,s,o,c,l){try{if(s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN,isNaN(s))return 61;var p=ct(n);return Pu(p,s,c),pe=[p.position>>>0,(E=p.position,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],S[l>>2]=pe[0],S[l+4>>2]=pe[1],p.hb&&s===0&&c===0&&(p.hb=null),0}catch(y){if(typeof re>"u"||!(y instanceof N))throw y;return y.Ka}},C:function(n){try{var s=ct(n);return s.Ha&&s.Ha.fsync?s.Ha.fsync(s):0}catch(o){if(typeof re>"u"||!(o instanceof N))throw o;return o.Ka}},r:function(n,s,o,c){try{e:{var l=ct(n);n=s;for(var p=s=0;p<o;p++){var y=fe[n>>2],A=fe[n+4>>2];n+=8;var V=Mu(l,ve,y,A);if(0>V){var F=-1;break e}s+=V}F=s}return fe[c>>2]=F,0}catch(me){if(typeof re>"u"||!(me instanceof N))throw me;return me.Ka}}};(function(){function n(l){h.asm=l.exports,xo=h.asm.I,fu(),Zt=h.asm.Aa,mu.unshift(h.asm.J),kr--,h.monitorRunDependencies&&h.monitorRunDependencies(kr),kr==0&&tn&&(l=tn,tn=null,l())}function s(l){n(l.instance)}function o(l){return Ad().then(function(p){return WebAssembly.instantiate(p,c)}).then(function(p){return p}).then(l,function(p){Cr("failed to asynchronously prepare wasm: "+p),er(p)})}var c={a:Vd};if(kr++,h.monitorRunDependencies&&h.monitorRunDependencies(kr),h.instantiateWasm)try{return h.instantiateWasm(c,n)}catch(l){return Cr("Module.instantiateWasm callback failed with error: "+l),!1}return function(){return Zi||typeof WebAssembly.instantiateStreaming!="function"||Nu()||Xe.startsWith("file://")||wt||typeof fetch!="function"?o(s):fetch(Xe,{credentials:"same-origin"}).then(function(l){return WebAssembly.instantiateStreaming(l,c).then(s,function(p){return Cr("wasm streaming compile failed: "+p),Cr("falling back to ArrayBuffer instantiation"),o(s)})})}(),{}})(),h.___wasm_call_ctors=function(){return(h.___wasm_call_ctors=h.asm.J).apply(null,arguments)},h._sqlite3_free=function(){return(h._sqlite3_free=h.asm.K).apply(null,arguments)},h._sqlite3_value_double=function(){return(h._sqlite3_value_double=h.asm.L).apply(null,arguments)},h._sqlite3_value_text=function(){return(h._sqlite3_value_text=h.asm.M).apply(null,arguments)};var zu=h.___errno_location=function(){return(zu=h.___errno_location=h.asm.N).apply(null,arguments)};h._sqlite3_prepare_v2=function(){return(h._sqlite3_prepare_v2=h.asm.O).apply(null,arguments)},h._sqlite3_step=function(){return(h._sqlite3_step=h.asm.P).apply(null,arguments)},h._sqlite3_finalize=function(){return(h._sqlite3_finalize=h.asm.Q).apply(null,arguments)},h._sqlite3_reset=function(){return(h._sqlite3_reset=h.asm.R).apply(null,arguments)},h._sqlite3_value_int=function(){return(h._sqlite3_value_int=h.asm.S).apply(null,arguments)},h._sqlite3_clear_bindings=function(){return(h._sqlite3_clear_bindings=h.asm.T).apply(null,arguments)},h._sqlite3_value_blob=function(){return(h._sqlite3_value_blob=h.asm.U).apply(null,arguments)},h._sqlite3_value_bytes=function(){return(h._sqlite3_value_bytes=h.asm.V).apply(null,arguments)},h._sqlite3_value_type=function(){return(h._sqlite3_value_type=h.asm.W).apply(null,arguments)},h._sqlite3_result_blob=function(){return(h._sqlite3_result_blob=h.asm.X).apply(null,arguments)},h._sqlite3_result_double=function(){return(h._sqlite3_result_double=h.asm.Y).apply(null,arguments)},h._sqlite3_result_error=function(){return(h._sqlite3_result_error=h.asm.Z).apply(null,arguments)},h._sqlite3_result_int=function(){return(h._sqlite3_result_int=h.asm._).apply(null,arguments)},h._sqlite3_result_int64=function(){return(h._sqlite3_result_int64=h.asm.$).apply(null,arguments)},h._sqlite3_result_null=function(){return(h._sqlite3_result_null=h.asm.aa).apply(null,arguments)},h._sqlite3_result_text=function(){return(h._sqlite3_result_text=h.asm.ba).apply(null,arguments)},h._sqlite3_sql=function(){return(h._sqlite3_sql=h.asm.ca).apply(null,arguments)},h._sqlite3_aggregate_context=function(){return(h._sqlite3_aggregate_context=h.asm.da).apply(null,arguments)},h._sqlite3_column_count=function(){return(h._sqlite3_column_count=h.asm.ea).apply(null,arguments)},h._sqlite3_data_count=function(){return(h._sqlite3_data_count=h.asm.fa).apply(null,arguments)},h._sqlite3_column_blob=function(){return(h._sqlite3_column_blob=h.asm.ga).apply(null,arguments)},h._sqlite3_column_bytes=function(){return(h._sqlite3_column_bytes=h.asm.ha).apply(null,arguments)},h._sqlite3_column_double=function(){return(h._sqlite3_column_double=h.asm.ia).apply(null,arguments)},h._sqlite3_column_text=function(){return(h._sqlite3_column_text=h.asm.ja).apply(null,arguments)},h._sqlite3_column_type=function(){return(h._sqlite3_column_type=h.asm.ka).apply(null,arguments)},h._sqlite3_column_name=function(){return(h._sqlite3_column_name=h.asm.la).apply(null,arguments)},h._sqlite3_bind_blob=function(){return(h._sqlite3_bind_blob=h.asm.ma).apply(null,arguments)},h._sqlite3_bind_double=function(){return(h._sqlite3_bind_double=h.asm.na).apply(null,arguments)},h._sqlite3_bind_int=function(){return(h._sqlite3_bind_int=h.asm.oa).apply(null,arguments)},h._sqlite3_bind_text=function(){return(h._sqlite3_bind_text=h.asm.pa).apply(null,arguments)},h._sqlite3_bind_parameter_index=function(){return(h._sqlite3_bind_parameter_index=h.asm.qa).apply(null,arguments)},h._sqlite3_normalized_sql=function(){return(h._sqlite3_normalized_sql=h.asm.ra).apply(null,arguments)},h._sqlite3_errmsg=function(){return(h._sqlite3_errmsg=h.asm.sa).apply(null,arguments)},h._sqlite3_exec=function(){return(h._sqlite3_exec=h.asm.ta).apply(null,arguments)},h._sqlite3_changes=function(){return(h._sqlite3_changes=h.asm.ua).apply(null,arguments)},h._sqlite3_close_v2=function(){return(h._sqlite3_close_v2=h.asm.va).apply(null,arguments)},h._sqlite3_create_function_v2=function(){return(h._sqlite3_create_function_v2=h.asm.wa).apply(null,arguments)},h._sqlite3_open=function(){return(h._sqlite3_open=h.asm.xa).apply(null,arguments)};var Ds=h._malloc=function(){return(Ds=h._malloc=h.asm.ya).apply(null,arguments)},_s=h._free=function(){return(_s=h._free=h.asm.za).apply(null,arguments)};h._RegisterExtensionFunctions=function(){return(h._RegisterExtensionFunctions=h.asm.Ba).apply(null,arguments)};var Gu=h._emscripten_builtin_memalign=function(){return(Gu=h._emscripten_builtin_memalign=h.asm.Ca).apply(null,arguments)},cn=h.stackSave=function(){return(cn=h.stackSave=h.asm.Da).apply(null,arguments)},hn=h.stackRestore=function(){return(hn=h.stackRestore=h.asm.Ea).apply(null,arguments)},nr=h.stackAlloc=function(){return(nr=h.stackAlloc=h.asm.Fa).apply(null,arguments)};h.UTF8ToString=qe,h.stackAlloc=nr,h.stackSave=cn,h.stackRestore=hn,h.cwrap=function(n,s,o,c){o=o||[];var l=o.every(p=>p==="number"||p==="boolean");return s!=="string"&&l&&!c?h["_"+n]:function(){return Jd(n,s,o,arguments)}};var Rs;tn=function n(){Rs||Ku(),Rs||(tn=n)};function Ku(){function n(){if(!Rs&&(Rs=!0,h.calledRun=!0,!du)){if(h.noFSInit||Qu||(Qu=!0,Fu(),h.stdin=h.stdin,h.stdout=h.stdout,h.stderr=h.stderr,h.stdin?on("stdin",h.stdin):Eo("/dev/tty","/dev/stdin"),h.stdout?on("stdout",null,h.stdout):Eo("/dev/tty","/dev/stdout"),h.stderr?on("stderr",null,h.stderr):Eo("/dev/tty1","/dev/stderr"),mi("/dev/stdin",0),mi("/dev/stdout",1),mi("/dev/stderr",1)),qu=!1,Wo(mu),h.onRuntimeInitialized&&h.onRuntimeInitialized(),h.postRun)for(typeof h.postRun=="function"&&(h.postRun=[h.postRun]);h.postRun.length;){var s=h.postRun.shift();yu.unshift(s)}Wo(yu)}}if(!(0<kr)){if(h.preRun)for(typeof h.preRun=="function"&&(h.preRun=[h.preRun]);h.preRun.length;)Sd();Wo(pu),0<kr||(h.setStatus?(h.setStatus("Running..."),setTimeout(function(){setTimeout(function(){h.setStatus("")},1),n()},1)):n())}}if(h.preInit)for(typeof h.preInit=="function"&&(h.preInit=[h.preInit]);0<h.preInit.length;)h.preInit.pop()();return Ku(),C}),r)};t.exports=u,t.exports.default=u})(Za);var Zh=Za.exports,ed=Kh(Zh),td=""+new URL("sql-wasm-18fc45ef.wasm",self.location.href).href;const rd="sqlitevfs",Ur=new Map,id=2048,nd=65536;class sd{constructor(e){U(this,"_data");U(this,"_size");this._data=e??new Uint8Array,this._size=this._data.length}get size(){return this._size}read(e,r){if(e>=this._size)return 0;const u=this._data.subarray(e,Math.min(this._size,e+r.length));return r.set(u),u.length}reserve(e){if(this._data.length>=e)return;const r=e-this._data.length,u=Math.min(nd,Math.max(id,this._data.length)),d=new Uint8Array(this._data.length+Math.max(u,r));d.set(this._data),this._data=d}write(e,r){return this.reserve(e+r.length),this._data.set(r,e),this._size=Math.max(this._size,e+r.length),r.length}truncate(e){this._size=e}toUint8Array(){return this._data.subarray(0,this._size)}}const od=globalThis.indexedDB||window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,eu=new Promise((t,e)=>{const r=od.open(rd,1);r.onupgradeneeded=()=>r.result.createObjectStore("files",{keyPath:"name"}),r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)});async function ad(t){const e=await eu,r=await new Promise((u,d)=>{const x=e.transaction("files","readonly").objectStore("files").get(t);x.onsuccess=()=>u(x.result),x.onerror=()=>d(x.error)});if(r&&!Ur.has(t)){const u=new sd(r.data);return Ur.set(t,u),u}else return Ur.has(t)?Ur.get(t):null}async function ud(t,e){const r=await eu;await new Promise((u,d)=>{const x=r.transaction("files","readwrite").objectStore("files").put({name:t,data:e});x.onsuccess=()=>u(!0),x.onerror=()=>d(x.error)})}async function cd(t,e){if(await ud(t,e),Ur.has(t)){const r=Ur.get(t);r.truncate(0),r.write(0,e)}}var tu=t=>t==null||typeof t=="bigint"||typeof t=="string"||typeof t=="number"||typeof t=="object"&&"buffer"in t?t:typeof t=="boolean"?`${t}`:t instanceof Date?t.toISOString():JSON.stringify(t),hd=t=>{if(t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t)return t;if(typeof t=="string"){const e=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/;if(/^(true|false)$/.test(t))return t==="true";if(e.test(t))return new Date(t);try{return JSON.parse(t,(r,u)=>typeof u=="string"&&e.exec(u)?new Date(u):u)}catch{}}return t},dd=class extends to{constructor(e){super();U(this,"serializer");this.serializer=e||tu}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:u,...d}=r,m=this.serializer(u);return u===m?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...d,value:m}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},ld=class{constructor({selectOrRawOnly:t,deserializer:e,serializer:r}={}){U(this,"serializeParametersTransformer");U(this,"deserializer");U(this,"only");U(this,"ctx");this.serializeParametersTransformer=new dd(r),this.deserializer=e||hd,this.only=t||!1}transformQuery({node:t,queryId:e}){var r;return this.only&&(t.kind==="SelectQueryNode"||t.kind==="RawNode")&&((r=this.ctx)==null||r.add(e)),this.serializeParametersTransformer.transformNode(t)}async parseResult(t){return t.length?await Promise.all(t.map(async e=>{const r={...e};for(const u in r)r[u]=await this.deserializer(r[u]);return r})):[]}async transformResult({result:t,queryId:e}){var u,d;const r=async()=>({...t,rows:await this.parseResult(t.rows)});return this.only?(u=this.ctx)!=null&&u.has(e)?((d=this.ctx)==null||d.delete(e),await r()):t:await r()}};function fd(t){return`__precomile_${t}`}function pd(t,e=r=>r){return{setParam:r=>{let u;return(d,m)=>{if(!u){const{parameters:x,sql:C,query:P}=r({qb:t,param:fd}).compile();u={sql:C,query:(m==null?void 0:m(P))||{kind:P.kind},parameters:x}}return{...u,parameters:u.parameters.map(x=>typeof x=="string"&&x.startsWith("__precomile_")?e(d[x.slice(12)]):x)}}}}}async function md(t){return(await ne`PRAGMA integrity_check`.execute(t)).rows[0].integrity_check==="ok"}async function yd(t,e){const r=e||`sp_${Date.now()%1e8}`;return await ne`savepoint ${ne.raw(r)}`.execute(t),{release:async()=>{await ne`release savepoint ${ne.raw(r)}`.execute(t)},rollback:async()=>{await ne`rollback to savepoint ${ne.raw(r)}`.execute(t)}}}function ru(t){const{logger:e,merge:r,queryNode:u}=t;return d=>{const{level:m,queryDurationMillis:x,query:{parameters:C,sql:P,query:h}}=d,oe=m==="error"?d.error:void 0;let q=P.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&C.forEach(Ge=>{q=q.replace("?",JSON.stringify(Ge))});const Z={sql:q,params:C,duration:x,error:oe};u&&(Z.queryNode=h),e(Z)}}var Nd=class extends Error{constructor(){super("db file maybe broken")}};function wd(t){return t.toOperationNode().kind==="SelectQueryNode"}var vd=class{constructor(t){U(this,"kysely");U(this,"trxCount",0);U(this,"trx");U(this,"logger");U(this,"serializer",tu);const{dialect:e,logger:r,onQuery:u,plugins:d=[],serializerPluginOptions:m}=t;this.logger=r,m!=null&&m.serializer&&(this.serializer=m.serializer),d.push(new ld(m));let x;u===!0?x=ru({logger:console.log,merge:!0}):u&&(x=ru(u)),this.kysely=new Ei({dialect:e,log:x,plugins:d})}async updateTables(t,e){var r,u;try{if(e&&!await md(this.kysely))return(r=this.logger)==null||r.error("integrity check fail"),{ready:!1,error:new Nd};await t(this.kysely,this.logger)}catch(d){return this.logError(d,"sync table fail"),{ready:!1,error:d}}return(u=this.logger)==null||u.info("table updated"),{ready:!0}}getDB(){return this.trx||this.kysely}logError(t,e){var r;e&&((r=this.logger)==null||r.error(e,t instanceof Error?t:void 0))}async transaction(t,e){var d;if(!this.trx)try{return await this.kysely.transaction().execute(async m=>{var C;return this.trx=m,(C=this.logger)==null||C.debug("run in transaction"),await t(m)})}catch(m){this.logError(m,e);return}finally{this.trx=void 0}this.trxCount++;const r=this.getDB(),u=await yd(r,`sp_${this.trxCount}`);(d=this.logger)==null||d.debug(`run in savepoint:${this.trxCount}`);try{const m=await t(r);return await u.release(),this.trxCount--,m}catch(m){await u.rollback(),this.logError(m,e),this.trxCount--;return}}async execute(t,e){try{return await t(this.getDB()).execute()}catch(r){this.logError(r,e);return}}async executeTakeFirst(t,e){try{let r=t(this.getDB());return wd(r)&&(r=r.limit(1)),await r.executeTakeFirstOrThrow()}catch(r){this.logError(r,e);return}}precompile(t){var e,r;return(r=(e=this.logger)==null?void 0:e.debug)==null||r.call(e,"precompile"),pd(t(this.kysely),this.serializer)}async executeCompiled(t,e){try{return await this.getDB().executeQuery(t)}catch(r){this.logError(r,e);return}}async executeCompiledTakeList(t,e){const r=await this.executeCompiled(t,e);return r==null?void 0:r.rows}async raw(t,e){try{return typeof t=="string"?await this.getDB().executeQuery(ur.raw(t)):await t.execute(this.getDB())}catch(r){this.logError(r,e);return}}async destroy(){var t;(t=this.logger)==null||t.info("destroyed"),await this.kysely.destroy(),this.trx=void 0}},iu="__TIME_TRIGGER__";function bd(t,e){const{create:r,update:u}=(e==null?void 0:e.timeTrigger)||{},d={type:"date",defaultTo:iu};return r===!0?t.createAt=d:r&&(t[r]=d),u===!0?t.updateAt={...d,notNull:0}:u&&(t[u]={...d,notNull:0}),{columns:t,...e}}function nu(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function mo(t){return Array.isArray(t)?t:[t]}function gd(t){return typeof t=="function"}async function es(t,e){await t.schema.dropTable(e).execute()}async function su(t,e,r){const{index:u,...d}=r;await t.transaction().execute(async m=>{const x=await yo(m,e,d);await au(m,e,x),await ou(m,e,u)})}async function ou(t,e,r){for(const u of r||[]){const d=mo(u);await t.schema.createIndex(`idx_${e}_${d.join("_")}`).on(e).columns(d).ifNotExists().execute()}}async function yo(t,e,{columns:r,primary:u,timeTrigger:d,unique:m},x=!1){const C=d?{triggerKey:"rowid",update:void 0}:void 0;let P=!1,h=t.schema.createTable(e);x&&(h=h.temporary());for(const[oe,q]of Object.entries(r)){let Z="text";const{type:Ge,notNull:wt,defaultTo:xe}=q,Ae=nu(Ge);Z=Ae.dataType,h=h.addColumn(oe,Z,Oe=>Ae.isIncrements?(P=!0,C&&(C.triggerKey=oe),Oe.autoIncrement().primaryKey()):xe===iu?(C&&wt===0&&(C.update=oe),Oe.defaultTo(ne`CURRENT_TIMESTAMP`)):(wt&&(Oe=Oe.notNull()),xe!==void 0&&(Oe=Oe.defaultTo(gd(xe)?xe(ne):xe)),Oe))}if(!P&&u){const oe=mo(u);h=h.addPrimaryKeyConstraint(`pk#${oe.join("#")}`,oe)}for(const oe of m||[]){const q=mo(oe);h=h.addUniqueConstraint(`un#${q.join("#")}`,q)}return await h.ifNotExists().execute(),C}async function au(t,e,r){if(!r||!r.update)return;const{triggerKey:u,update:d}=r,m=`tgr_${e}_${d}`;await ne`create trigger if not exists ${ne.ref(m)}
after update
on ${ne.table(e)}
begin
  update ${ne.table(e)}
  set ${ne.ref(d)} = CURRENT_TIMESTAMP
  where ${ne.ref(u)} = NEW.${ne.ref(u)};
end`.execute(t)}function xd(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/g,[,u,d]=t.replace(/\r\n?/g,"").match(e),m={columns:{},name:u,primary:void 0,unique:[]},x=d.matchAll(r);for(const C of x){const[,P,h,oe]=C;if(P.startsWith("pk#")){const[,...q]=P.split("#");m.primary=q}else if(P.startsWith("un#")){const[,...q]=P.split("#");m.unique.push(q)}else m.columns[P]={type:h,notNull:!!oe}}return m}async function Od(t,e=[]){const r=await t.selectFrom("sqlite_master").where(({eb:d,and:m})=>{const x=m([d("type","in",["table","trigger","index"]),d("name","!=",Ya),d("name","!=",Xa),d("name","not like","sqlite_%")]);return e.forEach(C=>x.and("name","not like",`${C}%`)),x}).select(["name","sql","type"]).$castTo().execute(),u={existTables:{},indexList:[],triggerList:[]};for(const{name:d,sql:m,type:x}of r)m&&(x==="table"?u.existTables[d]=xd(m):x==="index"?u.indexList.push(d):u.triggerList.push(d));return u}async function qd(t,e,r={},u){u==null||u.debug("====== sync tables start ======");const{existTables:d,indexList:m,triggerList:x}=await Od(t),{reserveOldData:C,truncateIfExists:P=[]}=r,h=new Set(Array.isArray(P)?P:P?Object.keys(d):[]);for(const q of m)await t.schema.dropIndex(q).ifExists().execute();for(const q of x)await ne`drop trigger if exists ${ne.ref(q)}`.execute(t);for(const[q,Z]of Object.entries(d))q in e?(u==null||u.debug(`diff table: ${q}`),await oe(q,Z,e[q])):(u==null||u.debug(`remove table: ${q}`),await es(t,q));for(const[q,Z]of Object.entries(e))q in d||(u==null||u.debug(`create table: ${q}`),await su(t,q,Z));u==null||u.debug("======= sync tables end =======");async function oe(q,Z,Ge){if(h.has(q)){await t.transaction().execute(async le=>{await es(le,q),await su(le,q,Ge),u==null||u.debug("clear and sync structure")});return}const{index:wt,...xe}=Ge,Ae=[],Oe=Cd(Z.columns,Ge.columns);if(Oe.length===Object.keys(Z.columns).length){u==null||u.debug("same table structure, skip");return}u==null||u.debug("different table structure, update"),await t.transaction().execute(async le=>{const Le=`_temp_${q}`;await yo(le,Le,Z,!0),Ae.push(`copy table ${q} structure to ${Le}`),await le.insertInto(Le).expression(qr=>qr.selectFrom(q).selectAll()).execute(),Ae.push(`copy table ${q} all data to ${Le}`),await es(le,q),Ae.push(`remove table ${q}`);const li=await yo(le,q,xe);Ae.push(`create table ${q}`),Oe.length&&(await le.insertInto(q).columns(Oe).expression(qr=>qr.selectFrom(Le).select(Oe)).execute(),Ae.push(`copy columns: ${JSON.stringify(Oe)}`)),await ou(le,q,wt),await au(le,q,li),Ae.push(`add index and trigger for ${q}`),C||(await es(le,Le),Ae.push(`remove temporary table ${Le}`))}).then(()=>{var le;return(le=u==null?void 0:u.trace)==null?void 0:le.call(u,Ae.join(`
`))}).catch(le=>{var Le;(Le=u==null?void 0:u.trace)==null||Le.call(u,Ae.join(`
`)),u==null||u.error(`fail to sync ${q}`,le)})}}function Cd(t,e){const r=[];for(const[u,d]of Object.entries(e))if(u in t){const{type:m,notNull:x=!1}=t[u];nu(d.type).dataType===m&&(d.notNull||!1)===x&&r.push(u)}return r}function Wd(t,e={}){const{logger:r,...u}=e;return async(d,m)=>{await qd(d,t,u,r?m:void 0)}}const kd={test:bd({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function Td(t){const e=new vd({dialect:t}),r=await e.updateTables(Wd(kd));if(!r.ready)throw r.error;console.log("test"),console.log(await e.raw(ne`PRAGMA table_info(${ne.table("test")});`)),console.log(await e.raw(ne`select last_insert_rowid()`));for(let u=0;u<10;u++)await e.transaction(async d=>{await d.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}).execute()});return e.execute(u=>u.selectFrom("test").selectAll())}const Id=new Gh({async database(){const t=await ed({locateFile:()=>td});return new t.Database(await ad("sqlijsWorker"))},onWrite:{func(t){console.log(`[sqljs worker] write to indexeddb, length: ${t.length}`),cd("sqlijsWorker",t)}}});onmessage=()=>{console.log("start sqljs test"),Td(Id).then(t=>{t==null||t.forEach(e=>console.log("[sqlijs]",e))})}})();
