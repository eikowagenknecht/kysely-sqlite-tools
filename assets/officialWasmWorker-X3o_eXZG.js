var lu=Object.defineProperty;var cu=(t,e,r)=>e in t?lu(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var We=(t,e,r)=>(cu(t,typeof e!="symbol"?e+"":e,r),r),fo=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var s=(t,e,r)=>(fo(t,e,"read from private field"),r?r.call(t):e.get(t)),M=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},H=(t,e,r,n)=>(fo(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var ke=(t,e,r)=>(fo(t,e,"access private method"),r);function dr(t){return typeof t>"u"||t===void 0}function Bt(t){return typeof t=="string"}function Za(t){return typeof t=="number"}function es(t){return typeof t=="boolean"}function Wo(t){return t===null}function uu(t){return t instanceof Date}function du(t){return typeof t=="bigint"}function Wt(t){return typeof t=="function"}function nn(t){return typeof t=="object"&&t!==null}function p(t){return Object.freeze(t)}function zi(t){return gn(t)?t:[t]}function gn(t){return Array.isArray(t)}function Dn(t){return t}const Me=p({is(t){return t.kind==="AlterTableNode"},create(t){return p({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return p({...t,...e})},cloneWithColumnAlteration(t,e){return p({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),Je=p({is(t){return t.kind==="IdentifierNode"},create(t){return p({kind:"IdentifierNode",name:t})}}),cn=p({is(t){return t.kind==="CreateIndexNode"},create(t){return p({kind:"CreateIndexNode",name:Je.create(t)})},cloneWith(t,e){return p({...t,...e})},cloneWithColumns(t,e){return p({...t,columns:[...t.columns||[],...e]})}}),el=p({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return p({kind:"CreateSchemaNode",schema:Je.create(t),...e})},cloneWith(t,e){return p({...t,...e})}}),fu=["preserve rows","delete rows","drop"],kt=p({is(t){return t.kind==="CreateTableNode"},create(t){return p({kind:"CreateTableNode",table:t,columns:p([])})},cloneWithColumn(t,e){return p({...t,columns:p([...t.columns,e])})},cloneWithConstraint(t,e){return p({...t,constraints:t.constraints?p([...t.constraints,e]):p([e])})},cloneWithFrontModifier(t,e){return p({...t,frontModifiers:t.frontModifiers?p([...t.frontModifiers,e]):p([e])})},cloneWithEndModifier(t,e){return p({...t,endModifiers:t.endModifiers?p([...t.endModifiers,e]):p([e])})},cloneWith(t,e){return p({...t,...e})}}),Rn=p({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return p({kind:"SchemableIdentifierNode",identifier:Je.create(t)})},createWithSchema(t,e){return p({kind:"SchemableIdentifierNode",schema:Je.create(t),identifier:Je.create(e)})}}),ni=p({is(t){return t.kind==="DropIndexNode"},create(t,e){return p({kind:"DropIndexNode",name:Rn.create(t),...e})},cloneWith(t,e){return p({...t,...e})}}),_o=p({is(t){return t.kind==="DropSchemaNode"},create(t,e){return p({kind:"DropSchemaNode",schema:Je.create(t),...e})},cloneWith(t,e){return p({...t,...e})}}),mo=p({is(t){return t.kind==="DropTableNode"},create(t,e){return p({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return p({...t,...e})}}),Un=p({is(t){return t.kind==="AliasNode"},create(t,e){return p({kind:"AliasNode",node:t,alias:e})}}),Ln=p({is(t){return t.kind==="TableNode"},create(t){return p({kind:"TableNode",table:Rn.create(t)})},createWithSchema(t,e){return p({kind:"TableNode",table:Rn.createWithSchema(t,e)})}});function Dt(t){return nn(t)&&Wt(t.toOperationNode)}function hu(t){return nn(t)&&"expressionType"in t&&Dt(t)}function pu(t){return nn(t)&&"expression"in t&&Bt(t.alias)&&Dt(t)}const ln=p({is(t){return t.kind==="SelectModifierNode"},create(t,e){return p({kind:"SelectModifierNode",modifier:t,of:e})},createWithExpression(t){return p({kind:"SelectModifierNode",rawModifier:t})}}),Bn=p({is(t){return t.kind==="AndNode"},create(t,e){return p({kind:"AndNode",left:t,right:e})}}),Hr=p({is(t){return t.kind==="OrNode"},create(t,e){return p({kind:"OrNode",left:t,right:e})}}),ho=p({is(t){return t.kind==="OnNode"},create(t){return p({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return p({...t,on:e==="And"?Bn.create(t.on,r):Hr.create(t.on,r)})}}),ri=p({is(t){return t.kind==="JoinNode"},create(t,e){return p({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return p({kind:"JoinNode",joinType:t,table:e,on:ho.create(r)})},cloneWithOn(t,e){return p({...t,on:t.on?ho.cloneWithOperation(t.on,"And",e):ho.create(e)})}}),jr=p({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return p({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),_u=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],mu=["+","-","*","/","%","^","&","|","#","<<",">>"],tl=["->","->>"],yu=[..._u,...mu,"&&","||"],gu=["exists","not exists"],wu=["not","-",...gu],bu=[...yu,...tl,...wu,"between","between symmetric"],Mn=p({is(t){return t.kind==="OperatorNode"},create(t){return p({kind:"OperatorNode",operator:t})}});function va(t){return Bt(t)&&tl.includes(t)}const et=p({is(t){return t.kind==="ColumnNode"},create(t){return p({kind:"ColumnNode",column:Je.create(t)})}}),Do=p({is(t){return t.kind==="SelectAllNode"},create(){return p({kind:"SelectAllNode"})}}),eo=p({is(t){return t.kind==="ReferenceNode"},create(t,e){return p({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return p({kind:"ReferenceNode",table:t,column:Do.create()})}});var vr;class qu{constructor(e){M(this,vr,void 0);H(this,vr,e)}get dynamicReference(){return s(this,vr)}get refType(){}toOperationNode(){return ol(s(this,vr))}}vr=new WeakMap;function nl(t){return nn(t)&&Dt(t)&&Bt(t.dynamicReference)}const yo=p({is(t){return t.kind==="OrderByItemNode"},create(t,e){return p({kind:"OrderByItemNode",orderBy:t,direction:e})}}),wt=p({is(t){return t.kind==="RawNode"},create(t,e){return p({kind:"RawNode",sqlFragments:p(t),parameters:p(e)})},createWithSql(t){return wt.create([t],[])},createWithChild(t){return wt.create(["",""],[t])},createWithChildren(t){return wt.create(new Array(t.length+1).fill(""),t)}});function rl(t){return t==="asc"||t==="desc"}function to(t){if(t.length===2)return[po(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>po(r)):[po(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function po(t,e){const r=Nu(t);if(yo.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return yo.create(r,il(e))}function Nu(t){if(Ri(t))return hr(t);if(nl(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!rl(r))throw new Error(`Invalid order by direction: ${r}`);return yo.create(wn(e),il(r))}return wn(t)}function il(t){if(t)return t==="asc"||t==="desc"?wt.createWithSql(t):t.toOperationNode()}const ts=p({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return p({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return p({...t,traversal:e})}}),sl=p({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return p({kind:"JSONOperatorChainNode",operator:t,values:p([])})},cloneWithValue(t,e){return p({...t,values:p([...t.values,e])})}}),ii=p({is(t){return t.kind==="JSONPathNode"},create(t){return p({kind:"JSONPathNode",inOperator:t,pathLegs:p([])})},cloneWithLeg(t,e){return p({...t,pathLegs:p([...t.pathLegs,e])})}});function ol(t){return Bt(t)?wn(t):t.toOperationNode()}function _i(t){return gn(t)?t.map(e=>Rt(e)):[Rt(t)]}function Rt(t){return Ri(t)?hr(t):ol(t)}function vu(t,e){const r=wn(t);if(va(e))return ts.create(r,sl.create(Mn.create(e)));const n=e.slice(0,-1);if(va(n))return ts.create(r,ii.create(Mn.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function wn(t){const e=".";if(!t.includes(e))return eo.create(et.create(t));const r=t.split(e).map(Lo);if(r.length===3)return Eu(r);if(r.length===2)return Su(r);throw new Error(`invalid column reference ${t}`)}function xu(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(Lo);return Un.create(wn(r),Je.create(n))}else return wn(t)}function al(t){return et.create(t)}function ns(t){const e=" ";if(t.includes(e)){const[r,n]=t.split(e).map(Lo);if(!rl(n))throw new Error(`invalid order direction "${n}" next to "${r}"`);return to([r,n])[0]}else return al(t)}function Eu(t){const[e,r,n]=t;return eo.create(et.create(n),Ln.createWithSchema(e,r))}function Su(t){const[e,r]=t;return eo.create(et.create(r),Ln.create(e))}function Lo(t){return t.trim()}const ll=p({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return p({kind:"PrimitiveValueListNode",values:p([...t])})}}),Ro=p({is(t){return t.kind==="ValueListNode"},create(t){return p({kind:"ValueListNode",values:p(t)})}}),bn=p({is(t){return t.kind==="ValueNode"},create(t){return p({kind:"ValueNode",value:t})},createImmediate(t){return p({kind:"ValueNode",value:t,immediate:!0})}});function Au(t){return gn(t)?Iu(t):ct(t)}function ct(t){return Ri(t)?hr(t):bn.create(t)}function Bo(t){return Za(t)||es(t)||Wo(t)}function Mo(t){if(!Bo(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return bn.createImmediate(t)}function Iu(t){return t.some(Ri)?Ro.create(t.map(e=>ct(e))):ll.create(t)}const zr=p({is(t){return t.kind==="ParensNode"},create(t){return p({kind:"ParensNode",node:t})}});function bt(t){if(t.length===3)return Qo(t[0],t[1],t[2]);if(t.length===1)return ct(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function Qo(t,e,r){return ku(e)&&cl(r)?jr.create(Rt(t),wo(e),bn.createImmediate(r)):jr.create(Rt(t),wo(e),Au(r))}function qn(t,e,r){return jr.create(Rt(t),wo(e),Rt(r))}function xa(t,e){return go(Object.entries(t).filter(([,r])=>!dr(r)).map(([r,n])=>Qo(r,cl(n)?"is":"=",n)),e)}function go(t,e){const r=e==="and"?Bn.create:Hr.create;if(t.length===0)return jr.create(bn.createImmediate(1),Mn.create("="),bn.createImmediate(e==="and"?1:0));let n=Ea(t[0]);for(let A=1;A<t.length;++A)n=r(n,Ea(t[A]));return t.length>1?zr.create(n):n}function ku(t){return t==="is"||t==="is not"}function cl(t){return Wo(t)||es(t)}function wo(t){if(Bt(t)&&bu.includes(t))return Mn.create(t);if(Dt(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Ea(t){return Dt(t)?t.toOperationNode():t}const Vr=p({is(t){return t.kind==="OrderByNode"},create(t){return p({kind:"OrderByNode",items:p([...t])})},cloneWithItems(t,e){return p({...t,items:p([...t.items,...e])})}}),Sa=p({is(t){return t.kind==="PartitionByNode"},create(t){return p({kind:"PartitionByNode",items:p(t)})},cloneWithItems(t,e){return p({...t,items:p([...t.items,...e])})}}),bo=p({is(t){return t.kind==="OverNode"},create(){return p({kind:"OverNode"})},cloneWithOrderByItems(t,e){return p({...t,orderBy:t.orderBy?Vr.cloneWithItems(t.orderBy,e):Vr.create(e)})},cloneWithPartitionByItems(t,e){return p({...t,partitionBy:t.partitionBy?Sa.cloneWithItems(t.partitionBy,e):Sa.create(e)})}}),rs=p({is(t){return t.kind==="FromNode"},create(t){return p({kind:"FromNode",froms:p(t)})},cloneWithFroms(t,e){return p({...t,froms:p([...t.froms,...e])})}}),Aa=p({is(t){return t.kind==="GroupByNode"},create(t){return p({kind:"GroupByNode",items:p(t)})},cloneWithItems(t,e){return p({...t,items:p([...t.items,...e])})}}),Ia=p({is(t){return t.kind==="HavingNode"},create(t){return p({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return p({...t,having:e==="And"?Bn.create(t.having,r):Hr.create(t.having,r)})}}),Ie=p({is(t){return t.kind==="SelectQueryNode"},create(t){return p({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return p({kind:"SelectQueryNode",from:rs.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return p({...t,selections:t.selections?p([...t.selections,...e]):p(e)})},cloneWithDistinctOn(t,e){return p({...t,distinctOn:t.distinctOn?p([...t.distinctOn,...e]):p(e)})},cloneWithFrontModifier(t,e){return p({...t,frontModifiers:t.frontModifiers?p([...t.frontModifiers,e]):p([e])})},cloneWithEndModifier(t,e){return p({...t,endModifiers:t.endModifiers?p([...t.endModifiers,e]):p([e])})},cloneWithOrderByItems(t,e){return p({...t,orderBy:t.orderBy?Vr.cloneWithItems(t.orderBy,e):Vr.create(e)})},cloneWithGroupByItems(t,e){return p({...t,groupBy:t.groupBy?Aa.cloneWithItems(t.groupBy,e):Aa.create(e)})},cloneWithLimit(t,e){return p({...t,limit:e})},cloneWithOffset(t,e){return p({...t,offset:e})},cloneWithHaving(t,e){return p({...t,having:t.having?Ia.cloneWithOperation(t.having,"And",e):Ia.create(e)})},cloneWithSetOperations(t,e){return p({...t,setOperations:t.setOperations?p([...t.setOperations,...e]):p([...e])})},cloneWithoutSelections(t){return p({...t,selections:[]})},cloneWithoutLimit(t){return p({...t,limit:void 0})},cloneWithoutOffset(t){return p({...t,offset:void 0})},cloneWithoutOrderBy(t){return p({...t,orderBy:void 0})}});function Se(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Ut;const li=class li{constructor(e){M(this,Ut,void 0);H(this,Ut,p(e))}on(...e){return new li({...s(this,Ut),joinNode:ri.cloneWithOn(s(this,Ut).joinNode,bt(e))})}onRef(e,r,n){return new li({...s(this,Ut),joinNode:ri.cloneWithOn(s(this,Ut).joinNode,qn(e,r,n))})}onTrue(){return new li({...s(this,Ut),joinNode:ri.cloneWithOn(s(this,Ut).joinNode,wt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return s(this,Ut).joinNode}};Ut=new WeakMap;let is=li;Se(is,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const Ou=p({is(t){return t.kind==="PartitionByItemNode"},create(t){return p({kind:"PartitionByItemNode",partitionBy:t})}});function Tu(t){return _i(t).map(Ou.create)}var Yn;const Cs=class Cs{constructor(e){M(this,Yn,void 0);H(this,Yn,p(e))}orderBy(e,r){return new Cs({overNode:bo.cloneWithOrderByItems(s(this,Yn).overNode,to([e,r]))})}partitionBy(e){return new Cs({overNode:bo.cloneWithPartitionByItems(s(this,Yn).overNode,Tu(e))})}$call(e){return e(this)}toOperationNode(){return s(this,Yn).overNode}};Yn=new WeakMap;let ss=Cs;Se(ss,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const si=p({is(t){return t.kind==="SelectionNode"},create(t){return p({kind:"SelectionNode",selection:t})},createSelectAll(){return p({kind:"SelectionNode",selection:Do.create()})},createSelectAllFromTable(t){return p({kind:"SelectionNode",selection:eo.createSelectAll(t)})}});function Jr(t){return Wt(t)?Jr(t(Gr())):gn(t)?t.map(e=>ka(e)):[ka(t)]}function ka(t){return Bt(t)?si.create(xu(t)):nl(t)?si.create(t.toOperationNode()):si.create(xl(t))}function Di(t){return t?Array.isArray(t)?t.map(Oa):[Oa(t)]:[si.createSelectAll()]}function Oa(t){if(Bt(t))return si.createSelectAllFromTable(Ze(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const Cu=p({is(t){return t.kind==="ValuesNode"},create(t){return p({kind:"ValuesNode",values:p(t)})}}),Pu=p({is(t){return t.kind==="DefaultInsertValueNode"},create(){return p({kind:"DefaultInsertValueNode"})}});function Fu(t){const e=Wt(t)?t(Gr()):t,r=gn(e)?e:p([e]);return Wu(r)}function Wu(t){const e=Du(t);return[p([...e.keys()].map(et.create)),Cu.create(t.map(r=>Lu(r,e)))]}function Du(t){const e=new Map;for(const r of t){const n=Object.keys(r);for(const A of n)!e.has(A)&&r[A]!==void 0&&e.set(A,e.size)}return e}function Lu(t,e){const r=Object.keys(t),n=Array.from({length:e.size});let A=!1;for(const te of r){const Ae=e.get(te);if(dr(Ae))continue;const Le=t[te];(dr(Le)||Ri(Le))&&(A=!0),n[Ae]=Le}if(r.length<e.size||A){const te=Pu.create();return Ro.create(n.map(Ae=>dr(Ae)?te:ct(Ae)))}return ll.create(n)}const Jt=p({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return p({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return p({...t,...e})}}),os=p({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return p({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return p({...t,from:t.from?rs.cloneWithFroms(t.from,e):rs.create(e)})},cloneWithUpdates(t,e){return p({...t,updates:t.updates?p([...t.updates,...e]):e})}}),Ta=p({is(t){return t.kind==="UsingNode"},create(t){return p({kind:"UsingNode",tables:p(t)})},cloneWithTables(t,e){return p({...t,tables:p([...t.tables,...e])})}}),oi=p({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return p({kind:"DeleteQueryNode",from:rs.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return p({...t,orderBy:t.orderBy?Vr.cloneWithItems(t.orderBy,e):Vr.create(e)})},cloneWithLimit(t,e){return p({...t,limit:e})},cloneWithUsing(t,e){return p({...t,using:t.using!==void 0?Ta.cloneWithTables(t.using,e):Ta.create(e)})}}),St=p({is(t){return t.kind==="WhereNode"},create(t){return p({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return p({...t,where:e==="And"?Bn.create(t.where,r):Hr.create(t.where,r)})}}),Ca=p({is(t){return t.kind==="ReturningNode"},create(t){return p({kind:"ReturningNode",selections:p(t)})},cloneWithSelections(t,e){return p({...t,selections:t.selections?p([...t.selections,...e]):p(e)})}}),Ru=p({is(t){return t.kind==="ExplainNode"},create(t,e){return p({kind:"ExplainNode",format:t,options:e})}}),xe=p({is(t){return Ie.is(t)||Jt.is(t)||os.is(t)||oi.is(t)},cloneWithWhere(t,e){return p({...t,where:t.where?St.cloneWithOperation(t.where,"And",e):St.create(e)})},cloneWithJoin(t,e){return p({...t,joins:t.joins?p([...t.joins,e]):p([e])})},cloneWithReturning(t,e){return p({...t,returning:t.returning?Ca.cloneWithSelections(t.returning,e):Ca.create(e)})},cloneWithoutWhere(t){return p({...t,where:void 0})},cloneWithExplain(t,e,r){return p({...t,explain:Ru.create(e,r?.toOperationNode())})}}),ul=p({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return p({kind:"ColumnUpdateNode",column:t,value:e})}});function Bu(...t){return t.length===2?[ul.create(Rt(t[0]),ct(t[1]))]:Uo(t[0])}function Uo(t){const e=Wt(t)?t(Gr()):t;return Object.entries(e).filter(([r,n])=>n!==void 0).map(([r,n])=>ul.create(et.create(r),ct(n)))}const Mu=p({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return p({kind:"OnDuplicateKeyNode",updates:t})}});class Qu{constructor(e,r){We(this,"insertId");We(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class no extends Error{constructor(r){super("no result");We(this,"node");this.node=r}}function ro(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Ft=p({is(t){return t.kind==="OnConflictNode"},create(){return p({kind:"OnConflictNode"})},cloneWith(t,e){return p({...t,...e})},cloneWithIndexWhere(t,e){return p({...t,indexWhere:t.indexWhere?St.cloneWithOperation(t.indexWhere,"And",e):St.create(e)})},cloneWithIndexOrWhere(t,e){return p({...t,indexWhere:t.indexWhere?St.cloneWithOperation(t.indexWhere,"Or",e):St.create(e)})},cloneWithUpdateWhere(t,e){return p({...t,updateWhere:t.updateWhere?St.cloneWithOperation(t.updateWhere,"And",e):St.create(e)})},cloneWithUpdateOrWhere(t,e){return p({...t,updateWhere:t.updateWhere?St.cloneWithOperation(t.updateWhere,"Or",e):St.create(e)})},cloneWithoutIndexWhere(t){return p({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return p({...t,updateWhere:void 0})}});var ze;const dn=class dn{constructor(e){M(this,ze,void 0);H(this,ze,p(e))}column(e){const r=et.create(e);return new dn({...s(this,ze),onConflictNode:Ft.cloneWith(s(this,ze).onConflictNode,{columns:s(this,ze).onConflictNode.columns?p([...s(this,ze).onConflictNode.columns,r]):p([r])})})}columns(e){const r=e.map(et.create);return new dn({...s(this,ze),onConflictNode:Ft.cloneWith(s(this,ze).onConflictNode,{columns:s(this,ze).onConflictNode.columns?p([...s(this,ze).onConflictNode.columns,...r]):p(r)})})}constraint(e){return new dn({...s(this,ze),onConflictNode:Ft.cloneWith(s(this,ze).onConflictNode,{constraint:Je.create(e)})})}expression(e){return new dn({...s(this,ze),onConflictNode:Ft.cloneWith(s(this,ze).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new dn({...s(this,ze),onConflictNode:Ft.cloneWithIndexWhere(s(this,ze).onConflictNode,bt(e))})}whereRef(e,r,n){return new dn({...s(this,ze),onConflictNode:Ft.cloneWithIndexWhere(s(this,ze).onConflictNode,qn(e,r,n))})}clearWhere(){return new dn({...s(this,ze),onConflictNode:Ft.cloneWithoutIndexWhere(s(this,ze).onConflictNode)})}doNothing(){return new dl({...s(this,ze),onConflictNode:Ft.cloneWith(s(this,ze).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new ls({...s(this,ze),onConflictNode:Ft.cloneWith(s(this,ze).onConflictNode,{updates:Uo(e)})})}$call(e){return e(this)}};ze=new WeakMap;let as=dn;Se(as,"don't await OnConflictBuilder instances.");var Ni;class dl{constructor(e){M(this,Ni,void 0);H(this,Ni,p(e))}toOperationNode(){return s(this,Ni).onConflictNode}}Ni=new WeakMap;Se(dl,"don't await OnConflictDoNothingBuilder instances.");var jt;const ci=class ci{constructor(e){M(this,jt,void 0);H(this,jt,p(e))}where(...e){return new ci({...s(this,jt),onConflictNode:Ft.cloneWithUpdateWhere(s(this,jt).onConflictNode,bt(e))})}whereRef(e,r,n){return new ci({...s(this,jt),onConflictNode:Ft.cloneWithUpdateWhere(s(this,jt).onConflictNode,qn(e,r,n))})}clearWhere(){return new ci({...s(this,jt),onConflictNode:Ft.cloneWithoutUpdateWhere(s(this,jt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return s(this,jt).onConflictNode}};jt=new WeakMap;let ls=ci;Se(ls,"don't await OnConflictUpdateBuilder instances.");var Ne;const ft=class ft{constructor(e){M(this,Ne,void 0);H(this,Ne,p(e))}values(e){const[r,n]=Fu(e);return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{columns:r,values:n})})}columns(e){return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{columns:p(e.map(et.create))})})}expression(e){return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{values:hr(e)})})}defaultValues(){return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{defaultValues:!0})})}ignore(){return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{ignore:!0})})}onConflict(e){return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{onConflict:e(new as({onConflictNode:Ft.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new ft({...s(this,Ne),queryNode:Jt.cloneWith(s(this,Ne).queryNode,{onDuplicateKey:Mu.create(Uo(e))})})}returning(e){return new ft({...s(this,Ne),queryNode:xe.cloneWithReturning(s(this,Ne).queryNode,Jr(e))})}returningAll(){return new ft({...s(this,Ne),queryNode:xe.cloneWithReturning(s(this,Ne).queryNode,Di())})}$call(e){return e(this)}$if(e,r){return e?r(this):new ft({...s(this,Ne)})}$castTo(){return new ft(s(this,Ne))}$narrowType(){return new ft(s(this,Ne))}$assertType(){return new ft(s(this,Ne))}withPlugin(e){return new ft({...s(this,Ne),executor:s(this,Ne).executor.withPlugin(e)})}toOperationNode(){return s(this,Ne).executor.transformQuery(s(this,Ne).queryNode,s(this,Ne).queryId)}compile(){return s(this,Ne).executor.compileQuery(this.toOperationNode(),s(this,Ne).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,Ne).executor.executeQuery(e,s(this,Ne).queryId);return s(this,Ne).executor.adapter.supportsReturning&&r.returning?n.rows:[new Qu(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=no){const r=await this.executeTakeFirst();if(r===void 0)throw ro(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,Ne).executor.stream(r,e,s(this,Ne).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new ft({...s(this,Ne),queryNode:xe.cloneWithExplain(s(this,Ne).queryNode,e,r)}).execute()}};Ne=new WeakMap;let mi=ft;Se(mi,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Uu{constructor(e){We(this,"numDeletedRows");this.numDeletedRows=e}}const fl=p({is(t){return t.kind==="LimitNode"},create(t){return p({kind:"LimitNode",limit:t})}});var pe;const rt=class rt{constructor(e){M(this,pe,void 0);H(this,pe,p(e))}where(...e){return new rt({...s(this,pe),queryNode:xe.cloneWithWhere(s(this,pe).queryNode,bt(e))})}whereRef(e,r,n){return new rt({...s(this,pe),queryNode:xe.cloneWithWhere(s(this,pe).queryNode,qn(e,r,n))})}clearWhere(){return new rt({...s(this,pe),queryNode:xe.cloneWithoutWhere(s(this,pe).queryNode)})}using(e){return new rt({...s(this,pe),queryNode:oi.cloneWithUsing(s(this,pe).queryNode,yi(e))})}innerJoin(...e){return new rt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,At("InnerJoin",e))})}leftJoin(...e){return new rt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,At("LeftJoin",e))})}rightJoin(...e){return new rt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,At("RightJoin",e))})}fullJoin(...e){return new rt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,At("FullJoin",e))})}returning(e){return new rt({...s(this,pe),queryNode:xe.cloneWithReturning(s(this,pe).queryNode,Jr(e))})}returningAll(e){return new rt({...s(this,pe),queryNode:xe.cloneWithReturning(s(this,pe).queryNode,Di(e))})}orderBy(e,r){return new rt({...s(this,pe),queryNode:oi.cloneWithOrderByItems(s(this,pe).queryNode,to([e,r]))})}limit(e){return new rt({...s(this,pe),queryNode:oi.cloneWithLimit(s(this,pe).queryNode,fl.create(ct(e)))})}$call(e){return e(this)}$if(e,r){return e?r(this):new rt({...s(this,pe)})}$castTo(){return new rt(s(this,pe))}$narrowType(){return new rt(s(this,pe))}$assertType(){return new rt(s(this,pe))}withPlugin(e){return new rt({...s(this,pe),executor:s(this,pe).executor.withPlugin(e)})}toOperationNode(){return s(this,pe).executor.transformQuery(s(this,pe).queryNode,s(this,pe).queryId)}compile(){return s(this,pe).executor.compileQuery(this.toOperationNode(),s(this,pe).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,pe).executor.executeQuery(e,s(this,pe).queryId);return s(this,pe).executor.adapter.supportsReturning&&r.returning?n.rows:[new Uu(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=no){const r=await this.executeTakeFirst();if(r===void 0)throw ro(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,pe).executor.stream(r,e,s(this,pe).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new rt({...s(this,pe),queryNode:xe.cloneWithExplain(s(this,pe).queryNode,e,r)}).execute()}};pe=new WeakMap;let cs=rt;Se(cs,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class ju{constructor(e,r){We(this,"numUpdatedRows");We(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}var me;const ot=class ot{constructor(e){M(this,me,void 0);H(this,me,p(e))}where(...e){return new ot({...s(this,me),queryNode:xe.cloneWithWhere(s(this,me).queryNode,bt(e))})}whereRef(e,r,n){return new ot({...s(this,me),queryNode:xe.cloneWithWhere(s(this,me).queryNode,qn(e,r,n))})}clearWhere(){return new ot({...s(this,me),queryNode:xe.cloneWithoutWhere(s(this,me).queryNode)})}from(e){return new ot({...s(this,me),queryNode:os.cloneWithFromItems(s(this,me).queryNode,yi(e))})}innerJoin(...e){return new ot({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,At("InnerJoin",e))})}leftJoin(...e){return new ot({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,At("LeftJoin",e))})}rightJoin(...e){return new ot({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,At("RightJoin",e))})}fullJoin(...e){return new ot({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,At("FullJoin",e))})}set(...e){return new ot({...s(this,me),queryNode:os.cloneWithUpdates(s(this,me).queryNode,Bu(...e))})}returning(e){return new ot({...s(this,me),queryNode:xe.cloneWithReturning(s(this,me).queryNode,Jr(e))})}returningAll(){return new ot({...s(this,me),queryNode:xe.cloneWithReturning(s(this,me).queryNode,Di())})}$call(e){return e(this)}$if(e,r){return e?r(this):new ot({...s(this,me)})}$castTo(){return new ot(s(this,me))}$narrowType(){return new ot(s(this,me))}$assertType(){return new ot(s(this,me))}withPlugin(e){return new ot({...s(this,me),executor:s(this,me).executor.withPlugin(e)})}toOperationNode(){return s(this,me).executor.transformQuery(s(this,me).queryNode,s(this,me).queryId)}compile(){return s(this,me).executor.compileQuery(this.toOperationNode(),s(this,me).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,me).executor.executeQuery(e,s(this,me).queryId);return s(this,me).executor.adapter.supportsReturning&&r.returning?n.rows:[new ju(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=no){const r=await this.executeTakeFirst();if(r===void 0)throw ro(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,me).executor.stream(r,e,s(this,me).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new ot({...s(this,me),queryNode:xe.cloneWithExplain(s(this,me).queryNode,e,r)}).execute()}};me=new WeakMap;let us=ot;Se(us,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const Pa=p({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return p({kind:"CommonTableExpressionNameNode",table:Ln.create(t),columns:e?p(e.map(et.create)):void 0})}}),ds=p({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return p({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return p({...t,...e})}});var fn;const Ps=class Ps{constructor(e){M(this,fn,void 0);H(this,fn,p(e))}materialized(){return new Ps({...s(this,fn),node:ds.cloneWith(s(this,fn).node,{materialized:!0})})}notMaterialized(){return new Ps({...s(this,fn),node:ds.cloneWith(s(this,fn).node,{materialized:!1})})}toOperationNode(){return s(this,fn).node}};fn=new WeakMap;let fs=Ps;Se(fs,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function Fa(t,e){const r=e(Zu()).toOperationNode();return Wt(t)?t(zu(r)).toOperationNode():ds.create(hl(t),r)}function zu(t){return e=>new fs({node:ds.create(hl(e),t)})}function hl(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],n=e[1].split(",").map(A=>A.trim());return Pa.create(r,n)}else return Pa.create(t)}const Vi=p({is(t){return t.kind==="WithNode"},create(t,e){return p({kind:"WithNode",expressions:p([t]),...e})},cloneWithExpression(t,e){return p({...t,expressions:p([...t.expressions,e])})}}),Wa=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Vu(t){let e="";for(let r=0;r<t;++r)e+=$u();return e}function $u(){return Wa[~~(Math.random()*Wa.length)]}function Ue(){return new Hu}var xr;class Hu{constructor(){M(this,xr,void 0)}get queryId(){return s(this,xr)===void 0&&H(this,xr,Vu(8)),s(this,xr)}}xr=new WeakMap;var Fs;class jo{constructor(){We(this,"nodeStack",[]);M(this,Fs,p({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),AddIndexNode:this.transformAddIndex.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),p(r)}transformNodeImpl(e){return s(this,Fs)[e.kind](e)}transformNodeList(e){return e&&p(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:p([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}Fs=new WeakMap;const Ju=p({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});var Er,Zn,er,Ws,pl,Ds,_l,Ls,ml,tr,ti,vi,qo,Rs,yl;class Gu extends jo{constructor(r){super();M(this,Ws);M(this,Ds);M(this,Ls);M(this,tr);M(this,vi);M(this,Rs);M(this,Er,void 0);M(this,Zn,new Set);M(this,er,new Set);H(this,Er,r)}transformNodeImpl(r){if(!ke(this,Ws,pl).call(this,r))return super.transformNodeImpl(r);const n=ke(this,Ls,ml).call(this,r);for(const te of n)s(this,er).add(te);const A=ke(this,Ds,_l).call(this,r);for(const te of A)s(this,Zn).add(te);const U=super.transformNodeImpl(r);for(const te of A)s(this,Zn).delete(te);for(const te of n)s(this,er).delete(te);return U}transformSchemableIdentifier(r){const n=super.transformSchemableIdentifier(r);return n.schema||!s(this,Zn).has(r.identifier.name)?n:{...n,schema:Je.create(s(this,Er))}}transformReferences(r){const n=super.transformReferences(r);return n.table.table.schema?n:{...n,table:Ln.createWithSchema(s(this,Er),n.table.table.identifier.name)}}}Er=new WeakMap,Zn=new WeakMap,er=new WeakMap,Ws=new WeakSet,pl=function(r){return r.kind in Ju},Ds=new WeakSet,_l=function(r){const n=new Set;if("name"in r&&r.name&&Rn.is(r.name)&&ke(this,vi,qo).call(this,r.name,n),"from"in r&&r.from)for(const A of r.from.froms)ke(this,tr,ti).call(this,A,n);if("into"in r&&r.into&&ke(this,tr,ti).call(this,r.into,n),"table"in r&&r.table&&ke(this,tr,ti).call(this,r.table,n),"joins"in r&&r.joins)for(const A of r.joins)ke(this,tr,ti).call(this,A.table,n);return n},Ls=new WeakSet,ml=function(r){const n=new Set;return"with"in r&&r.with&&ke(this,Rs,yl).call(this,r.with,n),n},tr=new WeakSet,ti=function(r,n){const A=Ln.is(r)?r:Un.is(r)&&Ln.is(r.node)?r.node:null;A&&ke(this,vi,qo).call(this,A.table,n)},vi=new WeakSet,qo=function(r,n){const A=r.identifier.name;!s(this,Zn).has(A)&&!s(this,er).has(A)&&n.add(A)},Rs=new WeakSet,yl=function(r,n){for(const A of r.expressions){const U=A.name.table.table.identifier.name;s(this,er).has(U)||n.add(U)}};var xi;class Li{constructor(e){M(this,xi,void 0);H(this,xi,new Gu(e))}transformQuery(e){return s(this,xi).transformNode(e.node)}async transformResult(e){return e.result}}xi=new WeakMap;var Re;const Hn=class Hn{constructor(e){M(this,Re,void 0);H(this,Re,p(e))}selectFrom(e){return Eo({queryId:Ue(),executor:s(this,Re).executor,queryNode:Ie.createFrom(yi(e),s(this,Re).withNode)})}selectNoFrom(e){return Eo({queryId:Ue(),executor:s(this,Re).executor,queryNode:Ie.cloneWithSelections(Ie.create(s(this,Re).withNode),Jr(e))})}insertInto(e){return new mi({queryId:Ue(),executor:s(this,Re).executor,queryNode:Jt.create(Ze(e),s(this,Re).withNode)})}replaceInto(e){return new mi({queryId:Ue(),executor:s(this,Re).executor,queryNode:Jt.create(Ze(e),s(this,Re).withNode,!0)})}deleteFrom(e){return new cs({queryId:Ue(),executor:s(this,Re).executor,queryNode:oi.create(yi(e),s(this,Re).withNode)})}updateTable(e){return new us({queryId:Ue(),executor:s(this,Re).executor,queryNode:os.create(gi(e),s(this,Re).withNode)})}with(e,r){const n=Fa(e,r);return new Hn({...s(this,Re),withNode:s(this,Re).withNode?Vi.cloneWithExpression(s(this,Re).withNode,n):Vi.create(n)})}withRecursive(e,r){const n=Fa(e,r);return new Hn({...s(this,Re),withNode:s(this,Re).withNode?Vi.cloneWithExpression(s(this,Re).withNode,n):Vi.create(n,{recursive:!0})})}withPlugin(e){return new Hn({...s(this,Re),executor:s(this,Re).executor.withPlugin(e)})}withoutPlugins(){return new Hn({...s(this,Re),executor:s(this,Re).executor.withoutPlugins()})}withSchema(e){return new Hn({...s(this,Re),executor:s(this,Re).executor.withPluginAtFront(new Li(e))})}};Re=new WeakMap;let hs=Hn;var Ei,Sr,Ar;class Da{constructor(){M(this,Ei,void 0);M(this,Sr,void 0);M(this,Ar,void 0);We(this,"resolve",e=>{s(this,Sr)&&s(this,Sr).call(this,e)});We(this,"reject",e=>{s(this,Ar)&&s(this,Ar).call(this,e)});H(this,Ei,new Promise((e,r)=>{H(this,Ar,r),H(this,Sr,e)}))}get promise(){return s(this,Ei)}}Ei=new WeakMap,Sr=new WeakMap,Ar=new WeakMap;const La=new Set;function Ku(t){La.has(t)||(La.add(t),console.log(t))}const Xu=p([]);var nr,Si,No;class gl{constructor(e=Xu){M(this,Si);M(this,nr,void 0);H(this,nr,e)}get plugins(){return s(this,nr)}transformQuery(e,r){for(const n of s(this,nr)){const A=n.transformQuery({node:e,queryId:r});if(A.kind===e.kind)e=A;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${A.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async n=>{const A=await n.executeQuery(e),U=await ke(this,Si,No).call(this,A,r);return Yu(A,U),U})}async*stream(e,r,n){const A=new Da,U=new Da;this.provideConnection(async Ae=>(A.resolve(Ae),await U.promise)).catch(Ae=>A.reject(Ae));const te=await A.promise;try{for await(const Ae of te.streamQuery(e,r))yield await ke(this,Si,No).call(this,Ae,n)}finally{U.resolve()}}}nr=new WeakMap,Si=new WeakSet,No=async function(e,r){for(const n of s(this,nr))e=await n.transformResult({result:e,queryId:r});return e};function Yu(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Ku("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class wr extends gl{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new wr([...this.plugins,e])}withPlugins(e){return new wr([...this.plugins,...e])}withPluginAtFront(e){return new wr([e,...this.plugins])}withoutPlugins(){return new wr([])}}const zo=new wr;function Zu(){return new hs({executor:zo})}function ed(t,e){return new is({joinNode:ri.create(t,gi(e))})}function td(){return new ss({overNode:bo.create()})}function At(t,e){if(e.length===3)return rd(t,e[0],e[1],e[2]);if(e.length===2)return nd(t,e[0],e[1]);throw new Error("not implemented")}function nd(t,e,r){return r(ed(t,e)).toOperationNode()}function rd(t,e,r,n){return ri.createWithOn(t,gi(e),qn(r,"=",n))}const id=p({is(t){return t.kind==="OffsetNode"},create(t){return p({kind:"OffsetNode",offset:t})}}),sd=p({is(t){return t.kind==="GroupByItemNode"},create(t){return p({kind:"GroupByItemNode",groupBy:t})}});function od(t){return t=Wt(t)?t(Gr()):t,_i(t).map(sd.create)}const wl=p({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return p({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function yr(t,e,r){return Wt(e)&&(e=e(Ho())),gn(e)||(e=[e]),e.map(n=>wl.create(t,hr(n),r))}var hn;const Bs=class Bs{constructor(e){M(this,hn,void 0);H(this,hn,e)}get expressionType(){}as(e){return new Vo(this,e)}or(...e){return new vo(Hr.create(s(this,hn),bt(e)))}and(...e){return new xo(Bn.create(s(this,hn),bt(e)))}$castTo(){return new Bs(s(this,hn))}$notNull(){return new Bs(s(this,hn))}toOperationNode(){return s(this,hn)}};hn=new WeakMap;let He=Bs;var Ir,On;class Vo{constructor(e,r){M(this,Ir,void 0);M(this,On,void 0);H(this,Ir,e),H(this,On,r)}get expression(){return s(this,Ir)}get alias(){return s(this,On)}toOperationNode(){return Un.create(s(this,Ir).toOperationNode(),Dt(s(this,On))?s(this,On).toOperationNode():Je.create(s(this,On)))}}Ir=new WeakMap,On=new WeakMap;var rr;const Ms=class Ms{constructor(e){M(this,rr,void 0);H(this,rr,e)}get expressionType(){}as(e){return new Vo(this,e)}or(...e){return new Ms(Hr.create(s(this,rr),bt(e)))}$castTo(){return new Ms(s(this,rr))}toOperationNode(){return zr.create(s(this,rr))}};rr=new WeakMap;let vo=Ms;var ir;const Qs=class Qs{constructor(e){M(this,ir,void 0);H(this,ir,e)}get expressionType(){}as(e){return new Vo(this,e)}and(...e){return new Qs(Bn.create(s(this,ir),bt(e)))}$castTo(){return new Qs(s(this,ir))}toOperationNode(){return zr.create(s(this,ir))}};ir=new WeakMap;let xo=Qs;var G;const _e=class _e{constructor(e){M(this,G,void 0);H(this,G,p(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new _e({...s(this,G),queryNode:xe.cloneWithWhere(s(this,G).queryNode,bt(e))})}whereRef(e,r,n){return new _e({...s(this,G),queryNode:xe.cloneWithWhere(s(this,G).queryNode,qn(e,r,n))})}having(...e){return new _e({...s(this,G),queryNode:Ie.cloneWithHaving(s(this,G).queryNode,bt(e))})}havingRef(e,r,n){return new _e({...s(this,G),queryNode:Ie.cloneWithHaving(s(this,G).queryNode,qn(e,r,n))})}select(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSelections(s(this,G).queryNode,Jr(e))})}distinctOn(e){return new _e({...s(this,G),queryNode:Ie.cloneWithDistinctOn(s(this,G).queryNode,_i(e))})}modifyFront(e){return new _e({...s(this,G),queryNode:Ie.cloneWithFrontModifier(s(this,G).queryNode,ln.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.createWithExpression(e.toOperationNode()))})}distinct(){return new _e({...s(this,G),queryNode:Ie.cloneWithFrontModifier(s(this,G).queryNode,ln.create("Distinct"))})}forUpdate(e){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.create("ForUpdate",e?zi(e).map(Ze):void 0))})}forShare(e){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.create("ForShare",e?zi(e).map(Ze):void 0))})}forKeyShare(e){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.create("ForKeyShare",e?zi(e).map(Ze):void 0))})}forNoKeyUpdate(e){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.create("ForNoKeyUpdate",e?zi(e).map(Ze):void 0))})}skipLocked(){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.create("SkipLocked"))})}noWait(){return new _e({...s(this,G),queryNode:Ie.cloneWithEndModifier(s(this,G).queryNode,ln.create("NoWait"))})}selectAll(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSelections(s(this,G).queryNode,Di(e))})}innerJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,At("InnerJoin",e))})}leftJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,At("LeftJoin",e))})}rightJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,At("RightJoin",e))})}fullJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,At("FullJoin",e))})}innerJoinLateral(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,At("LateralInnerJoin",e))})}leftJoinLateral(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,At("LateralLeftJoin",e))})}orderBy(...e){return new _e({...s(this,G),queryNode:Ie.cloneWithOrderByItems(s(this,G).queryNode,to(e))})}groupBy(e){return new _e({...s(this,G),queryNode:Ie.cloneWithGroupByItems(s(this,G).queryNode,od(e))})}limit(e){return new _e({...s(this,G),queryNode:Ie.cloneWithLimit(s(this,G).queryNode,fl.create(ct(e)))})}offset(e){return new _e({...s(this,G),queryNode:Ie.cloneWithOffset(s(this,G).queryNode,id.create(ct(e)))})}union(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSetOperations(s(this,G).queryNode,yr("union",e,!1))})}unionAll(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSetOperations(s(this,G).queryNode,yr("union",e,!0))})}intersect(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSetOperations(s(this,G).queryNode,yr("intersect",e,!1))})}intersectAll(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSetOperations(s(this,G).queryNode,yr("intersect",e,!0))})}except(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSetOperations(s(this,G).queryNode,yr("except",e,!1))})}exceptAll(e){return new _e({...s(this,G),queryNode:Ie.cloneWithSetOperations(s(this,G).queryNode,yr("except",e,!0))})}as(e){return new bl(this,e)}clearSelect(){return new _e({...s(this,G),queryNode:Ie.cloneWithoutSelections(s(this,G).queryNode)})}clearWhere(){return new _e({...s(this,G),queryNode:xe.cloneWithoutWhere(s(this,G).queryNode)})}clearLimit(){return new _e({...s(this,G),queryNode:Ie.cloneWithoutLimit(s(this,G).queryNode)})}clearOffset(){return new _e({...s(this,G),queryNode:Ie.cloneWithoutOffset(s(this,G).queryNode)})}clearOrderBy(){return new _e({...s(this,G),queryNode:Ie.cloneWithoutOrderBy(s(this,G).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new _e({...s(this,G)})}$castTo(){return new _e(s(this,G))}$narrowType(){return new _e(s(this,G))}$assertType(){return new _e(s(this,G))}$asTuple(){return new He(this.toOperationNode())}withPlugin(e){return new _e({...s(this,G),executor:s(this,G).executor.withPlugin(e)})}toOperationNode(){return s(this,G).executor.transformQuery(s(this,G).queryNode,s(this,G).queryId)}compile(){return s(this,G).executor.compileQuery(this.toOperationNode(),s(this,G).queryId)}async execute(){const e=this.compile();return(await s(this,G).executor.executeQuery(e,s(this,G).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=no){const r=await this.executeTakeFirst();if(r===void 0)throw ro(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,G).executor.stream(r,e,s(this,G).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new _e({...s(this,G),queryNode:xe.cloneWithExplain(s(this,G).queryNode,e,r)}).execute()}};G=new WeakMap;let ps=_e;Se(ps,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function Eo(t){return new ps(t)}var kr,Or;class bl{constructor(e,r){M(this,kr,void 0);M(this,Or,void 0);H(this,kr,e),H(this,Or,r)}get expression(){return s(this,kr)}get alias(){return s(this,Or)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Un.create(s(this,kr).toOperationNode(),Je.create(s(this,Or)))}}kr=new WeakMap,Or=new WeakMap;Se(bl,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const Xn=p({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return p({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return p({...t,distinct:!0})},cloneWithFilter(t,e){return p({...t,filter:t.filter?St.cloneWithOperation(t.filter,"And",e):St.create(e)})},cloneWithOrFilter(t,e){return p({...t,filter:t.filter?St.cloneWithOperation(t.filter,"Or",e):St.create(e)})},cloneWithOver(t,e){return p({...t,over:e})}}),Ra=p({is(t){return t.kind==="FunctionNode"},create(t,e){return p({kind:"FunctionNode",func:t,arguments:e})}});var Nt;const An=class An{constructor(e){M(this,Nt,void 0);H(this,Nt,p(e))}get expressionType(){}as(e){return new ad(this,e)}distinct(){return new An({...s(this,Nt),aggregateFunctionNode:Xn.cloneWithDistinct(s(this,Nt).aggregateFunctionNode)})}filterWhere(...e){return new An({...s(this,Nt),aggregateFunctionNode:Xn.cloneWithFilter(s(this,Nt).aggregateFunctionNode,bt(e))})}filterWhereRef(e,r,n){return new An({...s(this,Nt),aggregateFunctionNode:Xn.cloneWithFilter(s(this,Nt).aggregateFunctionNode,qn(e,r,n))})}over(e){const r=td();return new An({...s(this,Nt),aggregateFunctionNode:Xn.cloneWithOver(s(this,Nt).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}$castTo(){return new An(s(this,Nt))}$notNull(){return new An(s(this,Nt))}toOperationNode(){return s(this,Nt).aggregateFunctionNode}};Nt=new WeakMap;let Nr=An;Se(Nr,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var Tr,Cr;class ad{constructor(e,r){M(this,Tr,void 0);M(this,Cr,void 0);H(this,Tr,e),H(this,Cr,r)}get expression(){return s(this,Tr)}get alias(){return s(this,Cr)}toOperationNode(){return Un.create(s(this,Tr).toOperationNode(),Je.create(s(this,Cr)))}}Tr=new WeakMap,Cr=new WeakMap;function ql(){const t=(r,n)=>new He(Ra.create(r,_i(n??[]))),e=(r,n)=>new Nr({aggregateFunctionNode:Xn.create(r,n?_i(n):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(...r){return t("coalesce",r)},count(r){return e("count",[r])},countAll(r){return new Nr({aggregateFunctionNode:Xn.create("count",Di(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])},jsonAgg(r){return new Nr({aggregateFunctionNode:Xn.create("json_agg",[Bt(r)?Ze(r):r.toOperationNode()])})},toJson(r){return new He(Ra.create("to_json",[Bt(r)?Ze(r):r.toOperationNode()]))}})}const ld=p({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return p({kind:"UnaryOperationNode",operator:t,operand:e})}});function cd(t,e){return ld.create(Mn.create(t),Rt(e))}const $o=p({is(t){return t.kind==="WhenNode"},create(t){return p({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return p({...t,result:e})}}),rn=p({is(t){return t.kind==="CaseNode"},create(t){return p({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return p({...t,when:p(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return p({...t,when:t.when?p([...t.when.slice(0,-1),$o.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return p({...t,...e})}});var Pr;class Nl{constructor(e){M(this,Pr,void 0);H(this,Pr,p(e))}when(...e){return new vl({...s(this,Pr),node:rn.cloneWithWhen(s(this,Pr).node,$o.create(bt(e)))})}}Pr=new WeakMap;var Fr;class vl{constructor(e){M(this,Fr,void 0);H(this,Fr,p(e))}then(e){return new ud({...s(this,Fr),node:rn.cloneWithThen(s(this,Fr).node,Bo(e)?Mo(e):ct(e))})}}Fr=new WeakMap;var Yt;class ud{constructor(e){M(this,Yt,void 0);H(this,Yt,p(e))}when(...e){return new vl({...s(this,Yt),node:rn.cloneWithWhen(s(this,Yt).node,$o.create(bt(e)))})}else(e){return new dd({...s(this,Yt),node:rn.cloneWith(s(this,Yt).node,{else:Bo(e)?Mo(e):ct(e)})})}end(){return new He(rn.cloneWith(s(this,Yt).node,{isStatement:!1}))}endCase(){return new He(rn.cloneWith(s(this,Yt).node,{isStatement:!0}))}}Yt=new WeakMap;var Wr;class dd{constructor(e){M(this,Wr,void 0);H(this,Wr,p(e))}end(){return new He(rn.cloneWith(s(this,Wr).node,{isStatement:!1}))}endCase(){return new He(rn.cloneWith(s(this,Wr).node,{isStatement:!0}))}}Wr=new WeakMap;const Ba=p({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return p({kind:"JSONPathLegNode",type:t,value:e})}});var Zt,Ai,So;class ai{constructor(e){M(this,Ai);M(this,Zt,void 0);H(this,Zt,e)}at(e){return ke(this,Ai,So).call(this,"ArrayLocation",e)}key(e){return ke(this,Ai,So).call(this,"Member",e)}}Zt=new WeakMap,Ai=new WeakSet,So=function(e,r){return ts.is(s(this,Zt))?new Ma(ts.cloneWithTraversal(s(this,Zt),ii.is(s(this,Zt).traversal)?ii.cloneWithLeg(s(this,Zt).traversal,Ba.create(e,r)):sl.cloneWithValue(s(this,Zt).traversal,bn.createImmediate(r)))):new Ma(ii.cloneWithLeg(s(this,Zt),Ba.create(e,r)))};var sr;class Ma extends ai{constructor(r){super(r);M(this,sr,void 0);H(this,sr,r)}get expressionType(){}as(r){return new fd(this,r)}$castTo(){return new ai(s(this,sr))}$notNull(){return new ai(s(this,sr))}toOperationNode(){return s(this,sr)}}sr=new WeakMap;var Dr,Tn;class fd{constructor(e,r){M(this,Dr,void 0);M(this,Tn,void 0);H(this,Dr,e),H(this,Tn,r)}get expression(){return s(this,Dr)}get alias(){return s(this,Tn)}toOperationNode(){return Un.create(s(this,Dr).toOperationNode(),Dt(s(this,Tn))?s(this,Tn).toOperationNode():Je.create(s(this,Tn)))}}Dr=new WeakMap,Tn=new WeakMap;const Qa=p({is(t){return t.kind==="TupleNode"},create(t){return p({kind:"TupleNode",values:p(t)})}});function Ho(t=zo){function e(A,U,te){return new He(Qo(A,U,te))}function r(A,U){return new He(cd(A,U))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(A){return Eo({queryId:Ue(),executor:t,queryNode:Ie.createFrom(yi(A))})},case(A){return new Nl({node:rn.create(dr(A)?void 0:Rt(A))})},ref(A,U){return dr(U)?new He(wn(A)):new ai(vu(A,U))},jsonPath(){return new ai(ii.create())},table(A){return new He(Ze(A))},val(A){return new He(ct(A))},refTuple(...A){return new He(Qa.create(A.map(Rt)))},tuple(...A){return new He(Qa.create(A.map(ct)))},lit(A){return new He(Mo(A))},unary:r,not(A){return r("not",A)},exists(A){return r("exists",A)},neg(A){return r("-",A)},between(A,U,te){return new He(jr.create(Rt(A),Mn.create("between"),Bn.create(ct(U),ct(te))))},betweenSymmetric(A,U,te){return new He(jr.create(Rt(A),Mn.create("between symmetric"),Bn.create(ct(U),ct(te))))},and(A){return gn(A)?new He(go(A,"and")):new He(xa(A,"and"))},or(A){return gn(A)?new He(go(A,"or")):new He(xa(A,"or"))},parens(...A){const U=bt(A);return zr.is(U)?new He(U):new He(zr.create(U))},withSchema(A){return Ho(t.withPluginAtFront(new Li(A)))}});return n.fn=ql(),n.eb=n,n}function Gr(t){return Ho()}function hr(t){if(Dt(t))return t.toOperationNode();if(Wt(t))return t(Gr()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function xl(t){if(Dt(t))return t.toOperationNode();if(Wt(t))return t(Gr()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Ri(t){return hu(t)||pu(t)||Wt(t)}function yi(t){return gn(t)?t.map(e=>gi(e)):[gi(t)]}function gi(t){return Bt(t)?hd(t):xl(t)}function hd(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(El);return Un.create(Ze(r),Je.create(n))}else return Ze(t)}function Ze(t){const e=".";if(t.includes(e)){const[r,n]=t.split(e).map(El);return Ln.createWithSchema(r,n)}else return Ln.create(t)}function El(t){return t.trim()}const Sl=p({is(t){return t.kind==="AddColumnNode"},create(t){return p({kind:"AddColumnNode",column:t})}}),Ke=p({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return p({kind:"ColumnDefinitionNode",column:et.create(t),dataType:e})},cloneWithFrontModifier(t,e){return p({...t,frontModifiers:t.frontModifiers?p([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return p({...t,endModifiers:t.endModifiers?p([...t.endModifiers,e]):[e]})},cloneWith(t,e){return p({...t,...e})}}),Al=p({is(t){return t.kind==="DropColumnNode"},create(t){return p({kind:"DropColumnNode",column:et.create(t)})}}),Il=p({is(t){return t.kind==="RenameColumnNode"},create(t,e){return p({kind:"RenameColumnNode",column:et.create(t),renameTo:et.create(e)})}}),Jo=p({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return p({kind:"CheckConstraintNode",expression:t,name:e?Je.create(e):void 0})}}),pd=["no action","restrict","cascade","set null","set default"],Ji=p({is(t){return t.kind==="ReferencesNode"},create(t,e){return p({kind:"ReferencesNode",table:t,columns:p([...e])})},cloneWithOnDelete(t,e){return p({...t,onDelete:e})},cloneWithOnUpdate(t,e){return p({...t,onUpdate:e})}});function kl(t){return Dt(t)?t.toOperationNode():bn.createImmediate(t)}const $i=p({is(t){return t.kind==="GeneratedNode"},create(t){return p({kind:"GeneratedNode",...t})},createWithExpression(t){return p({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return p({...t,...e})}}),_d=p({is(t){return t.kind==="DefaultValueNode"},create(t){return p({kind:"DefaultValueNode",defaultValue:t})}});function _s(t){if(pd.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var Be;const at=class at{constructor(e){M(this,Be,void 0);H(this,Be,e)}autoIncrement(){return new at(Ke.cloneWith(s(this,Be),{autoIncrement:!0}))}primaryKey(){return new at(Ke.cloneWith(s(this,Be),{primaryKey:!0}))}references(e){const r=wn(e);if(!r.table||Do.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new at(Ke.cloneWith(s(this,Be),{references:Ji.create(r.table,[r.column])}))}onDelete(e){if(!s(this,Be).references)throw new Error("on delete constraint can only be added for foreign keys");return new at(Ke.cloneWith(s(this,Be),{references:Ji.cloneWithOnDelete(s(this,Be).references,_s(e))}))}onUpdate(e){if(!s(this,Be).references)throw new Error("on update constraint can only be added for foreign keys");return new at(Ke.cloneWith(s(this,Be),{references:Ji.cloneWithOnUpdate(s(this,Be).references,_s(e))}))}unique(){return new at(Ke.cloneWith(s(this,Be),{unique:!0}))}notNull(){return new at(Ke.cloneWith(s(this,Be),{notNull:!0}))}unsigned(){return new at(Ke.cloneWith(s(this,Be),{unsigned:!0}))}defaultTo(e){return new at(Ke.cloneWith(s(this,Be),{defaultTo:_d.create(kl(e))}))}check(e){return new at(Ke.cloneWith(s(this,Be),{check:Jo.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new at(Ke.cloneWith(s(this,Be),{generated:$i.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new at(Ke.cloneWith(s(this,Be),{generated:$i.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new at(Ke.cloneWith(s(this,Be),{generated:$i.create({identity:!0,byDefault:!0})}))}stored(){if(!s(this,Be).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new at(Ke.cloneWith(s(this,Be),{generated:$i.cloneWith(s(this,Be).generated,{stored:!0})}))}modifyFront(e){return new at(Ke.cloneWithFrontModifier(s(this,Be),e.toOperationNode()))}nullsNotDistinct(){return new at(Ke.cloneWith(s(this,Be),{nullsNotDistinct:!0}))}modifyEnd(e){return new at(Ke.cloneWithEndModifier(s(this,Be),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return s(this,Be)}};Be=new WeakMap;let Qn=at;Se(Qn,"don't await ColumnDefinitionBuilder instances directly.");const Ol=p({is(t){return t.kind==="ModifyColumnNode"},create(t){return p({kind:"ModifyColumnNode",column:t})}}),md=p({is(t){return t.kind==="DataTypeNode"},create(t){return p({kind:"DataTypeNode",dataType:t})}});function $r(t){return Dt(t)?t.toOperationNode():md.create(t)}const ms=p({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,n){return p({kind:"ForeignKeyConstraintNode",columns:t,references:Ji.create(e,r),name:n?Je.create(n):void 0})},cloneWith(t,e){return p({...t,...e})}});var or;const Us=class Us{constructor(e){M(this,or,void 0);H(this,or,e)}onDelete(e){return new Us(ms.cloneWith(s(this,or),{onDelete:_s(e)}))}onUpdate(e){return new Us(ms.cloneWith(s(this,or),{onUpdate:_s(e)}))}$call(e){return e(this)}toOperationNode(){return s(this,or)}};or=new WeakMap;let wi=Us;Se(wi,"don't await ForeignKeyConstraintBuilder instances directly.");const Gi=p({is(t){return t.kind==="AddConstraintNode"},create(t){return p({kind:"AddConstraintNode",constraint:t})}}),Go=p({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,r){return p({kind:"UniqueConstraintNode",columns:p(t.map(et.create)),name:e?Je.create(e):void 0,nullsNotDistinct:r})},cloneWith(t,e){return p({...t,...e})}}),Ki=p({is(t){return t.kind==="DropConstraintNode"},create(t){return p({kind:"DropConstraintNode",constraintName:Je.create(t)})},cloneWith(t,e){return p({...t,...e})}}),Zr=p({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return p({kind:"AlterColumnNode",column:et.create(t),[e]:r})}});var pn;class Ko{constructor(e){M(this,pn,void 0);H(this,pn,e)}setDataType(e){return new ei(Zr.create(s(this,pn),"dataType",$r(e)))}setDefault(e){return new ei(Zr.create(s(this,pn),"setDefault",kl(e)))}dropDefault(){return new ei(Zr.create(s(this,pn),"dropDefault",!0))}setNotNull(){return new ei(Zr.create(s(this,pn),"setNotNull",!0))}dropNotNull(){return new ei(Zr.create(s(this,pn),"dropNotNull",!0))}$call(e){return e(this)}}pn=new WeakMap;var Ii;class ei{constructor(e){M(this,Ii,void 0);H(this,Ii,e)}toOperationNode(){return s(this,Ii)}}Ii=new WeakMap;var zt;class $n{constructor(e){M(this,zt,void 0);H(this,zt,p(e))}toOperationNode(){return s(this,zt).executor.transformQuery(s(this,zt).node,s(this,zt).queryId)}compile(){return s(this,zt).executor.compileQuery(this.toOperationNode(),s(this,zt).queryId)}async execute(){await s(this,zt).executor.executeQuery(this.compile(),s(this,zt).queryId)}}zt=new WeakMap;Se($n,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var gt;const js=class js{constructor(e){M(this,gt,void 0);H(this,gt,p(e))}onDelete(e){return new js({...s(this,gt),constraintBuilder:s(this,gt).constraintBuilder.onDelete(e)})}onUpdate(e){return new js({...s(this,gt),constraintBuilder:s(this,gt).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return s(this,gt).executor.transformQuery(Me.cloneWithTableProps(s(this,gt).node,{addConstraint:Gi.create(s(this,gt).constraintBuilder.toOperationNode())}),s(this,gt).queryId)}compile(){return s(this,gt).executor.compileQuery(this.toOperationNode(),s(this,gt).queryId)}async execute(){await s(this,gt).executor.executeQuery(this.compile(),s(this,gt).queryId)}};gt=new WeakMap;let ys=js;Se(ys,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var it;const ui=class ui{constructor(e){M(this,it,void 0);H(this,it,p(e))}ifExists(){return new ui({...s(this,it),node:Me.cloneWithTableProps(s(this,it).node,{dropConstraint:Ki.cloneWith(s(this,it).node.dropConstraint,{ifExists:!0})})})}cascade(){return new ui({...s(this,it),node:Me.cloneWithTableProps(s(this,it).node,{dropConstraint:Ki.cloneWith(s(this,it).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new ui({...s(this,it),node:Me.cloneWithTableProps(s(this,it).node,{dropConstraint:Ki.cloneWith(s(this,it).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return s(this,it).executor.transformQuery(s(this,it).node,s(this,it).queryId)}compile(){return s(this,it).executor.compileQuery(this.toOperationNode(),s(this,it).queryId)}async execute(){await s(this,it).executor.executeQuery(this.compile(),s(this,it).queryId)}};it=new WeakMap;let gs=ui;Se(gs,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const Tl=p({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return p({kind:"PrimaryKeyConstraintNode",columns:p(t.map(et.create)),name:e?Je.create(e):void 0})}}),gr=p({is(t){return t.kind==="AddIndexNode"},create(t){return p({kind:"AddIndexNode",name:Je.create(t)})},cloneWith(t,e){return p({...t,...e})},cloneWithColumns(t,e){return p({...t,columns:[...t.columns||[],...e]})}});var Ve;const Jn=class Jn{constructor(e){M(this,Ve,void 0);H(this,Ve,p(e))}unique(){return new Jn({...s(this,Ve),node:Me.cloneWithTableProps(s(this,Ve).node,{addIndex:gr.cloneWith(s(this,Ve).node.addIndex,{unique:!0})})})}column(e){return new Jn({...s(this,Ve),node:Me.cloneWithTableProps(s(this,Ve).node,{addIndex:gr.cloneWithColumns(s(this,Ve).node.addIndex,[ns(e)])})})}columns(e){return new Jn({...s(this,Ve),node:Me.cloneWithTableProps(s(this,Ve).node,{addIndex:gr.cloneWithColumns(s(this,Ve).node.addIndex,e.map(ns))})})}expression(e){return new Jn({...s(this,Ve),node:Me.cloneWithTableProps(s(this,Ve).node,{addIndex:gr.cloneWithColumns(s(this,Ve).node.addIndex,[e.toOperationNode()])})})}using(e){return new Jn({...s(this,Ve),node:Me.cloneWithTableProps(s(this,Ve).node,{addIndex:gr.cloneWith(s(this,Ve).node.addIndex,{using:wt.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return s(this,Ve).executor.transformQuery(s(this,Ve).node,s(this,Ve).queryId)}compile(){return s(this,Ve).executor.compileQuery(this.toOperationNode(),s(this,Ve).queryId)}async execute(){await s(this,Ve).executor.executeQuery(this.compile(),s(this,Ve).queryId)}};Ve=new WeakMap;let ws=Jn;Se(ws,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var Lr;const Yo=class Yo{constructor(e){M(this,Lr,void 0);H(this,Lr,e)}toOperationNode(){return s(this,Lr)}nullsNotDistinct(){return new Yo(Go.cloneWith(s(this,Lr),{nullsNotDistinct:!0}))}};Lr=new WeakMap;let bi=Yo;Se(bi,"don't await UniqueConstraintNodeBuilder instances directly.");var Pe;class Cl{constructor(e){M(this,Pe,void 0);H(this,Pe,p(e))}renameTo(e){return new $n({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{renameTo:Ze(e)})})}setSchema(e){return new $n({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{setSchema:Je.create(e)})})}alterColumn(e,r){const n=r(new Ko(e));return new kn({...s(this,Pe),node:Me.cloneWithColumnAlteration(s(this,Pe).node,n.toOperationNode())})}dropColumn(e){return new kn({...s(this,Pe),node:Me.cloneWithColumnAlteration(s(this,Pe).node,Al.create(e))})}renameColumn(e,r){return new kn({...s(this,Pe),node:Me.cloneWithColumnAlteration(s(this,Pe).node,Il.create(e,r))})}addColumn(e,r,n=Dn){const A=n(new Qn(Ke.create(e,$r(r))));return new kn({...s(this,Pe),node:Me.cloneWithColumnAlteration(s(this,Pe).node,Sl.create(A.toOperationNode()))})}modifyColumn(e,r,n=Dn){const A=n(new Qn(Ke.create(e,$r(r))));return new kn({...s(this,Pe),node:Me.cloneWithColumnAlteration(s(this,Pe).node,Ol.create(A.toOperationNode()))})}addUniqueConstraint(e,r,n=Dn){const A=n(new bi(Go.create(r,e)));return new $n({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{addConstraint:Gi.create(A.toOperationNode())})})}addCheckConstraint(e,r){return new $n({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{addConstraint:Gi.create(Jo.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,n,A){return new ys({...s(this,Pe),constraintBuilder:new wi(ms.create(r.map(et.create),Ze(n),A.map(et.create),e))})}addPrimaryKeyConstraint(e,r){return new $n({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{addConstraint:Gi.create(Tl.create(r,e))})})}dropConstraint(e){return new gs({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{dropConstraint:Ki.create(e)})})}addIndex(e){return new ws({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{addIndex:gr.create(e)})})}dropIndex(e){return new $n({...s(this,Pe),node:Me.cloneWithTableProps(s(this,Pe).node,{dropIndex:ni.create(e)})})}$call(e){return e(this)}}Pe=new WeakMap;var Ye;const Gn=class Gn{constructor(e){M(this,Ye,void 0);H(this,Ye,p(e))}alterColumn(e,r){const n=r(new Ko(e));return new Gn({...s(this,Ye),node:Me.cloneWithColumnAlteration(s(this,Ye).node,n.toOperationNode())})}dropColumn(e){return new Gn({...s(this,Ye),node:Me.cloneWithColumnAlteration(s(this,Ye).node,Al.create(e))})}renameColumn(e,r){return new Gn({...s(this,Ye),node:Me.cloneWithColumnAlteration(s(this,Ye).node,Il.create(e,r))})}addColumn(e,r,n=Dn){const A=n(new Qn(Ke.create(e,$r(r))));return new Gn({...s(this,Ye),node:Me.cloneWithColumnAlteration(s(this,Ye).node,Sl.create(A.toOperationNode()))})}modifyColumn(e,r,n=Dn){const A=n(new Qn(Ke.create(e,$r(r))));return new Gn({...s(this,Ye),node:Me.cloneWithColumnAlteration(s(this,Ye).node,Ol.create(A.toOperationNode()))})}toOperationNode(){return s(this,Ye).executor.transformQuery(s(this,Ye).node,s(this,Ye).queryId)}compile(){return s(this,Ye).executor.compileQuery(this.toOperationNode(),s(this,Ye).queryId)}async execute(){await s(this,Ye).executor.executeQuery(this.compile(),s(this,Ye).queryId)}};Ye=new WeakMap;let kn=Gn;Se(Cl,"don't await AlterTableBuilder instances");Se(Ko,"don't await AlterColumnBuilder instances");Se(kn,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Pl extends jo{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var De;const Qt=class Qt{constructor(e){M(this,De,void 0);H(this,De,p(e))}ifNotExists(){return new Qt({...s(this,De),node:cn.cloneWith(s(this,De).node,{ifNotExists:!0})})}unique(){return new Qt({...s(this,De),node:cn.cloneWith(s(this,De).node,{unique:!0})})}nullsNotDistinct(){return new Qt({...s(this,De),node:cn.cloneWith(s(this,De).node,{nullsNotDistinct:!0})})}on(e){return new Qt({...s(this,De),node:cn.cloneWith(s(this,De).node,{table:Ze(e)})})}column(e){return new Qt({...s(this,De),node:cn.cloneWithColumns(s(this,De).node,[ns(e)])})}columns(e){return new Qt({...s(this,De),node:cn.cloneWithColumns(s(this,De).node,e.map(ns))})}expression(e){return new Qt({...s(this,De),node:cn.cloneWithColumns(s(this,De).node,[e.toOperationNode()])})}using(e){return new Qt({...s(this,De),node:cn.cloneWith(s(this,De).node,{using:wt.createWithSql(e)})})}where(...e){const r=new Pl;return new Qt({...s(this,De),node:xe.cloneWithWhere(s(this,De).node,r.transformNode(bt(e)))})}$call(e){return e(this)}toOperationNode(){return s(this,De).executor.transformQuery(s(this,De).node,s(this,De).queryId)}compile(){return s(this,De).executor.compileQuery(this.toOperationNode(),s(this,De).queryId)}async execute(){await s(this,De).executor.executeQuery(this.compile(),s(this,De).queryId)}};De=new WeakMap;let bs=Qt;Se(bs,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var Tt;const Zo=class Zo{constructor(e){M(this,Tt,void 0);H(this,Tt,p(e))}ifNotExists(){return new Zo({...s(this,Tt),node:el.cloneWith(s(this,Tt).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Tt).executor.transformQuery(s(this,Tt).node,s(this,Tt).queryId)}compile(){return s(this,Tt).executor.compileQuery(this.toOperationNode(),s(this,Tt).queryId)}async execute(){await s(this,Tt).executor.executeQuery(this.compile(),s(this,Tt).queryId)}};Tt=new WeakMap;let qs=Zo;Se(qs,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function yd(t){if(fu.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var Oe;const Ot=class Ot{constructor(e){M(this,Oe,void 0);H(this,Oe,p(e))}temporary(){return new Ot({...s(this,Oe),node:kt.cloneWith(s(this,Oe).node,{temporary:!0})})}onCommit(e){return new Ot({...s(this,Oe),node:kt.cloneWith(s(this,Oe).node,{onCommit:yd(e)})})}ifNotExists(){return new Ot({...s(this,Oe),node:kt.cloneWith(s(this,Oe).node,{ifNotExists:!0})})}addColumn(e,r,n=Dn){const A=n(new Qn(Ke.create(e,$r(r))));return new Ot({...s(this,Oe),node:kt.cloneWithColumn(s(this,Oe).node,A.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Ot({...s(this,Oe),node:kt.cloneWithConstraint(s(this,Oe).node,Tl.create(r,e))})}addUniqueConstraint(e,r,n=Dn){const A=n(new bi(Go.create(r,e)));return new Ot({...s(this,Oe),node:kt.cloneWithConstraint(s(this,Oe).node,A.toOperationNode())})}addCheckConstraint(e,r){return new Ot({...s(this,Oe),node:kt.cloneWithConstraint(s(this,Oe).node,Jo.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,n,A,U=Dn){const te=U(new wi(ms.create(r.map(et.create),Ze(n),A.map(et.create),e)));return new Ot({...s(this,Oe),node:kt.cloneWithConstraint(s(this,Oe).node,te.toOperationNode())})}modifyFront(e){return new Ot({...s(this,Oe),node:kt.cloneWithFrontModifier(s(this,Oe).node,e.toOperationNode())})}modifyEnd(e){return new Ot({...s(this,Oe),node:kt.cloneWithEndModifier(s(this,Oe).node,e.toOperationNode())})}as(e){return new Ot({...s(this,Oe),node:kt.cloneWith(s(this,Oe).node,{selectQuery:hr(e)})})}$call(e){return e(this)}toOperationNode(){return s(this,Oe).executor.transformQuery(s(this,Oe).node,s(this,Oe).queryId)}compile(){return s(this,Oe).executor.compileQuery(this.toOperationNode(),s(this,Oe).queryId)}async execute(){await s(this,Oe).executor.executeQuery(this.compile(),s(this,Oe).queryId)}};Oe=new WeakMap;let Ns=Ot;Se(Ns,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var ht;const di=class di{constructor(e){M(this,ht,void 0);H(this,ht,p(e))}on(e){return new di({...s(this,ht),node:ni.cloneWith(s(this,ht).node,{table:Ze(e)})})}ifExists(){return new di({...s(this,ht),node:ni.cloneWith(s(this,ht).node,{ifExists:!0})})}cascade(){return new di({...s(this,ht),node:ni.cloneWith(s(this,ht).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ht).executor.transformQuery(s(this,ht).node,s(this,ht).queryId)}compile(){return s(this,ht).executor.compileQuery(this.toOperationNode(),s(this,ht).queryId)}async execute(){await s(this,ht).executor.executeQuery(this.compile(),s(this,ht).queryId)}};ht=new WeakMap;let vs=di;Se(vs,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var vt;const zs=class zs{constructor(e){M(this,vt,void 0);H(this,vt,p(e))}ifExists(){return new zs({...s(this,vt),node:_o.cloneWith(s(this,vt).node,{ifExists:!0})})}cascade(){return new zs({...s(this,vt),node:_o.cloneWith(s(this,vt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,vt).executor.transformQuery(s(this,vt).node,s(this,vt).queryId)}compile(){return s(this,vt).executor.compileQuery(this.toOperationNode(),s(this,vt).queryId)}async execute(){await s(this,vt).executor.executeQuery(this.compile(),s(this,vt).queryId)}};vt=new WeakMap;let xs=zs;Se(xs,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var xt;const Vs=class Vs{constructor(e){M(this,xt,void 0);H(this,xt,p(e))}ifExists(){return new Vs({...s(this,xt),node:mo.cloneWith(s(this,xt).node,{ifExists:!0})})}cascade(){return new Vs({...s(this,xt),node:mo.cloneWith(s(this,xt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,xt).executor.transformQuery(s(this,xt).node,s(this,xt).queryId)}compile(){return s(this,xt).executor.compileQuery(this.toOperationNode(),s(this,xt).queryId)}async execute(){await s(this,xt).executor.executeQuery(this.compile(),s(this,xt).queryId)}};xt=new WeakMap;let Es=Vs;Se(Es,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Sn=p({is(t){return t.kind==="CreateViewNode"},create(t){return p({kind:"CreateViewNode",name:Rn.create(t)})},cloneWith(t,e){return p({...t,...e})}});var $s;class gd{constructor(){M(this,$s,new Pl)}transformQuery(e){return s(this,$s).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}$s=new WeakMap;var Ge;const In=class In{constructor(e){M(this,Ge,void 0);H(this,Ge,p(e))}temporary(){return new In({...s(this,Ge),node:Sn.cloneWith(s(this,Ge).node,{temporary:!0})})}materialized(){return new In({...s(this,Ge),node:Sn.cloneWith(s(this,Ge).node,{materialized:!0})})}ifNotExists(){return new In({...s(this,Ge),node:Sn.cloneWith(s(this,Ge).node,{ifNotExists:!0})})}orReplace(){return new In({...s(this,Ge),node:Sn.cloneWith(s(this,Ge).node,{orReplace:!0})})}columns(e){return new In({...s(this,Ge),node:Sn.cloneWith(s(this,Ge).node,{columns:e.map(al)})})}as(e){const r=e.withPlugin(new gd).toOperationNode();return new In({...s(this,Ge),node:Sn.cloneWith(s(this,Ge).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return s(this,Ge).executor.transformQuery(s(this,Ge).node,s(this,Ge).queryId)}compile(){return s(this,Ge).executor.compileQuery(this.toOperationNode(),s(this,Ge).queryId)}async execute(){await s(this,Ge).executor.executeQuery(this.compile(),s(this,Ge).queryId)}};Ge=new WeakMap;let Ss=In;Se(Ss,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const Xi=p({is(t){return t.kind==="DropViewNode"},create(t){return p({kind:"DropViewNode",name:Rn.create(t)})},cloneWith(t,e){return p({...t,...e})}});var pt;const fi=class fi{constructor(e){M(this,pt,void 0);H(this,pt,p(e))}materialized(){return new fi({...s(this,pt),node:Xi.cloneWith(s(this,pt).node,{materialized:!0})})}ifExists(){return new fi({...s(this,pt),node:Xi.cloneWith(s(this,pt).node,{ifExists:!0})})}cascade(){return new fi({...s(this,pt),node:Xi.cloneWith(s(this,pt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,pt).executor.transformQuery(s(this,pt).node,s(this,pt).queryId)}compile(){return s(this,pt).executor.compileQuery(this.toOperationNode(),s(this,pt).queryId)}async execute(){await s(this,pt).executor.executeQuery(this.compile(),s(this,pt).queryId)}};pt=new WeakMap;let As=fi;Se(As,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Fl=p({is(t){return t.kind==="CreateTypeNode"},create(t){return p({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return p({...t,enum:Ro.create(e.map(r=>bn.createImmediate(r)))})}});var Ct;const ea=class ea{constructor(e){M(this,Ct,void 0);H(this,Ct,p(e))}toOperationNode(){return s(this,Ct).executor.transformQuery(s(this,Ct).node,s(this,Ct).queryId)}asEnum(e){return new ea({...s(this,Ct),node:Fl.cloneWithEnum(s(this,Ct).node,e)})}$call(e){return e(this)}compile(){return s(this,Ct).executor.compileQuery(this.toOperationNode(),s(this,Ct).queryId)}async execute(){await s(this,Ct).executor.executeQuery(this.compile(),s(this,Ct).queryId)}};Ct=new WeakMap;let Is=ea;Se(Is,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Wl=p({is(t){return t.kind==="DropTypeNode"},create(t){return p({kind:"DropTypeNode",name:t})},cloneWith(t,e){return p({...t,...e})}});var Pt;const ta=class ta{constructor(e){M(this,Pt,void 0);H(this,Pt,p(e))}ifExists(){return new ta({...s(this,Pt),node:Wl.cloneWith(s(this,Pt).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Pt).executor.transformQuery(s(this,Pt).node,s(this,Pt).queryId)}compile(){return s(this,Pt).executor.compileQuery(this.toOperationNode(),s(this,Pt).queryId)}async execute(){await s(this,Pt).executor.executeQuery(this.compile(),s(this,Pt).queryId)}};Pt=new WeakMap;let ks=ta;Se(ks,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function Ua(t){const e=".";if(t.includes(e)){const r=t.split(e).map(wd);if(r.length===2)return Rn.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return Rn.create(t)}function wd(t){return t.trim()}var dt;const hi=class hi{constructor(e){M(this,dt,void 0);H(this,dt,e)}createTable(e){return new Ns({queryId:Ue(),executor:s(this,dt),node:kt.create(Ze(e))})}dropTable(e){return new Es({queryId:Ue(),executor:s(this,dt),node:mo.create(Ze(e))})}createIndex(e){return new bs({queryId:Ue(),executor:s(this,dt),node:cn.create(e)})}dropIndex(e){return new vs({queryId:Ue(),executor:s(this,dt),node:ni.create(e)})}createSchema(e){return new qs({queryId:Ue(),executor:s(this,dt),node:el.create(e)})}dropSchema(e){return new xs({queryId:Ue(),executor:s(this,dt),node:_o.create(e)})}alterTable(e){return new Cl({queryId:Ue(),executor:s(this,dt),node:Me.create(Ze(e))})}createView(e){return new Ss({queryId:Ue(),executor:s(this,dt),node:Sn.create(e)})}dropView(e){return new As({queryId:Ue(),executor:s(this,dt),node:Xi.create(e)})}createType(e){return new Is({queryId:Ue(),executor:s(this,dt),node:Fl.create(Ua(e))})}dropType(e){return new ks({queryId:Ue(),executor:s(this,dt),node:Wl.create(Ua(e))})}withPlugin(e){return new hi(s(this,dt).withPlugin(e))}withoutPlugins(){return new hi(s(this,dt).withoutPlugins())}withSchema(e){return new hi(s(this,dt).withPluginAtFront(new Li(e)))}};dt=new WeakMap;let Ao=hi;class bd{ref(e){return new qu(e)}}var Rr;class qd{constructor(e){M(this,Rr,void 0);H(this,Rr,e)}async provideConnection(e){const r=await s(this,Rr).acquireConnection();try{return await e(r)}finally{await s(this,Rr).releaseConnection(r)}}}Rr=new WeakMap;var en,tn,_n;const Kn=class Kn extends gl{constructor(r,n,A,U=[]){super(U);M(this,en,void 0);M(this,tn,void 0);M(this,_n,void 0);H(this,en,r),H(this,tn,n),H(this,_n,A)}get adapter(){return s(this,tn)}compileQuery(r){return s(this,en).compileQuery(r)}provideConnection(r){return s(this,_n).provideConnection(r)}withPlugins(r){return new Kn(s(this,en),s(this,tn),s(this,_n),[...this.plugins,...r])}withPlugin(r){return new Kn(s(this,en),s(this,tn),s(this,_n),[...this.plugins,r])}withPluginAtFront(r){return new Kn(s(this,en),s(this,tn),s(this,_n),[r,...this.plugins])}withConnectionProvider(r){return new Kn(s(this,en),s(this,tn),r,[...this.plugins])}withoutPlugins(){return new Kn(s(this,en),s(this,tn),s(this,_n),[])}};en=new WeakMap,tn=new WeakMap,_n=new WeakMap;let Io=Kn;function ja(){return typeof performance<"u"&&Wt(performance.now)?performance.now():Date.now()}var Vt,Cn,mn,Br,yn,ki,Hs,Dl,Js,Ll,Gs,Rl,Ks,Bl,Oi,ko;class Nd{constructor(e,r){M(this,Hs);M(this,Js);M(this,Gs);M(this,Ks);M(this,Oi);M(this,Vt,void 0);M(this,Cn,void 0);M(this,mn,void 0);M(this,Br,void 0);M(this,yn,void 0);M(this,ki,new WeakSet);H(this,Br,!1),H(this,Vt,e),H(this,Cn,r)}async init(){if(s(this,yn))throw new Error("driver has already been destroyed");s(this,mn)||H(this,mn,s(this,Vt).init().then(()=>{H(this,Br,!0)}).catch(e=>(H(this,mn,void 0),Promise.reject(e)))),await s(this,mn)}async acquireConnection(){if(s(this,yn))throw new Error("driver has already been destroyed");s(this,Br)||await this.init();const e=await s(this,Vt).acquireConnection();return s(this,ki).has(e)||(ke(this,Hs,Dl).call(this)&&ke(this,Js,Ll).call(this,e),s(this,ki).add(e)),e}async releaseConnection(e){await s(this,Vt).releaseConnection(e)}beginTransaction(e,r){return s(this,Vt).beginTransaction(e,r)}commitTransaction(e){return s(this,Vt).commitTransaction(e)}rollbackTransaction(e){return s(this,Vt).rollbackTransaction(e)}async destroy(){s(this,mn)&&(await s(this,mn),s(this,yn)||H(this,yn,s(this,Vt).destroy().catch(e=>(H(this,yn,void 0),Promise.reject(e)))),await s(this,yn))}}Vt=new WeakMap,Cn=new WeakMap,mn=new WeakMap,Br=new WeakMap,yn=new WeakMap,ki=new WeakMap,Hs=new WeakSet,Dl=function(){return s(this,Cn).isLevelEnabled("query")||s(this,Cn).isLevelEnabled("error")},Js=new WeakSet,Ll=function(e){const r=e.executeQuery;e.executeQuery=async n=>{let A;const U=ja();try{return await r.call(e,n)}catch(te){throw A=te,await ke(this,Gs,Rl).call(this,te,n,U),te}finally{A||await ke(this,Ks,Bl).call(this,n,U)}}},Gs=new WeakSet,Rl=async function(e,r,n){await s(this,Cn).error(()=>({level:"error",error:e,query:r,queryDurationMillis:ke(this,Oi,ko).call(this,n)}))},Ks=new WeakSet,Bl=async function(e,r){await s(this,Cn).query(()=>({level:"query",query:e,queryDurationMillis:ke(this,Oi,ko).call(this,r)}))},Oi=new WeakSet,ko=function(e){return ja()-e};const vd=()=>{};var Ti,Pn,Xs,Ql;class Ml{constructor(e){M(this,Xs);M(this,Ti,void 0);M(this,Pn,void 0);H(this,Ti,e)}async provideConnection(e){for(;s(this,Pn);)await s(this,Pn).catch(vd);return H(this,Pn,ke(this,Xs,Ql).call(this,e).finally(()=>{H(this,Pn,void 0)})),s(this,Pn)}}Ti=new WeakMap,Pn=new WeakMap,Xs=new WeakSet,Ql=async function(e){return await e(s(this,Ti))};const xd=["read uncommitted","read committed","repeatable read","serializable","snapshot"];p(["query","error"]);var Fn,ar;class Ed{constructor(e){M(this,Fn,void 0);M(this,ar,void 0);Wt(e)?(H(this,ar,e),H(this,Fn,p({query:!0,error:!0}))):(H(this,ar,Sd),H(this,Fn,p({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return s(this,Fn)[e]}async query(e){s(this,Fn).query&&await s(this,ar).call(this,e())}async error(e){s(this,Fn).error&&await s(this,ar).call(this,e())}}Fn=new WeakMap,ar=new WeakMap;function Sd(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function Ad(t){return nn(t)&&Wt(t.compile)}var _t;const br=class br extends hs{constructor(r){let n,A;if(Id(r))n={executor:r.executor},A={...r};else{const U=r.dialect,te=U.createDriver(),Ae=U.createQueryCompiler(),Le=U.createAdapter(),tt=new Ed(r.log??[]),nt=new Nd(te,tt),Ce=new qd(nt),$e=new Io(Ae,Le,Ce,r.plugins??[]);n={executor:$e},A={config:r,executor:$e,dialect:U,driver:nt}}super(n);M(this,_t,void 0);H(this,_t,p(A))}get schema(){return new Ao(s(this,_t).executor)}get dynamic(){return new bd}get introspection(){return s(this,_t).dialect.createIntrospector(this.withoutPlugins())}case(r){return new Nl({node:rn.create(dr(r)?void 0:hr(r))})}get fn(){return ql()}transaction(){return new Os({...s(this,_t)})}connection(){return new Ul({...s(this,_t)})}withPlugin(r){return new br({...s(this,_t),executor:s(this,_t).executor.withPlugin(r)})}withoutPlugins(){return new br({...s(this,_t),executor:s(this,_t).executor.withoutPlugins()})}withSchema(r){return new br({...s(this,_t),executor:s(this,_t).executor.withPluginAtFront(new Li(r))})}withTables(){return new br({...s(this,_t)})}async destroy(){await s(this,_t).driver.destroy()}get isTransaction(){return!1}getExecutor(){return s(this,_t).executor}executeQuery(r,n=Ue()){const A=Ad(r)?r.compile():r;return this.getExecutor().executeQuery(A,n)}};_t=new WeakMap;let qi=br;var $t;const qr=class qr extends qi{constructor(r){super(r);M(this,$t,void 0);H(this,$t,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new qr({...s(this,$t),executor:s(this,$t).executor.withPlugin(r)})}withoutPlugins(){return new qr({...s(this,$t),executor:s(this,$t).executor.withoutPlugins()})}withSchema(r){return new qr({...s(this,$t),executor:s(this,$t).executor.withPluginAtFront(new Li(r))})}withTables(){return new qr({...s(this,$t)})}};$t=new WeakMap;let Oo=qr;function Id(t){return nn(t)&&nn(t.config)&&nn(t.driver)&&nn(t.executor)&&nn(t.dialect)}var lr;class Ul{constructor(e){M(this,lr,void 0);H(this,lr,p(e))}async execute(e){return s(this,lr).executor.provideConnection(async r=>{const n=s(this,lr).executor.withConnectionProvider(new Ml(r)),A=new qi({...s(this,lr),executor:n});return await e(A)})}}lr=new WeakMap;Se(Ul,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Ht;const na=class na{constructor(e){M(this,Ht,void 0);H(this,Ht,p(e))}setIsolationLevel(e){return new na({...s(this,Ht),isolationLevel:e})}async execute(e){const{isolationLevel:r,...n}=s(this,Ht),A={isolationLevel:r};return kd(A),s(this,Ht).executor.provideConnection(async U=>{const te=s(this,Ht).executor.withConnectionProvider(new Ml(U)),Ae=new Oo({...n,executor:te});try{await s(this,Ht).driver.beginTransaction(U,A);const Le=await e(Ae);return await s(this,Ht).driver.commitTransaction(U),Le}catch(Le){throw await s(this,Ht).driver.rollbackTransaction(U),Le}})}};Ht=new WeakMap;let Os=na;Se(Os,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function kd(t){if(t.isolationLevel&&!xd.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var Et,Mr,Yi,Ci,To,Pi,Co;const pi=class pi{constructor(e){M(this,Mr);M(this,Ci);M(this,Pi);M(this,Et,void 0);H(this,Et,p(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new jl(this,e)}$castTo(){return new pi({...s(this,Et)})}$notNull(){return new pi(s(this,Et))}withPlugin(e){return new pi({...s(this,Et),plugins:s(this,Et).plugins!==void 0?p([...s(this,Et).plugins,e]):p([e])})}toOperationNode(){return ke(this,Ci,To).call(this,ke(this,Mr,Yi).call(this))}compile(e){return ke(this,Pi,Co).call(this,ke(this,Mr,Yi).call(this,e))}async execute(e){const r=ke(this,Mr,Yi).call(this,e);return r.executeQuery(ke(this,Pi,Co).call(this,r),s(this,Et).queryId)}};Et=new WeakMap,Mr=new WeakSet,Yi=function(e){const r=e!==void 0?e.getExecutor():zo;return s(this,Et).plugins!==void 0?r.withPlugins(s(this,Et).plugins):r},Ci=new WeakSet,To=function(e){return e.transformQuery(s(this,Et).rawNode,s(this,Et).queryId)},Pi=new WeakSet,Co=function(e){return e.compileQuery(ke(this,Ci,To).call(this,e),s(this,Et).queryId)};let Ts=pi;function En(t){return new Ts(t)}Se(Ts,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var cr,Wn;class jl{constructor(e,r){M(this,cr,void 0);M(this,Wn,void 0);H(this,cr,e),H(this,Wn,r)}get expression(){return s(this,cr)}get alias(){return s(this,Wn)}get rawBuilder(){return s(this,cr)}toOperationNode(){return Un.create(s(this,cr).toOperationNode(),Dt(s(this,Wn))?s(this,Wn).toOperationNode():Je.create(s(this,Wn)))}}cr=new WeakMap,Wn=new WeakMap;Se(jl,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const lt=Object.assign((t,...e)=>En({queryId:Ue(),rawNode:wt.create(t,e?.map(za)??[])}),{ref(t){return En({queryId:Ue(),rawNode:wt.createWithChild(wn(t))})},val(t){return En({queryId:Ue(),rawNode:wt.createWithChild(ct(t))})},value(t){return this.val(t)},table(t){return En({queryId:Ue(),rawNode:wt.createWithChild(Ze(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",En({queryId:Ue(),rawNode:wt.create(e,t.map(Je.create))})},lit(t){return En({queryId:Ue(),rawNode:wt.createWithChild(bn.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return En({queryId:Ue(),rawNode:wt.createWithSql(t)})},join(t,e=lt`, `){const r=new Array(2*t.length-1),n=e.toOperationNode();for(let A=0;A<t.length;++A)r[2*A]=za(t[A]),A!==t.length-1&&(r[2*A+1]=n);return En({queryId:Ue(),rawNode:wt.createWithChildren(r)})}});function za(t){return Dt(t)?t.toOperationNode():ct(t)}var Ys;class Od{constructor(){We(this,"nodeStack",[]);M(this,Ys,p({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),AddIndexNode:this.visitAddIndex.bind(this)}));We(this,"visitNode",e=>{this.nodeStack.push(e),s(this,Ys)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Ys=new WeakMap;var Qr,ur;class Td extends Od{constructor(){super(...arguments);M(this,Qr,"");M(this,ur,[])}get numParameters(){return s(this,ur).length}compileQuery(r){return H(this,Qr,""),H(this,ur,[]),this.visitNode(r),p({query:r,sql:this.getSql(),parameters:[...s(this,ur)]})}getSql(){return s(this,Qr)}visitSelectQuery(r){const n=this.parentNode!==void 0&&!zr.is(this.parentNode)&&!Jt.is(this.parentNode)&&!kt.is(this.parentNode)&&!Sn.is(this.parentNode)&&!wl.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),r.frontModifiers?.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),r.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),n&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,n=", "){const A=r.length-1;for(let U=0;U<=A;U++)this.visitNode(r[U]),U<A&&this.append(n)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const n=this.nodeStack.find(xe.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.defaultValues&&(this.append(" "),this.append("default values")),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const n=this.nodeStack.find(xe.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!Bt(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:n}=r;for(let A=0;A<n.length;++A)this.appendValue(n[A]),A!==n.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(Pd[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:n,parameters:A}=r;for(let U=0;U<n.length;++U)this.append(n[U]),A.length>U&&this.visitNode(A[U])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),r.selectQuery?(this.append(" as "),this.visitNode(r.selectQuery)):(this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," ")))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.nullsNotDistinct&&this.append(" nulls not distinct"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const n=this.nodeStack.find(xe.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.nullsNotDistinct&&this.append(" nulls not distinct"),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique"),r.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),es(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileColumnAlterations(r.columnAlterations),r.addIndex&&this.visitNode(r.addIndex),r.dropIndex&&this.visitNode(r.dropIndex)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(Cd[r.modifier]),r.of&&(this.append(" of "),this.compileList(r.of,", "))}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return Mn.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const n of r.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(r){const n=r.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(r.value)),n&&this.append("]")}visitJSONOperatorChain(r){for(let n=0,A=r.values.length;n<A;n++)n===A-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[n])}visitAddIndex(r){this.append("add "),r.unique&&this.append("unique "),this.append("index "),this.visitNode(r.name),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.using&&(this.append(" using "),this.visitNode(r.using))}append(r){H(this,Qr,s(this,Qr)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const n=this.getLeftIdentifierWrapper(),A=this.getRightIdentifierWrapper();let U="";for(const te of r)U+=te,te===n?U+=n:te===A&&(U+=A);return U}addParameter(r){s(this,ur).push(r)}appendImmediateValue(r){if(Bt(r))this.append(`'${r}'`);else if(Za(r)||es(r))this.append(r.toString());else if(Wo(r))this.append("null");else if(uu(r))this.appendImmediateValue(r.toISOString());else if(du(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((n,A)=>n.modifier&&A.modifier?Va[n.modifier]-Va[A.modifier]:1),p(r)}compileColumnAlterations(r){this.compileList(r)}announcesNewColumnDataType(){return!0}}Qr=new WeakMap,ur=new WeakMap;const Cd=p({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),Va=p({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Pd=p({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),fr=p({raw(t,e=[]){return p({sql:t,query:wt.createWithSql(t),parameters:p(e)})}});class Fd{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}}const Wd=/"/g;class Dd extends Td{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(Wd,'""')}visitDefaultInsertValue(e){this.append("null")}}const zl="kysely_migration",Vl="kysely_migration_lock";p({__noMigrations__:!0});var Ur,Zs,$l;class Ld{constructor(e){M(this,Zs);M(this,Ur,void 0);H(this,Ur,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=s(this,Ur).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",zl).where("name","!=",Vl));const n=await r.execute();return Promise.all(n.map(({name:A})=>ke(this,Zs,$l).call(this,A)))}async getMetadata(e){return{tables:await this.getTables(e)}}}Ur=new WeakMap,Zs=new WeakSet,$l=async function(e){const r=s(this,Ur),n=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),A=n.sql?.split(/[\(\),]/)?.find(te=>te.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),U=await r.selectFrom(lt`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:U.map(te=>({name:te.name,dataType:te.type,isNullable:!te.notnull,isAutoIncrementing:te.name===A,hasDefaultValue:te.dflt_value!=null}))}};class Rd extends Fd{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var Bd=class{createQueryCompiler(){return new Dd}createAdapter(){return new Rd}createIntrospector(t){return new Ld(t)}},Fi,Xa,Md=(Xa=class{constructor(){M(this,Fi,new Qd);We(this,"connection")}async acquireConnection(){return await s(this,Fi).lock(),this.connection}async beginTransaction(t){await t.executeQuery(fr.raw("begin"))}async commitTransaction(t){await t.executeQuery(fr.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(fr.raw("rollback"))}async releaseConnection(){s(this,Fi).unlock()}},Fi=new WeakMap,Xa),Qd=class{constructor(){We(this,"promise");We(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t?.()}},Ud=class{streamQuery(){throw new Error("sqlite-wasm driver doesn't support streaming")}async executeQuery({parameters:t,query:e,sql:r}){const n=await this.query(r,t);return Ie.is(e)||n.length?{rows:n}:{rows:n,...await this.info()}}},jd=class extends Md{constructor(e){super();We(this,"config");We(this,"db");this.config=e}async init(){this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,this.connection=new zd(this.db),await this.config.onCreateConnection?.(this.connection)}async destroy(){this.db?.close()}},zd=class extends Ud{constructor(e){super();We(this,"db");this.db=e}async query(e,r){return this.db.selectObjects(e,r)}async info(){return{insertId:BigInt(this.db.selectArray("SELECT last_insert_rowid()")[0]),numAffectedRows:BigInt(this.db.changes(!1,!0))}}},Wi,Ya,Vd=(Ya=class extends Bd{constructor(e){super();M(this,Wi,void 0);H(this,Wi,e)}createDriver(){return new jd(s(this,Wi))}},Wi=new WeakMap,Ya),Xo=(()=>{var t=import.meta.url;return function(e){var r=e||{},n=typeof r<"u"?r:{},A,U;n.ready=new Promise(function(o,i){A=o,U=i});const te=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,te.debugModule("globalThis.location =",globalThis.location);const Ae="emscripten-bug-17951";n[Ae]=function o(i,l){i.env.foo=function(){};const a=n.locateFile(o.uri,typeof $e>"u"?"":$e);te.debugModule("instantiateWasm() uri =",a);const c=()=>fetch(a,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(c(),i).then(w=>l(w.instance,w.module)):async()=>c().then(w=>w.arrayBuffer()).then(w=>WebAssembly.instantiate(w,i)).then(w=>l(w.instance,w.module)))(),{}},n[Ae].uri="sqlite3.wasm";var Le=Object.assign({},n),tt="./this.program",nt=typeof window=="object",Ce=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var $e="";function sn(o){return n.locateFile?n.locateFile(o,$e):$e+o}var Nn,Gt,vn;(nt||Ce)&&(Ce?$e=self.location.href:typeof document<"u"&&document.currentScript&&($e=document.currentScript.src),t&&($e=t),$e.indexOf("blob:")!==0?$e=$e.substr(0,$e.replace(/[?#].*/,"").lastIndexOf("/")+1):$e="",Nn=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.send(null),i.responseText},Ce&&(vn=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.responseType="arraybuffer",i.send(null),new Uint8Array(i.response)}),Gt=(o,i,l)=>{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onload=()=>{if(a.status==200||a.status==0&&a.response){i(a.response);return}l()},a.onerror=l,a.send(null)});var we=n.print||console.log.bind(console),mt=n.printErr||console.warn.bind(console);Object.assign(n,Le),Le=null,n.arguments&&n.arguments,n.thisProgram&&(tt=n.thisProgram),n.quit&&n.quit;var on;n.wasmBinary&&(on=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&_r("no native wasm support detected");var Kt,Bi=!1;function jn(o,i){o||_r(i)}var yt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Mt(o,i,l){for(var a=i+l,c=i;o[c]&&!(c>=a);)++c;if(c-i>16&&o.buffer&&yt)return yt.decode(o.subarray(i,c));for(var d="";i<c;){var w=o[i++];if(!(w&128)){d+=String.fromCharCode(w);continue}var I=o[i++]&63;if((w&224)==192){d+=String.fromCharCode((w&31)<<6|I);continue}var W=o[i++]&63;if((w&240)==224?w=(w&15)<<12|I<<6|W:w=(w&7)<<18|I<<12|W<<6|o[i++]&63,w<65536)d+=String.fromCharCode(w);else{var J=w-65536;d+=String.fromCharCode(55296|J>>10,56320|J&1023)}}return d}function io(o,i){return o?Mt(pr,o,i):""}function xn(o,i,l,a){if(!(a>0))return 0;for(var c=l,d=l+a-1,w=0;w<o.length;++w){var I=o.charCodeAt(w);if(I>=55296&&I<=57343){var W=o.charCodeAt(++w);I=65536+((I&1023)<<10)|W&1023}if(I<=127){if(l>=d)break;i[l++]=I}else if(I<=2047){if(l+1>=d)break;i[l++]=192|I>>6,i[l++]=128|I&63}else if(I<=65535){if(l+2>=d)break;i[l++]=224|I>>12,i[l++]=128|I>>6&63,i[l++]=128|I&63}else{if(l+3>=d)break;i[l++]=240|I>>18,i[l++]=128|I>>12&63,i[l++]=128|I>>6&63,i[l++]=128|I&63}}return i[l]=0,l-c}function ra(o,i,l){return xn(o,pr,i,l)}function Kr(o){for(var i=0,l=0;l<o.length;++l){var a=o.charCodeAt(l);a<=127?i++:a<=2047?i+=2:a>=55296&&a<=57343?(i+=4,++l):i+=3}return i}var It,pr,ia,ve,Xe;function sa(){var o=Kt.buffer;n.HEAP8=It=new Int8Array(o),n.HEAP16=ia=new Int16Array(o),n.HEAP32=ve=new Int32Array(o),n.HEAPU8=pr=new Uint8Array(o),n.HEAPU16=new Uint16Array(o),n.HEAPU32=Xe=new Uint32Array(o),n.HEAPF32=new Float32Array(o),n.HEAPF64=new Float64Array(o),n.HEAP64=new BigInt64Array(o),n.HEAPU64=new BigUint64Array(o)}var oa=n.INITIAL_MEMORY||16777216;n.wasmMemory?Kt=n.wasmMemory:Kt=new WebAssembly.Memory({initial:oa/65536,maximum:2147483648/65536}),sa(),oa=Kt.buffer.byteLength;var aa=[],la=[],ca=[];function Zl(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)nc(n.preRun.shift());oo(aa)}function ec(){!n.noFSInit&&!u.init.initialized&&u.init(),u.ignorePermissions=!1,oo(la)}function tc(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)ic(n.postRun.shift());oo(ca)}function nc(o){aa.unshift(o)}function rc(o){la.unshift(o)}function ic(o){ca.unshift(o)}var zn=0,Xr=null;function qf(o){return o}function so(o){zn++,n.monitorRunDependencies&&n.monitorRunDependencies(zn)}function Mi(o){if(zn--,n.monitorRunDependencies&&n.monitorRunDependencies(zn),zn==0&&Xr){var i=Xr;Xr=null,i()}}function _r(o){n.onAbort&&n.onAbort(o),o="Aborted("+o+")",mt(o),Bi=!0,o+=". Build with -sASSERTIONS for more info.";var i=new WebAssembly.RuntimeError(o);throw U(i),i}var sc="data:application/octet-stream;base64,";function ua(o){return o.startsWith(sc)}var Lt;n.locateFile?(Lt="sqlite3.wasm",ua(Lt)||(Lt=sn(Lt))):Lt=new URL(""+new URL("sqlite3-x8y6ojKa.wasm",import.meta.url).href,import.meta.url).href;function da(o){try{if(o==Lt&&on)return new Uint8Array(on);if(vn)return vn(o);throw"both async and sync fetching of the wasm failed"}catch(i){_r(i)}}function oc(){return!on&&(nt||Ce)&&typeof fetch=="function"?fetch(Lt,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+Lt+"'";return o.arrayBuffer()}).catch(function(){return da(Lt)}):Promise.resolve().then(function(){return da(Lt)})}function ac(){var o={env:ya,wasi_snapshot_preview1:ya};function i(w,I){var W=w.exports;n.asm=W,n.asm.__indirect_function_table,rc(n.asm.__wasm_call_ctors),Mi()}so();function l(w){i(w.instance)}function a(w){return oc().then(function(I){return WebAssembly.instantiate(I,o)}).then(function(I){return I}).then(w,function(I){mt("failed to asynchronously prepare wasm: "+I),_r(I)})}function c(){return!on&&typeof WebAssembly.instantiateStreaming=="function"&&!ua(Lt)&&typeof fetch=="function"?fetch(Lt,{credentials:"same-origin"}).then(function(w){var I=WebAssembly.instantiateStreaming(w,o);return I.then(l,function(W){return mt("wasm streaming compile failed: "+W),mt("falling back to ArrayBuffer instantiation"),a(l)})}):a(l)}if(n.instantiateWasm)try{var d=n.instantiateWasm(o,i);return d}catch(w){mt("Module.instantiateWasm callback failed with error: "+w),U(w)}return c().catch(U),{}}var Ee,ut;function oo(o){for(;o.length>0;)o.shift()(n)}var Te={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return i.exec(o).slice(1)},normalizeArray:(o,i)=>{for(var l=0,a=o.length-1;a>=0;a--){var c=o[a];c==="."?o.splice(a,1):c===".."?(o.splice(a,1),l++):l&&(o.splice(a,1),l--)}if(i)for(;l;l--)o.unshift("..");return o},normalize:o=>{var i=Te.isAbs(o),l=o.substr(-1)==="/";return o=Te.normalizeArray(o.split("/").filter(a=>!!a),!i).join("/"),!o&&!i&&(o="."),o&&l&&(o+="/"),(i?"/":"")+o},dirname:o=>{var i=Te.splitPath(o),l=i[0],a=i[1];return!l&&!a?".":(a&&(a=a.substr(0,a.length-1)),l+a)},basename:o=>{if(o==="/")return"/";o=Te.normalize(o),o=o.replace(/\/$/,"");var i=o.lastIndexOf("/");return i===-1?o:o.substr(i+1)},join:function(){var o=Array.prototype.slice.call(arguments);return Te.normalize(o.join("/"))},join2:(o,i)=>Te.normalize(o+"/"+i)};function lc(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var o=new Uint8Array(1);return()=>(crypto.getRandomValues(o),o[0])}else return()=>_r("randomDevice")}var an={resolve:function(){for(var o="",i=!1,l=arguments.length-1;l>=-1&&!i;l--){var a=l>=0?arguments[l]:u.cwd();if(typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";o=a+"/"+o,i=Te.isAbs(a)}return o=Te.normalizeArray(o.split("/").filter(c=>!!c),!i).join("/"),(i?"/":"")+o||"."},relative:(o,i)=>{o=an.resolve(o).substr(1),i=an.resolve(i).substr(1);function l(J){for(var ee=0;ee<J.length&&J[ee]==="";ee++);for(var se=J.length-1;se>=0&&J[se]==="";se--);return ee>se?[]:J.slice(ee,se-ee+1)}for(var a=l(o.split("/")),c=l(i.split("/")),d=Math.min(a.length,c.length),w=d,I=0;I<d;I++)if(a[I]!==c[I]){w=I;break}for(var W=[],I=w;I<a.length;I++)W.push("..");return W=W.concat(c.slice(w)),W.join("/")}};function ao(o,i,l){var a=l>0?l:Kr(o)+1,c=new Array(a),d=xn(o,c,0,c.length);return i&&(c.length=d),c}var Vn={ttys:[],init:function(){},shutdown:function(){},register:function(o,i){Vn.ttys[o]={input:[],output:[],ops:i},u.registerDevice(o,Vn.stream_ops)},stream_ops:{open:function(o){var i=Vn.ttys[o.node.rdev];if(!i)throw new u.ErrnoError(43);o.tty=i,o.seekable=!1},close:function(o){o.tty.ops.fsync(o.tty)},fsync:function(o){o.tty.ops.fsync(o.tty)},read:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.get_char)throw new u.ErrnoError(60);for(var d=0,w=0;w<a;w++){var I;try{I=o.tty.ops.get_char(o.tty)}catch{throw new u.ErrnoError(29)}if(I===void 0&&d===0)throw new u.ErrnoError(6);if(I==null)break;d++,i[l+w]=I}return d&&(o.node.timestamp=Date.now()),d},write:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var d=0;d<a;d++)o.tty.ops.put_char(o.tty,i[l+d])}catch{throw new u.ErrnoError(29)}return a&&(o.node.timestamp=Date.now()),d}},default_tty_ops:{get_char:function(o){if(!o.input.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i)return null;o.input=ao(i,!0)}return o.input.shift()},put_char:function(o,i){i===null||i===10?(we(Mt(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(we(Mt(o.output,0)),o.output=[])}},default_tty1_ops:{put_char:function(o,i){i===null||i===10?(mt(Mt(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(mt(Mt(o.output,0)),o.output=[])}}};function cc(o,i){return pr.fill(0,o,o+i),o}function uc(o,i){return Math.ceil(o/i)*i}function fa(o){o=uc(o,65536);var i=ba(65536,o);return i?cc(i,o):0}var ye={ops_table:null,mount:function(o){return ye.createNode(null,"/",16895,0)},createNode:function(o,i,l,a){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);ye.ops_table||(ye.ops_table={dir:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,lookup:ye.node_ops.lookup,mknod:ye.node_ops.mknod,rename:ye.node_ops.rename,unlink:ye.node_ops.unlink,rmdir:ye.node_ops.rmdir,readdir:ye.node_ops.readdir,symlink:ye.node_ops.symlink},stream:{llseek:ye.stream_ops.llseek}},file:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:{llseek:ye.stream_ops.llseek,read:ye.stream_ops.read,write:ye.stream_ops.write,allocate:ye.stream_ops.allocate,mmap:ye.stream_ops.mmap,msync:ye.stream_ops.msync}},link:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,readlink:ye.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:u.chrdev_stream_ops}});var c=u.createNode(o,i,l,a);return u.isDir(c.mode)?(c.node_ops=ye.ops_table.dir.node,c.stream_ops=ye.ops_table.dir.stream,c.contents={}):u.isFile(c.mode)?(c.node_ops=ye.ops_table.file.node,c.stream_ops=ye.ops_table.file.stream,c.usedBytes=0,c.contents=null):u.isLink(c.mode)?(c.node_ops=ye.ops_table.link.node,c.stream_ops=ye.ops_table.link.stream):u.isChrdev(c.mode)&&(c.node_ops=ye.ops_table.chrdev.node,c.stream_ops=ye.ops_table.chrdev.stream),c.timestamp=Date.now(),o&&(o.contents[i]=c,o.timestamp=c.timestamp),c},getFileDataAsTypedArray:function(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage:function(o,i){var l=o.contents?o.contents.length:0;if(!(l>=i)){var a=1024*1024;i=Math.max(i,l*(l<a?2:1.125)>>>0),l!=0&&(i=Math.max(i,256));var c=o.contents;o.contents=new Uint8Array(i),o.usedBytes>0&&o.contents.set(c.subarray(0,o.usedBytes),0)}},resizeFileStorage:function(o,i){if(o.usedBytes!=i)if(i==0)o.contents=null,o.usedBytes=0;else{var l=o.contents;o.contents=new Uint8Array(i),l&&o.contents.set(l.subarray(0,Math.min(i,o.usedBytes))),o.usedBytes=i}},node_ops:{getattr:function(o){var i={};return i.dev=u.isChrdev(o.mode)?o.id:1,i.ino=o.id,i.mode=o.mode,i.nlink=1,i.uid=0,i.gid=0,i.rdev=o.rdev,u.isDir(o.mode)?i.size=4096:u.isFile(o.mode)?i.size=o.usedBytes:u.isLink(o.mode)?i.size=o.link.length:i.size=0,i.atime=new Date(o.timestamp),i.mtime=new Date(o.timestamp),i.ctime=new Date(o.timestamp),i.blksize=4096,i.blocks=Math.ceil(i.size/i.blksize),i},setattr:function(o,i){i.mode!==void 0&&(o.mode=i.mode),i.timestamp!==void 0&&(o.timestamp=i.timestamp),i.size!==void 0&&ye.resizeFileStorage(o,i.size)},lookup:function(o,i){throw u.genericErrors[44]},mknod:function(o,i,l,a){return ye.createNode(o,i,l,a)},rename:function(o,i,l){if(u.isDir(o.mode)){var a;try{a=u.lookupNode(i,l)}catch{}if(a)for(var c in a.contents)throw new u.ErrnoError(55)}delete o.parent.contents[o.name],o.parent.timestamp=Date.now(),o.name=l,i.contents[l]=o,i.timestamp=o.parent.timestamp,o.parent=i},unlink:function(o,i){delete o.contents[i],o.timestamp=Date.now()},rmdir:function(o,i){var l=u.lookupNode(o,i);for(var a in l.contents)throw new u.ErrnoError(55);delete o.contents[i],o.timestamp=Date.now()},readdir:function(o){var i=[".",".."];for(var l in o.contents)o.contents.hasOwnProperty(l)&&i.push(l);return i},symlink:function(o,i,l){var a=ye.createNode(o,i,41471,0);return a.link=l,a},readlink:function(o){if(!u.isLink(o.mode))throw new u.ErrnoError(28);return o.link}},stream_ops:{read:function(o,i,l,a,c){var d=o.node.contents;if(c>=o.node.usedBytes)return 0;var w=Math.min(o.node.usedBytes-c,a);if(w>8&&d.subarray)i.set(d.subarray(c,c+w),l);else for(var I=0;I<w;I++)i[l+I]=d[c+I];return w},write:function(o,i,l,a,c,d){if(i.buffer===It.buffer&&(d=!1),!a)return 0;var w=o.node;if(w.timestamp=Date.now(),i.subarray&&(!w.contents||w.contents.subarray)){if(d)return w.contents=i.subarray(l,l+a),w.usedBytes=a,a;if(w.usedBytes===0&&c===0)return w.contents=i.slice(l,l+a),w.usedBytes=a,a;if(c+a<=w.usedBytes)return w.contents.set(i.subarray(l,l+a),c),a}if(ye.expandFileStorage(w,c+a),w.contents.subarray&&i.subarray)w.contents.set(i.subarray(l,l+a),c);else for(var I=0;I<a;I++)w.contents[c+I]=i[l+I];return w.usedBytes=Math.max(w.usedBytes,c+a),a},llseek:function(o,i,l){var a=i;if(l===1?a+=o.position:l===2&&u.isFile(o.node.mode)&&(a+=o.node.usedBytes),a<0)throw new u.ErrnoError(28);return a},allocate:function(o,i,l){ye.expandFileStorage(o.node,i+l),o.node.usedBytes=Math.max(o.node.usedBytes,i+l)},mmap:function(o,i,l,a,c){if(!u.isFile(o.node.mode))throw new u.ErrnoError(43);var d,w,I=o.node.contents;if(!(c&2)&&I.buffer===It.buffer)w=!1,d=I.byteOffset;else{if((l>0||l+i<I.length)&&(I.subarray?I=I.subarray(l,l+i):I=Array.prototype.slice.call(I,l,l+i)),w=!0,d=fa(i),!d)throw new u.ErrnoError(48);It.set(I,d)}return{ptr:d,allocated:w}},msync:function(o,i,l,a,c){return ye.stream_ops.write(o,i,0,a,l,!1),0}}};function dc(o,i,l,a){var c=a?"":"al "+o;Gt(o,d=>{jn(d,'Loading data file "'+o+'" failed (no arrayBuffer).'),i(new Uint8Array(d)),c&&Mi()},d=>{if(l)l();else throw'Loading data file "'+o+'" failed.'}),c&&so()}var u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(o,i={})=>{if(o=an.resolve(o),!o)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(i=Object.assign(l,i),i.recurse_count>8)throw new u.ErrnoError(32);for(var a=o.split("/").filter(se=>!!se),c=u.root,d="/",w=0;w<a.length;w++){var I=w===a.length-1;if(I&&i.parent)break;if(c=u.lookupNode(c,a[w]),d=Te.join2(d,a[w]),u.isMountpoint(c)&&(!I||I&&i.follow_mount)&&(c=c.mounted.root),!I||i.follow)for(var W=0;u.isLink(c.mode);){var J=u.readlink(d);d=an.resolve(Te.dirname(d),J);var ee=u.lookupPath(d,{recurse_count:i.recurse_count+1});if(c=ee.node,W++>40)throw new u.ErrnoError(32)}}return{path:d,node:c}},getPath:o=>{for(var i;;){if(u.isRoot(o)){var l=o.mount.mountpoint;return i?l[l.length-1]!=="/"?l+"/"+i:l+i:l}i=i?o.name+"/"+i:o.name,o=o.parent}},hashName:(o,i)=>{for(var l=0,a=0;a<i.length;a++)l=(l<<5)-l+i.charCodeAt(a)|0;return(o+l>>>0)%u.nameTable.length},hashAddNode:o=>{var i=u.hashName(o.parent.id,o.name);o.name_next=u.nameTable[i],u.nameTable[i]=o},hashRemoveNode:o=>{var i=u.hashName(o.parent.id,o.name);if(u.nameTable[i]===o)u.nameTable[i]=o.name_next;else for(var l=u.nameTable[i];l;){if(l.name_next===o){l.name_next=o.name_next;break}l=l.name_next}},lookupNode:(o,i)=>{var l=u.mayLookup(o);if(l)throw new u.ErrnoError(l,o);for(var a=u.hashName(o.id,i),c=u.nameTable[a];c;c=c.name_next){var d=c.name;if(c.parent.id===o.id&&d===i)return c}return u.lookup(o,i)},createNode:(o,i,l,a)=>{var c=new u.FSNode(o,i,l,a);return u.hashAddNode(c),c},destroyNode:o=>{u.hashRemoveNode(o)},isRoot:o=>o===o.parent,isMountpoint:o=>!!o.mounted,isFile:o=>(o&61440)===32768,isDir:o=>(o&61440)===16384,isLink:o=>(o&61440)===40960,isChrdev:o=>(o&61440)===8192,isBlkdev:o=>(o&61440)===24576,isFIFO:o=>(o&61440)===4096,isSocket:o=>(o&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:o=>{var i=u.flagModes[o];if(typeof i>"u")throw new Error("Unknown file open mode: "+o);return i},flagsToPermissionString:o=>{var i=["r","w","rw"][o&3];return o&512&&(i+="w"),i},nodePermissions:(o,i)=>u.ignorePermissions?0:i.includes("r")&&!(o.mode&292)||i.includes("w")&&!(o.mode&146)||i.includes("x")&&!(o.mode&73)?2:0,mayLookup:o=>{var i=u.nodePermissions(o,"x");return i||(o.node_ops.lookup?0:2)},mayCreate:(o,i)=>{try{var l=u.lookupNode(o,i);return 20}catch{}return u.nodePermissions(o,"wx")},mayDelete:(o,i,l)=>{var a;try{a=u.lookupNode(o,i)}catch(d){return d.errno}var c=u.nodePermissions(o,"wx");if(c)return c;if(l){if(!u.isDir(a.mode))return 54;if(u.isRoot(a)||u.getPath(a)===u.cwd())return 10}else if(u.isDir(a.mode))return 31;return 0},mayOpen:(o,i)=>o?u.isLink(o.mode)?32:u.isDir(o.mode)&&(u.flagsToPermissionString(i)!=="r"||i&512)?31:u.nodePermissions(o,u.flagsToPermissionString(i)):44,MAX_OPEN_FDS:4096,nextfd:(o=0,i=u.MAX_OPEN_FDS)=>{for(var l=o;l<=i;l++)if(!u.streams[l])return l;throw new u.ErrnoError(33)},getStream:o=>u.streams[o],createStream:(o,i,l)=>{u.FSStream||(u.FSStream=function(){this.shared={}},u.FSStream.prototype={},Object.defineProperties(u.FSStream.prototype,{object:{get:function(){return this.node},set:function(c){this.node=c}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(c){this.shared.flags=c}},position:{get:function(){return this.shared.position},set:function(c){this.shared.position=c}}})),o=Object.assign(new u.FSStream,o);var a=u.nextfd(i,l);return o.fd=a,u.streams[a]=o,o},closeStream:o=>{u.streams[o]=null},chrdev_stream_ops:{open:o=>{var i=u.getDevice(o.node.rdev);o.stream_ops=i.stream_ops,o.stream_ops.open&&o.stream_ops.open(o)},llseek:()=>{throw new u.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,i)=>o<<8|i,registerDevice:(o,i)=>{u.devices[o]={stream_ops:i}},getDevice:o=>u.devices[o],getMounts:o=>{for(var i=[],l=[o];l.length;){var a=l.pop();i.push(a),l.push.apply(l,a.mounts)}return i},syncfs:(o,i)=>{typeof o=="function"&&(i=o,o=!1),u.syncFSRequests++,u.syncFSRequests>1&&mt("warning: "+u.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=u.getMounts(u.root.mount),a=0;function c(w){return u.syncFSRequests--,i(w)}function d(w){if(w)return d.errored?void 0:(d.errored=!0,c(w));++a>=l.length&&c(null)}l.forEach(w=>{if(!w.type.syncfs)return d(null);w.type.syncfs(w,o,d)})},mount:(o,i,l)=>{var a=l==="/",c=!l,d;if(a&&u.root)throw new u.ErrnoError(10);if(!a&&!c){var w=u.lookupPath(l,{follow_mount:!1});if(l=w.path,d=w.node,u.isMountpoint(d))throw new u.ErrnoError(10);if(!u.isDir(d.mode))throw new u.ErrnoError(54)}var I={type:o,opts:i,mountpoint:l,mounts:[]},W=o.mount(I);return W.mount=I,I.root=W,a?u.root=W:d&&(d.mounted=I,d.mount&&d.mount.mounts.push(I)),W},unmount:o=>{var i=u.lookupPath(o,{follow_mount:!1});if(!u.isMountpoint(i.node))throw new u.ErrnoError(28);var l=i.node,a=l.mounted,c=u.getMounts(a);Object.keys(u.nameTable).forEach(w=>{for(var I=u.nameTable[w];I;){var W=I.name_next;c.includes(I.mount)&&u.destroyNode(I),I=W}}),l.mounted=null;var d=l.mount.mounts.indexOf(a);l.mount.mounts.splice(d,1)},lookup:(o,i)=>o.node_ops.lookup(o,i),mknod:(o,i,l)=>{var a=u.lookupPath(o,{parent:!0}),c=a.node,d=Te.basename(o);if(!d||d==="."||d==="..")throw new u.ErrnoError(28);var w=u.mayCreate(c,d);if(w)throw new u.ErrnoError(w);if(!c.node_ops.mknod)throw new u.ErrnoError(63);return c.node_ops.mknod(c,d,i,l)},create:(o,i)=>(i=i!==void 0?i:438,i&=4095,i|=32768,u.mknod(o,i,0)),mkdir:(o,i)=>(i=i!==void 0?i:511,i&=1023,i|=16384,u.mknod(o,i,0)),mkdirTree:(o,i)=>{for(var l=o.split("/"),a="",c=0;c<l.length;++c)if(l[c]){a+="/"+l[c];try{u.mkdir(a,i)}catch(d){if(d.errno!=20)throw d}}},mkdev:(o,i,l)=>(typeof l>"u"&&(l=i,i=438),i|=8192,u.mknod(o,i,l)),symlink:(o,i)=>{if(!an.resolve(o))throw new u.ErrnoError(44);var l=u.lookupPath(i,{parent:!0}),a=l.node;if(!a)throw new u.ErrnoError(44);var c=Te.basename(i),d=u.mayCreate(a,c);if(d)throw new u.ErrnoError(d);if(!a.node_ops.symlink)throw new u.ErrnoError(63);return a.node_ops.symlink(a,c,o)},rename:(o,i)=>{var l=Te.dirname(o),a=Te.dirname(i),c=Te.basename(o),d=Te.basename(i),w,I,W;if(w=u.lookupPath(o,{parent:!0}),I=w.node,w=u.lookupPath(i,{parent:!0}),W=w.node,!I||!W)throw new u.ErrnoError(44);if(I.mount!==W.mount)throw new u.ErrnoError(75);var J=u.lookupNode(I,c),ee=an.relative(o,a);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=an.relative(i,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var se;try{se=u.lookupNode(W,d)}catch{}if(J!==se){var T=u.isDir(J.mode),g=u.mayDelete(I,c,T);if(g)throw new u.ErrnoError(g);if(g=se?u.mayDelete(W,d,T):u.mayCreate(W,d),g)throw new u.ErrnoError(g);if(!I.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(J)||se&&u.isMountpoint(se))throw new u.ErrnoError(10);if(W!==I&&(g=u.nodePermissions(I,"w"),g))throw new u.ErrnoError(g);u.hashRemoveNode(J);try{I.node_ops.rename(J,W,d)}catch(y){throw y}finally{u.hashAddNode(J)}}},rmdir:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node,a=Te.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!0);if(d)throw new u.ErrnoError(d);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.rmdir(l,a),u.destroyNode(c)},readdir:o=>{var i=u.lookupPath(o,{follow:!0}),l=i.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node;if(!l)throw new u.ErrnoError(44);var a=Te.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!1);if(d)throw new u.ErrnoError(d);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.unlink(l,a),u.destroyNode(c)},readlink:o=>{var i=u.lookupPath(o),l=i.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return an.resolve(u.getPath(l.parent),l.node_ops.readlink(l))},stat:(o,i)=>{var l=u.lookupPath(o,{follow:!i}),a=l.node;if(!a)throw new u.ErrnoError(44);if(!a.node_ops.getattr)throw new u.ErrnoError(63);return a.node_ops.getattr(a)},lstat:o=>u.stat(o,!0),chmod:(o,i,l)=>{var a;if(typeof o=="string"){var c=u.lookupPath(o,{follow:!l});a=c.node}else a=o;if(!a.node_ops.setattr)throw new u.ErrnoError(63);a.node_ops.setattr(a,{mode:i&4095|a.mode&-4096,timestamp:Date.now()})},lchmod:(o,i)=>{u.chmod(o,i,!0)},fchmod:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);u.chmod(l.node,i)},chown:(o,i,l,a)=>{var c;if(typeof o=="string"){var d=u.lookupPath(o,{follow:!a});c=d.node}else c=o;if(!c.node_ops.setattr)throw new u.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown:(o,i,l)=>{u.chown(o,i,l,!0)},fchown:(o,i,l)=>{var a=u.getStream(o);if(!a)throw new u.ErrnoError(8);u.chown(a.node,i,l)},truncate:(o,i)=>{if(i<0)throw new u.ErrnoError(28);var l;if(typeof o=="string"){var a=u.lookupPath(o,{follow:!0});l=a.node}else l=o;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var c=u.nodePermissions(l,"w");if(c)throw new u.ErrnoError(c);l.node_ops.setattr(l,{size:i,timestamp:Date.now()})},ftruncate:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,i)},utime:(o,i,l)=>{var a=u.lookupPath(o,{follow:!0}),c=a.node;c.node_ops.setattr(c,{timestamp:Math.max(i,l)})},open:(o,i,l)=>{if(o==="")throw new u.ErrnoError(44);i=typeof i=="string"?u.modeStringToFlags(i):i,l=typeof l>"u"?438:l,i&64?l=l&4095|32768:l=0;var a;if(typeof o=="object")a=o;else{o=Te.normalize(o);try{var c=u.lookupPath(o,{follow:!(i&131072)});a=c.node}catch{}}var d=!1;if(i&64)if(a){if(i&128)throw new u.ErrnoError(20)}else a=u.mknod(o,l,0),d=!0;if(!a)throw new u.ErrnoError(44);if(u.isChrdev(a.mode)&&(i&=-513),i&65536&&!u.isDir(a.mode))throw new u.ErrnoError(54);if(!d){var w=u.mayOpen(a,i);if(w)throw new u.ErrnoError(w)}i&512&&!d&&u.truncate(a,0),i&=-131713;var I=u.createStream({node:a,path:u.getPath(a),flags:i,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1});return I.stream_ops.open&&I.stream_ops.open(I),n.logReadFiles&&!(i&1)&&(u.readFiles||(u.readFiles={}),o in u.readFiles||(u.readFiles[o]=1)),I},close:o=>{if(u.isClosed(o))throw new u.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(i){throw i}finally{u.closeStream(o.fd)}o.fd=null},isClosed:o=>o.fd===null,llseek:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return o.position=o.stream_ops.llseek(o,i,l),o.ungotten=[],o.position},read:(o,i,l,a,c)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if((o.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.read)throw new u.ErrnoError(28);var d=typeof c<"u";if(!d)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var w=o.stream_ops.read(o,i,l,a,c);return d||(o.position+=w),w},write:(o,i,l,a,c,d)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.write)throw new u.ErrnoError(28);o.seekable&&o.flags&1024&&u.llseek(o,0,2);var w=typeof c<"u";if(!w)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var I=o.stream_ops.write(o,i,l,a,c,d);return w||(o.position+=I),I},allocate:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(i<0||l<=0)throw new u.ErrnoError(28);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(o.node.mode)&&!u.isDir(o.node.mode))throw new u.ErrnoError(43);if(!o.stream_ops.allocate)throw new u.ErrnoError(138);o.stream_ops.allocate(o,i,l)},mmap:(o,i,l,a,c)=>{if(a&2&&!(c&2)&&(o.flags&2097155)!==2)throw new u.ErrnoError(2);if((o.flags&2097155)===1)throw new u.ErrnoError(2);if(!o.stream_ops.mmap)throw new u.ErrnoError(43);return o.stream_ops.mmap(o,i,l,a,c)},msync:(o,i,l,a,c)=>o.stream_ops.msync?o.stream_ops.msync(o,i,l,a,c):0,munmap:o=>0,ioctl:(o,i,l)=>{if(!o.stream_ops.ioctl)throw new u.ErrnoError(59);return o.stream_ops.ioctl(o,i,l)},readFile:(o,i={})=>{if(i.flags=i.flags||0,i.encoding=i.encoding||"binary",i.encoding!=="utf8"&&i.encoding!=="binary")throw new Error('Invalid encoding type "'+i.encoding+'"');var l,a=u.open(o,i.flags),c=u.stat(o),d=c.size,w=new Uint8Array(d);return u.read(a,w,0,d,0),i.encoding==="utf8"?l=Mt(w,0):i.encoding==="binary"&&(l=w),u.close(a),l},writeFile:(o,i,l={})=>{l.flags=l.flags||577;var a=u.open(o,l.flags,l.mode);if(typeof i=="string"){var c=new Uint8Array(Kr(i)+1),d=xn(i,c,0,c.length);u.write(a,c,0,d,void 0,l.canOwn)}else if(ArrayBuffer.isView(i))u.write(a,i,0,i.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(a)},cwd:()=>u.currentPath,chdir:o=>{var i=u.lookupPath(o,{follow:!0});if(i.node===null)throw new u.ErrnoError(44);if(!u.isDir(i.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(i.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=i.path},createDefaultDirectories:()=>{u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices:()=>{u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(i,l,a,c,d)=>c}),u.mkdev("/dev/null",u.makedev(1,3)),Vn.register(u.makedev(5,0),Vn.default_tty_ops),Vn.register(u.makedev(6,0),Vn.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var o=lc();u.createDevice("/dev","random",o),u.createDevice("/dev","urandom",o),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{u.mkdir("/proc");var o=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount:()=>{var i=u.createNode(o,"fd",16895,73);return i.node_ops={lookup:(l,a)=>{var c=+a,d=u.getStream(c);if(!d)throw new u.ErrnoError(8);var w={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>d.path}};return w.parent=w,w}},i}},{},"/proc/self/fd")},createStandardStreams:()=>{n.stdin?u.createDevice("/dev","stdin",n.stdin):u.symlink("/dev/tty","/dev/stdin"),n.stdout?u.createDevice("/dev","stdout",null,n.stdout):u.symlink("/dev/tty","/dev/stdout"),n.stderr?u.createDevice("/dev","stderr",null,n.stderr):u.symlink("/dev/tty1","/dev/stderr"),u.open("/dev/stdin",0),u.open("/dev/stdout",1),u.open("/dev/stderr",1)},ensureErrnoError:()=>{u.ErrnoError||(u.ErrnoError=function(i,l){this.node=l,this.setErrno=function(a){this.errno=a},this.setErrno(i),this.message="FS error"},u.ErrnoError.prototype=new Error,u.ErrnoError.prototype.constructor=u.ErrnoError,[44].forEach(o=>{u.genericErrors[o]=new u.ErrnoError(o),u.genericErrors[o].stack="<generic error, no stack>"}))},staticInit:()=>{u.ensureErrnoError(),u.nameTable=new Array(4096),u.mount(ye,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:ye}},init:(o,i,l)=>{u.init.initialized=!0,u.ensureErrnoError(),n.stdin=o||n.stdin,n.stdout=i||n.stdout,n.stderr=l||n.stderr,u.createStandardStreams()},quit:()=>{u.init.initialized=!1;for(var o=0;o<u.streams.length;o++){var i=u.streams[o];i&&u.close(i)}},getMode:(o,i)=>{var l=0;return o&&(l|=365),i&&(l|=146),l},findObject:(o,i)=>{var l=u.analyzePath(o,i);return l.exists?l.object:null},analyzePath:(o,i)=>{try{var l=u.lookupPath(o,{follow:!i});o=l.path}catch{}var a={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(o,{parent:!0});a.parentExists=!0,a.parentPath=l.path,a.parentObject=l.node,a.name=Te.basename(o),l=u.lookupPath(o,{follow:!i}),a.exists=!0,a.path=l.path,a.object=l.node,a.name=l.node.name,a.isRoot=l.path==="/"}catch(c){a.error=c.errno}return a},createPath:(o,i,l,a)=>{o=typeof o=="string"?o:u.getPath(o);for(var c=i.split("/").reverse();c.length;){var d=c.pop();if(d){var w=Te.join2(o,d);try{u.mkdir(w)}catch{}o=w}}return w},createFile:(o,i,l,a,c)=>{var d=Te.join2(typeof o=="string"?o:u.getPath(o),i),w=u.getMode(a,c);return u.create(d,w)},createDataFile:(o,i,l,a,c,d)=>{var w=i;o&&(o=typeof o=="string"?o:u.getPath(o),w=i?Te.join2(o,i):o);var I=u.getMode(a,c),W=u.create(w,I);if(l){if(typeof l=="string"){for(var J=new Array(l.length),ee=0,se=l.length;ee<se;++ee)J[ee]=l.charCodeAt(ee);l=J}u.chmod(W,I|146);var T=u.open(W,577);u.write(T,l,0,l.length,0,d),u.close(T),u.chmod(W,I)}return W},createDevice:(o,i,l,a)=>{var c=Te.join2(typeof o=="string"?o:u.getPath(o),i),d=u.getMode(!!l,!!a);u.createDevice.major||(u.createDevice.major=64);var w=u.makedev(u.createDevice.major++,0);return u.registerDevice(w,{open:I=>{I.seekable=!1},close:I=>{a&&a.buffer&&a.buffer.length&&a(10)},read:(I,W,J,ee,se)=>{for(var T=0,g=0;g<ee;g++){var y;try{y=l()}catch{throw new u.ErrnoError(29)}if(y===void 0&&T===0)throw new u.ErrnoError(6);if(y==null)break;T++,W[J+g]=y}return T&&(I.node.timestamp=Date.now()),T},write:(I,W,J,ee,se)=>{for(var T=0;T<ee;T++)try{a(W[J+T])}catch{throw new u.ErrnoError(29)}return ee&&(I.node.timestamp=Date.now()),T}}),u.mkdev(c,d,w)},forceLoadFile:o=>{if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Nn)try{o.contents=ao(Nn(o.url),!0),o.usedBytes=o.contents.length}catch{throw new u.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(o,i,l,a,c)=>{function d(){this.lengthKnown=!1,this.chunks=[]}if(d.prototype.get=function(g){if(!(g>this.length-1||g<0)){var y=g%this.chunkSize,v=g/this.chunkSize|0;return this.getter(v)[y]}},d.prototype.setDataGetter=function(g){this.getter=g},d.prototype.cacheLength=function(){var g=new XMLHttpRequest;if(g.open("HEAD",l,!1),g.send(null),!(g.status>=200&&g.status<300||g.status===304))throw new Error("Couldn't load "+l+". Status: "+g.status);var y=Number(g.getResponseHeader("Content-length")),v,S=(v=g.getResponseHeader("Accept-Ranges"))&&v==="bytes",b=(v=g.getResponseHeader("Content-Encoding"))&&v==="gzip",Q=1024*1024;S||(Q=y);var V=(K,le)=>{if(K>le)throw new Error("invalid range ("+K+", "+le+") or no bytes requested!");if(le>y-1)throw new Error("only "+y+" bytes available! programmer error!");var _=new XMLHttpRequest;if(_.open("GET",l,!1),y!==Q&&_.setRequestHeader("Range","bytes="+K+"-"+le),_.responseType="arraybuffer",_.overrideMimeType&&_.overrideMimeType("text/plain; charset=x-user-defined"),_.send(null),!(_.status>=200&&_.status<300||_.status===304))throw new Error("Couldn't load "+l+". Status: "+_.status);return _.response!==void 0?new Uint8Array(_.response||[]):ao(_.responseText||"",!0)},L=this;L.setDataGetter(K=>{var le=K*Q,_=(K+1)*Q-1;if(_=Math.min(_,y-1),typeof L.chunks[K]>"u"&&(L.chunks[K]=V(le,_)),typeof L.chunks[K]>"u")throw new Error("doXHR failed!");return L.chunks[K]}),(b||!y)&&(Q=y=1,y=this.getter(0).length,Q=y,we("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=y,this._chunkSize=Q,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!Ce)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var w=new d;Object.defineProperties(w,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var I={isDevice:!1,contents:w}}else var I={isDevice:!1,url:l};var W=u.createFile(o,i,I,a,c);I.contents?W.contents=I.contents:I.url&&(W.contents=null,W.url=I.url),Object.defineProperties(W,{usedBytes:{get:function(){return this.contents.length}}});var J={},ee=Object.keys(W.stream_ops);ee.forEach(T=>{var g=W.stream_ops[T];J[T]=function(){return u.forceLoadFile(W),g.apply(null,arguments)}});function se(T,g,y,v,S){var b=T.node.contents;if(S>=b.length)return 0;var Q=Math.min(b.length-S,v);if(b.slice)for(var V=0;V<Q;V++)g[y+V]=b[S+V];else for(var V=0;V<Q;V++)g[y+V]=b.get(S+V);return Q}return J.read=(T,g,y,v,S)=>(u.forceLoadFile(W),se(T,g,y,v,S)),J.mmap=(T,g,y,v,S)=>{u.forceLoadFile(W);var b=fa(g);if(!b)throw new u.ErrnoError(48);return se(T,It,b,g,y),{ptr:b,allocated:!0}},W.stream_ops=J,W},createPreloadedFile:(o,i,l,a,c,d,w,I,W,J)=>{var ee=i?an.resolve(Te.join2(o,i)):o;function se(T){function g(y){J&&J(),I||u.createDataFile(o,i,y,a,c,W),d&&d(),Mi()}Browser.handledByPreloadPlugin(T,ee,g,()=>{w&&w(),Mi()})||g(T)}so(),typeof l=="string"?dc(l,T=>se(T),w):se(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=()=>{we("creating db");var d=c.result;d.createObjectStore(u.DB_STORE_NAME)},c.onsuccess=()=>{var d=c.result,w=d.transaction([u.DB_STORE_NAME],"readwrite"),I=w.objectStore(u.DB_STORE_NAME),W=0,J=0,ee=o.length;function se(){J==0?i():l()}o.forEach(T=>{var g=I.put(u.analyzePath(T).object.contents,T);g.onsuccess=()=>{W++,W+J==ee&&se()},g.onerror=()=>{J++,W+J==ee&&se()}}),w.onerror=l},c.onerror=l},loadFilesFromDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=l,c.onsuccess=()=>{var d=c.result;try{var w=d.transaction([u.DB_STORE_NAME],"readonly")}catch(T){l(T);return}var I=w.objectStore(u.DB_STORE_NAME),W=0,J=0,ee=o.length;function se(){J==0?i():l()}o.forEach(T=>{var g=I.get(T);g.onsuccess=()=>{u.analyzePath(T).exists&&u.unlink(T),u.createDataFile(Te.dirname(T),Te.basename(T),g.result,!0,!0,!0),W++,W+J==ee&&se()},g.onerror=()=>{J++,W+J==ee&&se()}}),w.onerror=l},c.onerror=l}},fe={DEFAULT_POLLMASK:5,calculateAt:function(o,i,l){if(Te.isAbs(i))return i;var a;if(o===-100)a=u.cwd();else{var c=fe.getStreamFromFD(o);a=c.path}if(i.length==0){if(!l)throw new u.ErrnoError(44);return a}return Te.join2(a,i)},doStat:function(o,i,l){try{var a=o(i)}catch(I){if(I&&I.node&&Te.normalize(i)!==Te.normalize(u.getPath(I.node)))return-54;throw I}ve[l>>2]=a.dev,ve[l+8>>2]=a.ino,ve[l+12>>2]=a.mode,Xe[l+16>>2]=a.nlink,ve[l+20>>2]=a.uid,ve[l+24>>2]=a.gid,ve[l+28>>2]=a.rdev,ut=[a.size>>>0,(Ee=a.size,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],ve[l+40>>2]=ut[0],ve[l+44>>2]=ut[1],ve[l+48>>2]=4096,ve[l+52>>2]=a.blocks;var c=a.atime.getTime(),d=a.mtime.getTime(),w=a.ctime.getTime();return ut=[Math.floor(c/1e3)>>>0,(Ee=Math.floor(c/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],ve[l+56>>2]=ut[0],ve[l+60>>2]=ut[1],Xe[l+64>>2]=c%1e3*1e3,ut=[Math.floor(d/1e3)>>>0,(Ee=Math.floor(d/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],ve[l+72>>2]=ut[0],ve[l+76>>2]=ut[1],Xe[l+80>>2]=d%1e3*1e3,ut=[Math.floor(w/1e3)>>>0,(Ee=Math.floor(w/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],ve[l+88>>2]=ut[0],ve[l+92>>2]=ut[1],Xe[l+96>>2]=w%1e3*1e3,ut=[a.ino>>>0,(Ee=a.ino,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],ve[l+104>>2]=ut[0],ve[l+108>>2]=ut[1],0},doMsync:function(o,i,l,a,c){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);if(a&2)return 0;var d=pr.slice(o,o+l);u.msync(i,d,c,l,a)},varargs:void 0,get:function(){fe.varargs+=4;var o=ve[fe.varargs-4>>2];return o},getStr:function(o){var i=io(o);return i},getStreamFromFD:function(o){var i=u.getStream(o);if(!i)throw new u.ErrnoError(8);return i}};function fc(o,i){try{return o=fe.getStr(o),u.chmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function hc(o,i,l,a){try{if(i=fe.getStr(i),i=fe.calculateAt(o,i),l&-8)return-28;var c=u.lookupPath(i,{follow:!0}),d=c.node;if(!d)return-44;var w="";return l&4&&(w+="r"),l&2&&(w+="w"),l&1&&(w+="x"),w&&u.nodePermissions(d,w)?-2:0}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function pc(o,i){try{return u.fchmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function _c(o,i,l){try{return u.fchown(o,i,l),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function mc(o){return ve[ga()>>2]=o,o}function yc(o,i,l){fe.varargs=l;try{var a=fe.getStreamFromFD(o);switch(i){case 0:{var c=fe.get();if(c<0)return-28;var d;return d=u.createStream(a,c),d.fd}case 1:case 2:return 0;case 3:return a.flags;case 4:{var c=fe.get();return a.flags|=c,0}case 5:{var c=fe.get(),w=0;return ia[c+w>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return mc(28),-1;default:return-28}}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function gc(o,i){try{var l=fe.getStreamFromFD(o);return fe.doStat(u.stat,l.path,i)}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}var wc=9007199254740992,bc=-9007199254740992;function ha(o){return o<bc||o>wc?NaN:Number(o)}function qc(o,i){try{return i=ha(i),isNaN(i)?-61:(u.ftruncate(o,i),0)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function Nc(o,i){try{if(i===0)return-28;var l=u.cwd(),a=Kr(l)+1;return i<a?-68:(ra(l,o,i),a)}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return-c.errno}}function vc(o,i,l){fe.varargs=l;try{var a=fe.getStreamFromFD(o);switch(i){case 21509:case 21505:return a.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return a.tty?0:-59;case 21519:{if(!a.tty)return-59;var c=fe.get();return ve[c>>2]=0,0}case 21520:return a.tty?-28:-59;case 21531:{var c=fe.get();return u.ioctl(a,i,c)}case 21523:return a.tty?0:-59;case 21524:return a.tty?0:-59;default:return-28}}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function xc(o,i){try{return o=fe.getStr(o),fe.doStat(u.lstat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function Ec(o,i,l){try{return i=fe.getStr(i),i=fe.calculateAt(o,i),i=Te.normalize(i),i[i.length-1]==="/"&&(i=i.substr(0,i.length-1)),u.mkdir(i,l,0),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function Sc(o,i,l,a){try{i=fe.getStr(i);var c=a&256,d=a&4096;return a=a&-6401,i=fe.calculateAt(o,i,d),fe.doStat(c?u.lstat:u.stat,i,l)}catch(w){if(typeof u>"u"||!(w instanceof u.ErrnoError))throw w;return-w.errno}}function Ac(o,i,l,a){fe.varargs=a;try{i=fe.getStr(i),i=fe.calculateAt(o,i);var c=a?fe.get():0;return u.open(i,l,c).fd}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function Ic(o,i,l,a){try{if(i=fe.getStr(i),i=fe.calculateAt(o,i),a<=0)return-28;var c=u.readlink(i),d=Math.min(a,Kr(c)),w=It[l+d];return ra(c,l,a+1),It[l+d]=w,d}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function kc(o){try{return o=fe.getStr(o),u.rmdir(o),0}catch(i){if(typeof u>"u"||!(i instanceof u.ErrnoError))throw i;return-i.errno}}function Oc(o,i){try{return o=fe.getStr(o),fe.doStat(u.stat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function Tc(o,i,l){try{return i=fe.getStr(i),i=fe.calculateAt(o,i),l===0?u.unlink(i):l===512?u.rmdir(i):_r("Invalid flags passed to unlinkat"),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function lo(o){return Xe[o>>2]+ve[o+4>>2]*4294967296}function Cc(o,i,l,a){try{if(i=fe.getStr(i),i=fe.calculateAt(o,i,!0),l){var w=lo(l),I=ve[l+8>>2];c=w*1e3+I/(1e3*1e3),l+=16,w=lo(l),I=ve[l+8>>2],d=w*1e3+I/(1e3*1e3)}else var c=Date.now(),d=c;return u.utime(i,c,d),0}catch(W){if(typeof u>"u"||!(W instanceof u.ErrnoError))throw W;return-W.errno}}var Pc=!0;function Fc(){return Pc}function Wc(o){return o%4===0&&(o%100!==0||o%400===0)}var Dc=[0,31,60,91,121,152,182,213,244,274,305,335],Lc=[0,31,59,90,120,151,181,212,243,273,304,334];function Rc(o){var i=Wc(o.getFullYear()),l=i?Dc:Lc,a=l[o.getMonth()]+o.getDate()-1;return a}function Bc(o,i){var l=new Date(lo(o)*1e3);ve[i>>2]=l.getSeconds(),ve[i+4>>2]=l.getMinutes(),ve[i+8>>2]=l.getHours(),ve[i+12>>2]=l.getDate(),ve[i+16>>2]=l.getMonth(),ve[i+20>>2]=l.getFullYear()-1900,ve[i+24>>2]=l.getDay();var a=Rc(l)|0;ve[i+28>>2]=a,ve[i+36>>2]=-(l.getTimezoneOffset()*60);var c=new Date(l.getFullYear(),0,1),d=new Date(l.getFullYear(),6,1).getTimezoneOffset(),w=c.getTimezoneOffset(),I=(d!=w&&l.getTimezoneOffset()==Math.min(w,d))|0;ve[i+32>>2]=I}function Mc(o,i,l,a,c,d,w){try{var I=fe.getStreamFromFD(a),W=u.mmap(I,o,c,i,l),J=W.ptr;return ve[d>>2]=W.allocated,Xe[w>>2]=J,0}catch(ee){if(typeof u>"u"||!(ee instanceof u.ErrnoError))throw ee;return-ee.errno}}function Qc(o,i,l,a,c,d){try{var w=fe.getStreamFromFD(c);l&2&&fe.doMsync(o,w,i,a,d),u.munmap(w)}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function pa(o){var i=Kr(o)+1,l=wa(i);return l&&xn(o,It,l,i),l}function Uc(o,i,l){var a=new Date().getFullYear(),c=new Date(a,0,1),d=new Date(a,6,1),w=c.getTimezoneOffset(),I=d.getTimezoneOffset(),W=Math.max(w,I);Xe[o>>2]=W*60,ve[i>>2]=+(w!=I);function J(y){var v=y.toTimeString().match(/\(([A-Za-z ]+)\)$/);return v?v[1]:"GMT"}var ee=J(c),se=J(d),T=pa(ee),g=pa(se);I<w?(Xe[l>>2]=T,Xe[l+4>>2]=g):(Xe[l>>2]=g,Xe[l+4>>2]=T)}function jc(){return Date.now()}var _a;_a=()=>performance.now();function zc(){return 2147483648}function Vc(o){var i=Kt.buffer;try{return Kt.grow(o-i.byteLength+65535>>>16),sa(),1}catch{}}function $c(o){var i=pr.length;o=o>>>0;var l=zc();if(o>l)return!1;let a=(W,J)=>W+(J-W%J)%J;for(var c=1;c<=4;c*=2){var d=i*(1+.2/c);d=Math.min(d,o+100663296);var w=Math.min(l,a(Math.max(o,d),65536)),I=Vc(w);if(I)return!0}return!1}var co={};function Hc(){return tt||"./this.program"}function Yr(){if(!Yr.strings){var o=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:Hc()};for(var l in co)co[l]===void 0?delete i[l]:i[l]=co[l];var a=[];for(var l in i)a.push(l+"="+i[l]);Yr.strings=a}return Yr.strings}function Jc(o,i,l){for(var a=0;a<o.length;++a)It[i++>>0]=o.charCodeAt(a);l||(It[i>>0]=0)}function Gc(o,i){var l=0;return Yr().forEach(function(a,c){var d=i+l;Xe[o+c*4>>2]=d,Jc(a,d),l+=a.length+1}),0}function Kc(o,i){var l=Yr();Xe[o>>2]=l.length;var a=0;return l.forEach(function(c){a+=c.length+1}),Xe[i>>2]=a,0}function Xc(o){try{var i=fe.getStreamFromFD(o);return u.close(i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Yc(o,i){try{var l=fe.getStreamFromFD(o),a=l.tty?2:u.isDir(l.mode)?3:u.isLink(l.mode)?7:4;return It[i>>0]=a,0}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return c.errno}}function Zc(o,i,l,a){for(var c=0,d=0;d<l;d++){var w=Xe[i>>2],I=Xe[i+4>>2];i+=8;var W=u.read(o,It,w,I,a);if(W<0)return-1;if(c+=W,W<I)break;typeof a<"u"&&(a+=W)}return c}function eu(o,i,l,a){try{var c=fe.getStreamFromFD(o),d=Zc(c,i,l);return Xe[a>>2]=d,0}catch(w){if(typeof u>"u"||!(w instanceof u.ErrnoError))throw w;return w.errno}}function tu(o,i,l,a){try{if(i=ha(i),isNaN(i))return 61;var c=fe.getStreamFromFD(o);return u.llseek(c,i,l),ut=[c.position>>>0,(Ee=c.position,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],ve[a>>2]=ut[0],ve[a+4>>2]=ut[1],c.getdents&&i===0&&l===0&&(c.getdents=null),0}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return d.errno}}function nu(o){try{var i=fe.getStreamFromFD(o);return i.stream_ops&&i.stream_ops.fsync?i.stream_ops.fsync(i):0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function ru(o,i,l,a){for(var c=0,d=0;d<l;d++){var w=Xe[i>>2],I=Xe[i+4>>2];i+=8;var W=u.write(o,It,w,I,a);if(W<0)return-1;c+=W,typeof a<"u"&&(a+=W)}return c}function iu(o,i,l,a){try{var c=fe.getStreamFromFD(o),d=ru(c,i,l);return Xe[a>>2]=d,0}catch(w){if(typeof u>"u"||!(w instanceof u.ErrnoError))throw w;return w.errno}}var ma=function(o,i,l,a){o||(o=this),this.parent=o,this.mount=o.mount,this.mounted=null,this.id=u.nextInode++,this.name=i,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=a},Qi=365,Ui=146;Object.defineProperties(ma.prototype,{read:{get:function(){return(this.mode&Qi)===Qi},set:function(o){o?this.mode|=Qi:this.mode&=~Qi}},write:{get:function(){return(this.mode&Ui)===Ui},set:function(o){o?this.mode|=Ui:this.mode&=~Ui}},isFolder:{get:function(){return u.isDir(this.mode)}},isDevice:{get:function(){return u.isChrdev(this.mode)}}}),u.FSNode=ma,u.staticInit();var ya={__syscall_chmod:fc,__syscall_faccessat:hc,__syscall_fchmod:pc,__syscall_fchown32:_c,__syscall_fcntl64:yc,__syscall_fstat64:gc,__syscall_ftruncate64:qc,__syscall_getcwd:Nc,__syscall_ioctl:vc,__syscall_lstat64:xc,__syscall_mkdirat:Ec,__syscall_newfstatat:Sc,__syscall_openat:Ac,__syscall_readlinkat:Ic,__syscall_rmdir:kc,__syscall_stat64:Oc,__syscall_unlinkat:Tc,__syscall_utimensat:Cc,_emscripten_get_now_is_monotonic:Fc,_localtime_js:Bc,_mmap_js:Mc,_munmap_js:Qc,_tzset_js:Uc,emscripten_date_now:jc,emscripten_get_now:_a,emscripten_resize_heap:$c,environ_get:Gc,environ_sizes_get:Kc,fd_close:Xc,fd_fdstat_get:Yc,fd_read:eu,fd_seek:tu,fd_sync:nu,fd_write:iu,memory:Kt};ac(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._sqlite3_status64=function(){return(n._sqlite3_status64=n.asm.sqlite3_status64).apply(null,arguments)},n._sqlite3_status=function(){return(n._sqlite3_status=n.asm.sqlite3_status).apply(null,arguments)},n._sqlite3_db_status=function(){return(n._sqlite3_db_status=n.asm.sqlite3_db_status).apply(null,arguments)},n._sqlite3_msize=function(){return(n._sqlite3_msize=n.asm.sqlite3_msize).apply(null,arguments)},n._sqlite3_vfs_find=function(){return(n._sqlite3_vfs_find=n.asm.sqlite3_vfs_find).apply(null,arguments)},n._sqlite3_initialize=function(){return(n._sqlite3_initialize=n.asm.sqlite3_initialize).apply(null,arguments)},n._sqlite3_malloc=function(){return(n._sqlite3_malloc=n.asm.sqlite3_malloc).apply(null,arguments)},n._sqlite3_free=function(){return(n._sqlite3_free=n.asm.sqlite3_free).apply(null,arguments)},n._sqlite3_vfs_register=function(){return(n._sqlite3_vfs_register=n.asm.sqlite3_vfs_register).apply(null,arguments)},n._sqlite3_vfs_unregister=function(){return(n._sqlite3_vfs_unregister=n.asm.sqlite3_vfs_unregister).apply(null,arguments)},n._sqlite3_malloc64=function(){return(n._sqlite3_malloc64=n.asm.sqlite3_malloc64).apply(null,arguments)},n._sqlite3_realloc=function(){return(n._sqlite3_realloc=n.asm.sqlite3_realloc).apply(null,arguments)},n._sqlite3_realloc64=function(){return(n._sqlite3_realloc64=n.asm.sqlite3_realloc64).apply(null,arguments)},n._sqlite3_value_text=function(){return(n._sqlite3_value_text=n.asm.sqlite3_value_text).apply(null,arguments)},n._sqlite3_randomness=function(){return(n._sqlite3_randomness=n.asm.sqlite3_randomness).apply(null,arguments)},n._sqlite3_stricmp=function(){return(n._sqlite3_stricmp=n.asm.sqlite3_stricmp).apply(null,arguments)},n._sqlite3_strnicmp=function(){return(n._sqlite3_strnicmp=n.asm.sqlite3_strnicmp).apply(null,arguments)},n._sqlite3_uri_parameter=function(){return(n._sqlite3_uri_parameter=n.asm.sqlite3_uri_parameter).apply(null,arguments)};var ga=n.___errno_location=function(){return(ga=n.___errno_location=n.asm.__errno_location).apply(null,arguments)};n._sqlite3_uri_boolean=function(){return(n._sqlite3_uri_boolean=n.asm.sqlite3_uri_boolean).apply(null,arguments)},n._sqlite3_serialize=function(){return(n._sqlite3_serialize=n.asm.sqlite3_serialize).apply(null,arguments)},n._sqlite3_prepare_v2=function(){return(n._sqlite3_prepare_v2=n.asm.sqlite3_prepare_v2).apply(null,arguments)},n._sqlite3_step=function(){return(n._sqlite3_step=n.asm.sqlite3_step).apply(null,arguments)},n._sqlite3_column_int64=function(){return(n._sqlite3_column_int64=n.asm.sqlite3_column_int64).apply(null,arguments)},n._sqlite3_column_int=function(){return(n._sqlite3_column_int=n.asm.sqlite3_column_int).apply(null,arguments)},n._sqlite3_finalize=function(){return(n._sqlite3_finalize=n.asm.sqlite3_finalize).apply(null,arguments)},n._sqlite3_file_control=function(){return(n._sqlite3_file_control=n.asm.sqlite3_file_control).apply(null,arguments)},n._sqlite3_reset=function(){return(n._sqlite3_reset=n.asm.sqlite3_reset).apply(null,arguments)},n._sqlite3_deserialize=function(){return(n._sqlite3_deserialize=n.asm.sqlite3_deserialize).apply(null,arguments)},n._sqlite3_clear_bindings=function(){return(n._sqlite3_clear_bindings=n.asm.sqlite3_clear_bindings).apply(null,arguments)},n._sqlite3_value_blob=function(){return(n._sqlite3_value_blob=n.asm.sqlite3_value_blob).apply(null,arguments)},n._sqlite3_value_bytes=function(){return(n._sqlite3_value_bytes=n.asm.sqlite3_value_bytes).apply(null,arguments)},n._sqlite3_value_double=function(){return(n._sqlite3_value_double=n.asm.sqlite3_value_double).apply(null,arguments)},n._sqlite3_value_int=function(){return(n._sqlite3_value_int=n.asm.sqlite3_value_int).apply(null,arguments)},n._sqlite3_value_int64=function(){return(n._sqlite3_value_int64=n.asm.sqlite3_value_int64).apply(null,arguments)},n._sqlite3_value_subtype=function(){return(n._sqlite3_value_subtype=n.asm.sqlite3_value_subtype).apply(null,arguments)},n._sqlite3_value_pointer=function(){return(n._sqlite3_value_pointer=n.asm.sqlite3_value_pointer).apply(null,arguments)},n._sqlite3_value_type=function(){return(n._sqlite3_value_type=n.asm.sqlite3_value_type).apply(null,arguments)},n._sqlite3_value_nochange=function(){return(n._sqlite3_value_nochange=n.asm.sqlite3_value_nochange).apply(null,arguments)},n._sqlite3_value_frombind=function(){return(n._sqlite3_value_frombind=n.asm.sqlite3_value_frombind).apply(null,arguments)},n._sqlite3_value_dup=function(){return(n._sqlite3_value_dup=n.asm.sqlite3_value_dup).apply(null,arguments)},n._sqlite3_value_free=function(){return(n._sqlite3_value_free=n.asm.sqlite3_value_free).apply(null,arguments)},n._sqlite3_result_blob=function(){return(n._sqlite3_result_blob=n.asm.sqlite3_result_blob).apply(null,arguments)},n._sqlite3_result_error_nomem=function(){return(n._sqlite3_result_error_nomem=n.asm.sqlite3_result_error_nomem).apply(null,arguments)},n._sqlite3_result_error_toobig=function(){return(n._sqlite3_result_error_toobig=n.asm.sqlite3_result_error_toobig).apply(null,arguments)},n._sqlite3_result_double=function(){return(n._sqlite3_result_double=n.asm.sqlite3_result_double).apply(null,arguments)},n._sqlite3_result_error=function(){return(n._sqlite3_result_error=n.asm.sqlite3_result_error).apply(null,arguments)},n._sqlite3_result_int=function(){return(n._sqlite3_result_int=n.asm.sqlite3_result_int).apply(null,arguments)},n._sqlite3_result_int64=function(){return(n._sqlite3_result_int64=n.asm.sqlite3_result_int64).apply(null,arguments)},n._sqlite3_result_null=function(){return(n._sqlite3_result_null=n.asm.sqlite3_result_null).apply(null,arguments)},n._sqlite3_result_pointer=function(){return(n._sqlite3_result_pointer=n.asm.sqlite3_result_pointer).apply(null,arguments)},n._sqlite3_result_subtype=function(){return(n._sqlite3_result_subtype=n.asm.sqlite3_result_subtype).apply(null,arguments)},n._sqlite3_result_text=function(){return(n._sqlite3_result_text=n.asm.sqlite3_result_text).apply(null,arguments)},n._sqlite3_result_zeroblob=function(){return(n._sqlite3_result_zeroblob=n.asm.sqlite3_result_zeroblob).apply(null,arguments)},n._sqlite3_result_zeroblob64=function(){return(n._sqlite3_result_zeroblob64=n.asm.sqlite3_result_zeroblob64).apply(null,arguments)},n._sqlite3_result_error_code=function(){return(n._sqlite3_result_error_code=n.asm.sqlite3_result_error_code).apply(null,arguments)},n._sqlite3_user_data=function(){return(n._sqlite3_user_data=n.asm.sqlite3_user_data).apply(null,arguments)},n._sqlite3_context_db_handle=function(){return(n._sqlite3_context_db_handle=n.asm.sqlite3_context_db_handle).apply(null,arguments)},n._sqlite3_vtab_nochange=function(){return(n._sqlite3_vtab_nochange=n.asm.sqlite3_vtab_nochange).apply(null,arguments)},n._sqlite3_vtab_in_first=function(){return(n._sqlite3_vtab_in_first=n.asm.sqlite3_vtab_in_first).apply(null,arguments)},n._sqlite3_vtab_in_next=function(){return(n._sqlite3_vtab_in_next=n.asm.sqlite3_vtab_in_next).apply(null,arguments)},n._sqlite3_aggregate_context=function(){return(n._sqlite3_aggregate_context=n.asm.sqlite3_aggregate_context).apply(null,arguments)},n._sqlite3_get_auxdata=function(){return(n._sqlite3_get_auxdata=n.asm.sqlite3_get_auxdata).apply(null,arguments)},n._sqlite3_set_auxdata=function(){return(n._sqlite3_set_auxdata=n.asm.sqlite3_set_auxdata).apply(null,arguments)},n._sqlite3_column_count=function(){return(n._sqlite3_column_count=n.asm.sqlite3_column_count).apply(null,arguments)},n._sqlite3_data_count=function(){return(n._sqlite3_data_count=n.asm.sqlite3_data_count).apply(null,arguments)},n._sqlite3_column_blob=function(){return(n._sqlite3_column_blob=n.asm.sqlite3_column_blob).apply(null,arguments)},n._sqlite3_column_bytes=function(){return(n._sqlite3_column_bytes=n.asm.sqlite3_column_bytes).apply(null,arguments)},n._sqlite3_column_double=function(){return(n._sqlite3_column_double=n.asm.sqlite3_column_double).apply(null,arguments)},n._sqlite3_column_text=function(){return(n._sqlite3_column_text=n.asm.sqlite3_column_text).apply(null,arguments)},n._sqlite3_column_value=function(){return(n._sqlite3_column_value=n.asm.sqlite3_column_value).apply(null,arguments)},n._sqlite3_column_type=function(){return(n._sqlite3_column_type=n.asm.sqlite3_column_type).apply(null,arguments)},n._sqlite3_column_name=function(){return(n._sqlite3_column_name=n.asm.sqlite3_column_name).apply(null,arguments)},n._sqlite3_bind_blob=function(){return(n._sqlite3_bind_blob=n.asm.sqlite3_bind_blob).apply(null,arguments)},n._sqlite3_bind_double=function(){return(n._sqlite3_bind_double=n.asm.sqlite3_bind_double).apply(null,arguments)},n._sqlite3_bind_int=function(){return(n._sqlite3_bind_int=n.asm.sqlite3_bind_int).apply(null,arguments)},n._sqlite3_bind_int64=function(){return(n._sqlite3_bind_int64=n.asm.sqlite3_bind_int64).apply(null,arguments)},n._sqlite3_bind_null=function(){return(n._sqlite3_bind_null=n.asm.sqlite3_bind_null).apply(null,arguments)},n._sqlite3_bind_pointer=function(){return(n._sqlite3_bind_pointer=n.asm.sqlite3_bind_pointer).apply(null,arguments)},n._sqlite3_bind_text=function(){return(n._sqlite3_bind_text=n.asm.sqlite3_bind_text).apply(null,arguments)},n._sqlite3_bind_parameter_count=function(){return(n._sqlite3_bind_parameter_count=n.asm.sqlite3_bind_parameter_count).apply(null,arguments)},n._sqlite3_bind_parameter_index=function(){return(n._sqlite3_bind_parameter_index=n.asm.sqlite3_bind_parameter_index).apply(null,arguments)},n._sqlite3_db_handle=function(){return(n._sqlite3_db_handle=n.asm.sqlite3_db_handle).apply(null,arguments)},n._sqlite3_stmt_readonly=function(){return(n._sqlite3_stmt_readonly=n.asm.sqlite3_stmt_readonly).apply(null,arguments)},n._sqlite3_stmt_isexplain=function(){return(n._sqlite3_stmt_isexplain=n.asm.sqlite3_stmt_isexplain).apply(null,arguments)},n._sqlite3_stmt_status=function(){return(n._sqlite3_stmt_status=n.asm.sqlite3_stmt_status).apply(null,arguments)},n._sqlite3_sql=function(){return(n._sqlite3_sql=n.asm.sqlite3_sql).apply(null,arguments)},n._sqlite3_expanded_sql=function(){return(n._sqlite3_expanded_sql=n.asm.sqlite3_expanded_sql).apply(null,arguments)},n._sqlite3_preupdate_old=function(){return(n._sqlite3_preupdate_old=n.asm.sqlite3_preupdate_old).apply(null,arguments)},n._sqlite3_preupdate_count=function(){return(n._sqlite3_preupdate_count=n.asm.sqlite3_preupdate_count).apply(null,arguments)},n._sqlite3_preupdate_depth=function(){return(n._sqlite3_preupdate_depth=n.asm.sqlite3_preupdate_depth).apply(null,arguments)},n._sqlite3_preupdate_blobwrite=function(){return(n._sqlite3_preupdate_blobwrite=n.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},n._sqlite3_preupdate_new=function(){return(n._sqlite3_preupdate_new=n.asm.sqlite3_preupdate_new).apply(null,arguments)},n._sqlite3_value_numeric_type=function(){return(n._sqlite3_value_numeric_type=n.asm.sqlite3_value_numeric_type).apply(null,arguments)},n._sqlite3_errmsg=function(){return(n._sqlite3_errmsg=n.asm.sqlite3_errmsg).apply(null,arguments)},n._sqlite3_set_authorizer=function(){return(n._sqlite3_set_authorizer=n.asm.sqlite3_set_authorizer).apply(null,arguments)},n._sqlite3_strglob=function(){return(n._sqlite3_strglob=n.asm.sqlite3_strglob).apply(null,arguments)},n._sqlite3_strlike=function(){return(n._sqlite3_strlike=n.asm.sqlite3_strlike).apply(null,arguments)},n._sqlite3_exec=function(){return(n._sqlite3_exec=n.asm.sqlite3_exec).apply(null,arguments)},n._sqlite3_auto_extension=function(){return(n._sqlite3_auto_extension=n.asm.sqlite3_auto_extension).apply(null,arguments)},n._sqlite3_cancel_auto_extension=function(){return(n._sqlite3_cancel_auto_extension=n.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},n._sqlite3_reset_auto_extension=function(){return(n._sqlite3_reset_auto_extension=n.asm.sqlite3_reset_auto_extension).apply(null,arguments)},n._sqlite3_prepare_v3=function(){return(n._sqlite3_prepare_v3=n.asm.sqlite3_prepare_v3).apply(null,arguments)},n._sqlite3_create_module=function(){return(n._sqlite3_create_module=n.asm.sqlite3_create_module).apply(null,arguments)},n._sqlite3_create_module_v2=function(){return(n._sqlite3_create_module_v2=n.asm.sqlite3_create_module_v2).apply(null,arguments)},n._sqlite3_drop_modules=function(){return(n._sqlite3_drop_modules=n.asm.sqlite3_drop_modules).apply(null,arguments)},n._sqlite3_declare_vtab=function(){return(n._sqlite3_declare_vtab=n.asm.sqlite3_declare_vtab).apply(null,arguments)},n._sqlite3_vtab_on_conflict=function(){return(n._sqlite3_vtab_on_conflict=n.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},n._sqlite3_vtab_collation=function(){return(n._sqlite3_vtab_collation=n.asm.sqlite3_vtab_collation).apply(null,arguments)},n._sqlite3_vtab_in=function(){return(n._sqlite3_vtab_in=n.asm.sqlite3_vtab_in).apply(null,arguments)},n._sqlite3_vtab_rhs_value=function(){return(n._sqlite3_vtab_rhs_value=n.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},n._sqlite3_vtab_distinct=function(){return(n._sqlite3_vtab_distinct=n.asm.sqlite3_vtab_distinct).apply(null,arguments)},n._sqlite3_keyword_name=function(){return(n._sqlite3_keyword_name=n.asm.sqlite3_keyword_name).apply(null,arguments)},n._sqlite3_keyword_count=function(){return(n._sqlite3_keyword_count=n.asm.sqlite3_keyword_count).apply(null,arguments)},n._sqlite3_keyword_check=function(){return(n._sqlite3_keyword_check=n.asm.sqlite3_keyword_check).apply(null,arguments)},n._sqlite3_complete=function(){return(n._sqlite3_complete=n.asm.sqlite3_complete).apply(null,arguments)},n._sqlite3_libversion=function(){return(n._sqlite3_libversion=n.asm.sqlite3_libversion).apply(null,arguments)},n._sqlite3_libversion_number=function(){return(n._sqlite3_libversion_number=n.asm.sqlite3_libversion_number).apply(null,arguments)},n._sqlite3_shutdown=function(){return(n._sqlite3_shutdown=n.asm.sqlite3_shutdown).apply(null,arguments)},n._sqlite3_last_insert_rowid=function(){return(n._sqlite3_last_insert_rowid=n.asm.sqlite3_last_insert_rowid).apply(null,arguments)},n._sqlite3_set_last_insert_rowid=function(){return(n._sqlite3_set_last_insert_rowid=n.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},n._sqlite3_changes64=function(){return(n._sqlite3_changes64=n.asm.sqlite3_changes64).apply(null,arguments)},n._sqlite3_changes=function(){return(n._sqlite3_changes=n.asm.sqlite3_changes).apply(null,arguments)},n._sqlite3_total_changes64=function(){return(n._sqlite3_total_changes64=n.asm.sqlite3_total_changes64).apply(null,arguments)},n._sqlite3_total_changes=function(){return(n._sqlite3_total_changes=n.asm.sqlite3_total_changes).apply(null,arguments)},n._sqlite3_txn_state=function(){return(n._sqlite3_txn_state=n.asm.sqlite3_txn_state).apply(null,arguments)},n._sqlite3_close_v2=function(){return(n._sqlite3_close_v2=n.asm.sqlite3_close_v2).apply(null,arguments)},n._sqlite3_busy_handler=function(){return(n._sqlite3_busy_handler=n.asm.sqlite3_busy_handler).apply(null,arguments)},n._sqlite3_progress_handler=function(){return(n._sqlite3_progress_handler=n.asm.sqlite3_progress_handler).apply(null,arguments)},n._sqlite3_busy_timeout=function(){return(n._sqlite3_busy_timeout=n.asm.sqlite3_busy_timeout).apply(null,arguments)},n._sqlite3_create_function=function(){return(n._sqlite3_create_function=n.asm.sqlite3_create_function).apply(null,arguments)},n._sqlite3_create_function_v2=function(){return(n._sqlite3_create_function_v2=n.asm.sqlite3_create_function_v2).apply(null,arguments)},n._sqlite3_create_window_function=function(){return(n._sqlite3_create_window_function=n.asm.sqlite3_create_window_function).apply(null,arguments)},n._sqlite3_overload_function=function(){return(n._sqlite3_overload_function=n.asm.sqlite3_overload_function).apply(null,arguments)},n._sqlite3_trace_v2=function(){return(n._sqlite3_trace_v2=n.asm.sqlite3_trace_v2).apply(null,arguments)},n._sqlite3_commit_hook=function(){return(n._sqlite3_commit_hook=n.asm.sqlite3_commit_hook).apply(null,arguments)},n._sqlite3_update_hook=function(){return(n._sqlite3_update_hook=n.asm.sqlite3_update_hook).apply(null,arguments)},n._sqlite3_rollback_hook=function(){return(n._sqlite3_rollback_hook=n.asm.sqlite3_rollback_hook).apply(null,arguments)},n._sqlite3_preupdate_hook=function(){return(n._sqlite3_preupdate_hook=n.asm.sqlite3_preupdate_hook).apply(null,arguments)},n._sqlite3_error_offset=function(){return(n._sqlite3_error_offset=n.asm.sqlite3_error_offset).apply(null,arguments)},n._sqlite3_errcode=function(){return(n._sqlite3_errcode=n.asm.sqlite3_errcode).apply(null,arguments)},n._sqlite3_extended_errcode=function(){return(n._sqlite3_extended_errcode=n.asm.sqlite3_extended_errcode).apply(null,arguments)},n._sqlite3_errstr=function(){return(n._sqlite3_errstr=n.asm.sqlite3_errstr).apply(null,arguments)},n._sqlite3_limit=function(){return(n._sqlite3_limit=n.asm.sqlite3_limit).apply(null,arguments)},n._sqlite3_open=function(){return(n._sqlite3_open=n.asm.sqlite3_open).apply(null,arguments)},n._sqlite3_open_v2=function(){return(n._sqlite3_open_v2=n.asm.sqlite3_open_v2).apply(null,arguments)},n._sqlite3_create_collation=function(){return(n._sqlite3_create_collation=n.asm.sqlite3_create_collation).apply(null,arguments)},n._sqlite3_create_collation_v2=function(){return(n._sqlite3_create_collation_v2=n.asm.sqlite3_create_collation_v2).apply(null,arguments)},n._sqlite3_collation_needed=function(){return(n._sqlite3_collation_needed=n.asm.sqlite3_collation_needed).apply(null,arguments)},n._sqlite3_table_column_metadata=function(){return(n._sqlite3_table_column_metadata=n.asm.sqlite3_table_column_metadata).apply(null,arguments)},n._sqlite3_extended_result_codes=function(){return(n._sqlite3_extended_result_codes=n.asm.sqlite3_extended_result_codes).apply(null,arguments)},n._sqlite3_uri_key=function(){return(n._sqlite3_uri_key=n.asm.sqlite3_uri_key).apply(null,arguments)},n._sqlite3_uri_int64=function(){return(n._sqlite3_uri_int64=n.asm.sqlite3_uri_int64).apply(null,arguments)},n._sqlite3_db_name=function(){return(n._sqlite3_db_name=n.asm.sqlite3_db_name).apply(null,arguments)},n._sqlite3_db_filename=function(){return(n._sqlite3_db_filename=n.asm.sqlite3_db_filename).apply(null,arguments)},n._sqlite3_compileoption_used=function(){return(n._sqlite3_compileoption_used=n.asm.sqlite3_compileoption_used).apply(null,arguments)},n._sqlite3_compileoption_get=function(){return(n._sqlite3_compileoption_get=n.asm.sqlite3_compileoption_get).apply(null,arguments)},n._sqlite3session_diff=function(){return(n._sqlite3session_diff=n.asm.sqlite3session_diff).apply(null,arguments)},n._sqlite3session_attach=function(){return(n._sqlite3session_attach=n.asm.sqlite3session_attach).apply(null,arguments)},n._sqlite3session_create=function(){return(n._sqlite3session_create=n.asm.sqlite3session_create).apply(null,arguments)},n._sqlite3session_delete=function(){return(n._sqlite3session_delete=n.asm.sqlite3session_delete).apply(null,arguments)},n._sqlite3session_table_filter=function(){return(n._sqlite3session_table_filter=n.asm.sqlite3session_table_filter).apply(null,arguments)},n._sqlite3session_changeset=function(){return(n._sqlite3session_changeset=n.asm.sqlite3session_changeset).apply(null,arguments)},n._sqlite3session_changeset_strm=function(){return(n._sqlite3session_changeset_strm=n.asm.sqlite3session_changeset_strm).apply(null,arguments)},n._sqlite3session_patchset_strm=function(){return(n._sqlite3session_patchset_strm=n.asm.sqlite3session_patchset_strm).apply(null,arguments)},n._sqlite3session_patchset=function(){return(n._sqlite3session_patchset=n.asm.sqlite3session_patchset).apply(null,arguments)},n._sqlite3session_enable=function(){return(n._sqlite3session_enable=n.asm.sqlite3session_enable).apply(null,arguments)},n._sqlite3session_indirect=function(){return(n._sqlite3session_indirect=n.asm.sqlite3session_indirect).apply(null,arguments)},n._sqlite3session_isempty=function(){return(n._sqlite3session_isempty=n.asm.sqlite3session_isempty).apply(null,arguments)},n._sqlite3session_memory_used=function(){return(n._sqlite3session_memory_used=n.asm.sqlite3session_memory_used).apply(null,arguments)},n._sqlite3session_object_config=function(){return(n._sqlite3session_object_config=n.asm.sqlite3session_object_config).apply(null,arguments)},n._sqlite3session_changeset_size=function(){return(n._sqlite3session_changeset_size=n.asm.sqlite3session_changeset_size).apply(null,arguments)},n._sqlite3changeset_start=function(){return(n._sqlite3changeset_start=n.asm.sqlite3changeset_start).apply(null,arguments)},n._sqlite3changeset_start_v2=function(){return(n._sqlite3changeset_start_v2=n.asm.sqlite3changeset_start_v2).apply(null,arguments)},n._sqlite3changeset_start_strm=function(){return(n._sqlite3changeset_start_strm=n.asm.sqlite3changeset_start_strm).apply(null,arguments)},n._sqlite3changeset_start_v2_strm=function(){return(n._sqlite3changeset_start_v2_strm=n.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},n._sqlite3changeset_next=function(){return(n._sqlite3changeset_next=n.asm.sqlite3changeset_next).apply(null,arguments)},n._sqlite3changeset_op=function(){return(n._sqlite3changeset_op=n.asm.sqlite3changeset_op).apply(null,arguments)},n._sqlite3changeset_pk=function(){return(n._sqlite3changeset_pk=n.asm.sqlite3changeset_pk).apply(null,arguments)},n._sqlite3changeset_old=function(){return(n._sqlite3changeset_old=n.asm.sqlite3changeset_old).apply(null,arguments)},n._sqlite3changeset_new=function(){return(n._sqlite3changeset_new=n.asm.sqlite3changeset_new).apply(null,arguments)},n._sqlite3changeset_conflict=function(){return(n._sqlite3changeset_conflict=n.asm.sqlite3changeset_conflict).apply(null,arguments)},n._sqlite3changeset_fk_conflicts=function(){return(n._sqlite3changeset_fk_conflicts=n.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},n._sqlite3changeset_finalize=function(){return(n._sqlite3changeset_finalize=n.asm.sqlite3changeset_finalize).apply(null,arguments)},n._sqlite3changeset_invert=function(){return(n._sqlite3changeset_invert=n.asm.sqlite3changeset_invert).apply(null,arguments)},n._sqlite3changeset_invert_strm=function(){return(n._sqlite3changeset_invert_strm=n.asm.sqlite3changeset_invert_strm).apply(null,arguments)},n._sqlite3changeset_apply_v2=function(){return(n._sqlite3changeset_apply_v2=n.asm.sqlite3changeset_apply_v2).apply(null,arguments)},n._sqlite3changeset_apply=function(){return(n._sqlite3changeset_apply=n.asm.sqlite3changeset_apply).apply(null,arguments)},n._sqlite3changeset_apply_v2_strm=function(){return(n._sqlite3changeset_apply_v2_strm=n.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},n._sqlite3changeset_apply_strm=function(){return(n._sqlite3changeset_apply_strm=n.asm.sqlite3changeset_apply_strm).apply(null,arguments)},n._sqlite3changegroup_new=function(){return(n._sqlite3changegroup_new=n.asm.sqlite3changegroup_new).apply(null,arguments)},n._sqlite3changegroup_add=function(){return(n._sqlite3changegroup_add=n.asm.sqlite3changegroup_add).apply(null,arguments)},n._sqlite3changegroup_output=function(){return(n._sqlite3changegroup_output=n.asm.sqlite3changegroup_output).apply(null,arguments)},n._sqlite3changegroup_add_strm=function(){return(n._sqlite3changegroup_add_strm=n.asm.sqlite3changegroup_add_strm).apply(null,arguments)},n._sqlite3changegroup_output_strm=function(){return(n._sqlite3changegroup_output_strm=n.asm.sqlite3changegroup_output_strm).apply(null,arguments)},n._sqlite3changegroup_delete=function(){return(n._sqlite3changegroup_delete=n.asm.sqlite3changegroup_delete).apply(null,arguments)},n._sqlite3changeset_concat=function(){return(n._sqlite3changeset_concat=n.asm.sqlite3changeset_concat).apply(null,arguments)},n._sqlite3changeset_concat_strm=function(){return(n._sqlite3changeset_concat_strm=n.asm.sqlite3changeset_concat_strm).apply(null,arguments)},n._sqlite3session_config=function(){return(n._sqlite3session_config=n.asm.sqlite3session_config).apply(null,arguments)},n._sqlite3_sourceid=function(){return(n._sqlite3_sourceid=n.asm.sqlite3_sourceid).apply(null,arguments)},n._sqlite3_wasm_pstack_ptr=function(){return(n._sqlite3_wasm_pstack_ptr=n.asm.sqlite3_wasm_pstack_ptr).apply(null,arguments)},n._sqlite3_wasm_pstack_restore=function(){return(n._sqlite3_wasm_pstack_restore=n.asm.sqlite3_wasm_pstack_restore).apply(null,arguments)},n._sqlite3_wasm_pstack_alloc=function(){return(n._sqlite3_wasm_pstack_alloc=n.asm.sqlite3_wasm_pstack_alloc).apply(null,arguments)},n._sqlite3_wasm_pstack_remaining=function(){return(n._sqlite3_wasm_pstack_remaining=n.asm.sqlite3_wasm_pstack_remaining).apply(null,arguments)},n._sqlite3_wasm_pstack_quota=function(){return(n._sqlite3_wasm_pstack_quota=n.asm.sqlite3_wasm_pstack_quota).apply(null,arguments)},n._sqlite3_wasm_db_error=function(){return(n._sqlite3_wasm_db_error=n.asm.sqlite3_wasm_db_error).apply(null,arguments)},n._sqlite3_wasm_test_struct=function(){return(n._sqlite3_wasm_test_struct=n.asm.sqlite3_wasm_test_struct).apply(null,arguments)},n._sqlite3_wasm_enum_json=function(){return(n._sqlite3_wasm_enum_json=n.asm.sqlite3_wasm_enum_json).apply(null,arguments)},n._sqlite3_wasm_vfs_unlink=function(){return(n._sqlite3_wasm_vfs_unlink=n.asm.sqlite3_wasm_vfs_unlink).apply(null,arguments)},n._sqlite3_wasm_db_vfs=function(){return(n._sqlite3_wasm_db_vfs=n.asm.sqlite3_wasm_db_vfs).apply(null,arguments)},n._sqlite3_wasm_db_reset=function(){return(n._sqlite3_wasm_db_reset=n.asm.sqlite3_wasm_db_reset).apply(null,arguments)},n._sqlite3_wasm_db_export_chunked=function(){return(n._sqlite3_wasm_db_export_chunked=n.asm.sqlite3_wasm_db_export_chunked).apply(null,arguments)},n._sqlite3_wasm_db_serialize=function(){return(n._sqlite3_wasm_db_serialize=n.asm.sqlite3_wasm_db_serialize).apply(null,arguments)},n._sqlite3_wasm_vfs_create_file=function(){return(n._sqlite3_wasm_vfs_create_file=n.asm.sqlite3_wasm_vfs_create_file).apply(null,arguments)},n._sqlite3_wasm_posix_create_file=function(){return(n._sqlite3_wasm_posix_create_file=n.asm.sqlite3_wasm_posix_create_file).apply(null,arguments)},n._sqlite3_wasm_kvvfsMakeKeyOnPstack=function(){return(n._sqlite3_wasm_kvvfsMakeKeyOnPstack=n.asm.sqlite3_wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},n._sqlite3_wasm_kvvfs_methods=function(){return(n._sqlite3_wasm_kvvfs_methods=n.asm.sqlite3_wasm_kvvfs_methods).apply(null,arguments)},n._sqlite3_wasm_vtab_config=function(){return(n._sqlite3_wasm_vtab_config=n.asm.sqlite3_wasm_vtab_config).apply(null,arguments)},n._sqlite3_wasm_db_config_ip=function(){return(n._sqlite3_wasm_db_config_ip=n.asm.sqlite3_wasm_db_config_ip).apply(null,arguments)},n._sqlite3_wasm_db_config_pii=function(){return(n._sqlite3_wasm_db_config_pii=n.asm.sqlite3_wasm_db_config_pii).apply(null,arguments)},n._sqlite3_wasm_db_config_s=function(){return(n._sqlite3_wasm_db_config_s=n.asm.sqlite3_wasm_db_config_s).apply(null,arguments)},n._sqlite3_wasm_config_i=function(){return(n._sqlite3_wasm_config_i=n.asm.sqlite3_wasm_config_i).apply(null,arguments)},n._sqlite3_wasm_config_ii=function(){return(n._sqlite3_wasm_config_ii=n.asm.sqlite3_wasm_config_ii).apply(null,arguments)},n._sqlite3_wasm_config_j=function(){return(n._sqlite3_wasm_config_j=n.asm.sqlite3_wasm_config_j).apply(null,arguments)},n._sqlite3_wasm_init_wasmfs=function(){return(n._sqlite3_wasm_init_wasmfs=n.asm.sqlite3_wasm_init_wasmfs).apply(null,arguments)},n._sqlite3_wasm_test_intptr=function(){return(n._sqlite3_wasm_test_intptr=n.asm.sqlite3_wasm_test_intptr).apply(null,arguments)},n._sqlite3_wasm_test_voidptr=function(){return(n._sqlite3_wasm_test_voidptr=n.asm.sqlite3_wasm_test_voidptr).apply(null,arguments)},n._sqlite3_wasm_test_int64_max=function(){return(n._sqlite3_wasm_test_int64_max=n.asm.sqlite3_wasm_test_int64_max).apply(null,arguments)},n._sqlite3_wasm_test_int64_min=function(){return(n._sqlite3_wasm_test_int64_min=n.asm.sqlite3_wasm_test_int64_min).apply(null,arguments)},n._sqlite3_wasm_test_int64_times2=function(){return(n._sqlite3_wasm_test_int64_times2=n.asm.sqlite3_wasm_test_int64_times2).apply(null,arguments)},n._sqlite3_wasm_test_int64_minmax=function(){return(n._sqlite3_wasm_test_int64_minmax=n.asm.sqlite3_wasm_test_int64_minmax).apply(null,arguments)},n._sqlite3_wasm_test_int64ptr=function(){return(n._sqlite3_wasm_test_int64ptr=n.asm.sqlite3_wasm_test_int64ptr).apply(null,arguments)},n._sqlite3_wasm_test_stack_overflow=function(){return(n._sqlite3_wasm_test_stack_overflow=n.asm.sqlite3_wasm_test_stack_overflow).apply(null,arguments)},n._sqlite3_wasm_test_str_hello=function(){return(n._sqlite3_wasm_test_str_hello=n.asm.sqlite3_wasm_test_str_hello).apply(null,arguments)};var wa=n._malloc=function(){return(wa=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n._realloc=function(){return(n._realloc=n.asm.realloc).apply(null,arguments)};var ba=n._emscripten_builtin_memalign=function(){return(ba=n._emscripten_builtin_memalign=n.asm.emscripten_builtin_memalign).apply(null,arguments)};n.stackSave=function(){return(n.stackSave=n.asm.stackSave).apply(null,arguments)},n.stackRestore=function(){return(n.stackRestore=n.asm.stackRestore).apply(null,arguments)},n.stackAlloc=function(){return(n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)},n.wasmMemory=Kt;var ji;Xr=function o(){ji||qa(),ji||(Xr=o)};function qa(o){if(zn>0||(Zl(),zn>0))return;function i(){ji||(ji=!0,n.calledRun=!0,!Bi&&(ec(),A(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),tc()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),i()},1)):i()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return qa(),n.postRun||(n.postRun=[]),n.postRun.push(function(o){if(globalThis.sqlite3ApiBootstrap=function i(l=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return console.warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const a=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:typeof o<"u"?!!o.HEAPU64:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},l||{});Object.assign(a,{allocExportName:a.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:a.useStdAlloc?"free":"sqlite3_free",reallocExportName:a.useStdAlloc?"realloc":"sqlite3_realloc"},a),["exports","memory","wasmfsOpfsDir"].forEach(h=>{typeof a[h]=="function"&&(a[h]=a[h]())});const c=Object.create(null),d=Object.create(null),w=h=>c.sqlite3_js_rc_str&&c.sqlite3_js_rc_str(h)||"Unknown result code #"+h,I=h=>typeof h=="number"&&h===(h|0);class W extends Error{constructor(...f){let q;if(f.length)if(I(f[0]))if(q=f[0],f.length===1)super(w(f[0]));else{const F=w(q);typeof f[1]=="object"?super(F,f[1]):(f[0]=F+":",super(f.join(" ")))}else f.length===2&&typeof f[1]=="object"?super(...f):super(f.join(" "));this.resultCode=q||c.SQLITE_ERROR,this.name="SQLite3Error"}}W.toss=(...h)=>{throw new W(...h)};const J=W.toss;a.wasmfsOpfsDir&&!/^\/[^/]+$/.test(a.wasmfsOpfsDir)&&J("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const ee=h=>typeof h!="bigint"&&h===(h|0)&&h<=2147483647&&h>=-2147483648,se=function h(f){return h._max||(h._max=BigInt("0x7fffffffffffffff"),h._min=~h._max),f>=h._min&&f<=h._max},T=h=>h>=-0x7fffffffn-1n&&h<=0x7fffffffn,g=function h(f){return h._min||(h._min=Number.MIN_SAFE_INTEGER,h._max=Number.MAX_SAFE_INTEGER),f>=h._min&&f<=h._max},y=h=>h&&h.constructor&&ee(h.constructor.BYTES_PER_ELEMENT)?h:!1,v=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,S=h=>h.buffer instanceof v,b=(h,f,q)=>S(h)?h.slice(f,q):h.subarray(f,q),Q=h=>h&&(h instanceof Uint8Array||h instanceof Int8Array||h instanceof ArrayBuffer),V=h=>h&&(h instanceof Uint8Array||h instanceof Int8Array||h instanceof ArrayBuffer),L=h=>Q(h)||J("Value is not of a supported TypedArray type."),K=new TextDecoder("utf-8"),le=function(h,f,q){return K.decode(b(h,f,q))},_=function(h){return V(h)?le(h instanceof ArrayBuffer?new Uint8Array(h):h):Array.isArray(h)?h.join(""):(d.isPtr(h)&&(h=d.cstrToJs(h)),h)};class E extends Error{constructor(...f){f.length===2&&typeof f[1]=="object"?super(...f):f.length?super(f.join(" ")):super("Allocation failed."),this.resultCode=c.SQLITE_NOMEM,this.name="WasmAllocError"}}E.toss=(...h)=>{throw new E(...h)},Object.assign(c,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(h,f,q,F,X,ie,oe,ce,ae)=>{},sqlite3_create_function:(h,f,q,F,X,ie,oe,ce)=>{},sqlite3_create_window_function:(h,f,q,F,X,ie,oe,ce,ae,ue)=>{},sqlite3_prepare_v3:(h,f,q,F,X,ie)=>{},sqlite3_prepare_v2:(h,f,q,F,X)=>{},sqlite3_exec:(h,f,q,F,X)=>{},sqlite3_randomness:(h,f)=>{}});const k={affirmBindableTypedArray:L,flexibleString:_,bigIntFits32:T,bigIntFits64:se,bigIntFitsDouble:g,isBindableTypedArray:Q,isInt32:ee,isSQLableTypedArray:V,isTypedArray:y,typedArrayToString:le,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:S,toss:function(...h){throw new Error(h.join(" "))},toss3:J,typedArrayPart:b};Object.assign(d,{ptrSizeof:a.wasmPtrSizeof||4,ptrIR:a.wasmPtrIR||"i32",bigIntEnabled:!!a.bigIntEnabled,exports:a.exports||J("Missing API config.exports (WASM module exports)."),memory:a.memory||a.exports.memory||J("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),d.allocFromTypedArray=function(h){h instanceof ArrayBuffer&&(h=new Uint8Array(h)),L(h);const f=d.alloc(h.byteLength||1);return d.heapForSize(h.constructor).set(h.byteLength?h:[0],f),f};{const h=a.allocExportName,f=a.deallocExportName,q=a.reallocExportName;for(const F of[h,f,q])d.exports[F]instanceof Function||J("Missing required exports[",F,"] function.");d.alloc=function F(X){return F.impl(X)||E.toss("Failed to allocate",X," bytes.")},d.alloc.impl=d.exports[h],d.realloc=function F(X,ie){const oe=F.impl(X,ie);return ie?oe||E.toss("Failed to reallocate",ie," bytes."):0},d.realloc.impl=d.exports[q],d.dealloc=d.exports[f]}d.compileOptionUsed=function h(f){if(arguments.length){if(Array.isArray(f)){const q={};return f.forEach(F=>{q[F]=c.sqlite3_compileoption_used(F)}),q}else if(typeof f=="object")return Object.keys(f).forEach(q=>{f[q]=c.sqlite3_compileoption_used(q)}),f}else{if(h._result)return h._result;h._opt||(h._rx=/^([^=]+)=(.+)/,h._rxInt=/^-?\d+$/,h._opt=function(oe,ce){const ae=h._rx.exec(oe);ce[0]=ae?ae[1]:oe,ce[1]=ae?h._rxInt.test(ae[2])?+ae[2]:ae[2]:!0});const q={},F=[0,0];let X=0,ie;for(;ie=c.sqlite3_compileoption_get(X++);)h._opt(ie,F),q[F[0]]=F[1];return h._result=q}return typeof f=="string"?!!c.sqlite3_compileoption_used(f):!1},d.pstack=Object.assign(Object.create(null),{restore:d.exports.sqlite3_wasm_pstack_restore,alloc:function(h){return typeof h=="string"&&!(h=d.sizeofIR(h))&&E.toss("Invalid value for pstack.alloc(",arguments[0],")"),d.exports.sqlite3_wasm_pstack_alloc(h)||E.toss("Could not allocate",h,"bytes from the pstack.")},allocChunks:function(h,f){typeof f=="string"&&!(f=d.sizeofIR(f))&&E.toss("Invalid size value for allocChunks(",arguments[1],")");const q=d.pstack.alloc(h*f),F=[];let X=0,ie=0;for(;X<h;++X,ie+=f)F.push(q+ie);return F},allocPtr:(h=1,f=!0)=>h===1?d.pstack.alloc(f?8:d.ptrSizeof):d.pstack.allocChunks(h,f?8:d.ptrSizeof)}),Object.defineProperties(d.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_remaining}}),c.sqlite3_randomness=(...h)=>{if(h.length===1&&k.isTypedArray(h[0])&&h[0].BYTES_PER_ELEMENT===1){const f=h[0];if(f.byteLength===0)return d.exports.sqlite3_randomness(0,0),f;const q=d.pstack.pointer;try{let F=f.byteLength,X=0;const ie=d.exports.sqlite3_randomness,oe=d.heap8u(),ce=F<512?F:512,ae=d.pstack.alloc(ce);do{const ue=F>ce?ce:F;ie(ue,ae),f.set(b(oe,ae,ae+ue),X),F-=ue,X+=ue}while(F>0)}catch(F){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",F)}finally{d.pstack.restore(q)}return f}d.exports.sqlite3_randomness(...h)};let z;if(c.sqlite3_wasmfs_opfs_dir=function(){if(z!==void 0)return z;const h=a.wasmfsOpfsDir;if(!h||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return z="";try{return h&&d.xCallWrapped("sqlite3_wasm_init_wasmfs","i32",["string"],h)===0?z=h:z=""}catch{return z=""}},c.sqlite3_wasmfs_filename_is_persistent=function(h){const f=c.sqlite3_wasmfs_opfs_dir();return f&&h?h.startsWith(f+"/"):!1},c.sqlite3_js_db_uses_vfs=function(h,f,q=0){try{const F=c.sqlite3_vfs_find(f);return F?h?F===c.sqlite3_js_db_vfs(h,q)?F:!1:F===c.sqlite3_vfs_find(0)?F:!1:!1}catch{return!1}},c.sqlite3_js_vfs_list=function(){const h=[];let f=c.sqlite3_vfs_find(0);for(;f;){const q=new c.sqlite3_vfs(f);h.push(d.cstrToJs(q.$zName)),f=q.$pNext,q.dispose()}return h},c.sqlite3_js_db_export=function(h,f=0){h=d.xWrap.testConvertArg("sqlite3*",h),h||J("Invalid sqlite3* argument."),d.bigIntEnabled||J("BigInt64 support is not enabled.");const q=d.scopedAllocPush();let F;try{const X=d.scopedAlloc(8+d.ptrSizeof),ie=X+8,oe=f?d.isPtr(f)?f:d.scopedAllocCString(""+f):0;let ce=d.exports.sqlite3_wasm_db_serialize(h,oe,ie,X,0);ce&&J("Database serialization failed with code",N.capi.sqlite3_js_rc_str(ce)),F=d.peekPtr(ie);const ae=d.peek(X,"i64");return ce=ae?d.heap8u().slice(F,F+Number(ae)):new Uint8Array,ce}finally{F&&d.exports.sqlite3_free(F),d.scopedAllocPop(q)}},c.sqlite3_js_db_vfs=(h,f=0)=>d.sqlite3_wasm_db_vfs(h,f),c.sqlite3_js_aggregate_context=(h,f)=>c.sqlite3_aggregate_context(h,f)||(f?E.toss("Cannot allocate",f,"bytes for sqlite3_aggregate_context()"):0),c.sqlite3_js_posix_create_file=function(h,f,q){let F;f&&d.isPtr(f)?F=f:f instanceof ArrayBuffer||f instanceof Uint8Array?(F=d.allocFromTypedArray(f),(arguments.length<3||!k.isInt32(q)||q<0)&&(q=f.byteLength)):W.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!k.isInt32(q)||q<0)&&W.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const X=d.sqlite3_wasm_posix_create_file(h,F,q);X&&W.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(X))}finally{d.dealloc(F)}},c.sqlite3_js_vfs_create_file=function(h,f,q,F){a.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let X;q?(d.isPtr(q)?X=q:q instanceof ArrayBuffer&&(q=new Uint8Array(q)),q instanceof Uint8Array?(X=d.allocFromTypedArray(q),(arguments.length<4||!k.isInt32(F)||F<0)&&(F=q.byteLength)):W.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):X=0,(!k.isInt32(F)||F<0)&&(d.dealloc(X),W.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const ie=d.sqlite3_wasm_vfs_create_file(h,f,X,F);ie&&W.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(ie))}finally{d.dealloc(X)}},k.isUIThread()){const h=function(f){const q=Object.create(null);return q.prefix="kvvfs-"+f,q.stores=[],(f==="session"||f==="")&&q.stores.push(globalThis.sessionStorage),(f==="local"||f==="")&&q.stores.push(globalThis.localStorage),q};c.sqlite3_js_kvvfs_clear=function(f=""){let q=0;const F=h(f);return F.stores.forEach(X=>{const ie=[];let oe;for(oe=0;oe<X.length;++oe){const ce=X.key(oe);ce.startsWith(F.prefix)&&ie.push(ce)}ie.forEach(ce=>X.removeItem(ce)),q+=ie.length}),q},c.sqlite3_js_kvvfs_size=function(f=""){let q=0;const F=h(f);return F.stores.forEach(X=>{let ie;for(ie=0;ie<X.length;++ie){const oe=X.key(ie);oe.startsWith(F.prefix)&&(q+=oe.length,q+=X.getItem(oe).length)}}),q*2}}c.sqlite3_db_config=function(h,f,...q){switch(this.s||(this.s=d.xWrap("sqlite3_wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=d.xWrap("sqlite3_wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=d.xWrap("sqlite3_wasm_db_config_ip","int",["sqlite3*","int","int","*"])),f){case c.SQLITE_DBCONFIG_ENABLE_FKEY:case c.SQLITE_DBCONFIG_ENABLE_TRIGGER:case c.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case c.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case c.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case c.SQLITE_DBCONFIG_ENABLE_QPSG:case c.SQLITE_DBCONFIG_TRIGGER_EQP:case c.SQLITE_DBCONFIG_RESET_DATABASE:case c.SQLITE_DBCONFIG_DEFENSIVE:case c.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case c.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case c.SQLITE_DBCONFIG_DQS_DML:case c.SQLITE_DBCONFIG_DQS_DDL:case c.SQLITE_DBCONFIG_ENABLE_VIEW:case c.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case c.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case c.SQLITE_DBCONFIG_STMT_SCANSTATUS:case c.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(h,f,q[0],q[1]||0);case c.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(h,f,q[0],q[1],q[2]);case c.SQLITE_DBCONFIG_MAINDBNAME:return this.s(h,f,q[0]);default:return c.SQLITE_MISUSE}}.bind(Object.create(null)),c.sqlite3_value_to_js=function(h,f=!0){let q;const F=c.sqlite3_value_type(h);switch(F){case c.SQLITE_INTEGER:d.bigIntEnabled?(q=c.sqlite3_value_int64(h),k.bigIntFitsDouble(q)&&(q=Number(q))):q=c.sqlite3_value_double(h);break;case c.SQLITE_FLOAT:q=c.sqlite3_value_double(h);break;case c.SQLITE_TEXT:q=c.sqlite3_value_text(h);break;case c.SQLITE_BLOB:{const X=c.sqlite3_value_bytes(h),ie=c.sqlite3_value_blob(h);X&&!ie&&N.WasmAllocError.toss("Cannot allocate memory for blob argument of",X,"byte(s)"),q=X?d.heap8u().slice(ie,ie+Number(X)):null;break}case c.SQLITE_NULL:q=null;break;default:f&&J(c.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",F),q=void 0}return q},c.sqlite3_values_to_js=function(h,f,q=!0){let F;const X=[];for(F=0;F<h;++F)X.push(c.sqlite3_value_to_js(d.peekPtr(f+d.ptrSizeof*F),q));return X},c.sqlite3_result_error_js=function(h,f){f instanceof E?c.sqlite3_result_error_nomem(h):c.sqlite3_result_error(h,""+f,-1)},c.sqlite3_result_js=function(h,f){if(f instanceof Error){c.sqlite3_result_error_js(h,f);return}try{switch(typeof f){case"undefined":break;case"boolean":c.sqlite3_result_int(h,f?1:0);break;case"bigint":k.bigIntFits32(f)?c.sqlite3_result_int(h,Number(f)):k.bigIntFitsDouble(f)?c.sqlite3_result_double(h,Number(f)):d.bigIntEnabled?k.bigIntFits64(f)?c.sqlite3_result_int64(h,f):J("BigInt value",f.toString(),"is too BigInt for int64."):J("BigInt value",f.toString(),"is too BigInt.");break;case"number":{let q;k.isInt32(f)?q=c.sqlite3_result_int:d.bigIntEnabled&&Number.isInteger(f)&&k.bigIntFits64(BigInt(f))?q=c.sqlite3_result_int64:q=c.sqlite3_result_double,q(h,f);break}case"string":{const[q,F]=d.allocCString(f,!0);c.sqlite3_result_text(h,q,F,c.SQLITE_WASM_DEALLOC);break}case"object":if(f===null){c.sqlite3_result_null(h);break}else if(k.isBindableTypedArray(f)){const q=d.allocFromTypedArray(f);c.sqlite3_result_blob(h,q,f.byteLength,c.SQLITE_WASM_DEALLOC);break}default:J("Don't not how to handle this UDF result value:",typeof f,f)}}catch(q){c.sqlite3_result_error_js(h,q)}},c.sqlite3_column_js=function(h,f,q=!0){const F=c.sqlite3_column_value(h,f);return F===0?void 0:c.sqlite3_value_to_js(F,q)};const m=function(h,f,q){q=c[q],this.ptr?d.pokePtr(this.ptr,0):this.ptr=d.allocPtr();const F=q(h,f,this.ptr);if(F)return W.toss(F,arguments[2]+"() failed with code "+F);const X=d.peekPtr(this.ptr);return X?c.sqlite3_value_to_js(X,!0):void 0}.bind(Object.create(null));c.sqlite3_preupdate_new_js=(h,f)=>m(h,f,"sqlite3_preupdate_new"),c.sqlite3_preupdate_old_js=(h,f)=>m(h,f,"sqlite3_preupdate_old"),c.sqlite3changeset_new_js=(h,f)=>m(h,f,"sqlite3changeset_new"),c.sqlite3changeset_old_js=(h,f)=>m(h,f,"sqlite3changeset_old");const N={WasmAllocError:E,SQLite3Error:W,capi:c,util:k,wasm:d,config:a,version:Object.create(null),client:void 0,asyncPostInit:async function h(){if(h.isReady instanceof Promise)return h.isReady;let f=i.initializersAsync;delete i.initializersAsync;const q=async()=>(N.__isUnderTest||(delete N.util,delete N.StructBinder),N),F=ie=>{throw a.error("an async sqlite3 initializer failed:",ie),ie};if(!f||!f.length)return h.isReady=q().catch(F);f=f.map(ie=>ie instanceof Function?async oe=>ie(N):ie),f.push(q);let X=Promise.resolve(N);for(;f.length;)X=X.then(f.shift());return h.isReady=X.catch(F)},scriptInfo:void 0};try{i.initializers.forEach(h=>{h(N)})}catch(h){throw console.error("sqlite3 bootstrap initializer threw:",h),h}return delete i.initializers,i.sqlite3=N,N},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(i){i.bigIntEnabled===void 0&&(i.bigIntEnabled=!!globalThis.BigInt64Array);const l=(..._)=>{throw new Error(_.join(" "))};i.exports||Object.defineProperty(i,"exports",{enumerable:!0,configurable:!0,get:()=>i.instance&&i.instance.exports});const a=i.pointerIR||"i32",c=i.ptrSizeof=a==="i32"?4:a==="i64"?8:l("Unhandled ptrSizeof:",a),d=Object.create(null);d.heapSize=0,d.memory=null,d.freeFuncIndexes=[],d.scopedAlloc=[],d.utf8Decoder=new TextDecoder,d.utf8Encoder=new TextEncoder("utf-8"),i.sizeofIR=_=>{switch(_){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return c;default:return(""+_).endsWith("*")?c:void 0}};const w=function(){if(!d.memory)d.memory=i.memory instanceof WebAssembly.Memory?i.memory:i.exports.memory;else if(d.heapSize===d.memory.buffer.byteLength)return d;const _=d.memory.buffer;return d.HEAP8=new Int8Array(_),d.HEAP8U=new Uint8Array(_),d.HEAP16=new Int16Array(_),d.HEAP16U=new Uint16Array(_),d.HEAP32=new Int32Array(_),d.HEAP32U=new Uint32Array(_),i.bigIntEnabled&&(d.HEAP64=new BigInt64Array(_),d.HEAP64U=new BigUint64Array(_)),d.HEAP32F=new Float32Array(_),d.HEAP64F=new Float64Array(_),d.heapSize=_.byteLength,d};i.heap8=()=>w().HEAP8,i.heap8u=()=>w().HEAP8U,i.heap16=()=>w().HEAP16,i.heap16u=()=>w().HEAP16U,i.heap32=()=>w().HEAP32,i.heap32u=()=>w().HEAP32U,i.heapForSize=function(_,E=!0){const k=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:w();switch(_){case Int8Array:return k.HEAP8;case Uint8Array:return k.HEAP8U;case Int16Array:return k.HEAP16;case Uint16Array:return k.HEAP16U;case Int32Array:return k.HEAP32;case Uint32Array:return k.HEAP32U;case 8:return E?k.HEAP8U:k.HEAP8;case 16:return E?k.HEAP16U:k.HEAP16;case 32:return E?k.HEAP32U:k.HEAP32;case 64:if(k.HEAP64)return E?k.HEAP64U:k.HEAP64;break;default:if(i.bigIntEnabled){if(_===globalThis.BigUint64Array)return k.HEAP64U;if(_===globalThis.BigInt64Array)return k.HEAP64;break}}l("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},i.functionTable=function(){return i.exports.__indirect_function_table},i.functionEntry=function(_){const E=i.functionTable();return _<E.length?E.get(_):void 0},i.jsFuncToWasm=function _(E,k){if(_._||(_._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(N,h,f){f<128?N[h](f):N[h](f%128|128,f>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(N){const h=_._.rxJSig.exec(N);return h?h[2]:N.substr(1)},letterType:N=>_._.sigTypes[N]||l("Invalid signature letter:",N),pushSigType:(N,h)=>N.push(_._.typeCodes[_._.letterType(h)])}),typeof E=="string"){const N=k;k=E,E=N}const z=_._.sigParams(k),m=[1,96];_._.uleb128Encode(m,"push",z.length);for(const N of z)_._.pushSigType(m,N);return k[0]==="v"?m.push(0):(m.push(1),_._.pushSigType(m,k[0])),_._.uleb128Encode(m,"unshift",m.length),m.unshift(0,97,115,109,1,0,0,0,1),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(m)),{e:{f:E}}).exports.f};const I=function(E,k,z){if(z&&!d.scopedAlloc.length&&l("No scopedAllocPush() scope is active."),typeof E=="string"){const f=k;k=E,E=f}(typeof k!="string"||!(E instanceof Function))&&l("Invalid arguments: expecting (function,signature) or (signature,function).");const m=i.functionTable(),N=m.length;let h;for(;d.freeFuncIndexes.length&&(h=d.freeFuncIndexes.pop(),m.get(h));){h=null;continue}h||(h=N,m.grow(1));try{return m.set(h,E),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(h),h}catch(f){if(!(f instanceof TypeError))throw h===N&&d.freeFuncIndexes.push(N),f}try{const f=i.jsFuncToWasm(E,k);m.set(h,f),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(h)}catch(f){throw h===N&&d.freeFuncIndexes.push(N),f}return h};i.installFunction=(_,E)=>I(_,E,!1),i.scopedInstallFunction=(_,E)=>I(_,E,!0),i.uninstallFunction=function(_){if(!_&&_!==0)return;const E=d.freeFuncIndexes,k=i.functionTable();E.push(_);const z=k.get(_);return k.set(_,null),z},i.peek=function(E,k="i8"){k.endsWith("*")&&(k=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:w(),m=Array.isArray(E)?[]:void 0;let N;do{switch(m&&(E=arguments[0].shift()),k){case"i1":case"i8":N=z.HEAP8[E>>0];break;case"i16":N=z.HEAP16[E>>1];break;case"i32":N=z.HEAP32[E>>2];break;case"float":case"f32":N=z.HEAP32F[E>>2];break;case"double":case"f64":N=Number(z.HEAP64F[E>>3]);break;case"i64":if(i.bigIntEnabled){N=BigInt(z.HEAP64[E>>3]);break}default:l("Invalid type for peek():",k)}m&&m.push(N)}while(m&&arguments[0].length);return m||N},i.poke=function(_,E,k="i8"){k.endsWith("*")&&(k=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:w();for(const m of Array.isArray(_)?_:[_])switch(k){case"i1":case"i8":z.HEAP8[m>>0]=E;continue;case"i16":z.HEAP16[m>>1]=E;continue;case"i32":z.HEAP32[m>>2]=E;continue;case"float":case"f32":z.HEAP32F[m>>2]=E;continue;case"double":case"f64":z.HEAP64F[m>>3]=E;continue;case"i64":if(z.HEAP64){z.HEAP64[m>>3]=BigInt(E);continue}default:l("Invalid type for poke(): "+k)}return this},i.peekPtr=(..._)=>i.peek(_.length===1?_[0]:_,a),i.pokePtr=(_,E=0)=>i.poke(_,E,a),i.peek8=(..._)=>i.peek(_.length===1?_[0]:_,"i8"),i.poke8=(_,E)=>i.poke(_,E,"i8"),i.peek16=(..._)=>i.peek(_.length===1?_[0]:_,"i16"),i.poke16=(_,E)=>i.poke(_,E,"i16"),i.peek32=(..._)=>i.peek(_.length===1?_[0]:_,"i32"),i.poke32=(_,E)=>i.poke(_,E,"i32"),i.peek64=(..._)=>i.peek(_.length===1?_[0]:_,"i64"),i.poke64=(_,E)=>i.poke(_,E,"i64"),i.peek32f=(..._)=>i.peek(_.length===1?_[0]:_,"f32"),i.poke32f=(_,E)=>i.poke(_,E,"f32"),i.peek64f=(..._)=>i.peek(_.length===1?_[0]:_,"f64"),i.poke64f=(_,E)=>i.poke(_,E,"f64"),i.getMemValue=i.peek,i.getPtrValue=i.peekPtr,i.setMemValue=i.poke,i.setPtrValue=i.pokePtr,i.isPtr32=_=>typeof _=="number"&&_===(_|0)&&_>=0,i.isPtr=i.isPtr32,i.cstrlen=function(_){if(!_||!i.isPtr(_))return null;const E=w().HEAP8U;let k=_;for(;E[k]!==0;++k);return k-_};const W=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,J=function(_,E,k){return d.utf8Decoder.decode(_.buffer instanceof W?_.slice(E,k):_.subarray(E,k))};i.cstrToJs=function(_){const E=i.cstrlen(_);return E?J(w().HEAP8U,_,_+E):E===null?E:""},i.jstrlen=function(_){if(typeof _!="string")return null;const E=_.length;let k=0;for(let z=0;z<E;++z){let m=_.charCodeAt(z);m>=55296&&m<=57343&&(m=65536+((m&1023)<<10)|_.charCodeAt(++z)&1023),m<=127?++k:m<=2047?k+=2:m<=65535?k+=3:k+=4}return k},i.jstrcpy=function(_,E,k=0,z=-1,m=!0){if((!E||!(E instanceof Int8Array)&&!(E instanceof Uint8Array))&&l("jstrcpy() target must be an Int8Array or Uint8Array."),z<0&&(z=E.length-k),!(z>0)||!(k>=0))return 0;let N=0,h=_.length;const f=k,q=k+z-(m?1:0);for(;N<h&&k<q;++N){let F=_.charCodeAt(N);if(F>=55296&&F<=57343&&(F=65536+((F&1023)<<10)|_.charCodeAt(++N)&1023),F<=127){if(k>=q)break;E[k++]=F}else if(F<=2047){if(k+1>=q)break;E[k++]=192|F>>6,E[k++]=128|F&63}else if(F<=65535){if(k+2>=q)break;E[k++]=224|F>>12,E[k++]=128|F>>6&63,E[k++]=128|F&63}else{if(k+3>=q)break;E[k++]=240|F>>18,E[k++]=128|F>>12&63,E[k++]=128|F>>6&63,E[k++]=128|F&63}}return m&&(E[k++]=0),k-f},i.cstrncpy=function(_,E,k){if((!_||!E)&&l("cstrncpy() does not accept NULL strings."),k<0)k=i.cstrlen(strPtr)+1;else if(!(k>0))return 0;const z=i.heap8u();let m=0,N;for(;m<k&&(N=z[E+m]);++m)z[_+m]=N;return m<k&&(z[_+m++]=0),m},i.jstrToUintArray=(_,E=!1)=>d.utf8Encoder.encode(E?_+"\0":_);const ee=(_,E)=>{(!(_.alloc instanceof Function)||!(_.dealloc instanceof Function))&&l("Object is missing alloc() and/or dealloc() function(s)","required by",E+"().")},se=function(_,E,k,z){if(ee(i,z),typeof _!="string")return null;{const m=d.utf8Encoder.encode(_),N=k(m.length+1),h=w().HEAP8U;return h.set(m,N),h[N+m.length]=0,E?[N,m.length]:N}};i.allocCString=(_,E=!1)=>se(_,E,i.alloc,"allocCString()"),i.scopedAllocPush=function(){ee(i,"scopedAllocPush");const _=[];return d.scopedAlloc.push(_),_},i.scopedAllocPop=function(_){ee(i,"scopedAllocPop");const E=arguments.length?d.scopedAlloc.indexOf(_):d.scopedAlloc.length-1;E<0&&l("Invalid state object for scopedAllocPop()."),arguments.length===0&&(_=d.scopedAlloc[E]),d.scopedAlloc.splice(E,1);for(let k;k=_.pop();)i.functionEntry(k)?i.uninstallFunction(k):i.dealloc(k)},i.scopedAlloc=function(_){d.scopedAlloc.length||l("No scopedAllocPush() scope is active.");const E=i.alloc(_);return d.scopedAlloc[d.scopedAlloc.length-1].push(E),E},Object.defineProperty(i.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>d.scopedAlloc.length,set:()=>l("The 'active' property is read-only.")}),i.scopedAllocCString=(_,E=!1)=>se(_,E,i.scopedAlloc,"scopedAllocCString()");const T=function(_,E){const k=i[_?"scopedAlloc":"alloc"]((E.length+1)*i.ptrSizeof);let z=0;return E.forEach(m=>{i.pokePtr(k+i.ptrSizeof*z++,i[_?"scopedAllocCString":"allocCString"](""+m))}),i.pokePtr(k+i.ptrSizeof*z,0),k};i.scopedAllocMainArgv=_=>T(!0,_),i.allocMainArgv=_=>T(!1,_),i.cArgvToJs=(_,E)=>{const k=[];for(let z=0;z<_;++z){const m=i.peekPtr(E+i.ptrSizeof*z);k.push(m?i.cstrToJs(m):null)}return k},i.scopedAllocCall=function(_){i.scopedAllocPush();try{return _()}finally{i.scopedAllocPop()}};const g=function(_,E,k){ee(i,k);const z=E?"i64":a;let m=i[k](_*(E?8:c));if(i.poke(m,0,z),_===1)return m;const N=[m];for(let h=1;h<_;++h)m+=E?8:c,N[h]=m,i.poke(m,0,z);return N};i.allocPtr=(_=1,E=!0)=>g(_,E,"alloc"),i.scopedAllocPtr=(_=1,E=!0)=>g(_,E,"scopedAlloc"),i.xGet=function(_){return i.exports[_]||l("Cannot find exported symbol:",_)};const y=(_,E)=>l(_+"() requires",E,"argument(s).");i.xCall=function(_,...E){const k=i.xGet(_);return k instanceof Function||l("Exported symbol",_,"is not a function."),k.length!==E.length&&y(_,k.length),arguments.length===2&&Array.isArray(arguments[1])?k.apply(null,arguments[1]):k.apply(null,E)},d.xWrap=Object.create(null),d.xWrap.convert=Object.create(null),d.xWrap.convert.arg=new Map,d.xWrap.convert.result=new Map;const v=d.xWrap.convert.arg,S=d.xWrap.convert.result;i.bigIntEnabled&&v.set("i64",_=>BigInt(_));const b=a==="i32"?_=>_|0:_=>BigInt(_)|BigInt(0);v.set("i32",b).set("i16",_=>(_|0)&65535).set("i8",_=>(_|0)&255).set("f32",_=>Number(_).valueOf()).set("float",v.get("f32")).set("f64",v.get("f32")).set("double",v.get("f64")).set("int",v.get("i32")).set("null",_=>_).set(null,v.get("null")).set("**",b).set("*",b),S.set("*",b).set("pointer",b).set("number",_=>Number(_)).set("void",_=>{}).set("null",_=>_).set(null,S.get("null"));{const _=["i8","i16","i32","int","f32","float","f64","double"];i.bigIntEnabled&&_.push("i64");const E=v.get(a);for(const k of _)v.set(k+"*",E),S.set(k+"*",E),S.set(k,v.get(k)||l("Missing arg converter:",k))}const Q=function(_){return typeof _=="string"?i.scopedAllocCString(_):_?b(_):null};v.set("string",Q).set("utf8",Q).set("pointer",Q),S.set("string",_=>i.cstrToJs(_)).set("utf8",S.get("string")).set("string:dealloc",_=>{try{return _?i.cstrToJs(_):null}finally{i.dealloc(_)}}).set("utf8:dealloc",S.get("string:dealloc")).set("json",_=>JSON.parse(i.cstrToJs(_))).set("json:dealloc",_=>{try{return _?JSON.parse(i.cstrToJs(_)):null}finally{i.dealloc(_)}});const V=class{constructor(_){this.name=_.name||"unnamed adapter"}convertArg(_,E,k){l("AbstractArgAdapter must be subclassed.")}};v.FuncPtrAdapter=class un extends V{constructor(E){super(E),v.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",E),this.name=E.name||"unnamed",this.signature=E.signature,E.contextKey instanceof Function&&(this.contextKey=E.contextKey,E.bindScope||(E.bindScope="context")),this.bindScope=E.bindScope||l("FuncPtrAdapter options requires a bindScope (explicit or implied)."),un.bindScopes.indexOf(E.bindScope)<0&&l("Invalid options.bindScope ("+E.bindMod+") for FuncPtrAdapter. Expecting one of: ("+un.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=E.callProxy instanceof Function?E.callProxy:void 0}contextKey(E,k){return this}contextMap(E){const k=this.__cmap||(this.__cmap=new Map);let z=k.get(E);return z===void 0&&k.set(E,z=[]),z}convertArg(E,k,z){let m=this.singleton;if(!m&&this.isContext&&(m=this.contextMap(this.contextKey(k,z))),m&&m[0]===E)return m[1];if(E instanceof Function){this.callProxy&&(E=this.callProxy(E));const N=I(E,this.signature,this.isTransient);if(un.debugFuncInstall&&un.debugOut("FuncPtrAdapter installed",this,this.contextKey(k,z),"@"+N,E),m){if(m[1]){un.debugFuncInstall&&un.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(k,z),"@"+m[1],E);try{d.scopedAlloc[d.scopedAlloc.length-1].push(m[1])}catch{}}m[0]=E,m[1]=N}return N}else if(i.isPtr(E)||E===null||E===void 0){if(m&&m[1]&&m[1]!==E){un.debugFuncInstall&&un.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(k,z),"@"+m[1],E);try{d.scopedAlloc[d.scopedAlloc.length-1].push(m[1])}catch{}m[0]=m[1]=E|0}return E||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},v.FuncPtrAdapter.warnOnUse=!1,v.FuncPtrAdapter.debugFuncInstall=!1,v.FuncPtrAdapter.debugOut=console.debug.bind(console),v.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const L=_=>v.get(_)||l("Argument adapter not found:",_),K=_=>S.get(_)||l("Result adapter not found:",_);d.xWrap.convertArg=(_,...E)=>L(_)(...E),d.xWrap.convertArgNoCheck=(_,...E)=>v.get(_)(...E),d.xWrap.convertResult=(_,E)=>_===null?E:_?K(_)(E):void 0,d.xWrap.convertResultNoCheck=(_,E)=>_===null?E:_?S.get(_)(E):void 0,i.xWrap=function(_,E,...k){arguments.length===3&&Array.isArray(arguments[2])&&(k=arguments[2]),i.isPtr(_)&&(_=i.functionEntry(_)||l("Function pointer not found in WASM function table."));const z=_ instanceof Function,m=z?_:i.xGet(_);if(z&&(_=m.name||"unnamed function"),k.length!==m.length&&y(_,m.length),E===null&&m.length===0)return m;E!=null&&K(E);for(const h of k)h instanceof V?v.set(h,(...f)=>h.convertArg(...f)):L(h);const N=d.xWrap;return m.length===0?(...h)=>h.length?y(_,m.length):N.convertResult(E,m.call(null)):function(...h){h.length!==m.length&&y(_,m.length);const f=i.scopedAllocPush();try{for(const q in h)h[q]=N.convertArgNoCheck(k[q],h[q],h,q);return N.convertResultNoCheck(E,m.apply(null,h))}finally{i.scopedAllocPop(f)}}};const le=function(_,E,k,z,m,N){if(typeof k=="string"){if(E===1)return N.get(k);if(E===2){if(z)z instanceof Function||l(m,"requires a function argument.");else return delete N.get(k),_;return N.set(k,z),_}}l("Invalid arguments to",m)};return i.xWrap.resultAdapter=function _(E,k){return le(_,arguments.length,E,k,"resultAdapter()",S)},i.xWrap.argAdapter=function _(E,k){return le(_,arguments.length,E,k,"argAdapter()",v)},i.xWrap.FuncPtrAdapter=v.FuncPtrAdapter,i.xCallWrapped=function(_,E,k,...z){return Array.isArray(arguments[3])&&(z=arguments[3]),i.xWrap(_,E,k||[]).apply(null,z||[])},i.xWrap.testConvertArg=d.xWrap.convertArg,i.xWrap.testConvertResult=d.xWrap.convertResult,i},globalThis.WhWasmUtilInstaller.yawl=function(i){const l=()=>fetch(i.uri,{credentials:"same-origin"}),a=this,c=function(w){if(i.wasmUtilTarget){const I=(...J)=>{throw new Error(J.join(" "))},W=i.wasmUtilTarget;if(W.module=w.module,W.instance=w.instance,W.instance.exports.memory||(W.memory=i.imports&&i.imports.env&&i.imports.env.memory||I("Missing 'memory' object!")),!W.alloc&&w.instance.exports.malloc){const J=w.instance.exports;W.alloc=function(ee){return J.malloc(ee)||I("Allocation of",ee,"bytes failed.")},W.dealloc=function(ee){J.free(ee)}}a(W)}return i.onload&&i.onload(w,i),w};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(l(),i.imports||{}).then(c)}:function(){return l().then(I=>I.arrayBuffer()).then(I=>WebAssembly.instantiate(I,i.imports||{})).then(c)}}.bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(l){const a=(...x)=>{throw new Error(x.join(" "))};!(l.heap instanceof WebAssembly.Memory)&&!(l.heap instanceof Function)&&a("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(x){l[x]instanceof Function||a("Config option '"+x+"' must be a function.")});const c=i,d=l.heap instanceof Function?l.heap:()=>new Uint8Array(l.heap.buffer),w=l.alloc,I=l.dealloc,W=l.log||console.log.bind(console),J=l.memberPrefix||"",ee=l.memberSuffix||"",se=l.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!l.bigIntEnabled,T=globalThis.BigInt,g=globalThis.BigInt64Array,y=l.ptrSizeof||4,v=l.ptrIR||"i32";c.debugFlags||(c.__makeDebugFlags=function(x=null){x&&x.__flags&&(x=x.__flags);const C=function R($){return arguments.length===0?R.__flags:($<0?(delete R.__flags.getter,delete R.__flags.setter,delete R.__flags.alloc,delete R.__flags.dealloc):(R.__flags.getter=(1&$)!==0,R.__flags.setter=(2&$)!==0,R.__flags.alloc=(4&$)!==0,R.__flags.dealloc=(8&$)!==0),R._flags)};return Object.defineProperty(C,"__flags",{iterable:!1,writable:!1,value:Object.create(x)}),x||C(0),C},c.debugFlags=c.__makeDebugFlags());const S=function(){const x=new ArrayBuffer(2);return new DataView(x).setInt16(0,256,!0),new Int16Array(x)[0]===256}(),b=x=>x[1]==="(",Q=x=>x==="P",V=x=>b(x)?"p":x[0],L=function(x){switch(V(x)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return v;case"j":return"i64";case"f":return"float";case"d":return"double"}a("Unhandled signature IR:",x)},K=g?()=>!0:()=>a("BigInt64Array is not available."),le=function(x){switch(V(x)){case"p":case"P":case"s":{switch(y){case 4:return"getInt32";case 8:return K()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return K()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}a("Unhandled DataView getter for signature:",x)},_=function(x){switch(V(x)){case"p":case"P":case"s":{switch(y){case 4:return"setInt32";case 8:return K()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return K()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}a("Unhandled DataView setter for signature:",x)},E=function(x){switch(V(x)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return K()&&T;case"p":case"P":case"s":switch(y){case 4:return Number;case 8:return K()&&T}break}a("Unhandled DataView set wrapper for signature:",x)},k=(x,C)=>x+"::"+C,z=function(x,C){return()=>a(k(x,C),"is read-only.")},m=new WeakMap,N="(pointer-is-external)",h=function(x,C,R){if(R||(R=m.get(C)),R){if(m.delete(C),Array.isArray(C.ondispose)){let $;for(;$=C.ondispose.shift();)try{$ instanceof Function?$.call(C):$ instanceof Z?$.dispose():typeof $=="number"&&I($)}catch(de){console.warn("ondispose() for",x.structName,"@",R,"threw. NOT propagating it.",de)}}else if(C.ondispose instanceof Function)try{C.ondispose()}catch($){console.warn("ondispose() for",x.structName,"@",R,"threw. NOT propagating it.",$)}delete C.ondispose,x.debugFlags.__flags.dealloc&&W("debug.dealloc:",C[N]?"EXTERNAL":"",x.structName,"instance:",x.structInfo.sizeof,"bytes @"+R),C[N]||I(R)}},f=x=>({configurable:!1,writable:!1,iterable:!1,value:x}),q=function(x,C,R){let $=!R;R?Object.defineProperty(C,N,f(R)):(R=w(x.structInfo.sizeof),R||a("Allocation of",x.structName,"structure failed."));try{x.debugFlags.__flags.alloc&&W("debug.alloc:",$?"":"EXTERNAL",x.structName,"instance:",x.structInfo.sizeof,"bytes @"+R),$&&d().fill(0,R,R+x.structInfo.sizeof),m.set(C,R)}catch(de){throw h(x,C,R),de}},F=function(){const x=this.pointer;return x?new Uint8Array(d().slice(x,x+this.structInfo.sizeof)):null},ie=f(x=>J+x+ee),oe=function(x,C,R=!0){let $=x.members[C];if(!$&&(J||ee)){for(const de of Object.values(x.members))if(de.key===C){$=de;break}!$&&R&&a(k(x.name,C),"is not a mapped struct member.")}return $},ce=function x(C,R,$=!1){x._||(x._=ge=>ge.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const de=oe(C.structInfo,R,!0);return $?x._(de.signature):de.signature},ae={configurable:!1,enumerable:!1,get:function(){return m.get(this)},set:()=>a("Cannot assign the 'pointer' property of a struct.")},ue=f(function(){const x=[];for(const C of Object.keys(this.structInfo.members))x.push(this.memberKey(C));return x}),be=new TextDecoder("utf-8"),qe=new TextEncoder,st=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,P=function(x,C,R){return be.decode(x.buffer instanceof st?x.slice(C,R):x.subarray(C,R))},B=function(x,C,R=!1){const $=oe(x.structInfo,C,R);return $&&$.signature.length===1&&$.signature[0]==="s"?$:!1},j=function(x){x.signature!=="s"&&a("Invalid member type signature for C-string value:",JSON.stringify(x))},re=function(C,R){const $=oe(C.structInfo,R,!0);j($);const de=C[$.key];if(!de)return null;let ge=de;const Qe=d();for(;Qe[ge]!==0;++ge);return de===ge?"":P(Qe,de,ge)},Y=function(x,...C){x.ondispose?Array.isArray(x.ondispose)||(x.ondispose=[x.ondispose]):x.ondispose=[],x.ondispose.push(...C)},he=function(x){const C=qe.encode(x),R=w(C.length+1);R||a("Allocation error while duplicating string:",x);const $=d();return $.set(C,R),$[R+C.length]=0,R},Fe=function(x,C,R){const $=oe(x.structInfo,C,!0);j($);const de=he(R);return x[$.key]=de,Y(x,de),x},Z=function(C,R){arguments[2]!==f&&a("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:f(C),structInfo:f(R)})};Z.prototype=Object.create(null,{dispose:f(function(){h(this.constructor,this)}),lookupMember:f(function(x,C=!0){return oe(this.structInfo,x,C)}),memberToJsString:f(function(x){return re(this,x)}),memberIsString:f(function(x,C=!0){return B(this,x,C)}),memberKey:ie,memberKeys:ue,memberSignature:f(function(x,C=!1){return ce(this,x,C)}),memoryDump:f(F),pointer:ae,setMemberCString:f(function(x,C){return Fe(this,x,C)})}),Object.assign(Z.prototype,{addOnDispose:function(...x){return Y(this,...x),this}}),Object.defineProperties(Z,{allocCString:f(he),isA:f(x=>x instanceof Z),hasExternalPointer:f(x=>x instanceof Z&&!!x[N]),memberKey:ie});const ne=x=>Number.isFinite(x)||x instanceof(T||Number),O=function x(C,R,$){if(!x._){x._={getters:{},setters:{},sw:{}};const qt=["i","c","C","p","P","s","f","d","v()"];se&&qt.push("j"),qt.forEach(function(Xt){x._.getters[Xt]=le(Xt),x._.setters[Xt]=_(Xt),x._.sw[Xt]=E(Xt)});const su=/^[ipPsjfdcC]$/,ou=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;x.sigCheck=function(Xt,au,Na,uo){Object.prototype.hasOwnProperty.call(Xt,Na)&&a(Xt.structName,"already has a property named",Na+"."),su.test(uo)||ou.test(uo)||a("Malformed signature for",k(Xt.structName,au)+":",uo)}}const de=C.memberKey(R);x.sigCheck(C.prototype,R,de,$.signature),$.key=de,$.name=R;const ge=V($.signature),Qe=k(C.prototype.structName,de),je=C.prototype.debugFlags.__flags,mr=Object.create(null);mr.configurable=!1,mr.enumerable=!1,mr.get=function(){je.getter&&W("debug.getter:",x._.getters[ge],"for",L(ge),Qe,"@",this.pointer,"+",$.offset,"sz",$.sizeof);let qt=new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[x._.getters[ge]](0,S);return je.getter&&W("debug.getter:",Qe,"result =",qt),qt},$.readOnly?mr.set=z(C.prototype.structName,de):mr.set=function(qt){if(je.setter&&W("debug.setter:",x._.setters[ge],"for",L(ge),Qe,"@",this.pointer,"+",$.offset,"sz",$.sizeof,qt),this.pointer||a("Cannot set struct property on disposed instance."),qt===null)qt=0;else for(;!ne(qt);){if(Q($.signature)&&qt instanceof Z){qt=qt.pointer||0,je.setter&&W("debug.setter:",Qe,"resolved to",qt);break}a("Invalid value for pointer-type",Qe+".")}new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[x._.setters[ge]](0,x._.sw[ge](qt),S)},Object.defineProperty(C.prototype,de,mr)},D=function x(C,R){arguments.length===1?(R=C,C=R.name):R.name||(R.name=C),C||a("Struct name is required.");let $=!1;Object.keys(R.members).forEach(Qe=>{const je=R.members[Qe];je.sizeof?je.sizeof===1?je.signature==="c"||je.signature==="C"||a("Unexpected sizeof==1 member",k(R.name,Qe),"with signature",je.signature):(je.sizeof%4!==0&&(console.warn("Invalid struct member description =",je,"from",R),a(C,"member",Qe,"sizeof is not aligned. sizeof="+je.sizeof)),je.offset%4!==0&&(console.warn("Invalid struct member description =",je,"from",R),a(C,"member",Qe,"offset is not aligned. offset="+je.offset))):a(C,"member",Qe,"is missing sizeof."),(!$||$.offset<je.offset)&&($=je)}),$?R.sizeof<$.offset+$.sizeof&&a("Invalid struct config:",C,"max member offset ("+$.offset+") ","extends past end of struct (sizeof="+R.sizeof+")."):a("No member property descriptions found.");const de=f(c.__makeDebugFlags(x.debugFlags)),ge=function Qe(je){this instanceof Qe?arguments.length?((je!==(je|0)||je<=0)&&a("Invalid pointer value for",C,"constructor."),q(Qe,this,je)):q(Qe,this):a("The",C,"constructor may only be called via 'new'.")};return Object.defineProperties(ge,{debugFlags:de,isA:f(Qe=>Qe instanceof ge),memberKey:ie,memberKeys:ue,methodInfoForKey:f(function(Qe){}),structInfo:f(R),structName:f(C)}),ge.prototype=new Z(C,R,f),Object.defineProperties(ge.prototype,{debugFlags:de,constructor:f(ge)}),Object.keys(R.members).forEach(Qe=>O(ge,Qe,R.members[Qe])),ge};return D.StructType=Z,D.config=l,D.allocCString=he,D.debugFlags||(D.debugFlags=c.__makeDebugFlags(c.debugFlags)),D},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...T)=>{throw new Error(T.join(" "))};i.SQLite3Error.toss;const a=i.capi,c=i.wasm,d=i.util;if(globalThis.WhWasmUtilInstaller(c),delete globalThis.WhWasmUtilInstaller,c.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new c.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:T=>{let g;return(y,v,S,b)=>{try{const Q=c.cArgvToJs(v,S);return g||(g=c.cArgvToJs(v,b)),T(Q,g)|0}catch(Q){return Q.resultCode||a.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(T,g)=>T[0],callProxy:T=>(g,y,v,S,b,Q)=>{try{return v=v&&c.cstrToJs(v),S=S&&c.cstrToJs(S),b=b&&c.cstrToJs(b),Q=Q&&c.cstrToJs(Q),T(g,y,v,S,b,Q)||0}catch(V){return V.resultCode||a.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new c.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(T,g)=>T[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],c.exports.sqlite3_activate_see instanceof Function&&c.bindingSignatures.push(["sqlite3_key","int","sqlite3*","string","int"],["sqlite3_key_v2","int","sqlite3*","string","*","int"],["sqlite3_rekey","int","sqlite3*","string","int"],["sqlite3_rekey_v2","int","sqlite3*","string","*","int"],["sqlite3_activate_see",void 0,"string"]),c.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:T=>T[0],callProxy:T=>(g,y,v,S,b,Q,V)=>{T(g,y,v,c.cstrToJs(S),c.cstrToJs(b),Q,V)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:T=>T[0],callProxy:T=>(g,y,v,S,b)=>{T(g,y,c.cstrToJs(v),c.cstrToJs(S),b)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],c.bigIntEnabled&&c.exports.sqlite3changegroup_add){const T={signature:"i(ps)",callProxy:g=>(y,v)=>{try{return g(y,c.cstrToJs(v))|0}catch(S){return S.resultCode||a.SQLITE_ERROR}}};c.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xFilter",...T,contextKey:(g,y)=>g[0]}),"*"]])}c.bindingSignatures.wasm=[["sqlite3_wasm_db_reset","int","sqlite3*"],["sqlite3_wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3_wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3_wasm_posix_create_file","int","string","*","int"],["sqlite3_wasm_vfs_unlink","int","sqlite3_vfs*","string"]],i.StructBinder=globalThis.Jaccwabyt({heap:c.heap8u,alloc:c.alloc,dealloc:c.dealloc,bigIntEnabled:c.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const T=c.xWrap.argAdapter("string");c.xWrap.argAdapter("string:flexible",b=>T(d.flexibleString(b))),c.xWrap.argAdapter("string:static",function(b){return c.isPtr(b)?b:(b=""+b,this[b]||(this[b]=c.allocCString(b)))}.bind(Object.create(null)));const g=c.xWrap.argAdapter("*"),y=function(){};c.xWrap.argAdapter("sqlite3_filename",g)("sqlite3_context*",g)("sqlite3_value*",g)("void*",g)("sqlite3_changegroup*",g)("sqlite3_changeset_iter*",g)("sqlite3_session*",g)("sqlite3_stmt*",b=>g(b instanceof(i?.oo1?.Stmt||y)?b.pointer:b))("sqlite3*",b=>g(b instanceof(i?.oo1?.DB||y)?b.pointer:b))("sqlite3_index_info*",b=>g(b instanceof(a.sqlite3_index_info||y)?b.pointer:b))("sqlite3_module*",b=>g(b instanceof(a.sqlite3_module||y)?b.pointer:b))("sqlite3_vfs*",b=>typeof b=="string"?a.sqlite3_vfs_find(b)||i.SQLite3Error.toss(a.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",b):g(b instanceof(a.sqlite3_vfs||y)?b.pointer:b));const v=c.xWrap.resultAdapter("*");c.xWrap.resultAdapter("sqlite3*",v)("sqlite3_context*",v)("sqlite3_stmt*",v)("sqlite3_value*",v)("sqlite3_vfs*",v)("void*",v),c.exports.sqlite3_step.length===0&&(c.xWrap.doArgcCheck=!1,i.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const b of c.bindingSignatures)a[b[0]]=c.xWrap.apply(null,b);for(const b of c.bindingSignatures.wasm)c[b[0]]=c.xWrap.apply(null,b);const S=function(b){return()=>l(b+"() is unavailable due to lack","of BigInt support in this build.")};for(const b of c.bindingSignatures.int64)a[b[0]]=c.bigIntEnabled?c.xWrap.apply(null,b):S(b[0]);if(delete c.bindingSignatures,c.exports.sqlite3_wasm_db_error){const b=c.xWrap("sqlite3_wasm_db_error","int","sqlite3*","int","string");d.sqlite3_wasm_db_error=function(Q,V,L){return V instanceof i.WasmAllocError?(V=a.SQLITE_NOMEM,L=0):V instanceof Error&&(L=L||""+V,V=V.resultCode||a.SQLITE_ERROR),Q?b(Q,V,L):V}}else d.sqlite3_wasm_db_error=function(b,Q,V){return console.warn("sqlite3_wasm_db_error() is not exported.",arguments),Q}}{const T=c.xCall("sqlite3_wasm_enum_json");T||l("Maintenance required: increase sqlite3_wasm_enum_json()'s","static buffer size!"),c.ctype=JSON.parse(c.cstrToJs(T));const g=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];c.bigIntEnabled&&g.push("serialize","session","vtab");for(const S of g)for(const b of Object.entries(c.ctype[S]))a[b[0]]=b[1];c.functionEntry(a.SQLITE_WASM_DEALLOC)||l("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+a.SQLITE_WASM_DEALLOC+").");const y=Object.create(null);for(const S of["resultCodes"])for(const b of Object.entries(c.ctype[S]))y[b[1]]=b[0];a.sqlite3_js_rc_str=S=>y[S];const v=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!d.isUIThread(),sqlite3_index_info:!c.bigIntEnabled,sqlite3_index_constraint:!c.bigIntEnabled,sqlite3_index_orderby:!c.bigIntEnabled,sqlite3_index_constraint_usage:!c.bigIntEnabled});for(const S of c.ctype.structs)v[S.name]||(a[S.name]=i.StructBinder(S));if(a.sqlite3_index_info){for(const S of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])a.sqlite3_index_info[S]=a[S],delete a[S];a.sqlite3_vtab_config=c.xWrap("sqlite3_wasm_vtab_config","int",["sqlite3*","int","int"])}}const w=(T,g,y)=>d.sqlite3_wasm_db_error(T,a.SQLITE_MISUSE,g+"() requires "+y+" argument"+(y===1?"":"s")+"."),I=T=>d.sqlite3_wasm_db_error(T,a.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),W=T=>c.xWrap.argAdapter("sqlite3*")(T),J=T=>c.isPtr(T)?c.cstrToJs(T):T,ee=function(T,g){T=W(T);let y=this.dbMap.get(T);if(g)!y&&g>0&&this.dbMap.set(T,y=Object.create(null));else return this.dbMap.delete(T),y;return y}.bind(Object.assign(Object.create(null),{dbMap:new Map}));ee.addCollation=function(T,g){const y=ee(T,1);y.collation||(y.collation=new Set),y.collation.add(J(g).toLowerCase())},ee._addUDF=function(T,g,y,v){g=J(g).toLowerCase();let S=v.get(g);S||v.set(g,S=new Set),S.add(y<0?-1:y)},ee.addFunction=function(T,g,y){const v=ee(T,1);v.udf||(v.udf=new Map),this._addUDF(T,g,y,v.udf)},ee.addWindowFunc=function(T,g,y){const v=ee(T,1);v.wudf||(v.wudf=new Map),this._addUDF(T,g,y,v.wudf)},ee.cleanup=function(T){T=W(T);const g=[T];for(const S of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const b=c.exports[S];g.length=b.length;try{a[S](...g)}catch(Q){console.warn("close-time call of",S+"(",g,") threw:",Q)}}const y=ee(T,0);if(!y)return;if(y.collation){for(const S of y.collation)try{a.sqlite3_create_collation_v2(T,S,a.SQLITE_UTF8,0,0,0)}catch{}delete y.collation}let v;for(v=0;v<2;++v){const S=v?y.wudf:y.udf;if(!S)continue;const b=v?a.sqlite3_create_window_function:a.sqlite3_create_function_v2;for(const Q of S){const V=Q[0],L=Q[1],K=[T,V,0,a.SQLITE_UTF8,0,0,0,0,0];v&&K.push(0);for(const le of L)try{K[2]=le,b.apply(null,K)}catch{}L.clear()}S.clear()}delete y.udf,delete y.wudf};{const T=c.xWrap("sqlite3_close_v2","int","sqlite3*");a.sqlite3_close_v2=function(g){if(arguments.length!==1)return w(g,"sqlite3_close_v2",1);if(g)try{ee.cleanup(g)}catch{}return T(g)}}if(a.sqlite3session_table_filter){const T=c.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);a.sqlite3session_delete=function(g){if(arguments.length!==1)return w(pDb,"sqlite3session_delete",1);g&&a.sqlite3session_table_filter(g,0,0),T(g)}}{const T=(y,v)=>"argv["+v+"]:"+y[0]+":"+c.cstrToJs(y[1]).toLowerCase(),g=c.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new c.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:T}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:T})]);a.sqlite3_create_collation_v2=function(y,v,S,b,Q,V){if(arguments.length!==6)return w(y,"sqlite3_create_collation_v2",6);if(!(S&15))S|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(S&15))return I(y);try{const L=g(y,v,S,b,Q,V);return L===0&&Q instanceof Function&&ee.addCollation(y,v),L}catch(L){return d.sqlite3_wasm_db_error(y,L)}},a.sqlite3_create_collation=(y,v,S,b,Q)=>arguments.length===5?a.sqlite3_create_collation_v2(y,v,S,b,Q,0):w(y,"sqlite3_create_collation",5)}{const T=function(S,b){return S[0]+":"+(S[2]<0?-1:S[2])+":"+b+":"+c.cstrToJs(S[1]).toLowerCase()},g=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:T,callProxy:S=>(b,Q,V)=>{try{S(b,...a.sqlite3_values_to_js(Q,V))}catch(L){a.sqlite3_result_error_js(b,L)}}},xFinalAndValue:{signature:"v(p)",contextKey:T,callProxy:S=>b=>{try{a.sqlite3_result_js(b,S(b))}catch(Q){a.sqlite3_result_error_js(b,Q)}}},xFunc:{signature:"v(pip)",contextKey:T,callProxy:S=>(b,Q,V)=>{try{a.sqlite3_result_js(b,S(b,...a.sqlite3_values_to_js(Q,V)))}catch(L){a.sqlite3_result_error_js(b,L)}}},xDestroy:{signature:"v(p)",contextKey:T,callProxy:S=>b=>{try{S(b)}catch(Q){console.error("UDF xDestroy method threw:",Q)}}}}),y=c.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xFunc",...g.xFunc}),new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]),v=c.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xValue",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xInverse",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]);a.sqlite3_create_function_v2=function S(b,Q,V,L,K,le,_,E,k){if(S.length!==arguments.length)return w(b,"sqlite3_create_function_v2",S.length);if(!(L&15))L|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(L&15))return I(b);try{const z=y(b,Q,V,L,K,le,_,E,k);return z===0&&(le instanceof Function||_ instanceof Function||E instanceof Function||k instanceof Function)&&ee.addFunction(b,Q,V),z}catch(z){return console.error("sqlite3_create_function_v2() setup threw:",z),d.sqlite3_wasm_db_error(b,z,"Creation of UDF threw: "+z)}},a.sqlite3_create_function=function S(b,Q,V,L,K,le,_,E){return S.length===arguments.length?a.sqlite3_create_function_v2(b,Q,V,L,K,le,_,E,0):w(b,"sqlite3_create_function",S.length)},a.sqlite3_create_window_function=function S(b,Q,V,L,K,le,_,E,k,z){if(S.length!==arguments.length)return w(b,"sqlite3_create_window_function",S.length);if(!(L&15))L|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(L&15))return I(b);try{const m=v(b,Q,V,L,K,le,_,E,k,z);return m===0&&(le instanceof Function||_ instanceof Function||E instanceof Function||k instanceof Function||z instanceof Function)&&ee.addWindowFunc(b,Q,V),m}catch(m){return console.error("sqlite3_create_window_function() setup threw:",m),d.sqlite3_wasm_db_error(b,m,"Creation of UDF threw: "+m)}},a.sqlite3_create_function_v2.udfSetResult=a.sqlite3_create_function.udfSetResult=a.sqlite3_create_window_function.udfSetResult=a.sqlite3_result_js,a.sqlite3_create_function_v2.udfConvertArgs=a.sqlite3_create_function.udfConvertArgs=a.sqlite3_create_window_function.udfConvertArgs=a.sqlite3_values_to_js,a.sqlite3_create_function_v2.udfSetError=a.sqlite3_create_function.udfSetError=a.sqlite3_create_window_function.udfSetError=a.sqlite3_result_error_js}{const T=(y,v)=>(typeof y=="string"?v=-1:d.isSQLableTypedArray(y)?(v=y.byteLength,y=d.typedArrayToString(y instanceof ArrayBuffer?new Uint8Array(y):y)):Array.isArray(y)&&(y=y.join(""),v=-1),[y,v]),g={basic:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};a.sqlite3_prepare_v3=function y(v,S,b,Q,V,L){if(y.length!==arguments.length)return w(v,"sqlite3_prepare_v3",y.length);const[K,le]=T(S,b);switch(typeof K){case"string":return g.basic(v,K,le,Q,V,null);case"number":return g.full(v,K,le,Q,V,L);default:return d.sqlite3_wasm_db_error(v,a.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},a.sqlite3_prepare_v2=function y(v,S,b,Q,V){return y.length===arguments.length?a.sqlite3_prepare_v3(v,S,b,0,Q,V):w(v,"sqlite3_prepare_v2",y.length)}}{const T=c.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),g=c.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);a.sqlite3_bind_text=function y(v,S,b,Q,V){if(y.length!==arguments.length)return w(a.sqlite3_db_handle(v),"sqlite3_bind_text",y.length);if(c.isPtr(b)||b===null)return T(v,S,b,Q,V);b instanceof ArrayBuffer?b=new Uint8Array(b):Array.isArray(pMem)&&(b=pMem.join(""));let L,K;try{if(d.isSQLableTypedArray(b))L=c.allocFromTypedArray(b),K=b.byteLength;else if(typeof b=="string")[L,K]=c.allocCString(b);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return T(v,S,L,K,a.SQLITE_WASM_DEALLOC)}catch(le){return c.dealloc(L),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),le)}},a.sqlite3_bind_blob=function y(v,S,b,Q,V){if(y.length!==arguments.length)return w(a.sqlite3_db_handle(v),"sqlite3_bind_blob",y.length);if(c.isPtr(b)||b===null)return g(v,S,b,Q,V);b instanceof ArrayBuffer?b=new Uint8Array(b):Array.isArray(b)&&(b=b.join(""));let L,K;try{if(d.isBindableTypedArray(b))L=c.allocFromTypedArray(b),K=Q>=0?Q:b.byteLength;else if(typeof b=="string")[L,K]=c.allocCString(b);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return g(v,S,L,K,a.SQLITE_WASM_DEALLOC)}catch(le){return c.dealloc(L),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),le)}}}a.sqlite3_config=function(T,...g){if(arguments.length<2)return a.SQLITE_MISUSE;switch(T){case a.SQLITE_CONFIG_COVERING_INDEX_SCAN:case a.SQLITE_CONFIG_MEMSTATUS:case a.SQLITE_CONFIG_SMALL_MALLOC:case a.SQLITE_CONFIG_SORTERREF_SIZE:case a.SQLITE_CONFIG_STMTJRNL_SPILL:case a.SQLITE_CONFIG_URI:return c.exports.sqlite3_wasm_config_i(T,g[0]);case a.SQLITE_CONFIG_LOOKASIDE:return c.exports.sqlite3_wasm_config_ii(T,g[0],g[1]);case a.SQLITE_CONFIG_MEMDB_MAXSIZE:return c.exports.sqlite3_wasm_config_j(T,g[0]);case a.SQLITE_CONFIG_GETMALLOC:case a.SQLITE_CONFIG_GETMUTEX:case a.SQLITE_CONFIG_GETPCACHE2:case a.SQLITE_CONFIG_GETPCACHE:case a.SQLITE_CONFIG_HEAP:case a.SQLITE_CONFIG_LOG:case a.SQLITE_CONFIG_MALLOC:case a.SQLITE_CONFIG_MMAP_SIZE:case a.SQLITE_CONFIG_MULTITHREAD:case a.SQLITE_CONFIG_MUTEX:case a.SQLITE_CONFIG_PAGECACHE:case a.SQLITE_CONFIG_PCACHE2:case a.SQLITE_CONFIG_PCACHE:case a.SQLITE_CONFIG_PCACHE_HDRSZ:case a.SQLITE_CONFIG_PMASZ:case a.SQLITE_CONFIG_SERIALIZED:case a.SQLITE_CONFIG_SINGLETHREAD:case a.SQLITE_CONFIG_SQLLOG:case a.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return a.SQLITE_NOTFOUND}};{const T=new Set;a.sqlite3_auto_extension=function(g){if(g instanceof Function)g=c.installFunction("i(ppp)",g);else if(arguments.length!==1||!c.isPtr(g))return a.SQLITE_MISUSE;const y=c.exports.sqlite3_auto_extension(g);return g!==arguments[0]&&(y===0?T.add(g):c.uninstallFunction(g)),y},a.sqlite3_cancel_auto_extension=function(g){return!g||arguments.length!==1||!c.isPtr(g)?0:c.exports.sqlite3_cancel_auto_extension(g)},a.sqlite3_reset_auto_extension=function(){c.exports.sqlite3_reset_auto_extension();for(const g of T)c.uninstallFunction(g);T.clear()}}const se=a.sqlite3_vfs_find("kvvfs");if(se)if(d.isUIThread()){const T=new a.sqlite3_kvvfs_methods(c.exports.sqlite3_wasm_kvvfs_methods());delete a.sqlite3_kvvfs_methods;const g=c.exports.sqlite3_wasm_kvvfsMakeKeyOnPstack,y=c.pstack,v=b=>c.peek(b)===115?sessionStorage:localStorage,S={xRead:(b,Q,V,L)=>{const K=y.pointer,le=c.scopedAllocPush();try{const _=g(b,Q);if(!_)return-3;const E=c.cstrToJs(_),k=v(b).getItem(E);if(!k)return-1;const z=k.length;if(L<=0)return z;if(L===1)return c.poke(V,0),z;const m=c.scopedAllocCString(k);return L>z+1&&(L=z+1),c.heap8u().copyWithin(V,m,m+L-1),c.poke(V+L-1,0),L-1}catch(_){return console.error("kvstorageRead()",_),-2}finally{y.restore(K),c.scopedAllocPop(le)}},xWrite:(b,Q,V)=>{const L=y.pointer;try{const K=g(b,Q);if(!K)return 1;const le=c.cstrToJs(K);return v(b).setItem(le,c.cstrToJs(V)),0}catch(K){return console.error("kvstorageWrite()",K),a.SQLITE_IOERR}finally{y.restore(L)}},xDelete:(b,Q)=>{const V=y.pointer;try{const L=g(b,Q);return L?(v(b).removeItem(c.cstrToJs(L)),0):1}catch(L){return console.error("kvstorageDelete()",L),a.SQLITE_IOERR}finally{y.restore(V)}}};for(const b of Object.keys(S))T[T.memberKey(b)]=c.installFunction(T.memberSignature(b),S[b])}else a.sqlite3_vfs_unregister(se);c.xWrap.FuncPtrAdapter.warnOnUse=!0}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.43.2",libVersionNumber:3043002,sourceId:"2023-10-10 12:14:04 4310099cce5a487035fa535dd3002c59ac7f1d1bec68d7cf317fd3e769484790",downloadVersion:3430200}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...m)=>{throw new i.SQLite3Error(...m)},a=i.capi,c=i.wasm,d=i.util,w=new WeakMap,I=new WeakMap,W=(m,N,h)=>{const f=Object.getOwnPropertyDescriptor(m,N);return f?f.value:h},J=function(m,N){return N&&(m instanceof g&&(m=m.pointer),l(N,"sqlite3 result code",N+":",m?a.sqlite3_errmsg(m):a.sqlite3_errstr(N))),arguments[0]},ee=c.installFunction("i(ippp)",function(m,N,h,f){a.SQLITE_TRACE_STMT===m&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+N+":",c.cstrToJs(f))}.bind({counter:0})),se=Object.create(null),T=function m(...N){if(!m._name2vfs){m._name2vfs=Object.create(null);const ue=typeof importScripts=="function"?be=>l("The VFS for",be,"is only available in the main window thread."):!1;m._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:ue||(()=>"local")},m._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:ue||(()=>"session")}}const h=m.normalizeArgs(...N);let f=h.filename,q=h.vfs,F=h.flags;(typeof f!="string"&&typeof f!="number"||typeof F!="string"||q&&typeof q!="string"&&typeof q!="number")&&(i.config.error("Invalid DB ctor args",h,arguments),l("Invalid arguments for DB constructor."));let X=typeof f=="number"?c.cstrToJs(f):f;const ie=m._name2vfs[X];ie&&(q=ie.vfs,f=X=ie.filename(X));let oe,ce=0;F.indexOf("c")>=0&&(ce|=a.SQLITE_OPEN_CREATE|a.SQLITE_OPEN_READWRITE),F.indexOf("w")>=0&&(ce|=a.SQLITE_OPEN_READWRITE),ce===0&&(ce|=a.SQLITE_OPEN_READONLY),ce|=a.SQLITE_OPEN_EXRESCODE;const ae=c.pstack.pointer;try{const ue=c.pstack.allocPtr();let be=a.sqlite3_open_v2(f,ue,ce,q||0);oe=c.peekPtr(ue),J(oe,be),a.sqlite3_extended_result_codes(oe,1),F.indexOf("t")>=0&&a.sqlite3_trace_v2(oe,a.SQLITE_TRACE_STMT,ee,oe)}catch(ue){throw oe&&a.sqlite3_close_v2(oe),ue}finally{c.pstack.restore(ae)}this.filename=X,w.set(this,oe),I.set(this,Object.create(null));try{const ue=a.sqlite3_js_db_vfs(oe);ue||l("Internal error: cannot get VFS for new db handle.");const be=se[ue];be instanceof Function?be(this,i):be&&J(oe,a.sqlite3_exec(oe,be,0,0,0))}catch(ue){throw this.close(),ue}};T.setVfsPostOpenSql=function(m,N){se[m]=N},T.normalizeArgs=function(m=":memory:",N="c",h=null){const f={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(f,arguments[0]),f.flags===void 0&&(f.flags="c"),f.vfs===void 0&&(f.vfs=null),f.filename===void 0&&(f.filename=":memory:")):(f.filename=m,f.flags=N,f.vfs=h),f};const g=function(...m){T.apply(this,m)};g.dbCtorHelper=T;const y={null:1,number:2,string:3,boolean:4,blob:5};y.undefined==y.null,c.bigIntEnabled&&(y.bigint=y.number);const v=function(){y!==arguments[2]&&l(a.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],w.set(this,arguments[1]),this.parameterCount=a.sqlite3_bind_parameter_count(this.pointer)},S=function(m){return m.pointer||l("DB has been closed."),m},b=function(m,N){return(N!==(N|0)||N<0||N>=m.columnCount)&&l("Column index",N,"is out of range."),m},Q=function(m,N){const h=Object.create(null);switch(h.opt=Object.create(null),N.length){case 1:typeof N[0]=="string"||d.isSQLableTypedArray(N[0])||Array.isArray(N[0])?h.sql=N[0]:N[0]&&typeof N[0]=="object"&&(h.opt=N[0],h.sql=h.opt.sql);break;case 2:h.sql=N[0],h.opt=N[1];break;default:l("Invalid argument count for exec().")}h.sql=d.flexibleString(h.sql),typeof h.sql!="string"&&l("Missing SQL argument or unsupported SQL value type.");const f=h.opt;switch(f.returnValue){case"resultRows":f.resultRows||(f.resultRows=[]),h.returnVal=()=>f.resultRows;break;case"saveSql":f.saveSql||(f.saveSql=[]),h.returnVal=()=>f.saveSql;break;case void 0:case"this":h.returnVal=()=>m;break;default:l("Invalid returnValue value:",f.returnValue)}if(!f.callback&&!f.returnValue&&f.rowMode!==void 0&&(f.resultRows||(f.resultRows=[]),h.returnVal=()=>f.resultRows),f.callback||f.resultRows)switch(f.rowMode===void 0?"array":f.rowMode){case"object":h.cbArg=q=>q.get(Object.create(null));break;case"array":h.cbArg=q=>q.get([]);break;case"stmt":Array.isArray(f.resultRows)&&l("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),h.cbArg=q=>q;break;default:if(d.isInt32(f.rowMode)){h.cbArg=q=>q.get(f.rowMode);break}else if(typeof f.rowMode=="string"&&f.rowMode.length>1&&f.rowMode[0]==="$"){const q=f.rowMode.substr(1);h.cbArg=F=>{const X=F.get(Object.create(null))[q];return X===void 0?l(a.SQLITE_NOTFOUND,"exec(): unknown result column:",q):X};break}l("Invalid rowMode:",f.rowMode)}return h},V=(m,N,h,...f)=>{const q=m.prepare(N);try{const F=q.bind(h).step()?q.get(...f):void 0;return q.reset(),F}finally{q.finalize()}},L=(m,N,h,f)=>m.exec({sql:N,bind:h,rowMode:f,returnValue:"resultRows"});g.checkRc=(m,N)=>J(m,N),g.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return S(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const m=this.pointer;if(Object.keys(I.get(this)).forEach((N,h)=>{if(h&&h.pointer)try{h.finalize()}catch{}}),w.delete(this),I.delete(this),a.sqlite3_close_v2(m),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(m=!1,N=!1){const h=S(this).pointer;return m?N?a.sqlite3_total_changes64(h):a.sqlite3_total_changes(h):N?a.sqlite3_changes64(h):a.sqlite3_changes(h)},dbFilename:function(m="main"){return a.sqlite3_db_filename(S(this).pointer,m)},dbName:function(m=0){return a.sqlite3_db_name(S(this).pointer,m)},dbVfsName:function(m=0){let N;const h=a.sqlite3_js_db_vfs(S(this).pointer,m);if(h){const f=new a.sqlite3_vfs(h);try{N=c.cstrToJs(f.$zName)}finally{f.dispose()}}return N},prepare:function(m){S(this);const N=c.pstack.pointer;let h,f;try{h=c.pstack.alloc(8),g.checkRc(this,a.sqlite3_prepare_v2(this.pointer,m,-1,h,null)),f=c.peekPtr(h)}finally{c.pstack.restore(N)}f||l("Cannot prepare empty SQL.");const q=new v(this,f,y);return I.get(this)[f]=q,q},exec:function(){S(this);const m=Q(this,arguments);if(!m.sql)return l("exec() requires an SQL string.");const N=m.opt,h=N.callback,f=Array.isArray(N.resultRows)?N.resultRows:void 0;let q,F=N.bind,X=!!(m.cbArg||N.columnNames||f);const ie=c.scopedAllocPush(),oe=Array.isArray(N.saveSql)?N.saveSql:void 0;try{const ce=d.isSQLableTypedArray(m.sql);let ae=ce?m.sql.byteLength:c.jstrlen(m.sql);const ue=c.scopedAlloc(2*c.ptrSizeof+(ae+1)),be=ue+c.ptrSizeof;let qe=be+c.ptrSizeof;const st=qe+ae;for(ce?c.heap8().set(m.sql,qe):c.jstrcpy(m.sql,c.heap8(),qe,ae,!1),c.poke(qe+ae,0);qe&&c.peek(qe,"i8");){c.pokePtr([ue,be],0),g.checkRc(this,a.sqlite3_prepare_v3(this.pointer,qe,ae,0,ue,be));const P=c.peekPtr(ue);if(qe=c.peekPtr(be),ae=st-qe,!!P){if(oe&&oe.push(a.sqlite3_sql(P).trim()),q=new v(this,P,y),F&&q.parameterCount&&(q.bind(F),F=null),X&&q.columnCount){let B=Array.isArray(N.columnNames)?0:1;if(X=!1,m.cbArg||f){for(;q.step();q._lockedByExec=!1){B++===0&&q.getColumnNames(N.columnNames),q._lockedByExec=!0;const j=m.cbArg(q);if(f&&f.push(j),h&&h.call(N,j,q)===!1)break}q._lockedByExec=!1}B===0&&q.getColumnNames(N.columnNames)}else q.step();q.reset().finalize(),q=null}}}finally{c.scopedAllocPop(ie),q&&(delete q._lockedByExec,q.finalize())}return m.returnVal()},createFunction:function(N,h,f){const q=j=>j instanceof Function;switch(arguments.length){case 1:f=N,N=f.name,h=f.xFunc||0;break;case 2:q(h)||(f=h,h=f.xFunc||0);break}f||(f={}),typeof N!="string"&&l("Invalid arguments: missing function name.");let F=f.xStep||0,X=f.xFinal||0;const ie=f.xValue||0,oe=f.xInverse||0;let ce;q(h)?(ce=!1,(q(F)||q(X))&&l("Ambiguous arguments: scalar or aggregate?"),F=X=null):q(F)?(q(X)||l("Missing xFinal() callback for aggregate or window UDF."),h=null):q(X)?l("Missing xStep() callback for aggregate or window UDF."):l("Missing function-type properties."),ce===!1?(q(ie)||q(oe))&&l("xValue and xInverse are not permitted for non-window UDFs."):q(ie)?(q(oe)||l("xInverse must be provided if xValue is."),ce=!0):q(oe)&&l("xValue must be provided if xInverse is.");const ae=f.pApp;ae!=null&&(typeof ae!="number"||!d.isInt32(ae))&&l("Invalid value for pApp property. Must be a legal WASM pointer value.");const ue=f.xDestroy||0;ue&&!q(ue)&&l("xDestroy property must be a function.");let be=0;W(f,"deterministic")&&(be|=a.SQLITE_DETERMINISTIC),W(f,"directOnly")&&(be|=a.SQLITE_DIRECTONLY),W(f,"innocuous")&&(be|=a.SQLITE_INNOCUOUS),N=N.toLowerCase();const qe=h||F,st=W(f,"arity"),P=typeof st=="number"?st:qe.length?qe.length-1:0;let B;return ce?B=a.sqlite3_create_window_function(this.pointer,N,P,a.SQLITE_UTF8|be,ae||0,F,X,ie,oe,ue):B=a.sqlite3_create_function_v2(this.pointer,N,P,a.SQLITE_UTF8|be,ae||0,h,F,X,ue),g.checkRc(this,B),this},selectValue:function(m,N,h){return V(this,m,N,0,h)},selectValues:function(m,N,h){const f=this.prepare(m),q=[];try{for(f.bind(N);f.step();)q.push(f.get(0,h));f.reset()}finally{f.finalize()}return q},selectArray:function(m,N){return V(this,m,N,[])},selectObject:function(m,N){return V(this,m,N,{})},selectArrays:function(m,N){return L(this,m,N,"array")},selectObjects:function(m,N){return L(this,m,N,"object")},openStatementCount:function(){return this.pointer?Object.keys(I.get(this)).length:0},transaction:function(m){let N="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&l(a.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),N+=" "+arguments[0],m=arguments[1]),S(this).exec(N);try{const h=m(this);return this.exec("COMMIT"),h}catch(h){throw this.exec("ROLLBACK"),h}},savepoint:function(m){S(this).exec("SAVEPOINT oo1");try{const N=m(this);return this.exec("RELEASE oo1"),N}catch(N){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),N}},checkRc:function(m){return J(this,m)}};const K=function(m){return m.pointer||l("Stmt has been closed."),m},le=function(m){let N=y[m==null?"null":typeof m];switch(N){case y.boolean:case y.null:case y.number:case y.string:return N;case y.bigint:if(c.bigIntEnabled)return N;default:return d.isBindableTypedArray(m)?y.blob:void 0}},_=function(m){return le(m)||l("Unsupported bind() argument type:",typeof m)},E=function(m,N){const h=typeof N=="number"?N:a.sqlite3_bind_parameter_index(m.pointer,N);return h===0||!d.isInt32(h)?l("Invalid bind() parameter name: "+N):(h<1||h>m.parameterCount)&&l("Bind index",N,"is out of range."),h},k=function(m,N){return m._lockedByExec&&l("Operation is illegal when statement is locked:",N),m},z=function m(N,h,f,q){k(K(N),"bind()"),m._||(m._tooBigInt=X=>l("BigInt value is too big to store without precision loss:",X),m._={string:function(X,ie,oe,ce){const[ae,ue]=c.allocCString(oe,!0);return(ce?a.sqlite3_bind_blob:a.sqlite3_bind_text)(X.pointer,ie,ae,ue,a.SQLITE_WASM_DEALLOC)}}),_(q),h=E(N,h);let F=0;switch(q==null?y.null:f){case y.null:F=a.sqlite3_bind_null(N.pointer,h);break;case y.string:F=m._.string(N,h,q,!1);break;case y.number:{let X;d.isInt32(q)?X=a.sqlite3_bind_int:typeof q=="bigint"?d.bigIntFits64(q)?c.bigIntEnabled?X=a.sqlite3_bind_int64:d.bigIntFitsDouble(q)?(q=Number(q),X=a.sqlite3_bind_double):m._tooBigInt(q):m._tooBigInt(q):(q=Number(q),c.bigIntEnabled&&Number.isInteger(q)?X=a.sqlite3_bind_int64:X=a.sqlite3_bind_double),F=X(N.pointer,h,q);break}case y.boolean:F=a.sqlite3_bind_int(N.pointer,h,q?1:0);break;case y.blob:{if(typeof q=="string"){F=m._.string(N,h,q,!0);break}else q instanceof ArrayBuffer?q=new Uint8Array(q):d.isBindableTypedArray(q)||l("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const X=c.alloc(q.byteLength||1);c.heap8().set(q.byteLength?q:[0],X),F=a.sqlite3_bind_blob(N.pointer,h,X,q.byteLength,a.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",q),l("Unsupported bind() argument type: "+typeof q)}return F&&g.checkRc(N.db.pointer,F),N._mayGet=!1,N};v.prototype={finalize:function(){if(this.pointer){k(this,"finalize()");const m=a.sqlite3_finalize(this.pointer);return delete I.get(this.db)[this.pointer],w.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,m}},clearBindings:function(){return k(K(this),"clearBindings()"),a.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(m){k(this,"reset()"),m&&this.clearBindings();const N=a.sqlite3_reset(K(this).pointer);return this._mayGet=!1,J(this.db,N),this},bind:function(){K(this);let m,N;switch(arguments.length){case 1:m=1,N=arguments[0];break;case 2:m=arguments[0],N=arguments[1];break;default:l("Invalid bind() arguments.")}return N===void 0?this:(this.parameterCount||l("This statement has no bindable parameters."),this._mayGet=!1,N===null?z(this,m,y.null,N):Array.isArray(N)?(arguments.length!==1&&l("When binding an array, an index argument is not permitted."),N.forEach((h,f)=>z(this,f+1,_(h),h)),this):(N instanceof ArrayBuffer&&(N=new Uint8Array(N)),typeof N=="object"&&!d.isBindableTypedArray(N)?(arguments.length!==1&&l("When binding an object, an index argument is not permitted."),Object.keys(N).forEach(h=>z(this,h,_(N[h]),N[h])),this):z(this,m,_(N),N)))},bindAsBlob:function(m,N){K(this),arguments.length===1&&(N=m,m=1);const h=_(N);return y.string!==h&&y.blob!==h&&y.null!==h&&l("Invalid value type for bindAsBlob()"),z(this,m,y.blob,N)},step:function(){k(this,"step()");const m=a.sqlite3_step(K(this).pointer);switch(m){case a.SQLITE_DONE:return this._mayGet=!1;case a.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,i.config.warn("sqlite3_step() rc=",m,a.sqlite3_js_rc_str(m),"SQL =",a.sqlite3_sql(this.pointer)),g.checkRc(this.db.pointer,m)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const m=this.step();return this.reset(),m}finally{try{this.finalize()}catch{}}},get:function(m,N){if(K(this)._mayGet||l("Stmt.step() has not (recently) returned true."),Array.isArray(m)){let h=0;const f=this.columnCount;for(;h<f;)m[h]=this.get(h++);return m}else if(m&&typeof m=="object"){let h=0;const f=this.columnCount;for(;h<f;)m[a.sqlite3_column_name(this.pointer,h)]=this.get(h++);return m}switch(b(this,m),N===void 0?a.sqlite3_column_type(this.pointer,m):N){case a.SQLITE_NULL:return null;case a.SQLITE_INTEGER:if(c.bigIntEnabled){const h=a.sqlite3_column_int64(this.pointer,m);return h>=Number.MIN_SAFE_INTEGER&&h<=Number.MAX_SAFE_INTEGER?Number(h).valueOf():h}else{const h=a.sqlite3_column_double(this.pointer,m);return(h>Number.MAX_SAFE_INTEGER||h<Number.MIN_SAFE_INTEGER)&&l("Integer is out of range for JS integer range: "+h),d.isInt32(h)?h|0:h}case a.SQLITE_FLOAT:return a.sqlite3_column_double(this.pointer,m);case a.SQLITE_TEXT:return a.sqlite3_column_text(this.pointer,m);case a.SQLITE_BLOB:{const h=a.sqlite3_column_bytes(this.pointer,m),f=a.sqlite3_column_blob(this.pointer,m),q=new Uint8Array(h);return h&&q.set(c.heap8u().slice(f,f+h),0),h&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(q.buffer),q}default:l("Don't know how to translate","type of result column #"+m+".")}l("Not reached.")},getInt:function(m){return this.get(m,a.SQLITE_INTEGER)},getFloat:function(m){return this.get(m,a.SQLITE_FLOAT)},getString:function(m){return this.get(m,a.SQLITE_TEXT)},getBlob:function(m){return this.get(m,a.SQLITE_BLOB)},getJSON:function(m){const N=this.get(m,a.SQLITE_STRING);return N===null?N:JSON.parse(N)},getColumnName:function(m){return a.sqlite3_column_name(b(K(this),m).pointer,m)},getColumnNames:function(m=[]){b(K(this),0);const N=this.columnCount;for(let h=0;h<N;++h)m.push(a.sqlite3_column_name(this.pointer,h));return m},getParamIndex:function(m){return K(this).parameterCount?a.sqlite3_bind_parameter_index(this.pointer,m):void 0}};{const m={enumerable:!0,get:function(){return w.get(this)},set:()=>l("The pointer property is read-only.")};Object.defineProperty(v.prototype,"pointer",m),Object.defineProperty(g.prototype,"pointer",m)}if(Object.defineProperty(v.prototype,"columnCount",{enumerable:!1,get:function(){return a.sqlite3_column_count(this.pointer)},set:()=>l("The columnCount property is read-only.")}),i.oo1={DB:g,Stmt:v},d.isUIThread()){i.oo1.JsStorageDb=function(N="session"){N!=="session"&&N!=="local"&&l("JsStorageDb db name must be one of 'session' or 'local'."),T.call(this,{filename:N,flags:"c",vfs:"kvvfs"})};const m=i.oo1.JsStorageDb;m.prototype=Object.create(g.prototype),m.clearStorage=a.sqlite3_js_kvvfs_clear,m.prototype.clearStorage=function(){return m.clearStorage(S(this).filename)},m.storageSize=a.sqlite3_js_kvvfs_size,m.prototype.storageSize=function(){return m.storageSize(S(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.initWorker1API=function(){const l=(...g)=>{throw new Error(g.join(" "))};globalThis.WorkerGlobalScope instanceof Function||l("initWorker1API() must be run from a Worker thread."),this.self;const a=this.sqlite3||l("Missing this.sqlite3 object."),c=a.oo1.DB,d=function(g){let y=w.idMap.get(g);return y||(y="db#"+ ++w.idSeq+"@"+g.pointer,w.idMap.set(g,y),y)},w={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(g){const y=new c(g);return this.dbs[d(y)]=y,this.dbList.indexOf(y)<0&&this.dbList.push(y),y},close:function(g,y){if(g){delete this.dbs[d(g)];const v=g.filename,S=a.wasm.sqlite3_wasm_db_vfs(g.pointer,0);g.close();const b=this.dbList.indexOf(g);b>=0&&this.dbList.splice(b,1),y&&v&&S&&a.wasm.sqlite3_wasm_vfs_unlink(S,v)}},post:function(g,y){y&&y.length?(globalThis.postMessage(g,Array.from(y)),y.length=0):globalThis.postMessage(g)},dbs:Object.create(null),getDb:function(g,y=!0){return this.dbs[g]||(y?l("Unknown (or closed) DB ID:",g):void 0)}},I=function(g=w.dbList[0]){return g&&g.pointer?g:l("DB is not opened.")},W=function(g,y=!0){const v=w.getDb(g.dbId,!1)||w.dbList[0];return y?I(v):v},J=function(){return w.dbList[0]&&d(w.dbList[0])},ee=function(g){const y=/^file:.+(vfs=(\w+))/.exec(g);return a.capi.sqlite3_vfs_find(y?y[2]:0)},se=g=>g===""||g[0]===":",T={open:function(g){const y=Object.create(null),v=g.args||Object.create(null);v.simulateError&&l("Throwing because of simulateError flag.");const S=Object.create(null);let b,Q;if(y.vfs=v.vfs,se(v.filename)?y.filename=v.filename||"":(y.filename=v.filename,b=v.byteArray,b&&(Q=ee(v.filename))),Q){let L;try{L=a.wasm.allocFromTypedArray(b);const K=a.wasm.sqlite3_wasm_vfs_create_file(Q,y.filename,L,b.byteLength);K&&a.SQLite3Error.toss(K)}catch(K){throw new a.SQLite3Error(K.name+" creating "+v.filename+": "+K.message,{cause:K})}finally{L&&a.wasm.dealloc(L)}}const V=w.open(y);return S.filename=V.filename,S.persistent=!!a.capi.sqlite3_js_db_uses_vfs(V.pointer,"opfs"),S.dbId=d(V),S.vfs=V.dbVfsName(),S},close:function(g){const y=W(g,!1),v={filename:y&&y.filename};if(y){const S=g.args&&typeof g.args=="object"?!!g.args.unlink:!1;w.close(y,S)}return v},exec:function(g){const y=typeof g.args=="string"?{sql:g.args}:g.args||Object.create(null);y.rowMode==="stmt"?l("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):y.sql||l("'exec' requires input SQL.");const v=W(g);(y.callback||Array.isArray(y.resultRows))&&(v._blobXfer=w.xfer);const S=y.callback;let b=0;const Q=!!y.columnNames;typeof S=="string"&&(Q||(y.columnNames=[]),y.callback=function(V,L){w.post({type:S,columnNames:y.columnNames,rowNumber:++b,row:V},w.xfer)});try{const V=y.countChanges?v.changes(!0,y.countChanges===64):void 0;v.exec(y),V!==void 0&&(y.changeCount=v.changes(!0,y.countChanges===64)-V),y.callback instanceof Function&&(y.callback=S,w.post({type:S,columnNames:y.columnNames,rowNumber:null,row:void 0}))}finally{delete v._blobXfer,y.callback&&(y.callback=S)}return y},"config-get":function(){const g=Object.create(null),y=a.config;return["bigIntEnabled"].forEach(function(v){Object.getOwnPropertyDescriptor(y,v)&&(g[v]=y[v])}),g.version=a.version,g.vfsList=a.capi.sqlite3_js_vfs_list(),g.opfsEnabled=!!a.opfs,g},export:function(g){const y=W(g),v={byteArray:a.capi.sqlite3_js_db_export(y.pointer),filename:y.filename,mimetype:"application/x-sqlite3"};return w.xfer.push(v.byteArray.buffer),v},toss:function(g){l("Testing worker exception")},"opfs-tree":async function(g){return a.opfs||l("OPFS support is unavailable."),await a.opfs.treeList()}};globalThis.onmessage=async function(g){g=g.data;let y,v=g.dbId,S=g.type;const b=performance.now();try{T.hasOwnProperty(S)&&T[S]instanceof Function?y=await T[S](g):l("Unknown db worker message type:",g.type)}catch(Q){S="error",y={operation:g.type,message:Q.message,errorClass:Q.name,input:g},Q.stack&&(y.stack=typeof Q.stack=="string"?Q.stack.split(/\n\s*/):Q.stack)}v||(v=y.dbId||J()),w.post({type:S,dbId:v,messageId:g.messageId,workerReceivedTime:b,workerRespondTime:performance.now(),departureTime:g.departureTime,result:y},w.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}.bind({self,sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=i.wasm,a=i.capi,c=i.util.toss3,d=Object.create(null),w=Object.create(null),I=i.StructBinder;i.vfs=d,i.vtab=w;const W=a.sqlite3_index_info;W.prototype.nthConstraint=function(g,y=!1){if(g<0||g>=this.$nConstraint)return!1;const v=this.$aConstraint+W.sqlite3_index_constraint.structInfo.sizeof*g;return y?v:new W.sqlite3_index_constraint(v)},W.prototype.nthConstraintUsage=function(g,y=!1){if(g<0||g>=this.$nConstraint)return!1;const v=this.$aConstraintUsage+W.sqlite3_index_constraint_usage.structInfo.sizeof*g;return y?v:new W.sqlite3_index_constraint_usage(v)},W.prototype.nthOrderBy=function(g,y=!1){if(g<0||g>=this.$nOrderBy)return!1;const v=this.$aOrderBy+W.sqlite3_index_orderby.structInfo.sizeof*g;return y?v:new W.sqlite3_index_orderby(v)};const J=function g(y,v,S,b=g.installMethodArgcCheck){if(y instanceof I.StructType?!(S instanceof Function)&&!l.isPtr(S)&&c("Usage errror: expecting a Function or WASM pointer to one."):c("Usage error: target object is-not-a StructType."),arguments.length===1)return(K,le)=>g(y,K,le,b);g.argcProxy||(g.argcProxy=function(K,le,_,E){return function(...k){return _.length!==arguments.length&&c("Argument mismatch for",K.structInfo.name+"::"+le+": Native signature is:",E),_.apply(this,k)}},g.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((K,le)=>{if(typeof K=="number")try{l.uninstallFunction(K)}catch{}}),delete this.ondispose.__removeFuncList)});const Q=y.memberSignature(v);Q.length<2&&c("Member",v,"does not have a function pointer signature:",Q);const V=y.memberKey(v),L=b&&!l.isPtr(S)?g.argcProxy(y,V,S,Q):S;if(l.isPtr(L))L&&!l.functionEntry(L)&&c("Pointer",L,"is not a WASM function table entry."),y[V]=L;else{const K=l.installFunction(L,y.memberSignature(v,!0));y[V]=K,(!y.ondispose||!y.ondispose.__removeFuncList)&&(y.addOnDispose("ondispose.__removeFuncList handler",g.removeFuncList),y.ondispose.__removeFuncList=[]),y.ondispose.__removeFuncList.push(V,K)}return(K,le)=>g(y,K,le,b)};J.installMethodArgcCheck=!1;const ee=function(g,y,v=J.installMethodArgcCheck){const S=new Map;for(const b of Object.keys(y)){const Q=y[b],V=S.get(Q);if(V){const L=g.memberKey(b);g[L]=g[g.memberKey(V)]}else J(g,b,Q,v),S.set(Q,b)}return g};I.StructType.prototype.installMethod=function(y,v,S=J.installMethodArgcCheck){return arguments.length<3&&y&&typeof y=="object"?ee(this,...arguments):J(this,...arguments)},I.StructType.prototype.installMethods=function(g,y=J.installMethodArgcCheck){return ee(this,g,y)},a.sqlite3_vfs.prototype.registerVfs=function(g=!1){this instanceof i.capi.sqlite3_vfs||c("Expecting a sqlite3_vfs-type argument.");const y=a.sqlite3_vfs_register(this,g?1:0);return y&&c("sqlite3_vfs_register(",this,") failed with rc",y),this.pointer!==a.sqlite3_vfs_find(this.$zName)&&c("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},d.installVfs=function(g){let y=0;const v=["io","vfs"];for(const S of v){const b=g[S];b&&(++y,ee(b.struct,b.methods,!!b.applyArgcCheck),S==="vfs"&&(!b.struct.$zName&&typeof b.name=="string"&&b.struct.addOnDispose(b.struct.$zName=l.allocCString(b.name)),b.struct.registerVfs(!!b.asDefault)))}return y||c("Misuse: installVfs() options object requires at least","one of:",v),this};const se=function(g,y){return function(v,S=!1){if(arguments.length===0&&(v=new y),v instanceof y)return this.set(v.pointer,v),v;l.isPtr(v)||i.SQLite3Error.toss("Invalid argument to",g+"()");let b=this.get(v);return S&&this.delete(v),b}.bind(new Map)},T=function(g,y){const v=se(g,y);return Object.assign(Object.create(null),{StructType:y,create:S=>{const b=v();return l.pokePtr(S,b.pointer),b},get:S=>v(S),unget:S=>v(S,!0),dispose:S=>{const b=v(S,!0);b&&b.dispose()}})};w.xVtab=T("xVtab",a.sqlite3_vtab),w.xCursor=T("xCursor",a.sqlite3_vtab_cursor),w.xIndexInfo=g=>new a.sqlite3_index_info(g),w.xError=function g(y,v,S){if(g.errorReporter instanceof Function)try{g.errorReporter("sqlite3_module::"+y+"(): "+v.message)}catch{}let b;return v instanceof i.WasmAllocError?b=a.SQLITE_NOMEM:arguments.length>2?b=S:v instanceof i.SQLite3Error&&(b=v.resultCode),b||a.SQLITE_ERROR},w.xError.errorReporter=console.error.bind(console),w.xRowid=(g,y)=>l.poke(g,y,"i64"),w.setupModule=function(g){let y=!1;const v=this instanceof a.sqlite3_module?this:g.struct||(y=new a.sqlite3_module);try{const S=g.methods||c("Missing 'methods' object.");for(const b of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const Q=b[0],V=b[1];S[Q]===!0?S[Q]=S[V]:S[V]===!0&&(S[V]=S[Q])}if(g.catchExceptions){const b=function(L,K){return["xConnect","xCreate"].indexOf(L)>=0?function(le,_,E,k,z,m){try{return K(...arguments)||0}catch(N){return N instanceof i.WasmAllocError||(l.dealloc(l.peekPtr(m)),l.pokePtr(m,l.allocCString(N.message))),w.xError(L,N)}}:function(...le){try{return K(...le)||0}catch(_){return w.xError(L,_)}}},Q=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],V=Object.create(null);for(const L of Q){const K=S[L];if(K instanceof Function)L==="xConnect"&&S.xCreate===K?V[L]=S.xCreate:L==="xCreate"&&S.xConnect===K?V[L]=S.xConnect:V[L]=b(L,K);else continue}ee(v,V,!1)}else ee(v,S,!!g.applyArgcCheck);if(v.$iVersion===0){let b;typeof g.iVersion=="number"?b=g.iVersion:v.$xShadowName?b=3:v.$xSavePoint||v.$xRelease||v.$xRollbackTo?b=2:b=1,v.$iVersion=b}}catch(S){throw y&&y.dispose(),S}return v},a.sqlite3_module.prototype.setupModule=function(g){return w.setupModule.call(this,g)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=function a(c){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!c||typeof c!="object")&&(c=Object.create(null));const d=new URL(globalThis.location.href).searchParams;return d.has("opfs-disable")?Promise.resolve(i):(c.verbose===void 0&&(c.verbose=d.has("opfs-verbose")?+d.get("opfs-verbose")||2:1),c.sanityChecks===void 0&&(c.sanityChecks=d.has("opfs-sanity-check")),c.proxyUri===void 0&&(c.proxyUri=a.defaultProxyUri),typeof c.proxyUri=="function"&&(c.proxyUri=c.proxyUri()),new Promise(function(I,W){const J=[i.config.error,i.config.warn,i.config.log],ee=(P,...B)=>{c.verbose>P&&J[P]("OPFS syncer:",...B)},se=(...P)=>ee(2,...P),T=(...P)=>ee(1,...P),g=(...P)=>ee(0,...P),y=i.util.toss,v=i.capi,S=i.wasm,b=v.sqlite3_vfs,Q=v.sqlite3_file,V=v.sqlite3_io_methods,L=Object.create(null),K=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;L.metrics={dump:function(){let P,B=0,j=0,re=0;for(P in f.opIds){const Y=q[P];B+=Y.count,j+=Y.time,re+=Y.wait,Y.avgTime=Y.count&&Y.time?Y.time/Y.count:0,Y.avgWait=Y.count&&Y.wait?Y.wait/Y.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",q,`
Total of`,B,"op(s) for",j,"ms (incl. "+re+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",q.s11n),m.postMessage({type:"opfs-async-metrics"})},reset:function(){let P;const B=re=>re.count=re.time=re.wait=0;for(P in f.opIds)B(q[P]=Object.create(null));let j=q.s11n=Object.create(null);j=j.serialize=Object.create(null),j.count=j.time=0,j=q.s11n.deserialize=Object.create(null),j.count=j.time=0}};const le=new V,_=new b().addOnDispose(()=>le.dispose());let E;const k=P=>(E=!0,_.dispose(),W(P)),z=()=>(E=!1,I(i)),m=new Worker(new URL(""+new URL("sqlite3-opfs-async-proxy-oRRWdEq1.js",import.meta.url).href,import.meta.url));setTimeout(()=>{E===void 0&&k(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),m._originalOnError=m.onerror,m.onerror=function(P){g("Error initializing OPFS asyncer:",P),k(new Error("Loading OPFS async Worker failed for unknown reasons."))};const N=v.sqlite3_vfs_find(null),h=N?new b(N):null;le.$iVersion=1,_.$iVersion=2,_.$szOsFile=v.sqlite3_file.structInfo.sizeof,_.$mxPathname=1024,_.$zName=S.allocCString("opfs"),_.$xDlOpen=_.$xDlError=_.$xDlSym=_.$xDlClose=null,_.addOnDispose("$zName",_.$zName,"cleanup default VFS wrapper",()=>h?h.dispose():null);const f=Object.create(null);f.verbose=c.verbose,f.littleEndian=(()=>{const P=new ArrayBuffer(2);return new DataView(P).setInt16(0,256,!0),new Int16Array(P)[0]===256})(),f.asyncIdleWaitTime=150,f.asyncS11nExceptions=1,f.fileBufferSize=1024*64,f.sabS11nOffset=f.fileBufferSize,f.sabS11nSize=_.$mxPathname*2,f.sabIO=new SharedArrayBuffer(f.fileBufferSize+f.sabS11nSize),f.opIds=Object.create(null);const q=Object.create(null);{let P=0;f.opIds.whichOp=P++,f.opIds.rc=P++,f.opIds.xAccess=P++,f.opIds.xClose=P++,f.opIds.xDelete=P++,f.opIds.xDeleteNoWait=P++,f.opIds.xFileSize=P++,f.opIds.xLock=P++,f.opIds.xOpen=P++,f.opIds.xRead=P++,f.opIds.xSleep=P++,f.opIds.xSync=P++,f.opIds.xTruncate=P++,f.opIds.xUnlock=P++,f.opIds.xWrite=P++,f.opIds.mkdir=P++,f.opIds["opfs-async-metrics"]=P++,f.opIds["opfs-async-shutdown"]=P++,f.opIds.retry=P++,f.sabOP=new SharedArrayBuffer(P*4),L.metrics.reset()}f.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(P=>{(f.sq3Codes[P]=v[P])===void 0&&y("Maintenance required: not found:",P)}),f.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,defaultUnlockAsap:!1});const F=(P,...B)=>{const j=f.opIds[P]||y("Invalid op ID:",P);f.s11n.serialize(...B),Atomics.store(f.sabOPView,f.opIds.rc,-1),Atomics.store(f.sabOPView,f.opIds.whichOp,j),Atomics.notify(f.sabOPView,f.opIds.whichOp);const re=performance.now();Atomics.wait(f.sabOPView,f.opIds.rc,-1);const Y=Atomics.load(f.sabOPView,f.opIds.rc);if(q[P].wait+=performance.now()-re,Y&&f.asyncS11nExceptions){const he=f.s11n.deserialize();he&&g(P+"() async error:",...he)}return Y};L.debug={asyncShutdown:()=>{T("Shutting down OPFS async listener. The OPFS VFS will no longer work."),F("opfs-async-shutdown")},asyncRestart:()=>{T("Attempting to restart OPFS VFS async listener. Might work, might not."),m.postMessage({type:"opfs-async-restart"})}};const X=()=>{if(f.s11n)return f.s11n;const P=new TextDecoder,B=new TextEncoder("utf-8"),j=new Uint8Array(f.sabIO,f.sabS11nOffset,f.sabS11nSize),re=new DataView(f.sabIO,f.sabS11nOffset,f.sabS11nSize);f.s11n=Object.create(null);const Y=Object.create(null);Y.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Y.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Y.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Y.string={id:4};const he=Z=>Y[typeof Z]||y("Maintenance required: this value type cannot be serialized.",Z),Fe=Z=>{switch(Z){case Y.number.id:return Y.number;case Y.bigint.id:return Y.bigint;case Y.boolean.id:return Y.boolean;case Y.string.id:return Y.string;default:y("Invalid type ID:",Z)}};return f.s11n.deserialize=function(Z=!1){++q.s11n.deserialize.count;const ne=performance.now(),O=j[0],D=O?[]:null;if(O){const x=[];let C=1,R,$,de;for(R=0;R<O;++R,++C)x.push(Fe(j[C]));for(R=0;R<O;++R){const ge=x[R];ge.getter?(de=re[ge.getter](C,f.littleEndian),C+=ge.size):($=re.getInt32(C,f.littleEndian),C+=4,de=P.decode(j.slice(C,C+$)),C+=$),D.push(de)}}return Z&&(j[0]=0),q.s11n.deserialize.time+=performance.now()-ne,D},f.s11n.serialize=function(...Z){const ne=performance.now();if(++q.s11n.serialize.count,Z.length){const O=[];let D=0,x=1;for(j[0]=Z.length&255;D<Z.length;++D,++x)O.push(he(Z[D])),j[x]=O[D].id;for(D=0;D<Z.length;++D){const C=O[D];if(C.setter)re[C.setter](x,Z[D],f.littleEndian),x+=C.size;else{const R=B.encode(Z[D]);re.setInt32(x,R.byteLength,f.littleEndian),x+=4,j.set(R,x),x+=R.byteLength}}}else j[0]=0;q.s11n.serialize.time+=performance.now()-ne},f.s11n},ie=function P(B=16){P._chars||(P._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",P._n=P._chars.length);const j=[];let re=0;for(;re<B;++re){const Y=Math.random()*(P._n*64)%P._n|0;j[re]=P._chars[Y]}return j.join("")},oe=Object.create(null),ce=Object.create(null);ce.op=void 0,ce.start=void 0;const ae=P=>{ce.start=performance.now(),ce.op=P,++q[P].count},ue=()=>q[ce.op].time+=performance.now()-ce.start,be={xCheckReservedLock:function(P,B){const j=oe[P];return S.poke(B,j.lockType?1:0,"i32"),0},xClose:function(P){ae("xClose");let B=0;const j=oe[P];return j&&(delete oe[P],B=F("xClose",P),j.sq3File&&j.sq3File.dispose()),ue(),B},xDeviceCharacteristics:function(P){return v.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(P,B,j){return v.SQLITE_NOTFOUND},xFileSize:function(P,B){ae("xFileSize");let j=F("xFileSize",P);if(j==0)try{const re=f.s11n.deserialize()[0];S.poke(B,re,"i64")}catch(re){g("Unexpected error reading xFileSize() result:",re),j=f.sq3Codes.SQLITE_IOERR}return ue(),j},xLock:function(P,B){ae("xLock");const j=oe[P];let re=0;return j.lockType?j.lockType=B:(re=F("xLock",P,B),re===0&&(j.lockType=B)),ue(),re},xRead:function(P,B,j,re){ae("xRead");const Y=oe[P];let he;try{he=F("xRead",P,j,Number(re)),(he===0||v.SQLITE_IOERR_SHORT_READ===he)&&S.heap8u().set(Y.sabView.subarray(0,j),B)}catch(Fe){g("xRead(",arguments,") failed:",Fe,Y),he=v.SQLITE_IOERR_READ}return ue(),he},xSync:function(P,B){ae("xSync"),++q.xSync.count;const j=F("xSync",P,B);return ue(),j},xTruncate:function(P,B){ae("xTruncate");const j=F("xTruncate",P,Number(B));return ue(),j},xUnlock:function(P,B){ae("xUnlock");const j=oe[P];let re=0;return v.SQLITE_LOCK_NONE===B&&j.lockType&&(re=F("xUnlock",P,B)),re===0&&(j.lockType=B),ue(),re},xWrite:function(P,B,j,re){ae("xWrite");const Y=oe[P];let he;try{Y.sabView.set(S.heap8u().subarray(B,B+j)),he=F("xWrite",P,j,Number(re))}catch(Fe){g("xWrite(",arguments,") failed:",Fe,Y),he=v.SQLITE_IOERR_WRITE}return ue(),he}},qe={xAccess:function(P,B,j,re){ae("xAccess");const Y=F("xAccess",S.cstrToJs(B));return S.poke(re,Y?0:1,"i32"),ue(),0},xCurrentTime:function(P,B){return S.poke(B,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(P,B){return S.poke(B,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(P,B,j){ae("xDelete");const re=F("xDelete",S.cstrToJs(B),j,!1);return ue(),re},xFullPathname:function(P,B,j,re){return S.cstrncpy(re,B,j)<j?0:v.SQLITE_CANTOPEN},xGetLastError:function(P,B,j){return T("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(B,j,re,Y,he){ae("xOpen");let Fe=0;j===0?j=ie():typeof j=="number"&&(v.sqlite3_uri_boolean(j,"opfs-unlock-asap",0)&&(Fe|=f.opfsFlags.OPFS_UNLOCK_ASAP),j=S.cstrToJs(j));const Z=Object.create(null);Z.fid=re,Z.filename=j,Z.sab=new SharedArrayBuffer(f.fileBufferSize),Z.flags=Y;const ne=F("xOpen",re,j,Y,Fe);return ne||(Z.readOnly&&S.poke(he,v.SQLITE_OPEN_READONLY,"i32"),oe[re]=Z,Z.sabView=f.sabFileBufView,Z.sq3File=new Q(re),Z.sq3File.$pMethods=le.pointer,Z.lockType=v.SQLITE_LOCK_NONE),ue(),ne}};if(h&&(_.$xRandomness=h.$xRandomness,_.$xSleep=h.$xSleep),_.$xRandomness||(qe.xRandomness=function(P,B,j){const re=S.heap8u();let Y=0;for(;Y<B;++Y)re[j+Y]=Math.random()*255e3&255;return Y}),_.$xSleep||(qe.xSleep=function(P,B){return Atomics.wait(f.sabOPView,f.opIds.xSleep,0,B),0}),L.getResolvedPath=function(P,B){const j=new URL(P,"file://irrelevant").pathname;return B?j.split("/").filter(re=>!!re):j},L.getDirForFilename=async function(B,j=!1){const re=L.getResolvedPath(B,!0),Y=re.pop();let he=L.rootDirectory;for(const Fe of re)Fe&&(he=await he.getDirectoryHandle(Fe,{create:!!j}));return[he,Y]},L.mkdir=async function(P){try{return await L.getDirForFilename(P+"/filepart",!0),!0}catch{return!1}},L.entryExists=async function(P){try{const[B,j]=await L.getDirForFilename(P);return await B.getFileHandle(j),!0}catch{return!1}},L.randomFilename=ie,L.registerVfs=(P=!1)=>S.exports.sqlite3_vfs_register(_.pointer,P?1:0),L.treeList=async function(){const P=async function j(re,Y){Y.name=re.name,Y.dirs=[],Y.files=[];for await(const he of re.values())if(he.kind==="directory"){const Fe=Object.create(null);Y.dirs.push(Fe),await j(he,Fe)}else Y.files.push(he.name)},B=Object.create(null);return await P(L.rootDirectory,B),B},L.rmfr=async function(){const P=L.rootDirectory,B={recurse:!0};for await(const j of P.values())P.removeEntry(j.name,B)},L.unlink=async function(P,B=!1,j=!1){try{const[re,Y]=await L.getDirForFilename(P,!1);return await re.removeEntry(Y,{recursive:B}),!0}catch(re){if(j)throw new Error("unlink(",arguments[0],") failed: "+re.message,{cause:re});return!1}},L.traverse=async function(P){const B={recursive:!0,directory:L.rootDirectory};typeof P=="function"&&(P={callback:P}),P=Object.assign(B,P||{}),async function re(Y,he){for await(const Fe of Y.values()){if(P.callback(Fe,Y,he)===!1)return!1;if(P.recursive&&Fe.kind==="directory"&&await re(Fe,he+1)===!1)break}}(P.directory,0)},L.importDb=async function(P,B){B instanceof ArrayBuffer&&(B=new Uint8Array(B));const j=B.byteLength;(j<512||j%512!=0)&&y("Byte array size is invalid for an SQLite db.");const re="SQLite format 3";for(let Z=0;Z<re.length;++Z)re.charCodeAt(Z)!==B[Z]&&y("Input does not contain an SQLite database header.");let Y;const[he,Fe]=await L.getDirForFilename(P,!0);try{Y=await(await he.getFileHandle(Fe,{create:!0})).createSyncAccessHandle(),Y.truncate(0);const ne=Y.write(B,{at:0});return ne!=j&&y("Expected to write "+j+" bytes but wrote "+ne+"."),Y.write(new Uint8Array([1,1]),{at:18}),ne}catch(Z){throw Y&&(await Y.close(),Y=void 0),await he.removeEntry(Fe).catch(()=>{}),Z}finally{Y&&await Y.close()}},i.oo1){const P=function(...B){const j=i.oo1.DB.dbCtorHelper.normalizeArgs(...B);j.vfs=_.$zName,i.oo1.DB.dbCtorHelper.call(this,j)};P.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=P,P.importDb=L.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenSql(_.pointer,function(B,j){j.capi.sqlite3_busy_timeout(B,1e4),j.capi.sqlite3_exec(B,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}const st=function(){const P=S.scopedAllocPush(),B=new Q;try{const j=B.pointer,re=v.SQLITE_OPEN_CREATE|v.SQLITE_OPEN_READWRITE|v.SQLITE_OPEN_MAIN_DB,Y=S.scopedAlloc(8),he="/sanity/check/file"+ie(8),Fe=S.scopedAllocCString(he);let Z;if(f.s11n.serialize("This is ä string."),Z=f.s11n.deserialize(),se("deserialize() says:",Z),Z[0]!=="This is ä string."&&y("String d13n error."),qe.xAccess(_.pointer,Fe,0,Y),Z=S.peek(Y,"i32"),se("xAccess(",he,") exists ?=",Z),Z=qe.xOpen(_.pointer,Fe,j,re,Y),se("open rc =",Z,"state.sabOPView[xOpen] =",f.sabOPView[f.opIds.xOpen]),Z!==0){g("open failed with code",Z);return}qe.xAccess(_.pointer,Fe,0,Y),Z=S.peek(Y,"i32"),Z||y("xAccess() failed to detect file."),Z=be.xSync(B.pointer,0),Z&&y("sync failed w/ rc",Z),Z=be.xTruncate(B.pointer,1024),Z&&y("truncate failed w/ rc",Z),S.poke(Y,0,"i64"),Z=be.xFileSize(B.pointer,Y),Z&&y("xFileSize failed w/ rc",Z),se("xFileSize says:",S.peek(Y,"i64")),Z=be.xWrite(B.pointer,Fe,10,1),Z&&y("xWrite() failed!");const ne=S.scopedAlloc(16);Z=be.xRead(B.pointer,ne,6,2),S.poke(ne+6,0);let O=S.cstrToJs(ne);se("xRead() got:",O),O!=="sanity"&&y("Unexpected xRead() value."),qe.xSleep&&(se("xSleep()ing before close()ing..."),qe.xSleep(_.pointer,2e3),se("waking up from xSleep()")),Z=be.xClose(j),se("xClose rc =",Z,"sabOPView =",f.sabOPView),se("Deleting file:",he),qe.xDelete(_.pointer,Fe,4660),qe.xAccess(_.pointer,Fe,0,Y),Z=S.peek(Y,"i32"),Z&&y("Expecting 0 from xAccess(",he,") after xDelete()."),T("End of OPFS sanity checks.")}finally{B.dispose(),S.scopedAllocPop(P)}};m.onmessage=function({data:P}){switch(P.type){case"opfs-unavailable":k(new Error(P.payload.join(" ")));break;case"opfs-async-loaded":m.postMessage({type:"opfs-async-init",args:f});break;case"opfs-async-inited":{if(E===!0)break;try{i.vfs.installVfs({io:{struct:le,methods:be},vfs:{struct:_,methods:qe}}),f.sabOPView=new Int32Array(f.sabOP),f.sabFileBufView=new Uint8Array(f.sabIO,0,f.fileBufferSize),f.sabS11nView=new Uint8Array(f.sabIO,f.sabS11nOffset,f.sabS11nSize),X(),c.sanityChecks&&(T("Running sanity checks because of opfs-sanity-check URL arg..."),st()),K()?navigator.storage.getDirectory().then(B=>{m.onerror=m._originalOnError,delete m._originalOnError,i.opfs=L,L.rootDirectory=B,se("End of OPFS sqlite3_vfs setup.",_),z()}).catch(k):z()}catch(B){g(B),k(B)}break}default:{const B="Unexpected message from the OPFS async worker: "+JSON.stringify(P);g(B),k(new Error(B));break}}}}))};l.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async a=>{try{let c=l.defaultProxyUri;return a.scriptInfo.sqlite3Dir&&(l.defaultProxyUri=a.scriptInfo.sqlite3Dir+c),l().catch(d=>{a.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",d.message)})}catch(c){return a.config.error("installOpfsVfs() exception:",c),Promise.reject(c)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){var ce,ae,ue,be,qe,st,P,B,j,re,Y,he,Zi,Z;const l=i.util.toss,a=i.util.toss3,c=Object.create(null),d=i.capi,w=i.wasm,I=4096,W=512,J=4,ee=8,se=W+J,T=W,g=se,y=I,v=d.SQLITE_OPEN_MAIN_DB|d.SQLITE_OPEN_MAIN_JOURNAL|d.SQLITE_OPEN_SUPER_JOURNAL|d.SQLITE_OPEN_WAL,S=".opaque",b=()=>Math.random().toString(36).slice(2),Q=new TextDecoder,V=new TextEncoder,L=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),K=[i.config.error,i.config.warn,i.config.log];i.config.log;const le=i.config.warn;i.config.error;const _=new Map,E=ne=>_.get(ne),k=(ne,O)=>{O?_.set(ne,O):_.delete(ne)},z=new Map,m=ne=>z.get(ne),N=(ne,O)=>{O?z.set(ne,O):z.delete(ne)},h={xCheckReservedLock:function(ne,O){const D=m(ne);return D.log("xCheckReservedLock"),D.storeErr(),w.poke32(O,1),0},xClose:function(ne){const O=m(ne);O.storeErr();const D=O.getOFileForS3File(ne);if(D)try{O.log(`xClose ${D.path}`),O.mapS3FileToOFile(ne,!1),D.sah.flush(),D.flags&d.SQLITE_OPEN_DELETEONCLOSE&&O.deletePath(D.path)}catch(x){return O.storeErr(x),d.SQLITE_IOERR}return 0},xDeviceCharacteristics:function(ne){return d.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(ne,O,D){return d.SQLITE_NOTFOUND},xFileSize:function(ne,O){const D=m(ne);D.log("xFileSize");const C=D.getOFileForS3File(ne).sah.getSize()-y;return w.poke64(O,BigInt(C)),0},xLock:function(ne,O){const D=m(ne);D.log(`xLock ${O}`),D.storeErr();const x=D.getOFileForS3File(ne);return x.lockType=O,0},xRead:function(ne,O,D,x){const C=m(ne);C.storeErr();const R=C.getOFileForS3File(ne);C.log(`xRead ${R.path} ${D} @ ${x}`);try{const $=R.sah.read(w.heap8u().subarray(O,O+D),{at:y+Number(x)});return $<D?(w.heap8u().fill(0,O+$,O+D),d.SQLITE_IOERR_SHORT_READ):0}catch($){return C.storeErr($),d.SQLITE_IOERR}},xSectorSize:function(ne){return I},xSync:function(ne,O){const D=m(ne);D.log(`xSync ${O}`),D.storeErr();const x=D.getOFileForS3File(ne);try{return x.sah.flush(),0}catch(C){return D.storeErr(C),d.SQLITE_IOERR}},xTruncate:function(ne,O){const D=m(ne);D.log(`xTruncate ${O}`),D.storeErr();const x=D.getOFileForS3File(ne);try{return x.sah.truncate(y+Number(O)),0}catch(C){return D.storeErr(C),d.SQLITE_IOERR}},xUnlock:function(ne,O){const D=m(ne);D.log("xUnlock");const x=D.getOFileForS3File(ne);return x.lockType=O,0},xWrite:function(ne,O,D,x){const C=m(ne);C.storeErr();const R=C.getOFileForS3File(ne);C.log(`xWrite ${R.path} ${D} ${x}`);try{return R.sah.write(w.heap8u().subarray(O,O+D),{at:y+Number(x)})===D?0:d.SQLITE_IOERR}catch($){return C.storeErr($),d.SQLITE_IOERR}}},f=new d.sqlite3_io_methods;f.$iVersion=1,i.vfs.installVfs({io:{struct:f,methods:h}});const q={xAccess:function(ne,O,D,x){const C=E(ne);C.storeErr();try{const R=C.getPath(O);w.poke32(x,C.hasFilename(R)?1:0)}catch{w.poke32(x,0)}return 0},xCurrentTime:function(ne,O){return w.poke(O,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(ne,O){return w.poke(O,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(ne,O,D){const x=E(ne);x.log(`xDelete ${w.cstrToJs(O)}`),x.storeErr();try{return x.deletePath(x.getPath(O)),0}catch(C){return x.storeErr(C),d.SQLITE_IOERR_DELETE}},xFullPathname:function(ne,O,D,x){return w.cstrncpy(x,O,D)<D?0:d.SQLITE_CANTOPEN},xGetLastError:function(ne,O,D){const x=E(ne);x.log(`xGetLastError ${O}`);const C=x.popErr();if(C){const R=w.scopedAllocPush();try{const[$,de]=w.scopedAllocCString(C.message,!0);w.cstrncpy(D,$,O),de>O&&w.poke8(D+O-1,0)}catch{return d.SQLITE_NOMEM}finally{w.scopedAllocPop(R)}}return 0},xOpen:function(O,D,x,C,R){const $=E(O);try{$.log(`xOpen ${w.cstrToJs(D)} ${C}`);const de=D&&w.peek8(D)?$.getPath(D):b();let ge=$.getSAHForPath(de);!ge&&C&d.SQLITE_OPEN_CREATE&&($.getFileCount()<$.getCapacity()?(ge=$.nextAvailableSAH(),$.setAssociatedPath(ge,de,C)):l("SAH pool is full. Cannot create file",de)),ge||l("file not found:",de);const Qe={path:de,flags:C,sah:ge};$.mapS3FileToOFile(x,Qe),Qe.lockType=d.SQLITE_LOCK_NONE;const je=new d.sqlite3_file(x);return je.$pMethods=f.pointer,je.dispose(),w.poke32(R,C),0}catch(de){return $.storeErr(de),d.SQLITE_CANTOPEN}}},F=function(ne){i.capi.sqlite3_vfs_find(ne)&&a("VFS name is already registered:",ne);const O=new d.sqlite3_vfs,D=d.sqlite3_vfs_find(null),x=D?new d.sqlite3_vfs(D):null;return O.$iVersion=2,O.$szOsFile=d.sqlite3_file.structInfo.sizeof,O.$mxPathname=W,O.addOnDispose(O.$zName=w.allocCString(ne),()=>k(O.pointer,0)),x&&(O.$xRandomness=x.$xRandomness,O.$xSleep=x.$xSleep,x.dispose()),!O.$xRandomness&&!q.xRandomness&&(q.xRandomness=function(C,R,$){const de=w.heap8u();let ge=0;for(;ge<R;++ge)de[$+ge]=Math.random()*255e3&255;return ge}),!O.$xSleep&&!q.xSleep&&(q.xSleep=(C,R)=>0),i.vfs.installVfs({vfs:{struct:O,methods:q}}),O};class X{constructor(O=Object.create(null)){M(this,he);We(this,"vfsDir");M(this,ce,void 0);M(this,ae,void 0);M(this,ue,void 0);M(this,be,new Map);M(this,qe,new Map);M(this,st,new Set);M(this,P,new Map);M(this,B,new Uint8Array(se));M(this,j,void 0);M(this,re,void 0);M(this,Y,void 0);H(this,Y,O.verbosity??L.verbosity),this.vfsName=O.name||L.name,H(this,re,F(this.vfsName)),k(s(this,re).pointer,this),this.vfsDir=O.directory||"."+this.vfsName,H(this,j,new DataView(s(this,B).buffer,s(this,B).byteOffset)),this.isReady=this.reset(!!(O.clearOnInit??L.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(O.initialCapacity||L.initialCapacity)})}log(...O){ke(this,he,Zi).call(this,2,...O)}warn(...O){ke(this,he,Zi).call(this,1,...O)}error(...O){ke(this,he,Zi).call(this,0,...O)}getVfs(){return s(this,re)}getCapacity(){return s(this,be).size}getFileCount(){return s(this,qe).size}getFileNames(){const O=[],D=s(this,qe).keys();for(const x of D)O.push(x);return O}async addCapacity(O){for(let D=0;D<O;++D){const x=b(),R=await(await s(this,ae).getFileHandle(x,{create:!0})).createSyncAccessHandle();s(this,be).set(R,x),this.setAssociatedPath(R,"",0)}return this.getCapacity()}async reduceCapacity(O){let D=0;for(const x of Array.from(s(this,st))){if(D===O||this.getFileCount()===this.getCapacity())break;const C=s(this,be).get(x);x.close(),await s(this,ae).removeEntry(C),s(this,be).delete(x),s(this,st).delete(x),++D}return D}releaseAccessHandles(){for(const O of s(this,be).keys())O.close();s(this,be).clear(),s(this,qe).clear(),s(this,st).clear()}async acquireAccessHandles(O){const D=[];for await(const[x,C]of s(this,ae))C.kind==="file"&&D.push([x,C]);return Promise.all(D.map(async([x,C])=>{try{const R=await C.createSyncAccessHandle();if(s(this,be).set(R,x),O)R.truncate(y),this.setAssociatedPath(R,"",0);else{const $=this.getAssociatedPath(R);$?s(this,qe).set($,R):s(this,st).add(R)}}catch(R){throw this.storeErr(R),this.releaseAccessHandles(),R}}))}getAssociatedPath(O){O.read(s(this,B),{at:0});const D=s(this,j).getUint32(T);if(s(this,B)[0]&&(D&d.SQLITE_OPEN_DELETEONCLOSE||!(D&v)))return le(`Removing file with unexpected flags ${D.toString(16)}`,s(this,B)),this.setAssociatedPath(O,"",0),"";const x=new Uint32Array(ee/4);O.read(x,{at:g});const C=this.computeDigest(s(this,B));if(x.every((R,$)=>R===C[$])){const R=s(this,B).findIndex($=>$===0);return R===0&&O.truncate(y),R?Q.decode(s(this,B).subarray(0,R)):""}else return le("Disassociating file with bad digest."),this.setAssociatedPath(O,"",0),""}setAssociatedPath(O,D,x){const C=V.encodeInto(D,s(this,B));W<=C.written+1&&l("Path too long:",D),s(this,B).fill(0,C.written,W),s(this,j).setUint32(T,x);const R=this.computeDigest(s(this,B));O.write(s(this,B),{at:0}),O.write(R,{at:g}),O.flush(),D?(s(this,qe).set(D,O),s(this,st).delete(O)):(O.truncate(y),s(this,st).add(O))}computeDigest(O){let D=3735928559,x=1103547991;for(const C of O)D=31*D+C*307,x=31*x+C*307;return new Uint32Array([D>>>0,x>>>0])}async reset(O){await this.isReady;let D=await navigator.storage.getDirectory(),x;for(const C of this.vfsDir.split("/"))C&&(x=D,D=await D.getDirectoryHandle(C,{create:!0}));return H(this,ce,D),H(this,ue,x),H(this,ae,await s(this,ce).getDirectoryHandle(S,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(O)}getPath(O){return w.isPtr(O)&&(O=w.cstrToJs(O)),(O instanceof URL?O:new URL(O,"file://localhost/")).pathname}deletePath(O){const D=s(this,qe).get(O);return D&&(s(this,qe).delete(O),this.setAssociatedPath(D,"",0)),!!D}storeErr(O){return O&&this.error(O),this.$error=O}popErr(){const O=this.$error;return this.$error=void 0,O}nextAvailableSAH(){const[O]=s(this,st).keys();return O}getOFileForS3File(O){return s(this,P).get(O)}mapS3FileToOFile(O,D){D?(s(this,P).set(O,D),N(O,this)):(s(this,P).delete(O),N(O,!1))}hasFilename(O){return s(this,qe).has(O)}getSAHForPath(O){return s(this,qe).get(O)}async removeVfs(){if(!s(this,re).pointer||!s(this,ae))return!1;d.sqlite3_vfs_unregister(s(this,re).pointer),s(this,re).dispose();try{this.releaseAccessHandles(),await s(this,ce).removeEntry(S,{recursive:!0}),H(this,ae,void 0),await s(this,ue).removeEntry(s(this,ce).name,{recursive:!0}),H(this,ce,H(this,ue,void 0))}catch(O){i.config.error(this.vfsName,"removeVfs() failed:",O)}return!0}exportFile(O){const D=s(this,qe).get(O)||l("File not found:",O),x=D.getSize()-y,C=new Uint8Array(x>0?x:0);if(x>0){const R=D.read(C,{at:y});R!=x&&l("Expected to read "+x+" bytes but read "+R+".")}return C}importDb(O,D){D instanceof ArrayBuffer&&(D=new Uint8Array(D));const x=D.byteLength;(x<512||x%512!=0)&&l("Byte array size is invalid for an SQLite db.");const C="SQLite format 3";for(let de=0;de<C.length;++de)C.charCodeAt(de)!==D[de]&&l("Input does not contain an SQLite database header.");const R=s(this,qe).get(O)||this.nextAvailableSAH()||l("No available handles to import to."),$=R.write(D,{at:y});$!=x?(this.setAssociatedPath(R,"",0),l("Expected to write "+x+" bytes but wrote "+$+".")):(R.write(new Uint8Array([1,1]),{at:y+18}),this.setAssociatedPath(R,O,d.SQLITE_OPEN_MAIN_DB))}}ce=new WeakMap,ae=new WeakMap,ue=new WeakMap,be=new WeakMap,qe=new WeakMap,st=new WeakMap,P=new WeakMap,B=new WeakMap,j=new WeakMap,re=new WeakMap,Y=new WeakMap,he=new WeakSet,Zi=function(O,...D){s(this,Y)>O&&K[O](this.vfsName+":",...D)};class ie{constructor(O){M(this,Z,void 0);H(this,Z,O),this.vfsName=O.vfsName}async addCapacity(O){return s(this,Z).addCapacity(O)}async reduceCapacity(O){return s(this,Z).reduceCapacity(O)}getCapacity(){return s(this,Z).getCapacity(s(this,Z))}getFileCount(){return s(this,Z).getFileCount()}getFileNames(){return s(this,Z).getFileNames()}async reserveMinimumCapacity(O){const D=s(this,Z).getCapacity();return D<O?s(this,Z).addCapacity(O-D):D}exportFile(O){return s(this,Z).exportFile(O)}importDb(O,D){return s(this,Z).importDb(O,D)}async wipeFiles(){return s(this,Z).reset(!0)}unlink(O){return s(this,Z).deletePath(O)}async removeVfs(){return s(this,Z).removeVfs()}}Z=new WeakMap;const oe=async()=>{const ne=await navigator.storage.getDirectory(),O=".opfs-sahpool-sync-check-"+b(),C=(await(await ne.getFileHandle(O,{create:!0})).createSyncAccessHandle()).close();return await C,await ne.removeEntry(O),C?.then&&l("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(ne=Object.create(null)){const O=ne.name||L.name;return c[O]?c[O]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?c[O]=Promise.reject(new Error("Missing required OPFS APIs.")):c[O]=oe().then(async function(){if(ne.$testThrowInInit)throw ne.$testThrowInInit;const D=new X(ne);return D.isReady.then(async()=>{const x=new ie(D);if(i.oo1){const C=i.oo1,R=D.getVfs(),$=function(...de){const ge=C.DB.dbCtorHelper.normalizeArgs(...de);ge.vfs=R.$zName,C.DB.dbCtorHelper.call(this,ge)};$.prototype=Object.create(C.DB.prototype),x.OpfsSAHPoolDb=$,C.DB.dbCtorHelper.setVfsPostOpenSql(R.pointer,function(de,ge){ge.capi.sqlite3_exec(de,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return D.log("VFS initialized."),x}).catch(async x=>(await D.removeVfs().catch(()=>{}),x))}).catch(D=>c[O]=Promise.reject(D))}}),typeof o<"u"){const i=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?o.asm:wasmExports,memory:o.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=i;let l;try{l=globalThis.sqlite3ApiBootstrap()}catch(a){throw console.error("sqlite3ApiBootstrap() error:",a),a}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}o.sqlite3=l}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),r.ready}})();const $d=function(){const t=Xo;if(!t)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...r)=>console.warn("sqlite3.debugModule:",...r):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const r=e.moduleScript.src.split("/");r.pop(),e.sqlite3Dir=r.join("/")+"/"}if(globalThis.sqlite3InitModule=function r(...n){return t(...n).then(A=>{const U=A.sqlite3;U.scriptInfo=e,r.__isUnderTest&&(U.__isUnderTest=!0);const te=U.asyncPostInit;return delete U.asyncPostInit,te()}).catch(A=>{throw console.error("Exception loading sqlite3 module:",A),A})},globalThis.sqlite3InitModule.ready=t.ready,globalThis.sqlite3InitModuleState.moduleScript){const r=globalThis.sqlite3InitModuleState;let n=r.moduleScript.src.split("/");n.pop(),r.scriptDir=n.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();Xo=$d;var Hd=Xo;/** @license Copyright 2019 Google LLC SPDX-License-Identifier: Apache-2.0 */function Jd(t){return t.constructor.name==="MessagePort"}function Gd(t){Jd(t)&&t.close()}function Kd(t){return Xd(t,{type:"RELEASE"}).then(()=>{Gd(t)})}const $a=new WeakMap;"FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=($a.get(t)||0)-1;$a.set(t,e),e===0&&Kd(t)});function Xd(t,e,r){return new Promise(n=>{const A=Yd();t.addEventListener("message",function U(te){!te.data||!te.data.id||te.data.id!==A||(t.removeEventListener("message",U),n(te.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:A},e),r)})}function Yd(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Zd=class extends jo{constructor(e){super();We(this,"serializer");this.serializer=e}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:n,...A}=r,U=this.serializer(n);return n===U?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...A,value:U}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Hl=t=>{if(Jl(t)||typeof t=="string")return t;if(typeof t=="boolean")return`${t}`;if(t instanceof Date)return t.toISOString();try{return JSON.stringify(t)}catch{return t}},Ha=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/,ef=t=>{if(Jl(t))return t;if(typeof t=="string"){if(/^(true|false)$/.test(t))return t==="true";if(Ha.test(t))return new Date(t);try{return JSON.parse(t,(e,r)=>typeof r=="string"&&Ha.exec(r)?new Date(r):r)}catch{return t}}};function Jl(t){return t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t}var tf=class{constructor(t={}){We(this,"transformer");We(this,"deserializer");We(this,"skipNodeSet");We(this,"ctx");const{deserializer:e=ef,serializer:r=Hl,skipNodeKind:n=[]}=t;this.transformer=new Zd(r),this.deserializer=e,n.length&&(this.skipNodeSet=new Set(n),this.ctx=new WeakSet)}transformQuery({node:t,queryId:e}){return this.skipNodeSet?.has(t.kind)?(this.ctx?.add(e),t):this.transformer.transformNode(t)}async transformResult({result:t,queryId:e}){return this.ctx?.has(e)?t:{...t,rows:t.rows.map(r=>Object.fromEntries(Object.entries(r).map(([n,A])=>[n,this.deserializer(A)])))}}};function Ja(t){const{logger:e,merge:r,queryNode:n}=t;return A=>{const{level:U,queryDurationMillis:te,query:{parameters:Ae,sql:Le,query:tt}}=A,nt=U==="error"?A.error:void 0;let Ce=Le.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&Ae.forEach(sn=>{Ce=Ce.replace("?",typeof sn=="string"?sn:JSON.stringify(sn))});const $e={sql:Ce,params:Ae,duration:te,error:nt};n&&($e.queryNode=tt),e($e)}}async function nf(t){const{rows:e}=await t.executeQuery(fr.raw("PRAGMA integrity_check"));if(!e.length)throw new Error("fail to check integrity");return e[0].integrity_check==="ok"}async function Ga(t,e){if(e)return await t.executeQuery(fr.raw(`PRAGMA user_version = ${e}`)),e;const{rows:r}=await t.executeQuery(fr.raw("PRAGMA user_version"));if(!r.length)throw new Error("fail to get DBVersion");return r[0].user_version}function rf(t){return`__pre_${t}`}function sf(t,e=r=>r){return{setParam:r=>{let n;return(A,U)=>{if(!n){const{parameters:te,sql:Ae,query:Le}=r({qb:t,param:rf}).compile();n={sql:Ae,query:U?.(Le)||{kind:Le.kind},parameters:te}}return{...n,parameters:n.parameters.map(te=>typeof te=="string"&&te.startsWith("__pre_")?e(A[te.slice(6)]):te)}}}}}async function of(t,e){const r=e||`sp_${Date.now()%1e8}`;return await lt`savepoint ${lt.raw(r)}`.execute(t),{release:async()=>{await lt`release savepoint ${lt.raw(r)}`.execute(t)},rollback:async()=>{await lt`rollback to savepoint ${lt.raw(r)}`.execute(t)}}}async function af(t,e,r){const{release:n,rollback:A}=await of(t,r);try{const U=await e(t);return await n(),U}catch(U){throw await A(),U}}var lf=class extends Error{constructor(){super("db file maybe broken")}};function cf(t){return t.toOperationNode().kind==="SelectQueryNode"}var uf=class{constructor(t){We(this,"kysely");We(this,"trxCount",0);We(this,"trx");We(this,"logger");We(this,"serializer",Hl);const{dialect:e,logger:r,onQuery:n,plugins:A=[],serializerPluginOptions:U}=t;this.logger=r,U?.serializer&&(this.serializer=U.serializer),A.push(new tf(U));let te;n===!0?te=Ja({logger:this.logger?.debug||console.log,merge:!0}):n&&(te=Ja(n)),this.kysely=new qi({dialect:e,log:te,plugins:A})}async updateTableSchema(t,e){try{if(e&&!await nf(this.kysely))return this.logger?.error("integrity check fail"),{ready:!1,error:new lf};await t(this.kysely,this.logger)}catch(r){return this.logError(r,"sync table fail"),{ready:!1,error:r}}return this.logger?.info("table updated"),{ready:!0}}getDB(){return this.trx||this.kysely}logError(t,e){e&&this.logger?.error(e,t instanceof Error?t:void 0)}async transaction(t,e={}){return this.trx?(this.trxCount++,this.logger?.debug(`run in savepoint: sp_${this.trxCount}`),await af(this.trx,t,`sp_${this.trxCount}`).then(async r=>(await e.afterCommit?.(),r)).catch(r=>this.logError(r,e.errorMsg)).finally(()=>this.trxCount--)):await this.kysely.transaction().execute(async r=>(this.trx=r,this.logger?.debug("run in transaction"),await t(r))).then(async r=>(await e.afterCommit?.(),r)).catch(r=>this.logError(r,e.errorMsg)).finally(()=>this.trx=void 0)}async execute(t){return typeof t=="function"?await t(this.getDB()).execute():await this.getDB().executeQuery(t)}async executeTakeFirst(t){let e=t(this.getDB());return cf(e)&&(e=e.limit(1)),await e.executeTakeFirstOrThrow()}precompile(t){return this.logger?.debug?.("precompile"),sf(t(this.kysely),this.serializer)}async raw(t,e){return typeof t=="string"?await this.getDB().executeQuery(fr.raw(t,e)):await t.execute(this.getDB())}async optimize(t){await this.raw(t?"vacuum":"pragma optimize")}async destroy(){this.logger?.info("destroyed"),await this.kysely.destroy(),this.trx=void 0}},Gl="__TIME_TRIGGER__";function df(t,e){const{create:r,update:n}=e?.timeTrigger||{},A={type:"date",defaultTo:Gl};return r===!0?t.createAt=A:r&&(t[r]=A),n===!0?t.updateAt={...A,notNull:0}:n&&(t[n]={...A,notNull:0}),{columns:t,...e}}function Kl(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function Po(t){return Array.isArray(t)?t:[t]}function ff(t){return typeof t=="function"}async function Hi(t,e){await t.schema.dropTable(e).execute()}async function Ka(t,e,r){const{index:n,...A}=r;await t.transaction().execute(async U=>{const te=await Fo(U,e,A);await Yl(U,e,te),await Xl(U,e,n)})}async function Xl(t,e,r){for(const n of r||[]){const A=Po(n);await t.schema.createIndex(`idx_${e}_${A.join("_")}`).on(e).columns(A).ifNotExists().execute()}}async function Fo(t,e,{columns:r,primary:n,timeTrigger:A,unique:U},te=!1){const Ae=A?{triggerKey:"rowid",update:void 0}:void 0;let Le=!1,tt=t.schema.createTable(e);te&&(tt=tt.temporary());for(const[nt,Ce]of Object.entries(r)){let $e="text";const{type:sn,notNull:Nn,defaultTo:Gt}=Ce,vn=Kl(sn);$e=vn.dataType,tt=tt.addColumn(nt,$e,we=>vn.isIncrements?(Le=!0,Ae&&(Ae.triggerKey=nt),we.autoIncrement().primaryKey()):Gt===Gl?(Ae&&Nn===0&&(Ae.update=nt),we.defaultTo(lt`CURRENT_TIMESTAMP`)):(Nn===!0&&(we=we.notNull()),Gt!==void 0&&(we=we.defaultTo(ff(Gt)?Gt(lt):Gt)),we))}if(!Le&&n){const nt=Po(n);tt=tt.addPrimaryKeyConstraint(`pk#${nt.join("#")}`,nt)}for(const nt of U||[]){const Ce=Po(nt);tt=tt.addUniqueConstraint(`un#${Ce.join("#")}`,Ce)}return await tt.ifNotExists().execute(),Ae}async function Yl(t,e,r){if(!r||!r.update)return;const{triggerKey:n,update:A}=r,U=`tgr_${e}_${A}`;await lt`create trigger if not exists ${lt.ref(U)}
after update
on ${lt.table(e)}
begin
  update ${lt.table(e)}
  set ${lt.ref(A)} = CURRENT_TIMESTAMP
  where ${lt.ref(n)} = NEW.${lt.ref(n)};
end`.execute(t)}function hf(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/gi,[,n,A]=t.replace(/\r?\n/g,"").match(e),U={columns:{},name:n,primary:void 0,unique:[]},te=A.matchAll(r);for(const Ae of te){const[,Le,tt,nt]=Ae;if(Le.startsWith("pk#")){const[,...Ce]=Le.split("#");U.primary=Ce}else if(Le.startsWith("un#")){const[,...Ce]=Le.split("#");U.unique.push(Ce)}else U.columns[Le]={type:tt,notNull:!!nt}}return U}async function pf(t,e=[]){const r=await t.selectFrom("sqlite_master").where("type","in",["table","trigger","index"]).where("name","!=",zl).where("name","!=",Vl).where("name","not like","sqlite_%").$if(!!e.length,A=>A.where(U=>U.and(e.map(te=>U("name","not like",`${te}%`))))).select(["name","sql","type"]).$castTo().execute(),n={existTables:{},indexList:[],triggerList:[]};for(const{name:A,sql:U,type:te}of r)U&&(te==="table"?n.existTables[A]=hf(U):te==="index"?n.indexList.push(A):n.triggerList.push(A));return n}async function _f(t,e,r={},n){const{reserveOldData:A,truncateIfExists:U=[],log:te,version:{current:Ae,skipSyncWhenSame:Le}={},excludeTablePrefix:tt,afterUpdate:nt}=r;if(Ae){if(Le&&Ae===await Ga(t))return;await Ga(t,Ae)}const Ce=we=>te&&n?.debug(we),{existTables:$e,indexList:sn,triggerList:Nn}=await pf(t,tt);Ce("====== update tables start ======");const Gt=new Set(Array.isArray(U)?U:U?Object.keys($e):[]);for(const we of sn)await t.schema.dropIndex(we).ifExists().execute();for(const we of Nn)await lt`drop trigger if exists ${lt.ref(we)}`.execute(t);for(const[we,mt]of Object.entries($e))we in e?(Ce(`diff table: ${we}`),await vn(we,mt,e[we])):(Ce(`remove table: ${we}`),await Hi(t,we));for(const[we,mt]of Object.entries(e))we in $e||(Ce(`create table: ${we}`),await Ka(t,we,mt));Ce("======= after update hook ======="),await nt?.(t),Ce("======= update tables end =======");async function vn(we,mt,on){if(Gt.has(we)){await t.transaction().execute(async yt=>{await Hi(yt,we),await Ka(yt,we,on),Ce("clear and sync structure")});return}const{index:Kt,...Bi}=on,jn=mf(mt.columns,on.columns);if(jn.length===Object.keys(mt.columns).length){Ce("same table structure, skip");return}Ce("different table structure, update"),await t.transaction().execute(async yt=>{const Mt=`_temp_${we}`;await Fo(yt,Mt,mt,!0),await yt.insertInto(Mt).expression(xn=>xn.selectFrom(we).selectAll()).execute(),await Hi(yt,we);const io=await Fo(yt,we,Bi);jn.length&&await yt.insertInto(we).columns(jn).expression(xn=>xn.selectFrom(Mt).select(jn)).execute(),await Xl(yt,we,Kt),await Yl(yt,we,io),!A&&await Hi(yt,Mt)}).then(()=>Ce(`restore columns: ${jn}`)).catch(yt=>n?.error(`fail to sync ${we}`,yt))}}function mf(t,e){const r=[];for(const[n,A]of Object.entries(e))if(n in t){const{type:U,notNull:te=!1}=t[n];Kl(A.type).dataType===U&&(A.notNull||!1)===te&&r.push(n)}return r}function yf(t,e={}){const{log:r}=e;return async(n,A)=>{await _f(n,t,e,r?A:void 0)}}const gf={test:df({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function wf(t){const e=new uf({dialect:t}),r=await e.updateTableSchema(yf(gf));if(!r.ready)throw r.error;console.log(await e.raw("PRAGMA table_info('test')"));for(let n=0;n<10;n++)await e.transaction(async()=>{await e.transaction(async()=>{if(n>8)throw console.log("test rollback"),new Error("test rollback");await e.execute(A=>A.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}))})});return e.execute(n=>n.selectFrom("test").selectAll()).then(async n=>(await e.destroy(),console.log(n),n))}const bf=new Vd({database:async()=>{const t=(await Hd()).oo1;if(!t)return Promise.reject("fail to load sqlite");const e="/test.db";return t.OpfsDb?(console.log("support OPFS"),new t.OpfsDb(e)):(console.log("doesn't support OPFS"),new t.DB(e))}});onmessage=()=>{console.log("start official wasm test"),wf(bf).then(t=>{t?.forEach(e=>console.log("[official wasm]",e))})};
