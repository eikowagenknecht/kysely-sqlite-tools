var H=Object.defineProperty;var z=(c,r,f)=>r in c?H(c,r,{enumerable:!0,configurable:!0,writable:!0,value:f}):c[r]=f;var P=(c,r,f)=>(z(c,typeof r!="symbol"?r+"":r,f),f);var L=0,tn=5,T=10,K=12,G=14,v=21,R=25,W=27,x=100,X=101,en=3850,rn=522,j=1,J=2,Y=4,sn=8,cn=256,on=2048,an=16384,un=524288,fn=0,ln=1,_n=2,mn=3,wn=4,bn=512,pn=1024,En=2048,yn=16384,U=1,B=2,k=3,D=4,C=5,gn=class{constructor(){P(this,"mxPathName",64)}xClose(c){return T}xRead(c,r,f){return T}xWrite(c,r,f){return T}xTruncate(c,r){return T}xSync(c,r){return L}xFileSize(c,r){return T}xLock(c,r){return L}xUnlock(c,r){return L}xCheckReservedLock(c,r){return r.setInt32(0,0,!0),L}xFileControl(c,r,f){return K}xSectorSize(c){return 512}xDeviceCharacteristics(c){return 0}xOpen(c,r,f,b){return G}xDelete(c,r){return T}xAccess(c,r,f){return T}handleAsync(c){return c()}},F=0x7fffffffffffffffn,d=-0x8000000000000000n,I=class extends Error{constructor(c,r){super(c),this.code=r}},A=!0;function Z(c){const r={},f=c._getSqliteFree(),b=c._malloc(8),p=[b,b+4];function _(e){if(typeof e!="string")return 0;const t=c.lengthBytesUTF8(e),n=c._sqlite3_malloc(t+1);return c.stringToUTF8(e,n,t+1),n}function y(e,t){return BigInt(t)<<32n|BigInt(e)&0xffffffffn}const S=function(){const e=BigInt(Number.MAX_SAFE_INTEGER)>>32n,t=BigInt(Number.MIN_SAFE_INTEGER)>>32n;return function(n,s){return s>e||s<t?y(n,s):s*4294967296+(n&2147483647)-(n&2147483648)}}(),h=new Set;function g(e){if(!h.has(e))throw new I("not a database",v)}const w=new Map;function u(e){if(!w.has(e))throw new I("not a statement",v)}r.bind_collection=function(e,t){u(e);const n=Array.isArray(t),s=r.bind_parameter_count(e);for(let o=1;o<=s;++o){const i=n?o-1:r.bind_parameter_name(e,o),l=t[i];l!==void 0&&r.bind(e,o,l)}return L},r.bind=function(e,t,n){switch(u(e),typeof n){case"number":return n===(n|0)?r.bind_int(e,t,n):r.bind_double(e,t,n);case"string":return r.bind_text(e,t,n);default:return n instanceof Uint8Array||Array.isArray(n)?r.bind_blob(e,t,n):n===null?r.bind_null(e,t):typeof n=="bigint"?r.bind_int64(e,t,n):n===void 0?W:(console.warn("unknown binding converted to null",n),r.bind_null(e,t))}},r.bind_blob=function(){const e="sqlite3_bind_blob",t=c.cwrap(e,...a("nnnnn:n"));return function(n,s,o){u(n);const i=o.byteLength??o.length,l=c._sqlite3_malloc(i);c.HEAPU8.subarray(l).set(o);const q=t(n,s,l,i,f);return m(e,q,w.get(n))}}(),r.bind_parameter_count=function(){const t=c.cwrap("sqlite3_bind_parameter_count",...a("n:n"));return function(n){return u(n),t(n)}}(),r.bind_double=function(){const e="sqlite3_bind_double",t=c.cwrap(e,...a("nnn:n"));return function(n,s,o){u(n);const i=t(n,s,o);return m(e,i,w.get(n))}}(),r.bind_int=function(){const e="sqlite3_bind_int",t=c.cwrap(e,...a("nnn:n"));return function(n,s,o){if(u(n),o>2147483647||o<-2147483648)return R;const i=t(n,s,o);return m(e,i,w.get(n))}}(),r.bind_int64=function(){const e="sqlite3_bind_int64",t=c.cwrap(e,...a("nnnn:n"));return function(n,s,o){if(u(n),o>F||o<d)return R;const i=o&0xffffffffn,l=o>>32n,q=t(n,s,Number(i),Number(l));return m(e,q,w.get(n))}}(),r.bind_null=function(){const e="sqlite3_bind_null",t=c.cwrap(e,...a("nn:n"));return function(n,s){u(n);const o=t(n,s);return m(e,o,w.get(n))}}(),r.bind_parameter_name=function(){const t=c.cwrap("sqlite3_bind_parameter_name",...a("n:s"));return function(n,s){return u(n),t(n,s)}}(),r.bind_text=function(){const e="sqlite3_bind_text",t=c.cwrap(e,...a("nnnnn:n"));return function(n,s,o){u(n);const i=_(o),l=t(n,s,i,-1,f);return m(e,l,w.get(n))}}(),r.changes=function(){const t=c.cwrap("sqlite3_changes",...a("n:n"));return function(n){return g(n),t(n)}}(),r.close=function(){const e="sqlite3_close",t=c.cwrap(e,...a("n:n"),{async:A});return async function(n){g(n);const s=await t(n);return h.delete(n),m(e,s,n)}}(),r.column=function(e,t){u(e);const n=r.column_type(e,t);switch(n){case D:return r.column_blob(e,t);case B:return r.column_double(e,t);case U:const s=r.column_int(e,t),o=c.getTempRet0();return S(s,o);case C:return null;case k:return r.column_text(e,t);default:throw new I("unknown type",n)}},r.column_blob=function(){const t=c.cwrap("sqlite3_column_blob",...a("nn:n"));return function(n,s){u(n);const o=r.column_bytes(n,s),i=t(n,s);return c.HEAPU8.subarray(i,i+o)}}(),r.column_bytes=function(){const t=c.cwrap("sqlite3_column_bytes",...a("nn:n"));return function(n,s){return u(n),t(n,s)}}(),r.column_count=function(){const t=c.cwrap("sqlite3_column_count",...a("n:n"));return function(n){return u(n),t(n)}}(),r.column_double=function(){const t=c.cwrap("sqlite3_column_double",...a("nn:n"));return function(n,s){return u(n),t(n,s)}}(),r.column_int=function(){const t=c.cwrap("sqlite3_column_int64",...a("nn:n"));return function(n,s){return u(n),t(n,s)}}(),r.column_int64=function(){const t=c.cwrap("sqlite3_column_int64",...a("nn:n"));return function(n,s){u(n);const o=t(n,s),i=c.getTempRet0();return y(o,i)}}(),r.column_name=function(){const t=c.cwrap("sqlite3_column_name",...a("nn:s"));return function(n,s){return u(n),t(n,s)}}(),r.column_names=function(e){const t=[],n=r.column_count(e);for(let s=0;s<n;++s)t.push(r.column_name(e,s));return t},r.column_text=function(){const t=c.cwrap("sqlite3_column_text",...a("nn:s"));return function(n,s){return u(n),t(n,s)}}(),r.column_type=function(){const t=c.cwrap("sqlite3_column_type",...a("nn:n"));return function(n,s){return u(n),t(n,s)}}(),r.create_function=function(e,t,n,s,o,i,l,q){if(g(e),i&&!l&&!q){const Q=c.createFunction(e,t,n,s,o,i);return m("sqlite3_create_function",Q,e)}if(!i&&l&&q){const Q=c.createAggregate(e,t,n,s,o,l,q);return m("sqlite3_create_function",Q,e)}throw new I("invalid function combination",v)},r.create_module=function(e,t,n,s){g(e);const o=c.createModule(e,t,n,s);return m("sqlite3_create_module",o,e)},r.data_count=function(){const t=c.cwrap("sqlite3_data_count",...a("n:n"));return function(n){return u(n),t(n)}}(),r.declare_vtab=function(){const t=c.cwrap("sqlite3_declare_vtab",...a("ns:n"));return function(n,s){const o=t(n,s);return m("sqlite3_declare_vtab",o)}}(),r.exec=async function(e,t,n){for await(const s of r.statements(e,t)){let o;for(;await r.step(s)===x;)if(n){o=o??r.column_names(s);const i=r.row(s);await n(i,o)}}return L},r.finalize=function(){const t=c.cwrap("sqlite3_finalize",...a("n:n"),{async:A});return async function(n){if(!w.has(n))return v;const s=await t(n);return w.get(n),w.delete(n),s}}(),r.get_autocommit=function(){const t=c.cwrap("sqlite3_get_autocommit",...a("n:n"));return function(n){return t(n)}}(),r.libversion=function(){const t=c.cwrap("sqlite3_libversion",...a(":s"));return function(){return t()}}(),r.libversion_number=function(){const t=c.cwrap("sqlite3_libversion_number",...a(":n"));return function(){return t()}}(),r.limit=function(){const t=c.cwrap("sqlite3_limit",...a("nnn:n"));return function(n,s,o){return t(n,s,o)}}(),r.open_v2=function(){const e="sqlite3_open_v2",t=c.cwrap(e,...a("snnn:n"),{async:A});return async function(n,s,o){s=s||Y|J,o=_(o);const i=await t(n,p[0],s,o),l=c.getValue(p[0],"*");return h.add(l),c._sqlite3_free(o),c.ccall("RegisterExtensionFunctions","void",["number"],[l]),m(e,i),l}}(),r.prepare_v2=function(){const e="sqlite3_prepare_v2",t=c.cwrap(e,...a("nnnnn:n"),{async:A});return async function(n,s){const o=await t(n,s,-1,p[0],p[1]);m(e,o,n);const i=c.getValue(p[0],"*");return i?(w.set(i,n),{stmt:i,sql:c.getValue(p[1],"*")}):null}}(),r.progress_handler=function(e,t,n,s){g(e),c.progressHandler(e,t,n,s)},r.reset=function(){const e="sqlite3_reset",t=c.cwrap(e,...a("n:n"),{async:A});return async function(n){u(n);const s=await t(n);return m(e,s,w.get(n))}}(),r.result=function(e,t){switch(typeof t){case"number":t===(t|0)?r.result_int(e,t):r.result_double(e,t);break;case"string":r.result_text(e,t);break;default:if(t instanceof Uint8Array||Array.isArray(t))r.result_blob(e,t);else if(t===null)r.result_null(e);else{if(typeof t=="bigint")return r.result_int64(e,t);console.warn("unknown result converted to null",t),r.result_null(e)}break}},r.result_blob=function(){const t=c.cwrap("sqlite3_result_blob",...a("nnnn:n"));return function(n,s){const o=s.byteLength??s.length,i=c._sqlite3_malloc(o);c.HEAPU8.subarray(i).set(s),t(n,i,o,f)}}(),r.result_double=function(){const t=c.cwrap("sqlite3_result_double",...a("nn:n"));return function(n,s){t(n,s)}}(),r.result_int=function(){const t=c.cwrap("sqlite3_result_int",...a("nn:n"));return function(n,s){t(n,s)}}(),r.result_int64=function(){const t=c.cwrap("sqlite3_result_int64",...a("nnn:n"));return function(n,s){if(s>F||s<d)return R;const o=s&0xffffffffn,i=s>>32n;t(n,Number(o),Number(i))}}(),r.result_null=function(){const t=c.cwrap("sqlite3_result_null",...a("n:n"));return function(n){t(n)}}(),r.result_text=function(){const t=c.cwrap("sqlite3_result_text",...a("nnnn:n"));return function(n,s){const o=_(s);t(n,o,-1,f)}}(),r.row=function(e){const t=[],n=r.data_count(e);for(let s=0;s<n;++s){const o=r.column(e,s);t.push(o?.buffer===c.HEAPU8.buffer?o.slice():o)}return t},r.set_authorizer=function(e,t,n){g(e);const s=c.setAuthorizer(e,t,n);return m("sqlite3_set_authorizer",s,e)},r.sql=function(){const t=c.cwrap("sqlite3_sql",...a("n:s"));return function(n){return u(n),t(n)}}(),r.statements=function(e,t){return async function*(){const n=r.str_new(e,t);let s={stmt:null,sql:r.str_value(n)};try{for(;s=await r.prepare_v2(e,s.sql);)yield s.stmt,r.finalize(s.stmt),s.stmt=null}finally{s?.stmt&&r.finalize(s.stmt),r.str_finish(n)}}()},r.step=function(){const e="sqlite3_step",t=c.cwrap(e,...a("n:n"),{async:A});return async function(n){u(n);const s=await t(n);return m(e,s,w.get(n),[x,X])}}();let N=0;const E=new Map;r.str_new=function(e,t=""){const n=c.lengthBytesUTF8(t),s=N++&4294967295,o={offset:c._sqlite3_malloc(n+1),bytes:n};return E.set(s,o),c.stringToUTF8(t,o.offset,o.bytes+1),s},r.str_appendall=function(e,t){if(!E.has(e))throw new I("not a string",v);const n=E.get(e),s=c.lengthBytesUTF8(t),o=n.bytes+s,i=c._sqlite3_malloc(o+1);c.HEAPU8.subarray(i,i+o+1).set(c.HEAPU8.subarray(n.offset,n.offset+n.bytes)),c.stringToUTF8(t,i+n.bytes,s+1),c._sqlite3_free(n.offset),n.offset=i,n.bytes=o,E.set(e,n)},r.str_finish=function(e){if(!E.has(e))throw new I("not a string",v);const t=E.get(e);E.delete(e),c._sqlite3_free(t.offset)},r.str_value=function(e){if(!E.has(e))throw new I("not a string",v);return E.get(e).offset},r.user_data=function(e){return c.getFunctionUserData(e)},r.value=function(e){const t=r.value_type(e);switch(t){case D:return r.value_blob(e);case B:return r.value_double(e);case U:const n=r.value_int(e),s=c.getTempRet0();return S(n,s);case C:return null;case k:return r.value_text(e);default:throw new I("unknown type",t)}},r.value_blob=function(){const t=c.cwrap("sqlite3_value_blob",...a("n:n"));return function(n){const s=r.value_bytes(n),o=t(n);return c.HEAPU8.subarray(o,o+s)}}(),r.value_bytes=function(){const t=c.cwrap("sqlite3_value_bytes",...a("n:n"));return function(n){return t(n)}}(),r.value_double=function(){const t=c.cwrap("sqlite3_value_double",...a("n:n"));return function(n){return t(n)}}(),r.value_int=function(){const t=c.cwrap("sqlite3_value_int64",...a("n:n"));return function(n){return t(n)}}(),r.value_int64=function(){const t=c.cwrap("sqlite3_value_int64",...a("n:n"));return function(n){const s=t(n),o=c.getTempRet0();return y(s,o)}}(),r.value_text=function(){const t=c.cwrap("sqlite3_value_text",...a("n:s"));return function(n){return t(n)}}(),r.value_type=function(){const t=c.cwrap("sqlite3_value_type",...a("n:n"));return function(n){return t(n)}}(),r.vfs_register=function(e,t){const n=c.registerVFS(e,t);return m("sqlite3_vfs_register",n)};function m(e,t,n=null,s=[L]){if(s.includes(t))return t;const o=n?c.ccall("sqlite3_errmsg","string",["number"],[n]):e;throw new I(o,t)}return r}function a(c){const r=[],f=c.match(/([ns@]*):([nsv@])/);switch(f[2]){case"n":r.push("number");break;case"s":r.push("string");break;case"v":r.push(null);break}const b=[];for(let p of f[1])switch(p){case"n":b.push("number");break;case"s":b.push("string");break}return r.push(b),r}async function $(c,r){const{path:f,sqliteModule:b,vfs:p}=await c,_=Z(b);_.vfs_register(p,!0);const y=await _.open_v2(f,r?j:void 0);return{path:f,vfs:p,db:y,sqlite:_,async close(){await _.close(y)},changes(){return _.changes(y)},async lastInsertRowId(){return await new Promise(S=>_.exec(y,"SELECT last_insert_rowid()",([h])=>S(h)))},async run(S,h){const g=_.str_new(y,S);try{const w=await _.prepare_v2(y,_.str_value(g));if(!w)return[];const u=w.stmt;try{h?.length&&_.bind_collection(u,h);const N=[],E=_.column_names(u);for(;await _.step(u)===x;){const m=_.row(u);N.push(Object.fromEntries(E.map((e,t)=>[e,m[t]])))}return N}finally{await _.finalize(u)}}finally{_.str_finish(g)}}}}var O;async function V(c,r,f){O=await $((f?(await import("./opfs-7XQEASTB-Dhara68B.js")).useOpfsStorage:(await import("./idb-CBTKSDRJ-snVFWzU2.js")).useIdbStorage)(r,{url:c}))}async function M(c,r,f){const b=await O.run(r,f);return c||b.length?{rows:b}:{rows:b,insertId:BigInt(await O.lastInsertRowId()),numAffectedRows:BigInt(O.changes())}}onmessage=async({data:c})=>{const r=[c[0],null,null];try{switch(c[0]){case 0:await V(c[1],c[2],c[3]);break;case 1:r[1]=await M(c[1],c[2],c[3]);break;case 2:await O.close();break}}catch(f){r[2]=f}postMessage(r)};export{gn as B,Y as S,L as a,G as b,sn as c,rn as d,T as e,En as f,cn as g,on as h,an as i,un as j,j as k,ln as l,yn as m,bn as n,pn as o,K as p,fn as q,tn as r,en as s,_n as t,wn as u,mn as v};
