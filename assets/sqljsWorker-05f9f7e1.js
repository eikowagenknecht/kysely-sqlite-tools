var zl=Object.defineProperty;var Kl=($,L,ce)=>L in $?zl($,L,{enumerable:!0,configurable:!0,writable:!0,value:ce}):$[L]=ce;var B=($,L,ce)=>(Kl($,typeof L!="symbol"?L+"":L,ce),ce),Io=($,L,ce)=>{if(!L.has($))throw TypeError("Cannot "+ce)};var i=($,L,ce)=>(Io($,L,"read from private field"),ce?ce.call($):L.get($)),N=($,L,ce)=>{if(L.has($))throw TypeError("Cannot add the same private member more than once");L instanceof WeakSet?L.add($):L.set($,ce)},g=($,L,ce,hi)=>(Io($,L,"write to private field"),hi?hi.call($,ce):L.set($,ce),ce);var V=($,L,ce)=>(Io($,L,"access private method"),ce);(function(){var et,nr,Lr,H,Si,tt,D,q,I,Pr,zn,Br,sr,or,Kn,Tu,Hn,Su,Yn,Eu,ar,un,Ai,To,Xn,Au,Di,Y,Ri,Mr,Fr,hr,_i,So,b,Qr,Ur,Mt,Jr,Ft,cr,lr,Be,jr,$r,Gr,zr,ct,Kr,Qt,Li,Eo,Hr,Yr,Ut,G,dr,xt,Pi,rt,qe,fe,X,oe,z,Me,Q,be,ke,Ie,ss,re,ge,Fe,Qe,we,Xr,dt,ft,Ot,it,Vt,qt,mr,Ui,os,Du,as,Ru,us,_u,hs,Lu,Ji,Ao,Vi,jt,cs,Pu,$t,yr,xe,nt,Nr,st,De,ti,Is,ji,Do,$i,Ro,ri,Gt,ds,ii,wr,ni,fs,Bu,Gi,_a,zi,La;"use strict";function $(t){return typeof t>"u"||t===void 0}function L(t){return typeof t=="string"}function ce(t){return typeof t=="number"}function hi(t){return typeof t=="boolean"}function _o(t){return t===null}function Mu(t){return t instanceof Date}function Fu(t){return typeof t=="bigint"}function Ve(t){return typeof t=="function"}function at(t){return typeof t=="object"&&t!==null}function a(t){return Object.freeze(t)}function ci(t){return Array.isArray(t)}function Wr(t){return t}const le=a({is(t){return t.kind==="AlterTableNode"},create(t){return a({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return a({...t,...e})},cloneWithColumnAlteration(t,e){return a({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),te=a({is(t){return t.kind==="IdentifierNode"},create(t){return a({kind:"IdentifierNode",name:t})}}),At=a({is(t){return t.kind==="CreateIndexNode"},create(t){return a({kind:"CreateIndexNode",name:te.create(t)})},cloneWith(t,e){return a({...t,...e})},cloneWithColumns(t,e){return a({...t,columns:[...t.columns||[],...e]})}}),Lo=a({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return a({kind:"CreateSchemaNode",schema:te.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Qu=["preserve rows","delete rows","drop"],Ye=a({is(t){return t.kind==="CreateTableNode"},create(t){return a({kind:"CreateTableNode",table:t,columns:a([])})},cloneWithColumn(t,e){return a({...t,columns:a([...t.columns,e])})},cloneWithConstraint(t,e){return a({...t,constraints:t.constraints?a([...t.constraints,e]):a([e])})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWith(t,e){return a({...t,...e})}}),Dt=a({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return a({kind:"SchemableIdentifierNode",identifier:te.create(t)})},createWithSchema(t,e){return a({kind:"SchemableIdentifierNode",schema:te.create(t),identifier:te.create(e)})}}),hn=a({is(t){return t.kind==="DropIndexNode"},create(t,e){return a({kind:"DropIndexNode",name:Dt.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Ts=a({is(t){return t.kind==="DropSchemaNode"},create(t,e){return a({kind:"DropSchemaNode",schema:te.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Ss=a({is(t){return t.kind==="DropTableNode"},create(t,e){return a({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return a({...t,...e})}}),Rt=a({is(t){return t.kind==="AliasNode"},create(t,e){return a({kind:"AliasNode",node:t,alias:e})}}),_t=a({is(t){return t.kind==="TableNode"},create(t){return a({kind:"TableNode",table:Dt.create(t)})},createWithSchema(t,e){return a({kind:"TableNode",table:Dt.createWithSchema(t,e)})}});function je(t){return at(t)&&Ve(t.toOperationNode)}function Es(t){return at(t)&&"expressionType"in t&&je(t)}function Uu(t){return at(t)&&"expression"in t&&L(t.alias)&&je(t)}const Nt=a({is(t){return t.kind==="SelectModifierNode"},create(t){return a({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return a({kind:"SelectModifierNode",rawModifier:t})}}),tr=a({is(t){return t.kind==="AndNode"},create(t,e){return a({kind:"AndNode",left:t,right:e})}}),rr=a({is(t){return t.kind==="OrNode"},create(t,e){return a({kind:"OrNode",left:t,right:e})}}),As=a({is(t){return t.kind==="OnNode"},create(t){return a({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return a({...t,on:e==="And"?tr.create(t.on,r):rr.create(t.on,r)})}}),li=a({is(t){return t.kind==="JoinNode"},create(t,e){return a({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return a({kind:"JoinNode",joinType:t,table:e,on:As.create(r)})},cloneWithOn(t,e){return a({...t,on:t.on?As.cloneWithOperation(t.on,"And",e):As.create(e)})}}),Ds=a({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return a({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),Po=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp"],Ju=["+","-","*","/","%","^","&","|","#","<<",">>"],Bo=["->","->>"],Mo=[...Po,...Ju,"&&","||"],Vu=["not","-",...["exists","not exists"]],ju=[...Mo,...Bo,...Vu],di=a({is(t){return t.kind==="OperatorNode"},create(t){return a({kind:"OperatorNode",operator:t})}});function $u(t){return L(t)&&Mo.includes(t)}function Gu(t){return L(t)&&Po.includes(t)}function Fo(t){return L(t)&&Bo.includes(t)}const ie=a({is(t){return t.kind==="ColumnNode"},create(t){return a({kind:"ColumnNode",column:te.create(t)})}}),Rs=a({is(t){return t.kind==="SelectAllNode"},create(){return a({kind:"SelectAllNode"})}}),cn=a({is(t){return t.kind==="ReferenceNode"},create(t,e){return a({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return a({kind:"ReferenceNode",table:t,column:Rs.create()})}}),zu=a({is(t){return t.kind==="OrderByItemNode"},create(t,e){return a({kind:"OrderByItemNode",orderBy:t,direction:e})}}),Ce=a({is(t){return t.kind==="RawNode"},create(t,e){return a({kind:"RawNode",sqlFragments:a(t),parameters:a(e)})},createWithSql(t){return Ce.create([t],[])},createWithChild(t){return Ce.create(["",""],[t])},createWithChildren(t){return Ce.create(new Array(t.length+1).fill(""),t)}});function Ku(t){return t==="asc"||t==="desc"}function ln(t,e){return zu.create(Hu(t),Yu(e))}function Hu(t){return wt(t)}function Yu(t){if(t)return t==="asc"||t==="desc"?Ce.createWithSql(t):t.toOperationNode()}const _s=a({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return a({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return a({...t,traversal:e})}}),Qo=a({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return a({kind:"JSONOperatorChainNode",operator:t,values:a([])})},cloneWithValue(t,e){return a({...t,values:a([...t.values,e])})}}),Ls=a({is(t){return t.kind==="JSONPathNode"},create(t){return a({kind:"JSONPathNode",inOperator:t,pathLegs:a([])})},cloneWithLeg(t,e){return a({...t,pathLegs:a([...t.pathLegs,e])})}});function Uo(t){return L(t)?ir(t):t.toOperationNode()}function fi(t){return ci(t)?t.map(e=>wt(e)):[wt(t)]}function wt(t){return Wn(t)?Cn(t):Uo(t)}function Xu(t,e){const r=ir(t);if(Fo(e))return _s.create(r,Qo.create(di.create(e)));const u=e.slice(0,-1);if(Fo(u))return _s.create(r,Ls.create(di.create(u)));throw new Error(`Invalid JSON operator: ${e}`)}function ir(t){const e=".";if(!t.includes(e))return cn.create(ie.create(t));const r=t.split(e).map(Ps);if(r.length===3)return eh(r);if(r.length===2)return th(r);throw new Error(`invalid column reference ${t}`)}function Zu(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(Ps);return Rt.create(ir(r),te.create(u))}else return ir(t)}function Jo(t){return ie.create(t)}function Vo(t){const e=" ";if(t.includes(e)){const[r,u]=t.split(e).map(Ps);if(!Ku(u))throw new Error(`invalid order direction "${u}" next to "${r}"`);return ln(r,u)}else return Jo(t)}function eh(t){const[e,r,u]=t;return cn.create(ie.create(u),_t.createWithSchema(e,r))}function th(t){const[e,r]=t;return cn.create(ie.create(r),_t.create(e))}function Ps(t){return t.trim()}const jo=a({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return a({kind:"PrimitiveValueListNode",values:a([...t])})}}),Bs=a({is(t){return t.kind==="ValueListNode"},create(t){return a({kind:"ValueListNode",values:a(t)})}}),Xe=a({is(t){return t.kind==="ValueNode"},create(t){return a({kind:"ValueNode",value:t})},createImmediate(t){return a({kind:"ValueNode",value:t,immediate:!0})}});function $o(t){return ci(t)?rh(t):vt(t)}function vt(t){return Wn(t)?Cn(t):Xe.create(t)}function rh(t){return t.some(Wn)?Bs.create(t.map(e=>vt(e))):jo.create(t)}function We(t){if(t.length>1&&!Ko(t[1]))throw new Error(`invalid comparison operator ${JSON.stringify(t[1])}`);return Go(t)}function Go(t){if(t.length===3)return dn(t[0],t[1],t[2]);if(t.length===1)return ah(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function dn(t,e,r){if(!zo(e))throw new Error(`invalid binary operator ${JSON.stringify(e)}`);return nh(e)&&sh(r)?oh(t,e,r):Ds.create(wt(t),Ms(e),$o(r))}function bt(t,e,r){if(!Ko(e))throw new Error(`invalid comparison operator ${JSON.stringify(e)}`);return ih(t,e,r)}function ih(t,e,r){if(!zo(e))throw new Error(`invalid binary operator ${JSON.stringify(e)}`);return Ds.create(wt(t),Ms(e),wt(r))}function zo(t){return $u(t)||Es(t)}function Ko(t){return Gu(t)||Es(t)}function nh(t){return t==="is"||t==="is not"}function sh(t){return _o(t)||hi(t)}function oh(t,e,r){return Ds.create(wt(t),Ms(e),Xe.createImmediate(r))}function Ms(t){if(L(t)&&ju.includes(t))return di.create(t);if(je(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function ah(t){return Ve(t)?t(Ks()).toOperationNode():je(t)?t.toOperationNode():Xe.create(t)}const kr=a({is(t){return t.kind==="OrderByNode"},create(t){return a({kind:"OrderByNode",items:a([t])})},cloneWithItem(t,e){return a({...t,items:a([...t.items,e])})}}),Ho=a({is(t){return t.kind==="PartitionByNode"},create(t){return a({kind:"PartitionByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),Fs=a({is(t){return t.kind==="OverNode"},create(){return a({kind:"OverNode"})},cloneWithOrderByItem(t,e){return a({...t,orderBy:t.orderBy?kr.cloneWithItem(t.orderBy,e):kr.create(e)})},cloneWithPartitionByItems(t,e){return a({...t,partitionBy:t.partitionBy?Ho.cloneWithItems(t.partitionBy,e):Ho.create(e)})}}),fn=a({is(t){return t.kind==="FromNode"},create(t){return a({kind:"FromNode",froms:a(t)})},cloneWithFroms(t,e){return a({...t,froms:a([...t.froms,...e])})}}),Yo=a({is(t){return t.kind==="GroupByNode"},create(t){return a({kind:"GroupByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),Xo=a({is(t){return t.kind==="HavingNode"},create(t){return a({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return a({...t,having:e==="And"?tr.create(t.having,r):rr.create(t.having,r)})}}),M=a({is(t){return t.kind==="SelectQueryNode"},create(t,e){return a({kind:"SelectQueryNode",from:fn.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})},cloneWithDistinctOn(t,e){return a({...t,distinctOn:t.distinctOn?a([...t.distinctOn,...e]):a(e)})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWithOrderByItem(t,e){return a({...t,orderBy:t.orderBy?kr.cloneWithItem(t.orderBy,e):kr.create(e)})},cloneWithGroupByItems(t,e){return a({...t,groupBy:t.groupBy?Yo.cloneWithItems(t.groupBy,e):Yo.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithOffset(t,e){return a({...t,offset:e})},cloneWithHaving(t,e){return a({...t,having:t.having?Xo.cloneWithOperation(t.having,"And",e):Xo.create(e)})},cloneWithSetOperation(t,e){return a({...t,setOperations:t.setOperations?a([...t.setOperations,e]):a([e])})},cloneWithoutSelections(t){return a({...t,selections:[]})},cloneWithoutLimit(t){return a({...t,limit:void 0})},cloneWithoutOffset(t){return a({...t,offset:void 0})},cloneWithoutOrderBy(t){return a({...t,orderBy:void 0})}});function F(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}const Ti=class Ti{constructor(e){N(this,et,void 0);g(this,et,a(e))}on(...e){return new Ti({...i(this,et),joinNode:li.cloneWithOn(i(this,et).joinNode,We(e))})}onRef(e,r,u){return new Ti({...i(this,et),joinNode:li.cloneWithOn(i(this,et).joinNode,bt(e,r,u))})}onTrue(){return new Ti({...i(this,et),joinNode:li.cloneWithOn(i(this,et).joinNode,Ce.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return i(this,et).joinNode}};et=new WeakMap;let pn=Ti;F(pn,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const uh=a({is(t){return t.kind==="PartitionByItemNode"},create(t){return a({kind:"PartitionByItemNode",partitionBy:t})}});function hh(t){return fi(t).map(uh.create)}const Gn=class Gn{constructor(e){N(this,nr,void 0);g(this,nr,a(e))}orderBy(e,r){return new Gn({overNode:Fs.cloneWithOrderByItem(i(this,nr).overNode,ln(e,r))})}partitionBy(e){return new Gn({overNode:Fs.cloneWithPartitionByItems(i(this,nr).overNode,hh(e))})}$call(e){return e(this)}toOperationNode(){return i(this,nr).overNode}};nr=new WeakMap;let mn=Gn;F(mn,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const pi=a({is(t){return t.kind==="SelectionNode"},create(t){return a({kind:"SelectionNode",selection:t})},createSelectAll(){return a({kind:"SelectionNode",selection:Rs.create()})},createSelectAllFromTable(t){return a({kind:"SelectionNode",selection:cn.createSelectAll(t)})}});class ch{constructor(e){N(this,Lr,void 0);g(this,Lr,e)}get dynamicReference(){return i(this,Lr)}get refType(){}toOperationNode(){return Uo(i(this,Lr))}}Lr=new WeakMap;function lh(t){return at(t)&&je(t)&&L(t.dynamicReference)}function mi(t){return Ve(t)?mi(t(Ar())):ci(t)?t.map(e=>Zo(e)):[Zo(t)]}function Zo(t){return L(t)?pi.create(Zu(t)):lh(t)?pi.create(t.toOperationNode()):pi.create(ma(t))}function yi(t){return t?Array.isArray(t)?t.map(ea):[ea(t)]:[pi.createSelectAll()]}function ea(t){if(L(t))return pi.createSelectAllFromTable(Ae(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const dh=a({is(t){return t.kind==="ValuesNode"},create(t){return a({kind:"ValuesNode",values:a(t)})}}),fh=a({is(t){return t.kind==="DefaultInsertValueNode"},create(){return a({kind:"DefaultInsertValueNode"})}});function ph(t){const e=Ve(t)?t(Ar()):t,r=ci(e)?e:a([e]);return mh(r)}function mh(t){const e=yh(t);return[a([...e.keys()].map(ie.create)),dh.create(t.map(r=>Nh(r,e)))]}function yh(t){const e=new Map;for(const r of t){const u=Object.keys(r);for(const d of u)!e.has(d)&&r[d]!==void 0&&e.set(d,e.size)}return e}function Nh(t,e){const r=Object.keys(t),u=Array.from({length:e.size});let d=!1;for(const x of r){const W=e.get(x);if($(W))continue;const j=t[x];($(j)||Wn(j))&&(d=!0),u[W]=j}if(r.length<e.size||d){const x=fh.create();return Bs.create(u.map(W=>$(W)?x:vt(W)))}return jo.create(u)}const ut=a({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return a({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return a({...t,...e})}}),yn=a({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return a({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return a({...t,from:t.from?fn.cloneWithFroms(t.from,e):fn.create(e)})},cloneWithUpdates(t,e){return a({...t,updates:t.updates?a([...t.updates,...e]):e})}}),ta=a({is(t){return t.kind==="UsingNode"},create(t){return a({kind:"UsingNode",tables:a(t)})},cloneWithTables(t,e){return a({...t,tables:a([...t.tables,...e])})}}),Ni=a({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return a({kind:"DeleteQueryNode",from:fn.create(t),...e&&{with:e}})},cloneWithOrderByItem(t,e){return a({...t,orderBy:t.orderBy?kr.cloneWithItem(t.orderBy,e):kr.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithUsing(t,e){return a({...t,using:t.using!==void 0?ta.cloneWithTables(t.using,e):ta.create(e)})}}),Se=a({is(t){return t.kind==="WhereNode"},create(t){return a({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return a({...t,where:e==="And"?tr.create(t.where,r):rr.create(t.where,r)})}}),ra=a({is(t){return t.kind==="ReturningNode"},create(t){return a({kind:"ReturningNode",selections:a(t)})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})}}),wh=a({is(t){return t.kind==="ExplainNode"},create(t,e){return a({kind:"ExplainNode",format:t,options:e})}}),_=a({is(t){return M.is(t)||ut.is(t)||yn.is(t)||Ni.is(t)},cloneWithWhere(t,e){return a({...t,where:t.where?Se.cloneWithOperation(t.where,"And",e):Se.create(e)})},cloneWithJoin(t,e){return a({...t,joins:t.joins?a([...t.joins,e]):a([e])})},cloneWithReturning(t,e){return a({...t,returning:t.returning?ra.cloneWithSelections(t.returning,e):ra.create(e)})},cloneWithoutWhere(t){return a({...t,where:void 0})},cloneWithExplain(t,e,r){return a({...t,explain:wh.create(e,r==null?void 0:r.toOperationNode())})}}),vh=a({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return a({kind:"ColumnUpdateNode",column:t,value:e})}});function Qs(t){const e=Ve(t)?t(Ar()):t;return Object.entries(e).filter(([r,u])=>u!==void 0).map(([r,u])=>vh.create(ie.create(r),vt(u)))}const bh=a({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return a({kind:"OnDuplicateKeyNode",updates:t})}});class gh{constructor(e,r){B(this,"insertId");B(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class Nn extends Error{constructor(r){super("no result");B(this,"node");this.node=r}}function wn(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Le=a({is(t){return t.kind==="OnConflictNode"},create(){return a({kind:"OnConflictNode"})},cloneWith(t,e){return a({...t,...e})},cloneWithIndexWhere(t,e){return a({...t,indexWhere:t.indexWhere?Se.cloneWithOperation(t.indexWhere,"And",e):Se.create(e)})},cloneWithIndexOrWhere(t,e){return a({...t,indexWhere:t.indexWhere?Se.cloneWithOperation(t.indexWhere,"Or",e):Se.create(e)})},cloneWithUpdateWhere(t,e){return a({...t,updateWhere:t.updateWhere?Se.cloneWithOperation(t.updateWhere,"And",e):Se.create(e)})},cloneWithUpdateOrWhere(t,e){return a({...t,updateWhere:t.updateWhere?Se.cloneWithOperation(t.updateWhere,"Or",e):Se.create(e)})},cloneWithoutIndexWhere(t){return a({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return a({...t,updateWhere:void 0})}}),gt=class gt{constructor(e){N(this,H,void 0);g(this,H,a(e))}column(e){const r=ie.create(e);return new gt({...i(this,H),onConflictNode:Le.cloneWith(i(this,H).onConflictNode,{columns:i(this,H).onConflictNode.columns?a([...i(this,H).onConflictNode.columns,r]):a([r])})})}columns(e){const r=e.map(ie.create);return new gt({...i(this,H),onConflictNode:Le.cloneWith(i(this,H).onConflictNode,{columns:i(this,H).onConflictNode.columns?a([...i(this,H).onConflictNode.columns,...r]):a(r)})})}constraint(e){return new gt({...i(this,H),onConflictNode:Le.cloneWith(i(this,H).onConflictNode,{constraint:te.create(e)})})}expression(e){return new gt({...i(this,H),onConflictNode:Le.cloneWith(i(this,H).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new gt({...i(this,H),onConflictNode:Le.cloneWithIndexWhere(i(this,H).onConflictNode,We(e))})}whereRef(e,r,u){return new gt({...i(this,H),onConflictNode:Le.cloneWithIndexWhere(i(this,H).onConflictNode,bt(e,r,u))})}clearWhere(){return new gt({...i(this,H),onConflictNode:Le.cloneWithoutIndexWhere(i(this,H).onConflictNode)})}doNothing(){return new ia({...i(this,H),onConflictNode:Le.cloneWith(i(this,H).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new bn({...i(this,H),onConflictNode:Le.cloneWith(i(this,H).onConflictNode,{updates:Qs(e)})})}$call(e){return e(this)}};H=new WeakMap;let vn=gt;F(vn,"don't await OnConflictBuilder instances.");class ia{constructor(e){N(this,Si,void 0);g(this,Si,a(e))}toOperationNode(){return i(this,Si).onConflictNode}}Si=new WeakMap,F(ia,"don't await OnConflictDoNothingBuilder instances.");const Ei=class Ei{constructor(e){N(this,tt,void 0);g(this,tt,a(e))}where(...e){return new Ei({...i(this,tt),onConflictNode:Le.cloneWithUpdateWhere(i(this,tt).onConflictNode,We(e))})}whereRef(e,r,u){return new Ei({...i(this,tt),onConflictNode:Le.cloneWithUpdateWhere(i(this,tt).onConflictNode,bt(e,r,u))})}clearWhere(){return new Ei({...i(this,tt),onConflictNode:Le.cloneWithoutUpdateWhere(i(this,tt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return i(this,tt).onConflictNode}};tt=new WeakMap;let bn=Ei;F(bn,"don't await OnConflictUpdateBuilder instances.");const Oe=class Oe{constructor(e){N(this,D,void 0);g(this,D,a(e))}values(e){const[r,u]=ph(e);return new Oe({...i(this,D),queryNode:ut.cloneWith(i(this,D).queryNode,{columns:r,values:u})})}columns(e){return new Oe({...i(this,D),queryNode:ut.cloneWith(i(this,D).queryNode,{columns:a(e.map(ie.create))})})}expression(e){return new Oe({...i(this,D),queryNode:ut.cloneWith(i(this,D).queryNode,{values:Cn(e)})})}ignore(){return new Oe({...i(this,D),queryNode:ut.cloneWith(i(this,D).queryNode,{ignore:!0})})}onConflict(e){return new Oe({...i(this,D),queryNode:ut.cloneWith(i(this,D).queryNode,{onConflict:e(new vn({onConflictNode:Le.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Oe({...i(this,D),queryNode:ut.cloneWith(i(this,D).queryNode,{onDuplicateKey:bh.create(Qs(e))})})}returning(e){return new Oe({...i(this,D),queryNode:_.cloneWithReturning(i(this,D).queryNode,mi(e))})}returningAll(){return new Oe({...i(this,D),queryNode:_.cloneWithReturning(i(this,D).queryNode,yi())})}$call(e){return e(this)}$if(e,r){return e?r(this):new Oe({...i(this,D)})}$castTo(){return new Oe(i(this,D))}$narrowType(){return new Oe(i(this,D))}$assertType(){return new Oe(i(this,D))}withPlugin(e){return new Oe({...i(this,D),executor:i(this,D).executor.withPlugin(e)})}toOperationNode(){return i(this,D).executor.transformQuery(i(this,D).queryNode,i(this,D).queryId)}compile(){return i(this,D).executor.compileQuery(this.toOperationNode(),i(this,D).queryId)}async execute(){const e=this.compile(),r=e.query,u=await i(this,D).executor.executeQuery(e,i(this,D).queryId);return i(this,D).executor.adapter.supportsReturning&&r.returning?u.rows:[new gh(u.insertId,u.numAffectedRows??u.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Nn){const r=await this.executeTakeFirst();if(r===void 0)throw wn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,D).executor.stream(r,e,i(this,D).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new Oe({...i(this,D),queryNode:_.cloneWithExplain(i(this,D).queryNode,e,r)}).execute()}};D=new WeakMap;let wi=Oe;F(wi,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class xh{constructor(e){B(this,"numDeletedRows");this.numDeletedRows=e}}const na=a({is(t){return t.kind==="LimitNode"},create(t){return a({kind:"LimitNode",limit:Xe.create(t)})}}),de=class de{constructor(e){N(this,q,void 0);g(this,q,a(e))}where(...e){return new de({...i(this,q),queryNode:_.cloneWithWhere(i(this,q).queryNode,We(e))})}whereRef(e,r,u){return new de({...i(this,q),queryNode:_.cloneWithWhere(i(this,q).queryNode,bt(e,r,u))})}clearWhere(){return new de({...i(this,q),queryNode:_.cloneWithoutWhere(i(this,q).queryNode)})}using(e){return new de({...i(this,q),queryNode:Ni.cloneWithUsing(i(this,q).queryNode,xi(e))})}innerJoin(...e){return new de({...i(this,q),queryNode:_.cloneWithJoin(i(this,q).queryNode,Ee("InnerJoin",e))})}leftJoin(...e){return new de({...i(this,q),queryNode:_.cloneWithJoin(i(this,q).queryNode,Ee("LeftJoin",e))})}rightJoin(...e){return new de({...i(this,q),queryNode:_.cloneWithJoin(i(this,q).queryNode,Ee("RightJoin",e))})}fullJoin(...e){return new de({...i(this,q),queryNode:_.cloneWithJoin(i(this,q).queryNode,Ee("FullJoin",e))})}returning(e){return new de({...i(this,q),queryNode:_.cloneWithReturning(i(this,q).queryNode,mi(e))})}returningAll(e){return new de({...i(this,q),queryNode:_.cloneWithReturning(i(this,q).queryNode,yi(e))})}orderBy(e,r){return new de({...i(this,q),queryNode:Ni.cloneWithOrderByItem(i(this,q).queryNode,ln(e,r))})}limit(e){return new de({...i(this,q),queryNode:Ni.cloneWithLimit(i(this,q).queryNode,na.create(e))})}$call(e){return e(this)}$if(e,r){return e?r(this):new de({...i(this,q)})}$castTo(){return new de(i(this,q))}$narrowType(){return new de(i(this,q))}$assertType(){return new de(i(this,q))}withPlugin(e){return new de({...i(this,q),executor:i(this,q).executor.withPlugin(e)})}toOperationNode(){return i(this,q).executor.transformQuery(i(this,q).queryNode,i(this,q).queryId)}compile(){return i(this,q).executor.compileQuery(this.toOperationNode(),i(this,q).queryId)}async execute(){const e=this.compile(),r=e.query,u=await i(this,q).executor.executeQuery(e,i(this,q).queryId);return i(this,q).executor.adapter.supportsReturning&&r.returning?u.rows:[new xh(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Nn){const r=await this.executeTakeFirst();if(r===void 0)throw wn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,q).executor.stream(r,e,i(this,q).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new de({...i(this,q),queryNode:_.cloneWithExplain(i(this,q).queryNode,e,r)}).execute()}};q=new WeakMap;let gn=de;F(gn,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Oh{constructor(e,r){B(this,"numUpdatedRows");B(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}const me=class me{constructor(e){N(this,I,void 0);g(this,I,a(e))}where(...e){return new me({...i(this,I),queryNode:_.cloneWithWhere(i(this,I).queryNode,We(e))})}whereRef(e,r,u){return new me({...i(this,I),queryNode:_.cloneWithWhere(i(this,I).queryNode,bt(e,r,u))})}clearWhere(){return new me({...i(this,I),queryNode:_.cloneWithoutWhere(i(this,I).queryNode)})}from(e){return new me({...i(this,I),queryNode:yn.cloneWithFromItems(i(this,I).queryNode,xi(e))})}innerJoin(...e){return new me({...i(this,I),queryNode:_.cloneWithJoin(i(this,I).queryNode,Ee("InnerJoin",e))})}leftJoin(...e){return new me({...i(this,I),queryNode:_.cloneWithJoin(i(this,I).queryNode,Ee("LeftJoin",e))})}rightJoin(...e){return new me({...i(this,I),queryNode:_.cloneWithJoin(i(this,I).queryNode,Ee("RightJoin",e))})}fullJoin(...e){return new me({...i(this,I),queryNode:_.cloneWithJoin(i(this,I).queryNode,Ee("FullJoin",e))})}set(e){return new me({...i(this,I),queryNode:yn.cloneWithUpdates(i(this,I).queryNode,Qs(e))})}returning(e){return new me({...i(this,I),queryNode:_.cloneWithReturning(i(this,I).queryNode,mi(e))})}returningAll(){return new me({...i(this,I),queryNode:_.cloneWithReturning(i(this,I).queryNode,yi())})}$call(e){return e(this)}$if(e,r){return e?r(this):new me({...i(this,I)})}$castTo(){return new me(i(this,I))}$narrowType(){return new me(i(this,I))}$assertType(){return new me(i(this,I))}withPlugin(e){return new me({...i(this,I),executor:i(this,I).executor.withPlugin(e)})}toOperationNode(){return i(this,I).executor.transformQuery(i(this,I).queryNode,i(this,I).queryId)}compile(){return i(this,I).executor.compileQuery(this.toOperationNode(),i(this,I).queryId)}async execute(){const e=this.compile(),r=e.query,u=await i(this,I).executor.executeQuery(e,i(this,I).queryId);return i(this,I).executor.adapter.supportsReturning&&r.returning?u.rows:[new Oh(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0),u.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Nn){const r=await this.executeTakeFirst();if(r===void 0)throw wn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,I).executor.stream(r,e,i(this,I).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new me({...i(this,I),queryNode:_.cloneWithExplain(i(this,I).queryNode,e,r)}).execute()}};I=new WeakMap;let xn=me;F(xn,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const qh=a({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return a({kind:"CommonTableExpressionNode",name:t,expression:e})}}),sa=a({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return a({kind:"CommonTableExpressionNameNode",table:_t.create(t),columns:e?a(e.map(ie.create)):void 0})}});function oa(t,e){const r=e(Rh());return qh.create(Ch(t),r.toOperationNode())}function Ch(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],u=e[1].split(",").map(d=>d.trim());return sa.create(r,u)}else return sa.create(t)}const On=a({is(t){return t.kind==="WithNode"},create(t,e){return a({kind:"WithNode",expressions:a([t]),...e})},cloneWithExpression(t,e){return a({...t,expressions:a([...t.expressions,e])})}}),aa=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Wh(t){let e="";for(let r=0;r<t;++r)e+=kh();return e}function kh(){return aa[~~(Math.random()*aa.length)]}function K(){return new Ih}class Ih{constructor(){N(this,Pr,void 0)}get queryId(){return i(this,Pr)===void 0&&g(this,Pr,Wh(8)),i(this,Pr)}}Pr=new WeakMap;function Yl(t){return t}class Us{constructor(){B(this,"nodeStack",[]);N(this,zn,a({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),a(r)}transformNodeImpl(e){return i(this,zn)[e.kind](e)}transformNodeList(e){return e&&a(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:a([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}zn=new WeakMap;const Th=a({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});class Sh extends Us{constructor(r){super();N(this,Kn);N(this,Hn);N(this,Yn);N(this,ar);N(this,Ai);N(this,Xn);N(this,Br,void 0);N(this,sr,new Set);N(this,or,new Set);g(this,Br,r)}transformNodeImpl(r){if(!V(this,Kn,Tu).call(this,r))return super.transformNodeImpl(r);const u=V(this,Yn,Eu).call(this,r);for(const x of u)i(this,or).add(x);const d=V(this,Hn,Su).call(this,r);for(const x of d)i(this,sr).add(x);const v=super.transformNodeImpl(r);for(const x of d)i(this,sr).delete(x);for(const x of u)i(this,or).delete(x);return v}transformSchemableIdentifier(r){const u=super.transformSchemableIdentifier(r);return u.schema||!i(this,sr).has(r.identifier.name)?u:{...u,schema:te.create(i(this,Br))}}transformReferences(r){const u=super.transformReferences(r);return u.table.table.schema?u:{...u,table:_t.createWithSchema(i(this,Br),u.table.table.identifier.name)}}}Br=new WeakMap,sr=new WeakMap,or=new WeakMap,Kn=new WeakSet,Tu=function(r){return r.kind in Th},Hn=new WeakSet,Su=function(r){const u=new Set;if("name"in r&&r.name&&Dt.is(r.name)&&V(this,Ai,To).call(this,r.name,u),"from"in r&&r.from)for(const d of r.from.froms)V(this,ar,un).call(this,d,u);if("into"in r&&r.into&&V(this,ar,un).call(this,r.into,u),"table"in r&&r.table&&V(this,ar,un).call(this,r.table,u),"joins"in r&&r.joins)for(const d of r.joins)V(this,ar,un).call(this,d.table,u);return u},Yn=new WeakSet,Eu=function(r){const u=new Set;return"with"in r&&r.with&&V(this,Xn,Au).call(this,r.with,u),u},ar=new WeakSet,un=function(r,u){const d=_t.is(r)?r:Rt.is(r)&&_t.is(r.node)?r.node:null;d&&V(this,Ai,To).call(this,d.table,u)},Ai=new WeakSet,To=function(r,u){const d=r.identifier.name;!i(this,sr).has(d)&&!i(this,or).has(d)&&u.add(d)},Xn=new WeakSet,Au=function(r,u){for(const d of r.expressions){const v=d.name.table.table.identifier.name;i(this,or).has(v)||u.add(v)}};class vi{constructor(e){N(this,Di,void 0);g(this,Di,new Sh(e))}transformQuery(e){return i(this,Di).transformNode(e.node)}async transformResult(e){return e.result}}Di=new WeakMap;const ur=class ur{constructor(e){N(this,Y,void 0);g(this,Y,a(e))}selectFrom(e){return new bi({queryId:K(),executor:i(this,Y).executor,queryNode:M.create(xi(e),i(this,Y).withNode)})}insertInto(e){return new wi({queryId:K(),executor:i(this,Y).executor,queryNode:ut.create(Ae(e),i(this,Y).withNode)})}replaceInto(e){return new wi({queryId:K(),executor:i(this,Y).executor,queryNode:ut.create(Ae(e),i(this,Y).withNode,!0)})}deleteFrom(e){return new gn({queryId:K(),executor:i(this,Y).executor,queryNode:Ni.create(xi(e),i(this,Y).withNode)})}updateTable(e){return new xn({queryId:K(),executor:i(this,Y).executor,queryNode:yn.create(Oi(e),i(this,Y).withNode)})}with(e,r){const u=oa(e,r);return new ur({...i(this,Y),withNode:i(this,Y).withNode?On.cloneWithExpression(i(this,Y).withNode,u):On.create(u)})}withRecursive(e,r){const u=oa(e,r);return new ur({...i(this,Y),withNode:i(this,Y).withNode?On.cloneWithExpression(i(this,Y).withNode,u):On.create(u,{recursive:!0})})}withPlugin(e){return new ur({...i(this,Y),executor:i(this,Y).executor.withPlugin(e)})}withoutPlugins(){return new ur({...i(this,Y),executor:i(this,Y).executor.withoutPlugins()})}withSchema(e){return new ur({...i(this,Y),executor:i(this,Y).executor.withPluginAtFront(new vi(e))})}};Y=new WeakMap;let qn=ur;class ua{constructor(){N(this,Ri,void 0);N(this,Mr,void 0);N(this,Fr,void 0);B(this,"resolve",e=>{i(this,Mr)&&i(this,Mr).call(this,e)});B(this,"reject",e=>{i(this,Fr)&&i(this,Fr).call(this,e)});g(this,Ri,new Promise((e,r)=>{g(this,Fr,r),g(this,Mr,e)}))}get promise(){return i(this,Ri)}}Ri=new WeakMap,Mr=new WeakMap,Fr=new WeakMap;const ha=new Set;function Eh(t){ha.has(t)||(ha.add(t),console.log(t))}const Ah=a([]);class ca{constructor(e=Ah){N(this,_i);N(this,hr,void 0);g(this,hr,e)}get plugins(){return i(this,hr)}transformQuery(e,r){for(const u of i(this,hr)){const d=u.transformQuery({node:e,queryId:r});if(d.kind===e.kind)e=d;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${d.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async u=>{const d=await u.executeQuery(e),v=await V(this,_i,So).call(this,d,r);return Dh(d,v),v})}async*stream(e,r,u){const d=new ua,v=new ua;this.provideConnection(async W=>(d.resolve(W),await v.promise)).catch(W=>d.reject(W));const x=await d.promise;try{for await(const W of x.streamQuery(e,r))yield await V(this,_i,So).call(this,W,u)}finally{v.resolve()}}}hr=new WeakMap,_i=new WeakSet,So=async function(e,r){for(const u of i(this,hr))e=await u.transformResult({result:e,queryId:r});return e};function Dh(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Eh("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class Ir extends ca{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new Ir([...this.plugins,e])}withPlugins(e){return new Ir([...this.plugins,...e])}withPluginAtFront(e){return new Ir([e,...this.plugins])}withoutPlugins(){return new Ir([])}}const Js=new Ir;function Rh(){return new qn({executor:Js})}function _h(t,e){return new pn({joinNode:li.create(t,Oi(e))})}function Lh(){return new mn({overNode:Fs.create()})}function Ee(t,e){if(e.length===3)return Bh(t,e[0],e[1],e[2]);if(e.length===2)return Ph(t,e[0],e[1]);throw new Error("not implemented")}function Ph(t,e,r){return r(_h(t,e)).toOperationNode()}function Bh(t,e,r,u){return li.createWithOn(t,Oi(e),bt(r,"=",u))}const Mh=a({is(t){return t.kind==="OffsetNode"},create(t){return a({kind:"OffsetNode",offset:Xe.create(t)})}}),Fh=a({is(t){return t.kind==="GroupByItemNode"},create(t){return a({kind:"GroupByItemNode",groupBy:t})}});function Qh(t){return t=Ve(t)?t(Ar()):t,fi(t).map(Fh.create)}const la=a({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return a({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function Tr(t,e,r){return la.create(t,e.toOperationNode(),r)}const C=class C{constructor(e){N(this,b,void 0);g(this,b,a(e))}get expressionType(){}where(...e){return new C({...i(this,b),queryNode:_.cloneWithWhere(i(this,b).queryNode,We(e))})}whereRef(e,r,u){return new C({...i(this,b),queryNode:_.cloneWithWhere(i(this,b).queryNode,bt(e,r,u))})}having(...e){return new C({...i(this,b),queryNode:M.cloneWithHaving(i(this,b).queryNode,We(e))})}havingRef(e,r,u){return new C({...i(this,b),queryNode:M.cloneWithHaving(i(this,b).queryNode,bt(e,r,u))})}select(e){return new C({...i(this,b),queryNode:M.cloneWithSelections(i(this,b).queryNode,mi(e))})}distinctOn(e){return new C({...i(this,b),queryNode:M.cloneWithDistinctOn(i(this,b).queryNode,fi(e))})}modifyFront(e){return new C({...i(this,b),queryNode:M.cloneWithFrontModifier(i(this,b).queryNode,Nt.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.createWithExpression(e.toOperationNode()))})}distinct(){return new C({...i(this,b),queryNode:M.cloneWithFrontModifier(i(this,b).queryNode,Nt.create("Distinct"))})}forUpdate(){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.create("ForUpdate"))})}forShare(){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.create("ForShare"))})}forKeyShare(){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.create("ForKeyShare"))})}forNoKeyUpdate(){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.create("ForNoKeyUpdate"))})}skipLocked(){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.create("SkipLocked"))})}noWait(){return new C({...i(this,b),queryNode:M.cloneWithEndModifier(i(this,b).queryNode,Nt.create("NoWait"))})}selectAll(e){return new C({...i(this,b),queryNode:M.cloneWithSelections(i(this,b).queryNode,yi(e))})}innerJoin(...e){return new C({...i(this,b),queryNode:_.cloneWithJoin(i(this,b).queryNode,Ee("InnerJoin",e))})}leftJoin(...e){return new C({...i(this,b),queryNode:_.cloneWithJoin(i(this,b).queryNode,Ee("LeftJoin",e))})}rightJoin(...e){return new C({...i(this,b),queryNode:_.cloneWithJoin(i(this,b).queryNode,Ee("RightJoin",e))})}fullJoin(...e){return new C({...i(this,b),queryNode:_.cloneWithJoin(i(this,b).queryNode,Ee("FullJoin",e))})}innerJoinLateral(...e){return new C({...i(this,b),queryNode:_.cloneWithJoin(i(this,b).queryNode,Ee("LateralInnerJoin",e))})}leftJoinLateral(...e){return new C({...i(this,b),queryNode:_.cloneWithJoin(i(this,b).queryNode,Ee("LateralLeftJoin",e))})}orderBy(e,r){return new C({...i(this,b),queryNode:M.cloneWithOrderByItem(i(this,b).queryNode,ln(e,r))})}groupBy(e){return new C({...i(this,b),queryNode:M.cloneWithGroupByItems(i(this,b).queryNode,Qh(e))})}limit(e){return new C({...i(this,b),queryNode:M.cloneWithLimit(i(this,b).queryNode,na.create(e))})}offset(e){return new C({...i(this,b),queryNode:M.cloneWithOffset(i(this,b).queryNode,Mh.create(e))})}union(e){return new C({...i(this,b),queryNode:M.cloneWithSetOperation(i(this,b).queryNode,Tr("union",e,!1))})}unionAll(e){return new C({...i(this,b),queryNode:M.cloneWithSetOperation(i(this,b).queryNode,Tr("union",e,!0))})}intersect(e){return new C({...i(this,b),queryNode:M.cloneWithSetOperation(i(this,b).queryNode,Tr("intersect",e,!1))})}intersectAll(e){return new C({...i(this,b),queryNode:M.cloneWithSetOperation(i(this,b).queryNode,Tr("intersect",e,!0))})}except(e){return new C({...i(this,b),queryNode:M.cloneWithSetOperation(i(this,b).queryNode,Tr("except",e,!1))})}exceptAll(e){return new C({...i(this,b),queryNode:M.cloneWithSetOperation(i(this,b).queryNode,Tr("except",e,!0))})}as(e){return new Uh(this,e)}clearSelect(){return new C({...i(this,b),queryNode:M.cloneWithoutSelections(i(this,b).queryNode)})}clearWhere(){return new C({...i(this,b),queryNode:_.cloneWithoutWhere(i(this,b).queryNode)})}clearLimit(){return new C({...i(this,b),queryNode:M.cloneWithoutLimit(i(this,b).queryNode)})}clearOffset(){return new C({...i(this,b),queryNode:M.cloneWithoutOffset(i(this,b).queryNode)})}clearOrderBy(){return new C({...i(this,b),queryNode:M.cloneWithoutOrderBy(i(this,b).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new C({...i(this,b)})}$castTo(){return new C(i(this,b))}$narrowType(){return new C(i(this,b))}$assertType(){return new C(i(this,b))}withPlugin(e){return new C({...i(this,b),executor:i(this,b).executor.withPlugin(e)})}toOperationNode(){return i(this,b).executor.transformQuery(i(this,b).queryNode,i(this,b).queryId)}compile(){return i(this,b).executor.compileQuery(this.toOperationNode(),i(this,b).queryId)}async execute(){const e=this.compile();return(await i(this,b).executor.executeQuery(e,i(this,b).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Nn){const r=await this.executeTakeFirst();if(r===void 0)throw wn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=i(this,b).executor.stream(r,e,i(this,b).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new C({...i(this,b),queryNode:_.cloneWithExplain(i(this,b).queryNode,e,r)}).execute()}};b=new WeakMap;let bi=C;F(bi,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Uh{constructor(e,r){N(this,Qr,void 0);N(this,Ur,void 0);g(this,Qr,e),g(this,Ur,r)}get expression(){return i(this,Qr)}get alias(){return i(this,Ur)}toOperationNode(){return Rt.create(i(this,Qr).toOperationNode(),te.create(i(this,Ur)))}}Qr=new WeakMap,Ur=new WeakMap;const Sr=a({is(t){return t.kind==="ParensNode"},create(t){return a({kind:"ParensNode",node:t})}}),ro=class ro{constructor(e){N(this,Mt,void 0);g(this,Mt,e)}get expressionType(){}as(e){return new Vs(this,e)}or(...e){return new js(rr.create(i(this,Mt),We(e)))}and(...e){return new $s(tr.create(i(this,Mt),We(e)))}$castTo(){return new ro(i(this,Mt))}toOperationNode(){return i(this,Mt)}};Mt=new WeakMap;let ne=ro;class Vs{constructor(e,r){N(this,Jr,void 0);N(this,Ft,void 0);g(this,Jr,e),g(this,Ft,r)}get expression(){return i(this,Jr)}get alias(){return i(this,Ft)}toOperationNode(){return Rt.create(i(this,Jr).toOperationNode(),je(i(this,Ft))?i(this,Ft).toOperationNode():te.create(i(this,Ft)))}}Jr=new WeakMap,Ft=new WeakMap;const Zn=class Zn{constructor(e){N(this,cr,void 0);g(this,cr,e)}get expressionType(){}as(e){return new Vs(this,e)}or(...e){return new Zn(rr.create(i(this,cr),We(e)))}$castTo(){return new Zn(i(this,cr))}toOperationNode(){return Sr.create(i(this,cr))}};cr=new WeakMap;let js=Zn;const es=class es{constructor(e){N(this,lr,void 0);g(this,lr,e)}get expressionType(){}as(e){return new Vs(this,e)}and(...e){return new es(tr.create(i(this,lr),We(e)))}$castTo(){return new es(i(this,lr))}toOperationNode(){return Sr.create(i(this,lr))}};lr=new WeakMap;let $s=es;const Er=a({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return a({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return a({...t,distinct:!0})},cloneWithFilter(t,e){return a({...t,filter:t.filter?Se.cloneWithOperation(t.filter,"And",e):Se.create(e)})},cloneWithOrFilter(t,e){return a({...t,filter:t.filter?Se.cloneWithOperation(t.filter,"Or",e):Se.create(e)})},cloneWithOver(t,e){return a({...t,over:e})}}),Jh=a({is(t){return t.kind==="FunctionNode"},create(t,e){return a({kind:"FunctionNode",func:t,arguments:e})}}),Vr=class Vr{constructor(e){N(this,Be,void 0);g(this,Be,a(e))}get expressionType(){}as(e){return new Vh(this,e)}distinct(){return new Vr({...i(this,Be),aggregateFunctionNode:Er.cloneWithDistinct(i(this,Be).aggregateFunctionNode)})}filterWhere(...e){return new Vr({...i(this,Be),aggregateFunctionNode:Er.cloneWithFilter(i(this,Be).aggregateFunctionNode,We(e))})}filterWhereRef(e,r,u){return new Vr({...i(this,Be),aggregateFunctionNode:Er.cloneWithFilter(i(this,Be).aggregateFunctionNode,bt(e,r,u))})}over(e){const r=Lh();return new Vr({...i(this,Be),aggregateFunctionNode:Er.cloneWithOver(i(this,Be).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return i(this,Be).aggregateFunctionNode}};Be=new WeakMap;let gi=Vr;F(gi,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Vh{constructor(e,r){N(this,jr,void 0);N(this,$r,void 0);g(this,jr,e),g(this,$r,r)}get expression(){return i(this,jr)}get alias(){return i(this,$r)}toOperationNode(){return Rt.create(i(this,jr).toOperationNode(),te.create(i(this,$r)))}}jr=new WeakMap,$r=new WeakMap;function da(){const t=(r,u)=>new ne(Jh.create(r,fi(u))),e=(r,u)=>new gi({aggregateFunctionNode:Er.create(r,u?fi(u):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(r,...u){return t("coalesce",[r,...u])},count(r){return e("count",[r])},countAll(r){return new gi({aggregateFunctionNode:Er.create("count",yi(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])}})}const jh=a({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return a({kind:"UnaryOperationNode",operator:t,operand:e})}});function $h(t,e){return jh.create(di.create(t),wt(e))}const Gs=a({is(t){return t.kind==="WhenNode"},create(t){return a({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return a({...t,result:e})}}),ht=a({is(t){return t.kind==="CaseNode"},create(t){return a({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return a({...t,when:a(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return a({...t,when:t.when?a([...t.when.slice(0,-1),Gs.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return a({...t,...e})}});class fa{constructor(e){N(this,Gr,void 0);g(this,Gr,a(e))}when(...e){return new pa({...i(this,Gr),node:ht.cloneWithWhen(i(this,Gr).node,Gs.create(We(e)))})}}Gr=new WeakMap;class pa{constructor(e){N(this,zr,void 0);g(this,zr,a(e))}then(e){return new Gh({...i(this,zr),node:ht.cloneWithThen(i(this,zr).node,vt(e))})}}zr=new WeakMap;class Gh{constructor(e){N(this,ct,void 0);g(this,ct,a(e))}when(...e){return new pa({...i(this,ct),node:ht.cloneWithWhen(i(this,ct).node,Gs.create(We(e)))})}else(e){return new zh({...i(this,ct),node:ht.cloneWith(i(this,ct).node,{else:vt(e)})})}end(){return new ne(ht.cloneWith(i(this,ct).node,{isStatement:!1}))}endCase(){return new ne(ht.cloneWith(i(this,ct).node,{isStatement:!0}))}}ct=new WeakMap;class zh{constructor(e){N(this,Kr,void 0);g(this,Kr,a(e))}end(){return new ne(ht.cloneWith(i(this,Kr).node,{isStatement:!1}))}endCase(){return new ne(ht.cloneWith(i(this,Kr).node,{isStatement:!0}))}}Kr=new WeakMap;const Kh=a({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return a({kind:"JSONPathLegNode",type:t,value:e})}});class zs{constructor(e){N(this,Li);N(this,Qt,void 0);g(this,Qt,e)}at(e){return V(this,Li,Eo).call(this,"ArrayLocation",e)}key(e){return V(this,Li,Eo).call(this,"Member",e)}}Qt=new WeakMap,Li=new WeakSet,Eo=function(e,r){return new Hh(_s.cloneWithTraversal(i(this,Qt),Ls.is(i(this,Qt).traversal)?Ls.cloneWithLeg(i(this,Qt).traversal,Kh.create(e,r)):Qo.cloneWithValue(i(this,Qt).traversal,Xe.createImmediate(r))))};class Hh extends zs{constructor(r){super(r);N(this,Hr,void 0);g(this,Hr,r)}get expressionType(){}as(r){return new Yh(this,r)}$castTo(){return new zs(i(this,Hr))}toOperationNode(){return i(this,Hr)}}Hr=new WeakMap;class Yh{constructor(e,r){N(this,Yr,void 0);N(this,Ut,void 0);g(this,Yr,e),g(this,Ut,r)}get expression(){return i(this,Yr)}get alias(){return i(this,Ut)}toOperationNode(){return Rt.create(i(this,Yr).toOperationNode(),je(i(this,Ut))?i(this,Ut).toOperationNode():te.create(i(this,Ut)))}}Yr=new WeakMap,Ut=new WeakMap;function Ks(t=Js){function e(d,v,x){return new ne(dn(d,v,x))}function r(d,v){return new ne($h(d,v))}const u=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(d){return new bi({queryId:K(),executor:t,queryNode:M.create(xi(d))})},case(d){return new fa({node:ht.create($(d)?void 0:wt(d))})},ref(d,v){return $(v)?new ne(ir(d)):new zs(Xu(d,v))},val(d){return new ne($o(d))},cmpr(d,v,x){return new ne(dn(d,v,x))},bxp(d,v,x){return new ne(dn(d,v,x))},unary:r,not(d){return r("not",d)},exists(d){return r("exists",d)},neg(d){return r("-",d)},and(d){if(d.length===0)return new ne(Xe.createImmediate(!0));if(d.length===1)return new ne(d[0].toOperationNode());let v=tr.create(d[0].toOperationNode(),d[1].toOperationNode());for(let x=2;x<d.length;++x)v=tr.create(v,d[x].toOperationNode());return new ne(Sr.create(v))},or(d){if(d.length===0)return new ne(Xe.createImmediate(!1));if(d.length===1)return new ne(d[0].toOperationNode());let v=rr.create(d[0].toOperationNode(),d[1].toOperationNode());for(let x=2;x<d.length;++x)v=rr.create(v,d[x].toOperationNode());return new ne(Sr.create(v))},parens(...d){const v=Go(d);return Sr.is(v)?new ne(v):new ne(Sr.create(v))},withSchema(d){return Ks(t.withPluginAtFront(new vi(d)))}});return u.fn=da(),u.eb=u,u}function Ar(t){return Ks()}function Cn(t){if(je(t))return t.toOperationNode();if(Ve(t))return t(Ar()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function ma(t){if(je(t))return t.toOperationNode();if(Ve(t))return t(Ar()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Wn(t){return Es(t)||Uu(t)||Ve(t)}function xi(t){return ci(t)?t.map(e=>Oi(e)):[Oi(t)]}function Oi(t){return L(t)?Xh(t):ma(t)}function Xh(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(ya);return Rt.create(Ae(r),te.create(u))}else return Ae(t)}function Ae(t){const e=".";if(t.includes(e)){const[r,u]=t.split(e).map(ya);return _t.createWithSchema(r,u)}else return _t.create(t)}function ya(t){return t.trim()}const Na=a({is(t){return t.kind==="AddColumnNode"},create(t){return a({kind:"AddColumnNode",column:t})}}),se=a({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return a({kind:"ColumnDefinitionNode",column:ie.create(t),dataType:e})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):[e]})},cloneWith(t,e){return a({...t,...e})}}),wa=a({is(t){return t.kind==="DropColumnNode"},create(t){return a({kind:"DropColumnNode",column:ie.create(t)})}}),va=a({is(t){return t.kind==="RenameColumnNode"},create(t,e){return a({kind:"RenameColumnNode",column:ie.create(t),renameTo:ie.create(e)})}}),Hs=a({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return a({kind:"CheckConstraintNode",expression:t,name:e?te.create(e):void 0})}}),Zh=["no action","restrict","cascade","set null","set default"],kn=a({is(t){return t.kind==="ReferencesNode"},create(t,e){return a({kind:"ReferencesNode",table:t,columns:a([...e])})},cloneWithOnDelete(t,e){return a({...t,onDelete:e})},cloneWithOnUpdate(t,e){return a({...t,onUpdate:e})}});function ba(t){return je(t)?t.toOperationNode():Xe.createImmediate(t)}const In=a({is(t){return t.kind==="GeneratedNode"},create(t){return a({kind:"GeneratedNode",...t})},createWithExpression(t){return a({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return a({...t,...e})}}),ec=a({is(t){return t.kind==="DefaultValueNode"},create(t){return a({kind:"DefaultValueNode",defaultValue:t})}});function Tn(t){if(Zh.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}const Ne=class Ne{constructor(e){N(this,G,void 0);g(this,G,e)}autoIncrement(){return new Ne(se.cloneWith(i(this,G),{autoIncrement:!0}))}primaryKey(){return new Ne(se.cloneWith(i(this,G),{primaryKey:!0}))}references(e){const r=ir(e);if(!r.table||Rs.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new Ne(se.cloneWith(i(this,G),{references:kn.create(r.table,[r.column])}))}onDelete(e){if(!i(this,G).references)throw new Error("on delete constraint can only be added for foreign keys");return new Ne(se.cloneWith(i(this,G),{references:kn.cloneWithOnDelete(i(this,G).references,Tn(e))}))}onUpdate(e){if(!i(this,G).references)throw new Error("on update constraint can only be added for foreign keys");return new Ne(se.cloneWith(i(this,G),{references:kn.cloneWithOnUpdate(i(this,G).references,Tn(e))}))}unique(){return new Ne(se.cloneWith(i(this,G),{unique:!0}))}notNull(){return new Ne(se.cloneWith(i(this,G),{notNull:!0}))}unsigned(){return new Ne(se.cloneWith(i(this,G),{unsigned:!0}))}defaultTo(e){return new Ne(se.cloneWith(i(this,G),{defaultTo:ec.create(ba(e))}))}check(e){return new Ne(se.cloneWith(i(this,G),{check:Hs.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new Ne(se.cloneWith(i(this,G),{generated:In.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new Ne(se.cloneWith(i(this,G),{generated:In.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new Ne(se.cloneWith(i(this,G),{generated:In.create({identity:!0,byDefault:!0})}))}stored(){if(!i(this,G).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new Ne(se.cloneWith(i(this,G),{generated:In.cloneWith(i(this,G).generated,{stored:!0})}))}modifyFront(e){return new Ne(se.cloneWithFrontModifier(i(this,G),e.toOperationNode()))}modifyEnd(e){return new Ne(se.cloneWithEndModifier(i(this,G),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return i(this,G)}};G=new WeakMap;let Lt=Ne;F(Lt,"don't await ColumnDefinitionBuilder instances directly.");const ga=a({is(t){return t.kind==="ModifyColumnNode"},create(t){return a({kind:"ModifyColumnNode",column:t})}}),tc=a({is(t){return t.kind==="DataTypeNode"},create(t){return a({kind:"DataTypeNode",dataType:t})}});function Dr(t){return je(t)?t.toOperationNode():tc.create(t)}const Sn=a({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,u){return a({kind:"ForeignKeyConstraintNode",columns:t,references:kn.create(e,r),name:u?te.create(u):void 0})},cloneWith(t,e){return a({...t,...e})}}),ts=class ts{constructor(e){N(this,dr,void 0);g(this,dr,e)}onDelete(e){return new ts(Sn.cloneWith(i(this,dr),{onDelete:Tn(e)}))}onUpdate(e){return new ts(Sn.cloneWith(i(this,dr),{onUpdate:Tn(e)}))}$call(e){return e(this)}toOperationNode(){return i(this,dr)}};dr=new WeakMap;let qi=ts;F(qi,"don't await ForeignKeyConstraintBuilder instances directly.");const Ys=a({is(t){return t.kind==="AddConstraintNode"},create(t){return a({kind:"AddConstraintNode",constraint:t})}}),xa=a({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return a({kind:"UniqueConstraintNode",columns:a(t.map(ie.create)),name:e?te.create(e):void 0})}}),En=a({is(t){return t.kind==="DropConstraintNode"},create(t){return a({kind:"DropConstraintNode",constraintName:te.create(t)})},cloneWith(t,e){return a({...t,...e})}}),Ci=a({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return a({kind:"AlterColumnNode",column:ie.create(t),[e]:r})}});class Xs{constructor(e){N(this,xt,void 0);g(this,xt,e)}setDataType(e){return new Wi(Ci.create(i(this,xt),"dataType",Dr(e)))}setDefault(e){return new Wi(Ci.create(i(this,xt),"setDefault",ba(e)))}dropDefault(){return new Wi(Ci.create(i(this,xt),"dropDefault",!0))}setNotNull(){return new Wi(Ci.create(i(this,xt),"setNotNull",!0))}dropNotNull(){return new Wi(Ci.create(i(this,xt),"dropNotNull",!0))}$call(e){return e(this)}}xt=new WeakMap;class Wi{constructor(e){N(this,Pi,void 0);g(this,Pi,e)}toOperationNode(){return i(this,Pi)}}Pi=new WeakMap;class ki{constructor(e){N(this,rt,void 0);g(this,rt,a(e))}toOperationNode(){return i(this,rt).executor.transformQuery(i(this,rt).node,i(this,rt).queryId)}compile(){return i(this,rt).executor.compileQuery(this.toOperationNode(),i(this,rt).queryId)}async execute(){await i(this,rt).executor.executeQuery(this.compile(),i(this,rt).queryId)}}rt=new WeakMap,F(ki,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");const rs=class rs{constructor(e){N(this,qe,void 0);g(this,qe,a(e))}onDelete(e){return new rs({...i(this,qe),constraintBuilder:i(this,qe).constraintBuilder.onDelete(e)})}onUpdate(e){return new rs({...i(this,qe),constraintBuilder:i(this,qe).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return i(this,qe).executor.transformQuery(le.cloneWithTableProps(i(this,qe).node,{addConstraint:Ys.create(i(this,qe).constraintBuilder.toOperationNode())}),i(this,qe).queryId)}compile(){return i(this,qe).executor.compileQuery(this.toOperationNode(),i(this,qe).queryId)}async execute(){await i(this,qe).executor.executeQuery(this.compile(),i(this,qe).queryId)}};qe=new WeakMap;let An=rs;F(An,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");const Bi=class Bi{constructor(e){N(this,fe,void 0);g(this,fe,a(e))}ifExists(){return new Bi({...i(this,fe),node:le.cloneWithTableProps(i(this,fe).node,{dropConstraint:En.cloneWith(i(this,fe).node.dropConstraint,{ifExists:!0})})})}cascade(){return new Bi({...i(this,fe),node:le.cloneWithTableProps(i(this,fe).node,{dropConstraint:En.cloneWith(i(this,fe).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new Bi({...i(this,fe),node:le.cloneWithTableProps(i(this,fe).node,{dropConstraint:En.cloneWith(i(this,fe).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return i(this,fe).executor.transformQuery(i(this,fe).node,i(this,fe).queryId)}compile(){return i(this,fe).executor.compileQuery(this.toOperationNode(),i(this,fe).queryId)}async execute(){await i(this,fe).executor.executeQuery(this.compile(),i(this,fe).queryId)}};fe=new WeakMap;let Dn=Bi;F(Dn,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");class Oa{constructor(e){N(this,X,void 0);g(this,X,a(e))}renameTo(e){return new ki({...i(this,X),node:le.cloneWithTableProps(i(this,X).node,{renameTo:Ae(e)})})}setSchema(e){return new ki({...i(this,X),node:le.cloneWithTableProps(i(this,X).node,{setSchema:te.create(e)})})}alterColumn(e,r){const u=r(new Xs(e));return new Pt({...i(this,X),node:le.cloneWithColumnAlteration(i(this,X).node,u.toOperationNode())})}dropColumn(e){return new Pt({...i(this,X),node:le.cloneWithColumnAlteration(i(this,X).node,wa.create(e))})}renameColumn(e,r){return new Pt({...i(this,X),node:le.cloneWithColumnAlteration(i(this,X).node,va.create(e,r))})}addColumn(e,r,u=Wr){const d=u(new Lt(se.create(e,Dr(r))));return new Pt({...i(this,X),node:le.cloneWithColumnAlteration(i(this,X).node,Na.create(d.toOperationNode()))})}modifyColumn(e,r,u=Wr){const d=u(new Lt(se.create(e,Dr(r))));return new Pt({...i(this,X),node:le.cloneWithColumnAlteration(i(this,X).node,ga.create(d.toOperationNode()))})}addUniqueConstraint(e,r){return new ki({...i(this,X),node:le.cloneWithTableProps(i(this,X).node,{addConstraint:Ys.create(xa.create(r,e))})})}addCheckConstraint(e,r){return new ki({...i(this,X),node:le.cloneWithTableProps(i(this,X).node,{addConstraint:Ys.create(Hs.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,u,d){return new An({...i(this,X),constraintBuilder:new qi(Sn.create(r.map(ie.create),Ae(u),d.map(ie.create),e))})}dropConstraint(e){return new Dn({...i(this,X),node:le.cloneWithTableProps(i(this,X).node,{dropConstraint:En.create(e)})})}$call(e){return e(this)}}X=new WeakMap;const fr=class fr{constructor(e){N(this,oe,void 0);g(this,oe,a(e))}alterColumn(e,r){const u=r(new Xs(e));return new fr({...i(this,oe),node:le.cloneWithColumnAlteration(i(this,oe).node,u.toOperationNode())})}dropColumn(e){return new fr({...i(this,oe),node:le.cloneWithColumnAlteration(i(this,oe).node,wa.create(e))})}renameColumn(e,r){return new fr({...i(this,oe),node:le.cloneWithColumnAlteration(i(this,oe).node,va.create(e,r))})}addColumn(e,r,u=Wr){const d=u(new Lt(se.create(e,Dr(r))));return new fr({...i(this,oe),node:le.cloneWithColumnAlteration(i(this,oe).node,Na.create(d.toOperationNode()))})}modifyColumn(e,r,u=Wr){const d=u(new Lt(se.create(e,Dr(r))));return new fr({...i(this,oe),node:le.cloneWithColumnAlteration(i(this,oe).node,ga.create(d.toOperationNode()))})}toOperationNode(){return i(this,oe).executor.transformQuery(i(this,oe).node,i(this,oe).queryId)}compile(){return i(this,oe).executor.compileQuery(this.toOperationNode(),i(this,oe).queryId)}async execute(){await i(this,oe).executor.executeQuery(this.compile(),i(this,oe).queryId)}};oe=new WeakMap;let Pt=fr;F(Oa,"don't await AlterTableBuilder instances"),F(Xs,"don't await AlterColumnBuilder instances"),F(Pt,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class qa extends Us{transformValue(e){return{...super.transformValue(e),immediate:!0}}}const lt=class lt{constructor(e){N(this,z,void 0);g(this,z,a(e))}ifNotExists(){return new lt({...i(this,z),node:At.cloneWith(i(this,z).node,{ifNotExists:!0})})}unique(){return new lt({...i(this,z),node:At.cloneWith(i(this,z).node,{unique:!0})})}on(e){return new lt({...i(this,z),node:At.cloneWith(i(this,z).node,{table:Ae(e)})})}column(e){return new lt({...i(this,z),node:At.cloneWithColumns(i(this,z).node,[Vo(e)])})}columns(e){return new lt({...i(this,z),node:At.cloneWithColumns(i(this,z).node,e.map(Vo))})}expression(e){return new lt({...i(this,z),node:At.cloneWithColumns(i(this,z).node,[e.toOperationNode()])})}using(e){return new lt({...i(this,z),node:At.cloneWith(i(this,z).node,{using:Ce.createWithSql(e)})})}where(...e){const r=new qa;return new lt({...i(this,z),node:_.cloneWithWhere(i(this,z).node,r.transformNode(We(e)))})}$call(e){return e(this)}toOperationNode(){return i(this,z).executor.transformQuery(i(this,z).node,i(this,z).queryId)}compile(){return i(this,z).executor.compileQuery(this.toOperationNode(),i(this,z).queryId)}async execute(){await i(this,z).executor.executeQuery(this.compile(),i(this,z).queryId)}};z=new WeakMap;let Rn=lt;F(Rn,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");const io=class io{constructor(e){N(this,Me,void 0);g(this,Me,a(e))}ifNotExists(){return new io({...i(this,Me),node:Lo.cloneWith(i(this,Me).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Me).executor.transformQuery(i(this,Me).node,i(this,Me).queryId)}compile(){return i(this,Me).executor.compileQuery(this.toOperationNode(),i(this,Me).queryId)}async execute(){await i(this,Me).executor.executeQuery(this.compile(),i(this,Me).queryId)}};Me=new WeakMap;let _n=io;F(_n,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");const rc=a({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return a({kind:"PrimaryKeyConstraintNode",columns:a(t.map(ie.create)),name:e?te.create(e):void 0})}});function ic(t){if(Qu.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}const $e=class $e{constructor(e){N(this,Q,void 0);g(this,Q,a(e))}temporary(){return new $e({...i(this,Q),node:Ye.cloneWith(i(this,Q).node,{temporary:!0})})}onCommit(e){return new $e({...i(this,Q),node:Ye.cloneWith(i(this,Q).node,{onCommit:ic(e)})})}ifNotExists(){return new $e({...i(this,Q),node:Ye.cloneWith(i(this,Q).node,{ifNotExists:!0})})}addColumn(e,r,u=Wr){const d=u(new Lt(se.create(e,Dr(r))));return new $e({...i(this,Q),node:Ye.cloneWithColumn(i(this,Q).node,d.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new $e({...i(this,Q),node:Ye.cloneWithConstraint(i(this,Q).node,rc.create(r,e))})}addUniqueConstraint(e,r){return new $e({...i(this,Q),node:Ye.cloneWithConstraint(i(this,Q).node,xa.create(r,e))})}addCheckConstraint(e,r){return new $e({...i(this,Q),node:Ye.cloneWithConstraint(i(this,Q).node,Hs.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,u,d,v=Wr){const x=v(new qi(Sn.create(r.map(ie.create),Ae(u),d.map(ie.create),e)));return new $e({...i(this,Q),node:Ye.cloneWithConstraint(i(this,Q).node,x.toOperationNode())})}modifyFront(e){return new $e({...i(this,Q),node:Ye.cloneWithFrontModifier(i(this,Q).node,e.toOperationNode())})}modifyEnd(e){return new $e({...i(this,Q),node:Ye.cloneWithEndModifier(i(this,Q).node,e.toOperationNode())})}$call(e){return e(this)}toOperationNode(){return i(this,Q).executor.transformQuery(i(this,Q).node,i(this,Q).queryId)}compile(){return i(this,Q).executor.compileQuery(this.toOperationNode(),i(this,Q).queryId)}async execute(){await i(this,Q).executor.executeQuery(this.compile(),i(this,Q).queryId)}};Q=new WeakMap;let Ln=$e;F(Ln,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");const Mi=class Mi{constructor(e){N(this,be,void 0);g(this,be,a(e))}on(e){return new Mi({...i(this,be),node:hn.cloneWith(i(this,be).node,{table:Ae(e)})})}ifExists(){return new Mi({...i(this,be),node:hn.cloneWith(i(this,be).node,{ifExists:!0})})}cascade(){return new Mi({...i(this,be),node:hn.cloneWith(i(this,be).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,be).executor.transformQuery(i(this,be).node,i(this,be).queryId)}compile(){return i(this,be).executor.compileQuery(this.toOperationNode(),i(this,be).queryId)}async execute(){await i(this,be).executor.executeQuery(this.compile(),i(this,be).queryId)}};be=new WeakMap;let Pn=Mi;F(Pn,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");const is=class is{constructor(e){N(this,ke,void 0);g(this,ke,a(e))}ifExists(){return new is({...i(this,ke),node:Ts.cloneWith(i(this,ke).node,{ifExists:!0})})}cascade(){return new is({...i(this,ke),node:Ts.cloneWith(i(this,ke).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ke).executor.transformQuery(i(this,ke).node,i(this,ke).queryId)}compile(){return i(this,ke).executor.compileQuery(this.toOperationNode(),i(this,ke).queryId)}async execute(){await i(this,ke).executor.executeQuery(this.compile(),i(this,ke).queryId)}};ke=new WeakMap;let Bn=is;F(Bn,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");const ns=class ns{constructor(e){N(this,Ie,void 0);g(this,Ie,a(e))}ifExists(){return new ns({...i(this,Ie),node:Ss.cloneWith(i(this,Ie).node,{ifExists:!0})})}cascade(){return new ns({...i(this,Ie),node:Ss.cloneWith(i(this,Ie).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Ie).executor.transformQuery(i(this,Ie).node,i(this,Ie).queryId)}compile(){return i(this,Ie).executor.compileQuery(this.toOperationNode(),i(this,Ie).queryId)}async execute(){await i(this,Ie).executor.executeQuery(this.compile(),i(this,Ie).queryId)}};Ie=new WeakMap;let Mn=ns;F(Mn,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Bt=a({is(t){return t.kind==="CreateViewNode"},create(t){return a({kind:"CreateViewNode",name:Dt.create(t)})},cloneWith(t,e){return a({...t,...e})}});class nc{constructor(){N(this,ss,new qa)}transformQuery(e){return i(this,ss).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}ss=new WeakMap;const Jt=class Jt{constructor(e){N(this,re,void 0);g(this,re,a(e))}temporary(){return new Jt({...i(this,re),node:Bt.cloneWith(i(this,re).node,{temporary:!0})})}materialized(){return new Jt({...i(this,re),node:Bt.cloneWith(i(this,re).node,{materialized:!0})})}ifNotExists(){return new Jt({...i(this,re),node:Bt.cloneWith(i(this,re).node,{ifNotExists:!0})})}orReplace(){return new Jt({...i(this,re),node:Bt.cloneWith(i(this,re).node,{orReplace:!0})})}columns(e){return new Jt({...i(this,re),node:Bt.cloneWith(i(this,re).node,{columns:e.map(Jo)})})}as(e){const r=e.withPlugin(new nc).toOperationNode();return new Jt({...i(this,re),node:Bt.cloneWith(i(this,re).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return i(this,re).executor.transformQuery(i(this,re).node,i(this,re).queryId)}compile(){return i(this,re).executor.compileQuery(this.toOperationNode(),i(this,re).queryId)}async execute(){await i(this,re).executor.executeQuery(this.compile(),i(this,re).queryId)}};re=new WeakMap;let Fn=Jt;F(Fn,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const Qn=a({is(t){return t.kind==="DropViewNode"},create(t){return a({kind:"DropViewNode",name:Dt.create(t)})},cloneWith(t,e){return a({...t,...e})}}),Fi=class Fi{constructor(e){N(this,ge,void 0);g(this,ge,a(e))}materialized(){return new Fi({...i(this,ge),node:Qn.cloneWith(i(this,ge).node,{materialized:!0})})}ifExists(){return new Fi({...i(this,ge),node:Qn.cloneWith(i(this,ge).node,{ifExists:!0})})}cascade(){return new Fi({...i(this,ge),node:Qn.cloneWith(i(this,ge).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,ge).executor.transformQuery(i(this,ge).node,i(this,ge).queryId)}compile(){return i(this,ge).executor.compileQuery(this.toOperationNode(),i(this,ge).queryId)}async execute(){await i(this,ge).executor.executeQuery(this.compile(),i(this,ge).queryId)}};ge=new WeakMap;let Un=Fi;F(Un,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Ca=a({is(t){return t.kind==="CreateTypeNode"},create(t){return a({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return a({...t,enum:Bs.create(e.map(r=>Xe.createImmediate(r)))})}}),no=class no{constructor(e){N(this,Fe,void 0);g(this,Fe,a(e))}toOperationNode(){return i(this,Fe).executor.transformQuery(i(this,Fe).node,i(this,Fe).queryId)}asEnum(e){return new no({...i(this,Fe),node:Ca.cloneWithEnum(i(this,Fe).node,e)})}$call(e){return e(this)}compile(){return i(this,Fe).executor.compileQuery(this.toOperationNode(),i(this,Fe).queryId)}async execute(){await i(this,Fe).executor.executeQuery(this.compile(),i(this,Fe).queryId)}};Fe=new WeakMap;let Jn=no;F(Jn,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Wa=a({is(t){return t.kind==="DropTypeNode"},create(t){return a({kind:"DropTypeNode",name:t})},cloneWith(t,e){return a({...t,...e})}}),so=class so{constructor(e){N(this,Qe,void 0);g(this,Qe,a(e))}ifExists(){return new so({...i(this,Qe),node:Wa.cloneWith(i(this,Qe).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return i(this,Qe).executor.transformQuery(i(this,Qe).node,i(this,Qe).queryId)}compile(){return i(this,Qe).executor.compileQuery(this.toOperationNode(),i(this,Qe).queryId)}async execute(){await i(this,Qe).executor.executeQuery(this.compile(),i(this,Qe).queryId)}};Qe=new WeakMap;let Vn=so;F(Vn,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function ka(t){const e=".";if(t.includes(e)){const r=t.split(e).map(sc);if(r.length===2)return Dt.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return Dt.create(t)}function sc(t){return t.trim()}const Qi=class Qi{constructor(e){N(this,we,void 0);g(this,we,e)}createTable(e){return new Ln({queryId:K(),executor:i(this,we),node:Ye.create(Ae(e))})}dropTable(e){return new Mn({queryId:K(),executor:i(this,we),node:Ss.create(Ae(e))})}createIndex(e){return new Rn({queryId:K(),executor:i(this,we),node:At.create(e)})}dropIndex(e){return new Pn({queryId:K(),executor:i(this,we),node:hn.create(e)})}createSchema(e){return new _n({queryId:K(),executor:i(this,we),node:Lo.create(e)})}dropSchema(e){return new Bn({queryId:K(),executor:i(this,we),node:Ts.create(e)})}alterTable(e){return new Oa({queryId:K(),executor:i(this,we),node:le.create(Ae(e))})}createView(e){return new Fn({queryId:K(),executor:i(this,we),node:Bt.create(e)})}dropView(e){return new Un({queryId:K(),executor:i(this,we),node:Qn.create(e)})}createType(e){return new Jn({queryId:K(),executor:i(this,we),node:Ca.create(ka(e))})}dropType(e){return new Vn({queryId:K(),executor:i(this,we),node:Wa.create(ka(e))})}withPlugin(e){return new Qi(i(this,we).withPlugin(e))}withoutPlugins(){return new Qi(i(this,we).withoutPlugins())}withSchema(e){return new Qi(i(this,we).withPluginAtFront(new vi(e)))}};we=new WeakMap;let Zs=Qi;class oc{ref(e){return new ch(e)}}class ac{constructor(e){N(this,Xr,void 0);g(this,Xr,e)}async provideConnection(e){const r=await i(this,Xr).acquireConnection();try{return await e(r)}finally{await i(this,Xr).releaseConnection(r)}}}Xr=new WeakMap;const pr=class pr extends ca{constructor(r,u,d,v=[]){super(v);N(this,dt,void 0);N(this,ft,void 0);N(this,Ot,void 0);g(this,dt,r),g(this,ft,u),g(this,Ot,d)}get adapter(){return i(this,ft)}compileQuery(r){return i(this,dt).compileQuery(r)}provideConnection(r){return i(this,Ot).provideConnection(r)}withPlugins(r){return new pr(i(this,dt),i(this,ft),i(this,Ot),[...this.plugins,...r])}withPlugin(r){return new pr(i(this,dt),i(this,ft),i(this,Ot),[...this.plugins,r])}withPluginAtFront(r){return new pr(i(this,dt),i(this,ft),i(this,Ot),[r,...this.plugins])}withConnectionProvider(r){return new pr(i(this,dt),i(this,ft),r,[...this.plugins])}withoutPlugins(){return new pr(i(this,dt),i(this,ft),i(this,Ot),[])}};dt=new WeakMap,ft=new WeakMap,Ot=new WeakMap;let eo=pr;function Ia(){return typeof performance<"u"&&Ve(performance.now)?performance.now():Date.now()}class uc{constructor(e,r){N(this,os);N(this,as);N(this,us);N(this,hs);N(this,Ji);N(this,it,void 0);N(this,Vt,void 0);N(this,qt,void 0);N(this,mr,void 0);N(this,Ui,new WeakSet);g(this,it,e),g(this,Vt,r)}async init(){i(this,qt)||g(this,qt,i(this,it).init().catch(e=>(g(this,qt,void 0),Promise.reject(e)))),await i(this,qt)}async acquireConnection(){await this.init();const e=await i(this,it).acquireConnection();return i(this,Ui).has(e)||(V(this,os,Du).call(this)&&V(this,as,Ru).call(this,e),i(this,Ui).add(e)),e}async releaseConnection(e){await i(this,it).releaseConnection(e)}beginTransaction(e,r){return i(this,it).beginTransaction(e,r)}commitTransaction(e){return i(this,it).commitTransaction(e)}rollbackTransaction(e){return i(this,it).rollbackTransaction(e)}async destroy(){i(this,qt)&&(await i(this,qt),i(this,mr)||g(this,mr,i(this,it).destroy().catch(e=>(g(this,mr,void 0),Promise.reject(e)))),await i(this,mr))}}it=new WeakMap,Vt=new WeakMap,qt=new WeakMap,mr=new WeakMap,Ui=new WeakMap,os=new WeakSet,Du=function(){return i(this,Vt).isLevelEnabled("query")||i(this,Vt).isLevelEnabled("error")},as=new WeakSet,Ru=function(e){const r=e.executeQuery;e.executeQuery=async u=>{const d=Ia();try{return await r.call(e,u)}catch(v){throw await V(this,us,_u).call(this,v,u,d),v}finally{await V(this,hs,Lu).call(this,u,d)}}},us=new WeakSet,_u=async function(e,r,u){await i(this,Vt).error(()=>({level:"error",error:e,query:r,queryDurationMillis:V(this,Ji,Ao).call(this,u)}))},hs=new WeakSet,Lu=async function(e,r){await i(this,Vt).query(()=>({level:"query",query:e,queryDurationMillis:V(this,Ji,Ao).call(this,r)}))},Ji=new WeakSet,Ao=function(e){return Ia()-e};class Ta{constructor(e){N(this,cs);N(this,Vi,void 0);N(this,jt,void 0);g(this,Vi,e)}async provideConnection(e){for(;i(this,jt);)await i(this,jt);const r=V(this,cs,Pu).call(this,e);return g(this,jt,r.then(()=>{g(this,jt,void 0)}).catch(()=>{g(this,jt,void 0)})),r}}Vi=new WeakMap,jt=new WeakMap,cs=new WeakSet,Pu=async function(e){return await e(i(this,Vi))};const hc=["read uncommitted","read committed","repeatable read","serializable"];a(["query","error"]);class cc{constructor(e){N(this,$t,void 0);N(this,yr,void 0);Ve(e)?(g(this,yr,e),g(this,$t,a({query:!0,error:!0}))):(g(this,yr,lc),g(this,$t,a({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return i(this,$t)[e]}async query(e){i(this,$t).query&&await i(this,yr).call(this,e())}async error(e){i(this,$t).error&&await i(this,yr).call(this,e())}}$t=new WeakMap,yr=new WeakMap;function lc(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function dc(t){return at(t)&&Ve(t.compile)}const Zr=class Zr extends qn{constructor(r){let u,d;if(fc(r))u={executor:r.executor},d={...r};else{const v=r.dialect,x=v.createDriver(),W=v.createQueryCompiler(),j=v.createAdapter(),c=new cc(r.log??[]),Te=new uc(x,c),Ge=new ac(Te),pe=new eo(W,j,Ge,r.plugins??[]);u={executor:pe},d={config:r,executor:pe,dialect:v,driver:Te}}super(u);N(this,xe,void 0);g(this,xe,a(d))}get schema(){return new Zs(i(this,xe).executor)}get dynamic(){return new oc}get introspection(){return i(this,xe).dialect.createIntrospector(this.withoutPlugins())}case(r){return new fa({node:ht.create($(r)?void 0:Cn(r))})}get fn(){return da()}transaction(){return new jn({...i(this,xe)})}connection(){return new Sa({...i(this,xe)})}withPlugin(r){return new Zr({...i(this,xe),executor:i(this,xe).executor.withPlugin(r)})}withoutPlugins(){return new Zr({...i(this,xe),executor:i(this,xe).executor.withoutPlugins()})}withSchema(r){return new Zr({...i(this,xe),executor:i(this,xe).executor.withPluginAtFront(new vi(r))})}withTables(){return new Zr({...i(this,xe)})}async destroy(){await i(this,xe).driver.destroy()}get isTransaction(){return!1}getExecutor(){return i(this,xe).executor}executeQuery(r,u=K()){const d=dc(r)?r.compile():r;return this.getExecutor().executeQuery(d,u)}};xe=new WeakMap;let Ii=Zr;const ei=class ei extends Ii{constructor(r){super(r);N(this,nt,void 0);g(this,nt,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new ei({...i(this,nt),executor:i(this,nt).executor.withPlugin(r)})}withoutPlugins(){return new ei({...i(this,nt),executor:i(this,nt).executor.withoutPlugins()})}withSchema(r){return new ei({...i(this,nt),executor:i(this,nt).executor.withPluginAtFront(new vi(r))})}withTables(){return new ei({...i(this,nt)})}};nt=new WeakMap;let to=ei;function fc(t){return at(t)&&at(t.config)&&at(t.driver)&&at(t.executor)&&at(t.dialect)}class Sa{constructor(e){N(this,Nr,void 0);g(this,Nr,a(e))}async execute(e){return i(this,Nr).executor.provideConnection(async r=>{const u=i(this,Nr).executor.withConnectionProvider(new Ta(r)),d=new Ii({...i(this,Nr),executor:u});return await e(d)})}}Nr=new WeakMap,F(Sa,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");const oo=class oo{constructor(e){N(this,st,void 0);g(this,st,a(e))}setIsolationLevel(e){return new oo({...i(this,st),isolationLevel:e})}async execute(e){const{isolationLevel:r,...u}=i(this,st),d={isolationLevel:r};return pc(d),i(this,st).executor.provideConnection(async v=>{const x=i(this,st).executor.withConnectionProvider(new Ta(v)),W=new to({...u,executor:x});try{await i(this,st).driver.beginTransaction(v,d);const j=await e(W);return await i(this,st).driver.commitTransaction(v),j}catch(j){throw await i(this,st).driver.rollbackTransaction(v),j}})}};st=new WeakMap;let jn=oo;F(jn,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function pc(t){if(t.isolationLevel&&!hc.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}const ls=class ls{constructor(e){N(this,ti);N(this,ji);N(this,$i);N(this,De,void 0);g(this,De,a(e))}get expressionType(){}as(e){return new mc(this,e)}$castTo(){return new ls({...i(this,De)})}castTo(){return this.$castTo()}withPlugin(e){return new ls({...i(this,De),plugins:i(this,De).plugins!==void 0?a([...i(this,De).plugins,e]):a([e])})}toOperationNode(){return V(this,ji,Do).call(this,V(this,ti,Is).call(this))}compile(e){return V(this,$i,Ro).call(this,V(this,ti,Is).call(this,e))}async execute(e){const r=V(this,ti,Is).call(this,e);return r.executeQuery(V(this,$i,Ro).call(this,r),i(this,De).queryId)}};De=new WeakMap,ti=new WeakSet,Is=function(e){const r=e!==void 0?e.getExecutor():Js;return i(this,De).plugins!==void 0?r.withPlugins(i(this,De).plugins):r},ji=new WeakSet,Do=function(e){return e.transformQuery(i(this,De).rawNode,i(this,De).queryId)},$i=new WeakSet,Ro=function(e){return e.compileQuery(V(this,ji,Do).call(this,e),i(this,De).queryId)};let Ze=ls;F(Ze,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class mc{constructor(e,r){N(this,ri,void 0);N(this,Gt,void 0);g(this,ri,e),g(this,Gt,r)}get expression(){return i(this,ri)}get alias(){return i(this,Gt)}toOperationNode(){return Rt.create(i(this,ri).toOperationNode(),je(i(this,Gt))?i(this,Gt).toOperationNode():te.create(i(this,Gt)))}}ri=new WeakMap,Gt=new WeakMap;const Pe=Object.assign((t,...e)=>new Ze({queryId:K(),rawNode:Ce.create(t,(e==null?void 0:e.map(vt))??[])}),{ref(t){return new Ze({queryId:K(),rawNode:Ce.createWithChild(ir(t))})},val(t){return new Ze({queryId:K(),rawNode:Ce.createWithChild(vt(t))})},value(t){return this.val(t)},table(t){return new Ze({queryId:K(),rawNode:Ce.createWithChild(Ae(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",new Ze({queryId:K(),rawNode:Ce.create(e,t.map(te.create))})},lit(t){return new Ze({queryId:K(),rawNode:Ce.createWithChild(Xe.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return new Ze({queryId:K(),rawNode:Ce.createWithSql(t)})},join(t,e=Pe`, `){const r=new Array(2*t.length-1),u=e.toOperationNode();for(let d=0;d<t.length;++d)r[2*d]=vt(t[d]),d!==t.length-1&&(r[2*d+1]=u);return new Ze({queryId:K(),rawNode:Ce.createWithChildren(r)})}});class yc{constructor(){B(this,"nodeStack",[]);N(this,ds,a({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this)}));B(this,"visitNode",e=>{this.nodeStack.push(e),i(this,ds)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}ds=new WeakMap;class Nc extends yc{constructor(){super(...arguments);N(this,ii,"");N(this,wr,[])}get numParameters(){return i(this,wr).length}compileQuery(r){return g(this,ii,""),g(this,wr,[]),this.visitNode(r),a({query:r,sql:this.getSql(),parameters:[...i(this,wr)]})}getSql(){return i(this,ii)}visitSelectQuery(r){const u=this.parentNode!==void 0&&!ut.is(this.parentNode)&&!Bt.is(this.parentNode)&&!la.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select "),r.distinctOn&&(this.compileDistinctOn(r.distinctOn),this.append(" ")),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.selections&&(this.compileList(r.selections),this.append(" ")),this.visitNode(r.from),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," ")),u&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,u=", "){const d=r.length-1;for(let v=0;v<=d;v++)this.visitNode(r[v]),v<d&&this.append(u)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const u=this.nodeStack.find(_.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const u=this.nodeStack.find(_.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!L(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:u}=r;for(let d=0;d<u.length;++d)this.appendValue(u[d]),d!==u.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(vc[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:u,parameters:d}=r;for(let v=0;v<u.length;++v)this.append(u[v]),d.length>v&&this.visitNode(d[v])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const u=this.nodeStack.find(_.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileList(r.columnAlterations)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(wc[r.modifier])}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return di.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const u of r.pathLegs)this.visitNode(u);this.append("'")}visitJSONPathLeg(r){const u=r.type==="ArrayLocation";this.append(u?"[":"."),this.append(String(r.value)),u&&this.append("]")}visitJSONOperatorChain(r){for(let u=0,d=r.values.length;u<d;u++)u===d-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[u])}append(r){g(this,ii,i(this,ii)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const u=this.getLeftIdentifierWrapper(),d=this.getRightIdentifierWrapper();let v="";for(const x of r)v+=x,x===u?v+=u:x===d&&(v+=d);return v}addParameter(r){i(this,wr).push(r)}appendImmediateValue(r){if(L(r))this.append(`'${r}'`);else if(ce(r)||hi(r))this.append(r.toString());else if(_o(r))this.append("null");else if(Mu(r))this.appendImmediateValue(r.toISOString());else if(Fu(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}}ii=new WeakMap,wr=new WeakMap;const wc=a({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),vc=a({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),Rr=a({raw(t,e=[]){return a({sql:t,query:Ce.createWithSql(t),parameters:a(e)})}}),bc=/"/g;class gc extends Nc{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(bc,'""')}visitDefaultInsertValue(e){this.append("null")}}const xc="kysely_migration",Oc="kysely_migration_lock";a({__noMigrations__:!0});class qc{constructor(e){N(this,fs);N(this,ni,void 0);g(this,ni,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=i(this,ni).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",xc).where("name","!=",Oc));const u=await r.execute();return Promise.all(u.map(({name:d})=>V(this,fs,Bu).call(this,d)))}async getMetadata(e){return{tables:await this.getTables(e)}}}ni=new WeakMap,fs=new WeakSet,Bu=async function(e){var x,W,j,c,Te,Ge;const r=i(this,ni),u=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),d=(Ge=(Te=(c=(j=(W=(x=u.sql)==null?void 0:x.split(/[\(\),]/))==null?void 0:W.find(pe=>pe.toLowerCase().includes("autoincrement")))==null?void 0:j.trimStart())==null?void 0:c.split(/\s+/))==null?void 0:Te[0])==null?void 0:Ge.replace(/["`]/g,""),v=await r.selectFrom(Pe`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:u.type==="view",columns:v.map(pe=>({name:pe.name,dataType:pe.type,isNullable:!pe.notnull,isAutoIncrementing:pe.name===d,hasDefaultValue:pe.dflt_value!=null}))}};class Cc{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(){}async releaseMigrationLock(){}}var Wc=class{createQueryCompiler(){return new gc}createAdapter(){return new Cc}createIntrospector(t){return new qc(t)}},kc=(_a=class{constructor(){N(this,Gi,new Ic);B(this,"connection")}async acquireConnection(){return await i(this,Gi).lock(),this.connection}async beginTransaction(t){await t.executeQuery(Rr.raw("begin"))}async commitTransaction(t){await t.executeQuery(Rr.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(Rr.raw("rollback"))}async releaseConnection(){i(this,Gi).unlock()}},Gi=new WeakMap,_a),Ic=class{constructor(){B(this,"promise");B(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t==null||t()}},Tc=class{streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}async executeQuery(t){const{parameters:e,sql:r,query:u}=t;return["SelectQueryNode","RawNode"].includes(u.kind)?{rows:await this.query(r,e)}:{rows:[],...await this.exec(r,e)}}};function Sc({func:t,delay:e,maxCalls:r}){let u,d=0,v=null;function x(){u&&clearTimeout(u),d=0,v=null}function W(){d>=r?(t(v),x()):(u&&clearTimeout(u),u=setTimeout(()=>{t(v),x(),u=void 0},e))}return j=>{d++,v=j,u===void 0&&d===0?(t(j),d++):W()}}var Ec=class extends kc{constructor(e){super();B(this,"config");B(this,"db");this.config=e}async init(){var e,r,u,d,v,x;if(this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,!this.db)throw new Error("no database");this.connection=new Ac(this.db,(e=this.config.onWrite)==null?void 0:e.func,(r=this.config.onWrite)==null?void 0:r.isThrottle,(u=this.config.onWrite)==null?void 0:u.maxCalls,(d=this.config.onWrite)==null?void 0:d.delay),await((x=(v=this.config).onCreateConnection)==null?void 0:x.call(v,this.connection))}async beginTransaction(e){await e.executeQuery(Rr.raw("begin")),e.transactionNum++}async commitTransaction(e){await e.executeQuery(Rr.raw("commit")),e.transactionNum--}async rollbackTransaction(e){await e.executeQuery(Rr.raw("rollback")),e.transactionNum--}async destroy(){var e;(e=this.db)==null||e.close()}},Ac=class extends Tc{constructor(e,r,u=!1,d=1e3,v=2e3){super();B(this,"db");B(this,"onWrite");B(this,"transactionNum",0);this.db=e,this.onWrite=r?u?Sc({func:r,maxCalls:d,delay:v}):r:void 0}query(e,r){const u=this.db.prepare(e);u.bind(r);const d=[];for(;u.step();)d.push(u.getAsObject());return u.free(),d}exec(e,r){this.db.run(e,r);const u=BigInt(this.query("SELECT last_insert_rowid() as id")[0].id),d=BigInt(this.db.getRowsModified());return this.transactionNum===0&&this.onWrite&&this.onWrite(this.db.export()),{numAffectedRows:d,insertId:u}}},Dc=(La=class extends Wc{constructor(e){super();N(this,zi,void 0);g(this,zi,e)}createDriver(){return new Ec(i(this,zi))}},zi=new WeakMap,La);function Rc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function _c(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function u(){return this instanceof u?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(u){var d=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(r,u,d.get?d:{enumerable:!0,get:function(){return t[u]}})}),r}var Ea={exports:{}},Lc={},Pc=Object.freeze({__proto__:null,default:Lc}),$n=_c(Pc);(function(t,e){var r=void 0,u=function(d){return r||(r=new Promise(function(v,x){var W=typeof d<"u"?d:{},j=W.onAbort;W.onAbort=function(n){x(new Error(n)),j&&j(n)},W.postRun=W.postRun||[],W.postRun.push(function(){v(W)}),t=void 0;var c;c||(c=typeof W<"u"?W:{}),c.onRuntimeInitialized=function(){function n(f,w){switch(typeof w){case"boolean":jl(f,w?1:0);break;case"number":Ul(f,w);break;case"string":Jl(f,w,-1,-1);break;case"object":if(w===null)ku(f);else if(w.length!=null){var O=ko(w);Vl(f,O,w.length,-1),Cs(O)}else ks(f,"Wrong API use : tried to return a value of an unknown type ("+w+").",-1);break;default:ku(f)}}function s(f,w){for(var O=[],k=0;k<f;k+=1){var R=Tt(w+4*k,"i32"),J=Pl(R);if(J===1||J===2)R=Ql(R);else if(J===3)R=Ml(R);else if(J===4){J=R,R=Bl(J),J=Fl(J);for(var yt=new Uint8Array(R),Je=0;Je<R;Je+=1)yt[Je]=ye[J+Je];R=yt}else R=null;O.push(R)}return O}function o(f,w){this.La=f,this.db=w,this.Ja=1,this.fb=[]}function h(f,w){if(this.db=w,w=oi(f)+1,this.Ya=qs(w),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");gr(f,pt,this.Ya,w),this.eb=this.Ya,this.Ua=this.ib=null}function l(f){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),f!=null){var w=this.filename,O="/",k=w;if(O&&(O=typeof O=="string"?O:Zi(O),k=w?St(O+"/"+w):O),w=pu(!0,!0),k=Ns(k,(w!==void 0?w:438)&4095|32768,0),f){if(typeof f=="string"){O=Array(f.length);for(var R=0,J=f.length;R<J;++R)O[R]=f.charCodeAt(R);f=O}vs(k,w|146),O=ui(k,577),lu(O,f,0,f.length,0),vo(O),vs(k,w)}}this.handleError(S(this.filename,p)),this.db=Tt(p,"i32"),$l(this.db),this.Za={},this.Na={}}var p=er(4),m=c.cwrap,S=m("sqlite3_open","number",["string","number"]),U=m("sqlite3_close_v2","number",["number"]),P=m("sqlite3_exec","number",["number","string","number","number","number"]),he=m("sqlite3_changes","number",["number"]),Et=m("sqlite3_prepare_v2","number",["number","string","number","number","number"]),xu=m("sqlite3_sql","string",["number"]),bl=m("sqlite3_normalized_sql","string",["number"]),Ou=m("sqlite3_prepare_v2","number",["number","number","number","number","number"]),gl=m("sqlite3_bind_text","number",["number","number","number","number","number"]),qu=m("sqlite3_bind_blob","number",["number","number","number","number","number"]),xl=m("sqlite3_bind_double","number",["number","number","number"]),Ol=m("sqlite3_bind_int","number",["number","number","number"]),ql=m("sqlite3_bind_parameter_index","number",["number","string"]),Cl=m("sqlite3_step","number",["number"]),Wl=m("sqlite3_errmsg","string",["number"]),kl=m("sqlite3_column_count","number",["number"]),Il=m("sqlite3_data_count","number",["number"]),Tl=m("sqlite3_column_double","number",["number","number"]),Cu=m("sqlite3_column_text","string",["number","number"]),Sl=m("sqlite3_column_blob","number",["number","number"]),El=m("sqlite3_column_bytes","number",["number","number"]),Al=m("sqlite3_column_type","number",["number","number"]),Dl=m("sqlite3_column_name","string",["number","number"]),Rl=m("sqlite3_reset","number",["number"]),_l=m("sqlite3_clear_bindings","number",["number"]),Ll=m("sqlite3_finalize","number",["number"]),Wu=m("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),Pl=m("sqlite3_value_type","number",["number"]),Bl=m("sqlite3_value_bytes","number",["number"]),Ml=m("sqlite3_value_text","string",["number"]),Fl=m("sqlite3_value_blob","number",["number"]),Ql=m("sqlite3_value_double","number",["number"]),Ul=m("sqlite3_result_double","",["number","number"]),ku=m("sqlite3_result_null","",["number"]),Jl=m("sqlite3_result_text","",["number","string","number","number"]),Vl=m("sqlite3_result_blob","",["number","number","number","number"]),jl=m("sqlite3_result_int","",["number","number"]),ks=m("sqlite3_result_error","",["number","string","number"]),Iu=m("sqlite3_aggregate_context","number",["number","number"]),$l=m("RegisterExtensionFunctions","number",["number"]);o.prototype.bind=function(f){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(f)?this.xb(f):f!=null&&typeof f=="object"?this.yb(f):!0},o.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var f=Cl(this.La);switch(f){case 100:return!0;case 101:return!1;default:throw this.db.handleError(f)}},o.prototype.sb=function(f){return f==null&&(f=this.Ja,this.Ja+=1),Tl(this.La,f)},o.prototype.Cb=function(f){if(f==null&&(f=this.Ja,this.Ja+=1),f=Cu(this.La,f),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(f)},o.prototype.Db=function(f){return f==null&&(f=this.Ja,this.Ja+=1),Cu(this.La,f)},o.prototype.getBlob=function(f){f==null&&(f=this.Ja,this.Ja+=1);var w=El(this.La,f);f=Sl(this.La,f);for(var O=new Uint8Array(w),k=0;k<w;k+=1)O[k]=ye[f+k];return O},o.prototype.get=function(f,w){w=w||{},f!=null&&this.bind(f)&&this.step(),f=[];for(var O=Il(this.La),k=0;k<O;k+=1)switch(Al(this.La,k)){case 1:var R=w.useBigInt?this.Cb(k):this.sb(k);f.push(R);break;case 2:f.push(this.sb(k));break;case 3:f.push(this.Db(k));break;case 4:f.push(this.getBlob(k));break;default:f.push(null)}return f},o.prototype.getColumnNames=function(){for(var f=[],w=kl(this.La),O=0;O<w;O+=1)f.push(Dl(this.La,O));return f},o.prototype.getAsObject=function(f,w){f=this.get(f,w),w=this.getColumnNames();for(var O={},k=0;k<w.length;k+=1)O[w[k]]=f[k];return O},o.prototype.getSQL=function(){return xu(this.La)},o.prototype.getNormalizedSQL=function(){return bl(this.La)},o.prototype.run=function(f){return f!=null&&this.bind(f),this.step(),this.reset()},o.prototype.nb=function(f,w){w==null&&(w=this.Ja,this.Ja+=1),f=$a(f);var O=ko(f);this.fb.push(O),this.db.handleError(gl(this.La,w,O,f.length-1,0))},o.prototype.wb=function(f,w){w==null&&(w=this.Ja,this.Ja+=1);var O=ko(f);this.fb.push(O),this.db.handleError(qu(this.La,w,O,f.length,0))},o.prototype.mb=function(f,w){w==null&&(w=this.Ja,this.Ja+=1),this.db.handleError((f===(f|0)?Ol:xl)(this.La,w,f))},o.prototype.zb=function(f){f==null&&(f=this.Ja,this.Ja+=1),qu(this.La,f,0,0,0)},o.prototype.ob=function(f,w){switch(w==null&&(w=this.Ja,this.Ja+=1),typeof f){case"string":this.nb(f,w);return;case"number":this.mb(f,w);return;case"bigint":this.nb(f.toString(),w);return;case"boolean":this.mb(f+0,w);return;case"object":if(f===null){this.zb(w);return}if(f.length!=null){this.wb(f,w);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+f+")."},o.prototype.yb=function(f){var w=this;return Object.keys(f).forEach(function(O){var k=ql(w.La,O);k!==0&&w.ob(f[O],k)}),!0},o.prototype.xb=function(f){for(var w=0;w<f.length;w+=1)this.ob(f[w],w+1);return!0},o.prototype.reset=function(){return this.freemem(),_l(this.La)===0&&Rl(this.La)===0},o.prototype.freemem=function(){for(var f;(f=this.fb.pop())!==void 0;)Cs(f)},o.prototype.free=function(){this.freemem();var f=Ll(this.La)===0;return delete this.db.Za[this.La],this.La=0,f},h.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var f=sn(),w=er(4);Xi(p),Xi(w);try{this.db.handleError(Ou(this.db.db,this.eb,-1,p,w)),this.eb=Tt(w,"i32");var O=Tt(p,"i32");return O===0?(this.gb(),{done:!0}):(this.Ua=new o(O,this.db),this.db.Za[O]=this.Ua,{value:this.Ua,done:!1})}catch(k){throw this.ib=ve(this.eb),this.gb(),k}finally{on(f)}},h.prototype.gb=function(){Cs(this.Ya),this.Ya=null},h.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:ve(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(h.prototype[Symbol.iterator]=function(){return this}),l.prototype.run=function(f,w){if(!this.db)throw"Database closed";if(w){f=this.prepare(f,w);try{f.step()}finally{f.free()}}else this.handleError(P(this.db,f,0,0,p));return this},l.prototype.exec=function(f,w,O){if(!this.db)throw"Database closed";var k=sn(),R=null;try{var J=oi(f)+1,yt=er(J);gr(f,ye,yt,J);var Je=yt,Ke=er(4);for(f=[];Tt(Je,"i8")!==0;){Xi(p),Xi(Ke),this.handleError(Ou(this.db,Je,-1,p,Ke));var He=Tt(p,"i32");if(Je=Tt(Ke,"i32"),He!==0){for(J=null,R=new o(He,this),w!=null&&R.bind(w);R.step();)J===null&&(J={columns:R.getColumnNames(),values:[]},f.push(J)),J.values.push(R.get(null,O));R.free()}}return f}catch(an){throw R&&R.free(),an}finally{on(k)}},l.prototype.each=function(f,w,O,k,R){typeof w=="function"&&(k=O,O=w,w=void 0),f=this.prepare(f,w);try{for(;f.step();)O(f.getAsObject(null,R))}finally{f.free()}if(typeof k=="function")return k()},l.prototype.prepare=function(f,w){if(Xi(p),this.handleError(Et(this.db,f,-1,p,0)),f=Tt(p,"i32"),f===0)throw"Nothing to prepare";var O=new o(f,this);return w!=null&&O.bind(w),this.Za[f]=O},l.prototype.iterateStatements=function(f){return new h(f,this)},l.prototype.export=function(){Object.values(this.Za).forEach(function(w){w.free()}),Object.values(this.Na).forEach(nn),this.Na={},this.handleError(U(this.db));var f=yl(this.filename);return this.handleError(S(this.filename,p)),this.db=Tt(p,"i32"),f},l.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(f){f.free()}),Object.values(this.Na).forEach(nn),this.Na={},this.handleError(U(this.db)),su("/"+this.filename),this.db=null)},l.prototype.handleError=function(f){if(f===0)return null;throw f=Wl(this.db),Error(f)},l.prototype.getRowsModified=function(){return he(this.db)},l.prototype.create_function=function(f,w){Object.prototype.hasOwnProperty.call(this.Na,f)&&(nn(this.Na[f]),delete this.Na[f]);var O=Wo(function(k,R,J){R=s(R,J);try{var yt=w.apply(null,R)}catch(Je){ks(k,Je,-1);return}n(k,yt)},"viii");return this.Na[f]=O,this.handleError(Wu(this.db,f,w.length,1,0,O,0,0,0)),this},l.prototype.create_aggregate=function(f,w){var O=w.init||function(){return null},k=w.finalize||function(Ke){return Ke},R=w.step;if(!R)throw"An aggregate function must have a step function in "+f;var J={};Object.hasOwnProperty.call(this.Na,f)&&(nn(this.Na[f]),delete this.Na[f]),w=f+"__finalize",Object.hasOwnProperty.call(this.Na,w)&&(nn(this.Na[w]),delete this.Na[w]);var yt=Wo(function(Ke,He,an){var Cr=Iu(Ke,1);Object.hasOwnProperty.call(J,Cr)||(J[Cr]=O()),He=s(He,an),He=[J[Cr]].concat(He);try{J[Cr]=R.apply(null,He)}catch(Gl){delete J[Cr],ks(Ke,Gl,-1)}},"viii"),Je=Wo(function(Ke){var He=Iu(Ke,1);try{var an=k(J[He])}catch(Cr){delete J[He],ks(Ke,Cr,-1);return}n(Ke,an),delete J[He]},"vi");return this.Na[f]=yt,this.Na[w]=Je,this.handleError(Wu(this.db,f,R.length-1,1,0,0,yt,Je,0)),this},c.Database=l};var Te=Object.assign({},c),Ge="./this.program",pe=typeof window=="object",Ct=typeof importScripts=="function",Wt=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",Re="",Z,Ue,kt,vr,si,zt;Wt?(Re=Ct?$n.dirname(Re)+"/":__dirname+"/",zt=()=>{si||(vr=$n,si=$n)},Z=function(n,s){return zt(),n=si.normalize(n),vr.readFileSync(n,s?void 0:"utf8")},kt=n=>(n=Z(n,!0),n.buffer||(n=new Uint8Array(n)),n),Ue=(n,s,o)=>{zt(),n=si.normalize(n),vr.readFile(n,function(h,l){h?o(h):s(l.buffer)})},1<process.argv.length&&(Ge=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=c,c.inspect=function(){return"[Emscripten Module object]"}):(pe||Ct)&&(Ct?Re=self.location.href:typeof document<"u"&&document.currentScript&&(Re=document.currentScript.src),Re=Re.indexOf("blob:")!==0?Re.substr(0,Re.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Z=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.send(null),s.responseText},Ct&&(kt=n=>{var s=new XMLHttpRequest;return s.open("GET",n,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),Ue=(n,s,o)=>{var h=new XMLHttpRequest;h.open("GET",n,!0),h.responseType="arraybuffer",h.onload=()=>{h.status==200||h.status==0&&h.response?s(h.response):o()},h.onerror=o,h.send(null)});var It=c.print||console.log.bind(console),br=c.printErr||console.warn.bind(console);Object.assign(c,Te),Te=null,c.thisProgram&&(Ge=c.thisProgram);var Ki;c.wasmBinary&&(Ki=c.wasmBinary),c.noExitRuntime,typeof WebAssembly!="object"&&Ht("no native wasm support detected");var ao,Pa=!1,Ba=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Hi(n,s,o){var h=s+o;for(o=s;n[o]&&!(o>=h);)++o;if(16<o-s&&n.buffer&&Ba)return Ba.decode(n.subarray(s,o));for(h="";s<o;){var l=n[s++];if(l&128){var p=n[s++]&63;if((l&224)==192)h+=String.fromCharCode((l&31)<<6|p);else{var m=n[s++]&63;l=(l&240)==224?(l&15)<<12|p<<6|m:(l&7)<<18|p<<12|m<<6|n[s++]&63,65536>l?h+=String.fromCharCode(l):(l-=65536,h+=String.fromCharCode(55296|l>>10,56320|l&1023))}}else h+=String.fromCharCode(l)}return h}function ve(n,s){return n?Hi(pt,n,s):""}function gr(n,s,o,h){if(!(0<h))return 0;var l=o;h=o+h-1;for(var p=0;p<n.length;++p){var m=n.charCodeAt(p);if(55296<=m&&57343>=m){var S=n.charCodeAt(++p);m=65536+((m&1023)<<10)|S&1023}if(127>=m){if(o>=h)break;s[o++]=m}else{if(2047>=m){if(o+1>=h)break;s[o++]=192|m>>6}else{if(65535>=m){if(o+2>=h)break;s[o++]=224|m>>12}else{if(o+3>=h)break;s[o++]=240|m>>18,s[o++]=128|m>>12&63}s[o++]=128|m>>6&63}s[o++]=128|m&63}}return s[o]=0,o-l}function oi(n){for(var s=0,o=0;o<n.length;++o){var h=n.charCodeAt(o);127>=h?s++:2047>=h?s+=2:55296<=h&&57343>=h?(s+=4,++o):s+=3}return s}var uo,ye,pt,ps,T,ae,ho,co;function Ma(){var n=ao.buffer;uo=n,c.HEAP8=ye=new Int8Array(n),c.HEAP16=ps=new Int16Array(n),c.HEAP32=T=new Int32Array(n),c.HEAPU8=pt=new Uint8Array(n),c.HEAPU16=new Uint16Array(n),c.HEAPU32=ae=new Uint32Array(n),c.HEAPF32=ho=new Float32Array(n),c.HEAPF64=co=new Float64Array(n)}var Kt,Fa=[],Qa=[],Ua=[];function sl(){var n=c.preRun.shift();Fa.unshift(n)}var xr=0,Yi=null;function Ht(n){throw c.onAbort&&c.onAbort(n),n="Aborted("+n+")",br(n),Pa=!0,new WebAssembly.RuntimeError(n+". Build with -sASSERTIONS for more info.")}function Ja(){return ze.startsWith("data:application/octet-stream;base64,")}var ze;if(ze="sql-wasm.wasm",!Ja()){var Va=ze;ze=c.locateFile?c.locateFile(Va,Re):Re+Va}function ja(){var n=ze;try{if(n==ze&&Ki)return new Uint8Array(Ki);if(kt)return kt(n);throw"both async and sync fetching of the wasm failed"}catch(s){Ht(s)}}function ol(){if(!Ki&&(pe||Ct)){if(typeof fetch=="function"&&!ze.startsWith("file://"))return fetch(ze,{credentials:"same-origin"}).then(function(n){if(!n.ok)throw"failed to load wasm binary file at '"+ze+"'";return n.arrayBuffer()}).catch(function(){return ja()});if(Ue)return new Promise(function(n,s){Ue(ze,function(o){n(new Uint8Array(o))},s)})}return Promise.resolve().then(function(){return ja()})}var E,ue;function lo(n){for(;0<n.length;)n.shift()(c)}function Tt(n,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return ye[n>>0];case"i8":return ye[n>>0];case"i16":return ps[n>>1];case"i32":return T[n>>2];case"i64":return T[n>>2];case"float":return ho[n>>2];case"double":return co[n>>3];case"*":return ae[n>>2];default:Ht("invalid type for getValue: "+s)}return null}function Xi(n){var s="i32";switch(s.endsWith("*")&&(s="*"),s){case"i1":ye[n>>0]=0;break;case"i8":ye[n>>0]=0;break;case"i16":ps[n>>1]=0;break;case"i32":T[n>>2]=0;break;case"i64":ue=[0,(E=0,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[n>>2]=ue[0],T[n+4>>2]=ue[1];break;case"float":ho[n>>2]=0;break;case"double":co[n>>3]=0;break;case"*":ae[n>>2]=0;break;default:Ht("invalid type for setValue: "+s)}}var fo=(n,s)=>{for(var o=0,h=n.length-1;0<=h;h--){var l=n[h];l==="."?n.splice(h,1):l===".."?(n.splice(h,1),o++):o&&(n.splice(h,1),o--)}if(s)for(;o;o--)n.unshift("..");return n},St=n=>{var s=n.charAt(0)==="/",o=n.substr(-1)==="/";return(n=fo(n.split("/").filter(h=>!!h),!s).join("/"))||s||(n="."),n&&o&&(n+="/"),(s?"/":"")+n},al=n=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(n).slice(1);return n=s[0],s=s[1],!n&&!s?".":(s&&(s=s.substr(0,s.length-1)),n+s)},ms=n=>{if(n==="/")return"/";n=St(n),n=n.replace(/\/$/,"");var s=n.lastIndexOf("/");return s===-1?n:n.substr(s+1)};function ul(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var n=new Uint8Array(1);return()=>(crypto.getRandomValues(n),n[0])}if(Wt)try{var s=$n;return()=>s.randomBytes(1)[0]}catch{}return()=>Ht("randomDevice")}function ys(){for(var n="",s=!1,o=arguments.length-1;-1<=o&&!s;o--){if(s=0<=o?arguments[o]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";n=s+"/"+n,s=s.charAt(0)==="/"}return n=fo(n.split("/").filter(h=>!!h),!s).join("/"),(s?"/":"")+n||"."}function $a(n,s){var o=Array(oi(n)+1);return n=gr(n,o,0,o.length),s&&(o.length=n),o}var Ga=[];function za(n,s){Ga[n]={input:[],output:[],Xa:s},No(n,hl)}var hl={open:function(n){var s=Ga[n.node.rdev];if(!s)throw new y(43);n.tty=s,n.seekable=!1},close:function(n){n.tty.Xa.fsync(n.tty)},fsync:function(n){n.tty.Xa.fsync(n.tty)},read:function(n,s,o,h){if(!n.tty||!n.tty.Xa.tb)throw new y(60);for(var l=0,p=0;p<h;p++){try{var m=n.tty.Xa.tb(n.tty)}catch{throw new y(29)}if(m===void 0&&l===0)throw new y(6);if(m==null)break;l++,s[o+p]=m}return l&&(n.node.timestamp=Date.now()),l},write:function(n,s,o,h){if(!n.tty||!n.tty.Xa.jb)throw new y(60);try{for(var l=0;l<h;l++)n.tty.Xa.jb(n.tty,s[o+l])}catch{throw new y(29)}return h&&(n.node.timestamp=Date.now()),l}},cl={tb:function(n){if(!n.input.length){var s=null;if(Wt){var o=Buffer.alloc(256),h=0;try{h=vr.readSync(process.stdin.fd,o,0,256,-1)}catch(l){if(l.toString().includes("EOF"))h=0;else throw l}0<h?s=o.slice(0,h).toString("utf-8"):s=null}else typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`));if(!s)return null;n.input=$a(s,!0)}return n.input.shift()},jb:function(n,s){s===null||s===10?(It(Hi(n.output,0)),n.output=[]):s!=0&&n.output.push(s)},fsync:function(n){n.output&&0<n.output.length&&(It(Hi(n.output,0)),n.output=[])}},ll={jb:function(n,s){s===null||s===10?(br(Hi(n.output,0)),n.output=[]):s!=0&&n.output.push(s)},fsync:function(n){n.output&&0<n.output.length&&(br(Hi(n.output,0)),n.output=[])}},A={Qa:null,Ra:function(){return A.createNode(null,"/",16895,0)},createNode:function(n,s,o,h){if((o&61440)===24576||(o&61440)===4096)throw new y(63);return A.Qa||(A.Qa={dir:{node:{Pa:A.Ga.Pa,Oa:A.Ga.Oa,lookup:A.Ga.lookup,ab:A.Ga.ab,rename:A.Ga.rename,unlink:A.Ga.unlink,rmdir:A.Ga.rmdir,readdir:A.Ga.readdir,symlink:A.Ga.symlink},stream:{Ta:A.Ha.Ta}},file:{node:{Pa:A.Ga.Pa,Oa:A.Ga.Oa},stream:{Ta:A.Ha.Ta,read:A.Ha.read,write:A.Ha.write,lb:A.Ha.lb,bb:A.Ha.bb,cb:A.Ha.cb}},link:{node:{Pa:A.Ga.Pa,Oa:A.Ga.Oa,readlink:A.Ga.readlink},stream:{}},pb:{node:{Pa:A.Ga.Pa,Oa:A.Ga.Oa},stream:ml}}),o=Xa(n,s,o,h),(o.mode&61440)===16384?(o.Ga=A.Qa.dir.node,o.Ha=A.Qa.dir.stream,o.Ia={}):(o.mode&61440)===32768?(o.Ga=A.Qa.file.node,o.Ha=A.Qa.file.stream,o.Ma=0,o.Ia=null):(o.mode&61440)===40960?(o.Ga=A.Qa.link.node,o.Ha=A.Qa.link.stream):(o.mode&61440)===8192&&(o.Ga=A.Qa.pb.node,o.Ha=A.Qa.pb.stream),o.timestamp=Date.now(),n&&(n.Ia[s]=o,n.timestamp=o.timestamp),o},Jb:function(n){return n.Ia?n.Ia.subarray?n.Ia.subarray(0,n.Ma):new Uint8Array(n.Ia):new Uint8Array(0)},qb:function(n,s){var o=n.Ia?n.Ia.length:0;o>=s||(s=Math.max(s,o*(1048576>o?2:1.125)>>>0),o!=0&&(s=Math.max(s,256)),o=n.Ia,n.Ia=new Uint8Array(s),0<n.Ma&&n.Ia.set(o.subarray(0,n.Ma),0))},Gb:function(n,s){if(n.Ma!=s)if(s==0)n.Ia=null,n.Ma=0;else{var o=n.Ia;n.Ia=new Uint8Array(s),o&&n.Ia.set(o.subarray(0,Math.min(s,n.Ma))),n.Ma=s}},Ga:{Pa:function(n){var s={};return s.dev=(n.mode&61440)===8192?n.id:1,s.ino=n.id,s.mode=n.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=n.rdev,(n.mode&61440)===16384?s.size=4096:(n.mode&61440)===32768?s.size=n.Ma:(n.mode&61440)===40960?s.size=n.link.length:s.size=0,s.atime=new Date(n.timestamp),s.mtime=new Date(n.timestamp),s.ctime=new Date(n.timestamp),s.Ab=4096,s.blocks=Math.ceil(s.size/s.Ab),s},Oa:function(n,s){s.mode!==void 0&&(n.mode=s.mode),s.timestamp!==void 0&&(n.timestamp=s.timestamp),s.size!==void 0&&A.Gb(n,s.size)},lookup:function(){throw mo[44]},ab:function(n,s,o,h){return A.createNode(n,s,o,h)},rename:function(n,s,o){if((n.mode&61440)===16384){try{var h=Or(s,o)}catch{}if(h)for(var l in h.Ia)throw new y(55)}delete n.parent.Ia[n.name],n.parent.timestamp=Date.now(),n.name=o,s.Ia[o]=n,s.timestamp=n.parent.timestamp,n.parent=s},unlink:function(n,s){delete n.Ia[s],n.timestamp=Date.now()},rmdir:function(n,s){var o=Or(n,s),h;for(h in o.Ia)throw new y(55);delete n.Ia[s],n.timestamp=Date.now()},readdir:function(n){var s=[".",".."],o;for(o in n.Ia)n.Ia.hasOwnProperty(o)&&s.push(o);return s},symlink:function(n,s,o){return n=A.createNode(n,s,41471,0),n.link=o,n},readlink:function(n){if((n.mode&61440)!==40960)throw new y(28);return n.link}},Ha:{read:function(n,s,o,h,l){var p=n.node.Ia;if(l>=n.node.Ma)return 0;if(n=Math.min(n.node.Ma-l,h),8<n&&p.subarray)s.set(p.subarray(l,l+n),o);else for(h=0;h<n;h++)s[o+h]=p[l+h];return n},write:function(n,s,o,h,l,p){if(s.buffer===ye.buffer&&(p=!1),!h)return 0;if(n=n.node,n.timestamp=Date.now(),s.subarray&&(!n.Ia||n.Ia.subarray)){if(p)return n.Ia=s.subarray(o,o+h),n.Ma=h;if(n.Ma===0&&l===0)return n.Ia=s.slice(o,o+h),n.Ma=h;if(l+h<=n.Ma)return n.Ia.set(s.subarray(o,o+h),l),h}if(A.qb(n,l+h),n.Ia.subarray&&s.subarray)n.Ia.set(s.subarray(o,o+h),l);else for(p=0;p<h;p++)n.Ia[l+p]=s[o+p];return n.Ma=Math.max(n.Ma,l+h),h},Ta:function(n,s,o){if(o===1?s+=n.position:o===2&&(n.node.mode&61440)===32768&&(s+=n.node.Ma),0>s)throw new y(28);return s},lb:function(n,s,o){A.qb(n.node,s+o),n.node.Ma=Math.max(n.node.Ma,s+o)},bb:function(n,s,o,h,l){if((n.node.mode&61440)!==32768)throw new y(43);if(n=n.node.Ia,l&2||n.buffer!==uo){if((0<o||o+s<n.length)&&(n.subarray?n=n.subarray(o,o+s):n=Array.prototype.slice.call(n,o,o+s)),o=!0,s=65536*Math.ceil(s/65536),(l=bu(65536,s))?(pt.fill(0,l,l+s),s=l):s=0,!s)throw new y(48);ye.set(n,s)}else o=!1,s=n.byteOffset;return{Fb:s,vb:o}},cb:function(n,s,o,h,l){if((n.node.mode&61440)!==32768)throw new y(43);return l&2||A.Ha.write(n,s,0,h,o,!1),0}}},po=null,Ka={},Yt=[],dl=1,Xt=null,Ha=!0,y=null,mo={},_e=(n,s={})=>{if(n=ys("/",n),!n)return{path:"",node:null};if(s=Object.assign({rb:!0,kb:0},s),8<s.kb)throw new y(32);n=fo(n.split("/").filter(m=>!!m),!1);for(var o=po,h="/",l=0;l<n.length;l++){var p=l===n.length-1;if(p&&s.parent)break;if(o=Or(o,n[l]),h=St(h+"/"+n[l]),o.Va&&(!p||p&&s.rb)&&(o=o.Va.root),!p||s.Sa){for(p=0;(o.mode&61440)===40960;)if(o=ou(h),h=ys(al(h),o),o=_e(h,{kb:s.kb+1}).node,40<p++)throw new y(32)}}return{path:h,node:o}},Zi=n=>{for(var s;;){if(n===n.parent)return n=n.Ra.ub,s?n[n.length-1]!=="/"?n+"/"+s:n+s:n;s=s?n.name+"/"+s:n.name,n=n.parent}},yo=(n,s)=>{for(var o=0,h=0;h<s.length;h++)o=(o<<5)-o+s.charCodeAt(h)|0;return(n+o>>>0)%Xt.length},Ya=n=>{var s=yo(n.parent.id,n.name);if(Xt[s]===n)Xt[s]=n.Wa;else for(s=Xt[s];s;){if(s.Wa===n){s.Wa=n.Wa;break}s=s.Wa}},Or=(n,s)=>{var o;if(o=(o=ai(n,"x"))?o:n.Ga.lookup?0:2)throw new y(o,n);for(o=Xt[yo(n.id,s)];o;o=o.Wa){var h=o.name;if(o.parent.id===n.id&&h===s)return o}return n.Ga.lookup(n,s)},Xa=(n,s,o,h)=>(n=new wu(n,s,o,h),s=yo(n.parent.id,n.name),n.Wa=Xt[s],Xt[s]=n),fl={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},Za=n=>{var s=["r","w","rw"][n&3];return n&512&&(s+="w"),s},ai=(n,s)=>{if(Ha)return 0;if(!s.includes("r")||n.mode&292){if(s.includes("w")&&!(n.mode&146)||s.includes("x")&&!(n.mode&73))return 2}else return 2;return 0},eu=(n,s)=>{try{return Or(n,s),20}catch{}return ai(n,"wx")},tu=(n,s,o)=>{try{var h=Or(n,s)}catch(l){return l.Ka}if(n=ai(n,"wx"))return n;if(o){if((h.mode&61440)!==16384)return 54;if(h===h.parent||Zi(h)==="/")return 10}else if((h.mode&61440)===16384)return 31;return 0},pl=(n=0)=>{for(;4096>=n;n++)if(!Yt[n])return n;throw new y(33)},ru=(n,s)=>(rn||(rn=function(){this.$a={}},rn.prototype={},Object.defineProperties(rn.prototype,{object:{get:function(){return this.node},set:function(o){this.node=o}},flags:{get:function(){return this.$a.flags},set:function(o){this.$a.flags=o}},position:{get:function(){return this.$a.position},set:function(o){this.$a.position=o}}})),n=Object.assign(new rn,n),s=pl(s),n.fd=s,Yt[s]=n),ml={open:n=>{n.Ha=Ka[n.node.rdev].Ha,n.Ha.open&&n.Ha.open(n)},Ta:()=>{throw new y(70)}},No=(n,s)=>{Ka[n]={Ha:s}},iu=(n,s)=>{var o=s==="/",h=!s;if(o&&po)throw new y(10);if(!o&&!h){var l=_e(s,{rb:!1});if(s=l.path,l=l.node,l.Va)throw new y(10);if((l.mode&61440)!==16384)throw new y(54)}s={type:n,Kb:{},ub:s,Eb:[]},n=n.Ra(s),n.Ra=s,s.root=n,o?po=n:l&&(l.Va=s,l.Ra&&l.Ra.Eb.push(s))},Ns=(n,s,o)=>{var h=_e(n,{parent:!0}).node;if(n=ms(n),!n||n==="."||n==="..")throw new y(28);var l=eu(h,n);if(l)throw new y(l);if(!h.Ga.ab)throw new y(63);return h.Ga.ab(h,n,s,o)},mt=(n,s)=>Ns(n,(s!==void 0?s:511)&1023|16384,0),ws=(n,s,o)=>{typeof o>"u"&&(o=s,s=438),Ns(n,s|8192,o)},wo=(n,s)=>{if(!ys(n))throw new y(44);var o=_e(s,{parent:!0}).node;if(!o)throw new y(44);s=ms(s);var h=eu(o,s);if(h)throw new y(h);if(!o.Ga.symlink)throw new y(63);o.Ga.symlink(o,s,n)},nu=n=>{var s=_e(n,{parent:!0}).node;n=ms(n);var o=Or(s,n),h=tu(s,n,!0);if(h)throw new y(h);if(!s.Ga.rmdir)throw new y(63);if(o.Va)throw new y(10);s.Ga.rmdir(s,n),Ya(o)},su=n=>{var s=_e(n,{parent:!0}).node;if(!s)throw new y(44);n=ms(n);var o=Or(s,n),h=tu(s,n,!1);if(h)throw new y(h);if(!s.Ga.unlink)throw new y(63);if(o.Va)throw new y(10);s.Ga.unlink(s,n),Ya(o)},ou=n=>{if(n=_e(n).node,!n)throw new y(44);if(!n.Ga.readlink)throw new y(28);return ys(Zi(n.parent),n.Ga.readlink(n))},en=(n,s)=>{if(n=_e(n,{Sa:!s}).node,!n)throw new y(44);if(!n.Ga.Pa)throw new y(63);return n.Ga.Pa(n)},au=n=>en(n,!0),vs=(n,s)=>{if(n=typeof n=="string"?_e(n,{Sa:!0}).node:n,!n.Ga.Oa)throw new y(63);n.Ga.Oa(n,{mode:s&4095|n.mode&-4096,timestamp:Date.now()})},uu=(n,s)=>{if(0>s)throw new y(28);if(n=typeof n=="string"?_e(n,{Sa:!0}).node:n,!n.Ga.Oa)throw new y(63);if((n.mode&61440)===16384)throw new y(31);if((n.mode&61440)!==32768)throw new y(28);var o=ai(n,"w");if(o)throw new y(o);n.Ga.Oa(n,{size:s,timestamp:Date.now()})},ui=(n,s,o)=>{if(n==="")throw new y(44);if(typeof s=="string"){var h=fl[s];if(typeof h>"u")throw Error("Unknown file open mode: "+s);s=h}if(o=s&64?(typeof o>"u"?438:o)&4095|32768:0,typeof n=="object")var l=n;else{n=St(n);try{l=_e(n,{Sa:!(s&131072)}).node}catch{}}if(h=!1,s&64)if(l){if(s&128)throw new y(20)}else l=Ns(n,o,0),h=!0;if(!l)throw new y(44);if((l.mode&61440)===8192&&(s&=-513),s&65536&&(l.mode&61440)!==16384)throw new y(54);if(!h&&(o=l?(l.mode&61440)===40960?32:(l.mode&61440)===16384&&(Za(s)!=="r"||s&512)?31:ai(l,Za(s)):44))throw new y(o);return s&512&&!h&&uu(l,0),s&=-131713,l=ru({node:l,path:Zi(l),flags:s,seekable:!0,position:0,Ha:l.Ha,Ib:[],error:!1}),l.Ha.open&&l.Ha.open(l),!c.logReadFiles||s&1||(bs||(bs={}),n in bs||(bs[n]=1)),l},vo=n=>{if(n.fd===null)throw new y(8);n.hb&&(n.hb=null);try{n.Ha.close&&n.Ha.close(n)}catch(s){throw s}finally{Yt[n.fd]=null}n.fd=null},hu=(n,s,o)=>{if(n.fd===null)throw new y(8);if(!n.seekable||!n.Ha.Ta)throw new y(70);if(o!=0&&o!=1&&o!=2)throw new y(28);n.position=n.Ha.Ta(n,s,o),n.Ib=[]},cu=(n,s,o,h,l)=>{if(0>h||0>l)throw new y(28);if(n.fd===null)throw new y(8);if((n.flags&2097155)===1)throw new y(8);if((n.node.mode&61440)===16384)throw new y(31);if(!n.Ha.read)throw new y(28);var p=typeof l<"u";if(!p)l=n.position;else if(!n.seekable)throw new y(70);return s=n.Ha.read(n,s,o,h,l),p||(n.position+=s),s},lu=(n,s,o,h,l)=>{if(0>h||0>l)throw new y(28);if(n.fd===null)throw new y(8);if(!(n.flags&2097155))throw new y(8);if((n.node.mode&61440)===16384)throw new y(31);if(!n.Ha.write)throw new y(28);n.seekable&&n.flags&1024&&hu(n,0,2);var p=typeof l<"u";if(!p)l=n.position;else if(!n.seekable)throw new y(70);return s=n.Ha.write(n,s,o,h,l,void 0),p||(n.position+=s),s},yl=n=>{var s,o=ui(n,o||0);n=en(n).size;var h=new Uint8Array(n);return cu(o,h,0,n,0),s=h,vo(o),s},du=()=>{y||(y=function(n,s){this.node=s,this.Hb=function(o){this.Ka=o},this.Hb(n),this.message="FS error"},y.prototype=Error(),y.prototype.constructor=y,[44].forEach(n=>{mo[n]=new y(n),mo[n].stack="<generic error, no stack>"}))},fu,pu=(n,s)=>{var o=0;return n&&(o|=365),s&&(o|=146),o},tn=(n,s,o)=>{n=St("/dev/"+n);var h=pu(!!s,!!o);bo||(bo=64);var l=bo++<<8|0;No(l,{open:p=>{p.seekable=!1},close:()=>{o&&o.buffer&&o.buffer.length&&o(10)},read:(p,m,S,U)=>{for(var P=0,he=0;he<U;he++){try{var Et=s()}catch{throw new y(29)}if(Et===void 0&&P===0)throw new y(6);if(Et==null)break;P++,m[S+he]=Et}return P&&(p.node.timestamp=Date.now()),P},write:(p,m,S,U)=>{for(var P=0;P<U;P++)try{o(m[S+P])}catch{throw new y(29)}return U&&(p.node.timestamp=Date.now()),P}}),ws(n,h,l)},bo,ee={},rn,bs;function qr(n,s,o){if(s.charAt(0)==="/")return s;if(n=n===-100?"/":ot(n).path,s.length==0){if(!o)throw new y(44);return n}return St(n+"/"+s)}function gs(n,s,o){try{var h=n(s)}catch(l){if(l&&l.node&&St(s)!==St(Zi(l.node)))return-54;throw l}return T[o>>2]=h.dev,T[o+8>>2]=h.ino,T[o+12>>2]=h.mode,ae[o+16>>2]=h.nlink,T[o+20>>2]=h.uid,T[o+24>>2]=h.gid,T[o+28>>2]=h.rdev,ue=[h.size>>>0,(E=h.size,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[o+40>>2]=ue[0],T[o+44>>2]=ue[1],T[o+48>>2]=4096,T[o+52>>2]=h.blocks,ue=[Math.floor(h.atime.getTime()/1e3)>>>0,(E=Math.floor(h.atime.getTime()/1e3),1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[o+56>>2]=ue[0],T[o+60>>2]=ue[1],ae[o+64>>2]=0,ue=[Math.floor(h.mtime.getTime()/1e3)>>>0,(E=Math.floor(h.mtime.getTime()/1e3),1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[o+72>>2]=ue[0],T[o+76>>2]=ue[1],ae[o+80>>2]=0,ue=[Math.floor(h.ctime.getTime()/1e3)>>>0,(E=Math.floor(h.ctime.getTime()/1e3),1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[o+88>>2]=ue[0],T[o+92>>2]=ue[1],ae[o+96>>2]=0,ue=[h.ino>>>0,(E=h.ino,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[o+104>>2]=ue[0],T[o+108>>2]=ue[1],0}var xs=void 0;function Os(){return xs+=4,T[xs-4>>2]}function ot(n){if(n=Yt[n],!n)throw new y(8);return n}function go(n){return ae[n>>2]+4294967296*T[n+4>>2]}function mu(n){var s=oi(n)+1,o=qs(s);return o&&gr(n,ye,o,s),o}function Nl(n,s,o){function h(U){return(U=U.toTimeString().match(/\(([A-Za-z ]+)\)$/))?U[1]:"GMT"}var l=new Date().getFullYear(),p=new Date(l,0,1),m=new Date(l,6,1);l=p.getTimezoneOffset();var S=m.getTimezoneOffset();T[n>>2]=60*Math.max(l,S),T[s>>2]=+(l!=S),n=h(p),s=h(m),n=mu(n),s=mu(s),S<l?(ae[o>>2]=n,ae[o+4>>2]=s):(ae[o>>2]=s,ae[o+4>>2]=n)}function xo(n,s,o){xo.Bb||(xo.Bb=!0,Nl(n,s,o))}var yu;yu=Wt?()=>{var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}:()=>performance.now();var Oo={};function Nu(){if(!qo){var n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Ge||"./this.program"},s;for(s in Oo)Oo[s]===void 0?delete n[s]:n[s]=Oo[s];var o=[];for(s in n)o.push(s+"="+n[s]);qo=o}return qo}var qo,Zt=void 0,Co=[];function Wo(n,s){if(!Zt){Zt=new WeakMap;var o=Kt.length;if(Zt)for(var h=0;h<0+o;h++){var l=Kt.get(h);l&&Zt.set(l,h)}}if(Zt.has(n))return Zt.get(n);if(Co.length)o=Co.pop();else{try{Kt.grow(1)}catch(S){throw S instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":S}o=Kt.length-1}try{Kt.set(o,n)}catch(S){if(!(S instanceof TypeError))throw S;if(typeof WebAssembly.Function=="function"){h=WebAssembly.Function,l={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"};for(var p={parameters:[],results:s[0]=="v"?[]:[l[s[0]]]},m=1;m<s.length;++m)p.parameters.push(l[s[m]]);s=new h(p,n)}else{for(h=[1,96],l=s.slice(0,1),s=s.slice(1),p={i:127,p:127,j:126,f:125,d:124},m=s.length,128>m?h.push(m):h.push(m%128|128,m>>7),m=0;m<s.length;++m)h.push(p[s[m]]);l=="v"?h.push(0):h.push(1,p[l]),s=[0,97,115,109,1,0,0,0,1],l=h.length,128>l?s.push(l):s.push(l%128|128,l>>7),s.push.apply(s,h),s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),s=new WebAssembly.Module(new Uint8Array(s)),s=new WebAssembly.Instance(s,{e:{f:n}}).exports.f}Kt.set(o,s)}return Zt.set(n,o),o}function nn(n){Zt.delete(Kt.get(n)),Co.push(n)}function ko(n){var s=qs(n.length);return n.subarray||n.slice||(n=new Uint8Array(n)),pt.set(n,s),s}function wl(n,s,o,h){var l={string:P=>{var he=0;if(P!=null&&P!==0){var Et=(P.length<<2)+1;he=er(Et),gr(P,pt,he,Et)}return he},array:P=>{var he=er(P.length);return ye.set(P,he),he}};n=c["_"+n];var p=[],m=0;if(h)for(var S=0;S<h.length;S++){var U=l[o[S]];U?(m===0&&(m=sn()),p[S]=U(h[S])):p[S]=h[S]}return o=n.apply(null,p),o=function(P){return m!==0&&on(m),s==="string"?ve(P):s==="boolean"?!!P:P}(o)}function wu(n,s,o,h){n||(n=this),this.parent=n,this.Ra=n.Ra,this.Va=null,this.id=dl++,this.name=s,this.mode=o,this.Ga={},this.Ha={},this.rdev=h}Object.defineProperties(wu.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(n){n?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(n){n?this.mode|=146:this.mode&=-147}}}),du(),Xt=Array(4096),iu(A,"/"),mt("/tmp"),mt("/home"),mt("/home/web_user"),(()=>{mt("/dev"),No(259,{read:()=>0,write:(s,o,h,l)=>l}),ws("/dev/null",259),za(1280,cl),za(1536,ll),ws("/dev/tty",1280),ws("/dev/tty1",1536);var n=ul();tn("random",n),tn("urandom",n),mt("/dev/shm"),mt("/dev/shm/tmp")})(),(()=>{mt("/proc");var n=mt("/proc/self");mt("/proc/self/fd"),iu({Ra:()=>{var s=Xa(n,"fd",16895,73);return s.Ga={lookup:(o,h)=>{var l=Yt[+h];if(!l)throw new y(8);return o={parent:null,Ra:{ub:"fake"},Ga:{readlink:()=>l.path}},o.parent=o}},s}},"/proc/self/fd")})();var vl={a:function(n,s,o,h){Ht("Assertion failed: "+ve(n)+", at: "+[s?ve(s):"unknown filename",o,h?ve(h):"unknown function"])},h:function(n,s){try{return n=ve(n),vs(n,s),0}catch(o){if(typeof ee>"u"||!(o instanceof y))throw o;return-o.Ka}},H:function(n,s,o){try{if(s=ve(s),s=qr(n,s),o&-8)return-28;var h=_e(s,{Sa:!0}).node;return h?(n="",o&4&&(n+="r"),o&2&&(n+="w"),o&1&&(n+="x"),n&&ai(h,n)?-2:0):-44}catch(l){if(typeof ee>"u"||!(l instanceof y))throw l;return-l.Ka}},i:function(n,s){try{var o=Yt[n];if(!o)throw new y(8);return vs(o.node,s),0}catch(h){if(typeof ee>"u"||!(h instanceof y))throw h;return-h.Ka}},g:function(n){try{var s=Yt[n];if(!s)throw new y(8);var o=s.node,h=typeof o=="string"?_e(o,{Sa:!0}).node:o;if(!h.Ga.Oa)throw new y(63);return h.Ga.Oa(h,{timestamp:Date.now()}),0}catch(l){if(typeof ee>"u"||!(l instanceof y))throw l;return-l.Ka}},b:function(n,s,o){xs=o;try{var h=ot(n);switch(s){case 0:var l=Os();return 0>l?-28:ru(h,l).fd;case 1:case 2:return 0;case 3:return h.flags;case 4:return l=Os(),h.flags|=l,0;case 5:return l=Os(),ps[l+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return T[vu()>>2]=28,-1;default:return-28}}catch(p){if(typeof ee>"u"||!(p instanceof y))throw p;return-p.Ka}},G:function(n,s){try{var o=ot(n);return gs(en,o.path,s)}catch(h){if(typeof ee>"u"||!(h instanceof y))throw h;return-h.Ka}},l:function(n,s,o){try{if(s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN,isNaN(s))return-61;var h=Yt[n];if(!h)throw new y(8);if(!(h.flags&2097155))throw new y(28);return uu(h.node,s),0}catch(l){if(typeof ee>"u"||!(l instanceof y))throw l;return-l.Ka}},B:function(n,s){try{if(s===0)return-28;var o=oi("/")+1;return s<o?-68:(gr("/",pt,n,s),o)}catch(h){if(typeof ee>"u"||!(h instanceof y))throw h;return-h.Ka}},E:function(n,s){try{return n=ve(n),gs(au,n,s)}catch(o){if(typeof ee>"u"||!(o instanceof y))throw o;return-o.Ka}},y:function(n,s,o){try{return s=ve(s),s=qr(n,s),s=St(s),s[s.length-1]==="/"&&(s=s.substr(0,s.length-1)),mt(s,o),0}catch(h){if(typeof ee>"u"||!(h instanceof y))throw h;return-h.Ka}},D:function(n,s,o,h){try{s=ve(s);var l=h&256;return s=qr(n,s,h&4096),gs(l?au:en,s,o)}catch(p){if(typeof ee>"u"||!(p instanceof y))throw p;return-p.Ka}},v:function(n,s,o,h){xs=h;try{s=ve(s),s=qr(n,s);var l=h?Os():0;return ui(s,o,l).fd}catch(p){if(typeof ee>"u"||!(p instanceof y))throw p;return-p.Ka}},t:function(n,s,o,h){try{if(s=ve(s),s=qr(n,s),0>=h)return-28;var l=ou(s),p=Math.min(h,oi(l)),m=ye[o+p];return gr(l,pt,o,h+1),ye[o+p]=m,p}catch(S){if(typeof ee>"u"||!(S instanceof y))throw S;return-S.Ka}},s:function(n){try{return n=ve(n),nu(n),0}catch(s){if(typeof ee>"u"||!(s instanceof y))throw s;return-s.Ka}},F:function(n,s){try{return n=ve(n),gs(en,n,s)}catch(o){if(typeof ee>"u"||!(o instanceof y))throw o;return-o.Ka}},p:function(n,s,o){try{return s=ve(s),s=qr(n,s),o===0?su(s):o===512?nu(s):Ht("Invalid flags passed to unlinkat"),0}catch(h){if(typeof ee>"u"||!(h instanceof y))throw h;return-h.Ka}},o:function(n,s,o){try{if(s=ve(s),s=qr(n,s,!0),o){var h=go(o),l=T[o+8>>2];p=1e3*h+l/1e6,o+=16,h=go(o),l=T[o+8>>2],m=1e3*h+l/1e6}else var p=Date.now(),m=p;n=p;var S=_e(s,{Sa:!0}).node;return S.Ga.Oa(S,{timestamp:Math.max(n,m)}),0}catch(U){if(typeof ee>"u"||!(U instanceof y))throw U;return-U.Ka}},e:function(){return Date.now()},j:function(n,s){n=new Date(1e3*go(n)),T[s>>2]=n.getSeconds(),T[s+4>>2]=n.getMinutes(),T[s+8>>2]=n.getHours(),T[s+12>>2]=n.getDate(),T[s+16>>2]=n.getMonth(),T[s+20>>2]=n.getFullYear()-1900,T[s+24>>2]=n.getDay();var o=new Date(n.getFullYear(),0,1);T[s+28>>2]=(n.getTime()-o.getTime())/864e5|0,T[s+36>>2]=-(60*n.getTimezoneOffset());var h=new Date(n.getFullYear(),6,1).getTimezoneOffset();o=o.getTimezoneOffset(),T[s+32>>2]=(h!=o&&n.getTimezoneOffset()==Math.min(o,h))|0},w:function(n,s,o,h,l,p){try{var m=ot(h);if(s&2&&!(o&2)&&(m.flags&2097155)!==2)throw new y(2);if((m.flags&2097155)===1)throw new y(2);if(!m.Ha.bb)throw new y(43);var S=m.Ha.bb(m,n,l,s,o),U=S.Fb;return T[p>>2]=S.vb,U}catch(P){if(typeof ee>"u"||!(P instanceof y))throw P;return-P.Ka}},x:function(n,s,o,h,l,p){try{var m=ot(l);if(o&2){var S=pt.slice(n,n+s);m&&m.Ha.cb&&m.Ha.cb(m,S,p,s,h)}}catch(U){if(typeof ee>"u"||!(U instanceof y))throw U;return-U.Ka}},n:xo,q:function(){return 2147483648},d:yu,c:function(n){var s=pt.length;if(n>>>=0,2147483648<n)return!1;for(var o=1;4>=o;o*=2){var h=s*(1+.2/o);h=Math.min(h,n+100663296);var l=Math;h=Math.max(n,h),l=l.min.call(l,2147483648,h+(65536-h%65536)%65536);e:{try{ao.grow(l-uo.byteLength+65535>>>16),Ma();var p=1;break e}catch{}p=void 0}if(p)return!0}return!1},z:function(n,s){var o=0;return Nu().forEach(function(h,l){var p=s+o;for(l=ae[n+4*l>>2]=p,p=0;p<h.length;++p)ye[l++>>0]=h.charCodeAt(p);ye[l>>0]=0,o+=h.length+1}),0},A:function(n,s){var o=Nu();ae[n>>2]=o.length;var h=0;return o.forEach(function(l){h+=l.length+1}),ae[s>>2]=h,0},f:function(n){try{var s=ot(n);return vo(s),0}catch(o){if(typeof ee>"u"||!(o instanceof y))throw o;return o.Ka}},m:function(n,s){try{var o=ot(n);return ye[s>>0]=o.tty?2:(o.mode&61440)===16384?3:(o.mode&61440)===40960?7:4,0}catch(h){if(typeof ee>"u"||!(h instanceof y))throw h;return h.Ka}},u:function(n,s,o,h){try{e:{var l=ot(n);n=s;for(var p=s=0;p<o;p++){var m=ae[n>>2],S=ae[n+4>>2];n+=8;var U=cu(l,ye,m,S);if(0>U){var P=-1;break e}if(s+=U,U<S)break}P=s}return ae[h>>2]=P,0}catch(he){if(typeof ee>"u"||!(he instanceof y))throw he;return he.Ka}},k:function(n,s,o,h,l){try{if(s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN,isNaN(s))return 61;var p=ot(n);return hu(p,s,h),ue=[p.position>>>0,(E=p.position,1<=+Math.abs(E)?0<E?(Math.min(+Math.floor(E/4294967296),4294967295)|0)>>>0:~~+Math.ceil((E-+(~~E>>>0))/4294967296)>>>0:0)],T[l>>2]=ue[0],T[l+4>>2]=ue[1],p.hb&&s===0&&h===0&&(p.hb=null),0}catch(m){if(typeof ee>"u"||!(m instanceof y))throw m;return m.Ka}},C:function(n){try{var s=ot(n);return s.Ha&&s.Ha.fsync?s.Ha.fsync(s):0}catch(o){if(typeof ee>"u"||!(o instanceof y))throw o;return o.Ka}},r:function(n,s,o,h){try{e:{var l=ot(n);n=s;for(var p=s=0;p<o;p++){var m=ae[n>>2],S=ae[n+4>>2];n+=8;var U=lu(l,ye,m,S);if(0>U){var P=-1;break e}s+=U}P=s}return ae[h>>2]=P,0}catch(he){if(typeof ee>"u"||!(he instanceof y))throw he;return he.Ka}}};(function(){function n(l){c.asm=l.exports,ao=c.asm.I,Ma(),Kt=c.asm.Aa,Qa.unshift(c.asm.J),xr--,c.monitorRunDependencies&&c.monitorRunDependencies(xr),xr==0&&Yi&&(l=Yi,Yi=null,l())}function s(l){n(l.instance)}function o(l){return ol().then(function(p){return WebAssembly.instantiate(p,h)}).then(function(p){return p}).then(l,function(p){br("failed to asynchronously prepare wasm: "+p),Ht(p)})}var h={a:vl};if(xr++,c.monitorRunDependencies&&c.monitorRunDependencies(xr),c.instantiateWasm)try{return c.instantiateWasm(h,n)}catch(l){return br("Module.instantiateWasm callback failed with error: "+l),!1}return function(){return Ki||typeof WebAssembly.instantiateStreaming!="function"||Ja()||ze.startsWith("file://")||Wt||typeof fetch!="function"?o(s):fetch(ze,{credentials:"same-origin"}).then(function(l){return WebAssembly.instantiateStreaming(l,h).then(s,function(p){return br("wasm streaming compile failed: "+p),br("falling back to ArrayBuffer instantiation"),o(s)})})}(),{}})(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.J).apply(null,arguments)},c._sqlite3_free=function(){return(c._sqlite3_free=c.asm.K).apply(null,arguments)},c._sqlite3_value_double=function(){return(c._sqlite3_value_double=c.asm.L).apply(null,arguments)},c._sqlite3_value_text=function(){return(c._sqlite3_value_text=c.asm.M).apply(null,arguments)};var vu=c.___errno_location=function(){return(vu=c.___errno_location=c.asm.N).apply(null,arguments)};c._sqlite3_prepare_v2=function(){return(c._sqlite3_prepare_v2=c.asm.O).apply(null,arguments)},c._sqlite3_step=function(){return(c._sqlite3_step=c.asm.P).apply(null,arguments)},c._sqlite3_finalize=function(){return(c._sqlite3_finalize=c.asm.Q).apply(null,arguments)},c._sqlite3_reset=function(){return(c._sqlite3_reset=c.asm.R).apply(null,arguments)},c._sqlite3_value_int=function(){return(c._sqlite3_value_int=c.asm.S).apply(null,arguments)},c._sqlite3_clear_bindings=function(){return(c._sqlite3_clear_bindings=c.asm.T).apply(null,arguments)},c._sqlite3_value_blob=function(){return(c._sqlite3_value_blob=c.asm.U).apply(null,arguments)},c._sqlite3_value_bytes=function(){return(c._sqlite3_value_bytes=c.asm.V).apply(null,arguments)},c._sqlite3_value_type=function(){return(c._sqlite3_value_type=c.asm.W).apply(null,arguments)},c._sqlite3_result_blob=function(){return(c._sqlite3_result_blob=c.asm.X).apply(null,arguments)},c._sqlite3_result_double=function(){return(c._sqlite3_result_double=c.asm.Y).apply(null,arguments)},c._sqlite3_result_error=function(){return(c._sqlite3_result_error=c.asm.Z).apply(null,arguments)},c._sqlite3_result_int=function(){return(c._sqlite3_result_int=c.asm._).apply(null,arguments)},c._sqlite3_result_int64=function(){return(c._sqlite3_result_int64=c.asm.$).apply(null,arguments)},c._sqlite3_result_null=function(){return(c._sqlite3_result_null=c.asm.aa).apply(null,arguments)},c._sqlite3_result_text=function(){return(c._sqlite3_result_text=c.asm.ba).apply(null,arguments)},c._sqlite3_sql=function(){return(c._sqlite3_sql=c.asm.ca).apply(null,arguments)},c._sqlite3_aggregate_context=function(){return(c._sqlite3_aggregate_context=c.asm.da).apply(null,arguments)},c._sqlite3_column_count=function(){return(c._sqlite3_column_count=c.asm.ea).apply(null,arguments)},c._sqlite3_data_count=function(){return(c._sqlite3_data_count=c.asm.fa).apply(null,arguments)},c._sqlite3_column_blob=function(){return(c._sqlite3_column_blob=c.asm.ga).apply(null,arguments)},c._sqlite3_column_bytes=function(){return(c._sqlite3_column_bytes=c.asm.ha).apply(null,arguments)},c._sqlite3_column_double=function(){return(c._sqlite3_column_double=c.asm.ia).apply(null,arguments)},c._sqlite3_column_text=function(){return(c._sqlite3_column_text=c.asm.ja).apply(null,arguments)},c._sqlite3_column_type=function(){return(c._sqlite3_column_type=c.asm.ka).apply(null,arguments)},c._sqlite3_column_name=function(){return(c._sqlite3_column_name=c.asm.la).apply(null,arguments)},c._sqlite3_bind_blob=function(){return(c._sqlite3_bind_blob=c.asm.ma).apply(null,arguments)},c._sqlite3_bind_double=function(){return(c._sqlite3_bind_double=c.asm.na).apply(null,arguments)},c._sqlite3_bind_int=function(){return(c._sqlite3_bind_int=c.asm.oa).apply(null,arguments)},c._sqlite3_bind_text=function(){return(c._sqlite3_bind_text=c.asm.pa).apply(null,arguments)},c._sqlite3_bind_parameter_index=function(){return(c._sqlite3_bind_parameter_index=c.asm.qa).apply(null,arguments)},c._sqlite3_normalized_sql=function(){return(c._sqlite3_normalized_sql=c.asm.ra).apply(null,arguments)},c._sqlite3_errmsg=function(){return(c._sqlite3_errmsg=c.asm.sa).apply(null,arguments)},c._sqlite3_exec=function(){return(c._sqlite3_exec=c.asm.ta).apply(null,arguments)},c._sqlite3_changes=function(){return(c._sqlite3_changes=c.asm.ua).apply(null,arguments)},c._sqlite3_close_v2=function(){return(c._sqlite3_close_v2=c.asm.va).apply(null,arguments)},c._sqlite3_create_function_v2=function(){return(c._sqlite3_create_function_v2=c.asm.wa).apply(null,arguments)},c._sqlite3_open=function(){return(c._sqlite3_open=c.asm.xa).apply(null,arguments)};var qs=c._malloc=function(){return(qs=c._malloc=c.asm.ya).apply(null,arguments)},Cs=c._free=function(){return(Cs=c._free=c.asm.za).apply(null,arguments)};c._RegisterExtensionFunctions=function(){return(c._RegisterExtensionFunctions=c.asm.Ba).apply(null,arguments)};var bu=c._emscripten_builtin_memalign=function(){return(bu=c._emscripten_builtin_memalign=c.asm.Ca).apply(null,arguments)},sn=c.stackSave=function(){return(sn=c.stackSave=c.asm.Da).apply(null,arguments)},on=c.stackRestore=function(){return(on=c.stackRestore=c.asm.Ea).apply(null,arguments)},er=c.stackAlloc=function(){return(er=c.stackAlloc=c.asm.Fa).apply(null,arguments)};c.UTF8ToString=ve,c.stackAlloc=er,c.stackSave=sn,c.stackRestore=on,c.cwrap=function(n,s,o,h){o=o||[];var l=o.every(p=>p==="number"||p==="boolean");return s!=="string"&&l&&!h?c["_"+n]:function(){return wl(n,s,o,arguments)}};var Ws;Yi=function n(){Ws||gu(),Ws||(Yi=n)};function gu(){function n(){if(!Ws&&(Ws=!0,c.calledRun=!0,!Pa)){if(c.noFSInit||fu||(fu=!0,du(),c.stdin=c.stdin,c.stdout=c.stdout,c.stderr=c.stderr,c.stdin?tn("stdin",c.stdin):wo("/dev/tty","/dev/stdin"),c.stdout?tn("stdout",null,c.stdout):wo("/dev/tty","/dev/stdout"),c.stderr?tn("stderr",null,c.stderr):wo("/dev/tty1","/dev/stderr"),ui("/dev/stdin",0),ui("/dev/stdout",1),ui("/dev/stderr",1)),Ha=!1,lo(Qa),c.onRuntimeInitialized&&c.onRuntimeInitialized(),c.postRun)for(typeof c.postRun=="function"&&(c.postRun=[c.postRun]);c.postRun.length;){var s=c.postRun.shift();Ua.unshift(s)}lo(Ua)}}if(!(0<xr)){if(c.preRun)for(typeof c.preRun=="function"&&(c.preRun=[c.preRun]);c.preRun.length;)sl();lo(Fa),0<xr||(c.setStatus?(c.setStatus("Running..."),setTimeout(function(){setTimeout(function(){c.setStatus("")},1),n()},1)):n())}}if(c.preInit)for(typeof c.preInit=="function"&&(c.preInit=[c.preInit]);0<c.preInit.length;)c.preInit.pop()();return gu(),W}),r)};t.exports=u,t.exports.default=u})(Ea);var Bc=Ea.exports,Mc=Rc(Bc),Fc=""+new URL("sql-wasm-18fc45ef.wasm",self.location.href).href;const Qc="sqlitevfs",_r=new Map,Uc=2048,Jc=65536;class Vc{constructor(e){B(this,"_data");B(this,"_size");this._data=e??new Uint8Array,this._size=this._data.length}get size(){return this._size}read(e,r){if(e>=this._size)return 0;const u=this._data.subarray(e,Math.min(this._size,e+r.length));return r.set(u),u.length}reserve(e){if(this._data.length>=e)return;const r=e-this._data.length,u=Math.min(Jc,Math.max(Uc,this._data.length)),d=new Uint8Array(this._data.length+Math.max(u,r));d.set(this._data),this._data=d}write(e,r){return this.reserve(e+r.length),this._data.set(r,e),this._size=Math.max(this._size,e+r.length),r.length}truncate(e){this._size=e}toUint8Array(){return this._data.subarray(0,this._size)}}const jc=self.indexedDB||window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,Aa=new Promise((t,e)=>{const r=jc.open(Qc,1);r.onupgradeneeded=()=>r.result.createObjectStore("files",{keyPath:"name"}),r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)});async function $c(t){const e=await Aa,r=await new Promise((u,d)=>{const x=e.transaction("files","readonly").objectStore("files").get(t);x.onsuccess=()=>u(x.result),x.onerror=()=>d(x.error)});if(r&&!_r.has(t)){const u=new Vc(r.data);return _r.set(t,u),u}else return _r.has(t)?_r.get(t):null}async function Gc(t,e){const r=await Aa;await new Promise((u,d)=>{const x=r.transaction("files","readwrite").objectStore("files").put({name:t,data:e});x.onsuccess=()=>u(!0),x.onerror=()=>d(x.error)})}async function zc(t,e){if(await Gc(t,e),_r.has(t)){const r=_r.get(t);r.truncate(0),r.write(0,e)}}var Da=t=>t==null||typeof t=="bigint"||typeof t=="string"||typeof t=="number"||typeof t=="object"&&"buffer"in t?t:typeof t=="boolean"?`${t}`:t instanceof Date?t.toISOString():JSON.stringify(t),Kc=t=>{if(t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t)return t;if(typeof t=="string"){const e=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/;if(/^(true|false)$/.test(t))return t==="true";if(e.test(t))return new Date(t);try{return JSON.parse(t,(r,u)=>typeof u=="string"&&e.exec(u)?new Date(u):u)}catch{}}return t},Hc=class extends Us{constructor(e){super();B(this,"serializer");this.serializer=e||Da}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:u,...d}=r,v=this.serializer(u);return u===v?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...d,value:v}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Yc=class{constructor({deserializer:t,serializer:e}={}){B(this,"serializeParametersTransformer");B(this,"deserializer");B(this,"ctx");this.serializeParametersTransformer=new Hc(e),this.deserializer=t||Kc,this.ctx=new WeakMap}transformQuery({node:t,queryId:e}){return t.kind==="SelectQueryNode"&&this.ctx.set(e,t.kind),this.serializeParametersTransformer.transformNode(t)}async parseResult(t){return await Promise.all(t.map(async e=>{const r={...e};for(const u in r)r[u]=await this.deserializer(r[u]);return r}))}async transformResult({result:t,queryId:e}){const{rows:r}=t,u=this.ctx.get(e);return this.ctx.delete(e),r&&u==="SelectQueryNode"?{...t,rows:await this.parseResult(r)}:t}};async function Ra(t,e,r,u,d="rowid"){await Pe`
      create trigger if not exists ${Pe.raw(e)}_${Pe.raw(u)}
      after ${Pe.raw(r)}
      on ${Pe.table(e)}
      begin
        update ${Pe.table(e)}
        set ${Pe.ref(u)} = datetime('now','localtime')
        where ${Pe.ref(d)} = NEW.${Pe.ref(d)};
      end
    `.execute(t).catch(v=>{console.error(v)})}function Xc(t){const e=new Map;for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const u=t[r];e.set(r,u)}return e}async function Zc(t,e,r=!1){for(const[u,d]of e){const{columns:v,property:x}=d;r&&await t.schema.dropTable(u).ifExists().execute().catch();let W=t.schema.createTable(u);const{index:j,primary:c,timestamp:Te,unique:Ge}=x||{};let pe="rowid",Ct=!1;const Wt=typeof Te=="object"&&Te.create||"createAt",Re=typeof Te=="object"&&Te.update||"updateAt";for(const[Z,Ue]of Object.entries(v)){let kt="text";const{type:vr,notNull:si,defaultTo:zt}=Ue;switch(vr){case"boolean":case"date":case"object":case"string":kt="text";break;case"increments":pe=Z;case"number":kt="integer";break;case"blob":kt="blob"}[Wt,Re].includes(Z)||(W=W.addColumn(Z,kt,It=>vr==="increments"?(Ct=!0,It.autoIncrement().primaryKey()):(si&&(It=It.notNull()),zt!==void 0&&(It=It.defaultTo(zt instanceof Function?zt(Pe):zt)),It)))}if(Te&&(W=W.addColumn(Wt,"text").addColumn(Re,"text")),!Ct&&c){const Z=Array.isArray(c);pe=Z?c[0]:c,W=W.addPrimaryKeyConstraint(`pk_${Z?c.join("_"):c}`,Z?c:[c])}if(Ge==null||Ge.forEach(Z=>{const Ue=Array.isArray(Z);pe=!c&&!Ct?Ue?Z[0]:Z:pe,W=W.addUniqueConstraint(`un_${Ue?Z.join("_"):Z}`,Ue?Z:[Z])}),await W.ifNotExists().execute(),j)for(const Z of j){const Ue=Array.isArray(Z);await t.schema.createIndex(`idx_${Ue?Z.join("_"):Z}`).on(u).columns(Ue?Z:[Z]).ifNotExists().execute()}Te&&(await Ra(t,u,"insert",Wt,pe),await Ra(t,u,"update",Re,pe))}}function el(t){function e(r){return`__precomile_${r}`}return{setParam(r){let u;return(d,v)=>{if(!u){const{parameters:x,sql:W,query:j}=r(t,e).compile();u={sql:W,query:(v==null?void 0:v(j))||{kind:j.kind},parameters:x}}return{...u,parameters:u.parameters.map(x=>typeof x=="string"&&x.startsWith("__precomile_")?Da(d[x.slice(12)]):x)}}}}}var tl=class{constructor(){B(this,"items");this.items=[]}push(t){this.items.push(t)}pop(){return this.items.pop()}peek(){return this.items[this.items.length-1]}isEmpty(){return this.items.length===0}size(){return this.items.length}},rl=class{constructor(t){B(this,"kysely");B(this,"status");B(this,"tableMap");B(this,"logger");B(this,"trxs");const{dialect:e,tables:r,dropTableBeforeInit:u,onQuery:d,plugins:v,logger:x}=t;this.logger=x;const W=v??[];W.push(new Yc),this.kysely=new Ii({dialect:e,log:j=>{var c;j.level==="error"?(c=this.logger)==null||c.error("Uncaught DB Error",j.error):d==null||d(j.query,j.queryDurationMillis)},plugins:W}),this.status=u?0:1,this.tableMap=Xc(r),this.trxs=new tl}async init(t=!1){const e=t||this.status===0;return await Zc(this.kysely,this.tableMap,e),this.status=2,this}async isEmptyTable(){var t;return this.status!==2&&await this.init(),this.status===2?!1:((t=this.logger)==null||t.error("fail to init table"),!0)}async transaction(t,e){if(!await this.isEmptyTable())return await this.kysely.transaction().execute(r=>(this.trxs.push(r),t(r))).catch(r=>{var u;e&&((u=this.logger)==null||u.error(e,r))}).finally(()=>{this.trxs.pop()})}getDB(){return this.trxs.isEmpty()?this.kysely:this.trxs.peek()}async exec(t,e){if(!await this.isEmptyTable())return t(this.getDB()).catch(r=>{var u;e&&((u=this.logger)==null||u.error(e,r))})}async execOne(t,e){const r=await this.execList(t,e);return r!=null&&r.length?r[0]:void 0}async execList(t,e){if(!await this.isEmptyTable())return t(this.getDB()).execute().catch(r=>{var u;e&&((u=this.logger)==null||u.error(e,r))})}preCompile(t){return el(t(this.kysely))}async execCompiledRows(t,e){const r=await this.execCompiled(t,e);return(r==null?void 0:r.rows)??void 0}async execCompiled(t,e){if(!await this.isEmptyTable())return this.getDB().executeQuery(t).catch(r=>{var u;e&&((u=this.logger)==null||u.error(e,r))})}async toSQL(t){return t(this.getDB()).compile()}async raw(t){if(!await this.isEmptyTable())return t(Pe).execute(this.getDB())}};async function il(t){const e=await new rl({dialect:t,tables:{test:{columns:{id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"},createAt:{type:"date"},updateAt:{type:"date"}},property:{timestamp:!0}}}}).init();console.log("test"),console.log(await e.raw(r=>r`PRAGMA table_info(${r.table("test")});`)),console.log(await e.raw(r=>r`select last_insert_rowid()`));for(let r=0;r<100;r++)await e.transaction(u=>u.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}).execute());return e.exec(r=>r.selectFrom("test").selectAll().execute())}const nl=new Dc({async database(){const t=await Mc({locateFile:()=>Fc});return new t.Database(await $c("sqlijsWorker"))},onWrite:{func(t){console.log(`[sqljs worker] write to indexeddb, length: ${t.length}`),zc("sqlijsWorker",t)}}});onmessage=()=>{console.log("start sqljs test"),il(nl).then(t=>{t==null||t.forEach(e=>console.log("[sqlijs]",e))})}})();
