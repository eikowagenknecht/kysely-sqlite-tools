var Kc=Object.defineProperty;var Xc=(t,e,r)=>e in t?Kc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Pe=(t,e,r)=>(Xc(t,typeof e!="symbol"?e+"":e,r),r),to=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var s=(t,e,r)=>(to(t,e,"read from private field"),r?r.call(t):e.get(t)),B=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},H=(t,e,r,n)=>(to(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var Ie=(t,e,r)=>(to(t,e,"access private method"),r);function rr(t){return typeof t>"u"||t===void 0}function tn(t){return typeof t=="string"}function Ba(t){return typeof t=="number"}function $i(t){return typeof t=="boolean"}function Ao(t){return t===null}function Yc(t){return t instanceof Date}function Zc(t){return typeof t=="bigint"}function Ct(t){return typeof t=="function"}function Zt(t){return typeof t=="object"&&t!==null}function p(t){return Object.freeze(t)}function Pn(t){return Array.isArray(t)}function Dr(t){return t}const Xe=p({is(t){return t.kind==="AlterTableNode"},create(t){return p({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return p({...t,...e})},cloneWithColumnAlteration(t,e){return p({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),He=p({is(t){return t.kind==="IdentifierNode"},create(t){return p({kind:"IdentifierNode",name:t})}}),qn=p({is(t){return t.kind==="CreateIndexNode"},create(t){return p({kind:"CreateIndexNode",name:He.create(t)})},cloneWith(t,e){return p({...t,...e})},cloneWithColumns(t,e){return p({...t,columns:[...t.columns||[],...e]})}}),Qa=p({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return p({kind:"CreateSchemaNode",schema:He.create(t),...e})},cloneWith(t,e){return p({...t,...e})}}),eu=["preserve rows","delete rows","drop"],Dt=p({is(t){return t.kind==="CreateTableNode"},create(t){return p({kind:"CreateTableNode",table:t,columns:p([])})},cloneWithColumn(t,e){return p({...t,columns:p([...t.columns,e])})},cloneWithConstraint(t,e){return p({...t,constraints:t.constraints?p([...t.constraints,e]):p([e])})},cloneWithFrontModifier(t,e){return p({...t,frontModifiers:t.frontModifiers?p([...t.frontModifiers,e]):p([e])})},cloneWithEndModifier(t,e){return p({...t,endModifiers:t.endModifiers?p([...t.endModifiers,e]):p([e])})},cloneWith(t,e){return p({...t,...e})}}),Ln=p({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return p({kind:"SchemableIdentifierNode",identifier:He.create(t)})},createWithSchema(t,e){return p({kind:"SchemableIdentifierNode",schema:He.create(t),identifier:He.create(e)})}}),Mi=p({is(t){return t.kind==="DropIndexNode"},create(t,e){return p({kind:"DropIndexNode",name:Ln.create(t),...e})},cloneWith(t,e){return p({...t,...e})}}),io=p({is(t){return t.kind==="DropSchemaNode"},create(t,e){return p({kind:"DropSchemaNode",schema:He.create(t),...e})},cloneWith(t,e){return p({...t,...e})}}),so=p({is(t){return t.kind==="DropTableNode"},create(t,e){return p({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return p({...t,...e})}}),Rn=p({is(t){return t.kind==="AliasNode"},create(t,e){return p({kind:"AliasNode",node:t,alias:e})}}),Fn=p({is(t){return t.kind==="TableNode"},create(t){return p({kind:"TableNode",table:Ln.create(t)})},createWithSchema(t,e){return p({kind:"TableNode",table:Ln.createWithSchema(t,e)})}});function Lt(t){return Zt(t)&&Ct(t.toOperationNode)}function tu(t){return Zt(t)&&"expressionType"in t&&Lt(t)}function nu(t){return Zt(t)&&"expression"in t&&tn(t.alias)&&Lt(t)}const an=p({is(t){return t.kind==="SelectModifierNode"},create(t){return p({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return p({kind:"SelectModifierNode",rawModifier:t})}}),Wn=p({is(t){return t.kind==="AndNode"},create(t,e){return p({kind:"AndNode",left:t,right:e})}}),Qr=p({is(t){return t.kind==="OrNode"},create(t,e){return p({kind:"OrNode",left:t,right:e})}}),no=p({is(t){return t.kind==="OnNode"},create(t){return p({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return p({...t,on:e==="And"?Wn.create(t.on,r):Qr.create(t.on,r)})}}),Kr=p({is(t){return t.kind==="JoinNode"},create(t,e){return p({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return p({kind:"JoinNode",joinType:t,table:e,on:no.create(r)})},cloneWithOn(t,e){return p({...t,on:t.on?no.cloneWithOperation(t.on,"And",e):no.create(e)})}}),oi=p({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return p({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),ru=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp"],iu=["+","-","*","/","%","^","&","|","#","<<",">>"],Ua=["->","->>"],su=[...ru,...iu,"&&","||"],ou=["exists","not exists"],au=["not","-",...ou],lu=[...su,...Ua,...au,"between","between symmetric"],sr=p({is(t){return t.kind==="OperatorNode"},create(t){return p({kind:"OperatorNode",operator:t})}});function ha(t){return tn(t)&&Ua.includes(t)}const Ye=p({is(t){return t.kind==="ColumnNode"},create(t){return p({kind:"ColumnNode",column:He.create(t)})}}),ko=p({is(t){return t.kind==="SelectAllNode"},create(){return p({kind:"SelectAllNode"})}}),zs=p({is(t){return t.kind==="ReferenceNode"},create(t,e){return p({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return p({kind:"ReferenceNode",table:t,column:ko.create()})}});var yr;class cu{constructor(e){B(this,yr,void 0);H(this,yr,e)}get dynamicReference(){return s(this,yr)}get refType(){}toOperationNode(){return Ha(s(this,yr))}}yr=new WeakMap;function ja(t){return Zt(t)&&Lt(t)&&tn(t.dynamicReference)}const oo=p({is(t){return t.kind==="OrderByItemNode"},create(t,e){return p({kind:"OrderByItemNode",orderBy:t,direction:e})}}),bt=p({is(t){return t.kind==="RawNode"},create(t,e){return p({kind:"RawNode",sqlFragments:p(t),parameters:p(e)})},createWithSql(t){return bt.create([t],[])},createWithChild(t){return bt.create(["",""],[t])},createWithChildren(t){return bt.create(new Array(t.length+1).fill(""),t)}});function za(t){return t==="asc"||t==="desc"}function Vs(t){if(t.length===2)return[ro(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>ro(r)):[ro(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function ro(t,e){const r=uu(t);if(oo.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return oo.create(r,Va(e))}function uu(t){if(Oi(t))return jr(t);if(ja(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!za(r))throw new Error(`Invalid order by direction: ${r}`);return oo.create(_n(e),Va(r))}return _n(t)}function Va(t){if(t)return t==="asc"||t==="desc"?bt.createWithSql(t):t.toOperationNode()}const ao=p({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return p({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return p({...t,traversal:e})}}),$a=p({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return p({kind:"JSONOperatorChainNode",operator:t,values:p([])})},cloneWithValue(t,e){return p({...t,values:p([...t.values,e])})}}),lo=p({is(t){return t.kind==="JSONPathNode"},create(t){return p({kind:"JSONPathNode",inOperator:t,pathLegs:p([])})},cloneWithLeg(t,e){return p({...t,pathLegs:p([...t.pathLegs,e])})}});function Ha(t){return tn(t)?_n(t):t.toOperationNode()}function ai(t){return Pn(t)?t.map(e=>zt(e)):[zt(t)]}function zt(t){return Oi(t)?jr(t):Ha(t)}function du(t,e){const r=_n(t);if(ha(e))return ao.create(r,$a.create(sr.create(e)));const n=e.slice(0,-1);if(ha(n))return ao.create(r,lo.create(sr.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function _n(t){const e=".";if(!t.includes(e))return zs.create(Ye.create(t));const r=t.split(e).map(Io);if(r.length===3)return hu(r);if(r.length===2)return pu(r);throw new Error(`invalid column reference ${t}`)}function fu(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(Io);return Rn.create(_n(r),He.create(n))}else return _n(t)}function Ja(t){return Ye.create(t)}function pa(t){const e=" ";if(t.includes(e)){const[r,n]=t.split(e).map(Io);if(!za(n))throw new Error(`invalid order direction "${n}" next to "${r}"`);return Vs([r,n])[0]}else return Ja(t)}function hu(t){const[e,r,n]=t;return zs.create(Ye.create(n),Fn.createWithSchema(e,r))}function pu(t){const[e,r]=t;return zs.create(Ye.create(r),Fn.create(e))}function Io(t){return t.trim()}const Ga=p({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return p({kind:"PrimitiveValueListNode",values:p([...t])})}}),Oo=p({is(t){return t.kind==="ValueListNode"},create(t){return p({kind:"ValueListNode",values:p(t)})}}),nn=p({is(t){return t.kind==="ValueNode"},create(t){return p({kind:"ValueNode",value:t})},createImmediate(t){return p({kind:"ValueNode",value:t,immediate:!0})}});function Ka(t){return Pn(t)?_u(t):qt(t)}function qt(t){return Oi(t)?jr(t):nn.create(t)}function To(t){return Ba(t)||$i(t)||Ao(t)}function Co(t){if(!To(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return nn.createImmediate(t)}function _u(t){return t.some(Oi)?Oo.create(t.map(e=>qt(e))):Ga.create(t)}const Rr=p({is(t){return t.kind==="ParensNode"},create(t){return p({kind:"ParensNode",node:t})}});function mt(t){if(t.length===3)return Xr(t[0],t[1],t[2]);if(t.length===1)return qt(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function Xr(t,e,r){return mu(e)&&Xa(r)?oi.create(zt(t),uo(e),nn.createImmediate(r)):oi.create(zt(t),uo(e),Ka(r))}function mn(t,e,r){return oi.create(zt(t),uo(e),zt(r))}function _a(t,e){return co(Object.entries(t).filter(([,r])=>!rr(r)).map(([r,n])=>Xr(r,Xa(n)?"is":"=",n)),e)}function co(t,e){const r=e==="and"?Wn.create:Qr.create;if(t.length===0)return nn.createImmediate(e==="and");let n=ma(t[0]);for(let A=1;A<t.length;++A)n=r(n,ma(t[A]));return t.length>1?Rr.create(n):n}function mu(t){return t==="is"||t==="is not"}function Xa(t){return Ao(t)||$i(t)}function uo(t){if(tn(t)&&lu.includes(t))return sr.create(t);if(Lt(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function ma(t){return Lt(t)?t.toOperationNode():t}const Mr=p({is(t){return t.kind==="OrderByNode"},create(t){return p({kind:"OrderByNode",items:p([...t])})},cloneWithItems(t,e){return p({...t,items:p([...t.items,...e])})}}),ya=p({is(t){return t.kind==="PartitionByNode"},create(t){return p({kind:"PartitionByNode",items:p(t)})},cloneWithItems(t,e){return p({...t,items:p([...t.items,...e])})}}),fo=p({is(t){return t.kind==="OverNode"},create(){return p({kind:"OverNode"})},cloneWithOrderByItems(t,e){return p({...t,orderBy:t.orderBy?Mr.cloneWithItems(t.orderBy,e):Mr.create(e)})},cloneWithPartitionByItems(t,e){return p({...t,partitionBy:t.partitionBy?ya.cloneWithItems(t.partitionBy,e):ya.create(e)})}}),Hi=p({is(t){return t.kind==="FromNode"},create(t){return p({kind:"FromNode",froms:p(t)})},cloneWithFroms(t,e){return p({...t,froms:p([...t.froms,...e])})}}),ga=p({is(t){return t.kind==="GroupByNode"},create(t){return p({kind:"GroupByNode",items:p(t)})},cloneWithItems(t,e){return p({...t,items:p([...t.items,...e])})}}),wa=p({is(t){return t.kind==="HavingNode"},create(t){return p({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return p({...t,having:e==="And"?Wn.create(t.having,r):Qr.create(t.having,r)})}}),Se=p({is(t){return t.kind==="SelectQueryNode"},create(t){return p({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return p({kind:"SelectQueryNode",from:Hi.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return p({...t,selections:t.selections?p([...t.selections,...e]):p(e)})},cloneWithDistinctOn(t,e){return p({...t,distinctOn:t.distinctOn?p([...t.distinctOn,...e]):p(e)})},cloneWithFrontModifier(t,e){return p({...t,frontModifiers:t.frontModifiers?p([...t.frontModifiers,e]):p([e])})},cloneWithEndModifier(t,e){return p({...t,endModifiers:t.endModifiers?p([...t.endModifiers,e]):p([e])})},cloneWithOrderByItems(t,e){return p({...t,orderBy:t.orderBy?Mr.cloneWithItems(t.orderBy,e):Mr.create(e)})},cloneWithGroupByItems(t,e){return p({...t,groupBy:t.groupBy?ga.cloneWithItems(t.groupBy,e):ga.create(e)})},cloneWithLimit(t,e){return p({...t,limit:e})},cloneWithOffset(t,e){return p({...t,offset:e})},cloneWithHaving(t,e){return p({...t,having:t.having?wa.cloneWithOperation(t.having,"And",e):wa.create(e)})},cloneWithSetOperations(t,e){return p({...t,setOperations:t.setOperations?p([...t.setOperations,...e]):p([...e])})},cloneWithoutSelections(t){return p({...t,selections:[]})},cloneWithoutLimit(t){return p({...t,limit:void 0})},cloneWithoutOffset(t){return p({...t,offset:void 0})},cloneWithoutOrderBy(t){return p({...t,orderBy:void 0})}});function ke(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Rt;const ei=class ei{constructor(e){B(this,Rt,void 0);H(this,Rt,p(e))}on(...e){return new ei({...s(this,Rt),joinNode:Kr.cloneWithOn(s(this,Rt).joinNode,mt(e))})}onRef(e,r,n){return new ei({...s(this,Rt),joinNode:Kr.cloneWithOn(s(this,Rt).joinNode,mn(e,r,n))})}onTrue(){return new ei({...s(this,Rt),joinNode:Kr.cloneWithOn(s(this,Rt).joinNode,bt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return s(this,Rt).joinNode}};Rt=new WeakMap;let Ji=ei;ke(Ji,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const yu=p({is(t){return t.kind==="PartitionByItemNode"},create(t){return p({kind:"PartitionByItemNode",partitionBy:t})}});function gu(t){return ai(t).map(yu.create)}var Vn;const Ns=class Ns{constructor(e){B(this,Vn,void 0);H(this,Vn,p(e))}orderBy(e,r){return new Ns({overNode:fo.cloneWithOrderByItems(s(this,Vn).overNode,Vs([e,r]))})}partitionBy(e){return new Ns({overNode:fo.cloneWithPartitionByItems(s(this,Vn).overNode,gu(e))})}$call(e){return e(this)}toOperationNode(){return s(this,Vn).overNode}};Vn=new WeakMap;let Gi=Ns;ke(Gi,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const Yr=p({is(t){return t.kind==="SelectionNode"},create(t){return p({kind:"SelectionNode",selection:t})},createSelectAll(){return p({kind:"SelectionNode",selection:ko.create()})},createSelectAllFromTable(t){return p({kind:"SelectionNode",selection:zs.createSelectAll(t)})}});function or(t){return Ct(t)?or(t(Ur())):Pn(t)?t.map(e=>ba(e)):[ba(t)]}function ba(t){return tn(t)?Yr.create(fu(t)):ja(t)?Yr.create(t.toOperationNode()):Yr.create(dl(t))}function ki(t){return t?Array.isArray(t)?t.map(qa):[qa(t)]:[Yr.createSelectAll()]}function qa(t){if(tn(t))return Yr.createSelectAllFromTable(Et(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const wu=p({is(t){return t.kind==="ValuesNode"},create(t){return p({kind:"ValuesNode",values:p(t)})}}),bu=p({is(t){return t.kind==="DefaultInsertValueNode"},create(){return p({kind:"DefaultInsertValueNode"})}});function qu(t){const e=Ct(t)?t(Ur()):t,r=Pn(e)?e:p([e]);return Nu(r)}function Nu(t){const e=vu(t);return[p([...e.keys()].map(Ye.create)),wu.create(t.map(r=>xu(r,e)))]}function vu(t){const e=new Map;for(const r of t){const n=Object.keys(r);for(const A of n)!e.has(A)&&r[A]!==void 0&&e.set(A,e.size)}return e}function xu(t,e){const r=Object.keys(t),n=Array.from({length:e.size});let A=!1;for(const te of r){const Ae=e.get(te);if(rr(Ae))continue;const Le=t[te];(rr(Le)||Oi(Le))&&(A=!0),n[Ae]=Le}if(r.length<e.size||A){const te=bu.create();return Oo.create(n.map(Ae=>rr(Ae)?te:qt(Ae)))}return Ga.create(n)}const Yt=p({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return p({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return p({...t,...e})}}),Ki=p({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return p({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return p({...t,from:t.from?Hi.cloneWithFroms(t.from,e):Hi.create(e)})},cloneWithUpdates(t,e){return p({...t,updates:t.updates?p([...t.updates,...e]):e})}}),Na=p({is(t){return t.kind==="UsingNode"},create(t){return p({kind:"UsingNode",tables:p(t)})},cloneWithTables(t,e){return p({...t,tables:p([...t.tables,...e])})}}),Zr=p({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return p({kind:"DeleteQueryNode",from:Hi.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return p({...t,orderBy:t.orderBy?Mr.cloneWithItems(t.orderBy,e):Mr.create(e)})},cloneWithLimit(t,e){return p({...t,limit:e})},cloneWithUsing(t,e){return p({...t,using:t.using!==void 0?Na.cloneWithTables(t.using,e):Na.create(e)})}}),vt=p({is(t){return t.kind==="WhereNode"},create(t){return p({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return p({...t,where:e==="And"?Wn.create(t.where,r):Qr.create(t.where,r)})}}),va=p({is(t){return t.kind==="ReturningNode"},create(t){return p({kind:"ReturningNode",selections:p(t)})},cloneWithSelections(t,e){return p({...t,selections:t.selections?p([...t.selections,...e]):p(e)})}}),Eu=p({is(t){return t.kind==="ExplainNode"},create(t,e){return p({kind:"ExplainNode",format:t,options:e})}}),xe=p({is(t){return Se.is(t)||Yt.is(t)||Ki.is(t)||Zr.is(t)},cloneWithWhere(t,e){return p({...t,where:t.where?vt.cloneWithOperation(t.where,"And",e):vt.create(e)})},cloneWithJoin(t,e){return p({...t,joins:t.joins?p([...t.joins,e]):p([e])})},cloneWithReturning(t,e){return p({...t,returning:t.returning?va.cloneWithSelections(t.returning,e):va.create(e)})},cloneWithoutWhere(t){return p({...t,where:void 0})},cloneWithExplain(t,e,r){return p({...t,explain:Eu.create(e,r?.toOperationNode())})}}),Su=p({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return p({kind:"ColumnUpdateNode",column:t,value:e})}});function Fo(t){const e=Ct(t)?t(Ur()):t;return Object.entries(e).filter(([r,n])=>n!==void 0).map(([r,n])=>Su.create(Ye.create(r),qt(n)))}const Au=p({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return p({kind:"OnDuplicateKeyNode",updates:t})}});class ku{constructor(e,r){Pe(this,"insertId");Pe(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class $s extends Error{constructor(r){super("no result");Pe(this,"node");this.node=r}}function Hs(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Tt=p({is(t){return t.kind==="OnConflictNode"},create(){return p({kind:"OnConflictNode"})},cloneWith(t,e){return p({...t,...e})},cloneWithIndexWhere(t,e){return p({...t,indexWhere:t.indexWhere?vt.cloneWithOperation(t.indexWhere,"And",e):vt.create(e)})},cloneWithIndexOrWhere(t,e){return p({...t,indexWhere:t.indexWhere?vt.cloneWithOperation(t.indexWhere,"Or",e):vt.create(e)})},cloneWithUpdateWhere(t,e){return p({...t,updateWhere:t.updateWhere?vt.cloneWithOperation(t.updateWhere,"And",e):vt.create(e)})},cloneWithUpdateOrWhere(t,e){return p({...t,updateWhere:t.updateWhere?vt.cloneWithOperation(t.updateWhere,"Or",e):vt.create(e)})},cloneWithoutIndexWhere(t){return p({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return p({...t,updateWhere:void 0})}});var je;const cn=class cn{constructor(e){B(this,je,void 0);H(this,je,p(e))}column(e){const r=Ye.create(e);return new cn({...s(this,je),onConflictNode:Tt.cloneWith(s(this,je).onConflictNode,{columns:s(this,je).onConflictNode.columns?p([...s(this,je).onConflictNode.columns,r]):p([r])})})}columns(e){const r=e.map(Ye.create);return new cn({...s(this,je),onConflictNode:Tt.cloneWith(s(this,je).onConflictNode,{columns:s(this,je).onConflictNode.columns?p([...s(this,je).onConflictNode.columns,...r]):p(r)})})}constraint(e){return new cn({...s(this,je),onConflictNode:Tt.cloneWith(s(this,je).onConflictNode,{constraint:He.create(e)})})}expression(e){return new cn({...s(this,je),onConflictNode:Tt.cloneWith(s(this,je).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new cn({...s(this,je),onConflictNode:Tt.cloneWithIndexWhere(s(this,je).onConflictNode,mt(e))})}whereRef(e,r,n){return new cn({...s(this,je),onConflictNode:Tt.cloneWithIndexWhere(s(this,je).onConflictNode,mn(e,r,n))})}clearWhere(){return new cn({...s(this,je),onConflictNode:Tt.cloneWithoutIndexWhere(s(this,je).onConflictNode)})}doNothing(){return new Ya({...s(this,je),onConflictNode:Tt.cloneWith(s(this,je).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Yi({...s(this,je),onConflictNode:Tt.cloneWith(s(this,je).onConflictNode,{updates:Fo(e)})})}$call(e){return e(this)}};je=new WeakMap;let Xi=cn;ke(Xi,"don't await OnConflictBuilder instances.");var pi;class Ya{constructor(e){B(this,pi,void 0);H(this,pi,p(e))}toOperationNode(){return s(this,pi).onConflictNode}}pi=new WeakMap;ke(Ya,"don't await OnConflictDoNothingBuilder instances.");var Mt;const ti=class ti{constructor(e){B(this,Mt,void 0);H(this,Mt,p(e))}where(...e){return new ti({...s(this,Mt),onConflictNode:Tt.cloneWithUpdateWhere(s(this,Mt).onConflictNode,mt(e))})}whereRef(e,r,n){return new ti({...s(this,Mt),onConflictNode:Tt.cloneWithUpdateWhere(s(this,Mt).onConflictNode,mn(e,r,n))})}clearWhere(){return new ti({...s(this,Mt),onConflictNode:Tt.cloneWithoutUpdateWhere(s(this,Mt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return s(this,Mt).onConflictNode}};Mt=new WeakMap;let Yi=ti;ke(Yi,"don't await OnConflictUpdateBuilder instances.");var ve;const pt=class pt{constructor(e){B(this,ve,void 0);H(this,ve,p(e))}values(e){const[r,n]=qu(e);return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{columns:r,values:n})})}columns(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{columns:p(e.map(Ye.create))})})}expression(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{values:jr(e)})})}ignore(){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{ignore:!0})})}onConflict(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{onConflict:e(new Xi({onConflictNode:Tt.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{onDuplicateKey:Au.create(Fo(e))})})}returning(e){return new pt({...s(this,ve),queryNode:xe.cloneWithReturning(s(this,ve).queryNode,or(e))})}returningAll(){return new pt({...s(this,ve),queryNode:xe.cloneWithReturning(s(this,ve).queryNode,ki())})}$call(e){return e(this)}$if(e,r){return e?r(this):new pt({...s(this,ve)})}$castTo(){return new pt(s(this,ve))}$narrowType(){return new pt(s(this,ve))}$assertType(){return new pt(s(this,ve))}withPlugin(e){return new pt({...s(this,ve),executor:s(this,ve).executor.withPlugin(e)})}toOperationNode(){return s(this,ve).executor.transformQuery(s(this,ve).queryNode,s(this,ve).queryId)}compile(){return s(this,ve).executor.compileQuery(this.toOperationNode(),s(this,ve).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,ve).executor.executeQuery(e,s(this,ve).queryId);return s(this,ve).executor.adapter.supportsReturning&&r.returning?n.rows:[new ku(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=$s){const r=await this.executeTakeFirst();if(r===void 0)throw Hs(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,ve).executor.stream(r,e,s(this,ve).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new pt({...s(this,ve),queryNode:xe.cloneWithExplain(s(this,ve).queryNode,e,r)}).execute()}};ve=new WeakMap;let li=pt;ke(li,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Iu{constructor(e){Pe(this,"numDeletedRows");this.numDeletedRows=e}}const Za=p({is(t){return t.kind==="LimitNode"},create(t){return p({kind:"LimitNode",limit:nn.create(t)})}});var pe;const tt=class tt{constructor(e){B(this,pe,void 0);H(this,pe,p(e))}where(...e){return new tt({...s(this,pe),queryNode:xe.cloneWithWhere(s(this,pe).queryNode,mt(e))})}whereRef(e,r,n){return new tt({...s(this,pe),queryNode:xe.cloneWithWhere(s(this,pe).queryNode,mn(e,r,n))})}clearWhere(){return new tt({...s(this,pe),queryNode:xe.cloneWithoutWhere(s(this,pe).queryNode)})}using(e){return new tt({...s(this,pe),queryNode:Zr.cloneWithUsing(s(this,pe).queryNode,ui(e))})}innerJoin(...e){return new tt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,xt("InnerJoin",e))})}leftJoin(...e){return new tt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,xt("LeftJoin",e))})}rightJoin(...e){return new tt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,xt("RightJoin",e))})}fullJoin(...e){return new tt({...s(this,pe),queryNode:xe.cloneWithJoin(s(this,pe).queryNode,xt("FullJoin",e))})}returning(e){return new tt({...s(this,pe),queryNode:xe.cloneWithReturning(s(this,pe).queryNode,or(e))})}returningAll(e){return new tt({...s(this,pe),queryNode:xe.cloneWithReturning(s(this,pe).queryNode,ki(e))})}orderBy(e,r){return new tt({...s(this,pe),queryNode:Zr.cloneWithOrderByItems(s(this,pe).queryNode,Vs([e,r]))})}limit(e){return new tt({...s(this,pe),queryNode:Zr.cloneWithLimit(s(this,pe).queryNode,Za.create(e))})}$call(e){return e(this)}$if(e,r){return e?r(this):new tt({...s(this,pe)})}$castTo(){return new tt(s(this,pe))}$narrowType(){return new tt(s(this,pe))}$assertType(){return new tt(s(this,pe))}withPlugin(e){return new tt({...s(this,pe),executor:s(this,pe).executor.withPlugin(e)})}toOperationNode(){return s(this,pe).executor.transformQuery(s(this,pe).queryNode,s(this,pe).queryId)}compile(){return s(this,pe).executor.compileQuery(this.toOperationNode(),s(this,pe).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,pe).executor.executeQuery(e,s(this,pe).queryId);return s(this,pe).executor.adapter.supportsReturning&&r.returning?n.rows:[new Iu(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=$s){const r=await this.executeTakeFirst();if(r===void 0)throw Hs(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,pe).executor.stream(r,e,s(this,pe).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new tt({...s(this,pe),queryNode:xe.cloneWithExplain(s(this,pe).queryNode,e,r)}).execute()}};pe=new WeakMap;let Zi=tt;ke(Zi,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Ou{constructor(e,r){Pe(this,"numUpdatedRows");Pe(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}var me;const it=class it{constructor(e){B(this,me,void 0);H(this,me,p(e))}where(...e){return new it({...s(this,me),queryNode:xe.cloneWithWhere(s(this,me).queryNode,mt(e))})}whereRef(e,r,n){return new it({...s(this,me),queryNode:xe.cloneWithWhere(s(this,me).queryNode,mn(e,r,n))})}clearWhere(){return new it({...s(this,me),queryNode:xe.cloneWithoutWhere(s(this,me).queryNode)})}from(e){return new it({...s(this,me),queryNode:Ki.cloneWithFromItems(s(this,me).queryNode,ui(e))})}innerJoin(...e){return new it({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,xt("InnerJoin",e))})}leftJoin(...e){return new it({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,xt("LeftJoin",e))})}rightJoin(...e){return new it({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,xt("RightJoin",e))})}fullJoin(...e){return new it({...s(this,me),queryNode:xe.cloneWithJoin(s(this,me).queryNode,xt("FullJoin",e))})}set(e){return new it({...s(this,me),queryNode:Ki.cloneWithUpdates(s(this,me).queryNode,Fo(e))})}returning(e){return new it({...s(this,me),queryNode:xe.cloneWithReturning(s(this,me).queryNode,or(e))})}returningAll(){return new it({...s(this,me),queryNode:xe.cloneWithReturning(s(this,me).queryNode,ki())})}$call(e){return e(this)}$if(e,r){return e?r(this):new it({...s(this,me)})}$castTo(){return new it(s(this,me))}$narrowType(){return new it(s(this,me))}$assertType(){return new it(s(this,me))}withPlugin(e){return new it({...s(this,me),executor:s(this,me).executor.withPlugin(e)})}toOperationNode(){return s(this,me).executor.transformQuery(s(this,me).queryNode,s(this,me).queryId)}compile(){return s(this,me).executor.compileQuery(this.toOperationNode(),s(this,me).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,me).executor.executeQuery(e,s(this,me).queryId);return s(this,me).executor.adapter.supportsReturning&&r.returning?n.rows:[new Ou(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=$s){const r=await this.executeTakeFirst();if(r===void 0)throw Hs(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,me).executor.stream(r,e,s(this,me).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new it({...s(this,me),queryNode:xe.cloneWithExplain(s(this,me).queryNode,e,r)}).execute()}};me=new WeakMap;let es=it;ke(es,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const xa=p({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return p({kind:"CommonTableExpressionNameNode",table:Fn.create(t),columns:e?p(e.map(Ye.create)):void 0})}}),ts=p({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return p({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return p({...t,...e})}});var un;const vs=class vs{constructor(e){B(this,un,void 0);H(this,un,p(e))}materialized(){return new vs({...s(this,un),node:ts.cloneWith(s(this,un).node,{materialized:!0})})}notMaterialized(){return new vs({...s(this,un),node:ts.cloneWith(s(this,un).node,{materialized:!1})})}toOperationNode(){return s(this,un).node}};un=new WeakMap;let ns=vs;ke(ns,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function Ea(t,e){const r=e(Bu()).toOperationNode();return Ct(t)?t(Tu(r)).toOperationNode():ts.create(el(t),r)}function Tu(t){return e=>new ns({node:ts.create(el(e),t)})}function el(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],n=e[1].split(",").map(A=>A.trim());return xa.create(r,n)}else return xa.create(t)}const Wi=p({is(t){return t.kind==="WithNode"},create(t,e){return p({kind:"WithNode",expressions:p([t]),...e})},cloneWithExpression(t,e){return p({...t,expressions:p([...t.expressions,e])})}}),Sa=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Cu(t){let e="";for(let r=0;r<t;++r)e+=Fu();return e}function Fu(){return Sa[~~(Math.random()*Sa.length)]}function De(){return new Pu}var gr;class Pu{constructor(){B(this,gr,void 0)}get queryId(){return s(this,gr)===void 0&&H(this,gr,Cu(8)),s(this,gr)}}gr=new WeakMap;var xs;class Po{constructor(){Pe(this,"nodeStack",[]);B(this,xs,p({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),p(r)}transformNodeImpl(e){return s(this,xs)[e.kind](e)}transformNodeList(e){return e&&p(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:p([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}xs=new WeakMap;const Lu=p({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});var wr,$n,Hn,Es,tl,Ss,nl,As,rl,Jn,Gr,_i,ho,ks,il;class Wu extends Po{constructor(r){super();B(this,Es);B(this,Ss);B(this,As);B(this,Jn);B(this,_i);B(this,ks);B(this,wr,void 0);B(this,$n,new Set);B(this,Hn,new Set);H(this,wr,r)}transformNodeImpl(r){if(!Ie(this,Es,tl).call(this,r))return super.transformNodeImpl(r);const n=Ie(this,As,rl).call(this,r);for(const te of n)s(this,Hn).add(te);const A=Ie(this,Ss,nl).call(this,r);for(const te of A)s(this,$n).add(te);const U=super.transformNodeImpl(r);for(const te of A)s(this,$n).delete(te);for(const te of n)s(this,Hn).delete(te);return U}transformSchemableIdentifier(r){const n=super.transformSchemableIdentifier(r);return n.schema||!s(this,$n).has(r.identifier.name)?n:{...n,schema:He.create(s(this,wr))}}transformReferences(r){const n=super.transformReferences(r);return n.table.table.schema?n:{...n,table:Fn.createWithSchema(s(this,wr),n.table.table.identifier.name)}}}wr=new WeakMap,$n=new WeakMap,Hn=new WeakMap,Es=new WeakSet,tl=function(r){return r.kind in Lu},Ss=new WeakSet,nl=function(r){const n=new Set;if("name"in r&&r.name&&Ln.is(r.name)&&Ie(this,_i,ho).call(this,r.name,n),"from"in r&&r.from)for(const A of r.from.froms)Ie(this,Jn,Gr).call(this,A,n);if("into"in r&&r.into&&Ie(this,Jn,Gr).call(this,r.into,n),"table"in r&&r.table&&Ie(this,Jn,Gr).call(this,r.table,n),"joins"in r&&r.joins)for(const A of r.joins)Ie(this,Jn,Gr).call(this,A.table,n);return n},As=new WeakSet,rl=function(r){const n=new Set;return"with"in r&&r.with&&Ie(this,ks,il).call(this,r.with,n),n},Jn=new WeakSet,Gr=function(r,n){const A=Fn.is(r)?r:Rn.is(r)&&Fn.is(r.node)?r.node:null;A&&Ie(this,_i,ho).call(this,A.table,n)},_i=new WeakSet,ho=function(r,n){const A=r.identifier.name;!s(this,$n).has(A)&&!s(this,Hn).has(A)&&n.add(A)},ks=new WeakSet,il=function(r,n){for(const A of r.expressions){const U=A.name.table.table.identifier.name;s(this,Hn).has(U)||n.add(U)}};var mi;class Ii{constructor(e){B(this,mi,void 0);H(this,mi,new Wu(e))}transformQuery(e){return s(this,mi).transformNode(e.node)}async transformResult(e){return e.result}}mi=new WeakMap;var We;const Un=class Un{constructor(e){B(this,We,void 0);H(this,We,p(e))}selectFrom(e){return ss({queryId:De(),executor:s(this,We).executor,queryNode:Se.createFrom(ui(e),s(this,We).withNode)})}selectNoFrom(e){return ss({queryId:De(),executor:s(this,We).executor,queryNode:Se.cloneWithSelections(Se.create(s(this,We).withNode),or(e))})}insertInto(e){return new li({queryId:De(),executor:s(this,We).executor,queryNode:Yt.create(Et(e),s(this,We).withNode)})}replaceInto(e){return new li({queryId:De(),executor:s(this,We).executor,queryNode:Yt.create(Et(e),s(this,We).withNode,!0)})}deleteFrom(e){return new Zi({queryId:De(),executor:s(this,We).executor,queryNode:Zr.create(ui(e),s(this,We).withNode)})}updateTable(e){return new es({queryId:De(),executor:s(this,We).executor,queryNode:Ki.create(di(e),s(this,We).withNode)})}with(e,r){const n=Ea(e,r);return new Un({...s(this,We),withNode:s(this,We).withNode?Wi.cloneWithExpression(s(this,We).withNode,n):Wi.create(n)})}withRecursive(e,r){const n=Ea(e,r);return new Un({...s(this,We),withNode:s(this,We).withNode?Wi.cloneWithExpression(s(this,We).withNode,n):Wi.create(n,{recursive:!0})})}withPlugin(e){return new Un({...s(this,We),executor:s(this,We).executor.withPlugin(e)})}withoutPlugins(){return new Un({...s(this,We),executor:s(this,We).executor.withoutPlugins()})}withSchema(e){return new Un({...s(this,We),executor:s(this,We).executor.withPluginAtFront(new Ii(e))})}};We=new WeakMap;let rs=Un;var yi,br,qr;class Aa{constructor(){B(this,yi,void 0);B(this,br,void 0);B(this,qr,void 0);Pe(this,"resolve",e=>{s(this,br)&&s(this,br).call(this,e)});Pe(this,"reject",e=>{s(this,qr)&&s(this,qr).call(this,e)});H(this,yi,new Promise((e,r)=>{H(this,qr,r),H(this,br,e)}))}get promise(){return s(this,yi)}}yi=new WeakMap,br=new WeakMap,qr=new WeakMap;const ka=new Set;function Du(t){ka.has(t)||(ka.add(t),console.log(t))}const Ru=p([]);var Gn,gi,po;class sl{constructor(e=Ru){B(this,gi);B(this,Gn,void 0);H(this,Gn,e)}get plugins(){return s(this,Gn)}transformQuery(e,r){for(const n of s(this,Gn)){const A=n.transformQuery({node:e,queryId:r});if(A.kind===e.kind)e=A;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${A.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async n=>{const A=await n.executeQuery(e),U=await Ie(this,gi,po).call(this,A,r);return Mu(A,U),U})}async*stream(e,r,n){const A=new Aa,U=new Aa;this.provideConnection(async Ae=>(A.resolve(Ae),await U.promise)).catch(Ae=>A.reject(Ae));const te=await A.promise;try{for await(const Ae of te.streamQuery(e,r))yield await Ie(this,gi,po).call(this,Ae,n)}finally{U.resolve()}}}Gn=new WeakMap,gi=new WeakSet,po=async function(e,r){for(const n of s(this,Gn))e=await n.transformResult({result:e,queryId:r});return e};function Mu(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Du("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class fr extends sl{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new fr([...this.plugins,e])}withPlugins(e){return new fr([...this.plugins,...e])}withPluginAtFront(e){return new fr([e,...this.plugins])}withoutPlugins(){return new fr([])}}const Lo=new fr;function Bu(){return new rs({executor:Lo})}function Qu(t,e){return new Ji({joinNode:Kr.create(t,di(e))})}function Uu(){return new Gi({overNode:fo.create()})}function xt(t,e){if(e.length===3)return zu(t,e[0],e[1],e[2]);if(e.length===2)return ju(t,e[0],e[1]);throw new Error("not implemented")}function ju(t,e,r){return r(Qu(t,e)).toOperationNode()}function zu(t,e,r,n){return Kr.createWithOn(t,di(e),mn(r,"=",n))}const Vu=p({is(t){return t.kind==="OffsetNode"},create(t){return p({kind:"OffsetNode",offset:nn.create(t)})}}),$u=p({is(t){return t.kind==="GroupByItemNode"},create(t){return p({kind:"GroupByItemNode",groupBy:t})}});function Hu(t){return t=Ct(t)?t(Ur()):t,ai(t).map($u.create)}const ol=p({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return p({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function ur(t,e,r){return Ct(e)&&(e=e(Ro())),Pn(e)||(e=[e]),e.map(n=>ol.create(t,jr(n),r))}var En;const Uo=class Uo{constructor(e){B(this,En,void 0);H(this,En,e)}get expressionType(){}as(e){return new Wo(this,e)}or(...e){return new _o(Qr.create(s(this,En),mt(e)))}and(...e){return new mo(Wn.create(s(this,En),mt(e)))}$castTo(){return new Uo(s(this,En))}toOperationNode(){return s(this,En)}};En=new WeakMap;let Ve=Uo;var Nr,Sn;class Wo{constructor(e,r){B(this,Nr,void 0);B(this,Sn,void 0);H(this,Nr,e),H(this,Sn,r)}get expression(){return s(this,Nr)}get alias(){return s(this,Sn)}toOperationNode(){return Rn.create(s(this,Nr).toOperationNode(),Lt(s(this,Sn))?s(this,Sn).toOperationNode():He.create(s(this,Sn)))}}Nr=new WeakMap,Sn=new WeakMap;var Kn;const Is=class Is{constructor(e){B(this,Kn,void 0);H(this,Kn,e)}get expressionType(){}as(e){return new Wo(this,e)}or(...e){return new Is(Qr.create(s(this,Kn),mt(e)))}$castTo(){return new Is(s(this,Kn))}toOperationNode(){return Rr.create(s(this,Kn))}};Kn=new WeakMap;let _o=Is;var Xn;const Os=class Os{constructor(e){B(this,Xn,void 0);H(this,Xn,e)}get expressionType(){}as(e){return new Wo(this,e)}and(...e){return new Os(Wn.create(s(this,Xn),mt(e)))}$castTo(){return new Os(s(this,Xn))}toOperationNode(){return Rr.create(s(this,Xn))}};Xn=new WeakMap;let mo=Os;var G;const _e=class _e{constructor(e){B(this,G,void 0);H(this,G,p(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new _e({...s(this,G),queryNode:xe.cloneWithWhere(s(this,G).queryNode,mt(e))})}whereRef(e,r,n){return new _e({...s(this,G),queryNode:xe.cloneWithWhere(s(this,G).queryNode,mn(e,r,n))})}having(...e){return new _e({...s(this,G),queryNode:Se.cloneWithHaving(s(this,G).queryNode,mt(e))})}havingRef(e,r,n){return new _e({...s(this,G),queryNode:Se.cloneWithHaving(s(this,G).queryNode,mn(e,r,n))})}select(e){return new _e({...s(this,G),queryNode:Se.cloneWithSelections(s(this,G).queryNode,or(e))})}distinctOn(e){return new _e({...s(this,G),queryNode:Se.cloneWithDistinctOn(s(this,G).queryNode,ai(e))})}modifyFront(e){return new _e({...s(this,G),queryNode:Se.cloneWithFrontModifier(s(this,G).queryNode,an.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.createWithExpression(e.toOperationNode()))})}distinct(){return new _e({...s(this,G),queryNode:Se.cloneWithFrontModifier(s(this,G).queryNode,an.create("Distinct"))})}forUpdate(){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.create("ForUpdate"))})}forShare(){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.create("ForShare"))})}forKeyShare(){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.create("ForKeyShare"))})}forNoKeyUpdate(){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.create("ForNoKeyUpdate"))})}skipLocked(){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.create("SkipLocked"))})}noWait(){return new _e({...s(this,G),queryNode:Se.cloneWithEndModifier(s(this,G).queryNode,an.create("NoWait"))})}selectAll(e){return new _e({...s(this,G),queryNode:Se.cloneWithSelections(s(this,G).queryNode,ki(e))})}innerJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,xt("InnerJoin",e))})}leftJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,xt("LeftJoin",e))})}rightJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,xt("RightJoin",e))})}fullJoin(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,xt("FullJoin",e))})}innerJoinLateral(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,xt("LateralInnerJoin",e))})}leftJoinLateral(...e){return new _e({...s(this,G),queryNode:xe.cloneWithJoin(s(this,G).queryNode,xt("LateralLeftJoin",e))})}orderBy(...e){return new _e({...s(this,G),queryNode:Se.cloneWithOrderByItems(s(this,G).queryNode,Vs(e))})}groupBy(e){return new _e({...s(this,G),queryNode:Se.cloneWithGroupByItems(s(this,G).queryNode,Hu(e))})}limit(e){return new _e({...s(this,G),queryNode:Se.cloneWithLimit(s(this,G).queryNode,Za.create(e))})}offset(e){return new _e({...s(this,G),queryNode:Se.cloneWithOffset(s(this,G).queryNode,Vu.create(e))})}union(e){return new _e({...s(this,G),queryNode:Se.cloneWithSetOperations(s(this,G).queryNode,ur("union",e,!1))})}unionAll(e){return new _e({...s(this,G),queryNode:Se.cloneWithSetOperations(s(this,G).queryNode,ur("union",e,!0))})}intersect(e){return new _e({...s(this,G),queryNode:Se.cloneWithSetOperations(s(this,G).queryNode,ur("intersect",e,!1))})}intersectAll(e){return new _e({...s(this,G),queryNode:Se.cloneWithSetOperations(s(this,G).queryNode,ur("intersect",e,!0))})}except(e){return new _e({...s(this,G),queryNode:Se.cloneWithSetOperations(s(this,G).queryNode,ur("except",e,!1))})}exceptAll(e){return new _e({...s(this,G),queryNode:Se.cloneWithSetOperations(s(this,G).queryNode,ur("except",e,!0))})}as(e){return new al(this,e)}clearSelect(){return new _e({...s(this,G),queryNode:Se.cloneWithoutSelections(s(this,G).queryNode)})}clearWhere(){return new _e({...s(this,G),queryNode:xe.cloneWithoutWhere(s(this,G).queryNode)})}clearLimit(){return new _e({...s(this,G),queryNode:Se.cloneWithoutLimit(s(this,G).queryNode)})}clearOffset(){return new _e({...s(this,G),queryNode:Se.cloneWithoutOffset(s(this,G).queryNode)})}clearOrderBy(){return new _e({...s(this,G),queryNode:Se.cloneWithoutOrderBy(s(this,G).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new _e({...s(this,G)})}$castTo(){return new _e(s(this,G))}$narrowType(){return new _e(s(this,G))}$assertType(){return new _e(s(this,G))}$asTuple(){return new Ve(this.toOperationNode())}withPlugin(e){return new _e({...s(this,G),executor:s(this,G).executor.withPlugin(e)})}toOperationNode(){return s(this,G).executor.transformQuery(s(this,G).queryNode,s(this,G).queryId)}compile(){return s(this,G).executor.compileQuery(this.toOperationNode(),s(this,G).queryId)}async execute(){const e=this.compile();return(await s(this,G).executor.executeQuery(e,s(this,G).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=$s){const r=await this.executeTakeFirst();if(r===void 0)throw Hs(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,G).executor.stream(r,e,s(this,G).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new _e({...s(this,G),queryNode:xe.cloneWithExplain(s(this,G).queryNode,e,r)}).execute()}};G=new WeakMap;let is=_e;ke(is,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function ss(t){return new is(t)}var vr,xr;class al{constructor(e,r){B(this,vr,void 0);B(this,xr,void 0);H(this,vr,e),H(this,xr,r)}get expression(){return s(this,vr)}get alias(){return s(this,xr)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Rn.create(s(this,vr).toOperationNode(),He.create(s(this,xr)))}}vr=new WeakMap,xr=new WeakMap;ke(al,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const hr=p({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return p({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return p({...t,distinct:!0})},cloneWithFilter(t,e){return p({...t,filter:t.filter?vt.cloneWithOperation(t.filter,"And",e):vt.create(e)})},cloneWithOrFilter(t,e){return p({...t,filter:t.filter?vt.cloneWithOperation(t.filter,"Or",e):vt.create(e)})},cloneWithOver(t,e){return p({...t,over:e})}}),Ju=p({is(t){return t.kind==="FunctionNode"},create(t,e){return p({kind:"FunctionNode",func:t,arguments:e})}});var At;const pr=class pr{constructor(e){B(this,At,void 0);H(this,At,p(e))}get expressionType(){}as(e){return new Gu(this,e)}distinct(){return new pr({...s(this,At),aggregateFunctionNode:hr.cloneWithDistinct(s(this,At).aggregateFunctionNode)})}filterWhere(...e){return new pr({...s(this,At),aggregateFunctionNode:hr.cloneWithFilter(s(this,At).aggregateFunctionNode,mt(e))})}filterWhereRef(e,r,n){return new pr({...s(this,At),aggregateFunctionNode:hr.cloneWithFilter(s(this,At).aggregateFunctionNode,mn(e,r,n))})}over(e){const r=Uu();return new pr({...s(this,At),aggregateFunctionNode:hr.cloneWithOver(s(this,At).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return s(this,At).aggregateFunctionNode}};At=new WeakMap;let ci=pr;ke(ci,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var Er,Sr;class Gu{constructor(e,r){B(this,Er,void 0);B(this,Sr,void 0);H(this,Er,e),H(this,Sr,r)}get expression(){return s(this,Er)}get alias(){return s(this,Sr)}toOperationNode(){return Rn.create(s(this,Er).toOperationNode(),He.create(s(this,Sr)))}}Er=new WeakMap,Sr=new WeakMap;function ll(){const t=(r,n)=>new Ve(Ju.create(r,ai(n))),e=(r,n)=>new ci({aggregateFunctionNode:hr.create(r,n?ai(n):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(r,...n){return t("coalesce",[r,...n])},count(r){return e("count",[r])},countAll(r){return new ci({aggregateFunctionNode:hr.create("count",ki(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])}})}const Ku=p({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return p({kind:"UnaryOperationNode",operator:t,operand:e})}});function Xu(t,e){return Ku.create(sr.create(t),zt(e))}const Do=p({is(t){return t.kind==="WhenNode"},create(t){return p({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return p({...t,result:e})}}),en=p({is(t){return t.kind==="CaseNode"},create(t){return p({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return p({...t,when:p(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return p({...t,when:t.when?p([...t.when.slice(0,-1),Do.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return p({...t,...e})}});var Ar;class cl{constructor(e){B(this,Ar,void 0);H(this,Ar,p(e))}when(...e){return new ul({...s(this,Ar),node:en.cloneWithWhen(s(this,Ar).node,Do.create(mt(e)))})}}Ar=new WeakMap;var kr;class ul{constructor(e){B(this,kr,void 0);H(this,kr,p(e))}then(e){return new Yu({...s(this,kr),node:en.cloneWithThen(s(this,kr).node,To(e)?Co(e):qt(e))})}}kr=new WeakMap;var Gt;class Yu{constructor(e){B(this,Gt,void 0);H(this,Gt,p(e))}when(...e){return new ul({...s(this,Gt),node:en.cloneWithWhen(s(this,Gt).node,Do.create(mt(e)))})}else(e){return new Zu({...s(this,Gt),node:en.cloneWith(s(this,Gt).node,{else:To(e)?Co(e):qt(e)})})}end(){return new Ve(en.cloneWith(s(this,Gt).node,{isStatement:!1}))}endCase(){return new Ve(en.cloneWith(s(this,Gt).node,{isStatement:!0}))}}Gt=new WeakMap;var Ir;class Zu{constructor(e){B(this,Ir,void 0);H(this,Ir,p(e))}end(){return new Ve(en.cloneWith(s(this,Ir).node,{isStatement:!1}))}endCase(){return new Ve(en.cloneWith(s(this,Ir).node,{isStatement:!0}))}}Ir=new WeakMap;const ed=p({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return p({kind:"JSONPathLegNode",type:t,value:e})}});var An,wi,go;class yo{constructor(e){B(this,wi);B(this,An,void 0);H(this,An,e)}at(e){return Ie(this,wi,go).call(this,"ArrayLocation",e)}key(e){return Ie(this,wi,go).call(this,"Member",e)}}An=new WeakMap,wi=new WeakSet,go=function(e,r){return new td(ao.cloneWithTraversal(s(this,An),lo.is(s(this,An).traversal)?lo.cloneWithLeg(s(this,An).traversal,ed.create(e,r)):$a.cloneWithValue(s(this,An).traversal,nn.createImmediate(r))))};var Or;class td extends yo{constructor(r){super(r);B(this,Or,void 0);H(this,Or,r)}get expressionType(){}as(r){return new nd(this,r)}$castTo(){return new yo(s(this,Or))}toOperationNode(){return s(this,Or)}}Or=new WeakMap;var Tr,kn;class nd{constructor(e,r){B(this,Tr,void 0);B(this,kn,void 0);H(this,Tr,e),H(this,kn,r)}get expression(){return s(this,Tr)}get alias(){return s(this,kn)}toOperationNode(){return Rn.create(s(this,Tr).toOperationNode(),Lt(s(this,kn))?s(this,kn).toOperationNode():He.create(s(this,kn)))}}Tr=new WeakMap,kn=new WeakMap;const Ia=p({is(t){return t.kind==="TupleNode"},create(t){return p({kind:"TupleNode",values:p(t)})}});function Ro(t=Lo){function e(A,U,te){return new Ve(Xr(A,U,te))}function r(A,U){return new Ve(Xu(A,U))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(A){return ss({queryId:De(),executor:t,queryNode:Se.createFrom(ui(A))})},selectNoFrom(A){return ss({queryId:De(),executor:t,queryNode:Se.cloneWithSelections(Se.create(),or(A))})},case(A){return new cl({node:en.create(rr(A)?void 0:zt(A))})},ref(A,U){return rr(U)?new Ve(_n(A)):new yo(du(A,U))},val(A){return new Ve(Ka(A))},refTuple(...A){return new Ve(Ia.create(A.map(zt)))},tuple(...A){return new Ve(Ia.create(A.map(qt)))},lit(A){return new Ve(Co(A))},cmpr(A,U,te){return new Ve(Xr(A,U,te))},bxp(A,U,te){return new Ve(Xr(A,U,te))},unary:r,not(A){return r("not",A)},exists(A){return r("exists",A)},neg(A){return r("-",A)},between(A,U,te){return new Ve(oi.create(zt(A),sr.create("between"),Wn.create(qt(U),qt(te))))},betweenSymmetric(A,U,te){return new Ve(oi.create(zt(A),sr.create("between symmetric"),Wn.create(qt(U),qt(te))))},and(A){return Pn(A)?new Ve(co(A,"and")):new Ve(_a(A,"and"))},or(A){return Pn(A)?new Ve(co(A,"or")):new Ve(_a(A,"or"))},parens(...A){const U=mt(A);return Rr.is(U)?new Ve(U):new Ve(Rr.create(U))},withSchema(A){return Ro(t.withPluginAtFront(new Ii(A)))}});return n.fn=ll(),n.eb=n,n}function Ur(t){return Ro()}function jr(t){if(Lt(t))return t.toOperationNode();if(Ct(t))return t(Ur()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function dl(t){if(Lt(t))return t.toOperationNode();if(Ct(t))return t(Ur()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Oi(t){return tu(t)||nu(t)||Ct(t)}function ui(t){return Pn(t)?t.map(e=>di(e)):[di(t)]}function di(t){return tn(t)?rd(t):dl(t)}function rd(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(fl);return Rn.create(Et(r),He.create(n))}else return Et(t)}function Et(t){const e=".";if(t.includes(e)){const[r,n]=t.split(e).map(fl);return Fn.createWithSchema(r,n)}else return Fn.create(t)}function fl(t){return t.trim()}const hl=p({is(t){return t.kind==="AddColumnNode"},create(t){return p({kind:"AddColumnNode",column:t})}}),Ke=p({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return p({kind:"ColumnDefinitionNode",column:Ye.create(t),dataType:e})},cloneWithFrontModifier(t,e){return p({...t,frontModifiers:t.frontModifiers?p([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return p({...t,endModifiers:t.endModifiers?p([...t.endModifiers,e]):[e]})},cloneWith(t,e){return p({...t,...e})}}),pl=p({is(t){return t.kind==="DropColumnNode"},create(t){return p({kind:"DropColumnNode",column:Ye.create(t)})}}),_l=p({is(t){return t.kind==="RenameColumnNode"},create(t,e){return p({kind:"RenameColumnNode",column:Ye.create(t),renameTo:Ye.create(e)})}}),Mo=p({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return p({kind:"CheckConstraintNode",expression:t,name:e?He.create(e):void 0})}}),id=["no action","restrict","cascade","set null","set default"],Bi=p({is(t){return t.kind==="ReferencesNode"},create(t,e){return p({kind:"ReferencesNode",table:t,columns:p([...e])})},cloneWithOnDelete(t,e){return p({...t,onDelete:e})},cloneWithOnUpdate(t,e){return p({...t,onUpdate:e})}});function ml(t){return Lt(t)?t.toOperationNode():nn.createImmediate(t)}const Di=p({is(t){return t.kind==="GeneratedNode"},create(t){return p({kind:"GeneratedNode",...t})},createWithExpression(t){return p({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return p({...t,...e})}}),sd=p({is(t){return t.kind==="DefaultValueNode"},create(t){return p({kind:"DefaultValueNode",defaultValue:t})}});function os(t){if(id.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var Me;const at=class at{constructor(e){B(this,Me,void 0);H(this,Me,e)}autoIncrement(){return new at(Ke.cloneWith(s(this,Me),{autoIncrement:!0}))}primaryKey(){return new at(Ke.cloneWith(s(this,Me),{primaryKey:!0}))}references(e){const r=_n(e);if(!r.table||ko.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new at(Ke.cloneWith(s(this,Me),{references:Bi.create(r.table,[r.column])}))}onDelete(e){if(!s(this,Me).references)throw new Error("on delete constraint can only be added for foreign keys");return new at(Ke.cloneWith(s(this,Me),{references:Bi.cloneWithOnDelete(s(this,Me).references,os(e))}))}onUpdate(e){if(!s(this,Me).references)throw new Error("on update constraint can only be added for foreign keys");return new at(Ke.cloneWith(s(this,Me),{references:Bi.cloneWithOnUpdate(s(this,Me).references,os(e))}))}unique(){return new at(Ke.cloneWith(s(this,Me),{unique:!0}))}notNull(){return new at(Ke.cloneWith(s(this,Me),{notNull:!0}))}unsigned(){return new at(Ke.cloneWith(s(this,Me),{unsigned:!0}))}defaultTo(e){return new at(Ke.cloneWith(s(this,Me),{defaultTo:sd.create(ml(e))}))}check(e){return new at(Ke.cloneWith(s(this,Me),{check:Mo.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new at(Ke.cloneWith(s(this,Me),{generated:Di.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new at(Ke.cloneWith(s(this,Me),{generated:Di.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new at(Ke.cloneWith(s(this,Me),{generated:Di.create({identity:!0,byDefault:!0})}))}stored(){if(!s(this,Me).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new at(Ke.cloneWith(s(this,Me),{generated:Di.cloneWith(s(this,Me).generated,{stored:!0})}))}modifyFront(e){return new at(Ke.cloneWithFrontModifier(s(this,Me),e.toOperationNode()))}modifyEnd(e){return new at(Ke.cloneWithEndModifier(s(this,Me),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return s(this,Me)}};Me=new WeakMap;let Dn=at;ke(Dn,"don't await ColumnDefinitionBuilder instances directly.");const yl=p({is(t){return t.kind==="ModifyColumnNode"},create(t){return p({kind:"ModifyColumnNode",column:t})}}),od=p({is(t){return t.kind==="DataTypeNode"},create(t){return p({kind:"DataTypeNode",dataType:t})}});function Br(t){return Lt(t)?t.toOperationNode():od.create(t)}const as=p({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,n){return p({kind:"ForeignKeyConstraintNode",columns:t,references:Bi.create(e,r),name:n?He.create(n):void 0})},cloneWith(t,e){return p({...t,...e})}});var Yn;const Ts=class Ts{constructor(e){B(this,Yn,void 0);H(this,Yn,e)}onDelete(e){return new Ts(as.cloneWith(s(this,Yn),{onDelete:os(e)}))}onUpdate(e){return new Ts(as.cloneWith(s(this,Yn),{onUpdate:os(e)}))}$call(e){return e(this)}toOperationNode(){return s(this,Yn)}};Yn=new WeakMap;let fi=Ts;ke(fi,"don't await ForeignKeyConstraintBuilder instances directly.");const Qi=p({is(t){return t.kind==="AddConstraintNode"},create(t){return p({kind:"AddConstraintNode",constraint:t})}}),gl=p({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return p({kind:"UniqueConstraintNode",columns:p(t.map(Ye.create)),name:e?He.create(e):void 0})}}),Ui=p({is(t){return t.kind==="DropConstraintNode"},create(t){return p({kind:"DropConstraintNode",constraintName:He.create(t)})},cloneWith(t,e){return p({...t,...e})}}),Hr=p({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return p({kind:"AlterColumnNode",column:Ye.create(t),[e]:r})}});var dn;class Bo{constructor(e){B(this,dn,void 0);H(this,dn,e)}setDataType(e){return new Jr(Hr.create(s(this,dn),"dataType",Br(e)))}setDefault(e){return new Jr(Hr.create(s(this,dn),"setDefault",ml(e)))}dropDefault(){return new Jr(Hr.create(s(this,dn),"dropDefault",!0))}setNotNull(){return new Jr(Hr.create(s(this,dn),"setNotNull",!0))}dropNotNull(){return new Jr(Hr.create(s(this,dn),"dropNotNull",!0))}$call(e){return e(this)}}dn=new WeakMap;var bi;class Jr{constructor(e){B(this,bi,void 0);H(this,bi,e)}toOperationNode(){return s(this,bi)}}bi=new WeakMap;var Bt;class dr{constructor(e){B(this,Bt,void 0);H(this,Bt,p(e))}toOperationNode(){return s(this,Bt).executor.transformQuery(s(this,Bt).node,s(this,Bt).queryId)}compile(){return s(this,Bt).executor.compileQuery(this.toOperationNode(),s(this,Bt).queryId)}async execute(){await s(this,Bt).executor.executeQuery(this.compile(),s(this,Bt).queryId)}}Bt=new WeakMap;ke(dr,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var _t;const Cs=class Cs{constructor(e){B(this,_t,void 0);H(this,_t,p(e))}onDelete(e){return new Cs({...s(this,_t),constraintBuilder:s(this,_t).constraintBuilder.onDelete(e)})}onUpdate(e){return new Cs({...s(this,_t),constraintBuilder:s(this,_t).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return s(this,_t).executor.transformQuery(Xe.cloneWithTableProps(s(this,_t).node,{addConstraint:Qi.create(s(this,_t).constraintBuilder.toOperationNode())}),s(this,_t).queryId)}compile(){return s(this,_t).executor.compileQuery(this.toOperationNode(),s(this,_t).queryId)}async execute(){await s(this,_t).executor.executeQuery(this.compile(),s(this,_t).queryId)}};_t=new WeakMap;let ls=Cs;ke(ls,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var nt;const ni=class ni{constructor(e){B(this,nt,void 0);H(this,nt,p(e))}ifExists(){return new ni({...s(this,nt),node:Xe.cloneWithTableProps(s(this,nt).node,{dropConstraint:Ui.cloneWith(s(this,nt).node.dropConstraint,{ifExists:!0})})})}cascade(){return new ni({...s(this,nt),node:Xe.cloneWithTableProps(s(this,nt).node,{dropConstraint:Ui.cloneWith(s(this,nt).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new ni({...s(this,nt),node:Xe.cloneWithTableProps(s(this,nt).node,{dropConstraint:Ui.cloneWith(s(this,nt).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return s(this,nt).executor.transformQuery(s(this,nt).node,s(this,nt).queryId)}compile(){return s(this,nt).executor.compileQuery(this.toOperationNode(),s(this,nt).queryId)}async execute(){await s(this,nt).executor.executeQuery(this.compile(),s(this,nt).queryId)}};nt=new WeakMap;let cs=ni;ke(cs,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const wl=p({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return p({kind:"PrimaryKeyConstraintNode",columns:p(t.map(Ye.create)),name:e?He.create(e):void 0})}});var Be;class bl{constructor(e){B(this,Be,void 0);H(this,Be,p(e))}renameTo(e){return new dr({...s(this,Be),node:Xe.cloneWithTableProps(s(this,Be).node,{renameTo:Et(e)})})}setSchema(e){return new dr({...s(this,Be),node:Xe.cloneWithTableProps(s(this,Be).node,{setSchema:He.create(e)})})}alterColumn(e,r){const n=r(new Bo(e));return new xn({...s(this,Be),node:Xe.cloneWithColumnAlteration(s(this,Be).node,n.toOperationNode())})}dropColumn(e){return new xn({...s(this,Be),node:Xe.cloneWithColumnAlteration(s(this,Be).node,pl.create(e))})}renameColumn(e,r){return new xn({...s(this,Be),node:Xe.cloneWithColumnAlteration(s(this,Be).node,_l.create(e,r))})}addColumn(e,r,n=Dr){const A=n(new Dn(Ke.create(e,Br(r))));return new xn({...s(this,Be),node:Xe.cloneWithColumnAlteration(s(this,Be).node,hl.create(A.toOperationNode()))})}modifyColumn(e,r,n=Dr){const A=n(new Dn(Ke.create(e,Br(r))));return new xn({...s(this,Be),node:Xe.cloneWithColumnAlteration(s(this,Be).node,yl.create(A.toOperationNode()))})}addUniqueConstraint(e,r){return new dr({...s(this,Be),node:Xe.cloneWithTableProps(s(this,Be).node,{addConstraint:Qi.create(gl.create(r,e))})})}addCheckConstraint(e,r){return new dr({...s(this,Be),node:Xe.cloneWithTableProps(s(this,Be).node,{addConstraint:Qi.create(Mo.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,n,A){return new ls({...s(this,Be),constraintBuilder:new fi(as.create(r.map(Ye.create),Et(n),A.map(Ye.create),e))})}addPrimaryKeyConstraint(e,r){return new dr({...s(this,Be),node:Xe.cloneWithTableProps(s(this,Be).node,{addConstraint:Qi.create(wl.create(r,e))})})}dropConstraint(e){return new cs({...s(this,Be),node:Xe.cloneWithTableProps(s(this,Be).node,{dropConstraint:Ui.create(e)})})}$call(e){return e(this)}}Be=new WeakMap;var Ge;const jn=class jn{constructor(e){B(this,Ge,void 0);H(this,Ge,p(e))}alterColumn(e,r){const n=r(new Bo(e));return new jn({...s(this,Ge),node:Xe.cloneWithColumnAlteration(s(this,Ge).node,n.toOperationNode())})}dropColumn(e){return new jn({...s(this,Ge),node:Xe.cloneWithColumnAlteration(s(this,Ge).node,pl.create(e))})}renameColumn(e,r){return new jn({...s(this,Ge),node:Xe.cloneWithColumnAlteration(s(this,Ge).node,_l.create(e,r))})}addColumn(e,r,n=Dr){const A=n(new Dn(Ke.create(e,Br(r))));return new jn({...s(this,Ge),node:Xe.cloneWithColumnAlteration(s(this,Ge).node,hl.create(A.toOperationNode()))})}modifyColumn(e,r,n=Dr){const A=n(new Dn(Ke.create(e,Br(r))));return new jn({...s(this,Ge),node:Xe.cloneWithColumnAlteration(s(this,Ge).node,yl.create(A.toOperationNode()))})}toOperationNode(){return s(this,Ge).executor.transformQuery(s(this,Ge).node,s(this,Ge).queryId)}compile(){return s(this,Ge).executor.compileQuery(this.toOperationNode(),s(this,Ge).queryId)}async execute(){await s(this,Ge).executor.executeQuery(this.compile(),s(this,Ge).queryId)}};Ge=new WeakMap;let xn=jn;ke(bl,"don't await AlterTableBuilder instances");ke(Bo,"don't await AlterColumnBuilder instances");ke(xn,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class ql extends Po{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var Qe;const Jt=class Jt{constructor(e){B(this,Qe,void 0);H(this,Qe,p(e))}ifNotExists(){return new Jt({...s(this,Qe),node:qn.cloneWith(s(this,Qe).node,{ifNotExists:!0})})}unique(){return new Jt({...s(this,Qe),node:qn.cloneWith(s(this,Qe).node,{unique:!0})})}on(e){return new Jt({...s(this,Qe),node:qn.cloneWith(s(this,Qe).node,{table:Et(e)})})}column(e){return new Jt({...s(this,Qe),node:qn.cloneWithColumns(s(this,Qe).node,[pa(e)])})}columns(e){return new Jt({...s(this,Qe),node:qn.cloneWithColumns(s(this,Qe).node,e.map(pa))})}expression(e){return new Jt({...s(this,Qe),node:qn.cloneWithColumns(s(this,Qe).node,[e.toOperationNode()])})}using(e){return new Jt({...s(this,Qe),node:qn.cloneWith(s(this,Qe).node,{using:bt.createWithSql(e)})})}where(...e){const r=new ql;return new Jt({...s(this,Qe),node:xe.cloneWithWhere(s(this,Qe).node,r.transformNode(mt(e)))})}$call(e){return e(this)}toOperationNode(){return s(this,Qe).executor.transformQuery(s(this,Qe).node,s(this,Qe).queryId)}compile(){return s(this,Qe).executor.compileQuery(this.toOperationNode(),s(this,Qe).queryId)}async execute(){await s(this,Qe).executor.executeQuery(this.compile(),s(this,Qe).queryId)}};Qe=new WeakMap;let us=Jt;ke(us,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var kt;const jo=class jo{constructor(e){B(this,kt,void 0);H(this,kt,p(e))}ifNotExists(){return new jo({...s(this,kt),node:Qa.cloneWith(s(this,kt).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,kt).executor.transformQuery(s(this,kt).node,s(this,kt).queryId)}compile(){return s(this,kt).executor.compileQuery(this.toOperationNode(),s(this,kt).queryId)}async execute(){await s(this,kt).executor.executeQuery(this.compile(),s(this,kt).queryId)}};kt=new WeakMap;let ds=jo;ke(ds,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function ad(t){if(eu.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var Ce;const Pt=class Pt{constructor(e){B(this,Ce,void 0);H(this,Ce,p(e))}temporary(){return new Pt({...s(this,Ce),node:Dt.cloneWith(s(this,Ce).node,{temporary:!0})})}onCommit(e){return new Pt({...s(this,Ce),node:Dt.cloneWith(s(this,Ce).node,{onCommit:ad(e)})})}ifNotExists(){return new Pt({...s(this,Ce),node:Dt.cloneWith(s(this,Ce).node,{ifNotExists:!0})})}addColumn(e,r,n=Dr){const A=n(new Dn(Ke.create(e,Br(r))));return new Pt({...s(this,Ce),node:Dt.cloneWithColumn(s(this,Ce).node,A.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Pt({...s(this,Ce),node:Dt.cloneWithConstraint(s(this,Ce).node,wl.create(r,e))})}addUniqueConstraint(e,r){return new Pt({...s(this,Ce),node:Dt.cloneWithConstraint(s(this,Ce).node,gl.create(r,e))})}addCheckConstraint(e,r){return new Pt({...s(this,Ce),node:Dt.cloneWithConstraint(s(this,Ce).node,Mo.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,n,A,U=Dr){const te=U(new fi(as.create(r.map(Ye.create),Et(n),A.map(Ye.create),e)));return new Pt({...s(this,Ce),node:Dt.cloneWithConstraint(s(this,Ce).node,te.toOperationNode())})}modifyFront(e){return new Pt({...s(this,Ce),node:Dt.cloneWithFrontModifier(s(this,Ce).node,e.toOperationNode())})}modifyEnd(e){return new Pt({...s(this,Ce),node:Dt.cloneWithEndModifier(s(this,Ce).node,e.toOperationNode())})}$call(e){return e(this)}toOperationNode(){return s(this,Ce).executor.transformQuery(s(this,Ce).node,s(this,Ce).queryId)}compile(){return s(this,Ce).executor.compileQuery(this.toOperationNode(),s(this,Ce).queryId)}async execute(){await s(this,Ce).executor.executeQuery(this.compile(),s(this,Ce).queryId)}};Ce=new WeakMap;let fs=Pt;ke(fs,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var ct;const ri=class ri{constructor(e){B(this,ct,void 0);H(this,ct,p(e))}on(e){return new ri({...s(this,ct),node:Mi.cloneWith(s(this,ct).node,{table:Et(e)})})}ifExists(){return new ri({...s(this,ct),node:Mi.cloneWith(s(this,ct).node,{ifExists:!0})})}cascade(){return new ri({...s(this,ct),node:Mi.cloneWith(s(this,ct).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ct).executor.transformQuery(s(this,ct).node,s(this,ct).queryId)}compile(){return s(this,ct).executor.compileQuery(this.toOperationNode(),s(this,ct).queryId)}async execute(){await s(this,ct).executor.executeQuery(this.compile(),s(this,ct).queryId)}};ct=new WeakMap;let hs=ri;ke(hs,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var gt;const Fs=class Fs{constructor(e){B(this,gt,void 0);H(this,gt,p(e))}ifExists(){return new Fs({...s(this,gt),node:io.cloneWith(s(this,gt).node,{ifExists:!0})})}cascade(){return new Fs({...s(this,gt),node:io.cloneWith(s(this,gt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,gt).executor.transformQuery(s(this,gt).node,s(this,gt).queryId)}compile(){return s(this,gt).executor.compileQuery(this.toOperationNode(),s(this,gt).queryId)}async execute(){await s(this,gt).executor.executeQuery(this.compile(),s(this,gt).queryId)}};gt=new WeakMap;let ps=Fs;ke(ps,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var wt;const Ps=class Ps{constructor(e){B(this,wt,void 0);H(this,wt,p(e))}ifExists(){return new Ps({...s(this,wt),node:so.cloneWith(s(this,wt).node,{ifExists:!0})})}cascade(){return new Ps({...s(this,wt),node:so.cloneWith(s(this,wt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,wt).executor.transformQuery(s(this,wt).node,s(this,wt).queryId)}compile(){return s(this,wt).executor.compileQuery(this.toOperationNode(),s(this,wt).queryId)}async execute(){await s(this,wt).executor.executeQuery(this.compile(),s(this,wt).queryId)}};wt=new WeakMap;let _s=Ps;ke(_s,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Nn=p({is(t){return t.kind==="CreateViewNode"},create(t){return p({kind:"CreateViewNode",name:Ln.create(t)})},cloneWith(t,e){return p({...t,...e})}});var Ls;class ld{constructor(){B(this,Ls,new ql)}transformQuery(e){return s(this,Ls).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}Ls=new WeakMap;var $e;const vn=class vn{constructor(e){B(this,$e,void 0);H(this,$e,p(e))}temporary(){return new vn({...s(this,$e),node:Nn.cloneWith(s(this,$e).node,{temporary:!0})})}materialized(){return new vn({...s(this,$e),node:Nn.cloneWith(s(this,$e).node,{materialized:!0})})}ifNotExists(){return new vn({...s(this,$e),node:Nn.cloneWith(s(this,$e).node,{ifNotExists:!0})})}orReplace(){return new vn({...s(this,$e),node:Nn.cloneWith(s(this,$e).node,{orReplace:!0})})}columns(e){return new vn({...s(this,$e),node:Nn.cloneWith(s(this,$e).node,{columns:e.map(Ja)})})}as(e){const r=e.withPlugin(new ld).toOperationNode();return new vn({...s(this,$e),node:Nn.cloneWith(s(this,$e).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return s(this,$e).executor.transformQuery(s(this,$e).node,s(this,$e).queryId)}compile(){return s(this,$e).executor.compileQuery(this.toOperationNode(),s(this,$e).queryId)}async execute(){await s(this,$e).executor.executeQuery(this.compile(),s(this,$e).queryId)}};$e=new WeakMap;let ms=vn;ke(ms,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const ji=p({is(t){return t.kind==="DropViewNode"},create(t){return p({kind:"DropViewNode",name:Ln.create(t)})},cloneWith(t,e){return p({...t,...e})}});var ut;const ii=class ii{constructor(e){B(this,ut,void 0);H(this,ut,p(e))}materialized(){return new ii({...s(this,ut),node:ji.cloneWith(s(this,ut).node,{materialized:!0})})}ifExists(){return new ii({...s(this,ut),node:ji.cloneWith(s(this,ut).node,{ifExists:!0})})}cascade(){return new ii({...s(this,ut),node:ji.cloneWith(s(this,ut).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ut).executor.transformQuery(s(this,ut).node,s(this,ut).queryId)}compile(){return s(this,ut).executor.compileQuery(this.toOperationNode(),s(this,ut).queryId)}async execute(){await s(this,ut).executor.executeQuery(this.compile(),s(this,ut).queryId)}};ut=new WeakMap;let ys=ii;ke(ys,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Nl=p({is(t){return t.kind==="CreateTypeNode"},create(t){return p({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return p({...t,enum:Oo.create(e.map(r=>nn.createImmediate(r)))})}});var It;const zo=class zo{constructor(e){B(this,It,void 0);H(this,It,p(e))}toOperationNode(){return s(this,It).executor.transformQuery(s(this,It).node,s(this,It).queryId)}asEnum(e){return new zo({...s(this,It),node:Nl.cloneWithEnum(s(this,It).node,e)})}$call(e){return e(this)}compile(){return s(this,It).executor.compileQuery(this.toOperationNode(),s(this,It).queryId)}async execute(){await s(this,It).executor.executeQuery(this.compile(),s(this,It).queryId)}};It=new WeakMap;let gs=zo;ke(gs,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const vl=p({is(t){return t.kind==="DropTypeNode"},create(t){return p({kind:"DropTypeNode",name:t})},cloneWith(t,e){return p({...t,...e})}});var Ot;const Vo=class Vo{constructor(e){B(this,Ot,void 0);H(this,Ot,p(e))}ifExists(){return new Vo({...s(this,Ot),node:vl.cloneWith(s(this,Ot).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Ot).executor.transformQuery(s(this,Ot).node,s(this,Ot).queryId)}compile(){return s(this,Ot).executor.compileQuery(this.toOperationNode(),s(this,Ot).queryId)}async execute(){await s(this,Ot).executor.executeQuery(this.compile(),s(this,Ot).queryId)}};Ot=new WeakMap;let ws=Vo;ke(ws,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function Oa(t){const e=".";if(t.includes(e)){const r=t.split(e).map(cd);if(r.length===2)return Ln.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return Ln.create(t)}function cd(t){return t.trim()}var lt;const si=class si{constructor(e){B(this,lt,void 0);H(this,lt,e)}createTable(e){return new fs({queryId:De(),executor:s(this,lt),node:Dt.create(Et(e))})}dropTable(e){return new _s({queryId:De(),executor:s(this,lt),node:so.create(Et(e))})}createIndex(e){return new us({queryId:De(),executor:s(this,lt),node:qn.create(e)})}dropIndex(e){return new hs({queryId:De(),executor:s(this,lt),node:Mi.create(e)})}createSchema(e){return new ds({queryId:De(),executor:s(this,lt),node:Qa.create(e)})}dropSchema(e){return new ps({queryId:De(),executor:s(this,lt),node:io.create(e)})}alterTable(e){return new bl({queryId:De(),executor:s(this,lt),node:Xe.create(Et(e))})}createView(e){return new ms({queryId:De(),executor:s(this,lt),node:Nn.create(e)})}dropView(e){return new ys({queryId:De(),executor:s(this,lt),node:ji.create(e)})}createType(e){return new gs({queryId:De(),executor:s(this,lt),node:Nl.create(Oa(e))})}dropType(e){return new ws({queryId:De(),executor:s(this,lt),node:vl.create(Oa(e))})}withPlugin(e){return new si(s(this,lt).withPlugin(e))}withoutPlugins(){return new si(s(this,lt).withoutPlugins())}withSchema(e){return new si(s(this,lt).withPluginAtFront(new Ii(e)))}};lt=new WeakMap;let wo=si;class ud{ref(e){return new cu(e)}}var Cr;class dd{constructor(e){B(this,Cr,void 0);H(this,Cr,e)}async provideConnection(e){const r=await s(this,Cr).acquireConnection();try{return await e(r)}finally{await s(this,Cr).releaseConnection(r)}}}Cr=new WeakMap;var Kt,Xt,fn;const zn=class zn extends sl{constructor(r,n,A,U=[]){super(U);B(this,Kt,void 0);B(this,Xt,void 0);B(this,fn,void 0);H(this,Kt,r),H(this,Xt,n),H(this,fn,A)}get adapter(){return s(this,Xt)}compileQuery(r){return s(this,Kt).compileQuery(r)}provideConnection(r){return s(this,fn).provideConnection(r)}withPlugins(r){return new zn(s(this,Kt),s(this,Xt),s(this,fn),[...this.plugins,...r])}withPlugin(r){return new zn(s(this,Kt),s(this,Xt),s(this,fn),[...this.plugins,r])}withPluginAtFront(r){return new zn(s(this,Kt),s(this,Xt),s(this,fn),[r,...this.plugins])}withConnectionProvider(r){return new zn(s(this,Kt),s(this,Xt),r,[...this.plugins])}withoutPlugins(){return new zn(s(this,Kt),s(this,Xt),s(this,fn),[])}};Kt=new WeakMap,Xt=new WeakMap,fn=new WeakMap;let bo=zn;function Ta(){return typeof performance<"u"&&Ct(performance.now)?performance.now():Date.now()}var Qt,In,hn,Fr,pn,qi,Ws,xl,Ds,El,Rs,Sl,Ms,Al,Ni,qo;class fd{constructor(e,r){B(this,Ws);B(this,Ds);B(this,Rs);B(this,Ms);B(this,Ni);B(this,Qt,void 0);B(this,In,void 0);B(this,hn,void 0);B(this,Fr,void 0);B(this,pn,void 0);B(this,qi,new WeakSet);H(this,Fr,!1),H(this,Qt,e),H(this,In,r)}async init(){if(s(this,pn))throw new Error("driver has already been destroyed");s(this,hn)||H(this,hn,s(this,Qt).init().then(()=>{H(this,Fr,!0)}).catch(e=>(H(this,hn,void 0),Promise.reject(e)))),await s(this,hn)}async acquireConnection(){if(s(this,pn))throw new Error("driver has already been destroyed");s(this,Fr)||await this.init();const e=await s(this,Qt).acquireConnection();return s(this,qi).has(e)||(Ie(this,Ws,xl).call(this)&&Ie(this,Ds,El).call(this,e),s(this,qi).add(e)),e}async releaseConnection(e){await s(this,Qt).releaseConnection(e)}beginTransaction(e,r){return s(this,Qt).beginTransaction(e,r)}commitTransaction(e){return s(this,Qt).commitTransaction(e)}rollbackTransaction(e){return s(this,Qt).rollbackTransaction(e)}async destroy(){s(this,hn)&&(await s(this,hn),s(this,pn)||H(this,pn,s(this,Qt).destroy().catch(e=>(H(this,pn,void 0),Promise.reject(e)))),await s(this,pn))}}Qt=new WeakMap,In=new WeakMap,hn=new WeakMap,Fr=new WeakMap,pn=new WeakMap,qi=new WeakMap,Ws=new WeakSet,xl=function(){return s(this,In).isLevelEnabled("query")||s(this,In).isLevelEnabled("error")},Ds=new WeakSet,El=function(e){const r=e.executeQuery;e.executeQuery=async n=>{const A=Ta();try{return await r.call(e,n)}catch(U){throw await Ie(this,Rs,Sl).call(this,U,n,A),U}finally{await Ie(this,Ms,Al).call(this,n,A)}}},Rs=new WeakSet,Sl=async function(e,r,n){await s(this,In).error(()=>({level:"error",error:e,query:r,queryDurationMillis:Ie(this,Ni,qo).call(this,n)}))},Ms=new WeakSet,Al=async function(e,r){await s(this,In).query(()=>({level:"query",query:e,queryDurationMillis:Ie(this,Ni,qo).call(this,r)}))},Ni=new WeakSet,qo=function(e){return Ta()-e};var vi,On,Bs,Il;class kl{constructor(e){B(this,Bs);B(this,vi,void 0);B(this,On,void 0);H(this,vi,e)}async provideConnection(e){for(;s(this,On);)await s(this,On);const r=Ie(this,Bs,Il).call(this,e);return H(this,On,r.then(()=>{H(this,On,void 0)}).catch(()=>{H(this,On,void 0)})),r}}vi=new WeakMap,On=new WeakMap,Bs=new WeakSet,Il=async function(e){return await e(s(this,vi))};const hd=["read uncommitted","read committed","repeatable read","serializable"];p(["query","error"]);var Tn,Zn;class pd{constructor(e){B(this,Tn,void 0);B(this,Zn,void 0);Ct(e)?(H(this,Zn,e),H(this,Tn,p({query:!0,error:!0}))):(H(this,Zn,_d),H(this,Tn,p({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return s(this,Tn)[e]}async query(e){s(this,Tn).query&&await s(this,Zn).call(this,e())}async error(e){s(this,Tn).error&&await s(this,Zn).call(this,e())}}Tn=new WeakMap,Zn=new WeakMap;function _d(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function md(t){return Zt(t)&&Ct(t.compile)}var dt;const _r=class _r extends rs{constructor(r){let n,A;if(yd(r))n={executor:r.executor},A={...r};else{const U=r.dialect,te=U.createDriver(),Ae=U.createQueryCompiler(),Le=U.createAdapter(),Ze=new pd(r.log??[]),et=new fd(te,Ze),Te=new dd(et),ze=new bo(Ae,Le,Te,r.plugins??[]);n={executor:ze},A={config:r,executor:ze,dialect:U,driver:et}}super(n);B(this,dt,void 0);H(this,dt,p(A))}get schema(){return new wo(s(this,dt).executor)}get dynamic(){return new ud}get introspection(){return s(this,dt).dialect.createIntrospector(this.withoutPlugins())}case(r){return new cl({node:en.create(rr(r)?void 0:jr(r))})}get fn(){return ll()}transaction(){return new bs({...s(this,dt)})}connection(){return new Ol({...s(this,dt)})}withPlugin(r){return new _r({...s(this,dt),executor:s(this,dt).executor.withPlugin(r)})}withoutPlugins(){return new _r({...s(this,dt),executor:s(this,dt).executor.withoutPlugins()})}withSchema(r){return new _r({...s(this,dt),executor:s(this,dt).executor.withPluginAtFront(new Ii(r))})}withTables(){return new _r({...s(this,dt)})}async destroy(){await s(this,dt).driver.destroy()}get isTransaction(){return!1}getExecutor(){return s(this,dt).executor}executeQuery(r,n=De()){const A=md(r)?r.compile():r;return this.getExecutor().executeQuery(A,n)}};dt=new WeakMap;let hi=_r;var Ut;const mr=class mr extends hi{constructor(r){super(r);B(this,Ut,void 0);H(this,Ut,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new mr({...s(this,Ut),executor:s(this,Ut).executor.withPlugin(r)})}withoutPlugins(){return new mr({...s(this,Ut),executor:s(this,Ut).executor.withoutPlugins()})}withSchema(r){return new mr({...s(this,Ut),executor:s(this,Ut).executor.withPluginAtFront(new Ii(r))})}withTables(){return new mr({...s(this,Ut)})}};Ut=new WeakMap;let No=mr;function yd(t){return Zt(t)&&Zt(t.config)&&Zt(t.driver)&&Zt(t.executor)&&Zt(t.dialect)}var er;class Ol{constructor(e){B(this,er,void 0);H(this,er,p(e))}async execute(e){return s(this,er).executor.provideConnection(async r=>{const n=s(this,er).executor.withConnectionProvider(new kl(r)),A=new hi({...s(this,er),executor:n});return await e(A)})}}er=new WeakMap;ke(Ol,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var jt;const $o=class $o{constructor(e){B(this,jt,void 0);H(this,jt,p(e))}setIsolationLevel(e){return new $o({...s(this,jt),isolationLevel:e})}async execute(e){const{isolationLevel:r,...n}=s(this,jt),A={isolationLevel:r};return gd(A),s(this,jt).executor.provideConnection(async U=>{const te=s(this,jt).executor.withConnectionProvider(new kl(U)),Ae=new No({...n,executor:te});try{await s(this,jt).driver.beginTransaction(U,A);const Le=await e(Ae);return await s(this,jt).driver.commitTransaction(U),Le}catch(Le){throw await s(this,jt).driver.rollbackTransaction(U),Le}})}};jt=new WeakMap;let bs=$o;ke(bs,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function gd(t){if(t.isolationLevel&&!hd.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var Nt,Pr,zi,xi,vo,Ei,xo;const Qs=class Qs{constructor(e){B(this,Pr);B(this,xi);B(this,Ei);B(this,Nt,void 0);H(this,Nt,p(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Tl(this,e)}$castTo(){return new Qs({...s(this,Nt)})}withPlugin(e){return new Qs({...s(this,Nt),plugins:s(this,Nt).plugins!==void 0?p([...s(this,Nt).plugins,e]):p([e])})}toOperationNode(){return Ie(this,xi,vo).call(this,Ie(this,Pr,zi).call(this))}compile(e){return Ie(this,Ei,xo).call(this,Ie(this,Pr,zi).call(this,e))}async execute(e){const r=Ie(this,Pr,zi).call(this,e);return r.executeQuery(Ie(this,Ei,xo).call(this,r),s(this,Nt).queryId)}};Nt=new WeakMap,Pr=new WeakSet,zi=function(e){const r=e!==void 0?e.getExecutor():Lo;return s(this,Nt).plugins!==void 0?r.withPlugins(s(this,Nt).plugins):r},xi=new WeakSet,vo=function(e){return e.transformQuery(s(this,Nt).rawNode,s(this,Nt).queryId)},Ei=new WeakSet,xo=function(e){return e.compileQuery(Ie(this,xi,vo).call(this,e),s(this,Nt).queryId)};let qs=Qs;function bn(t){return new qs(t)}ke(qs,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var tr,Cn;class Tl{constructor(e,r){B(this,tr,void 0);B(this,Cn,void 0);H(this,tr,e),H(this,Cn,r)}get expression(){return s(this,tr)}get alias(){return s(this,Cn)}get rawBuilder(){return s(this,tr)}toOperationNode(){return Rn.create(s(this,tr).toOperationNode(),Lt(s(this,Cn))?s(this,Cn).toOperationNode():He.create(s(this,Cn)))}}tr=new WeakMap,Cn=new WeakMap;ke(Tl,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const st=Object.assign((t,...e)=>bn({queryId:De(),rawNode:bt.create(t,e?.map(qt)??[])}),{ref(t){return bn({queryId:De(),rawNode:bt.createWithChild(_n(t))})},val(t){return bn({queryId:De(),rawNode:bt.createWithChild(qt(t))})},value(t){return this.val(t)},table(t){return bn({queryId:De(),rawNode:bt.createWithChild(Et(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",bn({queryId:De(),rawNode:bt.create(e,t.map(He.create))})},lit(t){return bn({queryId:De(),rawNode:bt.createWithChild(nn.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return bn({queryId:De(),rawNode:bt.createWithSql(t)})},join(t,e=st`, `){const r=new Array(2*t.length-1),n=e.toOperationNode();for(let A=0;A<t.length;++A)r[2*A]=qt(t[A]),A!==t.length-1&&(r[2*A+1]=n);return bn({queryId:De(),rawNode:bt.createWithChildren(r)})}});var Us;class wd{constructor(){Pe(this,"nodeStack",[]);B(this,Us,p({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this)}));Pe(this,"visitNode",e=>{this.nodeStack.push(e),s(this,Us)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Us=new WeakMap;var Lr,nr;class bd extends wd{constructor(){super(...arguments);B(this,Lr,"");B(this,nr,[])}get numParameters(){return s(this,nr).length}compileQuery(r){return H(this,Lr,""),H(this,nr,[]),this.visitNode(r),p({query:r,sql:this.getSql(),parameters:[...s(this,nr)]})}getSql(){return s(this,Lr)}visitSelectQuery(r){const n=this.parentNode!==void 0&&!Rr.is(this.parentNode)&&!Yt.is(this.parentNode)&&!Nn.is(this.parentNode)&&!ol.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),r.frontModifiers?.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),r.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),n&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,n=", "){const A=r.length-1;for(let U=0;U<=A;U++)this.visitNode(r[U]),U<A&&this.append(n)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const n=this.nodeStack.find(xe.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const n=this.nodeStack.find(xe.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!tn(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:n}=r;for(let A=0;A<n.length;++A)this.appendValue(n[A]),A!==n.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(Nd[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:n,parameters:A}=r;for(let U=0;U<n.length;++U)this.append(n[U]),A.length>U&&this.visitNode(A[U])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const n=this.nodeStack.find(xe.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),$i(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileList(r.columnAlterations)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(qd[r.modifier])}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return sr.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const n of r.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(r){const n=r.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(r.value)),n&&this.append("]")}visitJSONOperatorChain(r){for(let n=0,A=r.values.length;n<A;n++)n===A-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[n])}append(r){H(this,Lr,s(this,Lr)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const n=this.getLeftIdentifierWrapper(),A=this.getRightIdentifierWrapper();let U="";for(const te of r)U+=te,te===n?U+=n:te===A&&(U+=A);return U}addParameter(r){s(this,nr).push(r)}appendImmediateValue(r){if(tn(r))this.append(`'${r}'`);else if(Ba(r)||$i(r))this.append(r.toString());else if(Ao(r))this.append("null");else if(Yc(r))this.appendImmediateValue(r.toISOString());else if(Zc(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((n,A)=>n.modifier&&A.modifier?Ca[n.modifier]-Ca[A.modifier]:1),p(r)}}Lr=new WeakMap,nr=new WeakMap;const qd=p({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),Ca=p({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Nd=p({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),ir=p({raw(t,e=[]){return p({sql:t,query:bt.createWithSql(t),parameters:p(e)})}}),vd=/"/g;class xd extends bd{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(vd,'""')}visitDefaultInsertValue(e){this.append("null")}}const Cl="kysely_migration",Fl="kysely_migration_lock";p({__noMigrations__:!0});var Wr,js,Pl;class Ed{constructor(e){B(this,js);B(this,Wr,void 0);H(this,Wr,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=s(this,Wr).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",Cl).where("name","!=",Fl));const n=await r.execute();return Promise.all(n.map(({name:A})=>Ie(this,js,Pl).call(this,A)))}async getMetadata(e){return{tables:await this.getTables(e)}}}Wr=new WeakMap,js=new WeakSet,Pl=async function(e){const r=s(this,Wr),n=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),A=n.sql?.split(/[\(\),]/)?.find(te=>te.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),U=await r.selectFrom(st`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:U.map(te=>({name:te.name,dataType:te.type,isNullable:!te.notnull,isAutoIncrementing:te.name===A,hasDefaultValue:te.dflt_value!=null}))}};class Sd{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var Ad=class{createQueryCompiler(){return new xd}createAdapter(){return new Sd}createIntrospector(t){return new Ed(t)}},Si,Ra,kd=(Ra=class{constructor(){B(this,Si,new Id);Pe(this,"connection")}async acquireConnection(){return await s(this,Si).lock(),this.connection}async beginTransaction(t){await t.executeQuery(ir.raw("begin"))}async commitTransaction(t){await t.executeQuery(ir.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(ir.raw("rollback"))}async releaseConnection(){s(this,Si).unlock()}},Si=new WeakMap,Ra),Id=class{constructor(){Pe(this,"promise");Pe(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t?.()}},Od=class{streamQuery(){throw new Error("sqlite-wasm driver doesn't support streaming")}async executeQuery({parameters:t,query:e,sql:r}){const n=await this.query(r,t);return Se.is(e)||n.length?{rows:n}:{rows:n,...await this.info()}}},Td=class extends kd{constructor(e){super();Pe(this,"config");Pe(this,"db");this.config=e}async init(){this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,this.connection=new Cd(this.db),await this.config.onCreateConnection?.(this.connection)}async destroy(){this.db?.close()}},Cd=class extends Od{constructor(e){super();Pe(this,"db");this.db=e}async query(e,r){return this.db.selectObjects(e,r)}async info(){return{insertId:BigInt(this.db.selectArray("SELECT last_insert_rowid()")[0]),numAffectedRows:BigInt(this.db.changes(!1,!0))}}},Ai,Ma,Fd=(Ma=class extends Ad{constructor(e){super();B(this,Ai,void 0);H(this,Ai,e)}createDriver(){return new Td(s(this,Ai))}},Ai=new WeakMap,Ma),Qo=(()=>{var t=import.meta.url;return function(e){var r=e||{},n=typeof r<"u"?r:{},A,U;n.ready=new Promise(function(o,i){A=o,U=i});const te=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,te.debugModule("globalThis.location =",globalThis.location);const Ae="emscripten-bug-17951";n[Ae]=function o(i,l){i.env.foo=function(){};const a=n.locateFile(o.uri,typeof ze>"u"?"":ze);te.debugModule("instantiateWasm() uri =",a);const c=()=>fetch(a,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(c(),i).then(w=>l(w.instance,w.module)):async()=>c().then(w=>w.arrayBuffer()).then(w=>WebAssembly.instantiate(w,i)).then(w=>l(w.instance,w.module)))(),{}},n[Ae].uri="sqlite3.wasm";var Le=Object.assign({},n),Ze="./this.program",et=typeof window=="object",Te=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var ze="";function rn(o){return n.locateFile?n.locateFile(o,ze):ze+o}var yn,Vt,gn;(et||Te)&&(Te?ze=self.location.href:typeof document<"u"&&document.currentScript&&(ze=document.currentScript.src),t&&(ze=t),ze.indexOf("blob:")!==0?ze=ze.substr(0,ze.replace(/[?#].*/,"").lastIndexOf("/")+1):ze="",yn=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.send(null),i.responseText},Te&&(gn=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.responseType="arraybuffer",i.send(null),new Uint8Array(i.response)}),Vt=(o,i,l)=>{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onload=()=>{if(a.status==200||a.status==0&&a.response){i(a.response);return}l()},a.onerror=l,a.send(null)});var we=n.print||console.log.bind(console),ft=n.printErr||console.warn.bind(console);Object.assign(n,Le),Le=null,n.arguments&&n.arguments,n.thisProgram&&(Ze=n.thisProgram),n.quit&&n.quit;var sn;n.wasmBinary&&(sn=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&lr("no native wasm support detected");var $t,Ti=!1;function Mn(o,i){o||lr(i)}var ht=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Wt(o,i,l){for(var a=i+l,c=i;o[c]&&!(c>=a);)++c;if(c-i>16&&o.buffer&&ht)return ht.decode(o.subarray(i,c));for(var d="";i<c;){var w=o[i++];if(!(w&128)){d+=String.fromCharCode(w);continue}var k=o[i++]&63;if((w&224)==192){d+=String.fromCharCode((w&31)<<6|k);continue}var L=o[i++]&63;if((w&240)==224?w=(w&15)<<12|k<<6|L:w=(w&7)<<18|k<<12|L<<6|o[i++]&63,w<65536)d+=String.fromCharCode(w);else{var J=w-65536;d+=String.fromCharCode(55296|J>>10,56320|J&1023)}}return d}function Js(o,i){return o?Wt(ar,o,i):""}function wn(o,i,l,a){if(!(a>0))return 0;for(var c=l,d=l+a-1,w=0;w<o.length;++w){var k=o.charCodeAt(w);if(k>=55296&&k<=57343){var L=o.charCodeAt(++w);k=65536+((k&1023)<<10)|L&1023}if(k<=127){if(l>=d)break;i[l++]=k}else if(k<=2047){if(l+1>=d)break;i[l++]=192|k>>6,i[l++]=128|k&63}else if(k<=65535){if(l+2>=d)break;i[l++]=224|k>>12,i[l++]=128|k>>6&63,i[l++]=128|k&63}else{if(l+3>=d)break;i[l++]=240|k>>18,i[l++]=128|k>>12&63,i[l++]=128|k>>6&63,i[l++]=128|k&63}}return i[l]=0,l-c}function Ho(o,i,l){return wn(o,ar,i,l)}function zr(o){for(var i=0,l=0;l<o.length;++l){var a=o.charCodeAt(l);a<=127?i++:a<=2047?i+=2:a>=55296&&a<=57343?(i+=4,++l):i+=3}return i}var St,ar,Jo,Ne,Je;function Go(){var o=$t.buffer;n.HEAP8=St=new Int8Array(o),n.HEAP16=Jo=new Int16Array(o),n.HEAP32=Ne=new Int32Array(o),n.HEAPU8=ar=new Uint8Array(o),n.HEAPU16=new Uint16Array(o),n.HEAPU32=Je=new Uint32Array(o),n.HEAPF32=new Float32Array(o),n.HEAPF64=new Float64Array(o),n.HEAP64=new BigInt64Array(o),n.HEAPU64=new BigUint64Array(o)}var Ko=n.INITIAL_MEMORY||16777216;n.wasmMemory?$t=n.wasmMemory:$t=new WebAssembly.Memory({initial:Ko/65536,maximum:2147483648/65536}),Go(),Ko=$t.buffer.byteLength;var Xo=[],Yo=[],Zo=[];function Ql(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)zl(n.preRun.shift());Ks(Xo)}function Ul(){!n.noFSInit&&!u.init.initialized&&u.init(),u.ignorePermissions=!1,Ks(Yo)}function jl(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)$l(n.postRun.shift());Ks(Zo)}function zl(o){Xo.unshift(o)}function Vl(o){Yo.unshift(o)}function $l(o){Zo.unshift(o)}var Bn=0,Vr=null;function lf(o){return o}function Gs(o){Bn++,n.monitorRunDependencies&&n.monitorRunDependencies(Bn)}function Ci(o){if(Bn--,n.monitorRunDependencies&&n.monitorRunDependencies(Bn),Bn==0&&Vr){var i=Vr;Vr=null,i()}}function lr(o){n.onAbort&&n.onAbort(o),o="Aborted("+o+")",ft(o),Ti=!0,o+=". Build with -sASSERTIONS for more info.";var i=new WebAssembly.RuntimeError(o);throw U(i),i}var Hl="data:application/octet-stream;base64,";function ea(o){return o.startsWith(Hl)}var Ft;n.locateFile?(Ft="sqlite3.wasm",ea(Ft)||(Ft=rn(Ft))):Ft=new URL(""+new URL("sqlite3-x8y6ojKa.wasm",import.meta.url).href,import.meta.url).href;function ta(o){try{if(o==Ft&&sn)return new Uint8Array(sn);if(gn)return gn(o);throw"both async and sync fetching of the wasm failed"}catch(i){lr(i)}}function Jl(){return!sn&&(et||Te)&&typeof fetch=="function"?fetch(Ft,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+Ft+"'";return o.arrayBuffer()}).catch(function(){return ta(Ft)}):Promise.resolve().then(function(){return ta(Ft)})}function Gl(){var o={env:aa,wasi_snapshot_preview1:aa};function i(w,k){var L=w.exports;n.asm=L,n.asm.__indirect_function_table,Vl(n.asm.__wasm_call_ctors),Ci()}Gs();function l(w){i(w.instance)}function a(w){return Jl().then(function(k){return WebAssembly.instantiate(k,o)}).then(function(k){return k}).then(w,function(k){ft("failed to asynchronously prepare wasm: "+k),lr(k)})}function c(){return!sn&&typeof WebAssembly.instantiateStreaming=="function"&&!ea(Ft)&&typeof fetch=="function"?fetch(Ft,{credentials:"same-origin"}).then(function(w){var k=WebAssembly.instantiateStreaming(w,o);return k.then(l,function(L){return ft("wasm streaming compile failed: "+L),ft("falling back to ArrayBuffer instantiation"),a(l)})}):a(l)}if(n.instantiateWasm)try{var d=n.instantiateWasm(o,i);return d}catch(w){ft("Module.instantiateWasm callback failed with error: "+w),U(w)}return c().catch(U),{}}var Ee,ot;function Ks(o){for(;o.length>0;)o.shift()(n)}var Oe={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return i.exec(o).slice(1)},normalizeArray:(o,i)=>{for(var l=0,a=o.length-1;a>=0;a--){var c=o[a];c==="."?o.splice(a,1):c===".."?(o.splice(a,1),l++):l&&(o.splice(a,1),l--)}if(i)for(;l;l--)o.unshift("..");return o},normalize:o=>{var i=Oe.isAbs(o),l=o.substr(-1)==="/";return o=Oe.normalizeArray(o.split("/").filter(a=>!!a),!i).join("/"),!o&&!i&&(o="."),o&&l&&(o+="/"),(i?"/":"")+o},dirname:o=>{var i=Oe.splitPath(o),l=i[0],a=i[1];return!l&&!a?".":(a&&(a=a.substr(0,a.length-1)),l+a)},basename:o=>{if(o==="/")return"/";o=Oe.normalize(o),o=o.replace(/\/$/,"");var i=o.lastIndexOf("/");return i===-1?o:o.substr(i+1)},join:function(){var o=Array.prototype.slice.call(arguments);return Oe.normalize(o.join("/"))},join2:(o,i)=>Oe.normalize(o+"/"+i)};function Kl(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var o=new Uint8Array(1);return()=>(crypto.getRandomValues(o),o[0])}else return()=>lr("randomDevice")}var on={resolve:function(){for(var o="",i=!1,l=arguments.length-1;l>=-1&&!i;l--){var a=l>=0?arguments[l]:u.cwd();if(typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";o=a+"/"+o,i=Oe.isAbs(a)}return o=Oe.normalizeArray(o.split("/").filter(c=>!!c),!i).join("/"),(i?"/":"")+o||"."},relative:(o,i)=>{o=on.resolve(o).substr(1),i=on.resolve(i).substr(1);function l(J){for(var ee=0;ee<J.length&&J[ee]==="";ee++);for(var se=J.length-1;se>=0&&J[se]==="";se--);return ee>se?[]:J.slice(ee,se-ee+1)}for(var a=l(o.split("/")),c=l(i.split("/")),d=Math.min(a.length,c.length),w=d,k=0;k<d;k++)if(a[k]!==c[k]){w=k;break}for(var L=[],k=w;k<a.length;k++)L.push("..");return L=L.concat(c.slice(w)),L.join("/")}};function Xs(o,i,l){var a=l>0?l:zr(o)+1,c=new Array(a),d=wn(o,c,0,c.length);return i&&(c.length=d),c}var Qn={ttys:[],init:function(){},shutdown:function(){},register:function(o,i){Qn.ttys[o]={input:[],output:[],ops:i},u.registerDevice(o,Qn.stream_ops)},stream_ops:{open:function(o){var i=Qn.ttys[o.node.rdev];if(!i)throw new u.ErrnoError(43);o.tty=i,o.seekable=!1},close:function(o){o.tty.ops.fsync(o.tty)},fsync:function(o){o.tty.ops.fsync(o.tty)},read:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.get_char)throw new u.ErrnoError(60);for(var d=0,w=0;w<a;w++){var k;try{k=o.tty.ops.get_char(o.tty)}catch{throw new u.ErrnoError(29)}if(k===void 0&&d===0)throw new u.ErrnoError(6);if(k==null)break;d++,i[l+w]=k}return d&&(o.node.timestamp=Date.now()),d},write:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var d=0;d<a;d++)o.tty.ops.put_char(o.tty,i[l+d])}catch{throw new u.ErrnoError(29)}return a&&(o.node.timestamp=Date.now()),d}},default_tty_ops:{get_char:function(o){if(!o.input.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i)return null;o.input=Xs(i,!0)}return o.input.shift()},put_char:function(o,i){i===null||i===10?(we(Wt(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(we(Wt(o.output,0)),o.output=[])}},default_tty1_ops:{put_char:function(o,i){i===null||i===10?(ft(Wt(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(ft(Wt(o.output,0)),o.output=[])}}};function Xl(o,i){return ar.fill(0,o,o+i),o}function Yl(o,i){return Math.ceil(o/i)*i}function na(o){o=Yl(o,65536);var i=ua(65536,o);return i?Xl(i,o):0}var ye={ops_table:null,mount:function(o){return ye.createNode(null,"/",16895,0)},createNode:function(o,i,l,a){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);ye.ops_table||(ye.ops_table={dir:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,lookup:ye.node_ops.lookup,mknod:ye.node_ops.mknod,rename:ye.node_ops.rename,unlink:ye.node_ops.unlink,rmdir:ye.node_ops.rmdir,readdir:ye.node_ops.readdir,symlink:ye.node_ops.symlink},stream:{llseek:ye.stream_ops.llseek}},file:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:{llseek:ye.stream_ops.llseek,read:ye.stream_ops.read,write:ye.stream_ops.write,allocate:ye.stream_ops.allocate,mmap:ye.stream_ops.mmap,msync:ye.stream_ops.msync}},link:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr,readlink:ye.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ye.node_ops.getattr,setattr:ye.node_ops.setattr},stream:u.chrdev_stream_ops}});var c=u.createNode(o,i,l,a);return u.isDir(c.mode)?(c.node_ops=ye.ops_table.dir.node,c.stream_ops=ye.ops_table.dir.stream,c.contents={}):u.isFile(c.mode)?(c.node_ops=ye.ops_table.file.node,c.stream_ops=ye.ops_table.file.stream,c.usedBytes=0,c.contents=null):u.isLink(c.mode)?(c.node_ops=ye.ops_table.link.node,c.stream_ops=ye.ops_table.link.stream):u.isChrdev(c.mode)&&(c.node_ops=ye.ops_table.chrdev.node,c.stream_ops=ye.ops_table.chrdev.stream),c.timestamp=Date.now(),o&&(o.contents[i]=c,o.timestamp=c.timestamp),c},getFileDataAsTypedArray:function(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage:function(o,i){var l=o.contents?o.contents.length:0;if(!(l>=i)){var a=1024*1024;i=Math.max(i,l*(l<a?2:1.125)>>>0),l!=0&&(i=Math.max(i,256));var c=o.contents;o.contents=new Uint8Array(i),o.usedBytes>0&&o.contents.set(c.subarray(0,o.usedBytes),0)}},resizeFileStorage:function(o,i){if(o.usedBytes!=i)if(i==0)o.contents=null,o.usedBytes=0;else{var l=o.contents;o.contents=new Uint8Array(i),l&&o.contents.set(l.subarray(0,Math.min(i,o.usedBytes))),o.usedBytes=i}},node_ops:{getattr:function(o){var i={};return i.dev=u.isChrdev(o.mode)?o.id:1,i.ino=o.id,i.mode=o.mode,i.nlink=1,i.uid=0,i.gid=0,i.rdev=o.rdev,u.isDir(o.mode)?i.size=4096:u.isFile(o.mode)?i.size=o.usedBytes:u.isLink(o.mode)?i.size=o.link.length:i.size=0,i.atime=new Date(o.timestamp),i.mtime=new Date(o.timestamp),i.ctime=new Date(o.timestamp),i.blksize=4096,i.blocks=Math.ceil(i.size/i.blksize),i},setattr:function(o,i){i.mode!==void 0&&(o.mode=i.mode),i.timestamp!==void 0&&(o.timestamp=i.timestamp),i.size!==void 0&&ye.resizeFileStorage(o,i.size)},lookup:function(o,i){throw u.genericErrors[44]},mknod:function(o,i,l,a){return ye.createNode(o,i,l,a)},rename:function(o,i,l){if(u.isDir(o.mode)){var a;try{a=u.lookupNode(i,l)}catch{}if(a)for(var c in a.contents)throw new u.ErrnoError(55)}delete o.parent.contents[o.name],o.parent.timestamp=Date.now(),o.name=l,i.contents[l]=o,i.timestamp=o.parent.timestamp,o.parent=i},unlink:function(o,i){delete o.contents[i],o.timestamp=Date.now()},rmdir:function(o,i){var l=u.lookupNode(o,i);for(var a in l.contents)throw new u.ErrnoError(55);delete o.contents[i],o.timestamp=Date.now()},readdir:function(o){var i=[".",".."];for(var l in o.contents)o.contents.hasOwnProperty(l)&&i.push(l);return i},symlink:function(o,i,l){var a=ye.createNode(o,i,41471,0);return a.link=l,a},readlink:function(o){if(!u.isLink(o.mode))throw new u.ErrnoError(28);return o.link}},stream_ops:{read:function(o,i,l,a,c){var d=o.node.contents;if(c>=o.node.usedBytes)return 0;var w=Math.min(o.node.usedBytes-c,a);if(w>8&&d.subarray)i.set(d.subarray(c,c+w),l);else for(var k=0;k<w;k++)i[l+k]=d[c+k];return w},write:function(o,i,l,a,c,d){if(i.buffer===St.buffer&&(d=!1),!a)return 0;var w=o.node;if(w.timestamp=Date.now(),i.subarray&&(!w.contents||w.contents.subarray)){if(d)return w.contents=i.subarray(l,l+a),w.usedBytes=a,a;if(w.usedBytes===0&&c===0)return w.contents=i.slice(l,l+a),w.usedBytes=a,a;if(c+a<=w.usedBytes)return w.contents.set(i.subarray(l,l+a),c),a}if(ye.expandFileStorage(w,c+a),w.contents.subarray&&i.subarray)w.contents.set(i.subarray(l,l+a),c);else for(var k=0;k<a;k++)w.contents[c+k]=i[l+k];return w.usedBytes=Math.max(w.usedBytes,c+a),a},llseek:function(o,i,l){var a=i;if(l===1?a+=o.position:l===2&&u.isFile(o.node.mode)&&(a+=o.node.usedBytes),a<0)throw new u.ErrnoError(28);return a},allocate:function(o,i,l){ye.expandFileStorage(o.node,i+l),o.node.usedBytes=Math.max(o.node.usedBytes,i+l)},mmap:function(o,i,l,a,c){if(!u.isFile(o.node.mode))throw new u.ErrnoError(43);var d,w,k=o.node.contents;if(!(c&2)&&k.buffer===St.buffer)w=!1,d=k.byteOffset;else{if((l>0||l+i<k.length)&&(k.subarray?k=k.subarray(l,l+i):k=Array.prototype.slice.call(k,l,l+i)),w=!0,d=na(i),!d)throw new u.ErrnoError(48);St.set(k,d)}return{ptr:d,allocated:w}},msync:function(o,i,l,a,c){return ye.stream_ops.write(o,i,0,a,l,!1),0}}};function Zl(o,i,l,a){var c=a?"":"al "+o;Vt(o,d=>{Mn(d,'Loading data file "'+o+'" failed (no arrayBuffer).'),i(new Uint8Array(d)),c&&Ci()},d=>{if(l)l();else throw'Loading data file "'+o+'" failed.'}),c&&Gs()}var u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(o,i={})=>{if(o=on.resolve(o),!o)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(i=Object.assign(l,i),i.recurse_count>8)throw new u.ErrnoError(32);for(var a=o.split("/").filter(se=>!!se),c=u.root,d="/",w=0;w<a.length;w++){var k=w===a.length-1;if(k&&i.parent)break;if(c=u.lookupNode(c,a[w]),d=Oe.join2(d,a[w]),u.isMountpoint(c)&&(!k||k&&i.follow_mount)&&(c=c.mounted.root),!k||i.follow)for(var L=0;u.isLink(c.mode);){var J=u.readlink(d);d=on.resolve(Oe.dirname(d),J);var ee=u.lookupPath(d,{recurse_count:i.recurse_count+1});if(c=ee.node,L++>40)throw new u.ErrnoError(32)}}return{path:d,node:c}},getPath:o=>{for(var i;;){if(u.isRoot(o)){var l=o.mount.mountpoint;return i?l[l.length-1]!=="/"?l+"/"+i:l+i:l}i=i?o.name+"/"+i:o.name,o=o.parent}},hashName:(o,i)=>{for(var l=0,a=0;a<i.length;a++)l=(l<<5)-l+i.charCodeAt(a)|0;return(o+l>>>0)%u.nameTable.length},hashAddNode:o=>{var i=u.hashName(o.parent.id,o.name);o.name_next=u.nameTable[i],u.nameTable[i]=o},hashRemoveNode:o=>{var i=u.hashName(o.parent.id,o.name);if(u.nameTable[i]===o)u.nameTable[i]=o.name_next;else for(var l=u.nameTable[i];l;){if(l.name_next===o){l.name_next=o.name_next;break}l=l.name_next}},lookupNode:(o,i)=>{var l=u.mayLookup(o);if(l)throw new u.ErrnoError(l,o);for(var a=u.hashName(o.id,i),c=u.nameTable[a];c;c=c.name_next){var d=c.name;if(c.parent.id===o.id&&d===i)return c}return u.lookup(o,i)},createNode:(o,i,l,a)=>{var c=new u.FSNode(o,i,l,a);return u.hashAddNode(c),c},destroyNode:o=>{u.hashRemoveNode(o)},isRoot:o=>o===o.parent,isMountpoint:o=>!!o.mounted,isFile:o=>(o&61440)===32768,isDir:o=>(o&61440)===16384,isLink:o=>(o&61440)===40960,isChrdev:o=>(o&61440)===8192,isBlkdev:o=>(o&61440)===24576,isFIFO:o=>(o&61440)===4096,isSocket:o=>(o&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:o=>{var i=u.flagModes[o];if(typeof i>"u")throw new Error("Unknown file open mode: "+o);return i},flagsToPermissionString:o=>{var i=["r","w","rw"][o&3];return o&512&&(i+="w"),i},nodePermissions:(o,i)=>u.ignorePermissions?0:i.includes("r")&&!(o.mode&292)||i.includes("w")&&!(o.mode&146)||i.includes("x")&&!(o.mode&73)?2:0,mayLookup:o=>{var i=u.nodePermissions(o,"x");return i||(o.node_ops.lookup?0:2)},mayCreate:(o,i)=>{try{var l=u.lookupNode(o,i);return 20}catch{}return u.nodePermissions(o,"wx")},mayDelete:(o,i,l)=>{var a;try{a=u.lookupNode(o,i)}catch(d){return d.errno}var c=u.nodePermissions(o,"wx");if(c)return c;if(l){if(!u.isDir(a.mode))return 54;if(u.isRoot(a)||u.getPath(a)===u.cwd())return 10}else if(u.isDir(a.mode))return 31;return 0},mayOpen:(o,i)=>o?u.isLink(o.mode)?32:u.isDir(o.mode)&&(u.flagsToPermissionString(i)!=="r"||i&512)?31:u.nodePermissions(o,u.flagsToPermissionString(i)):44,MAX_OPEN_FDS:4096,nextfd:(o=0,i=u.MAX_OPEN_FDS)=>{for(var l=o;l<=i;l++)if(!u.streams[l])return l;throw new u.ErrnoError(33)},getStream:o=>u.streams[o],createStream:(o,i,l)=>{u.FSStream||(u.FSStream=function(){this.shared={}},u.FSStream.prototype={},Object.defineProperties(u.FSStream.prototype,{object:{get:function(){return this.node},set:function(c){this.node=c}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(c){this.shared.flags=c}},position:{get:function(){return this.shared.position},set:function(c){this.shared.position=c}}})),o=Object.assign(new u.FSStream,o);var a=u.nextfd(i,l);return o.fd=a,u.streams[a]=o,o},closeStream:o=>{u.streams[o]=null},chrdev_stream_ops:{open:o=>{var i=u.getDevice(o.node.rdev);o.stream_ops=i.stream_ops,o.stream_ops.open&&o.stream_ops.open(o)},llseek:()=>{throw new u.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,i)=>o<<8|i,registerDevice:(o,i)=>{u.devices[o]={stream_ops:i}},getDevice:o=>u.devices[o],getMounts:o=>{for(var i=[],l=[o];l.length;){var a=l.pop();i.push(a),l.push.apply(l,a.mounts)}return i},syncfs:(o,i)=>{typeof o=="function"&&(i=o,o=!1),u.syncFSRequests++,u.syncFSRequests>1&&ft("warning: "+u.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=u.getMounts(u.root.mount),a=0;function c(w){return u.syncFSRequests--,i(w)}function d(w){if(w)return d.errored?void 0:(d.errored=!0,c(w));++a>=l.length&&c(null)}l.forEach(w=>{if(!w.type.syncfs)return d(null);w.type.syncfs(w,o,d)})},mount:(o,i,l)=>{var a=l==="/",c=!l,d;if(a&&u.root)throw new u.ErrnoError(10);if(!a&&!c){var w=u.lookupPath(l,{follow_mount:!1});if(l=w.path,d=w.node,u.isMountpoint(d))throw new u.ErrnoError(10);if(!u.isDir(d.mode))throw new u.ErrnoError(54)}var k={type:o,opts:i,mountpoint:l,mounts:[]},L=o.mount(k);return L.mount=k,k.root=L,a?u.root=L:d&&(d.mounted=k,d.mount&&d.mount.mounts.push(k)),L},unmount:o=>{var i=u.lookupPath(o,{follow_mount:!1});if(!u.isMountpoint(i.node))throw new u.ErrnoError(28);var l=i.node,a=l.mounted,c=u.getMounts(a);Object.keys(u.nameTable).forEach(w=>{for(var k=u.nameTable[w];k;){var L=k.name_next;c.includes(k.mount)&&u.destroyNode(k),k=L}}),l.mounted=null;var d=l.mount.mounts.indexOf(a);l.mount.mounts.splice(d,1)},lookup:(o,i)=>o.node_ops.lookup(o,i),mknod:(o,i,l)=>{var a=u.lookupPath(o,{parent:!0}),c=a.node,d=Oe.basename(o);if(!d||d==="."||d==="..")throw new u.ErrnoError(28);var w=u.mayCreate(c,d);if(w)throw new u.ErrnoError(w);if(!c.node_ops.mknod)throw new u.ErrnoError(63);return c.node_ops.mknod(c,d,i,l)},create:(o,i)=>(i=i!==void 0?i:438,i&=4095,i|=32768,u.mknod(o,i,0)),mkdir:(o,i)=>(i=i!==void 0?i:511,i&=1023,i|=16384,u.mknod(o,i,0)),mkdirTree:(o,i)=>{for(var l=o.split("/"),a="",c=0;c<l.length;++c)if(l[c]){a+="/"+l[c];try{u.mkdir(a,i)}catch(d){if(d.errno!=20)throw d}}},mkdev:(o,i,l)=>(typeof l>"u"&&(l=i,i=438),i|=8192,u.mknod(o,i,l)),symlink:(o,i)=>{if(!on.resolve(o))throw new u.ErrnoError(44);var l=u.lookupPath(i,{parent:!0}),a=l.node;if(!a)throw new u.ErrnoError(44);var c=Oe.basename(i),d=u.mayCreate(a,c);if(d)throw new u.ErrnoError(d);if(!a.node_ops.symlink)throw new u.ErrnoError(63);return a.node_ops.symlink(a,c,o)},rename:(o,i)=>{var l=Oe.dirname(o),a=Oe.dirname(i),c=Oe.basename(o),d=Oe.basename(i),w,k,L;if(w=u.lookupPath(o,{parent:!0}),k=w.node,w=u.lookupPath(i,{parent:!0}),L=w.node,!k||!L)throw new u.ErrnoError(44);if(k.mount!==L.mount)throw new u.ErrnoError(75);var J=u.lookupNode(k,c),ee=on.relative(o,a);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=on.relative(i,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var se;try{se=u.lookupNode(L,d)}catch{}if(J!==se){var T=u.isDir(J.mode),g=u.mayDelete(k,c,T);if(g)throw new u.ErrnoError(g);if(g=se?u.mayDelete(L,d,T):u.mayCreate(L,d),g)throw new u.ErrnoError(g);if(!k.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(J)||se&&u.isMountpoint(se))throw new u.ErrnoError(10);if(L!==k&&(g=u.nodePermissions(k,"w"),g))throw new u.ErrnoError(g);u.hashRemoveNode(J);try{k.node_ops.rename(J,L,d)}catch(y){throw y}finally{u.hashAddNode(J)}}},rmdir:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node,a=Oe.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!0);if(d)throw new u.ErrnoError(d);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.rmdir(l,a),u.destroyNode(c)},readdir:o=>{var i=u.lookupPath(o,{follow:!0}),l=i.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node;if(!l)throw new u.ErrnoError(44);var a=Oe.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!1);if(d)throw new u.ErrnoError(d);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.unlink(l,a),u.destroyNode(c)},readlink:o=>{var i=u.lookupPath(o),l=i.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return on.resolve(u.getPath(l.parent),l.node_ops.readlink(l))},stat:(o,i)=>{var l=u.lookupPath(o,{follow:!i}),a=l.node;if(!a)throw new u.ErrnoError(44);if(!a.node_ops.getattr)throw new u.ErrnoError(63);return a.node_ops.getattr(a)},lstat:o=>u.stat(o,!0),chmod:(o,i,l)=>{var a;if(typeof o=="string"){var c=u.lookupPath(o,{follow:!l});a=c.node}else a=o;if(!a.node_ops.setattr)throw new u.ErrnoError(63);a.node_ops.setattr(a,{mode:i&4095|a.mode&-4096,timestamp:Date.now()})},lchmod:(o,i)=>{u.chmod(o,i,!0)},fchmod:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);u.chmod(l.node,i)},chown:(o,i,l,a)=>{var c;if(typeof o=="string"){var d=u.lookupPath(o,{follow:!a});c=d.node}else c=o;if(!c.node_ops.setattr)throw new u.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown:(o,i,l)=>{u.chown(o,i,l,!0)},fchown:(o,i,l)=>{var a=u.getStream(o);if(!a)throw new u.ErrnoError(8);u.chown(a.node,i,l)},truncate:(o,i)=>{if(i<0)throw new u.ErrnoError(28);var l;if(typeof o=="string"){var a=u.lookupPath(o,{follow:!0});l=a.node}else l=o;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var c=u.nodePermissions(l,"w");if(c)throw new u.ErrnoError(c);l.node_ops.setattr(l,{size:i,timestamp:Date.now()})},ftruncate:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,i)},utime:(o,i,l)=>{var a=u.lookupPath(o,{follow:!0}),c=a.node;c.node_ops.setattr(c,{timestamp:Math.max(i,l)})},open:(o,i,l)=>{if(o==="")throw new u.ErrnoError(44);i=typeof i=="string"?u.modeStringToFlags(i):i,l=typeof l>"u"?438:l,i&64?l=l&4095|32768:l=0;var a;if(typeof o=="object")a=o;else{o=Oe.normalize(o);try{var c=u.lookupPath(o,{follow:!(i&131072)});a=c.node}catch{}}var d=!1;if(i&64)if(a){if(i&128)throw new u.ErrnoError(20)}else a=u.mknod(o,l,0),d=!0;if(!a)throw new u.ErrnoError(44);if(u.isChrdev(a.mode)&&(i&=-513),i&65536&&!u.isDir(a.mode))throw new u.ErrnoError(54);if(!d){var w=u.mayOpen(a,i);if(w)throw new u.ErrnoError(w)}i&512&&!d&&u.truncate(a,0),i&=-131713;var k=u.createStream({node:a,path:u.getPath(a),flags:i,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1});return k.stream_ops.open&&k.stream_ops.open(k),n.logReadFiles&&!(i&1)&&(u.readFiles||(u.readFiles={}),o in u.readFiles||(u.readFiles[o]=1)),k},close:o=>{if(u.isClosed(o))throw new u.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(i){throw i}finally{u.closeStream(o.fd)}o.fd=null},isClosed:o=>o.fd===null,llseek:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return o.position=o.stream_ops.llseek(o,i,l),o.ungotten=[],o.position},read:(o,i,l,a,c)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if((o.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.read)throw new u.ErrnoError(28);var d=typeof c<"u";if(!d)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var w=o.stream_ops.read(o,i,l,a,c);return d||(o.position+=w),w},write:(o,i,l,a,c,d)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.write)throw new u.ErrnoError(28);o.seekable&&o.flags&1024&&u.llseek(o,0,2);var w=typeof c<"u";if(!w)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var k=o.stream_ops.write(o,i,l,a,c,d);return w||(o.position+=k),k},allocate:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(i<0||l<=0)throw new u.ErrnoError(28);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(o.node.mode)&&!u.isDir(o.node.mode))throw new u.ErrnoError(43);if(!o.stream_ops.allocate)throw new u.ErrnoError(138);o.stream_ops.allocate(o,i,l)},mmap:(o,i,l,a,c)=>{if(a&2&&!(c&2)&&(o.flags&2097155)!==2)throw new u.ErrnoError(2);if((o.flags&2097155)===1)throw new u.ErrnoError(2);if(!o.stream_ops.mmap)throw new u.ErrnoError(43);return o.stream_ops.mmap(o,i,l,a,c)},msync:(o,i,l,a,c)=>o.stream_ops.msync?o.stream_ops.msync(o,i,l,a,c):0,munmap:o=>0,ioctl:(o,i,l)=>{if(!o.stream_ops.ioctl)throw new u.ErrnoError(59);return o.stream_ops.ioctl(o,i,l)},readFile:(o,i={})=>{if(i.flags=i.flags||0,i.encoding=i.encoding||"binary",i.encoding!=="utf8"&&i.encoding!=="binary")throw new Error('Invalid encoding type "'+i.encoding+'"');var l,a=u.open(o,i.flags),c=u.stat(o),d=c.size,w=new Uint8Array(d);return u.read(a,w,0,d,0),i.encoding==="utf8"?l=Wt(w,0):i.encoding==="binary"&&(l=w),u.close(a),l},writeFile:(o,i,l={})=>{l.flags=l.flags||577;var a=u.open(o,l.flags,l.mode);if(typeof i=="string"){var c=new Uint8Array(zr(i)+1),d=wn(i,c,0,c.length);u.write(a,c,0,d,void 0,l.canOwn)}else if(ArrayBuffer.isView(i))u.write(a,i,0,i.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(a)},cwd:()=>u.currentPath,chdir:o=>{var i=u.lookupPath(o,{follow:!0});if(i.node===null)throw new u.ErrnoError(44);if(!u.isDir(i.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(i.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=i.path},createDefaultDirectories:()=>{u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices:()=>{u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(i,l,a,c,d)=>c}),u.mkdev("/dev/null",u.makedev(1,3)),Qn.register(u.makedev(5,0),Qn.default_tty_ops),Qn.register(u.makedev(6,0),Qn.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var o=Kl();u.createDevice("/dev","random",o),u.createDevice("/dev","urandom",o),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{u.mkdir("/proc");var o=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount:()=>{var i=u.createNode(o,"fd",16895,73);return i.node_ops={lookup:(l,a)=>{var c=+a,d=u.getStream(c);if(!d)throw new u.ErrnoError(8);var w={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>d.path}};return w.parent=w,w}},i}},{},"/proc/self/fd")},createStandardStreams:()=>{n.stdin?u.createDevice("/dev","stdin",n.stdin):u.symlink("/dev/tty","/dev/stdin"),n.stdout?u.createDevice("/dev","stdout",null,n.stdout):u.symlink("/dev/tty","/dev/stdout"),n.stderr?u.createDevice("/dev","stderr",null,n.stderr):u.symlink("/dev/tty1","/dev/stderr"),u.open("/dev/stdin",0),u.open("/dev/stdout",1),u.open("/dev/stderr",1)},ensureErrnoError:()=>{u.ErrnoError||(u.ErrnoError=function(i,l){this.node=l,this.setErrno=function(a){this.errno=a},this.setErrno(i),this.message="FS error"},u.ErrnoError.prototype=new Error,u.ErrnoError.prototype.constructor=u.ErrnoError,[44].forEach(o=>{u.genericErrors[o]=new u.ErrnoError(o),u.genericErrors[o].stack="<generic error, no stack>"}))},staticInit:()=>{u.ensureErrnoError(),u.nameTable=new Array(4096),u.mount(ye,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:ye}},init:(o,i,l)=>{u.init.initialized=!0,u.ensureErrnoError(),n.stdin=o||n.stdin,n.stdout=i||n.stdout,n.stderr=l||n.stderr,u.createStandardStreams()},quit:()=>{u.init.initialized=!1;for(var o=0;o<u.streams.length;o++){var i=u.streams[o];i&&u.close(i)}},getMode:(o,i)=>{var l=0;return o&&(l|=365),i&&(l|=146),l},findObject:(o,i)=>{var l=u.analyzePath(o,i);return l.exists?l.object:null},analyzePath:(o,i)=>{try{var l=u.lookupPath(o,{follow:!i});o=l.path}catch{}var a={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(o,{parent:!0});a.parentExists=!0,a.parentPath=l.path,a.parentObject=l.node,a.name=Oe.basename(o),l=u.lookupPath(o,{follow:!i}),a.exists=!0,a.path=l.path,a.object=l.node,a.name=l.node.name,a.isRoot=l.path==="/"}catch(c){a.error=c.errno}return a},createPath:(o,i,l,a)=>{o=typeof o=="string"?o:u.getPath(o);for(var c=i.split("/").reverse();c.length;){var d=c.pop();if(d){var w=Oe.join2(o,d);try{u.mkdir(w)}catch{}o=w}}return w},createFile:(o,i,l,a,c)=>{var d=Oe.join2(typeof o=="string"?o:u.getPath(o),i),w=u.getMode(a,c);return u.create(d,w)},createDataFile:(o,i,l,a,c,d)=>{var w=i;o&&(o=typeof o=="string"?o:u.getPath(o),w=i?Oe.join2(o,i):o);var k=u.getMode(a,c),L=u.create(w,k);if(l){if(typeof l=="string"){for(var J=new Array(l.length),ee=0,se=l.length;ee<se;++ee)J[ee]=l.charCodeAt(ee);l=J}u.chmod(L,k|146);var T=u.open(L,577);u.write(T,l,0,l.length,0,d),u.close(T),u.chmod(L,k)}return L},createDevice:(o,i,l,a)=>{var c=Oe.join2(typeof o=="string"?o:u.getPath(o),i),d=u.getMode(!!l,!!a);u.createDevice.major||(u.createDevice.major=64);var w=u.makedev(u.createDevice.major++,0);return u.registerDevice(w,{open:k=>{k.seekable=!1},close:k=>{a&&a.buffer&&a.buffer.length&&a(10)},read:(k,L,J,ee,se)=>{for(var T=0,g=0;g<ee;g++){var y;try{y=l()}catch{throw new u.ErrnoError(29)}if(y===void 0&&T===0)throw new u.ErrnoError(6);if(y==null)break;T++,L[J+g]=y}return T&&(k.node.timestamp=Date.now()),T},write:(k,L,J,ee,se)=>{for(var T=0;T<ee;T++)try{a(L[J+T])}catch{throw new u.ErrnoError(29)}return ee&&(k.node.timestamp=Date.now()),T}}),u.mkdev(c,d,w)},forceLoadFile:o=>{if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(yn)try{o.contents=Xs(yn(o.url),!0),o.usedBytes=o.contents.length}catch{throw new u.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(o,i,l,a,c)=>{function d(){this.lengthKnown=!1,this.chunks=[]}if(d.prototype.get=function(g){if(!(g>this.length-1||g<0)){var y=g%this.chunkSize,v=g/this.chunkSize|0;return this.getter(v)[y]}},d.prototype.setDataGetter=function(g){this.getter=g},d.prototype.cacheLength=function(){var g=new XMLHttpRequest;if(g.open("HEAD",l,!1),g.send(null),!(g.status>=200&&g.status<300||g.status===304))throw new Error("Couldn't load "+l+". Status: "+g.status);var y=Number(g.getResponseHeader("Content-length")),v,S=(v=g.getResponseHeader("Accept-Ranges"))&&v==="bytes",b=(v=g.getResponseHeader("Content-Encoding"))&&v==="gzip",Q=1024*1024;S||(Q=y);var V=(K,le)=>{if(K>le)throw new Error("invalid range ("+K+", "+le+") or no bytes requested!");if(le>y-1)throw new Error("only "+y+" bytes available! programmer error!");var _=new XMLHttpRequest;if(_.open("GET",l,!1),y!==Q&&_.setRequestHeader("Range","bytes="+K+"-"+le),_.responseType="arraybuffer",_.overrideMimeType&&_.overrideMimeType("text/plain; charset=x-user-defined"),_.send(null),!(_.status>=200&&_.status<300||_.status===304))throw new Error("Couldn't load "+l+". Status: "+_.status);return _.response!==void 0?new Uint8Array(_.response||[]):Xs(_.responseText||"",!0)},D=this;D.setDataGetter(K=>{var le=K*Q,_=(K+1)*Q-1;if(_=Math.min(_,y-1),typeof D.chunks[K]>"u"&&(D.chunks[K]=V(le,_)),typeof D.chunks[K]>"u")throw new Error("doXHR failed!");return D.chunks[K]}),(b||!y)&&(Q=y=1,y=this.getter(0).length,Q=y,we("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=y,this._chunkSize=Q,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!Te)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var w=new d;Object.defineProperties(w,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var k={isDevice:!1,contents:w}}else var k={isDevice:!1,url:l};var L=u.createFile(o,i,k,a,c);k.contents?L.contents=k.contents:k.url&&(L.contents=null,L.url=k.url),Object.defineProperties(L,{usedBytes:{get:function(){return this.contents.length}}});var J={},ee=Object.keys(L.stream_ops);ee.forEach(T=>{var g=L.stream_ops[T];J[T]=function(){return u.forceLoadFile(L),g.apply(null,arguments)}});function se(T,g,y,v,S){var b=T.node.contents;if(S>=b.length)return 0;var Q=Math.min(b.length-S,v);if(b.slice)for(var V=0;V<Q;V++)g[y+V]=b[S+V];else for(var V=0;V<Q;V++)g[y+V]=b.get(S+V);return Q}return J.read=(T,g,y,v,S)=>(u.forceLoadFile(L),se(T,g,y,v,S)),J.mmap=(T,g,y,v,S)=>{u.forceLoadFile(L);var b=na(g);if(!b)throw new u.ErrnoError(48);return se(T,St,b,g,y),{ptr:b,allocated:!0}},L.stream_ops=J,L},createPreloadedFile:(o,i,l,a,c,d,w,k,L,J)=>{var ee=i?on.resolve(Oe.join2(o,i)):o;function se(T){function g(y){J&&J(),k||u.createDataFile(o,i,y,a,c,L),d&&d(),Ci()}Browser.handledByPreloadPlugin(T,ee,g,()=>{w&&w(),Ci()})||g(T)}Gs(),typeof l=="string"?Zl(l,T=>se(T),w):se(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=()=>{we("creating db");var d=c.result;d.createObjectStore(u.DB_STORE_NAME)},c.onsuccess=()=>{var d=c.result,w=d.transaction([u.DB_STORE_NAME],"readwrite"),k=w.objectStore(u.DB_STORE_NAME),L=0,J=0,ee=o.length;function se(){J==0?i():l()}o.forEach(T=>{var g=k.put(u.analyzePath(T).object.contents,T);g.onsuccess=()=>{L++,L+J==ee&&se()},g.onerror=()=>{J++,L+J==ee&&se()}}),w.onerror=l},c.onerror=l},loadFilesFromDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=l,c.onsuccess=()=>{var d=c.result;try{var w=d.transaction([u.DB_STORE_NAME],"readonly")}catch(T){l(T);return}var k=w.objectStore(u.DB_STORE_NAME),L=0,J=0,ee=o.length;function se(){J==0?i():l()}o.forEach(T=>{var g=k.get(T);g.onsuccess=()=>{u.analyzePath(T).exists&&u.unlink(T),u.createDataFile(Oe.dirname(T),Oe.basename(T),g.result,!0,!0,!0),L++,L+J==ee&&se()},g.onerror=()=>{J++,L+J==ee&&se()}}),w.onerror=l},c.onerror=l}},fe={DEFAULT_POLLMASK:5,calculateAt:function(o,i,l){if(Oe.isAbs(i))return i;var a;if(o===-100)a=u.cwd();else{var c=fe.getStreamFromFD(o);a=c.path}if(i.length==0){if(!l)throw new u.ErrnoError(44);return a}return Oe.join2(a,i)},doStat:function(o,i,l){try{var a=o(i)}catch(k){if(k&&k.node&&Oe.normalize(i)!==Oe.normalize(u.getPath(k.node)))return-54;throw k}Ne[l>>2]=a.dev,Ne[l+8>>2]=a.ino,Ne[l+12>>2]=a.mode,Je[l+16>>2]=a.nlink,Ne[l+20>>2]=a.uid,Ne[l+24>>2]=a.gid,Ne[l+28>>2]=a.rdev,ot=[a.size>>>0,(Ee=a.size,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],Ne[l+40>>2]=ot[0],Ne[l+44>>2]=ot[1],Ne[l+48>>2]=4096,Ne[l+52>>2]=a.blocks;var c=a.atime.getTime(),d=a.mtime.getTime(),w=a.ctime.getTime();return ot=[Math.floor(c/1e3)>>>0,(Ee=Math.floor(c/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],Ne[l+56>>2]=ot[0],Ne[l+60>>2]=ot[1],Je[l+64>>2]=c%1e3*1e3,ot=[Math.floor(d/1e3)>>>0,(Ee=Math.floor(d/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],Ne[l+72>>2]=ot[0],Ne[l+76>>2]=ot[1],Je[l+80>>2]=d%1e3*1e3,ot=[Math.floor(w/1e3)>>>0,(Ee=Math.floor(w/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],Ne[l+88>>2]=ot[0],Ne[l+92>>2]=ot[1],Je[l+96>>2]=w%1e3*1e3,ot=[a.ino>>>0,(Ee=a.ino,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],Ne[l+104>>2]=ot[0],Ne[l+108>>2]=ot[1],0},doMsync:function(o,i,l,a,c){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);if(a&2)return 0;var d=ar.slice(o,o+l);u.msync(i,d,c,l,a)},varargs:void 0,get:function(){fe.varargs+=4;var o=Ne[fe.varargs-4>>2];return o},getStr:function(o){var i=Js(o);return i},getStreamFromFD:function(o){var i=u.getStream(o);if(!i)throw new u.ErrnoError(8);return i}};function ec(o,i){try{return o=fe.getStr(o),u.chmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function tc(o,i,l,a){try{if(i=fe.getStr(i),i=fe.calculateAt(o,i),l&-8)return-28;var c=u.lookupPath(i,{follow:!0}),d=c.node;if(!d)return-44;var w="";return l&4&&(w+="r"),l&2&&(w+="w"),l&1&&(w+="x"),w&&u.nodePermissions(d,w)?-2:0}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function nc(o,i){try{return u.fchmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function rc(o,i,l){try{return u.fchown(o,i,l),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function ic(o){return Ne[la()>>2]=o,o}function sc(o,i,l){fe.varargs=l;try{var a=fe.getStreamFromFD(o);switch(i){case 0:{var c=fe.get();if(c<0)return-28;var d;return d=u.createStream(a,c),d.fd}case 1:case 2:return 0;case 3:return a.flags;case 4:{var c=fe.get();return a.flags|=c,0}case 5:{var c=fe.get(),w=0;return Jo[c+w>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return ic(28),-1;default:return-28}}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function oc(o,i){try{var l=fe.getStreamFromFD(o);return fe.doStat(u.stat,l.path,i)}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}var ac=9007199254740992,lc=-9007199254740992;function ra(o){return o<lc||o>ac?NaN:Number(o)}function cc(o,i){try{return i=ra(i),isNaN(i)?-61:(u.ftruncate(o,i),0)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function uc(o,i){try{if(i===0)return-28;var l=u.cwd(),a=zr(l)+1;return i<a?-68:(Ho(l,o,i),a)}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return-c.errno}}function dc(o,i,l){fe.varargs=l;try{var a=fe.getStreamFromFD(o);switch(i){case 21509:case 21505:return a.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return a.tty?0:-59;case 21519:{if(!a.tty)return-59;var c=fe.get();return Ne[c>>2]=0,0}case 21520:return a.tty?-28:-59;case 21531:{var c=fe.get();return u.ioctl(a,i,c)}case 21523:return a.tty?0:-59;case 21524:return a.tty?0:-59;default:return-28}}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function fc(o,i){try{return o=fe.getStr(o),fe.doStat(u.lstat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function hc(o,i,l){try{return i=fe.getStr(i),i=fe.calculateAt(o,i),i=Oe.normalize(i),i[i.length-1]==="/"&&(i=i.substr(0,i.length-1)),u.mkdir(i,l,0),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function pc(o,i,l,a){try{i=fe.getStr(i);var c=a&256,d=a&4096;return a=a&-6401,i=fe.calculateAt(o,i,d),fe.doStat(c?u.lstat:u.stat,i,l)}catch(w){if(typeof u>"u"||!(w instanceof u.ErrnoError))throw w;return-w.errno}}function _c(o,i,l,a){fe.varargs=a;try{i=fe.getStr(i),i=fe.calculateAt(o,i);var c=a?fe.get():0;return u.open(i,l,c).fd}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function mc(o,i,l,a){try{if(i=fe.getStr(i),i=fe.calculateAt(o,i),a<=0)return-28;var c=u.readlink(i),d=Math.min(a,zr(c)),w=St[l+d];return Ho(c,l,a+1),St[l+d]=w,d}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function yc(o){try{return o=fe.getStr(o),u.rmdir(o),0}catch(i){if(typeof u>"u"||!(i instanceof u.ErrnoError))throw i;return-i.errno}}function gc(o,i){try{return o=fe.getStr(o),fe.doStat(u.stat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function wc(o,i,l){try{return i=fe.getStr(i),i=fe.calculateAt(o,i),l===0?u.unlink(i):l===512?u.rmdir(i):lr("Invalid flags passed to unlinkat"),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function Ys(o){return Je[o>>2]+Ne[o+4>>2]*4294967296}function bc(o,i,l,a){try{if(i=fe.getStr(i),i=fe.calculateAt(o,i,!0),l){var w=Ys(l),k=Ne[l+8>>2];c=w*1e3+k/(1e3*1e3),l+=16,w=Ys(l),k=Ne[l+8>>2],d=w*1e3+k/(1e3*1e3)}else var c=Date.now(),d=c;return u.utime(i,c,d),0}catch(L){if(typeof u>"u"||!(L instanceof u.ErrnoError))throw L;return-L.errno}}var qc=!0;function Nc(){return qc}function vc(o){return o%4===0&&(o%100!==0||o%400===0)}var xc=[0,31,60,91,121,152,182,213,244,274,305,335],Ec=[0,31,59,90,120,151,181,212,243,273,304,334];function Sc(o){var i=vc(o.getFullYear()),l=i?xc:Ec,a=l[o.getMonth()]+o.getDate()-1;return a}function Ac(o,i){var l=new Date(Ys(o)*1e3);Ne[i>>2]=l.getSeconds(),Ne[i+4>>2]=l.getMinutes(),Ne[i+8>>2]=l.getHours(),Ne[i+12>>2]=l.getDate(),Ne[i+16>>2]=l.getMonth(),Ne[i+20>>2]=l.getFullYear()-1900,Ne[i+24>>2]=l.getDay();var a=Sc(l)|0;Ne[i+28>>2]=a,Ne[i+36>>2]=-(l.getTimezoneOffset()*60);var c=new Date(l.getFullYear(),0,1),d=new Date(l.getFullYear(),6,1).getTimezoneOffset(),w=c.getTimezoneOffset(),k=(d!=w&&l.getTimezoneOffset()==Math.min(w,d))|0;Ne[i+32>>2]=k}function kc(o,i,l,a,c,d,w){try{var k=fe.getStreamFromFD(a),L=u.mmap(k,o,c,i,l),J=L.ptr;return Ne[d>>2]=L.allocated,Je[w>>2]=J,0}catch(ee){if(typeof u>"u"||!(ee instanceof u.ErrnoError))throw ee;return-ee.errno}}function Ic(o,i,l,a,c,d){try{var w=fe.getStreamFromFD(c);l&2&&fe.doMsync(o,w,i,a,d),u.munmap(w)}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function ia(o){var i=zr(o)+1,l=ca(i);return l&&wn(o,St,l,i),l}function Oc(o,i,l){var a=new Date().getFullYear(),c=new Date(a,0,1),d=new Date(a,6,1),w=c.getTimezoneOffset(),k=d.getTimezoneOffset(),L=Math.max(w,k);Je[o>>2]=L*60,Ne[i>>2]=+(w!=k);function J(y){var v=y.toTimeString().match(/\(([A-Za-z ]+)\)$/);return v?v[1]:"GMT"}var ee=J(c),se=J(d),T=ia(ee),g=ia(se);k<w?(Je[l>>2]=T,Je[l+4>>2]=g):(Je[l>>2]=g,Je[l+4>>2]=T)}function Tc(){return Date.now()}var sa;sa=()=>performance.now();function Cc(){return 2147483648}function Fc(o){var i=$t.buffer;try{return $t.grow(o-i.byteLength+65535>>>16),Go(),1}catch{}}function Pc(o){var i=ar.length;o=o>>>0;var l=Cc();if(o>l)return!1;let a=(L,J)=>L+(J-L%J)%J;for(var c=1;c<=4;c*=2){var d=i*(1+.2/c);d=Math.min(d,o+100663296);var w=Math.min(l,a(Math.max(o,d),65536)),k=Fc(w);if(k)return!0}return!1}var Zs={};function Lc(){return Ze||"./this.program"}function $r(){if(!$r.strings){var o=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:Lc()};for(var l in Zs)Zs[l]===void 0?delete i[l]:i[l]=Zs[l];var a=[];for(var l in i)a.push(l+"="+i[l]);$r.strings=a}return $r.strings}function Wc(o,i,l){for(var a=0;a<o.length;++a)St[i++>>0]=o.charCodeAt(a);l||(St[i>>0]=0)}function Dc(o,i){var l=0;return $r().forEach(function(a,c){var d=i+l;Je[o+c*4>>2]=d,Wc(a,d),l+=a.length+1}),0}function Rc(o,i){var l=$r();Je[o>>2]=l.length;var a=0;return l.forEach(function(c){a+=c.length+1}),Je[i>>2]=a,0}function Mc(o){try{var i=fe.getStreamFromFD(o);return u.close(i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Bc(o,i){try{var l=fe.getStreamFromFD(o),a=l.tty?2:u.isDir(l.mode)?3:u.isLink(l.mode)?7:4;return St[i>>0]=a,0}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return c.errno}}function Qc(o,i,l,a){for(var c=0,d=0;d<l;d++){var w=Je[i>>2],k=Je[i+4>>2];i+=8;var L=u.read(o,St,w,k,a);if(L<0)return-1;if(c+=L,L<k)break;typeof a<"u"&&(a+=L)}return c}function Uc(o,i,l,a){try{var c=fe.getStreamFromFD(o),d=Qc(c,i,l);return Je[a>>2]=d,0}catch(w){if(typeof u>"u"||!(w instanceof u.ErrnoError))throw w;return w.errno}}function jc(o,i,l,a){try{if(i=ra(i),isNaN(i))return 61;var c=fe.getStreamFromFD(o);return u.llseek(c,i,l),ot=[c.position>>>0,(Ee=c.position,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],Ne[a>>2]=ot[0],Ne[a+4>>2]=ot[1],c.getdents&&i===0&&l===0&&(c.getdents=null),0}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return d.errno}}function zc(o){try{var i=fe.getStreamFromFD(o);return i.stream_ops&&i.stream_ops.fsync?i.stream_ops.fsync(i):0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Vc(o,i,l,a){for(var c=0,d=0;d<l;d++){var w=Je[i>>2],k=Je[i+4>>2];i+=8;var L=u.write(o,St,w,k,a);if(L<0)return-1;c+=L,typeof a<"u"&&(a+=L)}return c}function $c(o,i,l,a){try{var c=fe.getStreamFromFD(o),d=Vc(c,i,l);return Je[a>>2]=d,0}catch(w){if(typeof u>"u"||!(w instanceof u.ErrnoError))throw w;return w.errno}}var oa=function(o,i,l,a){o||(o=this),this.parent=o,this.mount=o.mount,this.mounted=null,this.id=u.nextInode++,this.name=i,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=a},Fi=365,Pi=146;Object.defineProperties(oa.prototype,{read:{get:function(){return(this.mode&Fi)===Fi},set:function(o){o?this.mode|=Fi:this.mode&=~Fi}},write:{get:function(){return(this.mode&Pi)===Pi},set:function(o){o?this.mode|=Pi:this.mode&=~Pi}},isFolder:{get:function(){return u.isDir(this.mode)}},isDevice:{get:function(){return u.isChrdev(this.mode)}}}),u.FSNode=oa,u.staticInit();var aa={__syscall_chmod:ec,__syscall_faccessat:tc,__syscall_fchmod:nc,__syscall_fchown32:rc,__syscall_fcntl64:sc,__syscall_fstat64:oc,__syscall_ftruncate64:cc,__syscall_getcwd:uc,__syscall_ioctl:dc,__syscall_lstat64:fc,__syscall_mkdirat:hc,__syscall_newfstatat:pc,__syscall_openat:_c,__syscall_readlinkat:mc,__syscall_rmdir:yc,__syscall_stat64:gc,__syscall_unlinkat:wc,__syscall_utimensat:bc,_emscripten_get_now_is_monotonic:Nc,_localtime_js:Ac,_mmap_js:kc,_munmap_js:Ic,_tzset_js:Oc,emscripten_date_now:Tc,emscripten_get_now:sa,emscripten_resize_heap:Pc,environ_get:Dc,environ_sizes_get:Rc,fd_close:Mc,fd_fdstat_get:Bc,fd_read:Uc,fd_seek:jc,fd_sync:zc,fd_write:$c,memory:$t};Gl(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._sqlite3_status64=function(){return(n._sqlite3_status64=n.asm.sqlite3_status64).apply(null,arguments)},n._sqlite3_status=function(){return(n._sqlite3_status=n.asm.sqlite3_status).apply(null,arguments)},n._sqlite3_db_status=function(){return(n._sqlite3_db_status=n.asm.sqlite3_db_status).apply(null,arguments)},n._sqlite3_msize=function(){return(n._sqlite3_msize=n.asm.sqlite3_msize).apply(null,arguments)},n._sqlite3_vfs_find=function(){return(n._sqlite3_vfs_find=n.asm.sqlite3_vfs_find).apply(null,arguments)},n._sqlite3_initialize=function(){return(n._sqlite3_initialize=n.asm.sqlite3_initialize).apply(null,arguments)},n._sqlite3_malloc=function(){return(n._sqlite3_malloc=n.asm.sqlite3_malloc).apply(null,arguments)},n._sqlite3_free=function(){return(n._sqlite3_free=n.asm.sqlite3_free).apply(null,arguments)},n._sqlite3_vfs_register=function(){return(n._sqlite3_vfs_register=n.asm.sqlite3_vfs_register).apply(null,arguments)},n._sqlite3_vfs_unregister=function(){return(n._sqlite3_vfs_unregister=n.asm.sqlite3_vfs_unregister).apply(null,arguments)},n._sqlite3_malloc64=function(){return(n._sqlite3_malloc64=n.asm.sqlite3_malloc64).apply(null,arguments)},n._sqlite3_realloc=function(){return(n._sqlite3_realloc=n.asm.sqlite3_realloc).apply(null,arguments)},n._sqlite3_realloc64=function(){return(n._sqlite3_realloc64=n.asm.sqlite3_realloc64).apply(null,arguments)},n._sqlite3_value_text=function(){return(n._sqlite3_value_text=n.asm.sqlite3_value_text).apply(null,arguments)},n._sqlite3_randomness=function(){return(n._sqlite3_randomness=n.asm.sqlite3_randomness).apply(null,arguments)},n._sqlite3_stricmp=function(){return(n._sqlite3_stricmp=n.asm.sqlite3_stricmp).apply(null,arguments)},n._sqlite3_strnicmp=function(){return(n._sqlite3_strnicmp=n.asm.sqlite3_strnicmp).apply(null,arguments)},n._sqlite3_uri_parameter=function(){return(n._sqlite3_uri_parameter=n.asm.sqlite3_uri_parameter).apply(null,arguments)};var la=n.___errno_location=function(){return(la=n.___errno_location=n.asm.__errno_location).apply(null,arguments)};n._sqlite3_uri_boolean=function(){return(n._sqlite3_uri_boolean=n.asm.sqlite3_uri_boolean).apply(null,arguments)},n._sqlite3_serialize=function(){return(n._sqlite3_serialize=n.asm.sqlite3_serialize).apply(null,arguments)},n._sqlite3_prepare_v2=function(){return(n._sqlite3_prepare_v2=n.asm.sqlite3_prepare_v2).apply(null,arguments)},n._sqlite3_step=function(){return(n._sqlite3_step=n.asm.sqlite3_step).apply(null,arguments)},n._sqlite3_column_int64=function(){return(n._sqlite3_column_int64=n.asm.sqlite3_column_int64).apply(null,arguments)},n._sqlite3_column_int=function(){return(n._sqlite3_column_int=n.asm.sqlite3_column_int).apply(null,arguments)},n._sqlite3_finalize=function(){return(n._sqlite3_finalize=n.asm.sqlite3_finalize).apply(null,arguments)},n._sqlite3_file_control=function(){return(n._sqlite3_file_control=n.asm.sqlite3_file_control).apply(null,arguments)},n._sqlite3_reset=function(){return(n._sqlite3_reset=n.asm.sqlite3_reset).apply(null,arguments)},n._sqlite3_deserialize=function(){return(n._sqlite3_deserialize=n.asm.sqlite3_deserialize).apply(null,arguments)},n._sqlite3_clear_bindings=function(){return(n._sqlite3_clear_bindings=n.asm.sqlite3_clear_bindings).apply(null,arguments)},n._sqlite3_value_blob=function(){return(n._sqlite3_value_blob=n.asm.sqlite3_value_blob).apply(null,arguments)},n._sqlite3_value_bytes=function(){return(n._sqlite3_value_bytes=n.asm.sqlite3_value_bytes).apply(null,arguments)},n._sqlite3_value_double=function(){return(n._sqlite3_value_double=n.asm.sqlite3_value_double).apply(null,arguments)},n._sqlite3_value_int=function(){return(n._sqlite3_value_int=n.asm.sqlite3_value_int).apply(null,arguments)},n._sqlite3_value_int64=function(){return(n._sqlite3_value_int64=n.asm.sqlite3_value_int64).apply(null,arguments)},n._sqlite3_value_subtype=function(){return(n._sqlite3_value_subtype=n.asm.sqlite3_value_subtype).apply(null,arguments)},n._sqlite3_value_pointer=function(){return(n._sqlite3_value_pointer=n.asm.sqlite3_value_pointer).apply(null,arguments)},n._sqlite3_value_type=function(){return(n._sqlite3_value_type=n.asm.sqlite3_value_type).apply(null,arguments)},n._sqlite3_value_nochange=function(){return(n._sqlite3_value_nochange=n.asm.sqlite3_value_nochange).apply(null,arguments)},n._sqlite3_value_frombind=function(){return(n._sqlite3_value_frombind=n.asm.sqlite3_value_frombind).apply(null,arguments)},n._sqlite3_value_dup=function(){return(n._sqlite3_value_dup=n.asm.sqlite3_value_dup).apply(null,arguments)},n._sqlite3_value_free=function(){return(n._sqlite3_value_free=n.asm.sqlite3_value_free).apply(null,arguments)},n._sqlite3_result_blob=function(){return(n._sqlite3_result_blob=n.asm.sqlite3_result_blob).apply(null,arguments)},n._sqlite3_result_error_nomem=function(){return(n._sqlite3_result_error_nomem=n.asm.sqlite3_result_error_nomem).apply(null,arguments)},n._sqlite3_result_error_toobig=function(){return(n._sqlite3_result_error_toobig=n.asm.sqlite3_result_error_toobig).apply(null,arguments)},n._sqlite3_result_double=function(){return(n._sqlite3_result_double=n.asm.sqlite3_result_double).apply(null,arguments)},n._sqlite3_result_error=function(){return(n._sqlite3_result_error=n.asm.sqlite3_result_error).apply(null,arguments)},n._sqlite3_result_int=function(){return(n._sqlite3_result_int=n.asm.sqlite3_result_int).apply(null,arguments)},n._sqlite3_result_int64=function(){return(n._sqlite3_result_int64=n.asm.sqlite3_result_int64).apply(null,arguments)},n._sqlite3_result_null=function(){return(n._sqlite3_result_null=n.asm.sqlite3_result_null).apply(null,arguments)},n._sqlite3_result_pointer=function(){return(n._sqlite3_result_pointer=n.asm.sqlite3_result_pointer).apply(null,arguments)},n._sqlite3_result_subtype=function(){return(n._sqlite3_result_subtype=n.asm.sqlite3_result_subtype).apply(null,arguments)},n._sqlite3_result_text=function(){return(n._sqlite3_result_text=n.asm.sqlite3_result_text).apply(null,arguments)},n._sqlite3_result_zeroblob=function(){return(n._sqlite3_result_zeroblob=n.asm.sqlite3_result_zeroblob).apply(null,arguments)},n._sqlite3_result_zeroblob64=function(){return(n._sqlite3_result_zeroblob64=n.asm.sqlite3_result_zeroblob64).apply(null,arguments)},n._sqlite3_result_error_code=function(){return(n._sqlite3_result_error_code=n.asm.sqlite3_result_error_code).apply(null,arguments)},n._sqlite3_user_data=function(){return(n._sqlite3_user_data=n.asm.sqlite3_user_data).apply(null,arguments)},n._sqlite3_context_db_handle=function(){return(n._sqlite3_context_db_handle=n.asm.sqlite3_context_db_handle).apply(null,arguments)},n._sqlite3_vtab_nochange=function(){return(n._sqlite3_vtab_nochange=n.asm.sqlite3_vtab_nochange).apply(null,arguments)},n._sqlite3_vtab_in_first=function(){return(n._sqlite3_vtab_in_first=n.asm.sqlite3_vtab_in_first).apply(null,arguments)},n._sqlite3_vtab_in_next=function(){return(n._sqlite3_vtab_in_next=n.asm.sqlite3_vtab_in_next).apply(null,arguments)},n._sqlite3_aggregate_context=function(){return(n._sqlite3_aggregate_context=n.asm.sqlite3_aggregate_context).apply(null,arguments)},n._sqlite3_get_auxdata=function(){return(n._sqlite3_get_auxdata=n.asm.sqlite3_get_auxdata).apply(null,arguments)},n._sqlite3_set_auxdata=function(){return(n._sqlite3_set_auxdata=n.asm.sqlite3_set_auxdata).apply(null,arguments)},n._sqlite3_column_count=function(){return(n._sqlite3_column_count=n.asm.sqlite3_column_count).apply(null,arguments)},n._sqlite3_data_count=function(){return(n._sqlite3_data_count=n.asm.sqlite3_data_count).apply(null,arguments)},n._sqlite3_column_blob=function(){return(n._sqlite3_column_blob=n.asm.sqlite3_column_blob).apply(null,arguments)},n._sqlite3_column_bytes=function(){return(n._sqlite3_column_bytes=n.asm.sqlite3_column_bytes).apply(null,arguments)},n._sqlite3_column_double=function(){return(n._sqlite3_column_double=n.asm.sqlite3_column_double).apply(null,arguments)},n._sqlite3_column_text=function(){return(n._sqlite3_column_text=n.asm.sqlite3_column_text).apply(null,arguments)},n._sqlite3_column_value=function(){return(n._sqlite3_column_value=n.asm.sqlite3_column_value).apply(null,arguments)},n._sqlite3_column_type=function(){return(n._sqlite3_column_type=n.asm.sqlite3_column_type).apply(null,arguments)},n._sqlite3_column_name=function(){return(n._sqlite3_column_name=n.asm.sqlite3_column_name).apply(null,arguments)},n._sqlite3_bind_blob=function(){return(n._sqlite3_bind_blob=n.asm.sqlite3_bind_blob).apply(null,arguments)},n._sqlite3_bind_double=function(){return(n._sqlite3_bind_double=n.asm.sqlite3_bind_double).apply(null,arguments)},n._sqlite3_bind_int=function(){return(n._sqlite3_bind_int=n.asm.sqlite3_bind_int).apply(null,arguments)},n._sqlite3_bind_int64=function(){return(n._sqlite3_bind_int64=n.asm.sqlite3_bind_int64).apply(null,arguments)},n._sqlite3_bind_null=function(){return(n._sqlite3_bind_null=n.asm.sqlite3_bind_null).apply(null,arguments)},n._sqlite3_bind_pointer=function(){return(n._sqlite3_bind_pointer=n.asm.sqlite3_bind_pointer).apply(null,arguments)},n._sqlite3_bind_text=function(){return(n._sqlite3_bind_text=n.asm.sqlite3_bind_text).apply(null,arguments)},n._sqlite3_bind_parameter_count=function(){return(n._sqlite3_bind_parameter_count=n.asm.sqlite3_bind_parameter_count).apply(null,arguments)},n._sqlite3_bind_parameter_index=function(){return(n._sqlite3_bind_parameter_index=n.asm.sqlite3_bind_parameter_index).apply(null,arguments)},n._sqlite3_db_handle=function(){return(n._sqlite3_db_handle=n.asm.sqlite3_db_handle).apply(null,arguments)},n._sqlite3_stmt_readonly=function(){return(n._sqlite3_stmt_readonly=n.asm.sqlite3_stmt_readonly).apply(null,arguments)},n._sqlite3_stmt_isexplain=function(){return(n._sqlite3_stmt_isexplain=n.asm.sqlite3_stmt_isexplain).apply(null,arguments)},n._sqlite3_stmt_status=function(){return(n._sqlite3_stmt_status=n.asm.sqlite3_stmt_status).apply(null,arguments)},n._sqlite3_sql=function(){return(n._sqlite3_sql=n.asm.sqlite3_sql).apply(null,arguments)},n._sqlite3_expanded_sql=function(){return(n._sqlite3_expanded_sql=n.asm.sqlite3_expanded_sql).apply(null,arguments)},n._sqlite3_preupdate_old=function(){return(n._sqlite3_preupdate_old=n.asm.sqlite3_preupdate_old).apply(null,arguments)},n._sqlite3_preupdate_count=function(){return(n._sqlite3_preupdate_count=n.asm.sqlite3_preupdate_count).apply(null,arguments)},n._sqlite3_preupdate_depth=function(){return(n._sqlite3_preupdate_depth=n.asm.sqlite3_preupdate_depth).apply(null,arguments)},n._sqlite3_preupdate_blobwrite=function(){return(n._sqlite3_preupdate_blobwrite=n.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},n._sqlite3_preupdate_new=function(){return(n._sqlite3_preupdate_new=n.asm.sqlite3_preupdate_new).apply(null,arguments)},n._sqlite3_value_numeric_type=function(){return(n._sqlite3_value_numeric_type=n.asm.sqlite3_value_numeric_type).apply(null,arguments)},n._sqlite3_errmsg=function(){return(n._sqlite3_errmsg=n.asm.sqlite3_errmsg).apply(null,arguments)},n._sqlite3_set_authorizer=function(){return(n._sqlite3_set_authorizer=n.asm.sqlite3_set_authorizer).apply(null,arguments)},n._sqlite3_strglob=function(){return(n._sqlite3_strglob=n.asm.sqlite3_strglob).apply(null,arguments)},n._sqlite3_strlike=function(){return(n._sqlite3_strlike=n.asm.sqlite3_strlike).apply(null,arguments)},n._sqlite3_exec=function(){return(n._sqlite3_exec=n.asm.sqlite3_exec).apply(null,arguments)},n._sqlite3_auto_extension=function(){return(n._sqlite3_auto_extension=n.asm.sqlite3_auto_extension).apply(null,arguments)},n._sqlite3_cancel_auto_extension=function(){return(n._sqlite3_cancel_auto_extension=n.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},n._sqlite3_reset_auto_extension=function(){return(n._sqlite3_reset_auto_extension=n.asm.sqlite3_reset_auto_extension).apply(null,arguments)},n._sqlite3_prepare_v3=function(){return(n._sqlite3_prepare_v3=n.asm.sqlite3_prepare_v3).apply(null,arguments)},n._sqlite3_create_module=function(){return(n._sqlite3_create_module=n.asm.sqlite3_create_module).apply(null,arguments)},n._sqlite3_create_module_v2=function(){return(n._sqlite3_create_module_v2=n.asm.sqlite3_create_module_v2).apply(null,arguments)},n._sqlite3_drop_modules=function(){return(n._sqlite3_drop_modules=n.asm.sqlite3_drop_modules).apply(null,arguments)},n._sqlite3_declare_vtab=function(){return(n._sqlite3_declare_vtab=n.asm.sqlite3_declare_vtab).apply(null,arguments)},n._sqlite3_vtab_on_conflict=function(){return(n._sqlite3_vtab_on_conflict=n.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},n._sqlite3_vtab_collation=function(){return(n._sqlite3_vtab_collation=n.asm.sqlite3_vtab_collation).apply(null,arguments)},n._sqlite3_vtab_in=function(){return(n._sqlite3_vtab_in=n.asm.sqlite3_vtab_in).apply(null,arguments)},n._sqlite3_vtab_rhs_value=function(){return(n._sqlite3_vtab_rhs_value=n.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},n._sqlite3_vtab_distinct=function(){return(n._sqlite3_vtab_distinct=n.asm.sqlite3_vtab_distinct).apply(null,arguments)},n._sqlite3_keyword_name=function(){return(n._sqlite3_keyword_name=n.asm.sqlite3_keyword_name).apply(null,arguments)},n._sqlite3_keyword_count=function(){return(n._sqlite3_keyword_count=n.asm.sqlite3_keyword_count).apply(null,arguments)},n._sqlite3_keyword_check=function(){return(n._sqlite3_keyword_check=n.asm.sqlite3_keyword_check).apply(null,arguments)},n._sqlite3_complete=function(){return(n._sqlite3_complete=n.asm.sqlite3_complete).apply(null,arguments)},n._sqlite3_libversion=function(){return(n._sqlite3_libversion=n.asm.sqlite3_libversion).apply(null,arguments)},n._sqlite3_libversion_number=function(){return(n._sqlite3_libversion_number=n.asm.sqlite3_libversion_number).apply(null,arguments)},n._sqlite3_shutdown=function(){return(n._sqlite3_shutdown=n.asm.sqlite3_shutdown).apply(null,arguments)},n._sqlite3_last_insert_rowid=function(){return(n._sqlite3_last_insert_rowid=n.asm.sqlite3_last_insert_rowid).apply(null,arguments)},n._sqlite3_set_last_insert_rowid=function(){return(n._sqlite3_set_last_insert_rowid=n.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},n._sqlite3_changes64=function(){return(n._sqlite3_changes64=n.asm.sqlite3_changes64).apply(null,arguments)},n._sqlite3_changes=function(){return(n._sqlite3_changes=n.asm.sqlite3_changes).apply(null,arguments)},n._sqlite3_total_changes64=function(){return(n._sqlite3_total_changes64=n.asm.sqlite3_total_changes64).apply(null,arguments)},n._sqlite3_total_changes=function(){return(n._sqlite3_total_changes=n.asm.sqlite3_total_changes).apply(null,arguments)},n._sqlite3_txn_state=function(){return(n._sqlite3_txn_state=n.asm.sqlite3_txn_state).apply(null,arguments)},n._sqlite3_close_v2=function(){return(n._sqlite3_close_v2=n.asm.sqlite3_close_v2).apply(null,arguments)},n._sqlite3_busy_handler=function(){return(n._sqlite3_busy_handler=n.asm.sqlite3_busy_handler).apply(null,arguments)},n._sqlite3_progress_handler=function(){return(n._sqlite3_progress_handler=n.asm.sqlite3_progress_handler).apply(null,arguments)},n._sqlite3_busy_timeout=function(){return(n._sqlite3_busy_timeout=n.asm.sqlite3_busy_timeout).apply(null,arguments)},n._sqlite3_create_function=function(){return(n._sqlite3_create_function=n.asm.sqlite3_create_function).apply(null,arguments)},n._sqlite3_create_function_v2=function(){return(n._sqlite3_create_function_v2=n.asm.sqlite3_create_function_v2).apply(null,arguments)},n._sqlite3_create_window_function=function(){return(n._sqlite3_create_window_function=n.asm.sqlite3_create_window_function).apply(null,arguments)},n._sqlite3_overload_function=function(){return(n._sqlite3_overload_function=n.asm.sqlite3_overload_function).apply(null,arguments)},n._sqlite3_trace_v2=function(){return(n._sqlite3_trace_v2=n.asm.sqlite3_trace_v2).apply(null,arguments)},n._sqlite3_commit_hook=function(){return(n._sqlite3_commit_hook=n.asm.sqlite3_commit_hook).apply(null,arguments)},n._sqlite3_update_hook=function(){return(n._sqlite3_update_hook=n.asm.sqlite3_update_hook).apply(null,arguments)},n._sqlite3_rollback_hook=function(){return(n._sqlite3_rollback_hook=n.asm.sqlite3_rollback_hook).apply(null,arguments)},n._sqlite3_preupdate_hook=function(){return(n._sqlite3_preupdate_hook=n.asm.sqlite3_preupdate_hook).apply(null,arguments)},n._sqlite3_error_offset=function(){return(n._sqlite3_error_offset=n.asm.sqlite3_error_offset).apply(null,arguments)},n._sqlite3_errcode=function(){return(n._sqlite3_errcode=n.asm.sqlite3_errcode).apply(null,arguments)},n._sqlite3_extended_errcode=function(){return(n._sqlite3_extended_errcode=n.asm.sqlite3_extended_errcode).apply(null,arguments)},n._sqlite3_errstr=function(){return(n._sqlite3_errstr=n.asm.sqlite3_errstr).apply(null,arguments)},n._sqlite3_limit=function(){return(n._sqlite3_limit=n.asm.sqlite3_limit).apply(null,arguments)},n._sqlite3_open=function(){return(n._sqlite3_open=n.asm.sqlite3_open).apply(null,arguments)},n._sqlite3_open_v2=function(){return(n._sqlite3_open_v2=n.asm.sqlite3_open_v2).apply(null,arguments)},n._sqlite3_create_collation=function(){return(n._sqlite3_create_collation=n.asm.sqlite3_create_collation).apply(null,arguments)},n._sqlite3_create_collation_v2=function(){return(n._sqlite3_create_collation_v2=n.asm.sqlite3_create_collation_v2).apply(null,arguments)},n._sqlite3_collation_needed=function(){return(n._sqlite3_collation_needed=n.asm.sqlite3_collation_needed).apply(null,arguments)},n._sqlite3_table_column_metadata=function(){return(n._sqlite3_table_column_metadata=n.asm.sqlite3_table_column_metadata).apply(null,arguments)},n._sqlite3_extended_result_codes=function(){return(n._sqlite3_extended_result_codes=n.asm.sqlite3_extended_result_codes).apply(null,arguments)},n._sqlite3_uri_key=function(){return(n._sqlite3_uri_key=n.asm.sqlite3_uri_key).apply(null,arguments)},n._sqlite3_uri_int64=function(){return(n._sqlite3_uri_int64=n.asm.sqlite3_uri_int64).apply(null,arguments)},n._sqlite3_db_name=function(){return(n._sqlite3_db_name=n.asm.sqlite3_db_name).apply(null,arguments)},n._sqlite3_db_filename=function(){return(n._sqlite3_db_filename=n.asm.sqlite3_db_filename).apply(null,arguments)},n._sqlite3_compileoption_used=function(){return(n._sqlite3_compileoption_used=n.asm.sqlite3_compileoption_used).apply(null,arguments)},n._sqlite3_compileoption_get=function(){return(n._sqlite3_compileoption_get=n.asm.sqlite3_compileoption_get).apply(null,arguments)},n._sqlite3session_diff=function(){return(n._sqlite3session_diff=n.asm.sqlite3session_diff).apply(null,arguments)},n._sqlite3session_attach=function(){return(n._sqlite3session_attach=n.asm.sqlite3session_attach).apply(null,arguments)},n._sqlite3session_create=function(){return(n._sqlite3session_create=n.asm.sqlite3session_create).apply(null,arguments)},n._sqlite3session_delete=function(){return(n._sqlite3session_delete=n.asm.sqlite3session_delete).apply(null,arguments)},n._sqlite3session_table_filter=function(){return(n._sqlite3session_table_filter=n.asm.sqlite3session_table_filter).apply(null,arguments)},n._sqlite3session_changeset=function(){return(n._sqlite3session_changeset=n.asm.sqlite3session_changeset).apply(null,arguments)},n._sqlite3session_changeset_strm=function(){return(n._sqlite3session_changeset_strm=n.asm.sqlite3session_changeset_strm).apply(null,arguments)},n._sqlite3session_patchset_strm=function(){return(n._sqlite3session_patchset_strm=n.asm.sqlite3session_patchset_strm).apply(null,arguments)},n._sqlite3session_patchset=function(){return(n._sqlite3session_patchset=n.asm.sqlite3session_patchset).apply(null,arguments)},n._sqlite3session_enable=function(){return(n._sqlite3session_enable=n.asm.sqlite3session_enable).apply(null,arguments)},n._sqlite3session_indirect=function(){return(n._sqlite3session_indirect=n.asm.sqlite3session_indirect).apply(null,arguments)},n._sqlite3session_isempty=function(){return(n._sqlite3session_isempty=n.asm.sqlite3session_isempty).apply(null,arguments)},n._sqlite3session_memory_used=function(){return(n._sqlite3session_memory_used=n.asm.sqlite3session_memory_used).apply(null,arguments)},n._sqlite3session_object_config=function(){return(n._sqlite3session_object_config=n.asm.sqlite3session_object_config).apply(null,arguments)},n._sqlite3session_changeset_size=function(){return(n._sqlite3session_changeset_size=n.asm.sqlite3session_changeset_size).apply(null,arguments)},n._sqlite3changeset_start=function(){return(n._sqlite3changeset_start=n.asm.sqlite3changeset_start).apply(null,arguments)},n._sqlite3changeset_start_v2=function(){return(n._sqlite3changeset_start_v2=n.asm.sqlite3changeset_start_v2).apply(null,arguments)},n._sqlite3changeset_start_strm=function(){return(n._sqlite3changeset_start_strm=n.asm.sqlite3changeset_start_strm).apply(null,arguments)},n._sqlite3changeset_start_v2_strm=function(){return(n._sqlite3changeset_start_v2_strm=n.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},n._sqlite3changeset_next=function(){return(n._sqlite3changeset_next=n.asm.sqlite3changeset_next).apply(null,arguments)},n._sqlite3changeset_op=function(){return(n._sqlite3changeset_op=n.asm.sqlite3changeset_op).apply(null,arguments)},n._sqlite3changeset_pk=function(){return(n._sqlite3changeset_pk=n.asm.sqlite3changeset_pk).apply(null,arguments)},n._sqlite3changeset_old=function(){return(n._sqlite3changeset_old=n.asm.sqlite3changeset_old).apply(null,arguments)},n._sqlite3changeset_new=function(){return(n._sqlite3changeset_new=n.asm.sqlite3changeset_new).apply(null,arguments)},n._sqlite3changeset_conflict=function(){return(n._sqlite3changeset_conflict=n.asm.sqlite3changeset_conflict).apply(null,arguments)},n._sqlite3changeset_fk_conflicts=function(){return(n._sqlite3changeset_fk_conflicts=n.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},n._sqlite3changeset_finalize=function(){return(n._sqlite3changeset_finalize=n.asm.sqlite3changeset_finalize).apply(null,arguments)},n._sqlite3changeset_invert=function(){return(n._sqlite3changeset_invert=n.asm.sqlite3changeset_invert).apply(null,arguments)},n._sqlite3changeset_invert_strm=function(){return(n._sqlite3changeset_invert_strm=n.asm.sqlite3changeset_invert_strm).apply(null,arguments)},n._sqlite3changeset_apply_v2=function(){return(n._sqlite3changeset_apply_v2=n.asm.sqlite3changeset_apply_v2).apply(null,arguments)},n._sqlite3changeset_apply=function(){return(n._sqlite3changeset_apply=n.asm.sqlite3changeset_apply).apply(null,arguments)},n._sqlite3changeset_apply_v2_strm=function(){return(n._sqlite3changeset_apply_v2_strm=n.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},n._sqlite3changeset_apply_strm=function(){return(n._sqlite3changeset_apply_strm=n.asm.sqlite3changeset_apply_strm).apply(null,arguments)},n._sqlite3changegroup_new=function(){return(n._sqlite3changegroup_new=n.asm.sqlite3changegroup_new).apply(null,arguments)},n._sqlite3changegroup_add=function(){return(n._sqlite3changegroup_add=n.asm.sqlite3changegroup_add).apply(null,arguments)},n._sqlite3changegroup_output=function(){return(n._sqlite3changegroup_output=n.asm.sqlite3changegroup_output).apply(null,arguments)},n._sqlite3changegroup_add_strm=function(){return(n._sqlite3changegroup_add_strm=n.asm.sqlite3changegroup_add_strm).apply(null,arguments)},n._sqlite3changegroup_output_strm=function(){return(n._sqlite3changegroup_output_strm=n.asm.sqlite3changegroup_output_strm).apply(null,arguments)},n._sqlite3changegroup_delete=function(){return(n._sqlite3changegroup_delete=n.asm.sqlite3changegroup_delete).apply(null,arguments)},n._sqlite3changeset_concat=function(){return(n._sqlite3changeset_concat=n.asm.sqlite3changeset_concat).apply(null,arguments)},n._sqlite3changeset_concat_strm=function(){return(n._sqlite3changeset_concat_strm=n.asm.sqlite3changeset_concat_strm).apply(null,arguments)},n._sqlite3session_config=function(){return(n._sqlite3session_config=n.asm.sqlite3session_config).apply(null,arguments)},n._sqlite3_sourceid=function(){return(n._sqlite3_sourceid=n.asm.sqlite3_sourceid).apply(null,arguments)},n._sqlite3_wasm_pstack_ptr=function(){return(n._sqlite3_wasm_pstack_ptr=n.asm.sqlite3_wasm_pstack_ptr).apply(null,arguments)},n._sqlite3_wasm_pstack_restore=function(){return(n._sqlite3_wasm_pstack_restore=n.asm.sqlite3_wasm_pstack_restore).apply(null,arguments)},n._sqlite3_wasm_pstack_alloc=function(){return(n._sqlite3_wasm_pstack_alloc=n.asm.sqlite3_wasm_pstack_alloc).apply(null,arguments)},n._sqlite3_wasm_pstack_remaining=function(){return(n._sqlite3_wasm_pstack_remaining=n.asm.sqlite3_wasm_pstack_remaining).apply(null,arguments)},n._sqlite3_wasm_pstack_quota=function(){return(n._sqlite3_wasm_pstack_quota=n.asm.sqlite3_wasm_pstack_quota).apply(null,arguments)},n._sqlite3_wasm_db_error=function(){return(n._sqlite3_wasm_db_error=n.asm.sqlite3_wasm_db_error).apply(null,arguments)},n._sqlite3_wasm_test_struct=function(){return(n._sqlite3_wasm_test_struct=n.asm.sqlite3_wasm_test_struct).apply(null,arguments)},n._sqlite3_wasm_enum_json=function(){return(n._sqlite3_wasm_enum_json=n.asm.sqlite3_wasm_enum_json).apply(null,arguments)},n._sqlite3_wasm_vfs_unlink=function(){return(n._sqlite3_wasm_vfs_unlink=n.asm.sqlite3_wasm_vfs_unlink).apply(null,arguments)},n._sqlite3_wasm_db_vfs=function(){return(n._sqlite3_wasm_db_vfs=n.asm.sqlite3_wasm_db_vfs).apply(null,arguments)},n._sqlite3_wasm_db_reset=function(){return(n._sqlite3_wasm_db_reset=n.asm.sqlite3_wasm_db_reset).apply(null,arguments)},n._sqlite3_wasm_db_export_chunked=function(){return(n._sqlite3_wasm_db_export_chunked=n.asm.sqlite3_wasm_db_export_chunked).apply(null,arguments)},n._sqlite3_wasm_db_serialize=function(){return(n._sqlite3_wasm_db_serialize=n.asm.sqlite3_wasm_db_serialize).apply(null,arguments)},n._sqlite3_wasm_vfs_create_file=function(){return(n._sqlite3_wasm_vfs_create_file=n.asm.sqlite3_wasm_vfs_create_file).apply(null,arguments)},n._sqlite3_wasm_posix_create_file=function(){return(n._sqlite3_wasm_posix_create_file=n.asm.sqlite3_wasm_posix_create_file).apply(null,arguments)},n._sqlite3_wasm_kvvfsMakeKeyOnPstack=function(){return(n._sqlite3_wasm_kvvfsMakeKeyOnPstack=n.asm.sqlite3_wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},n._sqlite3_wasm_kvvfs_methods=function(){return(n._sqlite3_wasm_kvvfs_methods=n.asm.sqlite3_wasm_kvvfs_methods).apply(null,arguments)},n._sqlite3_wasm_vtab_config=function(){return(n._sqlite3_wasm_vtab_config=n.asm.sqlite3_wasm_vtab_config).apply(null,arguments)},n._sqlite3_wasm_db_config_ip=function(){return(n._sqlite3_wasm_db_config_ip=n.asm.sqlite3_wasm_db_config_ip).apply(null,arguments)},n._sqlite3_wasm_db_config_pii=function(){return(n._sqlite3_wasm_db_config_pii=n.asm.sqlite3_wasm_db_config_pii).apply(null,arguments)},n._sqlite3_wasm_db_config_s=function(){return(n._sqlite3_wasm_db_config_s=n.asm.sqlite3_wasm_db_config_s).apply(null,arguments)},n._sqlite3_wasm_config_i=function(){return(n._sqlite3_wasm_config_i=n.asm.sqlite3_wasm_config_i).apply(null,arguments)},n._sqlite3_wasm_config_ii=function(){return(n._sqlite3_wasm_config_ii=n.asm.sqlite3_wasm_config_ii).apply(null,arguments)},n._sqlite3_wasm_config_j=function(){return(n._sqlite3_wasm_config_j=n.asm.sqlite3_wasm_config_j).apply(null,arguments)},n._sqlite3_wasm_init_wasmfs=function(){return(n._sqlite3_wasm_init_wasmfs=n.asm.sqlite3_wasm_init_wasmfs).apply(null,arguments)},n._sqlite3_wasm_test_intptr=function(){return(n._sqlite3_wasm_test_intptr=n.asm.sqlite3_wasm_test_intptr).apply(null,arguments)},n._sqlite3_wasm_test_voidptr=function(){return(n._sqlite3_wasm_test_voidptr=n.asm.sqlite3_wasm_test_voidptr).apply(null,arguments)},n._sqlite3_wasm_test_int64_max=function(){return(n._sqlite3_wasm_test_int64_max=n.asm.sqlite3_wasm_test_int64_max).apply(null,arguments)},n._sqlite3_wasm_test_int64_min=function(){return(n._sqlite3_wasm_test_int64_min=n.asm.sqlite3_wasm_test_int64_min).apply(null,arguments)},n._sqlite3_wasm_test_int64_times2=function(){return(n._sqlite3_wasm_test_int64_times2=n.asm.sqlite3_wasm_test_int64_times2).apply(null,arguments)},n._sqlite3_wasm_test_int64_minmax=function(){return(n._sqlite3_wasm_test_int64_minmax=n.asm.sqlite3_wasm_test_int64_minmax).apply(null,arguments)},n._sqlite3_wasm_test_int64ptr=function(){return(n._sqlite3_wasm_test_int64ptr=n.asm.sqlite3_wasm_test_int64ptr).apply(null,arguments)},n._sqlite3_wasm_test_stack_overflow=function(){return(n._sqlite3_wasm_test_stack_overflow=n.asm.sqlite3_wasm_test_stack_overflow).apply(null,arguments)},n._sqlite3_wasm_test_str_hello=function(){return(n._sqlite3_wasm_test_str_hello=n.asm.sqlite3_wasm_test_str_hello).apply(null,arguments)};var ca=n._malloc=function(){return(ca=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n._realloc=function(){return(n._realloc=n.asm.realloc).apply(null,arguments)};var ua=n._emscripten_builtin_memalign=function(){return(ua=n._emscripten_builtin_memalign=n.asm.emscripten_builtin_memalign).apply(null,arguments)};n.stackSave=function(){return(n.stackSave=n.asm.stackSave).apply(null,arguments)},n.stackRestore=function(){return(n.stackRestore=n.asm.stackRestore).apply(null,arguments)},n.stackAlloc=function(){return(n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)},n.wasmMemory=$t;var Li;Vr=function o(){Li||da(),Li||(Vr=o)};function da(o){if(Bn>0||(Ql(),Bn>0))return;function i(){Li||(Li=!0,n.calledRun=!0,!Ti&&(Ul(),A(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),jl()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),i()},1)):i()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return da(),n.postRun||(n.postRun=[]),n.postRun.push(function(o){if(globalThis.sqlite3ApiBootstrap=function i(l=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return console.warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const a=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:typeof o<"u"?!!o.HEAPU64:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},l||{});Object.assign(a,{allocExportName:a.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:a.useStdAlloc?"free":"sqlite3_free",reallocExportName:a.useStdAlloc?"realloc":"sqlite3_realloc"},a),["exports","memory","wasmfsOpfsDir"].forEach(h=>{typeof a[h]=="function"&&(a[h]=a[h]())});const c=Object.create(null),d=Object.create(null),w=h=>c.sqlite3_js_rc_str&&c.sqlite3_js_rc_str(h)||"Unknown result code #"+h,k=h=>typeof h=="number"&&h===(h|0);class L extends Error{constructor(...f){let q;if(f.length)if(k(f[0]))if(q=f[0],f.length===1)super(w(f[0]));else{const P=w(q);typeof f[1]=="object"?super(P,f[1]):(f[0]=P+":",super(f.join(" ")))}else f.length===2&&typeof f[1]=="object"?super(...f):super(f.join(" "));this.resultCode=q||c.SQLITE_ERROR,this.name="SQLite3Error"}}L.toss=(...h)=>{throw new L(...h)};const J=L.toss;a.wasmfsOpfsDir&&!/^\/[^/]+$/.test(a.wasmfsOpfsDir)&&J("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const ee=h=>typeof h!="bigint"&&h===(h|0)&&h<=2147483647&&h>=-2147483648,se=function h(f){return h._max||(h._max=BigInt("0x7fffffffffffffff"),h._min=~h._max),f>=h._min&&f<=h._max},T=h=>h>=-0x7fffffffn-1n&&h<=0x7fffffffn,g=function h(f){return h._min||(h._min=Number.MIN_SAFE_INTEGER,h._max=Number.MAX_SAFE_INTEGER),f>=h._min&&f<=h._max},y=h=>h&&h.constructor&&ee(h.constructor.BYTES_PER_ELEMENT)?h:!1,v=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,S=h=>h.buffer instanceof v,b=(h,f,q)=>S(h)?h.slice(f,q):h.subarray(f,q),Q=h=>h&&(h instanceof Uint8Array||h instanceof Int8Array||h instanceof ArrayBuffer),V=h=>h&&(h instanceof Uint8Array||h instanceof Int8Array||h instanceof ArrayBuffer),D=h=>Q(h)||J("Value is not of a supported TypedArray type."),K=new TextDecoder("utf-8"),le=function(h,f,q){return K.decode(b(h,f,q))},_=function(h){return V(h)?le(h instanceof ArrayBuffer?new Uint8Array(h):h):Array.isArray(h)?h.join(""):(d.isPtr(h)&&(h=d.cstrToJs(h)),h)};class E extends Error{constructor(...f){f.length===2&&typeof f[1]=="object"?super(...f):f.length?super(f.join(" ")):super("Allocation failed."),this.resultCode=c.SQLITE_NOMEM,this.name="WasmAllocError"}}E.toss=(...h)=>{throw new E(...h)},Object.assign(c,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(h,f,q,P,X,ie,oe,ce,ae)=>{},sqlite3_create_function:(h,f,q,P,X,ie,oe,ce)=>{},sqlite3_create_window_function:(h,f,q,P,X,ie,oe,ce,ae,ue)=>{},sqlite3_prepare_v3:(h,f,q,P,X,ie)=>{},sqlite3_prepare_v2:(h,f,q,P,X)=>{},sqlite3_exec:(h,f,q,P,X)=>{},sqlite3_randomness:(h,f)=>{}});const I={affirmBindableTypedArray:D,flexibleString:_,bigIntFits32:T,bigIntFits64:se,bigIntFitsDouble:g,isBindableTypedArray:Q,isInt32:ee,isSQLableTypedArray:V,isTypedArray:y,typedArrayToString:le,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:S,toss:function(...h){throw new Error(h.join(" "))},toss3:J,typedArrayPart:b};Object.assign(d,{ptrSizeof:a.wasmPtrSizeof||4,ptrIR:a.wasmPtrIR||"i32",bigIntEnabled:!!a.bigIntEnabled,exports:a.exports||J("Missing API config.exports (WASM module exports)."),memory:a.memory||a.exports.memory||J("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),d.allocFromTypedArray=function(h){h instanceof ArrayBuffer&&(h=new Uint8Array(h)),D(h);const f=d.alloc(h.byteLength||1);return d.heapForSize(h.constructor).set(h.byteLength?h:[0],f),f};{const h=a.allocExportName,f=a.deallocExportName,q=a.reallocExportName;for(const P of[h,f,q])d.exports[P]instanceof Function||J("Missing required exports[",P,"] function.");d.alloc=function P(X){return P.impl(X)||E.toss("Failed to allocate",X," bytes.")},d.alloc.impl=d.exports[h],d.realloc=function P(X,ie){const oe=P.impl(X,ie);return ie?oe||E.toss("Failed to reallocate",ie," bytes."):0},d.realloc.impl=d.exports[q],d.dealloc=d.exports[f]}d.compileOptionUsed=function h(f){if(arguments.length){if(Array.isArray(f)){const q={};return f.forEach(P=>{q[P]=c.sqlite3_compileoption_used(P)}),q}else if(typeof f=="object")return Object.keys(f).forEach(q=>{f[q]=c.sqlite3_compileoption_used(q)}),f}else{if(h._result)return h._result;h._opt||(h._rx=/^([^=]+)=(.+)/,h._rxInt=/^-?\d+$/,h._opt=function(oe,ce){const ae=h._rx.exec(oe);ce[0]=ae?ae[1]:oe,ce[1]=ae?h._rxInt.test(ae[2])?+ae[2]:ae[2]:!0});const q={},P=[0,0];let X=0,ie;for(;ie=c.sqlite3_compileoption_get(X++);)h._opt(ie,P),q[P[0]]=P[1];return h._result=q}return typeof f=="string"?!!c.sqlite3_compileoption_used(f):!1},d.pstack=Object.assign(Object.create(null),{restore:d.exports.sqlite3_wasm_pstack_restore,alloc:function(h){return typeof h=="string"&&!(h=d.sizeofIR(h))&&E.toss("Invalid value for pstack.alloc(",arguments[0],")"),d.exports.sqlite3_wasm_pstack_alloc(h)||E.toss("Could not allocate",h,"bytes from the pstack.")},allocChunks:function(h,f){typeof f=="string"&&!(f=d.sizeofIR(f))&&E.toss("Invalid size value for allocChunks(",arguments[1],")");const q=d.pstack.alloc(h*f),P=[];let X=0,ie=0;for(;X<h;++X,ie+=f)P.push(q+ie);return P},allocPtr:(h=1,f=!0)=>h===1?d.pstack.alloc(f?8:d.ptrSizeof):d.pstack.allocChunks(h,f?8:d.ptrSizeof)}),Object.defineProperties(d.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_remaining}}),c.sqlite3_randomness=(...h)=>{if(h.length===1&&I.isTypedArray(h[0])&&h[0].BYTES_PER_ELEMENT===1){const f=h[0];if(f.byteLength===0)return d.exports.sqlite3_randomness(0,0),f;const q=d.pstack.pointer;try{let P=f.byteLength,X=0;const ie=d.exports.sqlite3_randomness,oe=d.heap8u(),ce=P<512?P:512,ae=d.pstack.alloc(ce);do{const ue=P>ce?ce:P;ie(ue,ae),f.set(b(oe,ae,ae+ue),X),P-=ue,X+=ue}while(P>0)}catch(P){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",P)}finally{d.pstack.restore(q)}return f}d.exports.sqlite3_randomness(...h)};let z;if(c.sqlite3_wasmfs_opfs_dir=function(){if(z!==void 0)return z;const h=a.wasmfsOpfsDir;if(!h||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return z="";try{return h&&d.xCallWrapped("sqlite3_wasm_init_wasmfs","i32",["string"],h)===0?z=h:z=""}catch{return z=""}},c.sqlite3_wasmfs_filename_is_persistent=function(h){const f=c.sqlite3_wasmfs_opfs_dir();return f&&h?h.startsWith(f+"/"):!1},c.sqlite3_js_db_uses_vfs=function(h,f,q=0){try{const P=c.sqlite3_vfs_find(f);return P?h?P===c.sqlite3_js_db_vfs(h,q)?P:!1:P===c.sqlite3_vfs_find(0)?P:!1:!1}catch{return!1}},c.sqlite3_js_vfs_list=function(){const h=[];let f=c.sqlite3_vfs_find(0);for(;f;){const q=new c.sqlite3_vfs(f);h.push(d.cstrToJs(q.$zName)),f=q.$pNext,q.dispose()}return h},c.sqlite3_js_db_export=function(h,f=0){h=d.xWrap.testConvertArg("sqlite3*",h),h||J("Invalid sqlite3* argument."),d.bigIntEnabled||J("BigInt64 support is not enabled.");const q=d.scopedAllocPush();let P;try{const X=d.scopedAlloc(8+d.ptrSizeof),ie=X+8,oe=f?d.isPtr(f)?f:d.scopedAllocCString(""+f):0;let ce=d.exports.sqlite3_wasm_db_serialize(h,oe,ie,X,0);ce&&J("Database serialization failed with code",N.capi.sqlite3_js_rc_str(ce)),P=d.peekPtr(ie);const ae=d.peek(X,"i64");return ce=ae?d.heap8u().slice(P,P+Number(ae)):new Uint8Array,ce}finally{P&&d.exports.sqlite3_free(P),d.scopedAllocPop(q)}},c.sqlite3_js_db_vfs=(h,f=0)=>d.sqlite3_wasm_db_vfs(h,f),c.sqlite3_js_aggregate_context=(h,f)=>c.sqlite3_aggregate_context(h,f)||(f?E.toss("Cannot allocate",f,"bytes for sqlite3_aggregate_context()"):0),c.sqlite3_js_posix_create_file=function(h,f,q){let P;f&&d.isPtr(f)?P=f:f instanceof ArrayBuffer||f instanceof Uint8Array?(P=d.allocFromTypedArray(f),(arguments.length<3||!I.isInt32(q)||q<0)&&(q=f.byteLength)):L.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!I.isInt32(q)||q<0)&&L.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const X=d.sqlite3_wasm_posix_create_file(h,P,q);X&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(X))}finally{d.dealloc(P)}},c.sqlite3_js_vfs_create_file=function(h,f,q,P){a.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let X;q?(d.isPtr(q)?X=q:q instanceof ArrayBuffer&&(q=new Uint8Array(q)),q instanceof Uint8Array?(X=d.allocFromTypedArray(q),(arguments.length<4||!I.isInt32(P)||P<0)&&(P=q.byteLength)):L.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):X=0,(!I.isInt32(P)||P<0)&&(d.dealloc(X),L.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const ie=d.sqlite3_wasm_vfs_create_file(h,f,X,P);ie&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(ie))}finally{d.dealloc(X)}},I.isUIThread()){const h=function(f){const q=Object.create(null);return q.prefix="kvvfs-"+f,q.stores=[],(f==="session"||f==="")&&q.stores.push(globalThis.sessionStorage),(f==="local"||f==="")&&q.stores.push(globalThis.localStorage),q};c.sqlite3_js_kvvfs_clear=function(f=""){let q=0;const P=h(f);return P.stores.forEach(X=>{const ie=[];let oe;for(oe=0;oe<X.length;++oe){const ce=X.key(oe);ce.startsWith(P.prefix)&&ie.push(ce)}ie.forEach(ce=>X.removeItem(ce)),q+=ie.length}),q},c.sqlite3_js_kvvfs_size=function(f=""){let q=0;const P=h(f);return P.stores.forEach(X=>{let ie;for(ie=0;ie<X.length;++ie){const oe=X.key(ie);oe.startsWith(P.prefix)&&(q+=oe.length,q+=X.getItem(oe).length)}}),q*2}}c.sqlite3_db_config=function(h,f,...q){switch(this.s||(this.s=d.xWrap("sqlite3_wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=d.xWrap("sqlite3_wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=d.xWrap("sqlite3_wasm_db_config_ip","int",["sqlite3*","int","int","*"])),f){case c.SQLITE_DBCONFIG_ENABLE_FKEY:case c.SQLITE_DBCONFIG_ENABLE_TRIGGER:case c.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case c.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case c.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case c.SQLITE_DBCONFIG_ENABLE_QPSG:case c.SQLITE_DBCONFIG_TRIGGER_EQP:case c.SQLITE_DBCONFIG_RESET_DATABASE:case c.SQLITE_DBCONFIG_DEFENSIVE:case c.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case c.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case c.SQLITE_DBCONFIG_DQS_DML:case c.SQLITE_DBCONFIG_DQS_DDL:case c.SQLITE_DBCONFIG_ENABLE_VIEW:case c.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case c.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case c.SQLITE_DBCONFIG_STMT_SCANSTATUS:case c.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(h,f,q[0],q[1]||0);case c.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(h,f,q[0],q[1],q[2]);case c.SQLITE_DBCONFIG_MAINDBNAME:return this.s(h,f,q[0]);default:return c.SQLITE_MISUSE}}.bind(Object.create(null)),c.sqlite3_value_to_js=function(h,f=!0){let q;const P=c.sqlite3_value_type(h);switch(P){case c.SQLITE_INTEGER:d.bigIntEnabled?(q=c.sqlite3_value_int64(h),I.bigIntFitsDouble(q)&&(q=Number(q))):q=c.sqlite3_value_double(h);break;case c.SQLITE_FLOAT:q=c.sqlite3_value_double(h);break;case c.SQLITE_TEXT:q=c.sqlite3_value_text(h);break;case c.SQLITE_BLOB:{const X=c.sqlite3_value_bytes(h),ie=c.sqlite3_value_blob(h);X&&!ie&&N.WasmAllocError.toss("Cannot allocate memory for blob argument of",X,"byte(s)"),q=X?d.heap8u().slice(ie,ie+Number(X)):null;break}case c.SQLITE_NULL:q=null;break;default:f&&J(c.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",P),q=void 0}return q},c.sqlite3_values_to_js=function(h,f,q=!0){let P;const X=[];for(P=0;P<h;++P)X.push(c.sqlite3_value_to_js(d.peekPtr(f+d.ptrSizeof*P),q));return X},c.sqlite3_result_error_js=function(h,f){f instanceof E?c.sqlite3_result_error_nomem(h):c.sqlite3_result_error(h,""+f,-1)},c.sqlite3_result_js=function(h,f){if(f instanceof Error){c.sqlite3_result_error_js(h,f);return}try{switch(typeof f){case"undefined":break;case"boolean":c.sqlite3_result_int(h,f?1:0);break;case"bigint":I.bigIntFits32(f)?c.sqlite3_result_int(h,Number(f)):I.bigIntFitsDouble(f)?c.sqlite3_result_double(h,Number(f)):d.bigIntEnabled?I.bigIntFits64(f)?c.sqlite3_result_int64(h,f):J("BigInt value",f.toString(),"is too BigInt for int64."):J("BigInt value",f.toString(),"is too BigInt.");break;case"number":{let q;I.isInt32(f)?q=c.sqlite3_result_int:d.bigIntEnabled&&Number.isInteger(f)&&I.bigIntFits64(BigInt(f))?q=c.sqlite3_result_int64:q=c.sqlite3_result_double,q(h,f);break}case"string":{const[q,P]=d.allocCString(f,!0);c.sqlite3_result_text(h,q,P,c.SQLITE_WASM_DEALLOC);break}case"object":if(f===null){c.sqlite3_result_null(h);break}else if(I.isBindableTypedArray(f)){const q=d.allocFromTypedArray(f);c.sqlite3_result_blob(h,q,f.byteLength,c.SQLITE_WASM_DEALLOC);break}default:J("Don't not how to handle this UDF result value:",typeof f,f)}}catch(q){c.sqlite3_result_error_js(h,q)}},c.sqlite3_column_js=function(h,f,q=!0){const P=c.sqlite3_column_value(h,f);return P===0?void 0:c.sqlite3_value_to_js(P,q)};const m=function(h,f,q){q=c[q],this.ptr?d.pokePtr(this.ptr,0):this.ptr=d.allocPtr();const P=q(h,f,this.ptr);if(P)return L.toss(P,arguments[2]+"() failed with code "+P);const X=d.peekPtr(this.ptr);return X?c.sqlite3_value_to_js(X,!0):void 0}.bind(Object.create(null));c.sqlite3_preupdate_new_js=(h,f)=>m(h,f,"sqlite3_preupdate_new"),c.sqlite3_preupdate_old_js=(h,f)=>m(h,f,"sqlite3_preupdate_old"),c.sqlite3changeset_new_js=(h,f)=>m(h,f,"sqlite3changeset_new"),c.sqlite3changeset_old_js=(h,f)=>m(h,f,"sqlite3changeset_old");const N={WasmAllocError:E,SQLite3Error:L,capi:c,util:I,wasm:d,config:a,version:Object.create(null),client:void 0,asyncPostInit:async function h(){if(h.isReady instanceof Promise)return h.isReady;let f=i.initializersAsync;delete i.initializersAsync;const q=async()=>(N.__isUnderTest||(delete N.util,delete N.StructBinder),N),P=ie=>{throw a.error("an async sqlite3 initializer failed:",ie),ie};if(!f||!f.length)return h.isReady=q().catch(P);f=f.map(ie=>ie instanceof Function?async oe=>ie(N):ie),f.push(q);let X=Promise.resolve(N);for(;f.length;)X=X.then(f.shift());return h.isReady=X.catch(P)},scriptInfo:void 0};try{i.initializers.forEach(h=>{h(N)})}catch(h){throw console.error("sqlite3 bootstrap initializer threw:",h),h}return delete i.initializers,i.sqlite3=N,N},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(i){i.bigIntEnabled===void 0&&(i.bigIntEnabled=!!globalThis.BigInt64Array);const l=(..._)=>{throw new Error(_.join(" "))};i.exports||Object.defineProperty(i,"exports",{enumerable:!0,configurable:!0,get:()=>i.instance&&i.instance.exports});const a=i.pointerIR||"i32",c=i.ptrSizeof=a==="i32"?4:a==="i64"?8:l("Unhandled ptrSizeof:",a),d=Object.create(null);d.heapSize=0,d.memory=null,d.freeFuncIndexes=[],d.scopedAlloc=[],d.utf8Decoder=new TextDecoder,d.utf8Encoder=new TextEncoder("utf-8"),i.sizeofIR=_=>{switch(_){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return c;default:return(""+_).endsWith("*")?c:void 0}};const w=function(){if(!d.memory)d.memory=i.memory instanceof WebAssembly.Memory?i.memory:i.exports.memory;else if(d.heapSize===d.memory.buffer.byteLength)return d;const _=d.memory.buffer;return d.HEAP8=new Int8Array(_),d.HEAP8U=new Uint8Array(_),d.HEAP16=new Int16Array(_),d.HEAP16U=new Uint16Array(_),d.HEAP32=new Int32Array(_),d.HEAP32U=new Uint32Array(_),i.bigIntEnabled&&(d.HEAP64=new BigInt64Array(_),d.HEAP64U=new BigUint64Array(_)),d.HEAP32F=new Float32Array(_),d.HEAP64F=new Float64Array(_),d.heapSize=_.byteLength,d};i.heap8=()=>w().HEAP8,i.heap8u=()=>w().HEAP8U,i.heap16=()=>w().HEAP16,i.heap16u=()=>w().HEAP16U,i.heap32=()=>w().HEAP32,i.heap32u=()=>w().HEAP32U,i.heapForSize=function(_,E=!0){const I=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:w();switch(_){case Int8Array:return I.HEAP8;case Uint8Array:return I.HEAP8U;case Int16Array:return I.HEAP16;case Uint16Array:return I.HEAP16U;case Int32Array:return I.HEAP32;case Uint32Array:return I.HEAP32U;case 8:return E?I.HEAP8U:I.HEAP8;case 16:return E?I.HEAP16U:I.HEAP16;case 32:return E?I.HEAP32U:I.HEAP32;case 64:if(I.HEAP64)return E?I.HEAP64U:I.HEAP64;break;default:if(i.bigIntEnabled){if(_===globalThis.BigUint64Array)return I.HEAP64U;if(_===globalThis.BigInt64Array)return I.HEAP64;break}}l("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},i.functionTable=function(){return i.exports.__indirect_function_table},i.functionEntry=function(_){const E=i.functionTable();return _<E.length?E.get(_):void 0},i.jsFuncToWasm=function _(E,I){if(_._||(_._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(N,h,f){f<128?N[h](f):N[h](f%128|128,f>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(N){const h=_._.rxJSig.exec(N);return h?h[2]:N.substr(1)},letterType:N=>_._.sigTypes[N]||l("Invalid signature letter:",N),pushSigType:(N,h)=>N.push(_._.typeCodes[_._.letterType(h)])}),typeof E=="string"){const N=I;I=E,E=N}const z=_._.sigParams(I),m=[1,96];_._.uleb128Encode(m,"push",z.length);for(const N of z)_._.pushSigType(m,N);return I[0]==="v"?m.push(0):(m.push(1),_._.pushSigType(m,I[0])),_._.uleb128Encode(m,"unshift",m.length),m.unshift(0,97,115,109,1,0,0,0,1),m.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(m)),{e:{f:E}}).exports.f};const k=function(E,I,z){if(z&&!d.scopedAlloc.length&&l("No scopedAllocPush() scope is active."),typeof E=="string"){const f=I;I=E,E=f}(typeof I!="string"||!(E instanceof Function))&&l("Invalid arguments: expecting (function,signature) or (signature,function).");const m=i.functionTable(),N=m.length;let h;for(;d.freeFuncIndexes.length&&(h=d.freeFuncIndexes.pop(),m.get(h));){h=null;continue}h||(h=N,m.grow(1));try{return m.set(h,E),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(h),h}catch(f){if(!(f instanceof TypeError))throw h===N&&d.freeFuncIndexes.push(N),f}try{const f=i.jsFuncToWasm(E,I);m.set(h,f),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(h)}catch(f){throw h===N&&d.freeFuncIndexes.push(N),f}return h};i.installFunction=(_,E)=>k(_,E,!1),i.scopedInstallFunction=(_,E)=>k(_,E,!0),i.uninstallFunction=function(_){if(!_&&_!==0)return;const E=d.freeFuncIndexes,I=i.functionTable();E.push(_);const z=I.get(_);return I.set(_,null),z},i.peek=function(E,I="i8"){I.endsWith("*")&&(I=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:w(),m=Array.isArray(E)?[]:void 0;let N;do{switch(m&&(E=arguments[0].shift()),I){case"i1":case"i8":N=z.HEAP8[E>>0];break;case"i16":N=z.HEAP16[E>>1];break;case"i32":N=z.HEAP32[E>>2];break;case"float":case"f32":N=z.HEAP32F[E>>2];break;case"double":case"f64":N=Number(z.HEAP64F[E>>3]);break;case"i64":if(i.bigIntEnabled){N=BigInt(z.HEAP64[E>>3]);break}default:l("Invalid type for peek():",I)}m&&m.push(N)}while(m&&arguments[0].length);return m||N},i.poke=function(_,E,I="i8"){I.endsWith("*")&&(I=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:w();for(const m of Array.isArray(_)?_:[_])switch(I){case"i1":case"i8":z.HEAP8[m>>0]=E;continue;case"i16":z.HEAP16[m>>1]=E;continue;case"i32":z.HEAP32[m>>2]=E;continue;case"float":case"f32":z.HEAP32F[m>>2]=E;continue;case"double":case"f64":z.HEAP64F[m>>3]=E;continue;case"i64":if(z.HEAP64){z.HEAP64[m>>3]=BigInt(E);continue}default:l("Invalid type for poke(): "+I)}return this},i.peekPtr=(..._)=>i.peek(_.length===1?_[0]:_,a),i.pokePtr=(_,E=0)=>i.poke(_,E,a),i.peek8=(..._)=>i.peek(_.length===1?_[0]:_,"i8"),i.poke8=(_,E)=>i.poke(_,E,"i8"),i.peek16=(..._)=>i.peek(_.length===1?_[0]:_,"i16"),i.poke16=(_,E)=>i.poke(_,E,"i16"),i.peek32=(..._)=>i.peek(_.length===1?_[0]:_,"i32"),i.poke32=(_,E)=>i.poke(_,E,"i32"),i.peek64=(..._)=>i.peek(_.length===1?_[0]:_,"i64"),i.poke64=(_,E)=>i.poke(_,E,"i64"),i.peek32f=(..._)=>i.peek(_.length===1?_[0]:_,"f32"),i.poke32f=(_,E)=>i.poke(_,E,"f32"),i.peek64f=(..._)=>i.peek(_.length===1?_[0]:_,"f64"),i.poke64f=(_,E)=>i.poke(_,E,"f64"),i.getMemValue=i.peek,i.getPtrValue=i.peekPtr,i.setMemValue=i.poke,i.setPtrValue=i.pokePtr,i.isPtr32=_=>typeof _=="number"&&_===(_|0)&&_>=0,i.isPtr=i.isPtr32,i.cstrlen=function(_){if(!_||!i.isPtr(_))return null;const E=w().HEAP8U;let I=_;for(;E[I]!==0;++I);return I-_};const L=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,J=function(_,E,I){return d.utf8Decoder.decode(_.buffer instanceof L?_.slice(E,I):_.subarray(E,I))};i.cstrToJs=function(_){const E=i.cstrlen(_);return E?J(w().HEAP8U,_,_+E):E===null?E:""},i.jstrlen=function(_){if(typeof _!="string")return null;const E=_.length;let I=0;for(let z=0;z<E;++z){let m=_.charCodeAt(z);m>=55296&&m<=57343&&(m=65536+((m&1023)<<10)|_.charCodeAt(++z)&1023),m<=127?++I:m<=2047?I+=2:m<=65535?I+=3:I+=4}return I},i.jstrcpy=function(_,E,I=0,z=-1,m=!0){if((!E||!(E instanceof Int8Array)&&!(E instanceof Uint8Array))&&l("jstrcpy() target must be an Int8Array or Uint8Array."),z<0&&(z=E.length-I),!(z>0)||!(I>=0))return 0;let N=0,h=_.length;const f=I,q=I+z-(m?1:0);for(;N<h&&I<q;++N){let P=_.charCodeAt(N);if(P>=55296&&P<=57343&&(P=65536+((P&1023)<<10)|_.charCodeAt(++N)&1023),P<=127){if(I>=q)break;E[I++]=P}else if(P<=2047){if(I+1>=q)break;E[I++]=192|P>>6,E[I++]=128|P&63}else if(P<=65535){if(I+2>=q)break;E[I++]=224|P>>12,E[I++]=128|P>>6&63,E[I++]=128|P&63}else{if(I+3>=q)break;E[I++]=240|P>>18,E[I++]=128|P>>12&63,E[I++]=128|P>>6&63,E[I++]=128|P&63}}return m&&(E[I++]=0),I-f},i.cstrncpy=function(_,E,I){if((!_||!E)&&l("cstrncpy() does not accept NULL strings."),I<0)I=i.cstrlen(strPtr)+1;else if(!(I>0))return 0;const z=i.heap8u();let m=0,N;for(;m<I&&(N=z[E+m]);++m)z[_+m]=N;return m<I&&(z[_+m++]=0),m},i.jstrToUintArray=(_,E=!1)=>d.utf8Encoder.encode(E?_+"\0":_);const ee=(_,E)=>{(!(_.alloc instanceof Function)||!(_.dealloc instanceof Function))&&l("Object is missing alloc() and/or dealloc() function(s)","required by",E+"().")},se=function(_,E,I,z){if(ee(i,z),typeof _!="string")return null;{const m=d.utf8Encoder.encode(_),N=I(m.length+1),h=w().HEAP8U;return h.set(m,N),h[N+m.length]=0,E?[N,m.length]:N}};i.allocCString=(_,E=!1)=>se(_,E,i.alloc,"allocCString()"),i.scopedAllocPush=function(){ee(i,"scopedAllocPush");const _=[];return d.scopedAlloc.push(_),_},i.scopedAllocPop=function(_){ee(i,"scopedAllocPop");const E=arguments.length?d.scopedAlloc.indexOf(_):d.scopedAlloc.length-1;E<0&&l("Invalid state object for scopedAllocPop()."),arguments.length===0&&(_=d.scopedAlloc[E]),d.scopedAlloc.splice(E,1);for(let I;I=_.pop();)i.functionEntry(I)?i.uninstallFunction(I):i.dealloc(I)},i.scopedAlloc=function(_){d.scopedAlloc.length||l("No scopedAllocPush() scope is active.");const E=i.alloc(_);return d.scopedAlloc[d.scopedAlloc.length-1].push(E),E},Object.defineProperty(i.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>d.scopedAlloc.length,set:()=>l("The 'active' property is read-only.")}),i.scopedAllocCString=(_,E=!1)=>se(_,E,i.scopedAlloc,"scopedAllocCString()");const T=function(_,E){const I=i[_?"scopedAlloc":"alloc"]((E.length+1)*i.ptrSizeof);let z=0;return E.forEach(m=>{i.pokePtr(I+i.ptrSizeof*z++,i[_?"scopedAllocCString":"allocCString"](""+m))}),i.pokePtr(I+i.ptrSizeof*z,0),I};i.scopedAllocMainArgv=_=>T(!0,_),i.allocMainArgv=_=>T(!1,_),i.cArgvToJs=(_,E)=>{const I=[];for(let z=0;z<_;++z){const m=i.peekPtr(E+i.ptrSizeof*z);I.push(m?i.cstrToJs(m):null)}return I},i.scopedAllocCall=function(_){i.scopedAllocPush();try{return _()}finally{i.scopedAllocPop()}};const g=function(_,E,I){ee(i,I);const z=E?"i64":a;let m=i[I](_*(E?8:c));if(i.poke(m,0,z),_===1)return m;const N=[m];for(let h=1;h<_;++h)m+=E?8:c,N[h]=m,i.poke(m,0,z);return N};i.allocPtr=(_=1,E=!0)=>g(_,E,"alloc"),i.scopedAllocPtr=(_=1,E=!0)=>g(_,E,"scopedAlloc"),i.xGet=function(_){return i.exports[_]||l("Cannot find exported symbol:",_)};const y=(_,E)=>l(_+"() requires",E,"argument(s).");i.xCall=function(_,...E){const I=i.xGet(_);return I instanceof Function||l("Exported symbol",_,"is not a function."),I.length!==E.length&&y(_,I.length),arguments.length===2&&Array.isArray(arguments[1])?I.apply(null,arguments[1]):I.apply(null,E)},d.xWrap=Object.create(null),d.xWrap.convert=Object.create(null),d.xWrap.convert.arg=new Map,d.xWrap.convert.result=new Map;const v=d.xWrap.convert.arg,S=d.xWrap.convert.result;i.bigIntEnabled&&v.set("i64",_=>BigInt(_));const b=a==="i32"?_=>_|0:_=>BigInt(_)|BigInt(0);v.set("i32",b).set("i16",_=>(_|0)&65535).set("i8",_=>(_|0)&255).set("f32",_=>Number(_).valueOf()).set("float",v.get("f32")).set("f64",v.get("f32")).set("double",v.get("f64")).set("int",v.get("i32")).set("null",_=>_).set(null,v.get("null")).set("**",b).set("*",b),S.set("*",b).set("pointer",b).set("number",_=>Number(_)).set("void",_=>{}).set("null",_=>_).set(null,S.get("null"));{const _=["i8","i16","i32","int","f32","float","f64","double"];i.bigIntEnabled&&_.push("i64");const E=v.get(a);for(const I of _)v.set(I+"*",E),S.set(I+"*",E),S.set(I,v.get(I)||l("Missing arg converter:",I))}const Q=function(_){return typeof _=="string"?i.scopedAllocCString(_):_?b(_):null};v.set("string",Q).set("utf8",Q).set("pointer",Q),S.set("string",_=>i.cstrToJs(_)).set("utf8",S.get("string")).set("string:dealloc",_=>{try{return _?i.cstrToJs(_):null}finally{i.dealloc(_)}}).set("utf8:dealloc",S.get("string:dealloc")).set("json",_=>JSON.parse(i.cstrToJs(_))).set("json:dealloc",_=>{try{return _?JSON.parse(i.cstrToJs(_)):null}finally{i.dealloc(_)}});const V=class{constructor(_){this.name=_.name||"unnamed adapter"}convertArg(_,E,I){l("AbstractArgAdapter must be subclassed.")}};v.FuncPtrAdapter=class ln extends V{constructor(E){super(E),v.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",E),this.name=E.name||"unnamed",this.signature=E.signature,E.contextKey instanceof Function&&(this.contextKey=E.contextKey,E.bindScope||(E.bindScope="context")),this.bindScope=E.bindScope||l("FuncPtrAdapter options requires a bindScope (explicit or implied)."),ln.bindScopes.indexOf(E.bindScope)<0&&l("Invalid options.bindScope ("+E.bindMod+") for FuncPtrAdapter. Expecting one of: ("+ln.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=E.callProxy instanceof Function?E.callProxy:void 0}contextKey(E,I){return this}contextMap(E){const I=this.__cmap||(this.__cmap=new Map);let z=I.get(E);return z===void 0&&I.set(E,z=[]),z}convertArg(E,I,z){let m=this.singleton;if(!m&&this.isContext&&(m=this.contextMap(this.contextKey(I,z))),m&&m[0]===E)return m[1];if(E instanceof Function){this.callProxy&&(E=this.callProxy(E));const N=k(E,this.signature,this.isTransient);if(ln.debugFuncInstall&&ln.debugOut("FuncPtrAdapter installed",this,this.contextKey(I,z),"@"+N,E),m){if(m[1]){ln.debugFuncInstall&&ln.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(I,z),"@"+m[1],E);try{d.scopedAlloc[d.scopedAlloc.length-1].push(m[1])}catch{}}m[0]=E,m[1]=N}return N}else if(i.isPtr(E)||E===null||E===void 0){if(m&&m[1]&&m[1]!==E){ln.debugFuncInstall&&ln.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(I,z),"@"+m[1],E);try{d.scopedAlloc[d.scopedAlloc.length-1].push(m[1])}catch{}m[0]=m[1]=E|0}return E||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},v.FuncPtrAdapter.warnOnUse=!1,v.FuncPtrAdapter.debugFuncInstall=!1,v.FuncPtrAdapter.debugOut=console.debug.bind(console),v.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const D=_=>v.get(_)||l("Argument adapter not found:",_),K=_=>S.get(_)||l("Result adapter not found:",_);d.xWrap.convertArg=(_,...E)=>D(_)(...E),d.xWrap.convertArgNoCheck=(_,...E)=>v.get(_)(...E),d.xWrap.convertResult=(_,E)=>_===null?E:_?K(_)(E):void 0,d.xWrap.convertResultNoCheck=(_,E)=>_===null?E:_?S.get(_)(E):void 0,i.xWrap=function(_,E,...I){arguments.length===3&&Array.isArray(arguments[2])&&(I=arguments[2]),i.isPtr(_)&&(_=i.functionEntry(_)||l("Function pointer not found in WASM function table."));const z=_ instanceof Function,m=z?_:i.xGet(_);if(z&&(_=m.name||"unnamed function"),I.length!==m.length&&y(_,m.length),E===null&&m.length===0)return m;E!=null&&K(E);for(const h of I)h instanceof V?v.set(h,(...f)=>h.convertArg(...f)):D(h);const N=d.xWrap;return m.length===0?(...h)=>h.length?y(_,m.length):N.convertResult(E,m.call(null)):function(...h){h.length!==m.length&&y(_,m.length);const f=i.scopedAllocPush();try{for(const q in h)h[q]=N.convertArgNoCheck(I[q],h[q],h,q);return N.convertResultNoCheck(E,m.apply(null,h))}finally{i.scopedAllocPop(f)}}};const le=function(_,E,I,z,m,N){if(typeof I=="string"){if(E===1)return N.get(I);if(E===2){if(z)z instanceof Function||l(m,"requires a function argument.");else return delete N.get(I),_;return N.set(I,z),_}}l("Invalid arguments to",m)};return i.xWrap.resultAdapter=function _(E,I){return le(_,arguments.length,E,I,"resultAdapter()",S)},i.xWrap.argAdapter=function _(E,I){return le(_,arguments.length,E,I,"argAdapter()",v)},i.xWrap.FuncPtrAdapter=v.FuncPtrAdapter,i.xCallWrapped=function(_,E,I,...z){return Array.isArray(arguments[3])&&(z=arguments[3]),i.xWrap(_,E,I||[]).apply(null,z||[])},i.xWrap.testConvertArg=d.xWrap.convertArg,i.xWrap.testConvertResult=d.xWrap.convertResult,i},globalThis.WhWasmUtilInstaller.yawl=function(i){const l=()=>fetch(i.uri,{credentials:"same-origin"}),a=this,c=function(w){if(i.wasmUtilTarget){const k=(...J)=>{throw new Error(J.join(" "))},L=i.wasmUtilTarget;if(L.module=w.module,L.instance=w.instance,L.instance.exports.memory||(L.memory=i.imports&&i.imports.env&&i.imports.env.memory||k("Missing 'memory' object!")),!L.alloc&&w.instance.exports.malloc){const J=w.instance.exports;L.alloc=function(ee){return J.malloc(ee)||k("Allocation of",ee,"bytes failed.")},L.dealloc=function(ee){J.free(ee)}}a(L)}return i.onload&&i.onload(w,i),w};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(l(),i.imports||{}).then(c)}:function(){return l().then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,i.imports||{})).then(c)}}.bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(l){const a=(...x)=>{throw new Error(x.join(" "))};!(l.heap instanceof WebAssembly.Memory)&&!(l.heap instanceof Function)&&a("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(x){l[x]instanceof Function||a("Config option '"+x+"' must be a function.")});const c=i,d=l.heap instanceof Function?l.heap:()=>new Uint8Array(l.heap.buffer),w=l.alloc,k=l.dealloc,L=l.log||console.log.bind(console),J=l.memberPrefix||"",ee=l.memberSuffix||"",se=l.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!l.bigIntEnabled,T=globalThis.BigInt,g=globalThis.BigInt64Array,y=l.ptrSizeof||4,v=l.ptrIR||"i32";c.debugFlags||(c.__makeDebugFlags=function(x=null){x&&x.__flags&&(x=x.__flags);const C=function R($){return arguments.length===0?R.__flags:($<0?(delete R.__flags.getter,delete R.__flags.setter,delete R.__flags.alloc,delete R.__flags.dealloc):(R.__flags.getter=(1&$)!==0,R.__flags.setter=(2&$)!==0,R.__flags.alloc=(4&$)!==0,R.__flags.dealloc=(8&$)!==0),R._flags)};return Object.defineProperty(C,"__flags",{iterable:!1,writable:!1,value:Object.create(x)}),x||C(0),C},c.debugFlags=c.__makeDebugFlags());const S=function(){const x=new ArrayBuffer(2);return new DataView(x).setInt16(0,256,!0),new Int16Array(x)[0]===256}(),b=x=>x[1]==="(",Q=x=>x==="P",V=x=>b(x)?"p":x[0],D=function(x){switch(V(x)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return v;case"j":return"i64";case"f":return"float";case"d":return"double"}a("Unhandled signature IR:",x)},K=g?()=>!0:()=>a("BigInt64Array is not available."),le=function(x){switch(V(x)){case"p":case"P":case"s":{switch(y){case 4:return"getInt32";case 8:return K()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return K()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}a("Unhandled DataView getter for signature:",x)},_=function(x){switch(V(x)){case"p":case"P":case"s":{switch(y){case 4:return"setInt32";case 8:return K()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return K()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}a("Unhandled DataView setter for signature:",x)},E=function(x){switch(V(x)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return K()&&T;case"p":case"P":case"s":switch(y){case 4:return Number;case 8:return K()&&T}break}a("Unhandled DataView set wrapper for signature:",x)},I=(x,C)=>x+"::"+C,z=function(x,C){return()=>a(I(x,C),"is read-only.")},m=new WeakMap,N="(pointer-is-external)",h=function(x,C,R){if(R||(R=m.get(C)),R){if(m.delete(C),Array.isArray(C.ondispose)){let $;for(;$=C.ondispose.shift();)try{$ instanceof Function?$.call(C):$ instanceof Z?$.dispose():typeof $=="number"&&k($)}catch(de){console.warn("ondispose() for",x.structName,"@",R,"threw. NOT propagating it.",de)}}else if(C.ondispose instanceof Function)try{C.ondispose()}catch($){console.warn("ondispose() for",x.structName,"@",R,"threw. NOT propagating it.",$)}delete C.ondispose,x.debugFlags.__flags.dealloc&&L("debug.dealloc:",C[N]?"EXTERNAL":"",x.structName,"instance:",x.structInfo.sizeof,"bytes @"+R),C[N]||k(R)}},f=x=>({configurable:!1,writable:!1,iterable:!1,value:x}),q=function(x,C,R){let $=!R;R?Object.defineProperty(C,N,f(R)):(R=w(x.structInfo.sizeof),R||a("Allocation of",x.structName,"structure failed."));try{x.debugFlags.__flags.alloc&&L("debug.alloc:",$?"":"EXTERNAL",x.structName,"instance:",x.structInfo.sizeof,"bytes @"+R),$&&d().fill(0,R,R+x.structInfo.sizeof),m.set(C,R)}catch(de){throw h(x,C,R),de}},P=function(){const x=this.pointer;return x?new Uint8Array(d().slice(x,x+this.structInfo.sizeof)):null},ie=f(x=>J+x+ee),oe=function(x,C,R=!0){let $=x.members[C];if(!$&&(J||ee)){for(const de of Object.values(x.members))if(de.key===C){$=de;break}!$&&R&&a(I(x.name,C),"is not a mapped struct member.")}return $},ce=function x(C,R,$=!1){x._||(x._=ge=>ge.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const de=oe(C.structInfo,R,!0);return $?x._(de.signature):de.signature},ae={configurable:!1,enumerable:!1,get:function(){return m.get(this)},set:()=>a("Cannot assign the 'pointer' property of a struct.")},ue=f(function(){const x=[];for(const C of Object.keys(this.structInfo.members))x.push(this.memberKey(C));return x}),be=new TextDecoder("utf-8"),qe=new TextEncoder,rt=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,F=function(x,C,R){return be.decode(x.buffer instanceof rt?x.slice(C,R):x.subarray(C,R))},M=function(x,C,R=!1){const $=oe(x.structInfo,C,R);return $&&$.signature.length===1&&$.signature[0]==="s"?$:!1},j=function(x){x.signature!=="s"&&a("Invalid member type signature for C-string value:",JSON.stringify(x))},re=function(C,R){const $=oe(C.structInfo,R,!0);j($);const de=C[$.key];if(!de)return null;let ge=de;const Re=d();for(;Re[ge]!==0;++ge);return de===ge?"":F(Re,de,ge)},Y=function(x,...C){x.ondispose?Array.isArray(x.ondispose)||(x.ondispose=[x.ondispose]):x.ondispose=[],x.ondispose.push(...C)},he=function(x){const C=qe.encode(x),R=w(C.length+1);R||a("Allocation error while duplicating string:",x);const $=d();return $.set(C,R),$[R+C.length]=0,R},Fe=function(x,C,R){const $=oe(x.structInfo,C,!0);j($);const de=he(R);return x[$.key]=de,Y(x,de),x},Z=function(C,R){arguments[2]!==f&&a("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:f(C),structInfo:f(R)})};Z.prototype=Object.create(null,{dispose:f(function(){h(this.constructor,this)}),lookupMember:f(function(x,C=!0){return oe(this.structInfo,x,C)}),memberToJsString:f(function(x){return re(this,x)}),memberIsString:f(function(x,C=!0){return M(this,x,C)}),memberKey:ie,memberKeys:ue,memberSignature:f(function(x,C=!1){return ce(this,x,C)}),memoryDump:f(P),pointer:ae,setMemberCString:f(function(x,C){return Fe(this,x,C)})}),Object.assign(Z.prototype,{addOnDispose:function(...x){return Y(this,...x),this}}),Object.defineProperties(Z,{allocCString:f(he),isA:f(x=>x instanceof Z),hasExternalPointer:f(x=>x instanceof Z&&!!x[N]),memberKey:ie});const ne=x=>Number.isFinite(x)||x instanceof(T||Number),O=function x(C,R,$){if(!x._){x._={getters:{},setters:{},sw:{}};const yt=["i","c","C","p","P","s","f","d","v()"];se&&yt.push("j"),yt.forEach(function(Ht){x._.getters[Ht]=le(Ht),x._.setters[Ht]=_(Ht),x._.sw[Ht]=E(Ht)});const Hc=/^[ipPsjfdcC]$/,Jc=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;x.sigCheck=function(Ht,Gc,fa,eo){Object.prototype.hasOwnProperty.call(Ht,fa)&&a(Ht.structName,"already has a property named",fa+"."),Hc.test(eo)||Jc.test(eo)||a("Malformed signature for",I(Ht.structName,Gc)+":",eo)}}const de=C.memberKey(R);x.sigCheck(C.prototype,R,de,$.signature),$.key=de,$.name=R;const ge=V($.signature),Re=I(C.prototype.structName,de),Ue=C.prototype.debugFlags.__flags,cr=Object.create(null);cr.configurable=!1,cr.enumerable=!1,cr.get=function(){Ue.getter&&L("debug.getter:",x._.getters[ge],"for",D(ge),Re,"@",this.pointer,"+",$.offset,"sz",$.sizeof);let yt=new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[x._.getters[ge]](0,S);return Ue.getter&&L("debug.getter:",Re,"result =",yt),yt},$.readOnly?cr.set=z(C.prototype.structName,de):cr.set=function(yt){if(Ue.setter&&L("debug.setter:",x._.setters[ge],"for",D(ge),Re,"@",this.pointer,"+",$.offset,"sz",$.sizeof,yt),this.pointer||a("Cannot set struct property on disposed instance."),yt===null)yt=0;else for(;!ne(yt);){if(Q($.signature)&&yt instanceof Z){yt=yt.pointer||0,Ue.setter&&L("debug.setter:",Re,"resolved to",yt);break}a("Invalid value for pointer-type",Re+".")}new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[x._.setters[ge]](0,x._.sw[ge](yt),S)},Object.defineProperty(C.prototype,de,cr)},W=function x(C,R){arguments.length===1?(R=C,C=R.name):R.name||(R.name=C),C||a("Struct name is required.");let $=!1;Object.keys(R.members).forEach(Re=>{const Ue=R.members[Re];Ue.sizeof?Ue.sizeof===1?Ue.signature==="c"||Ue.signature==="C"||a("Unexpected sizeof==1 member",I(R.name,Re),"with signature",Ue.signature):(Ue.sizeof%4!==0&&(console.warn("Invalid struct member description =",Ue,"from",R),a(C,"member",Re,"sizeof is not aligned. sizeof="+Ue.sizeof)),Ue.offset%4!==0&&(console.warn("Invalid struct member description =",Ue,"from",R),a(C,"member",Re,"offset is not aligned. offset="+Ue.offset))):a(C,"member",Re,"is missing sizeof."),(!$||$.offset<Ue.offset)&&($=Ue)}),$?R.sizeof<$.offset+$.sizeof&&a("Invalid struct config:",C,"max member offset ("+$.offset+") ","extends past end of struct (sizeof="+R.sizeof+")."):a("No member property descriptions found.");const de=f(c.__makeDebugFlags(x.debugFlags)),ge=function Re(Ue){this instanceof Re?arguments.length?((Ue!==(Ue|0)||Ue<=0)&&a("Invalid pointer value for",C,"constructor."),q(Re,this,Ue)):q(Re,this):a("The",C,"constructor may only be called via 'new'.")};return Object.defineProperties(ge,{debugFlags:de,isA:f(Re=>Re instanceof ge),memberKey:ie,memberKeys:ue,methodInfoForKey:f(function(Re){}),structInfo:f(R),structName:f(C)}),ge.prototype=new Z(C,R,f),Object.defineProperties(ge.prototype,{debugFlags:de,constructor:f(ge)}),Object.keys(R.members).forEach(Re=>O(ge,Re,R.members[Re])),ge};return W.StructType=Z,W.config=l,W.allocCString=he,W.debugFlags||(W.debugFlags=c.__makeDebugFlags(c.debugFlags)),W},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...T)=>{throw new Error(T.join(" "))};i.SQLite3Error.toss;const a=i.capi,c=i.wasm,d=i.util;if(globalThis.WhWasmUtilInstaller(c),delete globalThis.WhWasmUtilInstaller,c.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new c.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:T=>{let g;return(y,v,S,b)=>{try{const Q=c.cArgvToJs(v,S);return g||(g=c.cArgvToJs(v,b)),T(Q,g)|0}catch(Q){return Q.resultCode||a.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(T,g)=>T[0],callProxy:T=>(g,y,v,S,b,Q)=>{try{return v=v&&c.cstrToJs(v),S=S&&c.cstrToJs(S),b=b&&c.cstrToJs(b),Q=Q&&c.cstrToJs(Q),T(g,y,v,S,b,Q)||0}catch(V){return V.resultCode||a.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new c.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(T,g)=>T[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],c.exports.sqlite3_activate_see instanceof Function&&c.bindingSignatures.push(["sqlite3_key","int","sqlite3*","string","int"],["sqlite3_key_v2","int","sqlite3*","string","*","int"],["sqlite3_rekey","int","sqlite3*","string","int"],["sqlite3_rekey_v2","int","sqlite3*","string","*","int"],["sqlite3_activate_see",void 0,"string"]),c.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:T=>T[0],callProxy:T=>(g,y,v,S,b,Q,V)=>{T(g,y,v,c.cstrToJs(S),c.cstrToJs(b),Q,V)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:T=>T[0],callProxy:T=>(g,y,v,S,b)=>{T(g,y,c.cstrToJs(v),c.cstrToJs(S),b)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],c.bigIntEnabled&&c.exports.sqlite3changegroup_add){const T={signature:"i(ps)",callProxy:g=>(y,v)=>{try{return g(y,c.cstrToJs(v))|0}catch(S){return S.resultCode||a.SQLITE_ERROR}}};c.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xFilter",...T,contextKey:(g,y)=>g[0]}),"*"]])}c.bindingSignatures.wasm=[["sqlite3_wasm_db_reset","int","sqlite3*"],["sqlite3_wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3_wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3_wasm_posix_create_file","int","string","*","int"],["sqlite3_wasm_vfs_unlink","int","sqlite3_vfs*","string"]],i.StructBinder=globalThis.Jaccwabyt({heap:c.heap8u,alloc:c.alloc,dealloc:c.dealloc,bigIntEnabled:c.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const T=c.xWrap.argAdapter("string");c.xWrap.argAdapter("string:flexible",b=>T(d.flexibleString(b))),c.xWrap.argAdapter("string:static",function(b){return c.isPtr(b)?b:(b=""+b,this[b]||(this[b]=c.allocCString(b)))}.bind(Object.create(null)));const g=c.xWrap.argAdapter("*"),y=function(){};c.xWrap.argAdapter("sqlite3_filename",g)("sqlite3_context*",g)("sqlite3_value*",g)("void*",g)("sqlite3_changegroup*",g)("sqlite3_changeset_iter*",g)("sqlite3_session*",g)("sqlite3_stmt*",b=>g(b instanceof(i?.oo1?.Stmt||y)?b.pointer:b))("sqlite3*",b=>g(b instanceof(i?.oo1?.DB||y)?b.pointer:b))("sqlite3_index_info*",b=>g(b instanceof(a.sqlite3_index_info||y)?b.pointer:b))("sqlite3_module*",b=>g(b instanceof(a.sqlite3_module||y)?b.pointer:b))("sqlite3_vfs*",b=>typeof b=="string"?a.sqlite3_vfs_find(b)||i.SQLite3Error.toss(a.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",b):g(b instanceof(a.sqlite3_vfs||y)?b.pointer:b));const v=c.xWrap.resultAdapter("*");c.xWrap.resultAdapter("sqlite3*",v)("sqlite3_context*",v)("sqlite3_stmt*",v)("sqlite3_value*",v)("sqlite3_vfs*",v)("void*",v),c.exports.sqlite3_step.length===0&&(c.xWrap.doArgcCheck=!1,i.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const b of c.bindingSignatures)a[b[0]]=c.xWrap.apply(null,b);for(const b of c.bindingSignatures.wasm)c[b[0]]=c.xWrap.apply(null,b);const S=function(b){return()=>l(b+"() is unavailable due to lack","of BigInt support in this build.")};for(const b of c.bindingSignatures.int64)a[b[0]]=c.bigIntEnabled?c.xWrap.apply(null,b):S(b[0]);if(delete c.bindingSignatures,c.exports.sqlite3_wasm_db_error){const b=c.xWrap("sqlite3_wasm_db_error","int","sqlite3*","int","string");d.sqlite3_wasm_db_error=function(Q,V,D){return V instanceof i.WasmAllocError?(V=a.SQLITE_NOMEM,D=0):V instanceof Error&&(D=D||""+V,V=V.resultCode||a.SQLITE_ERROR),Q?b(Q,V,D):V}}else d.sqlite3_wasm_db_error=function(b,Q,V){return console.warn("sqlite3_wasm_db_error() is not exported.",arguments),Q}}{const T=c.xCall("sqlite3_wasm_enum_json");T||l("Maintenance required: increase sqlite3_wasm_enum_json()'s","static buffer size!"),c.ctype=JSON.parse(c.cstrToJs(T));const g=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];c.bigIntEnabled&&g.push("serialize","session","vtab");for(const S of g)for(const b of Object.entries(c.ctype[S]))a[b[0]]=b[1];c.functionEntry(a.SQLITE_WASM_DEALLOC)||l("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+a.SQLITE_WASM_DEALLOC+").");const y=Object.create(null);for(const S of["resultCodes"])for(const b of Object.entries(c.ctype[S]))y[b[1]]=b[0];a.sqlite3_js_rc_str=S=>y[S];const v=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!d.isUIThread(),sqlite3_index_info:!c.bigIntEnabled,sqlite3_index_constraint:!c.bigIntEnabled,sqlite3_index_orderby:!c.bigIntEnabled,sqlite3_index_constraint_usage:!c.bigIntEnabled});for(const S of c.ctype.structs)v[S.name]||(a[S.name]=i.StructBinder(S));if(a.sqlite3_index_info){for(const S of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])a.sqlite3_index_info[S]=a[S],delete a[S];a.sqlite3_vtab_config=c.xWrap("sqlite3_wasm_vtab_config","int",["sqlite3*","int","int"])}}const w=(T,g,y)=>d.sqlite3_wasm_db_error(T,a.SQLITE_MISUSE,g+"() requires "+y+" argument"+(y===1?"":"s")+"."),k=T=>d.sqlite3_wasm_db_error(T,a.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),L=T=>c.xWrap.argAdapter("sqlite3*")(T),J=T=>c.isPtr(T)?c.cstrToJs(T):T,ee=function(T,g){T=L(T);let y=this.dbMap.get(T);if(g)!y&&g>0&&this.dbMap.set(T,y=Object.create(null));else return this.dbMap.delete(T),y;return y}.bind(Object.assign(Object.create(null),{dbMap:new Map}));ee.addCollation=function(T,g){const y=ee(T,1);y.collation||(y.collation=new Set),y.collation.add(J(g).toLowerCase())},ee._addUDF=function(T,g,y,v){g=J(g).toLowerCase();let S=v.get(g);S||v.set(g,S=new Set),S.add(y<0?-1:y)},ee.addFunction=function(T,g,y){const v=ee(T,1);v.udf||(v.udf=new Map),this._addUDF(T,g,y,v.udf)},ee.addWindowFunc=function(T,g,y){const v=ee(T,1);v.wudf||(v.wudf=new Map),this._addUDF(T,g,y,v.wudf)},ee.cleanup=function(T){T=L(T);const g=[T];for(const S of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const b=c.exports[S];g.length=b.length;try{a[S](...g)}catch(Q){console.warn("close-time call of",S+"(",g,") threw:",Q)}}const y=ee(T,0);if(!y)return;if(y.collation){for(const S of y.collation)try{a.sqlite3_create_collation_v2(T,S,a.SQLITE_UTF8,0,0,0)}catch{}delete y.collation}let v;for(v=0;v<2;++v){const S=v?y.wudf:y.udf;if(!S)continue;const b=v?a.sqlite3_create_window_function:a.sqlite3_create_function_v2;for(const Q of S){const V=Q[0],D=Q[1],K=[T,V,0,a.SQLITE_UTF8,0,0,0,0,0];v&&K.push(0);for(const le of D)try{K[2]=le,b.apply(null,K)}catch{}D.clear()}S.clear()}delete y.udf,delete y.wudf};{const T=c.xWrap("sqlite3_close_v2","int","sqlite3*");a.sqlite3_close_v2=function(g){if(arguments.length!==1)return w(g,"sqlite3_close_v2",1);if(g)try{ee.cleanup(g)}catch{}return T(g)}}if(a.sqlite3session_table_filter){const T=c.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);a.sqlite3session_delete=function(g){if(arguments.length!==1)return w(pDb,"sqlite3session_delete",1);g&&a.sqlite3session_table_filter(g,0,0),T(g)}}{const T=(y,v)=>"argv["+v+"]:"+y[0]+":"+c.cstrToJs(y[1]).toLowerCase(),g=c.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new c.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:T}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:T})]);a.sqlite3_create_collation_v2=function(y,v,S,b,Q,V){if(arguments.length!==6)return w(y,"sqlite3_create_collation_v2",6);if(!(S&15))S|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(S&15))return k(y);try{const D=g(y,v,S,b,Q,V);return D===0&&Q instanceof Function&&ee.addCollation(y,v),D}catch(D){return d.sqlite3_wasm_db_error(y,D)}},a.sqlite3_create_collation=(y,v,S,b,Q)=>arguments.length===5?a.sqlite3_create_collation_v2(y,v,S,b,Q,0):w(y,"sqlite3_create_collation",5)}{const T=function(S,b){return S[0]+":"+(S[2]<0?-1:S[2])+":"+b+":"+c.cstrToJs(S[1]).toLowerCase()},g=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:T,callProxy:S=>(b,Q,V)=>{try{S(b,...a.sqlite3_values_to_js(Q,V))}catch(D){a.sqlite3_result_error_js(b,D)}}},xFinalAndValue:{signature:"v(p)",contextKey:T,callProxy:S=>b=>{try{a.sqlite3_result_js(b,S(b))}catch(Q){a.sqlite3_result_error_js(b,Q)}}},xFunc:{signature:"v(pip)",contextKey:T,callProxy:S=>(b,Q,V)=>{try{a.sqlite3_result_js(b,S(b,...a.sqlite3_values_to_js(Q,V)))}catch(D){a.sqlite3_result_error_js(b,D)}}},xDestroy:{signature:"v(p)",contextKey:T,callProxy:S=>b=>{try{S(b)}catch(Q){console.error("UDF xDestroy method threw:",Q)}}}}),y=c.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xFunc",...g.xFunc}),new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]),v=c.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xValue",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xInverse",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]);a.sqlite3_create_function_v2=function S(b,Q,V,D,K,le,_,E,I){if(S.length!==arguments.length)return w(b,"sqlite3_create_function_v2",S.length);if(!(D&15))D|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(D&15))return k(b);try{const z=y(b,Q,V,D,K,le,_,E,I);return z===0&&(le instanceof Function||_ instanceof Function||E instanceof Function||I instanceof Function)&&ee.addFunction(b,Q,V),z}catch(z){return console.error("sqlite3_create_function_v2() setup threw:",z),d.sqlite3_wasm_db_error(b,z,"Creation of UDF threw: "+z)}},a.sqlite3_create_function=function S(b,Q,V,D,K,le,_,E){return S.length===arguments.length?a.sqlite3_create_function_v2(b,Q,V,D,K,le,_,E,0):w(b,"sqlite3_create_function",S.length)},a.sqlite3_create_window_function=function S(b,Q,V,D,K,le,_,E,I,z){if(S.length!==arguments.length)return w(b,"sqlite3_create_window_function",S.length);if(!(D&15))D|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(D&15))return k(b);try{const m=v(b,Q,V,D,K,le,_,E,I,z);return m===0&&(le instanceof Function||_ instanceof Function||E instanceof Function||I instanceof Function||z instanceof Function)&&ee.addWindowFunc(b,Q,V),m}catch(m){return console.error("sqlite3_create_window_function() setup threw:",m),d.sqlite3_wasm_db_error(b,m,"Creation of UDF threw: "+m)}},a.sqlite3_create_function_v2.udfSetResult=a.sqlite3_create_function.udfSetResult=a.sqlite3_create_window_function.udfSetResult=a.sqlite3_result_js,a.sqlite3_create_function_v2.udfConvertArgs=a.sqlite3_create_function.udfConvertArgs=a.sqlite3_create_window_function.udfConvertArgs=a.sqlite3_values_to_js,a.sqlite3_create_function_v2.udfSetError=a.sqlite3_create_function.udfSetError=a.sqlite3_create_window_function.udfSetError=a.sqlite3_result_error_js}{const T=(y,v)=>(typeof y=="string"?v=-1:d.isSQLableTypedArray(y)?(v=y.byteLength,y=d.typedArrayToString(y instanceof ArrayBuffer?new Uint8Array(y):y)):Array.isArray(y)&&(y=y.join(""),v=-1),[y,v]),g={basic:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};a.sqlite3_prepare_v3=function y(v,S,b,Q,V,D){if(y.length!==arguments.length)return w(v,"sqlite3_prepare_v3",y.length);const[K,le]=T(S,b);switch(typeof K){case"string":return g.basic(v,K,le,Q,V,null);case"number":return g.full(v,K,le,Q,V,D);default:return d.sqlite3_wasm_db_error(v,a.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},a.sqlite3_prepare_v2=function y(v,S,b,Q,V){return y.length===arguments.length?a.sqlite3_prepare_v3(v,S,b,0,Q,V):w(v,"sqlite3_prepare_v2",y.length)}}{const T=c.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),g=c.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);a.sqlite3_bind_text=function y(v,S,b,Q,V){if(y.length!==arguments.length)return w(a.sqlite3_db_handle(v),"sqlite3_bind_text",y.length);if(c.isPtr(b)||b===null)return T(v,S,b,Q,V);b instanceof ArrayBuffer?b=new Uint8Array(b):Array.isArray(pMem)&&(b=pMem.join(""));let D,K;try{if(d.isSQLableTypedArray(b))D=c.allocFromTypedArray(b),K=b.byteLength;else if(typeof b=="string")[D,K]=c.allocCString(b);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return T(v,S,D,K,a.SQLITE_WASM_DEALLOC)}catch(le){return c.dealloc(D),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),le)}},a.sqlite3_bind_blob=function y(v,S,b,Q,V){if(y.length!==arguments.length)return w(a.sqlite3_db_handle(v),"sqlite3_bind_blob",y.length);if(c.isPtr(b)||b===null)return g(v,S,b,Q,V);b instanceof ArrayBuffer?b=new Uint8Array(b):Array.isArray(b)&&(b=b.join(""));let D,K;try{if(d.isBindableTypedArray(b))D=c.allocFromTypedArray(b),K=Q>=0?Q:b.byteLength;else if(typeof b=="string")[D,K]=c.allocCString(b);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return g(v,S,D,K,a.SQLITE_WASM_DEALLOC)}catch(le){return c.dealloc(D),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(v),le)}}}a.sqlite3_config=function(T,...g){if(arguments.length<2)return a.SQLITE_MISUSE;switch(T){case a.SQLITE_CONFIG_COVERING_INDEX_SCAN:case a.SQLITE_CONFIG_MEMSTATUS:case a.SQLITE_CONFIG_SMALL_MALLOC:case a.SQLITE_CONFIG_SORTERREF_SIZE:case a.SQLITE_CONFIG_STMTJRNL_SPILL:case a.SQLITE_CONFIG_URI:return c.exports.sqlite3_wasm_config_i(T,g[0]);case a.SQLITE_CONFIG_LOOKASIDE:return c.exports.sqlite3_wasm_config_ii(T,g[0],g[1]);case a.SQLITE_CONFIG_MEMDB_MAXSIZE:return c.exports.sqlite3_wasm_config_j(T,g[0]);case a.SQLITE_CONFIG_GETMALLOC:case a.SQLITE_CONFIG_GETMUTEX:case a.SQLITE_CONFIG_GETPCACHE2:case a.SQLITE_CONFIG_GETPCACHE:case a.SQLITE_CONFIG_HEAP:case a.SQLITE_CONFIG_LOG:case a.SQLITE_CONFIG_MALLOC:case a.SQLITE_CONFIG_MMAP_SIZE:case a.SQLITE_CONFIG_MULTITHREAD:case a.SQLITE_CONFIG_MUTEX:case a.SQLITE_CONFIG_PAGECACHE:case a.SQLITE_CONFIG_PCACHE2:case a.SQLITE_CONFIG_PCACHE:case a.SQLITE_CONFIG_PCACHE_HDRSZ:case a.SQLITE_CONFIG_PMASZ:case a.SQLITE_CONFIG_SERIALIZED:case a.SQLITE_CONFIG_SINGLETHREAD:case a.SQLITE_CONFIG_SQLLOG:case a.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return a.SQLITE_NOTFOUND}};{const T=new Set;a.sqlite3_auto_extension=function(g){if(g instanceof Function)g=c.installFunction("i(ppp)",g);else if(arguments.length!==1||!c.isPtr(g))return a.SQLITE_MISUSE;const y=c.exports.sqlite3_auto_extension(g);return g!==arguments[0]&&(y===0?T.add(g):c.uninstallFunction(g)),y},a.sqlite3_cancel_auto_extension=function(g){return!g||arguments.length!==1||!c.isPtr(g)?0:c.exports.sqlite3_cancel_auto_extension(g)},a.sqlite3_reset_auto_extension=function(){c.exports.sqlite3_reset_auto_extension();for(const g of T)c.uninstallFunction(g);T.clear()}}const se=a.sqlite3_vfs_find("kvvfs");if(se)if(d.isUIThread()){const T=new a.sqlite3_kvvfs_methods(c.exports.sqlite3_wasm_kvvfs_methods());delete a.sqlite3_kvvfs_methods;const g=c.exports.sqlite3_wasm_kvvfsMakeKeyOnPstack,y=c.pstack,v=b=>c.peek(b)===115?sessionStorage:localStorage,S={xRead:(b,Q,V,D)=>{const K=y.pointer,le=c.scopedAllocPush();try{const _=g(b,Q);if(!_)return-3;const E=c.cstrToJs(_),I=v(b).getItem(E);if(!I)return-1;const z=I.length;if(D<=0)return z;if(D===1)return c.poke(V,0),z;const m=c.scopedAllocCString(I);return D>z+1&&(D=z+1),c.heap8u().copyWithin(V,m,m+D-1),c.poke(V+D-1,0),D-1}catch(_){return console.error("kvstorageRead()",_),-2}finally{y.restore(K),c.scopedAllocPop(le)}},xWrite:(b,Q,V)=>{const D=y.pointer;try{const K=g(b,Q);if(!K)return 1;const le=c.cstrToJs(K);return v(b).setItem(le,c.cstrToJs(V)),0}catch(K){return console.error("kvstorageWrite()",K),a.SQLITE_IOERR}finally{y.restore(D)}},xDelete:(b,Q)=>{const V=y.pointer;try{const D=g(b,Q);return D?(v(b).removeItem(c.cstrToJs(D)),0):1}catch(D){return console.error("kvstorageDelete()",D),a.SQLITE_IOERR}finally{y.restore(V)}}};for(const b of Object.keys(S))T[T.memberKey(b)]=c.installFunction(T.memberSignature(b),S[b])}else a.sqlite3_vfs_unregister(se);c.xWrap.FuncPtrAdapter.warnOnUse=!0}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.43.2",libVersionNumber:3043002,sourceId:"2023-10-10 12:14:04 4310099cce5a487035fa535dd3002c59ac7f1d1bec68d7cf317fd3e769484790",downloadVersion:3430200}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...m)=>{throw new i.SQLite3Error(...m)},a=i.capi,c=i.wasm,d=i.util,w=new WeakMap,k=new WeakMap,L=(m,N,h)=>{const f=Object.getOwnPropertyDescriptor(m,N);return f?f.value:h},J=function(m,N){return N&&(m instanceof g&&(m=m.pointer),l(N,"sqlite3 result code",N+":",m?a.sqlite3_errmsg(m):a.sqlite3_errstr(N))),arguments[0]},ee=c.installFunction("i(ippp)",function(m,N,h,f){a.SQLITE_TRACE_STMT===m&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+N+":",c.cstrToJs(f))}.bind({counter:0})),se=Object.create(null),T=function m(...N){if(!m._name2vfs){m._name2vfs=Object.create(null);const ue=typeof importScripts=="function"?be=>l("The VFS for",be,"is only available in the main window thread."):!1;m._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:ue||(()=>"local")},m._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:ue||(()=>"session")}}const h=m.normalizeArgs(...N);let f=h.filename,q=h.vfs,P=h.flags;(typeof f!="string"&&typeof f!="number"||typeof P!="string"||q&&typeof q!="string"&&typeof q!="number")&&(i.config.error("Invalid DB ctor args",h,arguments),l("Invalid arguments for DB constructor."));let X=typeof f=="number"?c.cstrToJs(f):f;const ie=m._name2vfs[X];ie&&(q=ie.vfs,f=X=ie.filename(X));let oe,ce=0;P.indexOf("c")>=0&&(ce|=a.SQLITE_OPEN_CREATE|a.SQLITE_OPEN_READWRITE),P.indexOf("w")>=0&&(ce|=a.SQLITE_OPEN_READWRITE),ce===0&&(ce|=a.SQLITE_OPEN_READONLY),ce|=a.SQLITE_OPEN_EXRESCODE;const ae=c.pstack.pointer;try{const ue=c.pstack.allocPtr();let be=a.sqlite3_open_v2(f,ue,ce,q||0);oe=c.peekPtr(ue),J(oe,be),a.sqlite3_extended_result_codes(oe,1),P.indexOf("t")>=0&&a.sqlite3_trace_v2(oe,a.SQLITE_TRACE_STMT,ee,oe)}catch(ue){throw oe&&a.sqlite3_close_v2(oe),ue}finally{c.pstack.restore(ae)}this.filename=X,w.set(this,oe),k.set(this,Object.create(null));try{const ue=a.sqlite3_js_db_vfs(oe);ue||l("Internal error: cannot get VFS for new db handle.");const be=se[ue];be instanceof Function?be(this,i):be&&J(oe,a.sqlite3_exec(oe,be,0,0,0))}catch(ue){throw this.close(),ue}};T.setVfsPostOpenSql=function(m,N){se[m]=N},T.normalizeArgs=function(m=":memory:",N="c",h=null){const f={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(f,arguments[0]),f.flags===void 0&&(f.flags="c"),f.vfs===void 0&&(f.vfs=null),f.filename===void 0&&(f.filename=":memory:")):(f.filename=m,f.flags=N,f.vfs=h),f};const g=function(...m){T.apply(this,m)};g.dbCtorHelper=T;const y={null:1,number:2,string:3,boolean:4,blob:5};y.undefined==y.null,c.bigIntEnabled&&(y.bigint=y.number);const v=function(){y!==arguments[2]&&l(a.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],w.set(this,arguments[1]),this.parameterCount=a.sqlite3_bind_parameter_count(this.pointer)},S=function(m){return m.pointer||l("DB has been closed."),m},b=function(m,N){return(N!==(N|0)||N<0||N>=m.columnCount)&&l("Column index",N,"is out of range."),m},Q=function(m,N){const h=Object.create(null);switch(h.opt=Object.create(null),N.length){case 1:typeof N[0]=="string"||d.isSQLableTypedArray(N[0])||Array.isArray(N[0])?h.sql=N[0]:N[0]&&typeof N[0]=="object"&&(h.opt=N[0],h.sql=h.opt.sql);break;case 2:h.sql=N[0],h.opt=N[1];break;default:l("Invalid argument count for exec().")}h.sql=d.flexibleString(h.sql),typeof h.sql!="string"&&l("Missing SQL argument or unsupported SQL value type.");const f=h.opt;switch(f.returnValue){case"resultRows":f.resultRows||(f.resultRows=[]),h.returnVal=()=>f.resultRows;break;case"saveSql":f.saveSql||(f.saveSql=[]),h.returnVal=()=>f.saveSql;break;case void 0:case"this":h.returnVal=()=>m;break;default:l("Invalid returnValue value:",f.returnValue)}if(!f.callback&&!f.returnValue&&f.rowMode!==void 0&&(f.resultRows||(f.resultRows=[]),h.returnVal=()=>f.resultRows),f.callback||f.resultRows)switch(f.rowMode===void 0?"array":f.rowMode){case"object":h.cbArg=q=>q.get(Object.create(null));break;case"array":h.cbArg=q=>q.get([]);break;case"stmt":Array.isArray(f.resultRows)&&l("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),h.cbArg=q=>q;break;default:if(d.isInt32(f.rowMode)){h.cbArg=q=>q.get(f.rowMode);break}else if(typeof f.rowMode=="string"&&f.rowMode.length>1&&f.rowMode[0]==="$"){const q=f.rowMode.substr(1);h.cbArg=P=>{const X=P.get(Object.create(null))[q];return X===void 0?l(a.SQLITE_NOTFOUND,"exec(): unknown result column:",q):X};break}l("Invalid rowMode:",f.rowMode)}return h},V=(m,N,h,...f)=>{const q=m.prepare(N);try{const P=q.bind(h).step()?q.get(...f):void 0;return q.reset(),P}finally{q.finalize()}},D=(m,N,h,f)=>m.exec({sql:N,bind:h,rowMode:f,returnValue:"resultRows"});g.checkRc=(m,N)=>J(m,N),g.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return S(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const m=this.pointer;if(Object.keys(k.get(this)).forEach((N,h)=>{if(h&&h.pointer)try{h.finalize()}catch{}}),w.delete(this),k.delete(this),a.sqlite3_close_v2(m),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(m=!1,N=!1){const h=S(this).pointer;return m?N?a.sqlite3_total_changes64(h):a.sqlite3_total_changes(h):N?a.sqlite3_changes64(h):a.sqlite3_changes(h)},dbFilename:function(m="main"){return a.sqlite3_db_filename(S(this).pointer,m)},dbName:function(m=0){return a.sqlite3_db_name(S(this).pointer,m)},dbVfsName:function(m=0){let N;const h=a.sqlite3_js_db_vfs(S(this).pointer,m);if(h){const f=new a.sqlite3_vfs(h);try{N=c.cstrToJs(f.$zName)}finally{f.dispose()}}return N},prepare:function(m){S(this);const N=c.pstack.pointer;let h,f;try{h=c.pstack.alloc(8),g.checkRc(this,a.sqlite3_prepare_v2(this.pointer,m,-1,h,null)),f=c.peekPtr(h)}finally{c.pstack.restore(N)}f||l("Cannot prepare empty SQL.");const q=new v(this,f,y);return k.get(this)[f]=q,q},exec:function(){S(this);const m=Q(this,arguments);if(!m.sql)return l("exec() requires an SQL string.");const N=m.opt,h=N.callback,f=Array.isArray(N.resultRows)?N.resultRows:void 0;let q,P=N.bind,X=!!(m.cbArg||N.columnNames||f);const ie=c.scopedAllocPush(),oe=Array.isArray(N.saveSql)?N.saveSql:void 0;try{const ce=d.isSQLableTypedArray(m.sql);let ae=ce?m.sql.byteLength:c.jstrlen(m.sql);const ue=c.scopedAlloc(2*c.ptrSizeof+(ae+1)),be=ue+c.ptrSizeof;let qe=be+c.ptrSizeof;const rt=qe+ae;for(ce?c.heap8().set(m.sql,qe):c.jstrcpy(m.sql,c.heap8(),qe,ae,!1),c.poke(qe+ae,0);qe&&c.peek(qe,"i8");){c.pokePtr([ue,be],0),g.checkRc(this,a.sqlite3_prepare_v3(this.pointer,qe,ae,0,ue,be));const F=c.peekPtr(ue);if(qe=c.peekPtr(be),ae=rt-qe,!!F){if(oe&&oe.push(a.sqlite3_sql(F).trim()),q=new v(this,F,y),P&&q.parameterCount&&(q.bind(P),P=null),X&&q.columnCount){let M=Array.isArray(N.columnNames)?0:1;if(X=!1,m.cbArg||f){for(;q.step();q._lockedByExec=!1){M++===0&&q.getColumnNames(N.columnNames),q._lockedByExec=!0;const j=m.cbArg(q);if(f&&f.push(j),h&&h.call(N,j,q)===!1)break}q._lockedByExec=!1}M===0&&q.getColumnNames(N.columnNames)}else q.step();q.reset().finalize(),q=null}}}finally{c.scopedAllocPop(ie),q&&(delete q._lockedByExec,q.finalize())}return m.returnVal()},createFunction:function(N,h,f){const q=j=>j instanceof Function;switch(arguments.length){case 1:f=N,N=f.name,h=f.xFunc||0;break;case 2:q(h)||(f=h,h=f.xFunc||0);break}f||(f={}),typeof N!="string"&&l("Invalid arguments: missing function name.");let P=f.xStep||0,X=f.xFinal||0;const ie=f.xValue||0,oe=f.xInverse||0;let ce;q(h)?(ce=!1,(q(P)||q(X))&&l("Ambiguous arguments: scalar or aggregate?"),P=X=null):q(P)?(q(X)||l("Missing xFinal() callback for aggregate or window UDF."),h=null):q(X)?l("Missing xStep() callback for aggregate or window UDF."):l("Missing function-type properties."),ce===!1?(q(ie)||q(oe))&&l("xValue and xInverse are not permitted for non-window UDFs."):q(ie)?(q(oe)||l("xInverse must be provided if xValue is."),ce=!0):q(oe)&&l("xValue must be provided if xInverse is.");const ae=f.pApp;ae!=null&&(typeof ae!="number"||!d.isInt32(ae))&&l("Invalid value for pApp property. Must be a legal WASM pointer value.");const ue=f.xDestroy||0;ue&&!q(ue)&&l("xDestroy property must be a function.");let be=0;L(f,"deterministic")&&(be|=a.SQLITE_DETERMINISTIC),L(f,"directOnly")&&(be|=a.SQLITE_DIRECTONLY),L(f,"innocuous")&&(be|=a.SQLITE_INNOCUOUS),N=N.toLowerCase();const qe=h||P,rt=L(f,"arity"),F=typeof rt=="number"?rt:qe.length?qe.length-1:0;let M;return ce?M=a.sqlite3_create_window_function(this.pointer,N,F,a.SQLITE_UTF8|be,ae||0,P,X,ie,oe,ue):M=a.sqlite3_create_function_v2(this.pointer,N,F,a.SQLITE_UTF8|be,ae||0,h,P,X,ue),g.checkRc(this,M),this},selectValue:function(m,N,h){return V(this,m,N,0,h)},selectValues:function(m,N,h){const f=this.prepare(m),q=[];try{for(f.bind(N);f.step();)q.push(f.get(0,h));f.reset()}finally{f.finalize()}return q},selectArray:function(m,N){return V(this,m,N,[])},selectObject:function(m,N){return V(this,m,N,{})},selectArrays:function(m,N){return D(this,m,N,"array")},selectObjects:function(m,N){return D(this,m,N,"object")},openStatementCount:function(){return this.pointer?Object.keys(k.get(this)).length:0},transaction:function(m){let N="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&l(a.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),N+=" "+arguments[0],m=arguments[1]),S(this).exec(N);try{const h=m(this);return this.exec("COMMIT"),h}catch(h){throw this.exec("ROLLBACK"),h}},savepoint:function(m){S(this).exec("SAVEPOINT oo1");try{const N=m(this);return this.exec("RELEASE oo1"),N}catch(N){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),N}},checkRc:function(m){return J(this,m)}};const K=function(m){return m.pointer||l("Stmt has been closed."),m},le=function(m){let N=y[m==null?"null":typeof m];switch(N){case y.boolean:case y.null:case y.number:case y.string:return N;case y.bigint:if(c.bigIntEnabled)return N;default:return d.isBindableTypedArray(m)?y.blob:void 0}},_=function(m){return le(m)||l("Unsupported bind() argument type:",typeof m)},E=function(m,N){const h=typeof N=="number"?N:a.sqlite3_bind_parameter_index(m.pointer,N);return h===0||!d.isInt32(h)?l("Invalid bind() parameter name: "+N):(h<1||h>m.parameterCount)&&l("Bind index",N,"is out of range."),h},I=function(m,N){return m._lockedByExec&&l("Operation is illegal when statement is locked:",N),m},z=function m(N,h,f,q){I(K(N),"bind()"),m._||(m._tooBigInt=X=>l("BigInt value is too big to store without precision loss:",X),m._={string:function(X,ie,oe,ce){const[ae,ue]=c.allocCString(oe,!0);return(ce?a.sqlite3_bind_blob:a.sqlite3_bind_text)(X.pointer,ie,ae,ue,a.SQLITE_WASM_DEALLOC)}}),_(q),h=E(N,h);let P=0;switch(q==null?y.null:f){case y.null:P=a.sqlite3_bind_null(N.pointer,h);break;case y.string:P=m._.string(N,h,q,!1);break;case y.number:{let X;d.isInt32(q)?X=a.sqlite3_bind_int:typeof q=="bigint"?d.bigIntFits64(q)?c.bigIntEnabled?X=a.sqlite3_bind_int64:d.bigIntFitsDouble(q)?(q=Number(q),X=a.sqlite3_bind_double):m._tooBigInt(q):m._tooBigInt(q):(q=Number(q),c.bigIntEnabled&&Number.isInteger(q)?X=a.sqlite3_bind_int64:X=a.sqlite3_bind_double),P=X(N.pointer,h,q);break}case y.boolean:P=a.sqlite3_bind_int(N.pointer,h,q?1:0);break;case y.blob:{if(typeof q=="string"){P=m._.string(N,h,q,!0);break}else q instanceof ArrayBuffer?q=new Uint8Array(q):d.isBindableTypedArray(q)||l("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const X=c.alloc(q.byteLength||1);c.heap8().set(q.byteLength?q:[0],X),P=a.sqlite3_bind_blob(N.pointer,h,X,q.byteLength,a.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",q),l("Unsupported bind() argument type: "+typeof q)}return P&&g.checkRc(N.db.pointer,P),N._mayGet=!1,N};v.prototype={finalize:function(){if(this.pointer){I(this,"finalize()");const m=a.sqlite3_finalize(this.pointer);return delete k.get(this.db)[this.pointer],w.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,m}},clearBindings:function(){return I(K(this),"clearBindings()"),a.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(m){I(this,"reset()"),m&&this.clearBindings();const N=a.sqlite3_reset(K(this).pointer);return this._mayGet=!1,J(this.db,N),this},bind:function(){K(this);let m,N;switch(arguments.length){case 1:m=1,N=arguments[0];break;case 2:m=arguments[0],N=arguments[1];break;default:l("Invalid bind() arguments.")}return N===void 0?this:(this.parameterCount||l("This statement has no bindable parameters."),this._mayGet=!1,N===null?z(this,m,y.null,N):Array.isArray(N)?(arguments.length!==1&&l("When binding an array, an index argument is not permitted."),N.forEach((h,f)=>z(this,f+1,_(h),h)),this):(N instanceof ArrayBuffer&&(N=new Uint8Array(N)),typeof N=="object"&&!d.isBindableTypedArray(N)?(arguments.length!==1&&l("When binding an object, an index argument is not permitted."),Object.keys(N).forEach(h=>z(this,h,_(N[h]),N[h])),this):z(this,m,_(N),N)))},bindAsBlob:function(m,N){K(this),arguments.length===1&&(N=m,m=1);const h=_(N);return y.string!==h&&y.blob!==h&&y.null!==h&&l("Invalid value type for bindAsBlob()"),z(this,m,y.blob,N)},step:function(){I(this,"step()");const m=a.sqlite3_step(K(this).pointer);switch(m){case a.SQLITE_DONE:return this._mayGet=!1;case a.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,i.config.warn("sqlite3_step() rc=",m,a.sqlite3_js_rc_str(m),"SQL =",a.sqlite3_sql(this.pointer)),g.checkRc(this.db.pointer,m)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const m=this.step();return this.reset(),m}finally{try{this.finalize()}catch{}}},get:function(m,N){if(K(this)._mayGet||l("Stmt.step() has not (recently) returned true."),Array.isArray(m)){let h=0;const f=this.columnCount;for(;h<f;)m[h]=this.get(h++);return m}else if(m&&typeof m=="object"){let h=0;const f=this.columnCount;for(;h<f;)m[a.sqlite3_column_name(this.pointer,h)]=this.get(h++);return m}switch(b(this,m),N===void 0?a.sqlite3_column_type(this.pointer,m):N){case a.SQLITE_NULL:return null;case a.SQLITE_INTEGER:if(c.bigIntEnabled){const h=a.sqlite3_column_int64(this.pointer,m);return h>=Number.MIN_SAFE_INTEGER&&h<=Number.MAX_SAFE_INTEGER?Number(h).valueOf():h}else{const h=a.sqlite3_column_double(this.pointer,m);return(h>Number.MAX_SAFE_INTEGER||h<Number.MIN_SAFE_INTEGER)&&l("Integer is out of range for JS integer range: "+h),d.isInt32(h)?h|0:h}case a.SQLITE_FLOAT:return a.sqlite3_column_double(this.pointer,m);case a.SQLITE_TEXT:return a.sqlite3_column_text(this.pointer,m);case a.SQLITE_BLOB:{const h=a.sqlite3_column_bytes(this.pointer,m),f=a.sqlite3_column_blob(this.pointer,m),q=new Uint8Array(h);return h&&q.set(c.heap8u().slice(f,f+h),0),h&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(q.buffer),q}default:l("Don't know how to translate","type of result column #"+m+".")}l("Not reached.")},getInt:function(m){return this.get(m,a.SQLITE_INTEGER)},getFloat:function(m){return this.get(m,a.SQLITE_FLOAT)},getString:function(m){return this.get(m,a.SQLITE_TEXT)},getBlob:function(m){return this.get(m,a.SQLITE_BLOB)},getJSON:function(m){const N=this.get(m,a.SQLITE_STRING);return N===null?N:JSON.parse(N)},getColumnName:function(m){return a.sqlite3_column_name(b(K(this),m).pointer,m)},getColumnNames:function(m=[]){b(K(this),0);const N=this.columnCount;for(let h=0;h<N;++h)m.push(a.sqlite3_column_name(this.pointer,h));return m},getParamIndex:function(m){return K(this).parameterCount?a.sqlite3_bind_parameter_index(this.pointer,m):void 0}};{const m={enumerable:!0,get:function(){return w.get(this)},set:()=>l("The pointer property is read-only.")};Object.defineProperty(v.prototype,"pointer",m),Object.defineProperty(g.prototype,"pointer",m)}if(Object.defineProperty(v.prototype,"columnCount",{enumerable:!1,get:function(){return a.sqlite3_column_count(this.pointer)},set:()=>l("The columnCount property is read-only.")}),i.oo1={DB:g,Stmt:v},d.isUIThread()){i.oo1.JsStorageDb=function(N="session"){N!=="session"&&N!=="local"&&l("JsStorageDb db name must be one of 'session' or 'local'."),T.call(this,{filename:N,flags:"c",vfs:"kvvfs"})};const m=i.oo1.JsStorageDb;m.prototype=Object.create(g.prototype),m.clearStorage=a.sqlite3_js_kvvfs_clear,m.prototype.clearStorage=function(){return m.clearStorage(S(this).filename)},m.storageSize=a.sqlite3_js_kvvfs_size,m.prototype.storageSize=function(){return m.storageSize(S(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.initWorker1API=function(){const l=(...g)=>{throw new Error(g.join(" "))};globalThis.WorkerGlobalScope instanceof Function||l("initWorker1API() must be run from a Worker thread."),this.self;const a=this.sqlite3||l("Missing this.sqlite3 object."),c=a.oo1.DB,d=function(g){let y=w.idMap.get(g);return y||(y="db#"+ ++w.idSeq+"@"+g.pointer,w.idMap.set(g,y),y)},w={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(g){const y=new c(g);return this.dbs[d(y)]=y,this.dbList.indexOf(y)<0&&this.dbList.push(y),y},close:function(g,y){if(g){delete this.dbs[d(g)];const v=g.filename,S=a.wasm.sqlite3_wasm_db_vfs(g.pointer,0);g.close();const b=this.dbList.indexOf(g);b>=0&&this.dbList.splice(b,1),y&&v&&S&&a.wasm.sqlite3_wasm_vfs_unlink(S,v)}},post:function(g,y){y&&y.length?(globalThis.postMessage(g,Array.from(y)),y.length=0):globalThis.postMessage(g)},dbs:Object.create(null),getDb:function(g,y=!0){return this.dbs[g]||(y?l("Unknown (or closed) DB ID:",g):void 0)}},k=function(g=w.dbList[0]){return g&&g.pointer?g:l("DB is not opened.")},L=function(g,y=!0){const v=w.getDb(g.dbId,!1)||w.dbList[0];return y?k(v):v},J=function(){return w.dbList[0]&&d(w.dbList[0])},ee=function(g){const y=/^file:.+(vfs=(\w+))/.exec(g);return a.capi.sqlite3_vfs_find(y?y[2]:0)},se=g=>g===""||g[0]===":",T={open:function(g){const y=Object.create(null),v=g.args||Object.create(null);v.simulateError&&l("Throwing because of simulateError flag.");const S=Object.create(null);let b,Q;if(y.vfs=v.vfs,se(v.filename)?y.filename=v.filename||"":(y.filename=v.filename,b=v.byteArray,b&&(Q=ee(v.filename))),Q){let D;try{D=a.wasm.allocFromTypedArray(b);const K=a.wasm.sqlite3_wasm_vfs_create_file(Q,y.filename,D,b.byteLength);K&&a.SQLite3Error.toss(K)}catch(K){throw new a.SQLite3Error(K.name+" creating "+v.filename+": "+K.message,{cause:K})}finally{D&&a.wasm.dealloc(D)}}const V=w.open(y);return S.filename=V.filename,S.persistent=!!a.capi.sqlite3_js_db_uses_vfs(V.pointer,"opfs"),S.dbId=d(V),S.vfs=V.dbVfsName(),S},close:function(g){const y=L(g,!1),v={filename:y&&y.filename};if(y){const S=g.args&&typeof g.args=="object"?!!g.args.unlink:!1;w.close(y,S)}return v},exec:function(g){const y=typeof g.args=="string"?{sql:g.args}:g.args||Object.create(null);y.rowMode==="stmt"?l("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):y.sql||l("'exec' requires input SQL.");const v=L(g);(y.callback||Array.isArray(y.resultRows))&&(v._blobXfer=w.xfer);const S=y.callback;let b=0;const Q=!!y.columnNames;typeof S=="string"&&(Q||(y.columnNames=[]),y.callback=function(V,D){w.post({type:S,columnNames:y.columnNames,rowNumber:++b,row:V},w.xfer)});try{const V=y.countChanges?v.changes(!0,y.countChanges===64):void 0;v.exec(y),V!==void 0&&(y.changeCount=v.changes(!0,y.countChanges===64)-V),y.callback instanceof Function&&(y.callback=S,w.post({type:S,columnNames:y.columnNames,rowNumber:null,row:void 0}))}finally{delete v._blobXfer,y.callback&&(y.callback=S)}return y},"config-get":function(){const g=Object.create(null),y=a.config;return["bigIntEnabled"].forEach(function(v){Object.getOwnPropertyDescriptor(y,v)&&(g[v]=y[v])}),g.version=a.version,g.vfsList=a.capi.sqlite3_js_vfs_list(),g.opfsEnabled=!!a.opfs,g},export:function(g){const y=L(g),v={byteArray:a.capi.sqlite3_js_db_export(y.pointer),filename:y.filename,mimetype:"application/x-sqlite3"};return w.xfer.push(v.byteArray.buffer),v},toss:function(g){l("Testing worker exception")},"opfs-tree":async function(g){return a.opfs||l("OPFS support is unavailable."),await a.opfs.treeList()}};globalThis.onmessage=async function(g){g=g.data;let y,v=g.dbId,S=g.type;const b=performance.now();try{T.hasOwnProperty(S)&&T[S]instanceof Function?y=await T[S](g):l("Unknown db worker message type:",g.type)}catch(Q){S="error",y={operation:g.type,message:Q.message,errorClass:Q.name,input:g},Q.stack&&(y.stack=typeof Q.stack=="string"?Q.stack.split(/\n\s*/):Q.stack)}v||(v=y.dbId||J()),w.post({type:S,dbId:v,messageId:g.messageId,workerReceivedTime:b,workerRespondTime:performance.now(),departureTime:g.departureTime,result:y},w.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}.bind({self,sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=i.wasm,a=i.capi,c=i.util.toss3,d=Object.create(null),w=Object.create(null),k=i.StructBinder;i.vfs=d,i.vtab=w;const L=a.sqlite3_index_info;L.prototype.nthConstraint=function(g,y=!1){if(g<0||g>=this.$nConstraint)return!1;const v=this.$aConstraint+L.sqlite3_index_constraint.structInfo.sizeof*g;return y?v:new L.sqlite3_index_constraint(v)},L.prototype.nthConstraintUsage=function(g,y=!1){if(g<0||g>=this.$nConstraint)return!1;const v=this.$aConstraintUsage+L.sqlite3_index_constraint_usage.structInfo.sizeof*g;return y?v:new L.sqlite3_index_constraint_usage(v)},L.prototype.nthOrderBy=function(g,y=!1){if(g<0||g>=this.$nOrderBy)return!1;const v=this.$aOrderBy+L.sqlite3_index_orderby.structInfo.sizeof*g;return y?v:new L.sqlite3_index_orderby(v)};const J=function g(y,v,S,b=g.installMethodArgcCheck){if(y instanceof k.StructType?!(S instanceof Function)&&!l.isPtr(S)&&c("Usage errror: expecting a Function or WASM pointer to one."):c("Usage error: target object is-not-a StructType."),arguments.length===1)return(K,le)=>g(y,K,le,b);g.argcProxy||(g.argcProxy=function(K,le,_,E){return function(...I){return _.length!==arguments.length&&c("Argument mismatch for",K.structInfo.name+"::"+le+": Native signature is:",E),_.apply(this,I)}},g.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((K,le)=>{if(typeof K=="number")try{l.uninstallFunction(K)}catch{}}),delete this.ondispose.__removeFuncList)});const Q=y.memberSignature(v);Q.length<2&&c("Member",v,"does not have a function pointer signature:",Q);const V=y.memberKey(v),D=b&&!l.isPtr(S)?g.argcProxy(y,V,S,Q):S;if(l.isPtr(D))D&&!l.functionEntry(D)&&c("Pointer",D,"is not a WASM function table entry."),y[V]=D;else{const K=l.installFunction(D,y.memberSignature(v,!0));y[V]=K,(!y.ondispose||!y.ondispose.__removeFuncList)&&(y.addOnDispose("ondispose.__removeFuncList handler",g.removeFuncList),y.ondispose.__removeFuncList=[]),y.ondispose.__removeFuncList.push(V,K)}return(K,le)=>g(y,K,le,b)};J.installMethodArgcCheck=!1;const ee=function(g,y,v=J.installMethodArgcCheck){const S=new Map;for(const b of Object.keys(y)){const Q=y[b],V=S.get(Q);if(V){const D=g.memberKey(b);g[D]=g[g.memberKey(V)]}else J(g,b,Q,v),S.set(Q,b)}return g};k.StructType.prototype.installMethod=function(y,v,S=J.installMethodArgcCheck){return arguments.length<3&&y&&typeof y=="object"?ee(this,...arguments):J(this,...arguments)},k.StructType.prototype.installMethods=function(g,y=J.installMethodArgcCheck){return ee(this,g,y)},a.sqlite3_vfs.prototype.registerVfs=function(g=!1){this instanceof i.capi.sqlite3_vfs||c("Expecting a sqlite3_vfs-type argument.");const y=a.sqlite3_vfs_register(this,g?1:0);return y&&c("sqlite3_vfs_register(",this,") failed with rc",y),this.pointer!==a.sqlite3_vfs_find(this.$zName)&&c("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},d.installVfs=function(g){let y=0;const v=["io","vfs"];for(const S of v){const b=g[S];b&&(++y,ee(b.struct,b.methods,!!b.applyArgcCheck),S==="vfs"&&(!b.struct.$zName&&typeof b.name=="string"&&b.struct.addOnDispose(b.struct.$zName=l.allocCString(b.name)),b.struct.registerVfs(!!b.asDefault)))}return y||c("Misuse: installVfs() options object requires at least","one of:",v),this};const se=function(g,y){return function(v,S=!1){if(arguments.length===0&&(v=new y),v instanceof y)return this.set(v.pointer,v),v;l.isPtr(v)||i.SQLite3Error.toss("Invalid argument to",g+"()");let b=this.get(v);return S&&this.delete(v),b}.bind(new Map)},T=function(g,y){const v=se(g,y);return Object.assign(Object.create(null),{StructType:y,create:S=>{const b=v();return l.pokePtr(S,b.pointer),b},get:S=>v(S),unget:S=>v(S,!0),dispose:S=>{const b=v(S,!0);b&&b.dispose()}})};w.xVtab=T("xVtab",a.sqlite3_vtab),w.xCursor=T("xCursor",a.sqlite3_vtab_cursor),w.xIndexInfo=g=>new a.sqlite3_index_info(g),w.xError=function g(y,v,S){if(g.errorReporter instanceof Function)try{g.errorReporter("sqlite3_module::"+y+"(): "+v.message)}catch{}let b;return v instanceof i.WasmAllocError?b=a.SQLITE_NOMEM:arguments.length>2?b=S:v instanceof i.SQLite3Error&&(b=v.resultCode),b||a.SQLITE_ERROR},w.xError.errorReporter=console.error.bind(console),w.xRowid=(g,y)=>l.poke(g,y,"i64"),w.setupModule=function(g){let y=!1;const v=this instanceof a.sqlite3_module?this:g.struct||(y=new a.sqlite3_module);try{const S=g.methods||c("Missing 'methods' object.");for(const b of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const Q=b[0],V=b[1];S[Q]===!0?S[Q]=S[V]:S[V]===!0&&(S[V]=S[Q])}if(g.catchExceptions){const b=function(D,K){return["xConnect","xCreate"].indexOf(D)>=0?function(le,_,E,I,z,m){try{return K(...arguments)||0}catch(N){return N instanceof i.WasmAllocError||(l.dealloc(l.peekPtr(m)),l.pokePtr(m,l.allocCString(N.message))),w.xError(D,N)}}:function(...le){try{return K(...le)||0}catch(_){return w.xError(D,_)}}},Q=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],V=Object.create(null);for(const D of Q){const K=S[D];if(K instanceof Function)D==="xConnect"&&S.xCreate===K?V[D]=S.xCreate:D==="xCreate"&&S.xConnect===K?V[D]=S.xConnect:V[D]=b(D,K);else continue}ee(v,V,!1)}else ee(v,S,!!g.applyArgcCheck);if(v.$iVersion===0){let b;typeof g.iVersion=="number"?b=g.iVersion:v.$xShadowName?b=3:v.$xSavePoint||v.$xRelease||v.$xRollbackTo?b=2:b=1,v.$iVersion=b}}catch(S){throw y&&y.dispose(),S}return v},a.sqlite3_module.prototype.setupModule=function(g){return w.setupModule.call(this,g)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=function a(c){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!c||typeof c!="object")&&(c=Object.create(null));const d=new URL(globalThis.location.href).searchParams;return d.has("opfs-disable")?Promise.resolve(i):(c.verbose===void 0&&(c.verbose=d.has("opfs-verbose")?+d.get("opfs-verbose")||2:1),c.sanityChecks===void 0&&(c.sanityChecks=d.has("opfs-sanity-check")),c.proxyUri===void 0&&(c.proxyUri=a.defaultProxyUri),typeof c.proxyUri=="function"&&(c.proxyUri=c.proxyUri()),new Promise(function(k,L){const J=[i.config.error,i.config.warn,i.config.log],ee=(F,...M)=>{c.verbose>F&&J[F]("OPFS syncer:",...M)},se=(...F)=>ee(2,...F),T=(...F)=>ee(1,...F),g=(...F)=>ee(0,...F),y=i.util.toss,v=i.capi,S=i.wasm,b=v.sqlite3_vfs,Q=v.sqlite3_file,V=v.sqlite3_io_methods,D=Object.create(null),K=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;D.metrics={dump:function(){let F,M=0,j=0,re=0;for(F in f.opIds){const Y=q[F];M+=Y.count,j+=Y.time,re+=Y.wait,Y.avgTime=Y.count&&Y.time?Y.time/Y.count:0,Y.avgWait=Y.count&&Y.wait?Y.wait/Y.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",q,`
Total of`,M,"op(s) for",j,"ms (incl. "+re+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",q.s11n),m.postMessage({type:"opfs-async-metrics"})},reset:function(){let F;const M=re=>re.count=re.time=re.wait=0;for(F in f.opIds)M(q[F]=Object.create(null));let j=q.s11n=Object.create(null);j=j.serialize=Object.create(null),j.count=j.time=0,j=q.s11n.deserialize=Object.create(null),j.count=j.time=0}};const le=new V,_=new b().addOnDispose(()=>le.dispose());let E;const I=F=>(E=!0,_.dispose(),L(F)),z=()=>(E=!1,k(i)),m=new Worker(new URL(""+new URL("sqlite3-opfs-async-proxy-oRRWdEq1.js",import.meta.url).href,import.meta.url));setTimeout(()=>{E===void 0&&I(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),m._originalOnError=m.onerror,m.onerror=function(F){g("Error initializing OPFS asyncer:",F),I(new Error("Loading OPFS async Worker failed for unknown reasons."))};const N=v.sqlite3_vfs_find(null),h=N?new b(N):null;le.$iVersion=1,_.$iVersion=2,_.$szOsFile=v.sqlite3_file.structInfo.sizeof,_.$mxPathname=1024,_.$zName=S.allocCString("opfs"),_.$xDlOpen=_.$xDlError=_.$xDlSym=_.$xDlClose=null,_.addOnDispose("$zName",_.$zName,"cleanup default VFS wrapper",()=>h?h.dispose():null);const f=Object.create(null);f.verbose=c.verbose,f.littleEndian=(()=>{const F=new ArrayBuffer(2);return new DataView(F).setInt16(0,256,!0),new Int16Array(F)[0]===256})(),f.asyncIdleWaitTime=150,f.asyncS11nExceptions=1,f.fileBufferSize=1024*64,f.sabS11nOffset=f.fileBufferSize,f.sabS11nSize=_.$mxPathname*2,f.sabIO=new SharedArrayBuffer(f.fileBufferSize+f.sabS11nSize),f.opIds=Object.create(null);const q=Object.create(null);{let F=0;f.opIds.whichOp=F++,f.opIds.rc=F++,f.opIds.xAccess=F++,f.opIds.xClose=F++,f.opIds.xDelete=F++,f.opIds.xDeleteNoWait=F++,f.opIds.xFileSize=F++,f.opIds.xLock=F++,f.opIds.xOpen=F++,f.opIds.xRead=F++,f.opIds.xSleep=F++,f.opIds.xSync=F++,f.opIds.xTruncate=F++,f.opIds.xUnlock=F++,f.opIds.xWrite=F++,f.opIds.mkdir=F++,f.opIds["opfs-async-metrics"]=F++,f.opIds["opfs-async-shutdown"]=F++,f.opIds.retry=F++,f.sabOP=new SharedArrayBuffer(F*4),D.metrics.reset()}f.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(F=>{(f.sq3Codes[F]=v[F])===void 0&&y("Maintenance required: not found:",F)}),f.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,defaultUnlockAsap:!1});const P=(F,...M)=>{const j=f.opIds[F]||y("Invalid op ID:",F);f.s11n.serialize(...M),Atomics.store(f.sabOPView,f.opIds.rc,-1),Atomics.store(f.sabOPView,f.opIds.whichOp,j),Atomics.notify(f.sabOPView,f.opIds.whichOp);const re=performance.now();Atomics.wait(f.sabOPView,f.opIds.rc,-1);const Y=Atomics.load(f.sabOPView,f.opIds.rc);if(q[F].wait+=performance.now()-re,Y&&f.asyncS11nExceptions){const he=f.s11n.deserialize();he&&g(F+"() async error:",...he)}return Y};D.debug={asyncShutdown:()=>{T("Shutting down OPFS async listener. The OPFS VFS will no longer work."),P("opfs-async-shutdown")},asyncRestart:()=>{T("Attempting to restart OPFS VFS async listener. Might work, might not."),m.postMessage({type:"opfs-async-restart"})}};const X=()=>{if(f.s11n)return f.s11n;const F=new TextDecoder,M=new TextEncoder("utf-8"),j=new Uint8Array(f.sabIO,f.sabS11nOffset,f.sabS11nSize),re=new DataView(f.sabIO,f.sabS11nOffset,f.sabS11nSize);f.s11n=Object.create(null);const Y=Object.create(null);Y.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Y.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Y.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Y.string={id:4};const he=Z=>Y[typeof Z]||y("Maintenance required: this value type cannot be serialized.",Z),Fe=Z=>{switch(Z){case Y.number.id:return Y.number;case Y.bigint.id:return Y.bigint;case Y.boolean.id:return Y.boolean;case Y.string.id:return Y.string;default:y("Invalid type ID:",Z)}};return f.s11n.deserialize=function(Z=!1){++q.s11n.deserialize.count;const ne=performance.now(),O=j[0],W=O?[]:null;if(O){const x=[];let C=1,R,$,de;for(R=0;R<O;++R,++C)x.push(Fe(j[C]));for(R=0;R<O;++R){const ge=x[R];ge.getter?(de=re[ge.getter](C,f.littleEndian),C+=ge.size):($=re.getInt32(C,f.littleEndian),C+=4,de=F.decode(j.slice(C,C+$)),C+=$),W.push(de)}}return Z&&(j[0]=0),q.s11n.deserialize.time+=performance.now()-ne,W},f.s11n.serialize=function(...Z){const ne=performance.now();if(++q.s11n.serialize.count,Z.length){const O=[];let W=0,x=1;for(j[0]=Z.length&255;W<Z.length;++W,++x)O.push(he(Z[W])),j[x]=O[W].id;for(W=0;W<Z.length;++W){const C=O[W];if(C.setter)re[C.setter](x,Z[W],f.littleEndian),x+=C.size;else{const R=M.encode(Z[W]);re.setInt32(x,R.byteLength,f.littleEndian),x+=4,j.set(R,x),x+=R.byteLength}}}else j[0]=0;q.s11n.serialize.time+=performance.now()-ne},f.s11n},ie=function F(M=16){F._chars||(F._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",F._n=F._chars.length);const j=[];let re=0;for(;re<M;++re){const Y=Math.random()*(F._n*64)%F._n|0;j[re]=F._chars[Y]}return j.join("")},oe=Object.create(null),ce=Object.create(null);ce.op=void 0,ce.start=void 0;const ae=F=>{ce.start=performance.now(),ce.op=F,++q[F].count},ue=()=>q[ce.op].time+=performance.now()-ce.start,be={xCheckReservedLock:function(F,M){const j=oe[F];return S.poke(M,j.lockType?1:0,"i32"),0},xClose:function(F){ae("xClose");let M=0;const j=oe[F];return j&&(delete oe[F],M=P("xClose",F),j.sq3File&&j.sq3File.dispose()),ue(),M},xDeviceCharacteristics:function(F){return v.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(F,M,j){return v.SQLITE_NOTFOUND},xFileSize:function(F,M){ae("xFileSize");let j=P("xFileSize",F);if(j==0)try{const re=f.s11n.deserialize()[0];S.poke(M,re,"i64")}catch(re){g("Unexpected error reading xFileSize() result:",re),j=f.sq3Codes.SQLITE_IOERR}return ue(),j},xLock:function(F,M){ae("xLock");const j=oe[F];let re=0;return j.lockType?j.lockType=M:(re=P("xLock",F,M),re===0&&(j.lockType=M)),ue(),re},xRead:function(F,M,j,re){ae("xRead");const Y=oe[F];let he;try{he=P("xRead",F,j,Number(re)),(he===0||v.SQLITE_IOERR_SHORT_READ===he)&&S.heap8u().set(Y.sabView.subarray(0,j),M)}catch(Fe){g("xRead(",arguments,") failed:",Fe,Y),he=v.SQLITE_IOERR_READ}return ue(),he},xSync:function(F,M){ae("xSync"),++q.xSync.count;const j=P("xSync",F,M);return ue(),j},xTruncate:function(F,M){ae("xTruncate");const j=P("xTruncate",F,Number(M));return ue(),j},xUnlock:function(F,M){ae("xUnlock");const j=oe[F];let re=0;return v.SQLITE_LOCK_NONE===M&&j.lockType&&(re=P("xUnlock",F,M)),re===0&&(j.lockType=M),ue(),re},xWrite:function(F,M,j,re){ae("xWrite");const Y=oe[F];let he;try{Y.sabView.set(S.heap8u().subarray(M,M+j)),he=P("xWrite",F,j,Number(re))}catch(Fe){g("xWrite(",arguments,") failed:",Fe,Y),he=v.SQLITE_IOERR_WRITE}return ue(),he}},qe={xAccess:function(F,M,j,re){ae("xAccess");const Y=P("xAccess",S.cstrToJs(M));return S.poke(re,Y?0:1,"i32"),ue(),0},xCurrentTime:function(F,M){return S.poke(M,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(F,M){return S.poke(M,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(F,M,j){ae("xDelete");const re=P("xDelete",S.cstrToJs(M),j,!1);return ue(),re},xFullPathname:function(F,M,j,re){return S.cstrncpy(re,M,j)<j?0:v.SQLITE_CANTOPEN},xGetLastError:function(F,M,j){return T("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(M,j,re,Y,he){ae("xOpen");let Fe=0;j===0?j=ie():typeof j=="number"&&(v.sqlite3_uri_boolean(j,"opfs-unlock-asap",0)&&(Fe|=f.opfsFlags.OPFS_UNLOCK_ASAP),j=S.cstrToJs(j));const Z=Object.create(null);Z.fid=re,Z.filename=j,Z.sab=new SharedArrayBuffer(f.fileBufferSize),Z.flags=Y;const ne=P("xOpen",re,j,Y,Fe);return ne||(Z.readOnly&&S.poke(he,v.SQLITE_OPEN_READONLY,"i32"),oe[re]=Z,Z.sabView=f.sabFileBufView,Z.sq3File=new Q(re),Z.sq3File.$pMethods=le.pointer,Z.lockType=v.SQLITE_LOCK_NONE),ue(),ne}};if(h&&(_.$xRandomness=h.$xRandomness,_.$xSleep=h.$xSleep),_.$xRandomness||(qe.xRandomness=function(F,M,j){const re=S.heap8u();let Y=0;for(;Y<M;++Y)re[j+Y]=Math.random()*255e3&255;return Y}),_.$xSleep||(qe.xSleep=function(F,M){return Atomics.wait(f.sabOPView,f.opIds.xSleep,0,M),0}),D.getResolvedPath=function(F,M){const j=new URL(F,"file://irrelevant").pathname;return M?j.split("/").filter(re=>!!re):j},D.getDirForFilename=async function(M,j=!1){const re=D.getResolvedPath(M,!0),Y=re.pop();let he=D.rootDirectory;for(const Fe of re)Fe&&(he=await he.getDirectoryHandle(Fe,{create:!!j}));return[he,Y]},D.mkdir=async function(F){try{return await D.getDirForFilename(F+"/filepart",!0),!0}catch{return!1}},D.entryExists=async function(F){try{const[M,j]=await D.getDirForFilename(F);return await M.getFileHandle(j),!0}catch{return!1}},D.randomFilename=ie,D.registerVfs=(F=!1)=>S.exports.sqlite3_vfs_register(_.pointer,F?1:0),D.treeList=async function(){const F=async function j(re,Y){Y.name=re.name,Y.dirs=[],Y.files=[];for await(const he of re.values())if(he.kind==="directory"){const Fe=Object.create(null);Y.dirs.push(Fe),await j(he,Fe)}else Y.files.push(he.name)},M=Object.create(null);return await F(D.rootDirectory,M),M},D.rmfr=async function(){const F=D.rootDirectory,M={recurse:!0};for await(const j of F.values())F.removeEntry(j.name,M)},D.unlink=async function(F,M=!1,j=!1){try{const[re,Y]=await D.getDirForFilename(F,!1);return await re.removeEntry(Y,{recursive:M}),!0}catch(re){if(j)throw new Error("unlink(",arguments[0],") failed: "+re.message,{cause:re});return!1}},D.traverse=async function(F){const M={recursive:!0,directory:D.rootDirectory};typeof F=="function"&&(F={callback:F}),F=Object.assign(M,F||{}),async function re(Y,he){for await(const Fe of Y.values()){if(F.callback(Fe,Y,he)===!1)return!1;if(F.recursive&&Fe.kind==="directory"&&await re(Fe,he+1)===!1)break}}(F.directory,0)},D.importDb=async function(F,M){M instanceof ArrayBuffer&&(M=new Uint8Array(M));const j=M.byteLength;(j<512||j%512!=0)&&y("Byte array size is invalid for an SQLite db.");const re="SQLite format 3";for(let Z=0;Z<re.length;++Z)re.charCodeAt(Z)!==M[Z]&&y("Input does not contain an SQLite database header.");let Y;const[he,Fe]=await D.getDirForFilename(F,!0);try{Y=await(await he.getFileHandle(Fe,{create:!0})).createSyncAccessHandle(),Y.truncate(0);const ne=Y.write(M,{at:0});return ne!=j&&y("Expected to write "+j+" bytes but wrote "+ne+"."),Y.write(new Uint8Array([1,1]),{at:18}),ne}catch(Z){throw Y&&(await Y.close(),Y=void 0),await he.removeEntry(Fe).catch(()=>{}),Z}finally{Y&&await Y.close()}},i.oo1){const F=function(...M){const j=i.oo1.DB.dbCtorHelper.normalizeArgs(...M);j.vfs=_.$zName,i.oo1.DB.dbCtorHelper.call(this,j)};F.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=F,F.importDb=D.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenSql(_.pointer,function(M,j){j.capi.sqlite3_busy_timeout(M,1e4),j.capi.sqlite3_exec(M,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}const rt=function(){const F=S.scopedAllocPush(),M=new Q;try{const j=M.pointer,re=v.SQLITE_OPEN_CREATE|v.SQLITE_OPEN_READWRITE|v.SQLITE_OPEN_MAIN_DB,Y=S.scopedAlloc(8),he="/sanity/check/file"+ie(8),Fe=S.scopedAllocCString(he);let Z;if(f.s11n.serialize("This is ä string."),Z=f.s11n.deserialize(),se("deserialize() says:",Z),Z[0]!=="This is ä string."&&y("String d13n error."),qe.xAccess(_.pointer,Fe,0,Y),Z=S.peek(Y,"i32"),se("xAccess(",he,") exists ?=",Z),Z=qe.xOpen(_.pointer,Fe,j,re,Y),se("open rc =",Z,"state.sabOPView[xOpen] =",f.sabOPView[f.opIds.xOpen]),Z!==0){g("open failed with code",Z);return}qe.xAccess(_.pointer,Fe,0,Y),Z=S.peek(Y,"i32"),Z||y("xAccess() failed to detect file."),Z=be.xSync(M.pointer,0),Z&&y("sync failed w/ rc",Z),Z=be.xTruncate(M.pointer,1024),Z&&y("truncate failed w/ rc",Z),S.poke(Y,0,"i64"),Z=be.xFileSize(M.pointer,Y),Z&&y("xFileSize failed w/ rc",Z),se("xFileSize says:",S.peek(Y,"i64")),Z=be.xWrite(M.pointer,Fe,10,1),Z&&y("xWrite() failed!");const ne=S.scopedAlloc(16);Z=be.xRead(M.pointer,ne,6,2),S.poke(ne+6,0);let O=S.cstrToJs(ne);se("xRead() got:",O),O!=="sanity"&&y("Unexpected xRead() value."),qe.xSleep&&(se("xSleep()ing before close()ing..."),qe.xSleep(_.pointer,2e3),se("waking up from xSleep()")),Z=be.xClose(j),se("xClose rc =",Z,"sabOPView =",f.sabOPView),se("Deleting file:",he),qe.xDelete(_.pointer,Fe,4660),qe.xAccess(_.pointer,Fe,0,Y),Z=S.peek(Y,"i32"),Z&&y("Expecting 0 from xAccess(",he,") after xDelete()."),T("End of OPFS sanity checks.")}finally{M.dispose(),S.scopedAllocPop(F)}};m.onmessage=function({data:F}){switch(F.type){case"opfs-unavailable":I(new Error(F.payload.join(" ")));break;case"opfs-async-loaded":m.postMessage({type:"opfs-async-init",args:f});break;case"opfs-async-inited":{if(E===!0)break;try{i.vfs.installVfs({io:{struct:le,methods:be},vfs:{struct:_,methods:qe}}),f.sabOPView=new Int32Array(f.sabOP),f.sabFileBufView=new Uint8Array(f.sabIO,0,f.fileBufferSize),f.sabS11nView=new Uint8Array(f.sabIO,f.sabS11nOffset,f.sabS11nSize),X(),c.sanityChecks&&(T("Running sanity checks because of opfs-sanity-check URL arg..."),rt()),K()?navigator.storage.getDirectory().then(M=>{m.onerror=m._originalOnError,delete m._originalOnError,i.opfs=D,D.rootDirectory=M,se("End of OPFS sqlite3_vfs setup.",_),z()}).catch(I):z()}catch(M){g(M),I(M)}break}default:{const M="Unexpected message from the OPFS async worker: "+JSON.stringify(F);g(M),I(new Error(M));break}}}}))};l.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async a=>{try{let c=l.defaultProxyUri;return a.scriptInfo.sqlite3Dir&&(l.defaultProxyUri=a.scriptInfo.sqlite3Dir+c),l().catch(d=>{a.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",d.message)})}catch(c){return a.config.error("installOpfsVfs() exception:",c),Promise.reject(c)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){var ce,ae,ue,be,qe,rt,F,M,j,re,Y,he,Vi,Z;const l=i.util.toss,a=i.util.toss3,c=Object.create(null),d=i.capi,w=i.wasm,k=4096,L=512,J=4,ee=8,se=L+J,T=L,g=se,y=k,v=d.SQLITE_OPEN_MAIN_DB|d.SQLITE_OPEN_MAIN_JOURNAL|d.SQLITE_OPEN_SUPER_JOURNAL|d.SQLITE_OPEN_WAL,S=".opaque",b=()=>Math.random().toString(36).slice(2),Q=new TextDecoder,V=new TextEncoder,D=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),K=[i.config.error,i.config.warn,i.config.log];i.config.log;const le=i.config.warn;i.config.error;const _=new Map,E=ne=>_.get(ne),I=(ne,O)=>{O?_.set(ne,O):_.delete(ne)},z=new Map,m=ne=>z.get(ne),N=(ne,O)=>{O?z.set(ne,O):z.delete(ne)},h={xCheckReservedLock:function(ne,O){const W=m(ne);return W.log("xCheckReservedLock"),W.storeErr(),w.poke32(O,1),0},xClose:function(ne){const O=m(ne);O.storeErr();const W=O.getOFileForS3File(ne);if(W)try{O.log(`xClose ${W.path}`),O.mapS3FileToOFile(ne,!1),W.sah.flush(),W.flags&d.SQLITE_OPEN_DELETEONCLOSE&&O.deletePath(W.path)}catch(x){return O.storeErr(x),d.SQLITE_IOERR}return 0},xDeviceCharacteristics:function(ne){return d.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(ne,O,W){return d.SQLITE_NOTFOUND},xFileSize:function(ne,O){const W=m(ne);W.log("xFileSize");const C=W.getOFileForS3File(ne).sah.getSize()-y;return w.poke64(O,BigInt(C)),0},xLock:function(ne,O){const W=m(ne);W.log(`xLock ${O}`),W.storeErr();const x=W.getOFileForS3File(ne);return x.lockType=O,0},xRead:function(ne,O,W,x){const C=m(ne);C.storeErr();const R=C.getOFileForS3File(ne);C.log(`xRead ${R.path} ${W} @ ${x}`);try{const $=R.sah.read(w.heap8u().subarray(O,O+W),{at:y+Number(x)});return $<W?(w.heap8u().fill(0,O+$,O+W),d.SQLITE_IOERR_SHORT_READ):0}catch($){return C.storeErr($),d.SQLITE_IOERR}},xSectorSize:function(ne){return k},xSync:function(ne,O){const W=m(ne);W.log(`xSync ${O}`),W.storeErr();const x=W.getOFileForS3File(ne);try{return x.sah.flush(),0}catch(C){return W.storeErr(C),d.SQLITE_IOERR}},xTruncate:function(ne,O){const W=m(ne);W.log(`xTruncate ${O}`),W.storeErr();const x=W.getOFileForS3File(ne);try{return x.sah.truncate(y+Number(O)),0}catch(C){return W.storeErr(C),d.SQLITE_IOERR}},xUnlock:function(ne,O){const W=m(ne);W.log("xUnlock");const x=W.getOFileForS3File(ne);return x.lockType=O,0},xWrite:function(ne,O,W,x){const C=m(ne);C.storeErr();const R=C.getOFileForS3File(ne);C.log(`xWrite ${R.path} ${W} ${x}`);try{return R.sah.write(w.heap8u().subarray(O,O+W),{at:y+Number(x)})===W?0:d.SQLITE_IOERR}catch($){return C.storeErr($),d.SQLITE_IOERR}}},f=new d.sqlite3_io_methods;f.$iVersion=1,i.vfs.installVfs({io:{struct:f,methods:h}});const q={xAccess:function(ne,O,W,x){const C=E(ne);C.storeErr();try{const R=C.getPath(O);w.poke32(x,C.hasFilename(R)?1:0)}catch{w.poke32(x,0)}return 0},xCurrentTime:function(ne,O){return w.poke(O,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(ne,O){return w.poke(O,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(ne,O,W){const x=E(ne);x.log(`xDelete ${w.cstrToJs(O)}`),x.storeErr();try{return x.deletePath(x.getPath(O)),0}catch(C){return x.storeErr(C),d.SQLITE_IOERR_DELETE}},xFullPathname:function(ne,O,W,x){return w.cstrncpy(x,O,W)<W?0:d.SQLITE_CANTOPEN},xGetLastError:function(ne,O,W){const x=E(ne);x.log(`xGetLastError ${O}`);const C=x.popErr();if(C){const R=w.scopedAllocPush();try{const[$,de]=w.scopedAllocCString(C.message,!0);w.cstrncpy(W,$,O),de>O&&w.poke8(W+O-1,0)}catch{return d.SQLITE_NOMEM}finally{w.scopedAllocPop(R)}}return 0},xOpen:function(O,W,x,C,R){const $=E(O);try{$.log(`xOpen ${w.cstrToJs(W)} ${C}`);const de=W&&w.peek8(W)?$.getPath(W):b();let ge=$.getSAHForPath(de);!ge&&C&d.SQLITE_OPEN_CREATE&&($.getFileCount()<$.getCapacity()?(ge=$.nextAvailableSAH(),$.setAssociatedPath(ge,de,C)):l("SAH pool is full. Cannot create file",de)),ge||l("file not found:",de);const Re={path:de,flags:C,sah:ge};$.mapS3FileToOFile(x,Re),Re.lockType=d.SQLITE_LOCK_NONE;const Ue=new d.sqlite3_file(x);return Ue.$pMethods=f.pointer,Ue.dispose(),w.poke32(R,C),0}catch(de){return $.storeErr(de),d.SQLITE_CANTOPEN}}},P=function(ne){i.capi.sqlite3_vfs_find(ne)&&a("VFS name is already registered:",ne);const O=new d.sqlite3_vfs,W=d.sqlite3_vfs_find(null),x=W?new d.sqlite3_vfs(W):null;return O.$iVersion=2,O.$szOsFile=d.sqlite3_file.structInfo.sizeof,O.$mxPathname=L,O.addOnDispose(O.$zName=w.allocCString(ne),()=>I(O.pointer,0)),x&&(O.$xRandomness=x.$xRandomness,O.$xSleep=x.$xSleep,x.dispose()),!O.$xRandomness&&!q.xRandomness&&(q.xRandomness=function(C,R,$){const de=w.heap8u();let ge=0;for(;ge<R;++ge)de[$+ge]=Math.random()*255e3&255;return ge}),!O.$xSleep&&!q.xSleep&&(q.xSleep=(C,R)=>0),i.vfs.installVfs({vfs:{struct:O,methods:q}}),O};class X{constructor(O=Object.create(null)){B(this,he);Pe(this,"vfsDir");B(this,ce,void 0);B(this,ae,void 0);B(this,ue,void 0);B(this,be,new Map);B(this,qe,new Map);B(this,rt,new Set);B(this,F,new Map);B(this,M,new Uint8Array(se));B(this,j,void 0);B(this,re,void 0);B(this,Y,void 0);H(this,Y,O.verbosity??D.verbosity),this.vfsName=O.name||D.name,H(this,re,P(this.vfsName)),I(s(this,re).pointer,this),this.vfsDir=O.directory||"."+this.vfsName,H(this,j,new DataView(s(this,M).buffer,s(this,M).byteOffset)),this.isReady=this.reset(!!(O.clearOnInit??D.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(O.initialCapacity||D.initialCapacity)})}log(...O){Ie(this,he,Vi).call(this,2,...O)}warn(...O){Ie(this,he,Vi).call(this,1,...O)}error(...O){Ie(this,he,Vi).call(this,0,...O)}getVfs(){return s(this,re)}getCapacity(){return s(this,be).size}getFileCount(){return s(this,qe).size}getFileNames(){const O=[],W=s(this,qe).keys();for(const x of W)O.push(x);return O}async addCapacity(O){for(let W=0;W<O;++W){const x=b(),R=await(await s(this,ae).getFileHandle(x,{create:!0})).createSyncAccessHandle();s(this,be).set(R,x),this.setAssociatedPath(R,"",0)}return this.getCapacity()}async reduceCapacity(O){let W=0;for(const x of Array.from(s(this,rt))){if(W===O||this.getFileCount()===this.getCapacity())break;const C=s(this,be).get(x);x.close(),await s(this,ae).removeEntry(C),s(this,be).delete(x),s(this,rt).delete(x),++W}return W}releaseAccessHandles(){for(const O of s(this,be).keys())O.close();s(this,be).clear(),s(this,qe).clear(),s(this,rt).clear()}async acquireAccessHandles(O){const W=[];for await(const[x,C]of s(this,ae))C.kind==="file"&&W.push([x,C]);return Promise.all(W.map(async([x,C])=>{try{const R=await C.createSyncAccessHandle();if(s(this,be).set(R,x),O)R.truncate(y),this.setAssociatedPath(R,"",0);else{const $=this.getAssociatedPath(R);$?s(this,qe).set($,R):s(this,rt).add(R)}}catch(R){throw this.storeErr(R),this.releaseAccessHandles(),R}}))}getAssociatedPath(O){O.read(s(this,M),{at:0});const W=s(this,j).getUint32(T);if(s(this,M)[0]&&(W&d.SQLITE_OPEN_DELETEONCLOSE||!(W&v)))return le(`Removing file with unexpected flags ${W.toString(16)}`,s(this,M)),this.setAssociatedPath(O,"",0),"";const x=new Uint32Array(ee/4);O.read(x,{at:g});const C=this.computeDigest(s(this,M));if(x.every((R,$)=>R===C[$])){const R=s(this,M).findIndex($=>$===0);return R===0&&O.truncate(y),R?Q.decode(s(this,M).subarray(0,R)):""}else return le("Disassociating file with bad digest."),this.setAssociatedPath(O,"",0),""}setAssociatedPath(O,W,x){const C=V.encodeInto(W,s(this,M));L<=C.written+1&&l("Path too long:",W),s(this,M).fill(0,C.written,L),s(this,j).setUint32(T,x);const R=this.computeDigest(s(this,M));O.write(s(this,M),{at:0}),O.write(R,{at:g}),O.flush(),W?(s(this,qe).set(W,O),s(this,rt).delete(O)):(O.truncate(y),s(this,rt).add(O))}computeDigest(O){let W=3735928559,x=1103547991;for(const C of O)W=31*W+C*307,x=31*x+C*307;return new Uint32Array([W>>>0,x>>>0])}async reset(O){await this.isReady;let W=await navigator.storage.getDirectory(),x;for(const C of this.vfsDir.split("/"))C&&(x=W,W=await W.getDirectoryHandle(C,{create:!0}));return H(this,ce,W),H(this,ue,x),H(this,ae,await s(this,ce).getDirectoryHandle(S,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(O)}getPath(O){return w.isPtr(O)&&(O=w.cstrToJs(O)),(O instanceof URL?O:new URL(O,"file://localhost/")).pathname}deletePath(O){const W=s(this,qe).get(O);return W&&(s(this,qe).delete(O),this.setAssociatedPath(W,"",0)),!!W}storeErr(O){return O&&this.error(O),this.$error=O}popErr(){const O=this.$error;return this.$error=void 0,O}nextAvailableSAH(){const[O]=s(this,rt).keys();return O}getOFileForS3File(O){return s(this,F).get(O)}mapS3FileToOFile(O,W){W?(s(this,F).set(O,W),N(O,this)):(s(this,F).delete(O),N(O,!1))}hasFilename(O){return s(this,qe).has(O)}getSAHForPath(O){return s(this,qe).get(O)}async removeVfs(){if(!s(this,re).pointer||!s(this,ae))return!1;d.sqlite3_vfs_unregister(s(this,re).pointer),s(this,re).dispose();try{this.releaseAccessHandles(),await s(this,ce).removeEntry(S,{recursive:!0}),H(this,ae,void 0),await s(this,ue).removeEntry(s(this,ce).name,{recursive:!0}),H(this,ce,H(this,ue,void 0))}catch(O){i.config.error(this.vfsName,"removeVfs() failed:",O)}return!0}exportFile(O){const W=s(this,qe).get(O)||l("File not found:",O),x=W.getSize()-y,C=new Uint8Array(x>0?x:0);if(x>0){const R=W.read(C,{at:y});R!=x&&l("Expected to read "+x+" bytes but read "+R+".")}return C}importDb(O,W){W instanceof ArrayBuffer&&(W=new Uint8Array(W));const x=W.byteLength;(x<512||x%512!=0)&&l("Byte array size is invalid for an SQLite db.");const C="SQLite format 3";for(let de=0;de<C.length;++de)C.charCodeAt(de)!==W[de]&&l("Input does not contain an SQLite database header.");const R=s(this,qe).get(O)||this.nextAvailableSAH()||l("No available handles to import to."),$=R.write(W,{at:y});$!=x?(this.setAssociatedPath(R,"",0),l("Expected to write "+x+" bytes but wrote "+$+".")):(R.write(new Uint8Array([1,1]),{at:y+18}),this.setAssociatedPath(R,O,d.SQLITE_OPEN_MAIN_DB))}}ce=new WeakMap,ae=new WeakMap,ue=new WeakMap,be=new WeakMap,qe=new WeakMap,rt=new WeakMap,F=new WeakMap,M=new WeakMap,j=new WeakMap,re=new WeakMap,Y=new WeakMap,he=new WeakSet,Vi=function(O,...W){s(this,Y)>O&&K[O](this.vfsName+":",...W)};class ie{constructor(O){B(this,Z,void 0);H(this,Z,O),this.vfsName=O.vfsName}async addCapacity(O){return s(this,Z).addCapacity(O)}async reduceCapacity(O){return s(this,Z).reduceCapacity(O)}getCapacity(){return s(this,Z).getCapacity(s(this,Z))}getFileCount(){return s(this,Z).getFileCount()}getFileNames(){return s(this,Z).getFileNames()}async reserveMinimumCapacity(O){const W=s(this,Z).getCapacity();return W<O?s(this,Z).addCapacity(O-W):W}exportFile(O){return s(this,Z).exportFile(O)}importDb(O,W){return s(this,Z).importDb(O,W)}async wipeFiles(){return s(this,Z).reset(!0)}unlink(O){return s(this,Z).deletePath(O)}async removeVfs(){return s(this,Z).removeVfs()}}Z=new WeakMap;const oe=async()=>{const ne=await navigator.storage.getDirectory(),O=".opfs-sahpool-sync-check-"+b(),C=(await(await ne.getFileHandle(O,{create:!0})).createSyncAccessHandle()).close();return await C,await ne.removeEntry(O),C?.then&&l("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(ne=Object.create(null)){const O=ne.name||D.name;return c[O]?c[O]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?c[O]=Promise.reject(new Error("Missing required OPFS APIs.")):c[O]=oe().then(async function(){if(ne.$testThrowInInit)throw ne.$testThrowInInit;const W=new X(ne);return W.isReady.then(async()=>{const x=new ie(W);if(i.oo1){const C=i.oo1,R=W.getVfs(),$=function(...de){const ge=C.DB.dbCtorHelper.normalizeArgs(...de);ge.vfs=R.$zName,C.DB.dbCtorHelper.call(this,ge)};$.prototype=Object.create(C.DB.prototype),x.OpfsSAHPoolDb=$,C.DB.dbCtorHelper.setVfsPostOpenSql(R.pointer,function(de,ge){ge.capi.sqlite3_exec(de,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return W.log("VFS initialized."),x}).catch(async x=>(await W.removeVfs().catch(()=>{}),x))}).catch(W=>c[O]=Promise.reject(W))}}),typeof o<"u"){const i=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?o.asm:wasmExports,memory:o.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=i;let l;try{l=globalThis.sqlite3ApiBootstrap()}catch(a){throw console.error("sqlite3ApiBootstrap() error:",a),a}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}o.sqlite3=l}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),r.ready}})();const Pd=function(){const t=Qo;if(!t)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...r)=>console.warn("sqlite3.debugModule:",...r):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const r=e.moduleScript.src.split("/");r.pop(),e.sqlite3Dir=r.join("/")+"/"}if(globalThis.sqlite3InitModule=function r(...n){return t(...n).then(A=>{const U=A.sqlite3;U.scriptInfo=e,r.__isUnderTest&&(U.__isUnderTest=!0);const te=U.asyncPostInit;return delete U.asyncPostInit,te()}).catch(A=>{throw console.error("Exception loading sqlite3 module:",A),A})},globalThis.sqlite3InitModule.ready=t.ready,globalThis.sqlite3InitModuleState.moduleScript){const r=globalThis.sqlite3InitModuleState;let n=r.moduleScript.src.split("/");n.pop(),r.scriptDir=n.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();Qo=Pd;var Ld=Qo;/** @license Copyright 2019 Google LLC SPDX-License-Identifier: Apache-2.0 */function Wd(t){return t.constructor.name==="MessagePort"}function Dd(t){Wd(t)&&t.close()}function Rd(t){return Md(t,{type:"RELEASE"}).then(()=>{Dd(t)})}const Fa=new WeakMap;"FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Fa.get(t)||0)-1;Fa.set(t,e),e===0&&Rd(t)});function Md(t,e,r){return new Promise(n=>{const A=Bd();t.addEventListener("message",function U(te){!te.data||!te.data.id||te.data.id!==A||(t.removeEventListener("message",U),n(te.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:A},e),r)})}function Bd(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Qd=class extends Po{constructor(e){super();Pe(this,"serializer");this.serializer=e}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:n,...A}=r,U=this.serializer(n);return n===U?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...A,value:U}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Ll=t=>{if(Wl(t)||typeof t=="string")return t;if(typeof t=="boolean")return`${t}`;if(t instanceof Date)return t.toISOString();try{return JSON.stringify(t)}catch{return t}},Pa=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/,Ud=t=>{if(Wl(t))return t;if(typeof t=="string"){if(/^(true|false)$/.test(t))return t==="true";if(Pa.test(t))return new Date(t);try{return JSON.parse(t,(e,r)=>typeof r=="string"&&Pa.exec(r)?new Date(r):r)}catch{return t}}};function Wl(t){return t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t}var jd=class{constructor(t={}){Pe(this,"transformer");Pe(this,"deserializer");Pe(this,"skipNodeSet");Pe(this,"ctx");const{deserializer:e=Ud,serializer:r=Ll,skipNodeKind:n=[]}=t;this.transformer=new Qd(r),this.deserializer=e,n.length&&(this.skipNodeSet=new Set(n),this.ctx=new WeakSet)}transformQuery({node:t,queryId:e}){return this.skipNodeSet?.has(t.kind)?(this.ctx?.add(e),t):this.transformer.transformNode(t)}async transformResult({result:t,queryId:e}){return this.ctx?.has(e)?t:{...t,rows:t.rows.map(r=>Object.fromEntries(Object.entries(r).map(([n,A])=>[n,this.deserializer(A)])))}}};function La(t){const{logger:e,merge:r,queryNode:n}=t;return A=>{const{level:U,queryDurationMillis:te,query:{parameters:Ae,sql:Le,query:Ze}}=A,et=U==="error"?A.error:void 0;let Te=Le.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&Ae.forEach(rn=>{Te=Te.replace("?",typeof rn=="string"?rn:JSON.stringify(rn))});const ze={sql:Te,params:Ae,duration:te,error:et};n&&(ze.queryNode=Ze),e(ze)}}async function zd(t){const{rows:e}=await t.executeQuery(ir.raw("PRAGMA integrity_check"));if(!e.length)throw new Error("fail to check integrity");return e[0].integrity_check==="ok"}async function Wa(t,e){if(e)return await t.executeQuery(ir.raw(`PRAGMA user_version = ${e}`)),e;const{rows:r}=await t.executeQuery(ir.raw("PRAGMA user_version"));if(!r.length)throw new Error("fail to get DBVersion");return r[0].user_version}function Vd(t){return`__pre_${t}`}function $d(t,e=r=>r){return{setParam:r=>{let n;return(A,U)=>{if(!n){const{parameters:te,sql:Ae,query:Le}=r({qb:t,param:Vd}).compile();n={sql:Ae,query:U?.(Le)||{kind:Le.kind},parameters:te}}return{...n,parameters:n.parameters.map(te=>typeof te=="string"&&te.startsWith("__pre_")?e(A[te.slice(6)]):te)}}}}}async function Hd(t,e,r){const n=r||`sp_${Date.now()%1e8}`;await st`savepoint ${st.raw(n)}`.execute(t);try{const A=await e(t);return await st`release savepoint ${st.raw(n)}`.execute(t),A}catch(A){throw await st`rollback to savepoint ${st.raw(n)}`.execute(t),A}}var Jd=class extends Error{constructor(){super("db file maybe broken")}};function Gd(t){return t.toOperationNode().kind==="SelectQueryNode"}var Kd=class{constructor(t){Pe(this,"kysely");Pe(this,"trxCount",0);Pe(this,"trx");Pe(this,"logger");Pe(this,"serializer",Ll);const{dialect:e,logger:r,onQuery:n,plugins:A=[],serializerPluginOptions:U}=t;this.logger=r,U?.serializer&&(this.serializer=U.serializer),A.push(new jd(U));let te;n===!0?te=La({logger:this.logger?.debug||console.log,merge:!0}):n&&(te=La(n)),this.kysely=new hi({dialect:e,log:te,plugins:A})}async updateTableSchema(t,e){try{if(e&&!await zd(this.kysely))return this.logger?.error("integrity check fail"),{ready:!1,error:new Jd};await t(this.kysely,this.logger)}catch(r){return this.logError(r,"sync table fail"),{ready:!1,error:r}}return this.logger?.info("table updated"),{ready:!0}}getDB(){return this.trx||this.kysely}logError(t,e){e&&this.logger?.error(e,t instanceof Error?t:void 0)}async transaction(t,e={}){return this.trx?(this.trxCount++,this.logger?.debug(`run in savepoint: sp_${this.trxCount}`),await Hd(this.trx,t,`sp_${this.trxCount}`).then(async r=>(await e.afterCommit?.(),r)).catch(r=>this.logError(r,e.errorMsg)).finally(()=>this.trxCount--)):await this.kysely.transaction().execute(async r=>(this.trx=r,this.logger?.debug("run in transaction"),await t(r))).then(async r=>(await e.afterCommit?.(),r)).catch(r=>this.logError(r,e.errorMsg)).finally(()=>this.trx=void 0)}async execute(t){return typeof t=="function"?await t(this.getDB()).execute():await this.getDB().executeQuery(t)}async executeTakeFirst(t){let e=t(this.getDB());return Gd(e)&&(e=e.limit(1)),await e.executeTakeFirstOrThrow()}precompile(t){return this.logger?.debug?.("precompile"),$d(t(this.kysely),this.serializer)}async raw(t,e){return typeof t=="string"?await this.getDB().executeQuery(ir.raw(t,e)):await t.execute(this.getDB())}async optimize(t){await this.raw(t?"vacuum":"pragma optimize")}async destroy(){this.logger?.info("destroyed"),await this.kysely.destroy(),this.trx=void 0}},Dl="__TIME_TRIGGER__";function Xd(t,e){const{create:r,update:n}=e?.timeTrigger||{},A={type:"date",defaultTo:Dl};return r===!0?t.createAt=A:r&&(t[r]=A),n===!0?t.updateAt={...A,notNull:0}:n&&(t[n]={...A,notNull:0}),{columns:t,...e}}function Rl(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function Eo(t){return Array.isArray(t)?t:[t]}function Yd(t){return typeof t=="function"}async function Ri(t,e){await t.schema.dropTable(e).execute()}async function Da(t,e,r){const{index:n,...A}=r;await t.transaction().execute(async U=>{const te=await So(U,e,A);await Bl(U,e,te),await Ml(U,e,n)})}async function Ml(t,e,r){for(const n of r||[]){const A=Eo(n);await t.schema.createIndex(`idx_${e}_${A.join("_")}`).on(e).columns(A).ifNotExists().execute()}}async function So(t,e,{columns:r,primary:n,timeTrigger:A,unique:U},te=!1){const Ae=A?{triggerKey:"rowid",update:void 0}:void 0;let Le=!1,Ze=t.schema.createTable(e);te&&(Ze=Ze.temporary());for(const[et,Te]of Object.entries(r)){let ze="text";const{type:rn,notNull:yn,defaultTo:Vt}=Te,gn=Rl(rn);ze=gn.dataType,Ze=Ze.addColumn(et,ze,we=>gn.isIncrements?(Le=!0,Ae&&(Ae.triggerKey=et),we.autoIncrement().primaryKey()):Vt===Dl?(Ae&&yn===0&&(Ae.update=et),we.defaultTo(st`CURRENT_TIMESTAMP`)):(yn===!0&&(we=we.notNull()),Vt!==void 0&&(we=we.defaultTo(Yd(Vt)?Vt(st):Vt)),we))}if(!Le&&n){const et=Eo(n);Ze=Ze.addPrimaryKeyConstraint(`pk#${et.join("#")}`,et)}for(const et of U||[]){const Te=Eo(et);Ze=Ze.addUniqueConstraint(`un#${Te.join("#")}`,Te)}return await Ze.ifNotExists().execute(),Ae}async function Bl(t,e,r){if(!r||!r.update)return;const{triggerKey:n,update:A}=r,U=`tgr_${e}_${A}`;await st`create trigger if not exists ${st.ref(U)}
after update
on ${st.table(e)}
begin
  update ${st.table(e)}
  set ${st.ref(A)} = CURRENT_TIMESTAMP
  where ${st.ref(n)} = NEW.${st.ref(n)};
end`.execute(t)}function Zd(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/gi,[,n,A]=t.replace(/\r?\n/g,"").match(e),U={columns:{},name:n,primary:void 0,unique:[]},te=A.matchAll(r);for(const Ae of te){const[,Le,Ze,et]=Ae;if(Le.startsWith("pk#")){const[,...Te]=Le.split("#");U.primary=Te}else if(Le.startsWith("un#")){const[,...Te]=Le.split("#");U.unique.push(Te)}else U.columns[Le]={type:Ze,notNull:!!et}}return U}async function ef(t,e=[]){const r=await t.selectFrom("sqlite_master").where("type","in",["table","trigger","index"]).where("name","!=",Cl).where("name","!=",Fl).where("name","not like","sqlite_%").$if(!!e.length,A=>A.where(U=>U.and(e.map(te=>U("name","not like",`${te}%`))))).select(["name","sql","type"]).$castTo().execute(),n={existTables:{},indexList:[],triggerList:[]};for(const{name:A,sql:U,type:te}of r)U&&(te==="table"?n.existTables[A]=Zd(U):te==="index"?n.indexList.push(A):n.triggerList.push(A));return n}async function tf(t,e,r={},n){const{reserveOldData:A,truncateIfExists:U=[],log:te,version:{current:Ae,skipSyncWhenSame:Le}={},excludeTablePrefix:Ze,afterUpdate:et}=r;if(Ae){if(Le&&Ae===await Wa(t))return;await Wa(t,Ae)}const Te=we=>te&&n?.debug(we),{existTables:ze,indexList:rn,triggerList:yn}=await ef(t,Ze);Te("====== update tables start ======");const Vt=new Set(Array.isArray(U)?U:U?Object.keys(ze):[]);for(const we of rn)await t.schema.dropIndex(we).ifExists().execute();for(const we of yn)await st`drop trigger if exists ${st.ref(we)}`.execute(t);for(const[we,ft]of Object.entries(ze))we in e?(Te(`diff table: ${we}`),await gn(we,ft,e[we])):(Te(`remove table: ${we}`),await Ri(t,we));for(const[we,ft]of Object.entries(e))we in ze||(Te(`create table: ${we}`),await Da(t,we,ft));Te("======= after update hook ======="),await et?.(t),Te("======= update tables end =======");async function gn(we,ft,sn){if(Vt.has(we)){await t.transaction().execute(async ht=>{await Ri(ht,we),await Da(ht,we,sn),Te("clear and sync structure")});return}const{index:$t,...Ti}=sn,Mn=nf(ft.columns,sn.columns);if(Mn.length===Object.keys(ft.columns).length){Te("same table structure, skip");return}Te("different table structure, update"),await t.transaction().execute(async ht=>{const Wt=`_temp_${we}`;await So(ht,Wt,ft,!0),await ht.insertInto(Wt).expression(wn=>wn.selectFrom(we).selectAll()).execute(),await Ri(ht,we);const Js=await So(ht,we,Ti);Mn.length&&await ht.insertInto(we).columns(Mn).expression(wn=>wn.selectFrom(Wt).select(Mn)).execute(),await Ml(ht,we,$t),await Bl(ht,we,Js),!A&&await Ri(ht,Wt)}).then(()=>Te(`restore columns: ${Mn}`)).catch(ht=>n?.error(`fail to sync ${we}`,ht))}}function nf(t,e){const r=[];for(const[n,A]of Object.entries(e))if(n in t){const{type:U,notNull:te=!1}=t[n];Rl(A.type).dataType===U&&(A.notNull||!1)===te&&r.push(n)}return r}function rf(t,e={}){const{log:r}=e;return async(n,A)=>{await tf(n,t,e,r?A:void 0)}}const sf={test:Xd({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function of(t){const e=new Kd({dialect:t}),r=await e.updateTableSchema(rf(sf));if(!r.ready)throw r.error;console.log(await e.raw("PRAGMA table_info('test')"));for(let n=0;n<10;n++)await e.transaction(async()=>{await e.transaction(async()=>{if(n>8)throw console.log("test rollback"),new Error("test rollback");await e.execute(A=>A.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}))})});return e.execute(n=>n.selectFrom("test").selectAll()).then(async n=>(await e.destroy(),console.log(n),n))}const af=new Fd({database:async()=>{const t=(await Ld()).oo1;if(!t)return Promise.reject("fail to load sqlite");const e="/test.db";return t.OpfsDb?(console.log("support OPFS"),new t.OpfsDb(e)):(console.log("doesn't support OPFS"),new t.DB(e))}});onmessage=()=>{console.log("start official wasm test"),of(af).then(t=>{t?.forEach(e=>console.log("[official wasm]",e))})};
