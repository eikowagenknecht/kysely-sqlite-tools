var tf=Object.defineProperty;var nf=(We,Ce,Ze)=>Ce in We?tf(We,Ce,{enumerable:!0,configurable:!0,writable:!0,value:Ze}):We[Ce]=Ze;var De=(We,Ce,Ze)=>(nf(We,typeof Ce!="symbol"?Ce+"":Ce,Ze),Ze),Ro=(We,Ce,Ze)=>{if(!Ce.has(We))throw TypeError("Cannot "+Ze)};var s=(We,Ce,Ze)=>(Ro(We,Ce,"read from private field"),Ze?Ze.call(We):Ce.get(We)),Q=(We,Ce,Ze)=>{if(Ce.has(We))throw TypeError("Cannot add the same private member more than once");Ce instanceof WeakSet?Ce.add(We):Ce.set(We,Ze)},K=(We,Ce,Ze,Mn)=>(Ro(We,Ce,"write to private field"),Mn?Mn.call(We,Ze):Ce.set(We,Ze),Ze);var Pe=(We,Ce,Ze)=>(Ro(We,Ce,"access private method"),Ze);(function(){var mr,Ut,Un,ze,li,jt,Ne,he,ge,dn,yr,bs,gr,jn,zn,qs,Sl,Ns,Al,vs,kl,Vn,Oi,ui,Mo,xs,Il,di,Me,fi,wr,br,Hn,hi,Bo,In,qr,On,Jn,Gn,Y,Nr,vr,Ct,Er,Sr,Ar,kr,Yt,Ir,Tn,pi,Qo,Or,Tr,Cn,Qe,Kn,fn,_i,zt,gt,ot,Ue,rt,je,Pt,Le,ft,vt,xt,Ts,Ke,ht,Ft,Lt,ct,Cr,en,tn,hn,Vt,Fn,pn,Pr,_n,bi,Cs,Ol,Ps,Tl,Fs,Cl,Ls,Pl,qi,Uo,Ni,Ln,Ws,Fl,Wn,Zn,pt,$t,er,Ht,It,Wr,Vs,vi,jo,xi,zo,tr,Dn,Rs,Dr,nr,Rr,Ms,Ll,Ei,rl,Si,il;"use strict";function We(t){return typeof t>"u"||t===void 0}function Ce(t){return typeof t=="string"}function Ze(t){return typeof t=="number"}function Mn(t){return typeof t=="boolean"}function Hs(t){return t===null}function Wl(t){return t instanceof Date}function Dl(t){return typeof t=="bigint"}function Ot(t){return typeof t=="function"}function Jt(t){return typeof t=="object"&&t!==null}function h(t){return Object.freeze(t)}function wn(t){return Array.isArray(t)}function sr(t){return t}const et=h({is(t){return t.kind==="AlterTableNode"},create(t){return h({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return h({...t,...e})},cloneWithColumnAlteration(t,e){return h({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),Je=h({is(t){return t.kind==="IdentifierNode"},create(t){return h({kind:"IdentifierNode",name:t})}}),bn=h({is(t){return t.kind==="CreateIndexNode"},create(t){return h({kind:"CreateIndexNode",name:Je.create(t)})},cloneWith(t,e){return h({...t,...e})},cloneWithColumns(t,e){return h({...t,columns:[...t.columns||[],...e]})}}),Vo=h({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return h({kind:"CreateSchemaNode",schema:Je.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),Rl=["preserve rows","delete rows","drop"],Bt=h({is(t){return t.kind==="CreateTableNode"},create(t){return h({kind:"CreateTableNode",table:t,columns:h([])})},cloneWithColumn(t,e){return h({...t,columns:h([...t.columns,e])})},cloneWithConstraint(t,e){return h({...t,constraints:t.constraints?h([...t.constraints,e]):h([e])})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):h([e])})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):h([e])})},cloneWith(t,e){return h({...t,...e})}}),qn=h({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return h({kind:"SchemableIdentifierNode",identifier:Je.create(t)})},createWithSchema(t,e){return h({kind:"SchemableIdentifierNode",schema:Je.create(t),identifier:Je.create(e)})}}),Ti=h({is(t){return t.kind==="DropIndexNode"},create(t,e){return h({kind:"DropIndexNode",name:qn.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),Js=h({is(t){return t.kind==="DropSchemaNode"},create(t,e){return h({kind:"DropSchemaNode",schema:Je.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),Gs=h({is(t){return t.kind==="DropTableNode"},create(t,e){return h({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return h({...t,...e})}}),Nn=h({is(t){return t.kind==="AliasNode"},create(t,e){return h({kind:"AliasNode",node:t,alias:e})}}),vn=h({is(t){return t.kind==="TableNode"},create(t){return h({kind:"TableNode",table:qn.create(t)})},createWithSchema(t,e){return h({kind:"TableNode",table:qn.createWithSchema(t,e)})}});function Dt(t){return Jt(t)&&Ot(t.toOperationNode)}function Ml(t){return Jt(t)&&"expressionType"in t&&Dt(t)}function Bl(t){return Jt(t)&&"expression"in t&&Ce(t.alias)&&Dt(t)}const on=h({is(t){return t.kind==="SelectModifierNode"},create(t){return h({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return h({kind:"SelectModifierNode",rawModifier:t})}}),xn=h({is(t){return t.kind==="AndNode"},create(t,e){return h({kind:"AndNode",left:t,right:e})}}),or=h({is(t){return t.kind==="OrNode"},create(t,e){return h({kind:"OrNode",left:t,right:e})}}),Ks=h({is(t){return t.kind==="OnNode"},create(t){return h({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return h({...t,on:e==="And"?xn.create(t.on,r):or.create(t.on,r)})}}),zr=h({is(t){return t.kind==="JoinNode"},create(t,e){return h({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return h({kind:"JoinNode",joinType:t,table:e,on:Ks.create(r)})},cloneWithOn(t,e){return h({...t,on:t.on?Ks.cloneWithOperation(t.on,"And",e):Ks.create(e)})}}),Vr=h({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return h({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),Ql=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp"],Ul=["+","-","*","/","%","^","&","|","#","<<",">>"],$o=["->","->>"],jl=[...Ql,...Ul,"&&","||"],zl=["not","-",...["exists","not exists"]],Vl=[...jl,...$o,...zl,"between","between symmetric"],Bn=h({is(t){return t.kind==="OperatorNode"},create(t){return h({kind:"OperatorNode",operator:t})}});function Ho(t){return Ce(t)&&$o.includes(t)}const tt=h({is(t){return t.kind==="ColumnNode"},create(t){return h({kind:"ColumnNode",column:Je.create(t)})}}),Xs=h({is(t){return t.kind==="SelectAllNode"},create(){return h({kind:"SelectAllNode"})}}),Ci=h({is(t){return t.kind==="ReferenceNode"},create(t,e){return h({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return h({kind:"ReferenceNode",table:t,column:Xs.create()})}});class $l{constructor(e){Q(this,mr,void 0);K(this,mr,e)}get dynamicReference(){return s(this,mr)}get refType(){}toOperationNode(){return Yo(s(this,mr))}}mr=new WeakMap;function Jo(t){return Jt(t)&&Dt(t)&&Ce(t.dynamicReference)}const Ys=h({is(t){return t.kind==="OrderByItemNode"},create(t,e){return h({kind:"OrderByItemNode",orderBy:t,direction:e})}}),qt=h({is(t){return t.kind==="RawNode"},create(t,e){return h({kind:"RawNode",sqlFragments:h(t),parameters:h(e)})},createWithSql(t){return qt.create([t],[])},createWithChild(t){return qt.create(["",""],[t])},createWithChildren(t){return qt.create(new Array(t.length+1).fill(""),t)}});function Go(t){return t==="asc"||t==="desc"}function Pi(t){if(t.length===2)return[Zs(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>Zs(r)):[Zs(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function Zs(t,e){const r=Hl(t);if(Ys.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return Ys.create(r,Ko(e))}function Hl(t){if(ei(t))return hr(t);if(Jo(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!Go(r))throw new Error(`Invalid order by direction: ${r}`);return Ys.create(an(e),Ko(r))}return an(t)}function Ko(t){if(t)return t==="asc"||t==="desc"?qt.createWithSql(t):t.toOperationNode()}const eo=h({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return h({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return h({...t,traversal:e})}}),Xo=h({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return h({kind:"JSONOperatorChainNode",operator:t,values:h([])})},cloneWithValue(t,e){return h({...t,values:h([...t.values,e])})}}),to=h({is(t){return t.kind==="JSONPathNode"},create(t){return h({kind:"JSONPathNode",inOperator:t,pathLegs:h([])})},cloneWithLeg(t,e){return h({...t,pathLegs:h([...t.pathLegs,e])})}});function Yo(t){return Ce(t)?an(t):t.toOperationNode()}function $r(t){return wn(t)?t.map(e=>Qt(e)):[Qt(t)]}function Qt(t){return ei(t)?hr(t):Yo(t)}function Jl(t,e){const r=an(t);if(Ho(e))return eo.create(r,Xo.create(Bn.create(e)));const n=e.slice(0,-1);if(Ho(n))return eo.create(r,to.create(Bn.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function an(t){const e=".";if(!t.includes(e))return Ci.create(tt.create(t));const r=t.split(e).map(no);if(r.length===3)return Kl(r);if(r.length===2)return Xl(r);throw new Error(`invalid column reference ${t}`)}function Gl(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(no);return Nn.create(an(r),Je.create(n))}else return an(t)}function Zo(t){return tt.create(t)}function ea(t){const e=" ";if(t.includes(e)){const[r,n]=t.split(e).map(no);if(!Go(n))throw new Error(`invalid order direction "${n}" next to "${r}"`);return Pi([r,n])[0]}else return Zo(t)}function Kl(t){const[e,r,n]=t;return Ci.create(tt.create(n),vn.createWithSchema(e,r))}function Xl(t){const[e,r]=t;return Ci.create(tt.create(r),vn.create(e))}function no(t){return t.trim()}const ta=h({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return h({kind:"PrimitiveValueListNode",values:h([...t])})}}),ro=h({is(t){return t.kind==="ValueListNode"},create(t){return h({kind:"ValueListNode",values:h(t)})}}),Gt=h({is(t){return t.kind==="ValueNode"},create(t){return h({kind:"ValueNode",value:t})},createImmediate(t){return h({kind:"ValueNode",value:t,immediate:!0})}});function na(t){return wn(t)?Yl(t):Nt(t)}function Nt(t){return ei(t)?hr(t):Gt.create(t)}function io(t){return Ze(t)||Mn(t)||Hs(t)}function so(t){if(!io(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return Gt.createImmediate(t)}function Yl(t){return t.some(ei)?ro.create(t.map(e=>Nt(e))):ta.create(t)}const ar=h({is(t){return t.kind==="ParensNode"},create(t){return h({kind:"ParensNode",node:t})}});function mt(t){if(t.length===3)return Hr(t[0],t[1],t[2]);if(t.length===1)return Nt(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function Hr(t,e,r){return Zl(e)&&ia(r)?Vr.create(Qt(t),ao(e),Gt.createImmediate(r)):Vr.create(Qt(t),ao(e),na(r))}function ln(t,e,r){return Vr.create(Qt(t),ao(e),Qt(r))}function ra(t,e){return oo(Object.entries(t).filter(([,r])=>!We(r)).map(([r,n])=>Hr(r,ia(n)?"is":"=",n)),e)}function oo(t,e){const r=e==="and"?xn.create:or.create;if(t.length===0)return Gt.createImmediate(e==="and");let n=sa(t[0]);for(let x=1;x<t.length;++x)n=r(n,sa(t[x]));return t.length>1?ar.create(n):n}function Zl(t){return t==="is"||t==="is not"}function ia(t){return Hs(t)||Mn(t)}function ao(t){if(Ce(t)&&Vl.includes(t))return Bn.create(t);if(Dt(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function sa(t){return Dt(t)?t.toOperationNode():t}const lr=h({is(t){return t.kind==="OrderByNode"},create(t){return h({kind:"OrderByNode",items:h([...t])})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),oa=h({is(t){return t.kind==="PartitionByNode"},create(t){return h({kind:"PartitionByNode",items:h(t)})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),lo=h({is(t){return t.kind==="OverNode"},create(){return h({kind:"OverNode"})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?lr.cloneWithItems(t.orderBy,e):lr.create(e)})},cloneWithPartitionByItems(t,e){return h({...t,partitionBy:t.partitionBy?oa.cloneWithItems(t.partitionBy,e):oa.create(e)})}}),Fi=h({is(t){return t.kind==="FromNode"},create(t){return h({kind:"FromNode",froms:h(t)})},cloneWithFroms(t,e){return h({...t,froms:h([...t.froms,...e])})}}),aa=h({is(t){return t.kind==="GroupByNode"},create(t){return h({kind:"GroupByNode",items:h(t)})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),la=h({is(t){return t.kind==="HavingNode"},create(t){return h({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return h({...t,having:e==="And"?xn.create(t.having,r):or.create(t.having,r)})}}),Ie=h({is(t){return t.kind==="SelectQueryNode"},create(t){return h({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return h({kind:"SelectQueryNode",from:Fi.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return h({...t,selections:t.selections?h([...t.selections,...e]):h(e)})},cloneWithDistinctOn(t,e){return h({...t,distinctOn:t.distinctOn?h([...t.distinctOn,...e]):h(e)})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):h([e])})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):h([e])})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?lr.cloneWithItems(t.orderBy,e):lr.create(e)})},cloneWithGroupByItems(t,e){return h({...t,groupBy:t.groupBy?aa.cloneWithItems(t.groupBy,e):aa.create(e)})},cloneWithLimit(t,e){return h({...t,limit:e})},cloneWithOffset(t,e){return h({...t,offset:e})},cloneWithHaving(t,e){return h({...t,having:t.having?la.cloneWithOperation(t.having,"And",e):la.create(e)})},cloneWithSetOperations(t,e){return h({...t,setOperations:t.setOperations?h([...t.setOperations,...e]):h([...e])})},cloneWithoutSelections(t){return h({...t,selections:[]})},cloneWithoutLimit(t){return h({...t,limit:void 0})},cloneWithoutOffset(t){return h({...t,offset:void 0})},cloneWithoutOrderBy(t){return h({...t,orderBy:void 0})}});function Te(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}const ai=class ai{constructor(e){Q(this,Ut,void 0);K(this,Ut,h(e))}on(...e){return new ai({...s(this,Ut),joinNode:zr.cloneWithOn(s(this,Ut).joinNode,mt(e))})}onRef(e,r,n){return new ai({...s(this,Ut),joinNode:zr.cloneWithOn(s(this,Ut).joinNode,ln(e,r,n))})}onTrue(){return new ai({...s(this,Ut),joinNode:zr.cloneWithOn(s(this,Ut).joinNode,qt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return s(this,Ut).joinNode}};Ut=new WeakMap;let Li=ai;Te(Li,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const ec=h({is(t){return t.kind==="PartitionByItemNode"},create(t){return h({kind:"PartitionByItemNode",partitionBy:t})}});function tc(t){return $r(t).map(ec.create)}const gs=class gs{constructor(e){Q(this,Un,void 0);K(this,Un,h(e))}orderBy(e,r){return new gs({overNode:lo.cloneWithOrderByItems(s(this,Un).overNode,Pi([e,r]))})}partitionBy(e){return new gs({overNode:lo.cloneWithPartitionByItems(s(this,Un).overNode,tc(e))})}$call(e){return e(this)}toOperationNode(){return s(this,Un).overNode}};Un=new WeakMap;let Wi=gs;Te(Wi,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const Jr=h({is(t){return t.kind==="SelectionNode"},create(t){return h({kind:"SelectionNode",selection:t})},createSelectAll(){return h({kind:"SelectionNode",selection:Xs.create()})},createSelectAllFromTable(t){return h({kind:"SelectionNode",selection:Ci.createSelectAll(t)})}});function Qn(t){return Ot(t)?Qn(t(fr())):wn(t)?t.map(e=>ca(e)):[ca(t)]}function ca(t){return Ce(t)?Jr.create(Gl(t)):Jo(t)?Jr.create(t.toOperationNode()):Jr.create(ka(t))}function Gr(t){return t?Array.isArray(t)?t.map(ua):[ua(t)]:[Jr.createSelectAll()]}function ua(t){if(Ce(t))return Jr.createSelectAllFromTable(kt(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const nc=h({is(t){return t.kind==="ValuesNode"},create(t){return h({kind:"ValuesNode",values:h(t)})}}),rc=h({is(t){return t.kind==="DefaultInsertValueNode"},create(){return h({kind:"DefaultInsertValueNode"})}});function ic(t){const e=Ot(t)?t(fr()):t,r=wn(e)?e:h([e]);return sc(r)}function sc(t){const e=oc(t);return[h([...e.keys()].map(tt.create)),nc.create(t.map(r=>ac(r,e)))]}function oc(t){const e=new Map;for(const r of t){const n=Object.keys(r);for(const x of n)!e.has(x)&&r[x]!==void 0&&e.set(x,e.size)}return e}function ac(t,e){const r=Object.keys(t),n=Array.from({length:e.size});let x=!1;for(const te of r){const pe=e.get(te);if(We(pe))continue;const Oe=t[te];(We(Oe)||ei(Oe))&&(x=!0),n[pe]=Oe}if(r.length<e.size||x){const te=rc.create();return ro.create(n.map(pe=>We(pe)?te:Nt(pe)))}return ta.create(n)}const Kt=h({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return h({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return h({...t,...e})}}),Di=h({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return h({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return h({...t,from:t.from?Fi.cloneWithFroms(t.from,e):Fi.create(e)})},cloneWithUpdates(t,e){return h({...t,updates:t.updates?h([...t.updates,...e]):e})}}),da=h({is(t){return t.kind==="UsingNode"},create(t){return h({kind:"UsingNode",tables:h(t)})},cloneWithTables(t,e){return h({...t,tables:h([...t.tables,...e])})}}),Kr=h({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return h({kind:"DeleteQueryNode",from:Fi.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?lr.cloneWithItems(t.orderBy,e):lr.create(e)})},cloneWithLimit(t,e){return h({...t,limit:e})},cloneWithUsing(t,e){return h({...t,using:t.using!==void 0?da.cloneWithTables(t.using,e):da.create(e)})}}),St=h({is(t){return t.kind==="WhereNode"},create(t){return h({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return h({...t,where:e==="And"?xn.create(t.where,r):or.create(t.where,r)})}}),fa=h({is(t){return t.kind==="ReturningNode"},create(t){return h({kind:"ReturningNode",selections:h(t)})},cloneWithSelections(t,e){return h({...t,selections:t.selections?h([...t.selections,...e]):h(e)})}}),lc=h({is(t){return t.kind==="ExplainNode"},create(t,e){return h({kind:"ExplainNode",format:t,options:e})}}),ve=h({is(t){return Ie.is(t)||Kt.is(t)||Di.is(t)||Kr.is(t)},cloneWithWhere(t,e){return h({...t,where:t.where?St.cloneWithOperation(t.where,"And",e):St.create(e)})},cloneWithJoin(t,e){return h({...t,joins:t.joins?h([...t.joins,e]):h([e])})},cloneWithReturning(t,e){return h({...t,returning:t.returning?fa.cloneWithSelections(t.returning,e):fa.create(e)})},cloneWithoutWhere(t){return h({...t,where:void 0})},cloneWithExplain(t,e,r){return h({...t,explain:lc.create(e,r==null?void 0:r.toOperationNode())})}}),cc=h({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return h({kind:"ColumnUpdateNode",column:t,value:e})}});function co(t){const e=Ot(t)?t(fr()):t;return Object.entries(e).filter(([r,n])=>n!==void 0).map(([r,n])=>cc.create(tt.create(r),Nt(n)))}const uc=h({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return h({kind:"OnDuplicateKeyNode",updates:t})}});class dc{constructor(e,r){De(this,"insertId");De(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class Ri extends Error{constructor(r){super("no result");De(this,"node");this.node=r}}function Mi(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Tt=h({is(t){return t.kind==="OnConflictNode"},create(){return h({kind:"OnConflictNode"})},cloneWith(t,e){return h({...t,...e})},cloneWithIndexWhere(t,e){return h({...t,indexWhere:t.indexWhere?St.cloneWithOperation(t.indexWhere,"And",e):St.create(e)})},cloneWithIndexOrWhere(t,e){return h({...t,indexWhere:t.indexWhere?St.cloneWithOperation(t.indexWhere,"Or",e):St.create(e)})},cloneWithUpdateWhere(t,e){return h({...t,updateWhere:t.updateWhere?St.cloneWithOperation(t.updateWhere,"And",e):St.create(e)})},cloneWithUpdateOrWhere(t,e){return h({...t,updateWhere:t.updateWhere?St.cloneWithOperation(t.updateWhere,"Or",e):St.create(e)})},cloneWithoutIndexWhere(t){return h({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return h({...t,updateWhere:void 0})}}),un=class un{constructor(e){Q(this,ze,void 0);K(this,ze,h(e))}column(e){const r=tt.create(e);return new un({...s(this,ze),onConflictNode:Tt.cloneWith(s(this,ze).onConflictNode,{columns:s(this,ze).onConflictNode.columns?h([...s(this,ze).onConflictNode.columns,r]):h([r])})})}columns(e){const r=e.map(tt.create);return new un({...s(this,ze),onConflictNode:Tt.cloneWith(s(this,ze).onConflictNode,{columns:s(this,ze).onConflictNode.columns?h([...s(this,ze).onConflictNode.columns,...r]):h(r)})})}constraint(e){return new un({...s(this,ze),onConflictNode:Tt.cloneWith(s(this,ze).onConflictNode,{constraint:Je.create(e)})})}expression(e){return new un({...s(this,ze),onConflictNode:Tt.cloneWith(s(this,ze).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new un({...s(this,ze),onConflictNode:Tt.cloneWithIndexWhere(s(this,ze).onConflictNode,mt(e))})}whereRef(e,r,n){return new un({...s(this,ze),onConflictNode:Tt.cloneWithIndexWhere(s(this,ze).onConflictNode,ln(e,r,n))})}clearWhere(){return new un({...s(this,ze),onConflictNode:Tt.cloneWithoutIndexWhere(s(this,ze).onConflictNode)})}doNothing(){return new ha({...s(this,ze),onConflictNode:Tt.cloneWith(s(this,ze).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Qi({...s(this,ze),onConflictNode:Tt.cloneWith(s(this,ze).onConflictNode,{updates:co(e)})})}$call(e){return e(this)}};ze=new WeakMap;let Bi=un;Te(Bi,"don't await OnConflictBuilder instances.");class ha{constructor(e){Q(this,li,void 0);K(this,li,h(e))}toOperationNode(){return s(this,li).onConflictNode}}li=new WeakMap,Te(ha,"don't await OnConflictDoNothingBuilder instances.");const ci=class ci{constructor(e){Q(this,jt,void 0);K(this,jt,h(e))}where(...e){return new ci({...s(this,jt),onConflictNode:Tt.cloneWithUpdateWhere(s(this,jt).onConflictNode,mt(e))})}whereRef(e,r,n){return new ci({...s(this,jt),onConflictNode:Tt.cloneWithUpdateWhere(s(this,jt).onConflictNode,ln(e,r,n))})}clearWhere(){return new ci({...s(this,jt),onConflictNode:Tt.cloneWithoutUpdateWhere(s(this,jt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return s(this,jt).onConflictNode}};jt=new WeakMap;let Qi=ci;Te(Qi,"don't await OnConflictUpdateBuilder instances.");const yt=class yt{constructor(e){Q(this,Ne,void 0);K(this,Ne,h(e))}values(e){const[r,n]=ic(e);return new yt({...s(this,Ne),queryNode:Kt.cloneWith(s(this,Ne).queryNode,{columns:r,values:n})})}columns(e){return new yt({...s(this,Ne),queryNode:Kt.cloneWith(s(this,Ne).queryNode,{columns:h(e.map(tt.create))})})}expression(e){return new yt({...s(this,Ne),queryNode:Kt.cloneWith(s(this,Ne).queryNode,{values:hr(e)})})}ignore(){return new yt({...s(this,Ne),queryNode:Kt.cloneWith(s(this,Ne).queryNode,{ignore:!0})})}onConflict(e){return new yt({...s(this,Ne),queryNode:Kt.cloneWith(s(this,Ne).queryNode,{onConflict:e(new Bi({onConflictNode:Tt.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new yt({...s(this,Ne),queryNode:Kt.cloneWith(s(this,Ne).queryNode,{onDuplicateKey:uc.create(co(e))})})}returning(e){return new yt({...s(this,Ne),queryNode:ve.cloneWithReturning(s(this,Ne).queryNode,Qn(e))})}returningAll(){return new yt({...s(this,Ne),queryNode:ve.cloneWithReturning(s(this,Ne).queryNode,Gr())})}$call(e){return e(this)}$if(e,r){return e?r(this):new yt({...s(this,Ne)})}$castTo(){return new yt(s(this,Ne))}$narrowType(){return new yt(s(this,Ne))}$assertType(){return new yt(s(this,Ne))}withPlugin(e){return new yt({...s(this,Ne),executor:s(this,Ne).executor.withPlugin(e)})}toOperationNode(){return s(this,Ne).executor.transformQuery(s(this,Ne).queryNode,s(this,Ne).queryId)}compile(){return s(this,Ne).executor.compileQuery(this.toOperationNode(),s(this,Ne).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,Ne).executor.executeQuery(e,s(this,Ne).queryId);return s(this,Ne).executor.adapter.supportsReturning&&r.returning?n.rows:[new dc(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ri){const r=await this.executeTakeFirst();if(r===void 0)throw Mi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,Ne).executor.stream(r,e,s(this,Ne).queryId);for await(const x of n)yield*x.rows}async explain(e,r){return await new yt({...s(this,Ne),queryNode:ve.cloneWithExplain(s(this,Ne).queryNode,e,r)}).execute()}};Ne=new WeakMap;let Xr=yt;Te(Xr,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class fc{constructor(e){De(this,"numDeletedRows");this.numDeletedRows=e}}const pa=h({is(t){return t.kind==="LimitNode"},create(t){return h({kind:"LimitNode",limit:Gt.create(t)})}}),st=class st{constructor(e){Q(this,he,void 0);K(this,he,h(e))}where(...e){return new st({...s(this,he),queryNode:ve.cloneWithWhere(s(this,he).queryNode,mt(e))})}whereRef(e,r,n){return new st({...s(this,he),queryNode:ve.cloneWithWhere(s(this,he).queryNode,ln(e,r,n))})}clearWhere(){return new st({...s(this,he),queryNode:ve.cloneWithoutWhere(s(this,he).queryNode)})}using(e){return new st({...s(this,he),queryNode:Kr.cloneWithUsing(s(this,he).queryNode,ti(e))})}innerJoin(...e){return new st({...s(this,he),queryNode:ve.cloneWithJoin(s(this,he).queryNode,At("InnerJoin",e))})}leftJoin(...e){return new st({...s(this,he),queryNode:ve.cloneWithJoin(s(this,he).queryNode,At("LeftJoin",e))})}rightJoin(...e){return new st({...s(this,he),queryNode:ve.cloneWithJoin(s(this,he).queryNode,At("RightJoin",e))})}fullJoin(...e){return new st({...s(this,he),queryNode:ve.cloneWithJoin(s(this,he).queryNode,At("FullJoin",e))})}returning(e){return new st({...s(this,he),queryNode:ve.cloneWithReturning(s(this,he).queryNode,Qn(e))})}returningAll(e){return new st({...s(this,he),queryNode:ve.cloneWithReturning(s(this,he).queryNode,Gr(e))})}orderBy(e,r){return new st({...s(this,he),queryNode:Kr.cloneWithOrderByItems(s(this,he).queryNode,Pi([e,r]))})}limit(e){return new st({...s(this,he),queryNode:Kr.cloneWithLimit(s(this,he).queryNode,pa.create(e))})}$call(e){return e(this)}$if(e,r){return e?r(this):new st({...s(this,he)})}$castTo(){return new st(s(this,he))}$narrowType(){return new st(s(this,he))}$assertType(){return new st(s(this,he))}withPlugin(e){return new st({...s(this,he),executor:s(this,he).executor.withPlugin(e)})}toOperationNode(){return s(this,he).executor.transformQuery(s(this,he).queryNode,s(this,he).queryId)}compile(){return s(this,he).executor.compileQuery(this.toOperationNode(),s(this,he).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,he).executor.executeQuery(e,s(this,he).queryId);return s(this,he).executor.adapter.supportsReturning&&r.returning?n.rows:[new fc(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ri){const r=await this.executeTakeFirst();if(r===void 0)throw Mi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,he).executor.stream(r,e,s(this,he).queryId);for await(const x of n)yield*x.rows}async explain(e,r){return await new st({...s(this,he),queryNode:ve.cloneWithExplain(s(this,he).queryNode,e,r)}).execute()}};he=new WeakMap;let Ui=st;Te(Ui,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class hc{constructor(e,r){De(this,"numUpdatedRows");De(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}const at=class at{constructor(e){Q(this,ge,void 0);K(this,ge,h(e))}where(...e){return new at({...s(this,ge),queryNode:ve.cloneWithWhere(s(this,ge).queryNode,mt(e))})}whereRef(e,r,n){return new at({...s(this,ge),queryNode:ve.cloneWithWhere(s(this,ge).queryNode,ln(e,r,n))})}clearWhere(){return new at({...s(this,ge),queryNode:ve.cloneWithoutWhere(s(this,ge).queryNode)})}from(e){return new at({...s(this,ge),queryNode:Di.cloneWithFromItems(s(this,ge).queryNode,ti(e))})}innerJoin(...e){return new at({...s(this,ge),queryNode:ve.cloneWithJoin(s(this,ge).queryNode,At("InnerJoin",e))})}leftJoin(...e){return new at({...s(this,ge),queryNode:ve.cloneWithJoin(s(this,ge).queryNode,At("LeftJoin",e))})}rightJoin(...e){return new at({...s(this,ge),queryNode:ve.cloneWithJoin(s(this,ge).queryNode,At("RightJoin",e))})}fullJoin(...e){return new at({...s(this,ge),queryNode:ve.cloneWithJoin(s(this,ge).queryNode,At("FullJoin",e))})}set(e){return new at({...s(this,ge),queryNode:Di.cloneWithUpdates(s(this,ge).queryNode,co(e))})}returning(e){return new at({...s(this,ge),queryNode:ve.cloneWithReturning(s(this,ge).queryNode,Qn(e))})}returningAll(){return new at({...s(this,ge),queryNode:ve.cloneWithReturning(s(this,ge).queryNode,Gr())})}$call(e){return e(this)}$if(e,r){return e?r(this):new at({...s(this,ge)})}$castTo(){return new at(s(this,ge))}$narrowType(){return new at(s(this,ge))}$assertType(){return new at(s(this,ge))}withPlugin(e){return new at({...s(this,ge),executor:s(this,ge).executor.withPlugin(e)})}toOperationNode(){return s(this,ge).executor.transformQuery(s(this,ge).queryNode,s(this,ge).queryId)}compile(){return s(this,ge).executor.compileQuery(this.toOperationNode(),s(this,ge).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,ge).executor.executeQuery(e,s(this,ge).queryId);return s(this,ge).executor.adapter.supportsReturning&&r.returning?n.rows:[new hc(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ri){const r=await this.executeTakeFirst();if(r===void 0)throw Mi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,ge).executor.stream(r,e,s(this,ge).queryId);for await(const x of n)yield*x.rows}async explain(e,r){return await new at({...s(this,ge),queryNode:ve.cloneWithExplain(s(this,ge).queryNode,e,r)}).execute()}};ge=new WeakMap;let ji=at;Te(ji,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const _a=h({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return h({kind:"CommonTableExpressionNameNode",table:vn.create(t),columns:e?h(e.map(tt.create)):void 0})}}),zi=h({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return h({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return h({...t,...e})}}),ws=class ws{constructor(e){Q(this,dn,void 0);K(this,dn,h(e))}materialized(){return new ws({...s(this,dn),node:zi.cloneWith(s(this,dn).node,{materialized:!0})})}notMaterialized(){return new ws({...s(this,dn),node:zi.cloneWith(s(this,dn).node,{materialized:!1})})}toOperationNode(){return s(this,dn).node}};dn=new WeakMap;let Vi=ws;Te(Vi,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function ma(t,e){const r=e(vc()).toOperationNode();return Ot(t)?t(pc(r)).toOperationNode():zi.create(ya(t),r)}function pc(t){return e=>new Vi({node:zi.create(ya(e),t)})}function ya(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],n=e[1].split(",").map(x=>x.trim());return _a.create(r,n)}else return _a.create(t)}const $i=h({is(t){return t.kind==="WithNode"},create(t,e){return h({kind:"WithNode",expressions:h([t]),...e})},cloneWithExpression(t,e){return h({...t,expressions:h([...t.expressions,e])})}}),ga=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function _c(t){let e="";for(let r=0;r<t;++r)e+=mc();return e}function mc(){return ga[~~(Math.random()*ga.length)]}function Re(){return new yc}class yc{constructor(){Q(this,yr,void 0)}get queryId(){return s(this,yr)===void 0&&K(this,yr,_c(8)),s(this,yr)}}yr=new WeakMap;function sf(t){return t}class uo{constructor(){De(this,"nodeStack",[]);Q(this,bs,h({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),h(r)}transformNodeImpl(e){return s(this,bs)[e.kind](e)}transformNodeList(e){return e&&h(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:h([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}bs=new WeakMap;const gc=h({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});class wc extends uo{constructor(r){super();Q(this,qs);Q(this,Ns);Q(this,vs);Q(this,Vn);Q(this,ui);Q(this,xs);Q(this,gr,void 0);Q(this,jn,new Set);Q(this,zn,new Set);K(this,gr,r)}transformNodeImpl(r){if(!Pe(this,qs,Sl).call(this,r))return super.transformNodeImpl(r);const n=Pe(this,vs,kl).call(this,r);for(const te of n)s(this,zn).add(te);const x=Pe(this,Ns,Al).call(this,r);for(const te of x)s(this,jn).add(te);const R=super.transformNodeImpl(r);for(const te of x)s(this,jn).delete(te);for(const te of n)s(this,zn).delete(te);return R}transformSchemableIdentifier(r){const n=super.transformSchemableIdentifier(r);return n.schema||!s(this,jn).has(r.identifier.name)?n:{...n,schema:Je.create(s(this,gr))}}transformReferences(r){const n=super.transformReferences(r);return n.table.table.schema?n:{...n,table:vn.createWithSchema(s(this,gr),n.table.table.identifier.name)}}}gr=new WeakMap,jn=new WeakMap,zn=new WeakMap,qs=new WeakSet,Sl=function(r){return r.kind in gc},Ns=new WeakSet,Al=function(r){const n=new Set;if("name"in r&&r.name&&qn.is(r.name)&&Pe(this,ui,Mo).call(this,r.name,n),"from"in r&&r.from)for(const x of r.from.froms)Pe(this,Vn,Oi).call(this,x,n);if("into"in r&&r.into&&Pe(this,Vn,Oi).call(this,r.into,n),"table"in r&&r.table&&Pe(this,Vn,Oi).call(this,r.table,n),"joins"in r&&r.joins)for(const x of r.joins)Pe(this,Vn,Oi).call(this,x.table,n);return n},vs=new WeakSet,kl=function(r){const n=new Set;return"with"in r&&r.with&&Pe(this,xs,Il).call(this,r.with,n),n},Vn=new WeakSet,Oi=function(r,n){const x=vn.is(r)?r:Nn.is(r)&&vn.is(r.node)?r.node:null;x&&Pe(this,ui,Mo).call(this,x.table,n)},ui=new WeakSet,Mo=function(r,n){const x=r.identifier.name;!s(this,jn).has(x)&&!s(this,zn).has(x)&&n.add(x)},xs=new WeakSet,Il=function(r,n){for(const x of r.expressions){const R=x.name.table.table.identifier.name;s(this,zn).has(R)||n.add(R)}};class Yr{constructor(e){Q(this,di,void 0);K(this,di,new wc(e))}transformQuery(e){return s(this,di).transformNode(e.node)}async transformResult(e){return e.result}}di=new WeakMap;const $n=class $n{constructor(e){Q(this,Me,void 0);K(this,Me,h(e))}selectFrom(e){return Gi({queryId:Re(),executor:s(this,Me).executor,queryNode:Ie.createFrom(ti(e),s(this,Me).withNode)})}selectNoFrom(e){return Gi({queryId:Re(),executor:s(this,Me).executor,queryNode:Ie.cloneWithSelections(Ie.create(s(this,Me).withNode),Qn(e))})}insertInto(e){return new Xr({queryId:Re(),executor:s(this,Me).executor,queryNode:Kt.create(kt(e),s(this,Me).withNode)})}replaceInto(e){return new Xr({queryId:Re(),executor:s(this,Me).executor,queryNode:Kt.create(kt(e),s(this,Me).withNode,!0)})}deleteFrom(e){return new Ui({queryId:Re(),executor:s(this,Me).executor,queryNode:Kr.create(ti(e),s(this,Me).withNode)})}updateTable(e){return new ji({queryId:Re(),executor:s(this,Me).executor,queryNode:Di.create(ni(e),s(this,Me).withNode)})}with(e,r){const n=ma(e,r);return new $n({...s(this,Me),withNode:s(this,Me).withNode?$i.cloneWithExpression(s(this,Me).withNode,n):$i.create(n)})}withRecursive(e,r){const n=ma(e,r);return new $n({...s(this,Me),withNode:s(this,Me).withNode?$i.cloneWithExpression(s(this,Me).withNode,n):$i.create(n,{recursive:!0})})}withPlugin(e){return new $n({...s(this,Me),executor:s(this,Me).executor.withPlugin(e)})}withoutPlugins(){return new $n({...s(this,Me),executor:s(this,Me).executor.withoutPlugins()})}withSchema(e){return new $n({...s(this,Me),executor:s(this,Me).executor.withPluginAtFront(new Yr(e))})}};Me=new WeakMap;let Hi=$n;class wa{constructor(){Q(this,fi,void 0);Q(this,wr,void 0);Q(this,br,void 0);De(this,"resolve",e=>{s(this,wr)&&s(this,wr).call(this,e)});De(this,"reject",e=>{s(this,br)&&s(this,br).call(this,e)});K(this,fi,new Promise((e,r)=>{K(this,br,r),K(this,wr,e)}))}get promise(){return s(this,fi)}}fi=new WeakMap,wr=new WeakMap,br=new WeakMap;const ba=new Set;function bc(t){ba.has(t)||(ba.add(t),console.log(t))}const qc=h([]);class qa{constructor(e=qc){Q(this,hi);Q(this,Hn,void 0);K(this,Hn,e)}get plugins(){return s(this,Hn)}transformQuery(e,r){for(const n of s(this,Hn)){const x=n.transformQuery({node:e,queryId:r});if(x.kind===e.kind)e=x;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${x.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async n=>{const x=await n.executeQuery(e),R=await Pe(this,hi,Bo).call(this,x,r);return Nc(x,R),R})}async*stream(e,r,n){const x=new wa,R=new wa;this.provideConnection(async pe=>(x.resolve(pe),await R.promise)).catch(pe=>x.reject(pe));const te=await x.promise;try{for await(const pe of te.streamQuery(e,r))yield await Pe(this,hi,Bo).call(this,pe,n)}finally{R.resolve()}}}Hn=new WeakMap,hi=new WeakSet,Bo=async function(e,r){for(const n of s(this,Hn))e=await n.transformResult({result:e,queryId:r});return e};function Nc(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||bc("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class cr extends qa{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new cr([...this.plugins,e])}withPlugins(e){return new cr([...this.plugins,...e])}withPluginAtFront(e){return new cr([e,...this.plugins])}withoutPlugins(){return new cr([])}}const fo=new cr;function vc(){return new Hi({executor:fo})}function xc(t,e){return new Li({joinNode:zr.create(t,ni(e))})}function Ec(){return new Wi({overNode:lo.create()})}function At(t,e){if(e.length===3)return Ac(t,e[0],e[1],e[2]);if(e.length===2)return Sc(t,e[0],e[1]);throw new Error("not implemented")}function Sc(t,e,r){return r(xc(t,e)).toOperationNode()}function Ac(t,e,r,n){return zr.createWithOn(t,ni(e),ln(r,"=",n))}const kc=h({is(t){return t.kind==="OffsetNode"},create(t){return h({kind:"OffsetNode",offset:Gt.create(t)})}}),Ic=h({is(t){return t.kind==="GroupByItemNode"},create(t){return h({kind:"GroupByItemNode",groupBy:t})}});function Oc(t){return t=Ot(t)?t(fr()):t,$r(t).map(Ic.create)}const Na=h({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return h({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function ur(t,e,r){return Ot(e)&&(e=e(go())),wn(e)||(e=[e]),e.map(n=>Na.create(t,hr(n),r))}const Ao=class Ao{constructor(e){Q(this,In,void 0);K(this,In,e)}get expressionType(){}as(e){return new ho(this,e)}or(...e){return new po(or.create(s(this,In),mt(e)))}and(...e){return new _o(xn.create(s(this,In),mt(e)))}$castTo(){return new Ao(s(this,In))}toOperationNode(){return s(this,In)}};In=new WeakMap;let $e=Ao;class ho{constructor(e,r){Q(this,qr,void 0);Q(this,On,void 0);K(this,qr,e),K(this,On,r)}get expression(){return s(this,qr)}get alias(){return s(this,On)}toOperationNode(){return Nn.create(s(this,qr).toOperationNode(),Dt(s(this,On))?s(this,On).toOperationNode():Je.create(s(this,On)))}}qr=new WeakMap,On=new WeakMap;const Es=class Es{constructor(e){Q(this,Jn,void 0);K(this,Jn,e)}get expressionType(){}as(e){return new ho(this,e)}or(...e){return new Es(or.create(s(this,Jn),mt(e)))}$castTo(){return new Es(s(this,Jn))}toOperationNode(){return ar.create(s(this,Jn))}};Jn=new WeakMap;let po=Es;const Ss=class Ss{constructor(e){Q(this,Gn,void 0);K(this,Gn,e)}get expressionType(){}as(e){return new ho(this,e)}and(...e){return new Ss(xn.create(s(this,Gn),mt(e)))}$castTo(){return new Ss(s(this,Gn))}toOperationNode(){return ar.create(s(this,Gn))}};Gn=new WeakMap;let _o=Ss;const me=class me{constructor(e){Q(this,Y,void 0);K(this,Y,h(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new me({...s(this,Y),queryNode:ve.cloneWithWhere(s(this,Y).queryNode,mt(e))})}whereRef(e,r,n){return new me({...s(this,Y),queryNode:ve.cloneWithWhere(s(this,Y).queryNode,ln(e,r,n))})}having(...e){return new me({...s(this,Y),queryNode:Ie.cloneWithHaving(s(this,Y).queryNode,mt(e))})}havingRef(e,r,n){return new me({...s(this,Y),queryNode:Ie.cloneWithHaving(s(this,Y).queryNode,ln(e,r,n))})}select(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSelections(s(this,Y).queryNode,Qn(e))})}distinctOn(e){return new me({...s(this,Y),queryNode:Ie.cloneWithDistinctOn(s(this,Y).queryNode,$r(e))})}modifyFront(e){return new me({...s(this,Y),queryNode:Ie.cloneWithFrontModifier(s(this,Y).queryNode,on.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.createWithExpression(e.toOperationNode()))})}distinct(){return new me({...s(this,Y),queryNode:Ie.cloneWithFrontModifier(s(this,Y).queryNode,on.create("Distinct"))})}forUpdate(){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForUpdate"))})}forShare(){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForShare"))})}forKeyShare(){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForKeyShare"))})}forNoKeyUpdate(){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForNoKeyUpdate"))})}skipLocked(){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.create("SkipLocked"))})}noWait(){return new me({...s(this,Y),queryNode:Ie.cloneWithEndModifier(s(this,Y).queryNode,on.create("NoWait"))})}selectAll(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSelections(s(this,Y).queryNode,Gr(e))})}innerJoin(...e){return new me({...s(this,Y),queryNode:ve.cloneWithJoin(s(this,Y).queryNode,At("InnerJoin",e))})}leftJoin(...e){return new me({...s(this,Y),queryNode:ve.cloneWithJoin(s(this,Y).queryNode,At("LeftJoin",e))})}rightJoin(...e){return new me({...s(this,Y),queryNode:ve.cloneWithJoin(s(this,Y).queryNode,At("RightJoin",e))})}fullJoin(...e){return new me({...s(this,Y),queryNode:ve.cloneWithJoin(s(this,Y).queryNode,At("FullJoin",e))})}innerJoinLateral(...e){return new me({...s(this,Y),queryNode:ve.cloneWithJoin(s(this,Y).queryNode,At("LateralInnerJoin",e))})}leftJoinLateral(...e){return new me({...s(this,Y),queryNode:ve.cloneWithJoin(s(this,Y).queryNode,At("LateralLeftJoin",e))})}orderBy(...e){return new me({...s(this,Y),queryNode:Ie.cloneWithOrderByItems(s(this,Y).queryNode,Pi(e))})}groupBy(e){return new me({...s(this,Y),queryNode:Ie.cloneWithGroupByItems(s(this,Y).queryNode,Oc(e))})}limit(e){return new me({...s(this,Y),queryNode:Ie.cloneWithLimit(s(this,Y).queryNode,pa.create(e))})}offset(e){return new me({...s(this,Y),queryNode:Ie.cloneWithOffset(s(this,Y).queryNode,kc.create(e))})}union(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSetOperations(s(this,Y).queryNode,ur("union",e,!1))})}unionAll(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSetOperations(s(this,Y).queryNode,ur("union",e,!0))})}intersect(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSetOperations(s(this,Y).queryNode,ur("intersect",e,!1))})}intersectAll(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSetOperations(s(this,Y).queryNode,ur("intersect",e,!0))})}except(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSetOperations(s(this,Y).queryNode,ur("except",e,!1))})}exceptAll(e){return new me({...s(this,Y),queryNode:Ie.cloneWithSetOperations(s(this,Y).queryNode,ur("except",e,!0))})}as(e){return new va(this,e)}clearSelect(){return new me({...s(this,Y),queryNode:Ie.cloneWithoutSelections(s(this,Y).queryNode)})}clearWhere(){return new me({...s(this,Y),queryNode:ve.cloneWithoutWhere(s(this,Y).queryNode)})}clearLimit(){return new me({...s(this,Y),queryNode:Ie.cloneWithoutLimit(s(this,Y).queryNode)})}clearOffset(){return new me({...s(this,Y),queryNode:Ie.cloneWithoutOffset(s(this,Y).queryNode)})}clearOrderBy(){return new me({...s(this,Y),queryNode:Ie.cloneWithoutOrderBy(s(this,Y).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new me({...s(this,Y)})}$castTo(){return new me(s(this,Y))}$narrowType(){return new me(s(this,Y))}$assertType(){return new me(s(this,Y))}$asTuple(){return new $e(this.toOperationNode())}withPlugin(e){return new me({...s(this,Y),executor:s(this,Y).executor.withPlugin(e)})}toOperationNode(){return s(this,Y).executor.transformQuery(s(this,Y).queryNode,s(this,Y).queryId)}compile(){return s(this,Y).executor.compileQuery(this.toOperationNode(),s(this,Y).queryId)}async execute(){const e=this.compile();return(await s(this,Y).executor.executeQuery(e,s(this,Y).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Ri){const r=await this.executeTakeFirst();if(r===void 0)throw Mi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,Y).executor.stream(r,e,s(this,Y).queryId);for await(const x of n)yield*x.rows}async explain(e,r){return await new me({...s(this,Y),queryNode:ve.cloneWithExplain(s(this,Y).queryNode,e,r)}).execute()}};Y=new WeakMap;let Ji=me;Te(Ji,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function Gi(t){return new Ji(t)}class va{constructor(e,r){Q(this,Nr,void 0);Q(this,vr,void 0);K(this,Nr,e),K(this,vr,r)}get expression(){return s(this,Nr)}get alias(){return s(this,vr)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Nn.create(s(this,Nr).toOperationNode(),Je.create(s(this,vr)))}}Nr=new WeakMap,vr=new WeakMap,Te(va,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const dr=h({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return h({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return h({...t,distinct:!0})},cloneWithFilter(t,e){return h({...t,filter:t.filter?St.cloneWithOperation(t.filter,"And",e):St.create(e)})},cloneWithOrFilter(t,e){return h({...t,filter:t.filter?St.cloneWithOperation(t.filter,"Or",e):St.create(e)})},cloneWithOver(t,e){return h({...t,over:e})}}),Tc=h({is(t){return t.kind==="FunctionNode"},create(t,e){return h({kind:"FunctionNode",func:t,arguments:e})}}),xr=class xr{constructor(e){Q(this,Ct,void 0);K(this,Ct,h(e))}get expressionType(){}as(e){return new Cc(this,e)}distinct(){return new xr({...s(this,Ct),aggregateFunctionNode:dr.cloneWithDistinct(s(this,Ct).aggregateFunctionNode)})}filterWhere(...e){return new xr({...s(this,Ct),aggregateFunctionNode:dr.cloneWithFilter(s(this,Ct).aggregateFunctionNode,mt(e))})}filterWhereRef(e,r,n){return new xr({...s(this,Ct),aggregateFunctionNode:dr.cloneWithFilter(s(this,Ct).aggregateFunctionNode,ln(e,r,n))})}over(e){const r=Ec();return new xr({...s(this,Ct),aggregateFunctionNode:dr.cloneWithOver(s(this,Ct).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return s(this,Ct).aggregateFunctionNode}};Ct=new WeakMap;let Zr=xr;Te(Zr,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Cc{constructor(e,r){Q(this,Er,void 0);Q(this,Sr,void 0);K(this,Er,e),K(this,Sr,r)}get expression(){return s(this,Er)}get alias(){return s(this,Sr)}toOperationNode(){return Nn.create(s(this,Er).toOperationNode(),Je.create(s(this,Sr)))}}Er=new WeakMap,Sr=new WeakMap;function xa(){const t=(r,n)=>new $e(Tc.create(r,$r(n))),e=(r,n)=>new Zr({aggregateFunctionNode:dr.create(r,n?$r(n):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(r,...n){return t("coalesce",[r,...n])},count(r){return e("count",[r])},countAll(r){return new Zr({aggregateFunctionNode:dr.create("count",Gr(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])}})}const Pc=h({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return h({kind:"UnaryOperationNode",operator:t,operand:e})}});function Fc(t,e){return Pc.create(Bn.create(t),Qt(e))}const mo=h({is(t){return t.kind==="WhenNode"},create(t){return h({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return h({...t,result:e})}}),Xt=h({is(t){return t.kind==="CaseNode"},create(t){return h({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return h({...t,when:h(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return h({...t,when:t.when?h([...t.when.slice(0,-1),mo.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return h({...t,...e})}});class Ea{constructor(e){Q(this,Ar,void 0);K(this,Ar,h(e))}when(...e){return new Sa({...s(this,Ar),node:Xt.cloneWithWhen(s(this,Ar).node,mo.create(mt(e)))})}}Ar=new WeakMap;class Sa{constructor(e){Q(this,kr,void 0);K(this,kr,h(e))}then(e){return new Lc({...s(this,kr),node:Xt.cloneWithThen(s(this,kr).node,io(e)?so(e):Nt(e))})}}kr=new WeakMap;class Lc{constructor(e){Q(this,Yt,void 0);K(this,Yt,h(e))}when(...e){return new Sa({...s(this,Yt),node:Xt.cloneWithWhen(s(this,Yt).node,mo.create(mt(e)))})}else(e){return new Wc({...s(this,Yt),node:Xt.cloneWith(s(this,Yt).node,{else:io(e)?so(e):Nt(e)})})}end(){return new $e(Xt.cloneWith(s(this,Yt).node,{isStatement:!1}))}endCase(){return new $e(Xt.cloneWith(s(this,Yt).node,{isStatement:!0}))}}Yt=new WeakMap;class Wc{constructor(e){Q(this,Ir,void 0);K(this,Ir,h(e))}end(){return new $e(Xt.cloneWith(s(this,Ir).node,{isStatement:!1}))}endCase(){return new $e(Xt.cloneWith(s(this,Ir).node,{isStatement:!0}))}}Ir=new WeakMap;const Dc=h({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return h({kind:"JSONPathLegNode",type:t,value:e})}});class yo{constructor(e){Q(this,pi);Q(this,Tn,void 0);K(this,Tn,e)}at(e){return Pe(this,pi,Qo).call(this,"ArrayLocation",e)}key(e){return Pe(this,pi,Qo).call(this,"Member",e)}}Tn=new WeakMap,pi=new WeakSet,Qo=function(e,r){return new Rc(eo.cloneWithTraversal(s(this,Tn),to.is(s(this,Tn).traversal)?to.cloneWithLeg(s(this,Tn).traversal,Dc.create(e,r)):Xo.cloneWithValue(s(this,Tn).traversal,Gt.createImmediate(r))))};class Rc extends yo{constructor(r){super(r);Q(this,Or,void 0);K(this,Or,r)}get expressionType(){}as(r){return new Mc(this,r)}$castTo(){return new yo(s(this,Or))}toOperationNode(){return s(this,Or)}}Or=new WeakMap;class Mc{constructor(e,r){Q(this,Tr,void 0);Q(this,Cn,void 0);K(this,Tr,e),K(this,Cn,r)}get expression(){return s(this,Tr)}get alias(){return s(this,Cn)}toOperationNode(){return Nn.create(s(this,Tr).toOperationNode(),Dt(s(this,Cn))?s(this,Cn).toOperationNode():Je.create(s(this,Cn)))}}Tr=new WeakMap,Cn=new WeakMap;const Aa=h({is(t){return t.kind==="TupleNode"},create(t){return h({kind:"TupleNode",values:h(t)})}});function go(t=fo){function e(x,R,te){return new $e(Hr(x,R,te))}function r(x,R){return new $e(Fc(x,R))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(x){return Gi({queryId:Re(),executor:t,queryNode:Ie.createFrom(ti(x))})},selectNoFrom(x){return Gi({queryId:Re(),executor:t,queryNode:Ie.cloneWithSelections(Ie.create(),Qn(x))})},case(x){return new Ea({node:Xt.create(We(x)?void 0:Qt(x))})},ref(x,R){return We(R)?new $e(an(x)):new yo(Jl(x,R))},val(x){return new $e(na(x))},refTuple(...x){return new $e(Aa.create(x.map(Qt)))},tuple(...x){return new $e(Aa.create(x.map(Nt)))},lit(x){return new $e(so(x))},cmpr(x,R,te){return new $e(Hr(x,R,te))},bxp(x,R,te){return new $e(Hr(x,R,te))},unary:r,not(x){return r("not",x)},exists(x){return r("exists",x)},neg(x){return r("-",x)},between(x,R,te){return new $e(Vr.create(Qt(x),Bn.create("between"),xn.create(Nt(R),Nt(te))))},betweenSymmetric(x,R,te){return new $e(Vr.create(Qt(x),Bn.create("between symmetric"),xn.create(Nt(R),Nt(te))))},and(x){return wn(x)?new $e(oo(x,"and")):new $e(ra(x,"and"))},or(x){return wn(x)?new $e(oo(x,"or")):new $e(ra(x,"or"))},parens(...x){const R=mt(x);return ar.is(R)?new $e(R):new $e(ar.create(R))},withSchema(x){return go(t.withPluginAtFront(new Yr(x)))}});return n.fn=xa(),n.eb=n,n}function fr(t){return go()}function hr(t){if(Dt(t))return t.toOperationNode();if(Ot(t))return t(fr()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function ka(t){if(Dt(t))return t.toOperationNode();if(Ot(t))return t(fr()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function ei(t){return Ml(t)||Bl(t)||Ot(t)}function ti(t){return wn(t)?t.map(e=>ni(e)):[ni(t)]}function ni(t){return Ce(t)?Bc(t):ka(t)}function Bc(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(Ia);return Nn.create(kt(r),Je.create(n))}else return kt(t)}function kt(t){const e=".";if(t.includes(e)){const[r,n]=t.split(e).map(Ia);return vn.createWithSchema(r,n)}else return vn.create(t)}function Ia(t){return t.trim()}const Oa=h({is(t){return t.kind==="AddColumnNode"},create(t){return h({kind:"AddColumnNode",column:t})}}),nt=h({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return h({kind:"ColumnDefinitionNode",column:tt.create(t),dataType:e})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):[e]})},cloneWith(t,e){return h({...t,...e})}}),Ta=h({is(t){return t.kind==="DropColumnNode"},create(t){return h({kind:"DropColumnNode",column:tt.create(t)})}}),Ca=h({is(t){return t.kind==="RenameColumnNode"},create(t,e){return h({kind:"RenameColumnNode",column:tt.create(t),renameTo:tt.create(e)})}}),wo=h({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return h({kind:"CheckConstraintNode",expression:t,name:e?Je.create(e):void 0})}}),Qc=["no action","restrict","cascade","set null","set default"],Ki=h({is(t){return t.kind==="ReferencesNode"},create(t,e){return h({kind:"ReferencesNode",table:t,columns:h([...e])})},cloneWithOnDelete(t,e){return h({...t,onDelete:e})},cloneWithOnUpdate(t,e){return h({...t,onUpdate:e})}});function Pa(t){return Dt(t)?t.toOperationNode():Gt.createImmediate(t)}const Xi=h({is(t){return t.kind==="GeneratedNode"},create(t){return h({kind:"GeneratedNode",...t})},createWithExpression(t){return h({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return h({...t,...e})}}),Uc=h({is(t){return t.kind==="DefaultValueNode"},create(t){return h({kind:"DefaultValueNode",defaultValue:t})}});function Yi(t){if(Qc.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}const lt=class lt{constructor(e){Q(this,Qe,void 0);K(this,Qe,e)}autoIncrement(){return new lt(nt.cloneWith(s(this,Qe),{autoIncrement:!0}))}primaryKey(){return new lt(nt.cloneWith(s(this,Qe),{primaryKey:!0}))}references(e){const r=an(e);if(!r.table||Xs.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new lt(nt.cloneWith(s(this,Qe),{references:Ki.create(r.table,[r.column])}))}onDelete(e){if(!s(this,Qe).references)throw new Error("on delete constraint can only be added for foreign keys");return new lt(nt.cloneWith(s(this,Qe),{references:Ki.cloneWithOnDelete(s(this,Qe).references,Yi(e))}))}onUpdate(e){if(!s(this,Qe).references)throw new Error("on update constraint can only be added for foreign keys");return new lt(nt.cloneWith(s(this,Qe),{references:Ki.cloneWithOnUpdate(s(this,Qe).references,Yi(e))}))}unique(){return new lt(nt.cloneWith(s(this,Qe),{unique:!0}))}notNull(){return new lt(nt.cloneWith(s(this,Qe),{notNull:!0}))}unsigned(){return new lt(nt.cloneWith(s(this,Qe),{unsigned:!0}))}defaultTo(e){return new lt(nt.cloneWith(s(this,Qe),{defaultTo:Uc.create(Pa(e))}))}check(e){return new lt(nt.cloneWith(s(this,Qe),{check:wo.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new lt(nt.cloneWith(s(this,Qe),{generated:Xi.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new lt(nt.cloneWith(s(this,Qe),{generated:Xi.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new lt(nt.cloneWith(s(this,Qe),{generated:Xi.create({identity:!0,byDefault:!0})}))}stored(){if(!s(this,Qe).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new lt(nt.cloneWith(s(this,Qe),{generated:Xi.cloneWith(s(this,Qe).generated,{stored:!0})}))}modifyFront(e){return new lt(nt.cloneWithFrontModifier(s(this,Qe),e.toOperationNode()))}modifyEnd(e){return new lt(nt.cloneWithEndModifier(s(this,Qe),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return s(this,Qe)}};Qe=new WeakMap;let En=lt;Te(En,"don't await ColumnDefinitionBuilder instances directly.");const Fa=h({is(t){return t.kind==="ModifyColumnNode"},create(t){return h({kind:"ModifyColumnNode",column:t})}}),jc=h({is(t){return t.kind==="DataTypeNode"},create(t){return h({kind:"DataTypeNode",dataType:t})}});function pr(t){return Dt(t)?t.toOperationNode():jc.create(t)}const Zi=h({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,n){return h({kind:"ForeignKeyConstraintNode",columns:t,references:Ki.create(e,r),name:n?Je.create(n):void 0})},cloneWith(t,e){return h({...t,...e})}}),As=class As{constructor(e){Q(this,Kn,void 0);K(this,Kn,e)}onDelete(e){return new As(Zi.cloneWith(s(this,Kn),{onDelete:Yi(e)}))}onUpdate(e){return new As(Zi.cloneWith(s(this,Kn),{onUpdate:Yi(e)}))}$call(e){return e(this)}toOperationNode(){return s(this,Kn)}};Kn=new WeakMap;let ri=As;Te(ri,"don't await ForeignKeyConstraintBuilder instances directly.");const es=h({is(t){return t.kind==="AddConstraintNode"},create(t){return h({kind:"AddConstraintNode",constraint:t})}}),La=h({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return h({kind:"UniqueConstraintNode",columns:h(t.map(tt.create)),name:e?Je.create(e):void 0})}}),ts=h({is(t){return t.kind==="DropConstraintNode"},create(t){return h({kind:"DropConstraintNode",constraintName:Je.create(t)})},cloneWith(t,e){return h({...t,...e})}}),ii=h({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return h({kind:"AlterColumnNode",column:tt.create(t),[e]:r})}});class bo{constructor(e){Q(this,fn,void 0);K(this,fn,e)}setDataType(e){return new si(ii.create(s(this,fn),"dataType",pr(e)))}setDefault(e){return new si(ii.create(s(this,fn),"setDefault",Pa(e)))}dropDefault(){return new si(ii.create(s(this,fn),"dropDefault",!0))}setNotNull(){return new si(ii.create(s(this,fn),"setNotNull",!0))}dropNotNull(){return new si(ii.create(s(this,fn),"dropNotNull",!0))}$call(e){return e(this)}}fn=new WeakMap;class si{constructor(e){Q(this,_i,void 0);K(this,_i,e)}toOperationNode(){return s(this,_i)}}_i=new WeakMap;class _r{constructor(e){Q(this,zt,void 0);K(this,zt,h(e))}toOperationNode(){return s(this,zt).executor.transformQuery(s(this,zt).node,s(this,zt).queryId)}compile(){return s(this,zt).executor.compileQuery(this.toOperationNode(),s(this,zt).queryId)}async execute(){await s(this,zt).executor.executeQuery(this.compile(),s(this,zt).queryId)}}zt=new WeakMap,Te(_r,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");const ks=class ks{constructor(e){Q(this,gt,void 0);K(this,gt,h(e))}onDelete(e){return new ks({...s(this,gt),constraintBuilder:s(this,gt).constraintBuilder.onDelete(e)})}onUpdate(e){return new ks({...s(this,gt),constraintBuilder:s(this,gt).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return s(this,gt).executor.transformQuery(et.cloneWithTableProps(s(this,gt).node,{addConstraint:es.create(s(this,gt).constraintBuilder.toOperationNode())}),s(this,gt).queryId)}compile(){return s(this,gt).executor.compileQuery(this.toOperationNode(),s(this,gt).queryId)}async execute(){await s(this,gt).executor.executeQuery(this.compile(),s(this,gt).queryId)}};gt=new WeakMap;let ns=ks;Te(ns,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");const mi=class mi{constructor(e){Q(this,ot,void 0);K(this,ot,h(e))}ifExists(){return new mi({...s(this,ot),node:et.cloneWithTableProps(s(this,ot).node,{dropConstraint:ts.cloneWith(s(this,ot).node.dropConstraint,{ifExists:!0})})})}cascade(){return new mi({...s(this,ot),node:et.cloneWithTableProps(s(this,ot).node,{dropConstraint:ts.cloneWith(s(this,ot).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new mi({...s(this,ot),node:et.cloneWithTableProps(s(this,ot).node,{dropConstraint:ts.cloneWith(s(this,ot).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return s(this,ot).executor.transformQuery(s(this,ot).node,s(this,ot).queryId)}compile(){return s(this,ot).executor.compileQuery(this.toOperationNode(),s(this,ot).queryId)}async execute(){await s(this,ot).executor.executeQuery(this.compile(),s(this,ot).queryId)}};ot=new WeakMap;let rs=mi;Te(rs,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const Wa=h({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return h({kind:"PrimaryKeyConstraintNode",columns:h(t.map(tt.create)),name:e?Je.create(e):void 0})}});class Da{constructor(e){Q(this,Ue,void 0);K(this,Ue,h(e))}renameTo(e){return new _r({...s(this,Ue),node:et.cloneWithTableProps(s(this,Ue).node,{renameTo:kt(e)})})}setSchema(e){return new _r({...s(this,Ue),node:et.cloneWithTableProps(s(this,Ue).node,{setSchema:Je.create(e)})})}alterColumn(e,r){const n=r(new bo(e));return new Sn({...s(this,Ue),node:et.cloneWithColumnAlteration(s(this,Ue).node,n.toOperationNode())})}dropColumn(e){return new Sn({...s(this,Ue),node:et.cloneWithColumnAlteration(s(this,Ue).node,Ta.create(e))})}renameColumn(e,r){return new Sn({...s(this,Ue),node:et.cloneWithColumnAlteration(s(this,Ue).node,Ca.create(e,r))})}addColumn(e,r,n=sr){const x=n(new En(nt.create(e,pr(r))));return new Sn({...s(this,Ue),node:et.cloneWithColumnAlteration(s(this,Ue).node,Oa.create(x.toOperationNode()))})}modifyColumn(e,r,n=sr){const x=n(new En(nt.create(e,pr(r))));return new Sn({...s(this,Ue),node:et.cloneWithColumnAlteration(s(this,Ue).node,Fa.create(x.toOperationNode()))})}addUniqueConstraint(e,r){return new _r({...s(this,Ue),node:et.cloneWithTableProps(s(this,Ue).node,{addConstraint:es.create(La.create(r,e))})})}addCheckConstraint(e,r){return new _r({...s(this,Ue),node:et.cloneWithTableProps(s(this,Ue).node,{addConstraint:es.create(wo.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,n,x){return new ns({...s(this,Ue),constraintBuilder:new ri(Zi.create(r.map(tt.create),kt(n),x.map(tt.create),e))})}addPrimaryKeyConstraint(e,r){return new _r({...s(this,Ue),node:et.cloneWithTableProps(s(this,Ue).node,{addConstraint:es.create(Wa.create(r,e))})})}dropConstraint(e){return new rs({...s(this,Ue),node:et.cloneWithTableProps(s(this,Ue).node,{dropConstraint:ts.create(e)})})}$call(e){return e(this)}}Ue=new WeakMap;const Xn=class Xn{constructor(e){Q(this,rt,void 0);K(this,rt,h(e))}alterColumn(e,r){const n=r(new bo(e));return new Xn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,n.toOperationNode())})}dropColumn(e){return new Xn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Ta.create(e))})}renameColumn(e,r){return new Xn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Ca.create(e,r))})}addColumn(e,r,n=sr){const x=n(new En(nt.create(e,pr(r))));return new Xn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Oa.create(x.toOperationNode()))})}modifyColumn(e,r,n=sr){const x=n(new En(nt.create(e,pr(r))));return new Xn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Fa.create(x.toOperationNode()))})}toOperationNode(){return s(this,rt).executor.transformQuery(s(this,rt).node,s(this,rt).queryId)}compile(){return s(this,rt).executor.compileQuery(this.toOperationNode(),s(this,rt).queryId)}async execute(){await s(this,rt).executor.executeQuery(this.compile(),s(this,rt).queryId)}};rt=new WeakMap;let Sn=Xn;Te(Da,"don't await AlterTableBuilder instances"),Te(bo,"don't await AlterColumnBuilder instances"),Te(Sn,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Ra extends uo{transformValue(e){return{...super.transformValue(e),immediate:!0}}}const Zt=class Zt{constructor(e){Q(this,je,void 0);K(this,je,h(e))}ifNotExists(){return new Zt({...s(this,je),node:bn.cloneWith(s(this,je).node,{ifNotExists:!0})})}unique(){return new Zt({...s(this,je),node:bn.cloneWith(s(this,je).node,{unique:!0})})}on(e){return new Zt({...s(this,je),node:bn.cloneWith(s(this,je).node,{table:kt(e)})})}column(e){return new Zt({...s(this,je),node:bn.cloneWithColumns(s(this,je).node,[ea(e)])})}columns(e){return new Zt({...s(this,je),node:bn.cloneWithColumns(s(this,je).node,e.map(ea))})}expression(e){return new Zt({...s(this,je),node:bn.cloneWithColumns(s(this,je).node,[e.toOperationNode()])})}using(e){return new Zt({...s(this,je),node:bn.cloneWith(s(this,je).node,{using:qt.createWithSql(e)})})}where(...e){const r=new Ra;return new Zt({...s(this,je),node:ve.cloneWithWhere(s(this,je).node,r.transformNode(mt(e)))})}$call(e){return e(this)}toOperationNode(){return s(this,je).executor.transformQuery(s(this,je).node,s(this,je).queryId)}compile(){return s(this,je).executor.compileQuery(this.toOperationNode(),s(this,je).queryId)}async execute(){await s(this,je).executor.executeQuery(this.compile(),s(this,je).queryId)}};je=new WeakMap;let is=Zt;Te(is,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");const ko=class ko{constructor(e){Q(this,Pt,void 0);K(this,Pt,h(e))}ifNotExists(){return new ko({...s(this,Pt),node:Vo.cloneWith(s(this,Pt).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Pt).executor.transformQuery(s(this,Pt).node,s(this,Pt).queryId)}compile(){return s(this,Pt).executor.compileQuery(this.toOperationNode(),s(this,Pt).queryId)}async execute(){await s(this,Pt).executor.executeQuery(this.compile(),s(this,Pt).queryId)}};Pt=new WeakMap;let ss=ko;Te(ss,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function zc(t){if(Rl.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}const Rt=class Rt{constructor(e){Q(this,Le,void 0);K(this,Le,h(e))}temporary(){return new Rt({...s(this,Le),node:Bt.cloneWith(s(this,Le).node,{temporary:!0})})}onCommit(e){return new Rt({...s(this,Le),node:Bt.cloneWith(s(this,Le).node,{onCommit:zc(e)})})}ifNotExists(){return new Rt({...s(this,Le),node:Bt.cloneWith(s(this,Le).node,{ifNotExists:!0})})}addColumn(e,r,n=sr){const x=n(new En(nt.create(e,pr(r))));return new Rt({...s(this,Le),node:Bt.cloneWithColumn(s(this,Le).node,x.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Rt({...s(this,Le),node:Bt.cloneWithConstraint(s(this,Le).node,Wa.create(r,e))})}addUniqueConstraint(e,r){return new Rt({...s(this,Le),node:Bt.cloneWithConstraint(s(this,Le).node,La.create(r,e))})}addCheckConstraint(e,r){return new Rt({...s(this,Le),node:Bt.cloneWithConstraint(s(this,Le).node,wo.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,n,x,R=sr){const te=R(new ri(Zi.create(r.map(tt.create),kt(n),x.map(tt.create),e)));return new Rt({...s(this,Le),node:Bt.cloneWithConstraint(s(this,Le).node,te.toOperationNode())})}modifyFront(e){return new Rt({...s(this,Le),node:Bt.cloneWithFrontModifier(s(this,Le).node,e.toOperationNode())})}modifyEnd(e){return new Rt({...s(this,Le),node:Bt.cloneWithEndModifier(s(this,Le).node,e.toOperationNode())})}$call(e){return e(this)}toOperationNode(){return s(this,Le).executor.transformQuery(s(this,Le).node,s(this,Le).queryId)}compile(){return s(this,Le).executor.compileQuery(this.toOperationNode(),s(this,Le).queryId)}async execute(){await s(this,Le).executor.executeQuery(this.compile(),s(this,Le).queryId)}};Le=new WeakMap;let os=Rt;Te(os,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");const yi=class yi{constructor(e){Q(this,ft,void 0);K(this,ft,h(e))}on(e){return new yi({...s(this,ft),node:Ti.cloneWith(s(this,ft).node,{table:kt(e)})})}ifExists(){return new yi({...s(this,ft),node:Ti.cloneWith(s(this,ft).node,{ifExists:!0})})}cascade(){return new yi({...s(this,ft),node:Ti.cloneWith(s(this,ft).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ft).executor.transformQuery(s(this,ft).node,s(this,ft).queryId)}compile(){return s(this,ft).executor.compileQuery(this.toOperationNode(),s(this,ft).queryId)}async execute(){await s(this,ft).executor.executeQuery(this.compile(),s(this,ft).queryId)}};ft=new WeakMap;let as=yi;Te(as,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");const Is=class Is{constructor(e){Q(this,vt,void 0);K(this,vt,h(e))}ifExists(){return new Is({...s(this,vt),node:Js.cloneWith(s(this,vt).node,{ifExists:!0})})}cascade(){return new Is({...s(this,vt),node:Js.cloneWith(s(this,vt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,vt).executor.transformQuery(s(this,vt).node,s(this,vt).queryId)}compile(){return s(this,vt).executor.compileQuery(this.toOperationNode(),s(this,vt).queryId)}async execute(){await s(this,vt).executor.executeQuery(this.compile(),s(this,vt).queryId)}};vt=new WeakMap;let ls=Is;Te(ls,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");const Os=class Os{constructor(e){Q(this,xt,void 0);K(this,xt,h(e))}ifExists(){return new Os({...s(this,xt),node:Gs.cloneWith(s(this,xt).node,{ifExists:!0})})}cascade(){return new Os({...s(this,xt),node:Gs.cloneWith(s(this,xt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,xt).executor.transformQuery(s(this,xt).node,s(this,xt).queryId)}compile(){return s(this,xt).executor.compileQuery(this.toOperationNode(),s(this,xt).queryId)}async execute(){await s(this,xt).executor.executeQuery(this.compile(),s(this,xt).queryId)}};xt=new WeakMap;let cs=Os;Te(cs,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const An=h({is(t){return t.kind==="CreateViewNode"},create(t){return h({kind:"CreateViewNode",name:qn.create(t)})},cloneWith(t,e){return h({...t,...e})}});class Vc{constructor(){Q(this,Ts,new Ra)}transformQuery(e){return s(this,Ts).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}Ts=new WeakMap;const Pn=class Pn{constructor(e){Q(this,Ke,void 0);K(this,Ke,h(e))}temporary(){return new Pn({...s(this,Ke),node:An.cloneWith(s(this,Ke).node,{temporary:!0})})}materialized(){return new Pn({...s(this,Ke),node:An.cloneWith(s(this,Ke).node,{materialized:!0})})}ifNotExists(){return new Pn({...s(this,Ke),node:An.cloneWith(s(this,Ke).node,{ifNotExists:!0})})}orReplace(){return new Pn({...s(this,Ke),node:An.cloneWith(s(this,Ke).node,{orReplace:!0})})}columns(e){return new Pn({...s(this,Ke),node:An.cloneWith(s(this,Ke).node,{columns:e.map(Zo)})})}as(e){const r=e.withPlugin(new Vc).toOperationNode();return new Pn({...s(this,Ke),node:An.cloneWith(s(this,Ke).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return s(this,Ke).executor.transformQuery(s(this,Ke).node,s(this,Ke).queryId)}compile(){return s(this,Ke).executor.compileQuery(this.toOperationNode(),s(this,Ke).queryId)}async execute(){await s(this,Ke).executor.executeQuery(this.compile(),s(this,Ke).queryId)}};Ke=new WeakMap;let us=Pn;Te(us,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const ds=h({is(t){return t.kind==="DropViewNode"},create(t){return h({kind:"DropViewNode",name:qn.create(t)})},cloneWith(t,e){return h({...t,...e})}}),gi=class gi{constructor(e){Q(this,ht,void 0);K(this,ht,h(e))}materialized(){return new gi({...s(this,ht),node:ds.cloneWith(s(this,ht).node,{materialized:!0})})}ifExists(){return new gi({...s(this,ht),node:ds.cloneWith(s(this,ht).node,{ifExists:!0})})}cascade(){return new gi({...s(this,ht),node:ds.cloneWith(s(this,ht).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ht).executor.transformQuery(s(this,ht).node,s(this,ht).queryId)}compile(){return s(this,ht).executor.compileQuery(this.toOperationNode(),s(this,ht).queryId)}async execute(){await s(this,ht).executor.executeQuery(this.compile(),s(this,ht).queryId)}};ht=new WeakMap;let fs=gi;Te(fs,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Ma=h({is(t){return t.kind==="CreateTypeNode"},create(t){return h({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return h({...t,enum:ro.create(e.map(r=>Gt.createImmediate(r)))})}}),Io=class Io{constructor(e){Q(this,Ft,void 0);K(this,Ft,h(e))}toOperationNode(){return s(this,Ft).executor.transformQuery(s(this,Ft).node,s(this,Ft).queryId)}asEnum(e){return new Io({...s(this,Ft),node:Ma.cloneWithEnum(s(this,Ft).node,e)})}$call(e){return e(this)}compile(){return s(this,Ft).executor.compileQuery(this.toOperationNode(),s(this,Ft).queryId)}async execute(){await s(this,Ft).executor.executeQuery(this.compile(),s(this,Ft).queryId)}};Ft=new WeakMap;let hs=Io;Te(hs,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Ba=h({is(t){return t.kind==="DropTypeNode"},create(t){return h({kind:"DropTypeNode",name:t})},cloneWith(t,e){return h({...t,...e})}}),Oo=class Oo{constructor(e){Q(this,Lt,void 0);K(this,Lt,h(e))}ifExists(){return new Oo({...s(this,Lt),node:Ba.cloneWith(s(this,Lt).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Lt).executor.transformQuery(s(this,Lt).node,s(this,Lt).queryId)}compile(){return s(this,Lt).executor.compileQuery(this.toOperationNode(),s(this,Lt).queryId)}async execute(){await s(this,Lt).executor.executeQuery(this.compile(),s(this,Lt).queryId)}};Lt=new WeakMap;let ps=Oo;Te(ps,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function Qa(t){const e=".";if(t.includes(e)){const r=t.split(e).map($c);if(r.length===2)return qn.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return qn.create(t)}function $c(t){return t.trim()}const wi=class wi{constructor(e){Q(this,ct,void 0);K(this,ct,e)}createTable(e){return new os({queryId:Re(),executor:s(this,ct),node:Bt.create(kt(e))})}dropTable(e){return new cs({queryId:Re(),executor:s(this,ct),node:Gs.create(kt(e))})}createIndex(e){return new is({queryId:Re(),executor:s(this,ct),node:bn.create(e)})}dropIndex(e){return new as({queryId:Re(),executor:s(this,ct),node:Ti.create(e)})}createSchema(e){return new ss({queryId:Re(),executor:s(this,ct),node:Vo.create(e)})}dropSchema(e){return new ls({queryId:Re(),executor:s(this,ct),node:Js.create(e)})}alterTable(e){return new Da({queryId:Re(),executor:s(this,ct),node:et.create(kt(e))})}createView(e){return new us({queryId:Re(),executor:s(this,ct),node:An.create(e)})}dropView(e){return new fs({queryId:Re(),executor:s(this,ct),node:ds.create(e)})}createType(e){return new hs({queryId:Re(),executor:s(this,ct),node:Ma.create(Qa(e))})}dropType(e){return new ps({queryId:Re(),executor:s(this,ct),node:Ba.create(Qa(e))})}withPlugin(e){return new wi(s(this,ct).withPlugin(e))}withoutPlugins(){return new wi(s(this,ct).withoutPlugins())}withSchema(e){return new wi(s(this,ct).withPluginAtFront(new Yr(e)))}};ct=new WeakMap;let qo=wi;class Hc{ref(e){return new $l(e)}}class Jc{constructor(e){Q(this,Cr,void 0);K(this,Cr,e)}async provideConnection(e){const r=await s(this,Cr).acquireConnection();try{return await e(r)}finally{await s(this,Cr).releaseConnection(r)}}}Cr=new WeakMap;const Yn=class Yn extends qa{constructor(r,n,x,R=[]){super(R);Q(this,en,void 0);Q(this,tn,void 0);Q(this,hn,void 0);K(this,en,r),K(this,tn,n),K(this,hn,x)}get adapter(){return s(this,tn)}compileQuery(r){return s(this,en).compileQuery(r)}provideConnection(r){return s(this,hn).provideConnection(r)}withPlugins(r){return new Yn(s(this,en),s(this,tn),s(this,hn),[...this.plugins,...r])}withPlugin(r){return new Yn(s(this,en),s(this,tn),s(this,hn),[...this.plugins,r])}withPluginAtFront(r){return new Yn(s(this,en),s(this,tn),s(this,hn),[r,...this.plugins])}withConnectionProvider(r){return new Yn(s(this,en),s(this,tn),r,[...this.plugins])}withoutPlugins(){return new Yn(s(this,en),s(this,tn),s(this,hn),[])}};en=new WeakMap,tn=new WeakMap,hn=new WeakMap;let No=Yn;function Ua(){return typeof performance<"u"&&Ot(performance.now)?performance.now():Date.now()}class Gc{constructor(e,r){Q(this,Cs);Q(this,Ps);Q(this,Fs);Q(this,Ls);Q(this,qi);Q(this,Vt,void 0);Q(this,Fn,void 0);Q(this,pn,void 0);Q(this,Pr,void 0);Q(this,_n,void 0);Q(this,bi,new WeakSet);K(this,Pr,!1),K(this,Vt,e),K(this,Fn,r)}async init(){if(s(this,_n))throw new Error("driver has already been destroyed");s(this,pn)||K(this,pn,s(this,Vt).init().then(()=>{K(this,Pr,!0)}).catch(e=>(K(this,pn,void 0),Promise.reject(e)))),await s(this,pn)}async acquireConnection(){if(s(this,_n))throw new Error("driver has already been destroyed");s(this,Pr)||await this.init();const e=await s(this,Vt).acquireConnection();return s(this,bi).has(e)||(Pe(this,Cs,Ol).call(this)&&Pe(this,Ps,Tl).call(this,e),s(this,bi).add(e)),e}async releaseConnection(e){await s(this,Vt).releaseConnection(e)}beginTransaction(e,r){return s(this,Vt).beginTransaction(e,r)}commitTransaction(e){return s(this,Vt).commitTransaction(e)}rollbackTransaction(e){return s(this,Vt).rollbackTransaction(e)}async destroy(){s(this,pn)&&(await s(this,pn),s(this,_n)||K(this,_n,s(this,Vt).destroy().catch(e=>(K(this,_n,void 0),Promise.reject(e)))),await s(this,_n))}}Vt=new WeakMap,Fn=new WeakMap,pn=new WeakMap,Pr=new WeakMap,_n=new WeakMap,bi=new WeakMap,Cs=new WeakSet,Ol=function(){return s(this,Fn).isLevelEnabled("query")||s(this,Fn).isLevelEnabled("error")},Ps=new WeakSet,Tl=function(e){const r=e.executeQuery;e.executeQuery=async n=>{const x=Ua();try{return await r.call(e,n)}catch(R){throw await Pe(this,Fs,Cl).call(this,R,n,x),R}finally{await Pe(this,Ls,Pl).call(this,n,x)}}},Fs=new WeakSet,Cl=async function(e,r,n){await s(this,Fn).error(()=>({level:"error",error:e,query:r,queryDurationMillis:Pe(this,qi,Uo).call(this,n)}))},Ls=new WeakSet,Pl=async function(e,r){await s(this,Fn).query(()=>({level:"query",query:e,queryDurationMillis:Pe(this,qi,Uo).call(this,r)}))},qi=new WeakSet,Uo=function(e){return Ua()-e};class ja{constructor(e){Q(this,Ws);Q(this,Ni,void 0);Q(this,Ln,void 0);K(this,Ni,e)}async provideConnection(e){for(;s(this,Ln);)await s(this,Ln);const r=Pe(this,Ws,Fl).call(this,e);return K(this,Ln,r.then(()=>{K(this,Ln,void 0)}).catch(()=>{K(this,Ln,void 0)})),r}}Ni=new WeakMap,Ln=new WeakMap,Ws=new WeakSet,Fl=async function(e){return await e(s(this,Ni))};const Kc=["read uncommitted","read committed","repeatable read","serializable"];h(["query","error"]);class Xc{constructor(e){Q(this,Wn,void 0);Q(this,Zn,void 0);Ot(e)?(K(this,Zn,e),K(this,Wn,h({query:!0,error:!0}))):(K(this,Zn,Yc),K(this,Wn,h({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return s(this,Wn)[e]}async query(e){s(this,Wn).query&&await s(this,Zn).call(this,e())}async error(e){s(this,Wn).error&&await s(this,Zn).call(this,e())}}Wn=new WeakMap,Zn=new WeakMap;function Yc(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function Zc(t){return Jt(t)&&Ot(t.compile)}const Fr=class Fr extends Hi{constructor(r){let n,x;if(eu(r))n={executor:r.executor},x={...r};else{const R=r.dialect,te=R.createDriver(),pe=R.createQueryCompiler(),Oe=R.createAdapter(),Xe=new Xc(r.log??[]),Ye=new Gc(te,Xe),se=new Jc(Ye),xe=new No(pe,Oe,se,r.plugins??[]);n={executor:xe},x={config:r,executor:xe,dialect:R,driver:Ye}}super(n);Q(this,pt,void 0);K(this,pt,h(x))}get schema(){return new qo(s(this,pt).executor)}get dynamic(){return new Hc}get introspection(){return s(this,pt).dialect.createIntrospector(this.withoutPlugins())}case(r){return new Ea({node:Xt.create(We(r)?void 0:hr(r))})}get fn(){return xa()}transaction(){return new _s({...s(this,pt)})}connection(){return new za({...s(this,pt)})}withPlugin(r){return new Fr({...s(this,pt),executor:s(this,pt).executor.withPlugin(r)})}withoutPlugins(){return new Fr({...s(this,pt),executor:s(this,pt).executor.withoutPlugins()})}withSchema(r){return new Fr({...s(this,pt),executor:s(this,pt).executor.withPluginAtFront(new Yr(r))})}withTables(){return new Fr({...s(this,pt)})}async destroy(){await s(this,pt).driver.destroy()}get isTransaction(){return!1}getExecutor(){return s(this,pt).executor}executeQuery(r,n=Re()){const x=Zc(r)?r.compile():r;return this.getExecutor().executeQuery(x,n)}};pt=new WeakMap;let oi=Fr;const Lr=class Lr extends oi{constructor(r){super(r);Q(this,$t,void 0);K(this,$t,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new Lr({...s(this,$t),executor:s(this,$t).executor.withPlugin(r)})}withoutPlugins(){return new Lr({...s(this,$t),executor:s(this,$t).executor.withoutPlugins()})}withSchema(r){return new Lr({...s(this,$t),executor:s(this,$t).executor.withPluginAtFront(new Yr(r))})}withTables(){return new Lr({...s(this,$t)})}};$t=new WeakMap;let vo=Lr;function eu(t){return Jt(t)&&Jt(t.config)&&Jt(t.driver)&&Jt(t.executor)&&Jt(t.dialect)}class za{constructor(e){Q(this,er,void 0);K(this,er,h(e))}async execute(e){return s(this,er).executor.provideConnection(async r=>{const n=s(this,er).executor.withConnectionProvider(new ja(r)),x=new oi({...s(this,er),executor:n});return await e(x)})}}er=new WeakMap,Te(za,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");const To=class To{constructor(e){Q(this,Ht,void 0);K(this,Ht,h(e))}setIsolationLevel(e){return new To({...s(this,Ht),isolationLevel:e})}async execute(e){const{isolationLevel:r,...n}=s(this,Ht),x={isolationLevel:r};return tu(x),s(this,Ht).executor.provideConnection(async R=>{const te=s(this,Ht).executor.withConnectionProvider(new ja(R)),pe=new vo({...n,executor:te});try{await s(this,Ht).driver.beginTransaction(R,x);const Oe=await e(pe);return await s(this,Ht).driver.commitTransaction(R),Oe}catch(Oe){throw await s(this,Ht).driver.rollbackTransaction(R),Oe}})}};Ht=new WeakMap;let _s=To;Te(_s,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function tu(t){if(t.isolationLevel&&!Kc.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}const Ds=class Ds{constructor(e){Q(this,Wr);Q(this,vi);Q(this,xi);Q(this,It,void 0);K(this,It,h(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Va(this,e)}$castTo(){return new Ds({...s(this,It)})}withPlugin(e){return new Ds({...s(this,It),plugins:s(this,It).plugins!==void 0?h([...s(this,It).plugins,e]):h([e])})}toOperationNode(){return Pe(this,vi,jo).call(this,Pe(this,Wr,Vs).call(this))}compile(e){return Pe(this,xi,zo).call(this,Pe(this,Wr,Vs).call(this,e))}async execute(e){const r=Pe(this,Wr,Vs).call(this,e);return r.executeQuery(Pe(this,xi,zo).call(this,r),s(this,It).queryId)}};It=new WeakMap,Wr=new WeakSet,Vs=function(e){const r=e!==void 0?e.getExecutor():fo;return s(this,It).plugins!==void 0?r.withPlugins(s(this,It).plugins):r},vi=new WeakSet,jo=function(e){return e.transformQuery(s(this,It).rawNode,s(this,It).queryId)},xi=new WeakSet,zo=function(e){return e.compileQuery(Pe(this,vi,jo).call(this,e),s(this,It).queryId)};let ms=Ds;function kn(t){return new ms(t)}Te(ms,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class Va{constructor(e,r){Q(this,tr,void 0);Q(this,Dn,void 0);K(this,tr,e),K(this,Dn,r)}get expression(){return s(this,tr)}get alias(){return s(this,Dn)}get rawBuilder(){return s(this,tr)}toOperationNode(){return Nn.create(s(this,tr).toOperationNode(),Dt(s(this,Dn))?s(this,Dn).toOperationNode():Je.create(s(this,Dn)))}}tr=new WeakMap,Dn=new WeakMap,Te(Va,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const Ge=Object.assign((t,...e)=>kn({queryId:Re(),rawNode:qt.create(t,(e==null?void 0:e.map(Nt))??[])}),{ref(t){return kn({queryId:Re(),rawNode:qt.createWithChild(an(t))})},val(t){return kn({queryId:Re(),rawNode:qt.createWithChild(Nt(t))})},value(t){return this.val(t)},table(t){return kn({queryId:Re(),rawNode:qt.createWithChild(kt(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",kn({queryId:Re(),rawNode:qt.create(e,t.map(Je.create))})},lit(t){return kn({queryId:Re(),rawNode:qt.createWithChild(Gt.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return kn({queryId:Re(),rawNode:qt.createWithSql(t)})},join(t,e=Ge`, `){const r=new Array(2*t.length-1),n=e.toOperationNode();for(let x=0;x<t.length;++x)r[2*x]=Nt(t[x]),x!==t.length-1&&(r[2*x+1]=n);return kn({queryId:Re(),rawNode:qt.createWithChildren(r)})}});class nu{constructor(){De(this,"nodeStack",[]);Q(this,Rs,h({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this)}));De(this,"visitNode",e=>{this.nodeStack.push(e),s(this,Rs)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Rs=new WeakMap;class ru extends nu{constructor(){super(...arguments);Q(this,Dr,"");Q(this,nr,[])}get numParameters(){return s(this,nr).length}compileQuery(r){return K(this,Dr,""),K(this,nr,[]),this.visitNode(r),h({query:r,sql:this.getSql(),parameters:[...s(this,nr)]})}getSql(){return s(this,Dr)}visitSelectQuery(r){var x,R;const n=this.parentNode!==void 0&&!ar.is(this.parentNode)&&!Kt.is(this.parentNode)&&!An.is(this.parentNode)&&!Na.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),(x=r.frontModifiers)!=null&&x.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),(R=r.endModifiers)!=null&&R.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),n&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,n=", "){const x=r.length-1;for(let R=0;R<=x;R++)this.visitNode(r[R]),R<x&&this.append(n)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const n=this.nodeStack.find(ve.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const n=this.nodeStack.find(ve.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!Ce(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:n}=r;for(let x=0;x<n.length;++x)this.appendValue(n[x]),x!==n.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(su[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:n,parameters:x}=r;for(let R=0;R<n.length;++R)this.append(n[R]),x.length>R&&this.visitNode(x[R])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const n=this.nodeStack.find(ve.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),Mn(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileList(r.columnAlterations)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(iu[r.modifier])}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return Bn.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const n of r.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(r){const n=r.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(r.value)),n&&this.append("]")}visitJSONOperatorChain(r){for(let n=0,x=r.values.length;n<x;n++)n===x-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[n])}append(r){K(this,Dr,s(this,Dr)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const n=this.getLeftIdentifierWrapper(),x=this.getRightIdentifierWrapper();let R="";for(const te of r)R+=te,te===n?R+=n:te===x&&(R+=x);return R}addParameter(r){s(this,nr).push(r)}appendImmediateValue(r){if(Ce(r))this.append(`'${r}'`);else if(Ze(r)||Mn(r))this.append(r.toString());else if(Hs(r))this.append("null");else if(Wl(r))this.appendImmediateValue(r.toISOString());else if(Dl(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((n,x)=>n.modifier&&x.modifier?$a[n.modifier]-$a[x.modifier]:1),h(r)}}Dr=new WeakMap,nr=new WeakMap;const iu=h({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),$a=h({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),su=h({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),cn=h({raw(t,e=[]){return h({sql:t,query:qt.createWithSql(t),parameters:h(e)})}}),ou=/"/g;class au extends ru{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(ou,'""')}visitDefaultInsertValue(e){this.append("null")}}const Ha="kysely_migration",Ja="kysely_migration_lock";h({__noMigrations__:!0});class lu{constructor(e){Q(this,Ms);Q(this,Rr,void 0);K(this,Rr,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=s(this,Rr).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",Ha).where("name","!=",Ja));const n=await r.execute();return Promise.all(n.map(({name:x})=>Pe(this,Ms,Ll).call(this,x)))}async getMetadata(e){return{tables:await this.getTables(e)}}}Rr=new WeakMap,Ms=new WeakSet,Ll=async function(e){var te,pe,Oe,Xe,Ye,se;const r=s(this,Rr),n=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),x=(se=(Ye=(Xe=(Oe=(pe=(te=n.sql)==null?void 0:te.split(/[\(\),]/))==null?void 0:pe.find(xe=>xe.toLowerCase().includes("autoincrement")))==null?void 0:Oe.trimStart())==null?void 0:Xe.split(/\s+/))==null?void 0:Ye[0])==null?void 0:se.replace(/["`]/g,""),R=await r.selectFrom(Ge`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:R.map(xe=>({name:xe.name,dataType:xe.type,isNullable:!xe.notnull,isAutoIncrementing:xe.name===x,hasDefaultValue:xe.dflt_value!=null}))}};class cu{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var uu=class{createQueryCompiler(){return new au}createAdapter(){return new cu}createIntrospector(t){return new lu(t)}},du=(rl=class{constructor(){Q(this,Ei,new fu);De(this,"connection")}async acquireConnection(){return await s(this,Ei).lock(),this.connection}async beginTransaction(t){await t.executeQuery(cn.raw("begin"))}async commitTransaction(t){await t.executeQuery(cn.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(cn.raw("rollback"))}async releaseConnection(){s(this,Ei).unlock()}},Ei=new WeakMap,rl),fu=class{constructor(){De(this,"promise");De(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t==null||t()}},hu=class{streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}async executeQuery(t){const{parameters:e,sql:r,query:n}=t;return["SelectQueryNode","RawNode"].includes(n.kind)?{rows:await this.query(r,e)}:{rows:[],...await this.exec(r,e)}}},pu=class extends du{constructor(e){super();De(this,"config");De(this,"db");this.config=e}async init(){var e,r;this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,this.connection=new _u(this.db),await((r=(e=this.config).onCreateConnection)==null?void 0:r.call(e,this.connection))}async destroy(){var e;(e=this.db)==null||e.close()}},_u=class extends hu{constructor(e){super();De(this,"db");this.db=e}query(e,r){const n=[];return this.db.exec({sql:e,bind:r??[],rowMode:"object",resultRows:n}),n}exec(e,r){return this.db.exec({sql:e,bind:r??[]}),{numAffectedRows:BigInt(this.db.changes(!1,!0)),insertId:BigInt(this.query("SELECT last_insert_rowid() as id")[0].id)}}},mu=(il=class extends uu{constructor(e){super();Q(this,Si,void 0);K(this,Si,e)}createDriver(){return new pu(s(this,Si))}},Si=new WeakMap,il);async function yu(t,e=4096,r=32*1024){await t.executeQuery(cn.raw(`PRAGMA cache_size = ${e};`)),await t.executeQuery(cn.raw("PRAGMA journal_mode = WAL;")),await t.executeQuery(cn.raw("PRAGMA temp_store = MEMORY;")),await t.executeQuery(cn.raw(`PRAGMA page_size = ${r};`)),await t.executeQuery(cn.raw("PRAGMA synchronous = NORMAL;"))}var xo=(()=>{var t=self.location.href;return function(e){var r=e||{},n=typeof r<"u"?r:{},x,R;n.ready=new Promise(function(o,i){x=o,R=i});const te=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,te.debugModule("globalThis.location =",globalThis.location);const pe="emscripten-bug-17951";n[pe]=function o(i,l){i.env.foo=function(){};const a=n.locateFile(o.uri,typeof xe>"u"?"":xe);te.debugModule("instantiateWasm() uri =",a);const c=()=>fetch(a,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(c(),i).then(b=>l(b.instance,b.module)):async()=>c().then(b=>b.arrayBuffer()).then(b=>WebAssembly.instantiate(b,i)).then(b=>l(b.instance,b.module)))(),{}},n[pe].uri="sqlite3.wasm";var Oe=Object.assign({},n),Xe="./this.program",Ye=typeof window=="object",se=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var xe="";function mn(o){return n.locateFile?n.locateFile(o,xe):xe+o}var Rn,nn,wt;(Ye||se)&&(se?xe=self.location.href:typeof document<"u"&&document.currentScript&&(xe=document.currentScript.src),t&&(xe=t),xe.indexOf("blob:")!==0?xe=xe.substr(0,xe.replace(/[?#].*/,"").lastIndexOf("/")+1):xe="",Rn=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.send(null),i.responseText},se&&(wt=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.responseType="arraybuffer",i.send(null),new Uint8Array(i.response)}),nn=(o,i,l)=>{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onload=()=>{if(a.status==200||a.status==0&&a.response){i(a.response);return}l()},a.onerror=l,a.send(null)});var ut=n.print||console.log.bind(console),He=n.printErr||console.warn.bind(console);Object.assign(n,Oe),Oe=null,n.arguments&&n.arguments,n.thisProgram&&(Xe=n.thisProgram),n.quit&&n.quit;var bt;n.wasmBinary&&(bt=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&Ur("no native wasm support detected");var rn,Mr=!1;function zu(o,i){o||Ur(i)}var sl=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Br(o,i,l){for(var a=i+l,c=i;o[c]&&!(c>=a);)++c;if(c-i>16&&o.buffer&&sl)return sl.decode(o.subarray(i,c));for(var d="";i<c;){var b=o[i++];if(!(b&128)){d+=String.fromCharCode(b);continue}var k=o[i++]&63;if((b&224)==192){d+=String.fromCharCode((b&31)<<6|k);continue}var L=o[i++]&63;if((b&240)==224?b=(b&15)<<12|k<<6|L:b=(b&7)<<18|k<<12|L<<6|o[i++]&63,b<65536)d+=String.fromCharCode(b);else{var X=b-65536;d+=String.fromCharCode(55296|X>>10,56320|X&1023)}}return d}function Vu(o,i){return o?Br(Qr,o,i):""}function Bs(o,i,l,a){if(!(a>0))return 0;for(var c=l,d=l+a-1,b=0;b<o.length;++b){var k=o.charCodeAt(b);if(k>=55296&&k<=57343){var L=o.charCodeAt(++b);k=65536+((k&1023)<<10)|L&1023}if(k<=127){if(l>=d)break;i[l++]=k}else if(k<=2047){if(l+1>=d)break;i[l++]=192|k>>6,i[l++]=128|k&63}else if(k<=65535){if(l+2>=d)break;i[l++]=224|k>>12,i[l++]=128|k>>6&63,i[l++]=128|k&63}else{if(l+3>=d)break;i[l++]=240|k>>18,i[l++]=128|k>>12&63,i[l++]=128|k>>6&63,i[l++]=128|k&63}}return i[l]=0,l-c}function ol(o,i,l){return Bs(o,Qr,i,l)}function Ai(o){for(var i=0,l=0;l<o.length;++l){var a=o.charCodeAt(l);a<=127?i++:a<=2047?i+=2:a>=55296&&a<=57343?(i+=4,++l):i+=3}return i}var Wt,Qr,al,qe,it;function ll(){var o=rn.buffer;n.HEAP8=Wt=new Int8Array(o),n.HEAP16=al=new Int16Array(o),n.HEAP32=qe=new Int32Array(o),n.HEAPU8=Qr=new Uint8Array(o),n.HEAPU16=new Uint16Array(o),n.HEAPU32=it=new Uint32Array(o),n.HEAPF32=new Float32Array(o),n.HEAPF64=new Float64Array(o),n.HEAP64=new BigInt64Array(o),n.HEAPU64=new BigUint64Array(o)}var cl=n.INITIAL_MEMORY||16777216;n.wasmMemory?rn=n.wasmMemory:rn=new WebAssembly.Memory({initial:cl/65536,maximum:2147483648/65536}),ll(),cl=rn.buffer.byteLength;var ul=[],dl=[],fl=[];function $u(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Gu(n.preRun.shift());Po(ul)}function Hu(){!n.noFSInit&&!u.init.initialized&&u.init(),u.ignorePermissions=!1,Po(dl)}function Ju(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)Xu(n.postRun.shift());Po(fl)}function Gu(o){ul.unshift(o)}function Ku(o){dl.unshift(o)}function Xu(o){fl.unshift(o)}var rr=0,ki=null;function af(o){return o}function Co(o){rr++,n.monitorRunDependencies&&n.monitorRunDependencies(rr)}function Qs(o){if(rr--,n.monitorRunDependencies&&n.monitorRunDependencies(rr),rr==0&&ki){var i=ki;ki=null,i()}}function Ur(o){n.onAbort&&n.onAbort(o),o="Aborted("+o+")",He(o),Mr=!0,o+=". Build with -sASSERTIONS for more info.";var i=new WebAssembly.RuntimeError(o);throw R(i),i}var Yu="data:application/octet-stream;base64,";function hl(o){return o.startsWith(Yu)}var Mt;n.locateFile?(Mt="sqlite3.wasm",hl(Mt)||(Mt=mn(Mt))):Mt=new URL(""+new URL("sqlite3-413aa954.wasm",self.location.href).href,self.location).href;function pl(o){try{if(o==Mt&&bt)return new Uint8Array(bt);if(wt)return wt(o);throw"both async and sync fetching of the wasm failed"}catch(i){Ur(i)}}function Zu(){return!bt&&(Ye||se)&&typeof fetch=="function"?fetch(Mt,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+Mt+"'";return o.arrayBuffer()}).catch(function(){return pl(Mt)}):Promise.resolve().then(function(){return pl(Mt)})}function ed(){var o={env:bl,wasi_snapshot_preview1:bl};function i(b,k){var L=b.exports;n.asm=L,n.asm.__indirect_function_table,Ku(n.asm.__wasm_call_ctors),Qs()}Co();function l(b){i(b.instance)}function a(b){return Zu().then(function(k){return WebAssembly.instantiate(k,o)}).then(function(k){return k}).then(b,function(k){He("failed to asynchronously prepare wasm: "+k),Ur(k)})}function c(){return!bt&&typeof WebAssembly.instantiateStreaming=="function"&&!hl(Mt)&&typeof fetch=="function"?fetch(Mt,{credentials:"same-origin"}).then(function(b){var k=WebAssembly.instantiateStreaming(b,o);return k.then(l,function(L){return He("wasm streaming compile failed: "+L),He("falling back to ArrayBuffer instantiation"),a(l)})}):a(l)}if(n.instantiateWasm)try{var d=n.instantiateWasm(o,i);return d}catch(b){He("Module.instantiateWasm callback failed with error: "+b),R(b)}return c().catch(R),{}}var Se,dt;function Po(o){for(;o.length>0;)o.shift()(n)}var Fe={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return i.exec(o).slice(1)},normalizeArray:(o,i)=>{for(var l=0,a=o.length-1;a>=0;a--){var c=o[a];c==="."?o.splice(a,1):c===".."?(o.splice(a,1),l++):l&&(o.splice(a,1),l--)}if(i)for(;l;l--)o.unshift("..");return o},normalize:o=>{var i=Fe.isAbs(o),l=o.substr(-1)==="/";return o=Fe.normalizeArray(o.split("/").filter(a=>!!a),!i).join("/"),!o&&!i&&(o="."),o&&l&&(o+="/"),(i?"/":"")+o},dirname:o=>{var i=Fe.splitPath(o),l=i[0],a=i[1];return!l&&!a?".":(a&&(a=a.substr(0,a.length-1)),l+a)},basename:o=>{if(o==="/")return"/";o=Fe.normalize(o),o=o.replace(/\/$/,"");var i=o.lastIndexOf("/");return i===-1?o:o.substr(i+1)},join:function(){var o=Array.prototype.slice.call(arguments);return Fe.normalize(o.join("/"))},join2:(o,i)=>Fe.normalize(o+"/"+i)};function td(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var o=new Uint8Array(1);return()=>(crypto.getRandomValues(o),o[0])}else return()=>Ur("randomDevice")}var yn={resolve:function(){for(var o="",i=!1,l=arguments.length-1;l>=-1&&!i;l--){var a=l>=0?arguments[l]:u.cwd();if(typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";o=a+"/"+o,i=Fe.isAbs(a)}return o=Fe.normalizeArray(o.split("/").filter(c=>!!c),!i).join("/"),(i?"/":"")+o||"."},relative:(o,i)=>{o=yn.resolve(o).substr(1),i=yn.resolve(i).substr(1);function l(X){for(var ee=0;ee<X.length&&X[ee]==="";ee++);for(var oe=X.length-1;oe>=0&&X[oe]==="";oe--);return ee>oe?[]:X.slice(ee,oe-ee+1)}for(var a=l(o.split("/")),c=l(i.split("/")),d=Math.min(a.length,c.length),b=d,k=0;k<d;k++)if(a[k]!==c[k]){b=k;break}for(var L=[],k=b;k<a.length;k++)L.push("..");return L=L.concat(c.slice(b)),L.join("/")}};function Fo(o,i,l){var a=l>0?l:Ai(o)+1,c=new Array(a),d=Bs(o,c,0,c.length);return i&&(c.length=d),c}var ir={ttys:[],init:function(){},shutdown:function(){},register:function(o,i){ir.ttys[o]={input:[],output:[],ops:i},u.registerDevice(o,ir.stream_ops)},stream_ops:{open:function(o){var i=ir.ttys[o.node.rdev];if(!i)throw new u.ErrnoError(43);o.tty=i,o.seekable=!1},close:function(o){o.tty.ops.fsync(o.tty)},fsync:function(o){o.tty.ops.fsync(o.tty)},read:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.get_char)throw new u.ErrnoError(60);for(var d=0,b=0;b<a;b++){var k;try{k=o.tty.ops.get_char(o.tty)}catch{throw new u.ErrnoError(29)}if(k===void 0&&d===0)throw new u.ErrnoError(6);if(k==null)break;d++,i[l+b]=k}return d&&(o.node.timestamp=Date.now()),d},write:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var d=0;d<a;d++)o.tty.ops.put_char(o.tty,i[l+d])}catch{throw new u.ErrnoError(29)}return a&&(o.node.timestamp=Date.now()),d}},default_tty_ops:{get_char:function(o){if(!o.input.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i)return null;o.input=Fo(i,!0)}return o.input.shift()},put_char:function(o,i){i===null||i===10?(ut(Br(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(ut(Br(o.output,0)),o.output=[])}},default_tty1_ops:{put_char:function(o,i){i===null||i===10?(He(Br(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(He(Br(o.output,0)),o.output=[])}}};function nd(o,i){return Qr.fill(0,o,o+i),o}function rd(o,i){return Math.ceil(o/i)*i}function _l(o){o=rd(o,65536);var i=vl(65536,o);return i?nd(i,o):0}var we={ops_table:null,mount:function(o){return we.createNode(null,"/",16895,0)},createNode:function(o,i,l,a){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);we.ops_table||(we.ops_table={dir:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr,lookup:we.node_ops.lookup,mknod:we.node_ops.mknod,rename:we.node_ops.rename,unlink:we.node_ops.unlink,rmdir:we.node_ops.rmdir,readdir:we.node_ops.readdir,symlink:we.node_ops.symlink},stream:{llseek:we.stream_ops.llseek}},file:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr},stream:{llseek:we.stream_ops.llseek,read:we.stream_ops.read,write:we.stream_ops.write,allocate:we.stream_ops.allocate,mmap:we.stream_ops.mmap,msync:we.stream_ops.msync}},link:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr,readlink:we.node_ops.readlink},stream:{}},chrdev:{node:{getattr:we.node_ops.getattr,setattr:we.node_ops.setattr},stream:u.chrdev_stream_ops}});var c=u.createNode(o,i,l,a);return u.isDir(c.mode)?(c.node_ops=we.ops_table.dir.node,c.stream_ops=we.ops_table.dir.stream,c.contents={}):u.isFile(c.mode)?(c.node_ops=we.ops_table.file.node,c.stream_ops=we.ops_table.file.stream,c.usedBytes=0,c.contents=null):u.isLink(c.mode)?(c.node_ops=we.ops_table.link.node,c.stream_ops=we.ops_table.link.stream):u.isChrdev(c.mode)&&(c.node_ops=we.ops_table.chrdev.node,c.stream_ops=we.ops_table.chrdev.stream),c.timestamp=Date.now(),o&&(o.contents[i]=c,o.timestamp=c.timestamp),c},getFileDataAsTypedArray:function(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage:function(o,i){var l=o.contents?o.contents.length:0;if(!(l>=i)){var a=1024*1024;i=Math.max(i,l*(l<a?2:1.125)>>>0),l!=0&&(i=Math.max(i,256));var c=o.contents;o.contents=new Uint8Array(i),o.usedBytes>0&&o.contents.set(c.subarray(0,o.usedBytes),0)}},resizeFileStorage:function(o,i){if(o.usedBytes!=i)if(i==0)o.contents=null,o.usedBytes=0;else{var l=o.contents;o.contents=new Uint8Array(i),l&&o.contents.set(l.subarray(0,Math.min(i,o.usedBytes))),o.usedBytes=i}},node_ops:{getattr:function(o){var i={};return i.dev=u.isChrdev(o.mode)?o.id:1,i.ino=o.id,i.mode=o.mode,i.nlink=1,i.uid=0,i.gid=0,i.rdev=o.rdev,u.isDir(o.mode)?i.size=4096:u.isFile(o.mode)?i.size=o.usedBytes:u.isLink(o.mode)?i.size=o.link.length:i.size=0,i.atime=new Date(o.timestamp),i.mtime=new Date(o.timestamp),i.ctime=new Date(o.timestamp),i.blksize=4096,i.blocks=Math.ceil(i.size/i.blksize),i},setattr:function(o,i){i.mode!==void 0&&(o.mode=i.mode),i.timestamp!==void 0&&(o.timestamp=i.timestamp),i.size!==void 0&&we.resizeFileStorage(o,i.size)},lookup:function(o,i){throw u.genericErrors[44]},mknod:function(o,i,l,a){return we.createNode(o,i,l,a)},rename:function(o,i,l){if(u.isDir(o.mode)){var a;try{a=u.lookupNode(i,l)}catch{}if(a)for(var c in a.contents)throw new u.ErrnoError(55)}delete o.parent.contents[o.name],o.parent.timestamp=Date.now(),o.name=l,i.contents[l]=o,i.timestamp=o.parent.timestamp,o.parent=i},unlink:function(o,i){delete o.contents[i],o.timestamp=Date.now()},rmdir:function(o,i){var l=u.lookupNode(o,i);for(var a in l.contents)throw new u.ErrnoError(55);delete o.contents[i],o.timestamp=Date.now()},readdir:function(o){var i=[".",".."];for(var l in o.contents)o.contents.hasOwnProperty(l)&&i.push(l);return i},symlink:function(o,i,l){var a=we.createNode(o,i,41471,0);return a.link=l,a},readlink:function(o){if(!u.isLink(o.mode))throw new u.ErrnoError(28);return o.link}},stream_ops:{read:function(o,i,l,a,c){var d=o.node.contents;if(c>=o.node.usedBytes)return 0;var b=Math.min(o.node.usedBytes-c,a);if(b>8&&d.subarray)i.set(d.subarray(c,c+b),l);else for(var k=0;k<b;k++)i[l+k]=d[c+k];return b},write:function(o,i,l,a,c,d){if(i.buffer===Wt.buffer&&(d=!1),!a)return 0;var b=o.node;if(b.timestamp=Date.now(),i.subarray&&(!b.contents||b.contents.subarray)){if(d)return b.contents=i.subarray(l,l+a),b.usedBytes=a,a;if(b.usedBytes===0&&c===0)return b.contents=i.slice(l,l+a),b.usedBytes=a,a;if(c+a<=b.usedBytes)return b.contents.set(i.subarray(l,l+a),c),a}if(we.expandFileStorage(b,c+a),b.contents.subarray&&i.subarray)b.contents.set(i.subarray(l,l+a),c);else for(var k=0;k<a;k++)b.contents[c+k]=i[l+k];return b.usedBytes=Math.max(b.usedBytes,c+a),a},llseek:function(o,i,l){var a=i;if(l===1?a+=o.position:l===2&&u.isFile(o.node.mode)&&(a+=o.node.usedBytes),a<0)throw new u.ErrnoError(28);return a},allocate:function(o,i,l){we.expandFileStorage(o.node,i+l),o.node.usedBytes=Math.max(o.node.usedBytes,i+l)},mmap:function(o,i,l,a,c){if(!u.isFile(o.node.mode))throw new u.ErrnoError(43);var d,b,k=o.node.contents;if(!(c&2)&&k.buffer===Wt.buffer)b=!1,d=k.byteOffset;else{if((l>0||l+i<k.length)&&(k.subarray?k=k.subarray(l,l+i):k=Array.prototype.slice.call(k,l,l+i)),b=!0,d=_l(i),!d)throw new u.ErrnoError(48);Wt.set(k,d)}return{ptr:d,allocated:b}},msync:function(o,i,l,a,c){return we.stream_ops.write(o,i,0,a,l,!1),0}}};function id(o,i,l,a){var c=a?"":"al "+o;nn(o,d=>{zu(d,'Loading data file "'+o+'" failed (no arrayBuffer).'),i(new Uint8Array(d)),c&&Qs()},d=>{if(l)l();else throw'Loading data file "'+o+'" failed.'}),c&&Co()}var u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(o,i={})=>{if(o=yn.resolve(o),!o)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(i=Object.assign(l,i),i.recurse_count>8)throw new u.ErrnoError(32);for(var a=o.split("/").filter(oe=>!!oe),c=u.root,d="/",b=0;b<a.length;b++){var k=b===a.length-1;if(k&&i.parent)break;if(c=u.lookupNode(c,a[b]),d=Fe.join2(d,a[b]),u.isMountpoint(c)&&(!k||k&&i.follow_mount)&&(c=c.mounted.root),!k||i.follow)for(var L=0;u.isLink(c.mode);){var X=u.readlink(d);d=yn.resolve(Fe.dirname(d),X);var ee=u.lookupPath(d,{recurse_count:i.recurse_count+1});if(c=ee.node,L++>40)throw new u.ErrnoError(32)}}return{path:d,node:c}},getPath:o=>{for(var i;;){if(u.isRoot(o)){var l=o.mount.mountpoint;return i?l[l.length-1]!=="/"?l+"/"+i:l+i:l}i=i?o.name+"/"+i:o.name,o=o.parent}},hashName:(o,i)=>{for(var l=0,a=0;a<i.length;a++)l=(l<<5)-l+i.charCodeAt(a)|0;return(o+l>>>0)%u.nameTable.length},hashAddNode:o=>{var i=u.hashName(o.parent.id,o.name);o.name_next=u.nameTable[i],u.nameTable[i]=o},hashRemoveNode:o=>{var i=u.hashName(o.parent.id,o.name);if(u.nameTable[i]===o)u.nameTable[i]=o.name_next;else for(var l=u.nameTable[i];l;){if(l.name_next===o){l.name_next=o.name_next;break}l=l.name_next}},lookupNode:(o,i)=>{var l=u.mayLookup(o);if(l)throw new u.ErrnoError(l,o);for(var a=u.hashName(o.id,i),c=u.nameTable[a];c;c=c.name_next){var d=c.name;if(c.parent.id===o.id&&d===i)return c}return u.lookup(o,i)},createNode:(o,i,l,a)=>{var c=new u.FSNode(o,i,l,a);return u.hashAddNode(c),c},destroyNode:o=>{u.hashRemoveNode(o)},isRoot:o=>o===o.parent,isMountpoint:o=>!!o.mounted,isFile:o=>(o&61440)===32768,isDir:o=>(o&61440)===16384,isLink:o=>(o&61440)===40960,isChrdev:o=>(o&61440)===8192,isBlkdev:o=>(o&61440)===24576,isFIFO:o=>(o&61440)===4096,isSocket:o=>(o&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:o=>{var i=u.flagModes[o];if(typeof i>"u")throw new Error("Unknown file open mode: "+o);return i},flagsToPermissionString:o=>{var i=["r","w","rw"][o&3];return o&512&&(i+="w"),i},nodePermissions:(o,i)=>u.ignorePermissions?0:i.includes("r")&&!(o.mode&292)||i.includes("w")&&!(o.mode&146)||i.includes("x")&&!(o.mode&73)?2:0,mayLookup:o=>{var i=u.nodePermissions(o,"x");return i||(o.node_ops.lookup?0:2)},mayCreate:(o,i)=>{try{var l=u.lookupNode(o,i);return 20}catch{}return u.nodePermissions(o,"wx")},mayDelete:(o,i,l)=>{var a;try{a=u.lookupNode(o,i)}catch(d){return d.errno}var c=u.nodePermissions(o,"wx");if(c)return c;if(l){if(!u.isDir(a.mode))return 54;if(u.isRoot(a)||u.getPath(a)===u.cwd())return 10}else if(u.isDir(a.mode))return 31;return 0},mayOpen:(o,i)=>o?u.isLink(o.mode)?32:u.isDir(o.mode)&&(u.flagsToPermissionString(i)!=="r"||i&512)?31:u.nodePermissions(o,u.flagsToPermissionString(i)):44,MAX_OPEN_FDS:4096,nextfd:(o=0,i=u.MAX_OPEN_FDS)=>{for(var l=o;l<=i;l++)if(!u.streams[l])return l;throw new u.ErrnoError(33)},getStream:o=>u.streams[o],createStream:(o,i,l)=>{u.FSStream||(u.FSStream=function(){this.shared={}},u.FSStream.prototype={},Object.defineProperties(u.FSStream.prototype,{object:{get:function(){return this.node},set:function(c){this.node=c}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(c){this.shared.flags=c}},position:{get:function(){return this.shared.position},set:function(c){this.shared.position=c}}})),o=Object.assign(new u.FSStream,o);var a=u.nextfd(i,l);return o.fd=a,u.streams[a]=o,o},closeStream:o=>{u.streams[o]=null},chrdev_stream_ops:{open:o=>{var i=u.getDevice(o.node.rdev);o.stream_ops=i.stream_ops,o.stream_ops.open&&o.stream_ops.open(o)},llseek:()=>{throw new u.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,i)=>o<<8|i,registerDevice:(o,i)=>{u.devices[o]={stream_ops:i}},getDevice:o=>u.devices[o],getMounts:o=>{for(var i=[],l=[o];l.length;){var a=l.pop();i.push(a),l.push.apply(l,a.mounts)}return i},syncfs:(o,i)=>{typeof o=="function"&&(i=o,o=!1),u.syncFSRequests++,u.syncFSRequests>1&&He("warning: "+u.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=u.getMounts(u.root.mount),a=0;function c(b){return u.syncFSRequests--,i(b)}function d(b){if(b)return d.errored?void 0:(d.errored=!0,c(b));++a>=l.length&&c(null)}l.forEach(b=>{if(!b.type.syncfs)return d(null);b.type.syncfs(b,o,d)})},mount:(o,i,l)=>{var a=l==="/",c=!l,d;if(a&&u.root)throw new u.ErrnoError(10);if(!a&&!c){var b=u.lookupPath(l,{follow_mount:!1});if(l=b.path,d=b.node,u.isMountpoint(d))throw new u.ErrnoError(10);if(!u.isDir(d.mode))throw new u.ErrnoError(54)}var k={type:o,opts:i,mountpoint:l,mounts:[]},L=o.mount(k);return L.mount=k,k.root=L,a?u.root=L:d&&(d.mounted=k,d.mount&&d.mount.mounts.push(k)),L},unmount:o=>{var i=u.lookupPath(o,{follow_mount:!1});if(!u.isMountpoint(i.node))throw new u.ErrnoError(28);var l=i.node,a=l.mounted,c=u.getMounts(a);Object.keys(u.nameTable).forEach(b=>{for(var k=u.nameTable[b];k;){var L=k.name_next;c.includes(k.mount)&&u.destroyNode(k),k=L}}),l.mounted=null;var d=l.mount.mounts.indexOf(a);l.mount.mounts.splice(d,1)},lookup:(o,i)=>o.node_ops.lookup(o,i),mknod:(o,i,l)=>{var a=u.lookupPath(o,{parent:!0}),c=a.node,d=Fe.basename(o);if(!d||d==="."||d==="..")throw new u.ErrnoError(28);var b=u.mayCreate(c,d);if(b)throw new u.ErrnoError(b);if(!c.node_ops.mknod)throw new u.ErrnoError(63);return c.node_ops.mknod(c,d,i,l)},create:(o,i)=>(i=i!==void 0?i:438,i&=4095,i|=32768,u.mknod(o,i,0)),mkdir:(o,i)=>(i=i!==void 0?i:511,i&=1023,i|=16384,u.mknod(o,i,0)),mkdirTree:(o,i)=>{for(var l=o.split("/"),a="",c=0;c<l.length;++c)if(l[c]){a+="/"+l[c];try{u.mkdir(a,i)}catch(d){if(d.errno!=20)throw d}}},mkdev:(o,i,l)=>(typeof l>"u"&&(l=i,i=438),i|=8192,u.mknod(o,i,l)),symlink:(o,i)=>{if(!yn.resolve(o))throw new u.ErrnoError(44);var l=u.lookupPath(i,{parent:!0}),a=l.node;if(!a)throw new u.ErrnoError(44);var c=Fe.basename(i),d=u.mayCreate(a,c);if(d)throw new u.ErrnoError(d);if(!a.node_ops.symlink)throw new u.ErrnoError(63);return a.node_ops.symlink(a,c,o)},rename:(o,i)=>{var l=Fe.dirname(o),a=Fe.dirname(i),c=Fe.basename(o),d=Fe.basename(i),b,k,L;if(b=u.lookupPath(o,{parent:!0}),k=b.node,b=u.lookupPath(i,{parent:!0}),L=b.node,!k||!L)throw new u.ErrnoError(44);if(k.mount!==L.mount)throw new u.ErrnoError(75);var X=u.lookupNode(k,c),ee=yn.relative(o,a);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=yn.relative(i,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var oe;try{oe=u.lookupNode(L,d)}catch{}if(X!==oe){var T=u.isDir(X.mode),g=u.mayDelete(k,c,T);if(g)throw new u.ErrnoError(g);if(g=oe?u.mayDelete(L,d,T):u.mayCreate(L,d),g)throw new u.ErrnoError(g);if(!k.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(X)||oe&&u.isMountpoint(oe))throw new u.ErrnoError(10);if(L!==k&&(g=u.nodePermissions(k,"w"),g))throw new u.ErrnoError(g);u.hashRemoveNode(X);try{k.node_ops.rename(X,L,d)}catch(w){throw w}finally{u.hashAddNode(X)}}},rmdir:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node,a=Fe.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!0);if(d)throw new u.ErrnoError(d);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.rmdir(l,a),u.destroyNode(c)},readdir:o=>{var i=u.lookupPath(o,{follow:!0}),l=i.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node;if(!l)throw new u.ErrnoError(44);var a=Fe.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!1);if(d)throw new u.ErrnoError(d);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.unlink(l,a),u.destroyNode(c)},readlink:o=>{var i=u.lookupPath(o),l=i.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return yn.resolve(u.getPath(l.parent),l.node_ops.readlink(l))},stat:(o,i)=>{var l=u.lookupPath(o,{follow:!i}),a=l.node;if(!a)throw new u.ErrnoError(44);if(!a.node_ops.getattr)throw new u.ErrnoError(63);return a.node_ops.getattr(a)},lstat:o=>u.stat(o,!0),chmod:(o,i,l)=>{var a;if(typeof o=="string"){var c=u.lookupPath(o,{follow:!l});a=c.node}else a=o;if(!a.node_ops.setattr)throw new u.ErrnoError(63);a.node_ops.setattr(a,{mode:i&4095|a.mode&-4096,timestamp:Date.now()})},lchmod:(o,i)=>{u.chmod(o,i,!0)},fchmod:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);u.chmod(l.node,i)},chown:(o,i,l,a)=>{var c;if(typeof o=="string"){var d=u.lookupPath(o,{follow:!a});c=d.node}else c=o;if(!c.node_ops.setattr)throw new u.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown:(o,i,l)=>{u.chown(o,i,l,!0)},fchown:(o,i,l)=>{var a=u.getStream(o);if(!a)throw new u.ErrnoError(8);u.chown(a.node,i,l)},truncate:(o,i)=>{if(i<0)throw new u.ErrnoError(28);var l;if(typeof o=="string"){var a=u.lookupPath(o,{follow:!0});l=a.node}else l=o;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var c=u.nodePermissions(l,"w");if(c)throw new u.ErrnoError(c);l.node_ops.setattr(l,{size:i,timestamp:Date.now()})},ftruncate:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,i)},utime:(o,i,l)=>{var a=u.lookupPath(o,{follow:!0}),c=a.node;c.node_ops.setattr(c,{timestamp:Math.max(i,l)})},open:(o,i,l)=>{if(o==="")throw new u.ErrnoError(44);i=typeof i=="string"?u.modeStringToFlags(i):i,l=typeof l>"u"?438:l,i&64?l=l&4095|32768:l=0;var a;if(typeof o=="object")a=o;else{o=Fe.normalize(o);try{var c=u.lookupPath(o,{follow:!(i&131072)});a=c.node}catch{}}var d=!1;if(i&64)if(a){if(i&128)throw new u.ErrnoError(20)}else a=u.mknod(o,l,0),d=!0;if(!a)throw new u.ErrnoError(44);if(u.isChrdev(a.mode)&&(i&=-513),i&65536&&!u.isDir(a.mode))throw new u.ErrnoError(54);if(!d){var b=u.mayOpen(a,i);if(b)throw new u.ErrnoError(b)}i&512&&!d&&u.truncate(a,0),i&=-131713;var k=u.createStream({node:a,path:u.getPath(a),flags:i,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1});return k.stream_ops.open&&k.stream_ops.open(k),n.logReadFiles&&!(i&1)&&(u.readFiles||(u.readFiles={}),o in u.readFiles||(u.readFiles[o]=1)),k},close:o=>{if(u.isClosed(o))throw new u.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(i){throw i}finally{u.closeStream(o.fd)}o.fd=null},isClosed:o=>o.fd===null,llseek:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return o.position=o.stream_ops.llseek(o,i,l),o.ungotten=[],o.position},read:(o,i,l,a,c)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if((o.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.read)throw new u.ErrnoError(28);var d=typeof c<"u";if(!d)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var b=o.stream_ops.read(o,i,l,a,c);return d||(o.position+=b),b},write:(o,i,l,a,c,d)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.write)throw new u.ErrnoError(28);o.seekable&&o.flags&1024&&u.llseek(o,0,2);var b=typeof c<"u";if(!b)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var k=o.stream_ops.write(o,i,l,a,c,d);return b||(o.position+=k),k},allocate:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(i<0||l<=0)throw new u.ErrnoError(28);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(o.node.mode)&&!u.isDir(o.node.mode))throw new u.ErrnoError(43);if(!o.stream_ops.allocate)throw new u.ErrnoError(138);o.stream_ops.allocate(o,i,l)},mmap:(o,i,l,a,c)=>{if(a&2&&!(c&2)&&(o.flags&2097155)!==2)throw new u.ErrnoError(2);if((o.flags&2097155)===1)throw new u.ErrnoError(2);if(!o.stream_ops.mmap)throw new u.ErrnoError(43);return o.stream_ops.mmap(o,i,l,a,c)},msync:(o,i,l,a,c)=>o.stream_ops.msync?o.stream_ops.msync(o,i,l,a,c):0,munmap:o=>0,ioctl:(o,i,l)=>{if(!o.stream_ops.ioctl)throw new u.ErrnoError(59);return o.stream_ops.ioctl(o,i,l)},readFile:(o,i={})=>{if(i.flags=i.flags||0,i.encoding=i.encoding||"binary",i.encoding!=="utf8"&&i.encoding!=="binary")throw new Error('Invalid encoding type "'+i.encoding+'"');var l,a=u.open(o,i.flags),c=u.stat(o),d=c.size,b=new Uint8Array(d);return u.read(a,b,0,d,0),i.encoding==="utf8"?l=Br(b,0):i.encoding==="binary"&&(l=b),u.close(a),l},writeFile:(o,i,l={})=>{l.flags=l.flags||577;var a=u.open(o,l.flags,l.mode);if(typeof i=="string"){var c=new Uint8Array(Ai(i)+1),d=Bs(i,c,0,c.length);u.write(a,c,0,d,void 0,l.canOwn)}else if(ArrayBuffer.isView(i))u.write(a,i,0,i.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(a)},cwd:()=>u.currentPath,chdir:o=>{var i=u.lookupPath(o,{follow:!0});if(i.node===null)throw new u.ErrnoError(44);if(!u.isDir(i.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(i.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=i.path},createDefaultDirectories:()=>{u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices:()=>{u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(i,l,a,c,d)=>c}),u.mkdev("/dev/null",u.makedev(1,3)),ir.register(u.makedev(5,0),ir.default_tty_ops),ir.register(u.makedev(6,0),ir.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var o=td();u.createDevice("/dev","random",o),u.createDevice("/dev","urandom",o),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{u.mkdir("/proc");var o=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount:()=>{var i=u.createNode(o,"fd",16895,73);return i.node_ops={lookup:(l,a)=>{var c=+a,d=u.getStream(c);if(!d)throw new u.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>d.path}};return b.parent=b,b}},i}},{},"/proc/self/fd")},createStandardStreams:()=>{n.stdin?u.createDevice("/dev","stdin",n.stdin):u.symlink("/dev/tty","/dev/stdin"),n.stdout?u.createDevice("/dev","stdout",null,n.stdout):u.symlink("/dev/tty","/dev/stdout"),n.stderr?u.createDevice("/dev","stderr",null,n.stderr):u.symlink("/dev/tty1","/dev/stderr"),u.open("/dev/stdin",0),u.open("/dev/stdout",1),u.open("/dev/stderr",1)},ensureErrnoError:()=>{u.ErrnoError||(u.ErrnoError=function(i,l){this.node=l,this.setErrno=function(a){this.errno=a},this.setErrno(i),this.message="FS error"},u.ErrnoError.prototype=new Error,u.ErrnoError.prototype.constructor=u.ErrnoError,[44].forEach(o=>{u.genericErrors[o]=new u.ErrnoError(o),u.genericErrors[o].stack="<generic error, no stack>"}))},staticInit:()=>{u.ensureErrnoError(),u.nameTable=new Array(4096),u.mount(we,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:we}},init:(o,i,l)=>{u.init.initialized=!0,u.ensureErrnoError(),n.stdin=o||n.stdin,n.stdout=i||n.stdout,n.stderr=l||n.stderr,u.createStandardStreams()},quit:()=>{u.init.initialized=!1;for(var o=0;o<u.streams.length;o++){var i=u.streams[o];i&&u.close(i)}},getMode:(o,i)=>{var l=0;return o&&(l|=365),i&&(l|=146),l},findObject:(o,i)=>{var l=u.analyzePath(o,i);return l.exists?l.object:null},analyzePath:(o,i)=>{try{var l=u.lookupPath(o,{follow:!i});o=l.path}catch{}var a={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(o,{parent:!0});a.parentExists=!0,a.parentPath=l.path,a.parentObject=l.node,a.name=Fe.basename(o),l=u.lookupPath(o,{follow:!i}),a.exists=!0,a.path=l.path,a.object=l.node,a.name=l.node.name,a.isRoot=l.path==="/"}catch(c){a.error=c.errno}return a},createPath:(o,i,l,a)=>{o=typeof o=="string"?o:u.getPath(o);for(var c=i.split("/").reverse();c.length;){var d=c.pop();if(d){var b=Fe.join2(o,d);try{u.mkdir(b)}catch{}o=b}}return b},createFile:(o,i,l,a,c)=>{var d=Fe.join2(typeof o=="string"?o:u.getPath(o),i),b=u.getMode(a,c);return u.create(d,b)},createDataFile:(o,i,l,a,c,d)=>{var b=i;o&&(o=typeof o=="string"?o:u.getPath(o),b=i?Fe.join2(o,i):o);var k=u.getMode(a,c),L=u.create(b,k);if(l){if(typeof l=="string"){for(var X=new Array(l.length),ee=0,oe=l.length;ee<oe;++ee)X[ee]=l.charCodeAt(ee);l=X}u.chmod(L,k|146);var T=u.open(L,577);u.write(T,l,0,l.length,0,d),u.close(T),u.chmod(L,k)}return L},createDevice:(o,i,l,a)=>{var c=Fe.join2(typeof o=="string"?o:u.getPath(o),i),d=u.getMode(!!l,!!a);u.createDevice.major||(u.createDevice.major=64);var b=u.makedev(u.createDevice.major++,0);return u.registerDevice(b,{open:k=>{k.seekable=!1},close:k=>{a&&a.buffer&&a.buffer.length&&a(10)},read:(k,L,X,ee,oe)=>{for(var T=0,g=0;g<ee;g++){var w;try{w=l()}catch{throw new u.ErrnoError(29)}if(w===void 0&&T===0)throw new u.ErrnoError(6);if(w==null)break;T++,L[X+g]=w}return T&&(k.node.timestamp=Date.now()),T},write:(k,L,X,ee,oe)=>{for(var T=0;T<ee;T++)try{a(L[X+T])}catch{throw new u.ErrnoError(29)}return ee&&(k.node.timestamp=Date.now()),T}}),u.mkdev(c,d,b)},forceLoadFile:o=>{if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Rn)try{o.contents=Fo(Rn(o.url),!0),o.usedBytes=o.contents.length}catch{throw new u.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(o,i,l,a,c)=>{function d(){this.lengthKnown=!1,this.chunks=[]}if(d.prototype.get=function(g){if(!(g>this.length-1||g<0)){var w=g%this.chunkSize,S=g/this.chunkSize|0;return this.getter(S)[w]}},d.prototype.setDataGetter=function(g){this.getter=g},d.prototype.cacheLength=function(){var g=new XMLHttpRequest;if(g.open("HEAD",l,!1),g.send(null),!(g.status>=200&&g.status<300||g.status===304))throw new Error("Couldn't load "+l+". Status: "+g.status);var w=Number(g.getResponseHeader("Content-length")),S,A=(S=g.getResponseHeader("Accept-Ranges"))&&S==="bytes",q=(S=g.getResponseHeader("Content-Encoding"))&&S==="gzip",B=1024*1024;A||(B=w);var J=(U,ce)=>{if(U>ce)throw new Error("invalid range ("+U+", "+ce+") or no bytes requested!");if(ce>w-1)throw new Error("only "+w+" bytes available! programmer error!");var m=new XMLHttpRequest;if(m.open("GET",l,!1),w!==B&&m.setRequestHeader("Range","bytes="+U+"-"+ce),m.responseType="arraybuffer",m.overrideMimeType&&m.overrideMimeType("text/plain; charset=x-user-defined"),m.send(null),!(m.status>=200&&m.status<300||m.status===304))throw new Error("Couldn't load "+l+". Status: "+m.status);return m.response!==void 0?new Uint8Array(m.response||[]):Fo(m.responseText||"",!0)},H=this;H.setDataGetter(U=>{var ce=U*B,m=(U+1)*B-1;if(m=Math.min(m,w-1),typeof H.chunks[U]>"u"&&(H.chunks[U]=J(ce,m)),typeof H.chunks[U]>"u")throw new Error("doXHR failed!");return H.chunks[U]}),(q||!w)&&(B=w=1,w=this.getter(0).length,B=w,ut("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=w,this._chunkSize=B,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!se)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new d;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var k={isDevice:!1,contents:b}}else var k={isDevice:!1,url:l};var L=u.createFile(o,i,k,a,c);k.contents?L.contents=k.contents:k.url&&(L.contents=null,L.url=k.url),Object.defineProperties(L,{usedBytes:{get:function(){return this.contents.length}}});var X={},ee=Object.keys(L.stream_ops);ee.forEach(T=>{var g=L.stream_ops[T];X[T]=function(){return u.forceLoadFile(L),g.apply(null,arguments)}});function oe(T,g,w,S,A){var q=T.node.contents;if(A>=q.length)return 0;var B=Math.min(q.length-A,S);if(q.slice)for(var J=0;J<B;J++)g[w+J]=q[A+J];else for(var J=0;J<B;J++)g[w+J]=q.get(A+J);return B}return X.read=(T,g,w,S,A)=>(u.forceLoadFile(L),oe(T,g,w,S,A)),X.mmap=(T,g,w,S,A)=>{u.forceLoadFile(L);var q=_l(g);if(!q)throw new u.ErrnoError(48);return oe(T,Wt,q,g,w),{ptr:q,allocated:!0}},L.stream_ops=X,L},createPreloadedFile:(o,i,l,a,c,d,b,k,L,X)=>{var ee=i?yn.resolve(Fe.join2(o,i)):o;function oe(T){function g(w){X&&X(),k||u.createDataFile(o,i,w,a,c,L),d&&d(),Qs()}Browser.handledByPreloadPlugin(T,ee,g,()=>{b&&b(),Qs()})||g(T)}Co(),typeof l=="string"?id(l,T=>oe(T),b):oe(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=()=>{ut("creating db");var d=c.result;d.createObjectStore(u.DB_STORE_NAME)},c.onsuccess=()=>{var d=c.result,b=d.transaction([u.DB_STORE_NAME],"readwrite"),k=b.objectStore(u.DB_STORE_NAME),L=0,X=0,ee=o.length;function oe(){X==0?i():l()}o.forEach(T=>{var g=k.put(u.analyzePath(T).object.contents,T);g.onsuccess=()=>{L++,L+X==ee&&oe()},g.onerror=()=>{X++,L+X==ee&&oe()}}),b.onerror=l},c.onerror=l},loadFilesFromDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=l,c.onsuccess=()=>{var d=c.result;try{var b=d.transaction([u.DB_STORE_NAME],"readonly")}catch(T){l(T);return}var k=b.objectStore(u.DB_STORE_NAME),L=0,X=0,ee=o.length;function oe(){X==0?i():l()}o.forEach(T=>{var g=k.get(T);g.onsuccess=()=>{u.analyzePath(T).exists&&u.unlink(T),u.createDataFile(Fe.dirname(T),Fe.basename(T),g.result,!0,!0,!0),L++,L+X==ee&&oe()},g.onerror=()=>{X++,L+X==ee&&oe()}}),b.onerror=l},c.onerror=l}},_e={DEFAULT_POLLMASK:5,calculateAt:function(o,i,l){if(Fe.isAbs(i))return i;var a;if(o===-100)a=u.cwd();else{var c=_e.getStreamFromFD(o);a=c.path}if(i.length==0){if(!l)throw new u.ErrnoError(44);return a}return Fe.join2(a,i)},doStat:function(o,i,l){try{var a=o(i)}catch(k){if(k&&k.node&&Fe.normalize(i)!==Fe.normalize(u.getPath(k.node)))return-54;throw k}qe[l>>2]=a.dev,qe[l+8>>2]=a.ino,qe[l+12>>2]=a.mode,it[l+16>>2]=a.nlink,qe[l+20>>2]=a.uid,qe[l+24>>2]=a.gid,qe[l+28>>2]=a.rdev,dt=[a.size>>>0,(Se=a.size,+Math.abs(Se)>=1?Se>0?(Math.min(+Math.floor(Se/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Se-+(~~Se>>>0))/4294967296)>>>0:0)],qe[l+40>>2]=dt[0],qe[l+44>>2]=dt[1],qe[l+48>>2]=4096,qe[l+52>>2]=a.blocks;var c=a.atime.getTime(),d=a.mtime.getTime(),b=a.ctime.getTime();return dt=[Math.floor(c/1e3)>>>0,(Se=Math.floor(c/1e3),+Math.abs(Se)>=1?Se>0?(Math.min(+Math.floor(Se/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Se-+(~~Se>>>0))/4294967296)>>>0:0)],qe[l+56>>2]=dt[0],qe[l+60>>2]=dt[1],it[l+64>>2]=c%1e3*1e3,dt=[Math.floor(d/1e3)>>>0,(Se=Math.floor(d/1e3),+Math.abs(Se)>=1?Se>0?(Math.min(+Math.floor(Se/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Se-+(~~Se>>>0))/4294967296)>>>0:0)],qe[l+72>>2]=dt[0],qe[l+76>>2]=dt[1],it[l+80>>2]=d%1e3*1e3,dt=[Math.floor(b/1e3)>>>0,(Se=Math.floor(b/1e3),+Math.abs(Se)>=1?Se>0?(Math.min(+Math.floor(Se/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Se-+(~~Se>>>0))/4294967296)>>>0:0)],qe[l+88>>2]=dt[0],qe[l+92>>2]=dt[1],it[l+96>>2]=b%1e3*1e3,dt=[a.ino>>>0,(Se=a.ino,+Math.abs(Se)>=1?Se>0?(Math.min(+Math.floor(Se/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Se-+(~~Se>>>0))/4294967296)>>>0:0)],qe[l+104>>2]=dt[0],qe[l+108>>2]=dt[1],0},doMsync:function(o,i,l,a,c){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);if(a&2)return 0;var d=Qr.slice(o,o+l);u.msync(i,d,c,l,a)},varargs:void 0,get:function(){_e.varargs+=4;var o=qe[_e.varargs-4>>2];return o},getStr:function(o){var i=Vu(o);return i},getStreamFromFD:function(o){var i=u.getStream(o);if(!i)throw new u.ErrnoError(8);return i}};function sd(o,i){try{return o=_e.getStr(o),u.chmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function od(o,i,l,a){try{if(i=_e.getStr(i),i=_e.calculateAt(o,i),l&-8)return-28;var c=u.lookupPath(i,{follow:!0}),d=c.node;if(!d)return-44;var b="";return l&4&&(b+="r"),l&2&&(b+="w"),l&1&&(b+="x"),b&&u.nodePermissions(d,b)?-2:0}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function ad(o,i){try{return u.fchmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function ld(o,i,l){try{return u.fchown(o,i,l),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function cd(o){return qe[ql()>>2]=o,o}function ud(o,i,l){_e.varargs=l;try{var a=_e.getStreamFromFD(o);switch(i){case 0:{var c=_e.get();if(c<0)return-28;var d;return d=u.createStream(a,c),d.fd}case 1:case 2:return 0;case 3:return a.flags;case 4:{var c=_e.get();return a.flags|=c,0}case 5:{var c=_e.get(),b=0;return al[c+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return cd(28),-1;default:return-28}}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function dd(o,i){try{var l=_e.getStreamFromFD(o);return _e.doStat(u.stat,l.path,i)}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}var fd=9007199254740992,hd=-9007199254740992;function ml(o){return o<hd||o>fd?NaN:Number(o)}function pd(o,i){try{return i=ml(i),isNaN(i)?-61:(u.ftruncate(o,i),0)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function _d(o,i){try{if(i===0)return-28;var l=u.cwd(),a=Ai(l)+1;return i<a?-68:(ol(l,o,i),a)}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return-c.errno}}function md(o,i,l){_e.varargs=l;try{var a=_e.getStreamFromFD(o);switch(i){case 21509:case 21505:return a.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return a.tty?0:-59;case 21519:{if(!a.tty)return-59;var c=_e.get();return qe[c>>2]=0,0}case 21520:return a.tty?-28:-59;case 21531:{var c=_e.get();return u.ioctl(a,i,c)}case 21523:return a.tty?0:-59;case 21524:return a.tty?0:-59;default:return-28}}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function yd(o,i){try{return o=_e.getStr(o),_e.doStat(u.lstat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function gd(o,i,l){try{return i=_e.getStr(i),i=_e.calculateAt(o,i),i=Fe.normalize(i),i[i.length-1]==="/"&&(i=i.substr(0,i.length-1)),u.mkdir(i,l,0),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function wd(o,i,l,a){try{i=_e.getStr(i);var c=a&256,d=a&4096;return a=a&-6401,i=_e.calculateAt(o,i,d),_e.doStat(c?u.lstat:u.stat,i,l)}catch(b){if(typeof u>"u"||!(b instanceof u.ErrnoError))throw b;return-b.errno}}function bd(o,i,l,a){_e.varargs=a;try{i=_e.getStr(i),i=_e.calculateAt(o,i);var c=a?_e.get():0;return u.open(i,l,c).fd}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function qd(o,i,l,a){try{if(i=_e.getStr(i),i=_e.calculateAt(o,i),a<=0)return-28;var c=u.readlink(i),d=Math.min(a,Ai(c)),b=Wt[l+d];return ol(c,l,a+1),Wt[l+d]=b,d}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function Nd(o){try{return o=_e.getStr(o),u.rmdir(o),0}catch(i){if(typeof u>"u"||!(i instanceof u.ErrnoError))throw i;return-i.errno}}function vd(o,i){try{return o=_e.getStr(o),_e.doStat(u.stat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function xd(o,i,l){try{return i=_e.getStr(i),i=_e.calculateAt(o,i),l===0?u.unlink(i):l===512?u.rmdir(i):Ur("Invalid flags passed to unlinkat"),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function Lo(o){return it[o>>2]+qe[o+4>>2]*4294967296}function Ed(o,i,l,a){try{if(i=_e.getStr(i),i=_e.calculateAt(o,i,!0),l){var b=Lo(l),k=qe[l+8>>2];c=b*1e3+k/(1e3*1e3),l+=16,b=Lo(l),k=qe[l+8>>2],d=b*1e3+k/(1e3*1e3)}else var c=Date.now(),d=c;return u.utime(i,c,d),0}catch(L){if(typeof u>"u"||!(L instanceof u.ErrnoError))throw L;return-L.errno}}var Sd=!0;function Ad(){return Sd}function kd(o){return o%4===0&&(o%100!==0||o%400===0)}var Id=[0,31,60,91,121,152,182,213,244,274,305,335],Od=[0,31,59,90,120,151,181,212,243,273,304,334];function Td(o){var i=kd(o.getFullYear()),l=i?Id:Od,a=l[o.getMonth()]+o.getDate()-1;return a}function Cd(o,i){var l=new Date(Lo(o)*1e3);qe[i>>2]=l.getSeconds(),qe[i+4>>2]=l.getMinutes(),qe[i+8>>2]=l.getHours(),qe[i+12>>2]=l.getDate(),qe[i+16>>2]=l.getMonth(),qe[i+20>>2]=l.getFullYear()-1900,qe[i+24>>2]=l.getDay();var a=Td(l)|0;qe[i+28>>2]=a,qe[i+36>>2]=-(l.getTimezoneOffset()*60);var c=new Date(l.getFullYear(),0,1),d=new Date(l.getFullYear(),6,1).getTimezoneOffset(),b=c.getTimezoneOffset(),k=(d!=b&&l.getTimezoneOffset()==Math.min(b,d))|0;qe[i+32>>2]=k}function Pd(o,i,l,a,c,d,b){try{var k=_e.getStreamFromFD(a),L=u.mmap(k,o,c,i,l),X=L.ptr;return qe[d>>2]=L.allocated,it[b>>2]=X,0}catch(ee){if(typeof u>"u"||!(ee instanceof u.ErrnoError))throw ee;return-ee.errno}}function Fd(o,i,l,a,c,d){try{var b=_e.getStreamFromFD(c);l&2&&_e.doMsync(o,b,i,a,d),u.munmap(b)}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function yl(o){var i=Ai(o)+1,l=Nl(i);return l&&Bs(o,Wt,l,i),l}function Ld(o,i,l){var a=new Date().getFullYear(),c=new Date(a,0,1),d=new Date(a,6,1),b=c.getTimezoneOffset(),k=d.getTimezoneOffset(),L=Math.max(b,k);it[o>>2]=L*60,qe[i>>2]=+(b!=k);function X(w){var S=w.toTimeString().match(/\(([A-Za-z ]+)\)$/);return S?S[1]:"GMT"}var ee=X(c),oe=X(d),T=yl(ee),g=yl(oe);k<b?(it[l>>2]=T,it[l+4>>2]=g):(it[l>>2]=g,it[l+4>>2]=T)}function Wd(){return Date.now()}var gl;gl=()=>performance.now();function Dd(){return 2147483648}function Rd(o){var i=rn.buffer;try{return rn.grow(o-i.byteLength+65535>>>16),ll(),1}catch{}}function Md(o){var i=Qr.length;o=o>>>0;var l=Dd();if(o>l)return!1;let a=(L,X)=>L+(X-L%X)%X;for(var c=1;c<=4;c*=2){var d=i*(1+.2/c);d=Math.min(d,o+100663296);var b=Math.min(l,a(Math.max(o,d),65536)),k=Rd(b);if(k)return!0}return!1}var Wo={};function Bd(){return Xe||"./this.program"}function Ii(){if(!Ii.strings){var o=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:Bd()};for(var l in Wo)Wo[l]===void 0?delete i[l]:i[l]=Wo[l];var a=[];for(var l in i)a.push(l+"="+i[l]);Ii.strings=a}return Ii.strings}function Qd(o,i,l){for(var a=0;a<o.length;++a)Wt[i++>>0]=o.charCodeAt(a);l||(Wt[i>>0]=0)}function Ud(o,i){var l=0;return Ii().forEach(function(a,c){var d=i+l;it[o+c*4>>2]=d,Qd(a,d),l+=a.length+1}),0}function jd(o,i){var l=Ii();it[o>>2]=l.length;var a=0;return l.forEach(function(c){a+=c.length+1}),it[i>>2]=a,0}function zd(o){try{var i=_e.getStreamFromFD(o);return u.close(i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Vd(o,i){try{var l=_e.getStreamFromFD(o),a=l.tty?2:u.isDir(l.mode)?3:u.isLink(l.mode)?7:4;return Wt[i>>0]=a,0}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return c.errno}}function $d(o,i,l,a){for(var c=0,d=0;d<l;d++){var b=it[i>>2],k=it[i+4>>2];i+=8;var L=u.read(o,Wt,b,k,a);if(L<0)return-1;if(c+=L,L<k)break;typeof a<"u"&&(a+=L)}return c}function Hd(o,i,l,a){try{var c=_e.getStreamFromFD(o),d=$d(c,i,l);return it[a>>2]=d,0}catch(b){if(typeof u>"u"||!(b instanceof u.ErrnoError))throw b;return b.errno}}function Jd(o,i,l,a){try{if(i=ml(i),isNaN(i))return 61;var c=_e.getStreamFromFD(o);return u.llseek(c,i,l),dt=[c.position>>>0,(Se=c.position,+Math.abs(Se)>=1?Se>0?(Math.min(+Math.floor(Se/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Se-+(~~Se>>>0))/4294967296)>>>0:0)],qe[a>>2]=dt[0],qe[a+4>>2]=dt[1],c.getdents&&i===0&&l===0&&(c.getdents=null),0}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return d.errno}}function Gd(o){try{var i=_e.getStreamFromFD(o);return i.stream_ops&&i.stream_ops.fsync?i.stream_ops.fsync(i):0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Kd(o,i,l,a){for(var c=0,d=0;d<l;d++){var b=it[i>>2],k=it[i+4>>2];i+=8;var L=u.write(o,Wt,b,k,a);if(L<0)return-1;c+=L,typeof a<"u"&&(a+=L)}return c}function Xd(o,i,l,a){try{var c=_e.getStreamFromFD(o),d=Kd(c,i,l);return it[a>>2]=d,0}catch(b){if(typeof u>"u"||!(b instanceof u.ErrnoError))throw b;return b.errno}}var wl=function(o,i,l,a){o||(o=this),this.parent=o,this.mount=o.mount,this.mounted=null,this.id=u.nextInode++,this.name=i,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=a},Us=365,js=146;Object.defineProperties(wl.prototype,{read:{get:function(){return(this.mode&Us)===Us},set:function(o){o?this.mode|=Us:this.mode&=~Us}},write:{get:function(){return(this.mode&js)===js},set:function(o){o?this.mode|=js:this.mode&=~js}},isFolder:{get:function(){return u.isDir(this.mode)}},isDevice:{get:function(){return u.isChrdev(this.mode)}}}),u.FSNode=wl,u.staticInit();var bl={__syscall_chmod:sd,__syscall_faccessat:od,__syscall_fchmod:ad,__syscall_fchown32:ld,__syscall_fcntl64:ud,__syscall_fstat64:dd,__syscall_ftruncate64:pd,__syscall_getcwd:_d,__syscall_ioctl:md,__syscall_lstat64:yd,__syscall_mkdirat:gd,__syscall_newfstatat:wd,__syscall_openat:bd,__syscall_readlinkat:qd,__syscall_rmdir:Nd,__syscall_stat64:vd,__syscall_unlinkat:xd,__syscall_utimensat:Ed,_emscripten_get_now_is_monotonic:Ad,_localtime_js:Cd,_mmap_js:Pd,_munmap_js:Fd,_tzset_js:Ld,emscripten_date_now:Wd,emscripten_get_now:gl,emscripten_resize_heap:Md,environ_get:Ud,environ_sizes_get:jd,fd_close:zd,fd_fdstat_get:Vd,fd_read:Hd,fd_seek:Jd,fd_sync:Gd,fd_write:Xd,memory:rn};ed(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._sqlite3_status64=function(){return(n._sqlite3_status64=n.asm.sqlite3_status64).apply(null,arguments)},n._sqlite3_status=function(){return(n._sqlite3_status=n.asm.sqlite3_status).apply(null,arguments)},n._sqlite3_db_status=function(){return(n._sqlite3_db_status=n.asm.sqlite3_db_status).apply(null,arguments)},n._sqlite3_msize=function(){return(n._sqlite3_msize=n.asm.sqlite3_msize).apply(null,arguments)},n._sqlite3_vfs_find=function(){return(n._sqlite3_vfs_find=n.asm.sqlite3_vfs_find).apply(null,arguments)},n._sqlite3_initialize=function(){return(n._sqlite3_initialize=n.asm.sqlite3_initialize).apply(null,arguments)},n._sqlite3_malloc=function(){return(n._sqlite3_malloc=n.asm.sqlite3_malloc).apply(null,arguments)},n._sqlite3_free=function(){return(n._sqlite3_free=n.asm.sqlite3_free).apply(null,arguments)},n._sqlite3_vfs_register=function(){return(n._sqlite3_vfs_register=n.asm.sqlite3_vfs_register).apply(null,arguments)},n._sqlite3_vfs_unregister=function(){return(n._sqlite3_vfs_unregister=n.asm.sqlite3_vfs_unregister).apply(null,arguments)},n._sqlite3_malloc64=function(){return(n._sqlite3_malloc64=n.asm.sqlite3_malloc64).apply(null,arguments)},n._sqlite3_realloc=function(){return(n._sqlite3_realloc=n.asm.sqlite3_realloc).apply(null,arguments)},n._sqlite3_realloc64=function(){return(n._sqlite3_realloc64=n.asm.sqlite3_realloc64).apply(null,arguments)},n._sqlite3_value_text=function(){return(n._sqlite3_value_text=n.asm.sqlite3_value_text).apply(null,arguments)},n._sqlite3_randomness=function(){return(n._sqlite3_randomness=n.asm.sqlite3_randomness).apply(null,arguments)},n._sqlite3_stricmp=function(){return(n._sqlite3_stricmp=n.asm.sqlite3_stricmp).apply(null,arguments)},n._sqlite3_strnicmp=function(){return(n._sqlite3_strnicmp=n.asm.sqlite3_strnicmp).apply(null,arguments)},n._sqlite3_uri_parameter=function(){return(n._sqlite3_uri_parameter=n.asm.sqlite3_uri_parameter).apply(null,arguments)};var ql=n.___errno_location=function(){return(ql=n.___errno_location=n.asm.__errno_location).apply(null,arguments)};n._sqlite3_uri_boolean=function(){return(n._sqlite3_uri_boolean=n.asm.sqlite3_uri_boolean).apply(null,arguments)},n._sqlite3_serialize=function(){return(n._sqlite3_serialize=n.asm.sqlite3_serialize).apply(null,arguments)},n._sqlite3_prepare_v2=function(){return(n._sqlite3_prepare_v2=n.asm.sqlite3_prepare_v2).apply(null,arguments)},n._sqlite3_step=function(){return(n._sqlite3_step=n.asm.sqlite3_step).apply(null,arguments)},n._sqlite3_column_int64=function(){return(n._sqlite3_column_int64=n.asm.sqlite3_column_int64).apply(null,arguments)},n._sqlite3_column_int=function(){return(n._sqlite3_column_int=n.asm.sqlite3_column_int).apply(null,arguments)},n._sqlite3_finalize=function(){return(n._sqlite3_finalize=n.asm.sqlite3_finalize).apply(null,arguments)},n._sqlite3_file_control=function(){return(n._sqlite3_file_control=n.asm.sqlite3_file_control).apply(null,arguments)},n._sqlite3_reset=function(){return(n._sqlite3_reset=n.asm.sqlite3_reset).apply(null,arguments)},n._sqlite3_deserialize=function(){return(n._sqlite3_deserialize=n.asm.sqlite3_deserialize).apply(null,arguments)},n._sqlite3_clear_bindings=function(){return(n._sqlite3_clear_bindings=n.asm.sqlite3_clear_bindings).apply(null,arguments)},n._sqlite3_value_blob=function(){return(n._sqlite3_value_blob=n.asm.sqlite3_value_blob).apply(null,arguments)},n._sqlite3_value_bytes=function(){return(n._sqlite3_value_bytes=n.asm.sqlite3_value_bytes).apply(null,arguments)},n._sqlite3_value_double=function(){return(n._sqlite3_value_double=n.asm.sqlite3_value_double).apply(null,arguments)},n._sqlite3_value_int=function(){return(n._sqlite3_value_int=n.asm.sqlite3_value_int).apply(null,arguments)},n._sqlite3_value_int64=function(){return(n._sqlite3_value_int64=n.asm.sqlite3_value_int64).apply(null,arguments)},n._sqlite3_value_subtype=function(){return(n._sqlite3_value_subtype=n.asm.sqlite3_value_subtype).apply(null,arguments)},n._sqlite3_value_pointer=function(){return(n._sqlite3_value_pointer=n.asm.sqlite3_value_pointer).apply(null,arguments)},n._sqlite3_value_type=function(){return(n._sqlite3_value_type=n.asm.sqlite3_value_type).apply(null,arguments)},n._sqlite3_value_nochange=function(){return(n._sqlite3_value_nochange=n.asm.sqlite3_value_nochange).apply(null,arguments)},n._sqlite3_value_frombind=function(){return(n._sqlite3_value_frombind=n.asm.sqlite3_value_frombind).apply(null,arguments)},n._sqlite3_value_dup=function(){return(n._sqlite3_value_dup=n.asm.sqlite3_value_dup).apply(null,arguments)},n._sqlite3_value_free=function(){return(n._sqlite3_value_free=n.asm.sqlite3_value_free).apply(null,arguments)},n._sqlite3_result_blob=function(){return(n._sqlite3_result_blob=n.asm.sqlite3_result_blob).apply(null,arguments)},n._sqlite3_result_error_nomem=function(){return(n._sqlite3_result_error_nomem=n.asm.sqlite3_result_error_nomem).apply(null,arguments)},n._sqlite3_result_error_toobig=function(){return(n._sqlite3_result_error_toobig=n.asm.sqlite3_result_error_toobig).apply(null,arguments)},n._sqlite3_result_double=function(){return(n._sqlite3_result_double=n.asm.sqlite3_result_double).apply(null,arguments)},n._sqlite3_result_error=function(){return(n._sqlite3_result_error=n.asm.sqlite3_result_error).apply(null,arguments)},n._sqlite3_result_int=function(){return(n._sqlite3_result_int=n.asm.sqlite3_result_int).apply(null,arguments)},n._sqlite3_result_int64=function(){return(n._sqlite3_result_int64=n.asm.sqlite3_result_int64).apply(null,arguments)},n._sqlite3_result_null=function(){return(n._sqlite3_result_null=n.asm.sqlite3_result_null).apply(null,arguments)},n._sqlite3_result_pointer=function(){return(n._sqlite3_result_pointer=n.asm.sqlite3_result_pointer).apply(null,arguments)},n._sqlite3_result_subtype=function(){return(n._sqlite3_result_subtype=n.asm.sqlite3_result_subtype).apply(null,arguments)},n._sqlite3_result_text=function(){return(n._sqlite3_result_text=n.asm.sqlite3_result_text).apply(null,arguments)},n._sqlite3_result_zeroblob=function(){return(n._sqlite3_result_zeroblob=n.asm.sqlite3_result_zeroblob).apply(null,arguments)},n._sqlite3_result_zeroblob64=function(){return(n._sqlite3_result_zeroblob64=n.asm.sqlite3_result_zeroblob64).apply(null,arguments)},n._sqlite3_result_error_code=function(){return(n._sqlite3_result_error_code=n.asm.sqlite3_result_error_code).apply(null,arguments)},n._sqlite3_user_data=function(){return(n._sqlite3_user_data=n.asm.sqlite3_user_data).apply(null,arguments)},n._sqlite3_context_db_handle=function(){return(n._sqlite3_context_db_handle=n.asm.sqlite3_context_db_handle).apply(null,arguments)},n._sqlite3_vtab_nochange=function(){return(n._sqlite3_vtab_nochange=n.asm.sqlite3_vtab_nochange).apply(null,arguments)},n._sqlite3_vtab_in_first=function(){return(n._sqlite3_vtab_in_first=n.asm.sqlite3_vtab_in_first).apply(null,arguments)},n._sqlite3_vtab_in_next=function(){return(n._sqlite3_vtab_in_next=n.asm.sqlite3_vtab_in_next).apply(null,arguments)},n._sqlite3_aggregate_context=function(){return(n._sqlite3_aggregate_context=n.asm.sqlite3_aggregate_context).apply(null,arguments)},n._sqlite3_get_auxdata=function(){return(n._sqlite3_get_auxdata=n.asm.sqlite3_get_auxdata).apply(null,arguments)},n._sqlite3_set_auxdata=function(){return(n._sqlite3_set_auxdata=n.asm.sqlite3_set_auxdata).apply(null,arguments)},n._sqlite3_column_count=function(){return(n._sqlite3_column_count=n.asm.sqlite3_column_count).apply(null,arguments)},n._sqlite3_data_count=function(){return(n._sqlite3_data_count=n.asm.sqlite3_data_count).apply(null,arguments)},n._sqlite3_column_blob=function(){return(n._sqlite3_column_blob=n.asm.sqlite3_column_blob).apply(null,arguments)},n._sqlite3_column_bytes=function(){return(n._sqlite3_column_bytes=n.asm.sqlite3_column_bytes).apply(null,arguments)},n._sqlite3_column_double=function(){return(n._sqlite3_column_double=n.asm.sqlite3_column_double).apply(null,arguments)},n._sqlite3_column_text=function(){return(n._sqlite3_column_text=n.asm.sqlite3_column_text).apply(null,arguments)},n._sqlite3_column_value=function(){return(n._sqlite3_column_value=n.asm.sqlite3_column_value).apply(null,arguments)},n._sqlite3_column_type=function(){return(n._sqlite3_column_type=n.asm.sqlite3_column_type).apply(null,arguments)},n._sqlite3_column_name=function(){return(n._sqlite3_column_name=n.asm.sqlite3_column_name).apply(null,arguments)},n._sqlite3_bind_blob=function(){return(n._sqlite3_bind_blob=n.asm.sqlite3_bind_blob).apply(null,arguments)},n._sqlite3_bind_double=function(){return(n._sqlite3_bind_double=n.asm.sqlite3_bind_double).apply(null,arguments)},n._sqlite3_bind_int=function(){return(n._sqlite3_bind_int=n.asm.sqlite3_bind_int).apply(null,arguments)},n._sqlite3_bind_int64=function(){return(n._sqlite3_bind_int64=n.asm.sqlite3_bind_int64).apply(null,arguments)},n._sqlite3_bind_null=function(){return(n._sqlite3_bind_null=n.asm.sqlite3_bind_null).apply(null,arguments)},n._sqlite3_bind_pointer=function(){return(n._sqlite3_bind_pointer=n.asm.sqlite3_bind_pointer).apply(null,arguments)},n._sqlite3_bind_text=function(){return(n._sqlite3_bind_text=n.asm.sqlite3_bind_text).apply(null,arguments)},n._sqlite3_bind_parameter_count=function(){return(n._sqlite3_bind_parameter_count=n.asm.sqlite3_bind_parameter_count).apply(null,arguments)},n._sqlite3_bind_parameter_index=function(){return(n._sqlite3_bind_parameter_index=n.asm.sqlite3_bind_parameter_index).apply(null,arguments)},n._sqlite3_db_handle=function(){return(n._sqlite3_db_handle=n.asm.sqlite3_db_handle).apply(null,arguments)},n._sqlite3_stmt_readonly=function(){return(n._sqlite3_stmt_readonly=n.asm.sqlite3_stmt_readonly).apply(null,arguments)},n._sqlite3_stmt_isexplain=function(){return(n._sqlite3_stmt_isexplain=n.asm.sqlite3_stmt_isexplain).apply(null,arguments)},n._sqlite3_stmt_status=function(){return(n._sqlite3_stmt_status=n.asm.sqlite3_stmt_status).apply(null,arguments)},n._sqlite3_sql=function(){return(n._sqlite3_sql=n.asm.sqlite3_sql).apply(null,arguments)},n._sqlite3_expanded_sql=function(){return(n._sqlite3_expanded_sql=n.asm.sqlite3_expanded_sql).apply(null,arguments)},n._sqlite3_preupdate_old=function(){return(n._sqlite3_preupdate_old=n.asm.sqlite3_preupdate_old).apply(null,arguments)},n._sqlite3_preupdate_count=function(){return(n._sqlite3_preupdate_count=n.asm.sqlite3_preupdate_count).apply(null,arguments)},n._sqlite3_preupdate_depth=function(){return(n._sqlite3_preupdate_depth=n.asm.sqlite3_preupdate_depth).apply(null,arguments)},n._sqlite3_preupdate_blobwrite=function(){return(n._sqlite3_preupdate_blobwrite=n.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},n._sqlite3_preupdate_new=function(){return(n._sqlite3_preupdate_new=n.asm.sqlite3_preupdate_new).apply(null,arguments)},n._sqlite3_value_numeric_type=function(){return(n._sqlite3_value_numeric_type=n.asm.sqlite3_value_numeric_type).apply(null,arguments)},n._sqlite3_errmsg=function(){return(n._sqlite3_errmsg=n.asm.sqlite3_errmsg).apply(null,arguments)},n._sqlite3_set_authorizer=function(){return(n._sqlite3_set_authorizer=n.asm.sqlite3_set_authorizer).apply(null,arguments)},n._sqlite3_strglob=function(){return(n._sqlite3_strglob=n.asm.sqlite3_strglob).apply(null,arguments)},n._sqlite3_strlike=function(){return(n._sqlite3_strlike=n.asm.sqlite3_strlike).apply(null,arguments)},n._sqlite3_exec=function(){return(n._sqlite3_exec=n.asm.sqlite3_exec).apply(null,arguments)},n._sqlite3_auto_extension=function(){return(n._sqlite3_auto_extension=n.asm.sqlite3_auto_extension).apply(null,arguments)},n._sqlite3_cancel_auto_extension=function(){return(n._sqlite3_cancel_auto_extension=n.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},n._sqlite3_reset_auto_extension=function(){return(n._sqlite3_reset_auto_extension=n.asm.sqlite3_reset_auto_extension).apply(null,arguments)},n._sqlite3_prepare_v3=function(){return(n._sqlite3_prepare_v3=n.asm.sqlite3_prepare_v3).apply(null,arguments)},n._sqlite3_create_module=function(){return(n._sqlite3_create_module=n.asm.sqlite3_create_module).apply(null,arguments)},n._sqlite3_create_module_v2=function(){return(n._sqlite3_create_module_v2=n.asm.sqlite3_create_module_v2).apply(null,arguments)},n._sqlite3_drop_modules=function(){return(n._sqlite3_drop_modules=n.asm.sqlite3_drop_modules).apply(null,arguments)},n._sqlite3_declare_vtab=function(){return(n._sqlite3_declare_vtab=n.asm.sqlite3_declare_vtab).apply(null,arguments)},n._sqlite3_vtab_on_conflict=function(){return(n._sqlite3_vtab_on_conflict=n.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},n._sqlite3_vtab_collation=function(){return(n._sqlite3_vtab_collation=n.asm.sqlite3_vtab_collation).apply(null,arguments)},n._sqlite3_vtab_in=function(){return(n._sqlite3_vtab_in=n.asm.sqlite3_vtab_in).apply(null,arguments)},n._sqlite3_vtab_rhs_value=function(){return(n._sqlite3_vtab_rhs_value=n.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},n._sqlite3_vtab_distinct=function(){return(n._sqlite3_vtab_distinct=n.asm.sqlite3_vtab_distinct).apply(null,arguments)},n._sqlite3_keyword_name=function(){return(n._sqlite3_keyword_name=n.asm.sqlite3_keyword_name).apply(null,arguments)},n._sqlite3_keyword_count=function(){return(n._sqlite3_keyword_count=n.asm.sqlite3_keyword_count).apply(null,arguments)},n._sqlite3_keyword_check=function(){return(n._sqlite3_keyword_check=n.asm.sqlite3_keyword_check).apply(null,arguments)},n._sqlite3_complete=function(){return(n._sqlite3_complete=n.asm.sqlite3_complete).apply(null,arguments)},n._sqlite3_libversion=function(){return(n._sqlite3_libversion=n.asm.sqlite3_libversion).apply(null,arguments)},n._sqlite3_libversion_number=function(){return(n._sqlite3_libversion_number=n.asm.sqlite3_libversion_number).apply(null,arguments)},n._sqlite3_shutdown=function(){return(n._sqlite3_shutdown=n.asm.sqlite3_shutdown).apply(null,arguments)},n._sqlite3_last_insert_rowid=function(){return(n._sqlite3_last_insert_rowid=n.asm.sqlite3_last_insert_rowid).apply(null,arguments)},n._sqlite3_set_last_insert_rowid=function(){return(n._sqlite3_set_last_insert_rowid=n.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},n._sqlite3_changes64=function(){return(n._sqlite3_changes64=n.asm.sqlite3_changes64).apply(null,arguments)},n._sqlite3_changes=function(){return(n._sqlite3_changes=n.asm.sqlite3_changes).apply(null,arguments)},n._sqlite3_total_changes64=function(){return(n._sqlite3_total_changes64=n.asm.sqlite3_total_changes64).apply(null,arguments)},n._sqlite3_total_changes=function(){return(n._sqlite3_total_changes=n.asm.sqlite3_total_changes).apply(null,arguments)},n._sqlite3_txn_state=function(){return(n._sqlite3_txn_state=n.asm.sqlite3_txn_state).apply(null,arguments)},n._sqlite3_close_v2=function(){return(n._sqlite3_close_v2=n.asm.sqlite3_close_v2).apply(null,arguments)},n._sqlite3_busy_handler=function(){return(n._sqlite3_busy_handler=n.asm.sqlite3_busy_handler).apply(null,arguments)},n._sqlite3_progress_handler=function(){return(n._sqlite3_progress_handler=n.asm.sqlite3_progress_handler).apply(null,arguments)},n._sqlite3_busy_timeout=function(){return(n._sqlite3_busy_timeout=n.asm.sqlite3_busy_timeout).apply(null,arguments)},n._sqlite3_create_function=function(){return(n._sqlite3_create_function=n.asm.sqlite3_create_function).apply(null,arguments)},n._sqlite3_create_function_v2=function(){return(n._sqlite3_create_function_v2=n.asm.sqlite3_create_function_v2).apply(null,arguments)},n._sqlite3_create_window_function=function(){return(n._sqlite3_create_window_function=n.asm.sqlite3_create_window_function).apply(null,arguments)},n._sqlite3_overload_function=function(){return(n._sqlite3_overload_function=n.asm.sqlite3_overload_function).apply(null,arguments)},n._sqlite3_trace_v2=function(){return(n._sqlite3_trace_v2=n.asm.sqlite3_trace_v2).apply(null,arguments)},n._sqlite3_commit_hook=function(){return(n._sqlite3_commit_hook=n.asm.sqlite3_commit_hook).apply(null,arguments)},n._sqlite3_update_hook=function(){return(n._sqlite3_update_hook=n.asm.sqlite3_update_hook).apply(null,arguments)},n._sqlite3_rollback_hook=function(){return(n._sqlite3_rollback_hook=n.asm.sqlite3_rollback_hook).apply(null,arguments)},n._sqlite3_preupdate_hook=function(){return(n._sqlite3_preupdate_hook=n.asm.sqlite3_preupdate_hook).apply(null,arguments)},n._sqlite3_error_offset=function(){return(n._sqlite3_error_offset=n.asm.sqlite3_error_offset).apply(null,arguments)},n._sqlite3_errcode=function(){return(n._sqlite3_errcode=n.asm.sqlite3_errcode).apply(null,arguments)},n._sqlite3_extended_errcode=function(){return(n._sqlite3_extended_errcode=n.asm.sqlite3_extended_errcode).apply(null,arguments)},n._sqlite3_errstr=function(){return(n._sqlite3_errstr=n.asm.sqlite3_errstr).apply(null,arguments)},n._sqlite3_limit=function(){return(n._sqlite3_limit=n.asm.sqlite3_limit).apply(null,arguments)},n._sqlite3_open=function(){return(n._sqlite3_open=n.asm.sqlite3_open).apply(null,arguments)},n._sqlite3_open_v2=function(){return(n._sqlite3_open_v2=n.asm.sqlite3_open_v2).apply(null,arguments)},n._sqlite3_create_collation=function(){return(n._sqlite3_create_collation=n.asm.sqlite3_create_collation).apply(null,arguments)},n._sqlite3_create_collation_v2=function(){return(n._sqlite3_create_collation_v2=n.asm.sqlite3_create_collation_v2).apply(null,arguments)},n._sqlite3_collation_needed=function(){return(n._sqlite3_collation_needed=n.asm.sqlite3_collation_needed).apply(null,arguments)},n._sqlite3_table_column_metadata=function(){return(n._sqlite3_table_column_metadata=n.asm.sqlite3_table_column_metadata).apply(null,arguments)},n._sqlite3_extended_result_codes=function(){return(n._sqlite3_extended_result_codes=n.asm.sqlite3_extended_result_codes).apply(null,arguments)},n._sqlite3_uri_key=function(){return(n._sqlite3_uri_key=n.asm.sqlite3_uri_key).apply(null,arguments)},n._sqlite3_uri_int64=function(){return(n._sqlite3_uri_int64=n.asm.sqlite3_uri_int64).apply(null,arguments)},n._sqlite3_db_name=function(){return(n._sqlite3_db_name=n.asm.sqlite3_db_name).apply(null,arguments)},n._sqlite3_db_filename=function(){return(n._sqlite3_db_filename=n.asm.sqlite3_db_filename).apply(null,arguments)},n._sqlite3_compileoption_used=function(){return(n._sqlite3_compileoption_used=n.asm.sqlite3_compileoption_used).apply(null,arguments)},n._sqlite3_compileoption_get=function(){return(n._sqlite3_compileoption_get=n.asm.sqlite3_compileoption_get).apply(null,arguments)},n._sqlite3session_diff=function(){return(n._sqlite3session_diff=n.asm.sqlite3session_diff).apply(null,arguments)},n._sqlite3session_attach=function(){return(n._sqlite3session_attach=n.asm.sqlite3session_attach).apply(null,arguments)},n._sqlite3session_create=function(){return(n._sqlite3session_create=n.asm.sqlite3session_create).apply(null,arguments)},n._sqlite3session_delete=function(){return(n._sqlite3session_delete=n.asm.sqlite3session_delete).apply(null,arguments)},n._sqlite3session_table_filter=function(){return(n._sqlite3session_table_filter=n.asm.sqlite3session_table_filter).apply(null,arguments)},n._sqlite3session_changeset=function(){return(n._sqlite3session_changeset=n.asm.sqlite3session_changeset).apply(null,arguments)},n._sqlite3session_changeset_strm=function(){return(n._sqlite3session_changeset_strm=n.asm.sqlite3session_changeset_strm).apply(null,arguments)},n._sqlite3session_patchset_strm=function(){return(n._sqlite3session_patchset_strm=n.asm.sqlite3session_patchset_strm).apply(null,arguments)},n._sqlite3session_patchset=function(){return(n._sqlite3session_patchset=n.asm.sqlite3session_patchset).apply(null,arguments)},n._sqlite3session_enable=function(){return(n._sqlite3session_enable=n.asm.sqlite3session_enable).apply(null,arguments)},n._sqlite3session_indirect=function(){return(n._sqlite3session_indirect=n.asm.sqlite3session_indirect).apply(null,arguments)},n._sqlite3session_isempty=function(){return(n._sqlite3session_isempty=n.asm.sqlite3session_isempty).apply(null,arguments)},n._sqlite3session_memory_used=function(){return(n._sqlite3session_memory_used=n.asm.sqlite3session_memory_used).apply(null,arguments)},n._sqlite3session_object_config=function(){return(n._sqlite3session_object_config=n.asm.sqlite3session_object_config).apply(null,arguments)},n._sqlite3session_changeset_size=function(){return(n._sqlite3session_changeset_size=n.asm.sqlite3session_changeset_size).apply(null,arguments)},n._sqlite3changeset_start=function(){return(n._sqlite3changeset_start=n.asm.sqlite3changeset_start).apply(null,arguments)},n._sqlite3changeset_start_v2=function(){return(n._sqlite3changeset_start_v2=n.asm.sqlite3changeset_start_v2).apply(null,arguments)},n._sqlite3changeset_start_strm=function(){return(n._sqlite3changeset_start_strm=n.asm.sqlite3changeset_start_strm).apply(null,arguments)},n._sqlite3changeset_start_v2_strm=function(){return(n._sqlite3changeset_start_v2_strm=n.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},n._sqlite3changeset_next=function(){return(n._sqlite3changeset_next=n.asm.sqlite3changeset_next).apply(null,arguments)},n._sqlite3changeset_op=function(){return(n._sqlite3changeset_op=n.asm.sqlite3changeset_op).apply(null,arguments)},n._sqlite3changeset_pk=function(){return(n._sqlite3changeset_pk=n.asm.sqlite3changeset_pk).apply(null,arguments)},n._sqlite3changeset_old=function(){return(n._sqlite3changeset_old=n.asm.sqlite3changeset_old).apply(null,arguments)},n._sqlite3changeset_new=function(){return(n._sqlite3changeset_new=n.asm.sqlite3changeset_new).apply(null,arguments)},n._sqlite3changeset_conflict=function(){return(n._sqlite3changeset_conflict=n.asm.sqlite3changeset_conflict).apply(null,arguments)},n._sqlite3changeset_fk_conflicts=function(){return(n._sqlite3changeset_fk_conflicts=n.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},n._sqlite3changeset_finalize=function(){return(n._sqlite3changeset_finalize=n.asm.sqlite3changeset_finalize).apply(null,arguments)},n._sqlite3changeset_invert=function(){return(n._sqlite3changeset_invert=n.asm.sqlite3changeset_invert).apply(null,arguments)},n._sqlite3changeset_invert_strm=function(){return(n._sqlite3changeset_invert_strm=n.asm.sqlite3changeset_invert_strm).apply(null,arguments)},n._sqlite3changeset_apply_v2=function(){return(n._sqlite3changeset_apply_v2=n.asm.sqlite3changeset_apply_v2).apply(null,arguments)},n._sqlite3changeset_apply=function(){return(n._sqlite3changeset_apply=n.asm.sqlite3changeset_apply).apply(null,arguments)},n._sqlite3changeset_apply_v2_strm=function(){return(n._sqlite3changeset_apply_v2_strm=n.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},n._sqlite3changeset_apply_strm=function(){return(n._sqlite3changeset_apply_strm=n.asm.sqlite3changeset_apply_strm).apply(null,arguments)},n._sqlite3changegroup_new=function(){return(n._sqlite3changegroup_new=n.asm.sqlite3changegroup_new).apply(null,arguments)},n._sqlite3changegroup_add=function(){return(n._sqlite3changegroup_add=n.asm.sqlite3changegroup_add).apply(null,arguments)},n._sqlite3changegroup_output=function(){return(n._sqlite3changegroup_output=n.asm.sqlite3changegroup_output).apply(null,arguments)},n._sqlite3changegroup_add_strm=function(){return(n._sqlite3changegroup_add_strm=n.asm.sqlite3changegroup_add_strm).apply(null,arguments)},n._sqlite3changegroup_output_strm=function(){return(n._sqlite3changegroup_output_strm=n.asm.sqlite3changegroup_output_strm).apply(null,arguments)},n._sqlite3changegroup_delete=function(){return(n._sqlite3changegroup_delete=n.asm.sqlite3changegroup_delete).apply(null,arguments)},n._sqlite3changeset_concat=function(){return(n._sqlite3changeset_concat=n.asm.sqlite3changeset_concat).apply(null,arguments)},n._sqlite3changeset_concat_strm=function(){return(n._sqlite3changeset_concat_strm=n.asm.sqlite3changeset_concat_strm).apply(null,arguments)},n._sqlite3session_config=function(){return(n._sqlite3session_config=n.asm.sqlite3session_config).apply(null,arguments)},n._sqlite3_sourceid=function(){return(n._sqlite3_sourceid=n.asm.sqlite3_sourceid).apply(null,arguments)},n._sqlite3_wasm_pstack_ptr=function(){return(n._sqlite3_wasm_pstack_ptr=n.asm.sqlite3_wasm_pstack_ptr).apply(null,arguments)},n._sqlite3_wasm_pstack_restore=function(){return(n._sqlite3_wasm_pstack_restore=n.asm.sqlite3_wasm_pstack_restore).apply(null,arguments)},n._sqlite3_wasm_pstack_alloc=function(){return(n._sqlite3_wasm_pstack_alloc=n.asm.sqlite3_wasm_pstack_alloc).apply(null,arguments)},n._sqlite3_wasm_pstack_remaining=function(){return(n._sqlite3_wasm_pstack_remaining=n.asm.sqlite3_wasm_pstack_remaining).apply(null,arguments)},n._sqlite3_wasm_pstack_quota=function(){return(n._sqlite3_wasm_pstack_quota=n.asm.sqlite3_wasm_pstack_quota).apply(null,arguments)},n._sqlite3_wasm_db_error=function(){return(n._sqlite3_wasm_db_error=n.asm.sqlite3_wasm_db_error).apply(null,arguments)},n._sqlite3_wasm_test_struct=function(){return(n._sqlite3_wasm_test_struct=n.asm.sqlite3_wasm_test_struct).apply(null,arguments)},n._sqlite3_wasm_enum_json=function(){return(n._sqlite3_wasm_enum_json=n.asm.sqlite3_wasm_enum_json).apply(null,arguments)},n._sqlite3_wasm_vfs_unlink=function(){return(n._sqlite3_wasm_vfs_unlink=n.asm.sqlite3_wasm_vfs_unlink).apply(null,arguments)},n._sqlite3_wasm_db_vfs=function(){return(n._sqlite3_wasm_db_vfs=n.asm.sqlite3_wasm_db_vfs).apply(null,arguments)},n._sqlite3_wasm_db_reset=function(){return(n._sqlite3_wasm_db_reset=n.asm.sqlite3_wasm_db_reset).apply(null,arguments)},n._sqlite3_wasm_db_export_chunked=function(){return(n._sqlite3_wasm_db_export_chunked=n.asm.sqlite3_wasm_db_export_chunked).apply(null,arguments)},n._sqlite3_wasm_db_serialize=function(){return(n._sqlite3_wasm_db_serialize=n.asm.sqlite3_wasm_db_serialize).apply(null,arguments)},n._sqlite3_wasm_vfs_create_file=function(){return(n._sqlite3_wasm_vfs_create_file=n.asm.sqlite3_wasm_vfs_create_file).apply(null,arguments)},n._sqlite3_wasm_posix_create_file=function(){return(n._sqlite3_wasm_posix_create_file=n.asm.sqlite3_wasm_posix_create_file).apply(null,arguments)},n._sqlite3_wasm_kvvfsMakeKeyOnPstack=function(){return(n._sqlite3_wasm_kvvfsMakeKeyOnPstack=n.asm.sqlite3_wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},n._sqlite3_wasm_kvvfs_methods=function(){return(n._sqlite3_wasm_kvvfs_methods=n.asm.sqlite3_wasm_kvvfs_methods).apply(null,arguments)},n._sqlite3_wasm_vtab_config=function(){return(n._sqlite3_wasm_vtab_config=n.asm.sqlite3_wasm_vtab_config).apply(null,arguments)},n._sqlite3_wasm_db_config_ip=function(){return(n._sqlite3_wasm_db_config_ip=n.asm.sqlite3_wasm_db_config_ip).apply(null,arguments)},n._sqlite3_wasm_db_config_pii=function(){return(n._sqlite3_wasm_db_config_pii=n.asm.sqlite3_wasm_db_config_pii).apply(null,arguments)},n._sqlite3_wasm_db_config_s=function(){return(n._sqlite3_wasm_db_config_s=n.asm.sqlite3_wasm_db_config_s).apply(null,arguments)},n._sqlite3_wasm_config_i=function(){return(n._sqlite3_wasm_config_i=n.asm.sqlite3_wasm_config_i).apply(null,arguments)},n._sqlite3_wasm_config_ii=function(){return(n._sqlite3_wasm_config_ii=n.asm.sqlite3_wasm_config_ii).apply(null,arguments)},n._sqlite3_wasm_config_j=function(){return(n._sqlite3_wasm_config_j=n.asm.sqlite3_wasm_config_j).apply(null,arguments)},n._sqlite3_wasm_init_wasmfs=function(){return(n._sqlite3_wasm_init_wasmfs=n.asm.sqlite3_wasm_init_wasmfs).apply(null,arguments)},n._sqlite3_wasm_test_intptr=function(){return(n._sqlite3_wasm_test_intptr=n.asm.sqlite3_wasm_test_intptr).apply(null,arguments)},n._sqlite3_wasm_test_voidptr=function(){return(n._sqlite3_wasm_test_voidptr=n.asm.sqlite3_wasm_test_voidptr).apply(null,arguments)},n._sqlite3_wasm_test_int64_max=function(){return(n._sqlite3_wasm_test_int64_max=n.asm.sqlite3_wasm_test_int64_max).apply(null,arguments)},n._sqlite3_wasm_test_int64_min=function(){return(n._sqlite3_wasm_test_int64_min=n.asm.sqlite3_wasm_test_int64_min).apply(null,arguments)},n._sqlite3_wasm_test_int64_times2=function(){return(n._sqlite3_wasm_test_int64_times2=n.asm.sqlite3_wasm_test_int64_times2).apply(null,arguments)},n._sqlite3_wasm_test_int64_minmax=function(){return(n._sqlite3_wasm_test_int64_minmax=n.asm.sqlite3_wasm_test_int64_minmax).apply(null,arguments)},n._sqlite3_wasm_test_int64ptr=function(){return(n._sqlite3_wasm_test_int64ptr=n.asm.sqlite3_wasm_test_int64ptr).apply(null,arguments)},n._sqlite3_wasm_test_stack_overflow=function(){return(n._sqlite3_wasm_test_stack_overflow=n.asm.sqlite3_wasm_test_stack_overflow).apply(null,arguments)},n._sqlite3_wasm_test_str_hello=function(){return(n._sqlite3_wasm_test_str_hello=n.asm.sqlite3_wasm_test_str_hello).apply(null,arguments)};var Nl=n._malloc=function(){return(Nl=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n._realloc=function(){return(n._realloc=n.asm.realloc).apply(null,arguments)};var vl=n._emscripten_builtin_memalign=function(){return(vl=n._emscripten_builtin_memalign=n.asm.emscripten_builtin_memalign).apply(null,arguments)};n.stackSave=function(){return(n.stackSave=n.asm.stackSave).apply(null,arguments)},n.stackRestore=function(){return(n.stackRestore=n.asm.stackRestore).apply(null,arguments)},n.stackAlloc=function(){return(n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)},n.wasmMemory=rn;var zs;ki=function o(){zs||xl(),zs||(ki=o)};function xl(o){if(rr>0||($u(),rr>0))return;function i(){zs||(zs=!0,n.calledRun=!0,!Mr&&(Hu(),x(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),Ju()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),i()},1)):i()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return xl(),n.postRun||(n.postRun=[]),n.postRun.push(function(o){if(globalThis.sqlite3ApiBootstrap=function i(l=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return console.warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const a=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:(()=>typeof o<"u"?!!o.HEAPU64:!!globalThis.BigInt64Array)(),debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},l||{});Object.assign(a,{allocExportName:a.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:a.useStdAlloc?"free":"sqlite3_free",reallocExportName:a.useStdAlloc?"realloc":"sqlite3_realloc"},a),["exports","memory","wasmfsOpfsDir"].forEach(f=>{typeof a[f]=="function"&&(a[f]=a[f]())});const c=Object.create(null),d=Object.create(null),b=f=>c.sqlite3_js_rc_str&&c.sqlite3_js_rc_str(f)||"Unknown result code #"+f,k=f=>typeof f=="number"&&f===(f|0);class L extends Error{constructor(...p){let _;if(p.length)if(k(p[0]))if(_=p[0],p.length===1)super(b(p[0]));else{const F=b(_);typeof p[1]=="object"?super(F,p[1]):(p[0]=F+":",super(p.join(" ")))}else p.length===2&&typeof p[1]=="object"?super(...p):super(p.join(" "));this.resultCode=_||c.SQLITE_ERROR,this.name="SQLite3Error"}}L.toss=(...f)=>{throw new L(...f)};const X=L.toss;a.wasmfsOpfsDir&&!/^\/[^/]+$/.test(a.wasmfsOpfsDir)&&X("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const ee=f=>typeof f!="bigint"&&f===(f|0)&&f<=2147483647&&f>=-2147483648,oe=function f(p){return f._max||(f._max=BigInt("0x7fffffffffffffff"),f._min=~f._max),p>=f._min&&p<=f._max},T=f=>f>=-0x7fffffffn-1n&&f<=0x7fffffffn,g=function f(p){return f._min||(f._min=Number.MIN_SAFE_INTEGER,f._max=Number.MAX_SAFE_INTEGER),p>=f._min&&p<=f._max},w=f=>f&&f.constructor&&ee(f.constructor.BYTES_PER_ELEMENT)?f:!1,S=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,A=f=>f.buffer instanceof S,q=(f,p,_)=>A(f)?f.slice(p,_):f.subarray(p,_),B=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),J=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),H=f=>B(f)||X("Value is not of a supported TypedArray type."),U=new TextDecoder("utf-8"),ce=function(f,p,_){return U.decode(q(f,p,_))},m=function(f){return J(f)?ce(f instanceof ArrayBuffer?new Uint8Array(f):f):Array.isArray(f)?f.join(""):(d.isPtr(f)&&(f=d.cstrToJs(f)),f)};class N extends Error{constructor(...p){p.length===2&&typeof p[1]=="object"?super(...p):p.length?super(p.join(" ")):super("Allocation failed."),this.resultCode=c.SQLITE_NOMEM,this.name="WasmAllocError"}}N.toss=(...f)=>{throw new N(...f)},Object.assign(c,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(f,p,_,F,G,re,ae,ie,ue)=>{},sqlite3_create_function:(f,p,_,F,G,re,ae,ie)=>{},sqlite3_create_window_function:(f,p,_,F,G,re,ae,ie,ue,de)=>{},sqlite3_prepare_v3:(f,p,_,F,G,re)=>{},sqlite3_prepare_v2:(f,p,_,F,G)=>{},sqlite3_exec:(f,p,_,F,G)=>{},sqlite3_randomness:(f,p)=>{}});const O={affirmBindableTypedArray:H,flexibleString:m,bigIntFits32:T,bigIntFits64:oe,bigIntFitsDouble:g,isBindableTypedArray:B,isInt32:ee,isSQLableTypedArray:J,isTypedArray:w,typedArrayToString:ce,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:A,toss:function(...f){throw new Error(f.join(" "))},toss3:X,typedArrayPart:q};Object.assign(d,{ptrSizeof:a.wasmPtrSizeof||4,ptrIR:a.wasmPtrIR||"i32",bigIntEnabled:!!a.bigIntEnabled,exports:a.exports||X("Missing API config.exports (WASM module exports)."),memory:a.memory||a.exports.memory||X("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),d.allocFromTypedArray=function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f)),H(f);const p=d.alloc(f.byteLength||1);return d.heapForSize(f.constructor).set(f.byteLength?f:[0],p),p};{const f=a.allocExportName,p=a.deallocExportName,_=a.reallocExportName;for(const F of[f,p,_])d.exports[F]instanceof Function||X("Missing required exports[",F,"] function.");d.alloc=function F(G){return F.impl(G)||N.toss("Failed to allocate",G," bytes.")},d.alloc.impl=d.exports[f],d.realloc=function F(G,re){const ae=F.impl(G,re);return re?ae||N.toss("Failed to reallocate",re," bytes."):0},d.realloc.impl=d.exports[_],d.dealloc=d.exports[p]}d.compileOptionUsed=function f(p){if(arguments.length){if(Array.isArray(p)){const _={};return p.forEach(F=>{_[F]=c.sqlite3_compileoption_used(F)}),_}else if(typeof p=="object")return Object.keys(p).forEach(_=>{p[_]=c.sqlite3_compileoption_used(_)}),p}else{if(f._result)return f._result;f._opt||(f._rx=/^([^=]+)=(.+)/,f._rxInt=/^-?\d+$/,f._opt=function(ae,ie){const ue=f._rx.exec(ae);ie[0]=ue?ue[1]:ae,ie[1]=ue?f._rxInt.test(ue[2])?+ue[2]:ue[2]:!0});const _={},F=[0,0];let G=0,re;for(;re=c.sqlite3_compileoption_get(G++);)f._opt(re,F),_[F[0]]=F[1];return f._result=_}return typeof p=="string"?!!c.sqlite3_compileoption_used(p):!1},d.pstack=Object.assign(Object.create(null),{restore:d.exports.sqlite3_wasm_pstack_restore,alloc:function(f){return typeof f=="string"&&!(f=d.sizeofIR(f))&&N.toss("Invalid value for pstack.alloc(",arguments[0],")"),d.exports.sqlite3_wasm_pstack_alloc(f)||N.toss("Could not allocate",f,"bytes from the pstack.")},allocChunks:function(f,p){typeof p=="string"&&!(p=d.sizeofIR(p))&&N.toss("Invalid size value for allocChunks(",arguments[1],")");const _=d.pstack.alloc(f*p),F=[];let G=0,re=0;for(;G<f;++G,re+=p)F.push(_+re);return F},allocPtr:(f=1,p=!0)=>f===1?d.pstack.alloc(p?8:d.ptrSizeof):d.pstack.allocChunks(f,p?8:d.ptrSizeof)}),Object.defineProperties(d.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_remaining}}),c.sqlite3_randomness=(...f)=>{if(f.length===1&&O.isTypedArray(f[0])&&f[0].BYTES_PER_ELEMENT===1){const p=f[0];if(p.byteLength===0)return d.exports.sqlite3_randomness(0,0),p;const _=d.pstack.pointer;try{let F=p.byteLength,G=0;const re=d.exports.sqlite3_randomness,ae=d.heap8u(),ie=F<512?F:512,ue=d.pstack.alloc(ie);do{const de=F>ie?ie:F;re(de,ue),p.set(q(ae,ue,ue+de),G),F-=de,G+=de}while(F>0)}catch(F){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",F)}finally{d.pstack.restore(_)}return p}d.exports.sqlite3_randomness(...f)};let z;if(c.sqlite3_wasmfs_opfs_dir=function(){if(z!==void 0)return z;const f=a.wasmfsOpfsDir;if(!f||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return z="";try{return f&&d.xCallWrapped("sqlite3_wasm_init_wasmfs","i32",["string"],f)===0?z=f:z=""}catch{return z=""}},c.sqlite3_wasmfs_filename_is_persistent=function(f){const p=c.sqlite3_wasmfs_opfs_dir();return p&&f?f.startsWith(p+"/"):!1},c.sqlite3_js_db_uses_vfs=function(f,p,_=0){try{const F=c.sqlite3_vfs_find(p);return F?f?F===c.sqlite3_js_db_vfs(f,_)?F:!1:F===c.sqlite3_vfs_find(0)?F:!1:!1}catch{return!1}},c.sqlite3_js_vfs_list=function(){const f=[];let p=c.sqlite3_vfs_find(0);for(;p;){const _=new c.sqlite3_vfs(p);f.push(d.cstrToJs(_.$zName)),p=_.$pNext,_.dispose()}return f},c.sqlite3_js_db_export=function(f,p=0){f=d.xWrap.testConvertArg("sqlite3*",f),f||X("Invalid sqlite3* argument."),d.bigIntEnabled||X("BigInt64 support is not enabled.");const _=d.scopedAllocPush();let F;try{const G=d.scopedAlloc(8+d.ptrSizeof),re=G+8,ae=p?d.isPtr(p)?p:d.scopedAllocCString(""+p):0;let ie=d.exports.sqlite3_wasm_db_serialize(f,ae,re,G,0);ie&&X("Database serialization failed with code",v.capi.sqlite3_js_rc_str(ie)),F=d.peekPtr(re);const ue=d.peek(G,"i64");return ie=ue?d.heap8u().slice(F,F+Number(ue)):new Uint8Array,ie}finally{F&&d.exports.sqlite3_free(F),d.scopedAllocPop(_)}},c.sqlite3_js_db_vfs=(f,p=0)=>d.sqlite3_wasm_db_vfs(f,p),c.sqlite3_js_aggregate_context=(f,p)=>c.sqlite3_aggregate_context(f,p)||(p?N.toss("Cannot allocate",p,"bytes for sqlite3_aggregate_context()"):0),c.sqlite3_js_posix_create_file=function(f,p,_){let F;p&&d.isPtr(p)?F=p:p instanceof ArrayBuffer||p instanceof Uint8Array?(F=d.allocFromTypedArray(p),(arguments.length<3||!O.isInt32(_)||_<0)&&(_=p.byteLength)):L.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!O.isInt32(_)||_<0)&&L.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const G=d.sqlite3_wasm_posix_create_file(f,F,_);G&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(G))}finally{d.dealloc(F)}},c.sqlite3_js_vfs_create_file=function(f,p,_,F){a.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let G;_?(d.isPtr(_)?G=_:_ instanceof ArrayBuffer&&(_=new Uint8Array(_)),_ instanceof Uint8Array?(G=d.allocFromTypedArray(_),(arguments.length<4||!O.isInt32(F)||F<0)&&(F=_.byteLength)):L.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):G=0,(!O.isInt32(F)||F<0)&&(d.dealloc(G),L.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const re=d.sqlite3_wasm_vfs_create_file(f,p,G,F);re&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(re))}finally{d.dealloc(G)}},O.isUIThread()){const f=function(p){const _=Object.create(null);return _.prefix="kvvfs-"+p,_.stores=[],(p==="session"||p==="")&&_.stores.push(globalThis.sessionStorage),(p==="local"||p==="")&&_.stores.push(globalThis.localStorage),_};c.sqlite3_js_kvvfs_clear=function(p=""){let _=0;const F=f(p);return F.stores.forEach(G=>{const re=[];let ae;for(ae=0;ae<G.length;++ae){const ie=G.key(ae);ie.startsWith(F.prefix)&&re.push(ie)}re.forEach(ie=>G.removeItem(ie)),_+=re.length}),_},c.sqlite3_js_kvvfs_size=function(p=""){let _=0;const F=f(p);return F.stores.forEach(G=>{let re;for(re=0;re<G.length;++re){const ae=G.key(re);ae.startsWith(F.prefix)&&(_+=ae.length,_+=G.getItem(ae).length)}}),_*2}}c.sqlite3_db_config=(function(f,p,..._){switch(this.s||(this.s=d.xWrap("sqlite3_wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=d.xWrap("sqlite3_wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=d.xWrap("sqlite3_wasm_db_config_ip","int",["sqlite3*","int","int","*"])),p){case c.SQLITE_DBCONFIG_ENABLE_FKEY:case c.SQLITE_DBCONFIG_ENABLE_TRIGGER:case c.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case c.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case c.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case c.SQLITE_DBCONFIG_ENABLE_QPSG:case c.SQLITE_DBCONFIG_TRIGGER_EQP:case c.SQLITE_DBCONFIG_RESET_DATABASE:case c.SQLITE_DBCONFIG_DEFENSIVE:case c.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case c.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case c.SQLITE_DBCONFIG_DQS_DML:case c.SQLITE_DBCONFIG_DQS_DDL:case c.SQLITE_DBCONFIG_ENABLE_VIEW:case c.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case c.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case c.SQLITE_DBCONFIG_STMT_SCANSTATUS:case c.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(f,p,_[0],_[1]||0);case c.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(f,p,_[0],_[1],_[2]);case c.SQLITE_DBCONFIG_MAINDBNAME:return this.s(f,p,_[0]);default:return c.SQLITE_MISUSE}}).bind(Object.create(null)),c.sqlite3_value_to_js=function(f,p=!0){let _;const F=c.sqlite3_value_type(f);switch(F){case c.SQLITE_INTEGER:d.bigIntEnabled?(_=c.sqlite3_value_int64(f),O.bigIntFitsDouble(_)&&(_=Number(_))):_=c.sqlite3_value_double(f);break;case c.SQLITE_FLOAT:_=c.sqlite3_value_double(f);break;case c.SQLITE_TEXT:_=c.sqlite3_value_text(f);break;case c.SQLITE_BLOB:{const G=c.sqlite3_value_bytes(f),re=c.sqlite3_value_blob(f);G&&!re&&v.WasmAllocError.toss("Cannot allocate memory for blob argument of",G,"byte(s)"),_=G?d.heap8u().slice(re,re+Number(G)):null;break}case c.SQLITE_NULL:_=null;break;default:p&&X(c.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",F),_=void 0}return _},c.sqlite3_values_to_js=function(f,p,_=!0){let F;const G=[];for(F=0;F<f;++F)G.push(c.sqlite3_value_to_js(d.peekPtr(p+d.ptrSizeof*F),_));return G},c.sqlite3_result_error_js=function(f,p){p instanceof N?c.sqlite3_result_error_nomem(f):c.sqlite3_result_error(f,""+p,-1)},c.sqlite3_result_js=function(f,p){if(p instanceof Error){c.sqlite3_result_error_js(f,p);return}try{switch(typeof p){case"undefined":break;case"boolean":c.sqlite3_result_int(f,p?1:0);break;case"bigint":O.bigIntFits32(p)?c.sqlite3_result_int(f,Number(p)):O.bigIntFitsDouble(p)?c.sqlite3_result_double(f,Number(p)):d.bigIntEnabled?O.bigIntFits64(p)?c.sqlite3_result_int64(f,p):X("BigInt value",p.toString(),"is too BigInt for int64."):X("BigInt value",p.toString(),"is too BigInt.");break;case"number":{let _;O.isInt32(p)?_=c.sqlite3_result_int:d.bigIntEnabled&&Number.isInteger(p)&&O.bigIntFits64(BigInt(p))?_=c.sqlite3_result_int64:_=c.sqlite3_result_double,_(f,p);break}case"string":{const[_,F]=d.allocCString(p,!0);c.sqlite3_result_text(f,_,F,c.SQLITE_WASM_DEALLOC);break}case"object":if(p===null){c.sqlite3_result_null(f);break}else if(O.isBindableTypedArray(p)){const _=d.allocFromTypedArray(p);c.sqlite3_result_blob(f,_,p.byteLength,c.SQLITE_WASM_DEALLOC);break}default:X("Don't not how to handle this UDF result value:",typeof p,p)}}catch(_){c.sqlite3_result_error_js(f,_)}},c.sqlite3_column_js=function(f,p,_=!0){const F=c.sqlite3_column_value(f,p);return F===0?void 0:c.sqlite3_value_to_js(F,_)};const y=(function(f,p,_){_=c[_],this.ptr?d.pokePtr(this.ptr,0):this.ptr=d.allocPtr();const F=_(f,p,this.ptr);if(F)return L.toss(F,arguments[2]+"() failed with code "+F);const G=d.peekPtr(this.ptr);return G?c.sqlite3_value_to_js(G,!0):void 0}).bind(Object.create(null));c.sqlite3_preupdate_new_js=(f,p)=>y(f,p,"sqlite3_preupdate_new"),c.sqlite3_preupdate_old_js=(f,p)=>y(f,p,"sqlite3_preupdate_old"),c.sqlite3changeset_new_js=(f,p)=>y(f,p,"sqlite3changeset_new"),c.sqlite3changeset_old_js=(f,p)=>y(f,p,"sqlite3changeset_old");const v={WasmAllocError:N,SQLite3Error:L,capi:c,util:O,wasm:d,config:a,version:Object.create(null),client:void 0,asyncPostInit:async function f(){if(f.isReady instanceof Promise)return f.isReady;let p=i.initializersAsync;delete i.initializersAsync;const _=async()=>(v.__isUnderTest||(delete v.util,delete v.StructBinder),v),F=re=>{throw a.error("an async sqlite3 initializer failed:",re),re};if(!p||!p.length)return f.isReady=_().catch(F);p=p.map(re=>re instanceof Function?async ae=>re(v):re),p.push(_);let G=Promise.resolve(v);for(;p.length;)G=G.then(p.shift());return f.isReady=G.catch(F)},scriptInfo:void 0};try{i.initializers.forEach(f=>{f(v)})}catch(f){throw console.error("sqlite3 bootstrap initializer threw:",f),f}return delete i.initializers,i.sqlite3=v,v},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(i){i.bigIntEnabled===void 0&&(i.bigIntEnabled=!!globalThis.BigInt64Array);const l=(...m)=>{throw new Error(m.join(" "))};i.exports||Object.defineProperty(i,"exports",{enumerable:!0,configurable:!0,get:()=>i.instance&&i.instance.exports});const a=i.pointerIR||"i32",c=i.ptrSizeof=a==="i32"?4:a==="i64"?8:l("Unhandled ptrSizeof:",a),d=Object.create(null);d.heapSize=0,d.memory=null,d.freeFuncIndexes=[],d.scopedAlloc=[],d.utf8Decoder=new TextDecoder,d.utf8Encoder=new TextEncoder("utf-8"),i.sizeofIR=m=>{switch(m){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return c;default:return(""+m).endsWith("*")?c:void 0}};const b=function(){if(!d.memory)d.memory=i.memory instanceof WebAssembly.Memory?i.memory:i.exports.memory;else if(d.heapSize===d.memory.buffer.byteLength)return d;const m=d.memory.buffer;return d.HEAP8=new Int8Array(m),d.HEAP8U=new Uint8Array(m),d.HEAP16=new Int16Array(m),d.HEAP16U=new Uint16Array(m),d.HEAP32=new Int32Array(m),d.HEAP32U=new Uint32Array(m),i.bigIntEnabled&&(d.HEAP64=new BigInt64Array(m),d.HEAP64U=new BigUint64Array(m)),d.HEAP32F=new Float32Array(m),d.HEAP64F=new Float64Array(m),d.heapSize=m.byteLength,d};i.heap8=()=>b().HEAP8,i.heap8u=()=>b().HEAP8U,i.heap16=()=>b().HEAP16,i.heap16u=()=>b().HEAP16U,i.heap32=()=>b().HEAP32,i.heap32u=()=>b().HEAP32U,i.heapForSize=function(m,N=!0){const O=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:b();switch(m){case Int8Array:return O.HEAP8;case Uint8Array:return O.HEAP8U;case Int16Array:return O.HEAP16;case Uint16Array:return O.HEAP16U;case Int32Array:return O.HEAP32;case Uint32Array:return O.HEAP32U;case 8:return N?O.HEAP8U:O.HEAP8;case 16:return N?O.HEAP16U:O.HEAP16;case 32:return N?O.HEAP32U:O.HEAP32;case 64:if(O.HEAP64)return N?O.HEAP64U:O.HEAP64;break;default:if(i.bigIntEnabled){if(m===globalThis.BigUint64Array)return O.HEAP64U;if(m===globalThis.BigInt64Array)return O.HEAP64;break}}l("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},i.functionTable=function(){return i.exports.__indirect_function_table},i.functionEntry=function(m){const N=i.functionTable();return m<N.length?N.get(m):void 0},i.jsFuncToWasm=function m(N,O){if(m._||(m._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(v,f,p){p<128?v[f](p):v[f](p%128|128,p>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(v){const f=m._.rxJSig.exec(v);return f?f[2]:v.substr(1)},letterType:v=>m._.sigTypes[v]||l("Invalid signature letter:",v),pushSigType:(v,f)=>v.push(m._.typeCodes[m._.letterType(f)])}),typeof N=="string"){const v=O;O=N,N=v}const z=m._.sigParams(O),y=[1,96];m._.uleb128Encode(y,"push",z.length);for(const v of z)m._.pushSigType(y,v);return O[0]==="v"?y.push(0):(y.push(1),m._.pushSigType(y,O[0])),m._.uleb128Encode(y,"unshift",y.length),y.unshift(0,97,115,109,1,0,0,0,1),y.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(y)),{e:{f:N}}).exports.f};const k=function(N,O,z){if(z&&!d.scopedAlloc.length&&l("No scopedAllocPush() scope is active."),typeof N=="string"){const p=O;O=N,N=p}(typeof O!="string"||!(N instanceof Function))&&l("Invalid arguments: expecting (function,signature) or (signature,function).");const y=i.functionTable(),v=y.length;let f;for(;d.freeFuncIndexes.length&&(f=d.freeFuncIndexes.pop(),y.get(f));){f=null;continue}f||(f=v,y.grow(1));try{return y.set(f,N),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(f),f}catch(p){if(!(p instanceof TypeError))throw f===v&&d.freeFuncIndexes.push(v),p}try{const p=i.jsFuncToWasm(N,O);y.set(f,p),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(f)}catch(p){throw f===v&&d.freeFuncIndexes.push(v),p}return f};i.installFunction=(m,N)=>k(m,N,!1),i.scopedInstallFunction=(m,N)=>k(m,N,!0),i.uninstallFunction=function(m){if(!m&&m!==0)return;const N=d.freeFuncIndexes,O=i.functionTable();N.push(m);const z=O.get(m);return O.set(m,null),z},i.peek=function(N,O="i8"){O.endsWith("*")&&(O=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:b(),y=Array.isArray(N)?[]:void 0;let v;do{switch(y&&(N=arguments[0].shift()),O){case"i1":case"i8":v=z.HEAP8[N>>0];break;case"i16":v=z.HEAP16[N>>1];break;case"i32":v=z.HEAP32[N>>2];break;case"float":case"f32":v=z.HEAP32F[N>>2];break;case"double":case"f64":v=Number(z.HEAP64F[N>>3]);break;case"i64":if(i.bigIntEnabled){v=BigInt(z.HEAP64[N>>3]);break}default:l("Invalid type for peek():",O)}y&&y.push(v)}while(y&&arguments[0].length);return y||v},i.poke=function(m,N,O="i8"){O.endsWith("*")&&(O=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:b();for(const y of Array.isArray(m)?m:[m])switch(O){case"i1":case"i8":z.HEAP8[y>>0]=N;continue;case"i16":z.HEAP16[y>>1]=N;continue;case"i32":z.HEAP32[y>>2]=N;continue;case"float":case"f32":z.HEAP32F[y>>2]=N;continue;case"double":case"f64":z.HEAP64F[y>>3]=N;continue;case"i64":if(z.HEAP64){z.HEAP64[y>>3]=BigInt(N);continue}default:l("Invalid type for poke(): "+O)}return this},i.peekPtr=(...m)=>i.peek(m.length===1?m[0]:m,a),i.pokePtr=(m,N=0)=>i.poke(m,N,a),i.peek8=(...m)=>i.peek(m.length===1?m[0]:m,"i8"),i.poke8=(m,N)=>i.poke(m,N,"i8"),i.peek16=(...m)=>i.peek(m.length===1?m[0]:m,"i16"),i.poke16=(m,N)=>i.poke(m,N,"i16"),i.peek32=(...m)=>i.peek(m.length===1?m[0]:m,"i32"),i.poke32=(m,N)=>i.poke(m,N,"i32"),i.peek64=(...m)=>i.peek(m.length===1?m[0]:m,"i64"),i.poke64=(m,N)=>i.poke(m,N,"i64"),i.peek32f=(...m)=>i.peek(m.length===1?m[0]:m,"f32"),i.poke32f=(m,N)=>i.poke(m,N,"f32"),i.peek64f=(...m)=>i.peek(m.length===1?m[0]:m,"f64"),i.poke64f=(m,N)=>i.poke(m,N,"f64"),i.getMemValue=i.peek,i.getPtrValue=i.peekPtr,i.setMemValue=i.poke,i.setPtrValue=i.pokePtr,i.isPtr32=m=>typeof m=="number"&&m===(m|0)&&m>=0,i.isPtr=i.isPtr32,i.cstrlen=function(m){if(!m||!i.isPtr(m))return null;const N=b().HEAP8U;let O=m;for(;N[O]!==0;++O);return O-m};const L=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,X=function(m,N,O){return d.utf8Decoder.decode(m.buffer instanceof L?m.slice(N,O):m.subarray(N,O))};i.cstrToJs=function(m){const N=i.cstrlen(m);return N?X(b().HEAP8U,m,m+N):N===null?N:""},i.jstrlen=function(m){if(typeof m!="string")return null;const N=m.length;let O=0;for(let z=0;z<N;++z){let y=m.charCodeAt(z);y>=55296&&y<=57343&&(y=65536+((y&1023)<<10)|m.charCodeAt(++z)&1023),y<=127?++O:y<=2047?O+=2:y<=65535?O+=3:O+=4}return O},i.jstrcpy=function(m,N,O=0,z=-1,y=!0){if((!N||!(N instanceof Int8Array)&&!(N instanceof Uint8Array))&&l("jstrcpy() target must be an Int8Array or Uint8Array."),z<0&&(z=N.length-O),!(z>0)||!(O>=0))return 0;let v=0,f=m.length;const p=O,_=O+z-(y?1:0);for(;v<f&&O<_;++v){let F=m.charCodeAt(v);if(F>=55296&&F<=57343&&(F=65536+((F&1023)<<10)|m.charCodeAt(++v)&1023),F<=127){if(O>=_)break;N[O++]=F}else if(F<=2047){if(O+1>=_)break;N[O++]=192|F>>6,N[O++]=128|F&63}else if(F<=65535){if(O+2>=_)break;N[O++]=224|F>>12,N[O++]=128|F>>6&63,N[O++]=128|F&63}else{if(O+3>=_)break;N[O++]=240|F>>18,N[O++]=128|F>>12&63,N[O++]=128|F>>6&63,N[O++]=128|F&63}}return y&&(N[O++]=0),O-p},i.cstrncpy=function(m,N,O){if((!m||!N)&&l("cstrncpy() does not accept NULL strings."),O<0)O=i.cstrlen(strPtr)+1;else if(!(O>0))return 0;const z=i.heap8u();let y=0,v;for(;y<O&&(v=z[N+y]);++y)z[m+y]=v;return y<O&&(z[m+y++]=0),y},i.jstrToUintArray=(m,N=!1)=>d.utf8Encoder.encode(N?m+"\0":m);const ee=(m,N)=>{(!(m.alloc instanceof Function)||!(m.dealloc instanceof Function))&&l("Object is missing alloc() and/or dealloc() function(s)","required by",N+"().")},oe=function(m,N,O,z){if(ee(i,z),typeof m!="string")return null;{const y=d.utf8Encoder.encode(m),v=O(y.length+1),f=b().HEAP8U;return f.set(y,v),f[v+y.length]=0,N?[v,y.length]:v}};i.allocCString=(m,N=!1)=>oe(m,N,i.alloc,"allocCString()"),i.scopedAllocPush=function(){ee(i,"scopedAllocPush");const m=[];return d.scopedAlloc.push(m),m},i.scopedAllocPop=function(m){ee(i,"scopedAllocPop");const N=arguments.length?d.scopedAlloc.indexOf(m):d.scopedAlloc.length-1;N<0&&l("Invalid state object for scopedAllocPop()."),arguments.length===0&&(m=d.scopedAlloc[N]),d.scopedAlloc.splice(N,1);for(let O;O=m.pop();)i.functionEntry(O)?i.uninstallFunction(O):i.dealloc(O)},i.scopedAlloc=function(m){d.scopedAlloc.length||l("No scopedAllocPush() scope is active.");const N=i.alloc(m);return d.scopedAlloc[d.scopedAlloc.length-1].push(N),N},Object.defineProperty(i.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>d.scopedAlloc.length,set:()=>l("The 'active' property is read-only.")}),i.scopedAllocCString=(m,N=!1)=>oe(m,N,i.scopedAlloc,"scopedAllocCString()");const T=function(m,N){const O=i[m?"scopedAlloc":"alloc"]((N.length+1)*i.ptrSizeof);let z=0;return N.forEach(y=>{i.pokePtr(O+i.ptrSizeof*z++,i[m?"scopedAllocCString":"allocCString"](""+y))}),i.pokePtr(O+i.ptrSizeof*z,0),O};i.scopedAllocMainArgv=m=>T(!0,m),i.allocMainArgv=m=>T(!1,m),i.cArgvToJs=(m,N)=>{const O=[];for(let z=0;z<m;++z){const y=i.peekPtr(N+i.ptrSizeof*z);O.push(y?i.cstrToJs(y):null)}return O},i.scopedAllocCall=function(m){i.scopedAllocPush();try{return m()}finally{i.scopedAllocPop()}};const g=function(m,N,O){ee(i,O);const z=N?"i64":a;let y=i[O](m*(N?8:c));if(i.poke(y,0,z),m===1)return y;const v=[y];for(let f=1;f<m;++f)y+=N?8:c,v[f]=y,i.poke(y,0,z);return v};i.allocPtr=(m=1,N=!0)=>g(m,N,"alloc"),i.scopedAllocPtr=(m=1,N=!0)=>g(m,N,"scopedAlloc"),i.xGet=function(m){return i.exports[m]||l("Cannot find exported symbol:",m)};const w=(m,N)=>l(m+"() requires",N,"argument(s).");i.xCall=function(m,...N){const O=i.xGet(m);return O instanceof Function||l("Exported symbol",m,"is not a function."),O.length!==N.length&&w(m,O.length),arguments.length===2&&Array.isArray(arguments[1])?O.apply(null,arguments[1]):O.apply(null,N)},d.xWrap=Object.create(null),d.xWrap.convert=Object.create(null),d.xWrap.convert.arg=new Map,d.xWrap.convert.result=new Map;const S=d.xWrap.convert.arg,A=d.xWrap.convert.result;i.bigIntEnabled&&S.set("i64",m=>BigInt(m));const q=a==="i32"?m=>m|0:m=>BigInt(m)|BigInt(0);S.set("i32",q).set("i16",m=>(m|0)&65535).set("i8",m=>(m|0)&255).set("f32",m=>Number(m).valueOf()).set("float",S.get("f32")).set("f64",S.get("f32")).set("double",S.get("f64")).set("int",S.get("i32")).set("null",m=>m).set(null,S.get("null")).set("**",q).set("*",q),A.set("*",q).set("pointer",q).set("number",m=>Number(m)).set("void",m=>{}).set("null",m=>m).set(null,A.get("null"));{const m=["i8","i16","i32","int","f32","float","f64","double"];i.bigIntEnabled&&m.push("i64");const N=S.get(a);for(const O of m)S.set(O+"*",N),A.set(O+"*",N),A.set(O,S.get(O)||l("Missing arg converter:",O))}const B=function(m){return typeof m=="string"?i.scopedAllocCString(m):m?q(m):null};S.set("string",B).set("utf8",B).set("pointer",B),A.set("string",m=>i.cstrToJs(m)).set("utf8",A.get("string")).set("string:dealloc",m=>{try{return m?i.cstrToJs(m):null}finally{i.dealloc(m)}}).set("utf8:dealloc",A.get("string:dealloc")).set("json",m=>JSON.parse(i.cstrToJs(m))).set("json:dealloc",m=>{try{return m?JSON.parse(i.cstrToJs(m)):null}finally{i.dealloc(m)}});const J=class{constructor(m){this.name=m.name||"unnamed adapter"}convertArg(m,N,O){l("AbstractArgAdapter must be subclassed.")}};S.FuncPtrAdapter=class gn extends J{constructor(N){super(N),S.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",N),this.name=N.name||"unnamed",this.signature=N.signature,N.contextKey instanceof Function&&(this.contextKey=N.contextKey,N.bindScope||(N.bindScope="context")),this.bindScope=N.bindScope||l("FuncPtrAdapter options requires a bindScope (explicit or implied)."),gn.bindScopes.indexOf(N.bindScope)<0&&l("Invalid options.bindScope ("+N.bindMod+") for FuncPtrAdapter. Expecting one of: ("+gn.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=N.callProxy instanceof Function?N.callProxy:void 0}contextKey(N,O){return this}contextMap(N){const O=this.__cmap||(this.__cmap=new Map);let z=O.get(N);return z===void 0&&O.set(N,z=[]),z}convertArg(N,O,z){let y=this.singleton;if(!y&&this.isContext&&(y=this.contextMap(this.contextKey(O,z))),y&&y[0]===N)return y[1];if(N instanceof Function){this.callProxy&&(N=this.callProxy(N));const v=k(N,this.signature,this.isTransient);if(gn.debugFuncInstall&&gn.debugOut("FuncPtrAdapter installed",this,this.contextKey(O,z),"@"+v,N),y){if(y[1]){gn.debugFuncInstall&&gn.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(O,z),"@"+y[1],N);try{d.scopedAlloc[d.scopedAlloc.length-1].push(y[1])}catch{}}y[0]=N,y[1]=v}return v}else if(i.isPtr(N)||N===null||N===void 0){if(y&&y[1]&&y[1]!==N){gn.debugFuncInstall&&gn.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(O,z),"@"+y[1],N);try{d.scopedAlloc[d.scopedAlloc.length-1].push(y[1])}catch{}y[0]=y[1]=N|0}return N||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},S.FuncPtrAdapter.warnOnUse=!1,S.FuncPtrAdapter.debugFuncInstall=!1,S.FuncPtrAdapter.debugOut=console.debug.bind(console),S.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const H=m=>S.get(m)||l("Argument adapter not found:",m),U=m=>A.get(m)||l("Result adapter not found:",m);d.xWrap.convertArg=(m,...N)=>H(m)(...N),d.xWrap.convertArgNoCheck=(m,...N)=>S.get(m)(...N),d.xWrap.convertResult=(m,N)=>m===null?N:m?U(m)(N):void 0,d.xWrap.convertResultNoCheck=(m,N)=>m===null?N:m?A.get(m)(N):void 0,i.xWrap=function(m,N,...O){arguments.length===3&&Array.isArray(arguments[2])&&(O=arguments[2]),i.isPtr(m)&&(m=i.functionEntry(m)||l("Function pointer not found in WASM function table."));const z=m instanceof Function,y=z?m:i.xGet(m);if(z&&(m=y.name||"unnamed function"),O.length!==y.length&&w(m,y.length),N===null&&y.length===0)return y;N!=null&&U(N);for(const f of O)f instanceof J?S.set(f,(...p)=>f.convertArg(...p)):H(f);const v=d.xWrap;return y.length===0?(...f)=>f.length?w(m,y.length):v.convertResult(N,y.call(null)):function(...f){f.length!==y.length&&w(m,y.length);const p=i.scopedAllocPush();try{for(const _ in f)f[_]=v.convertArgNoCheck(O[_],f[_],f,_);return v.convertResultNoCheck(N,y.apply(null,f))}finally{i.scopedAllocPop(p)}}};const ce=function(m,N,O,z,y,v){if(typeof O=="string"){if(N===1)return v.get(O);if(N===2){if(z)z instanceof Function||l(y,"requires a function argument.");else return delete v.get(O),m;return v.set(O,z),m}}l("Invalid arguments to",y)};return i.xWrap.resultAdapter=function m(N,O){return ce(m,arguments.length,N,O,"resultAdapter()",A)},i.xWrap.argAdapter=function m(N,O){return ce(m,arguments.length,N,O,"argAdapter()",S)},i.xWrap.FuncPtrAdapter=S.FuncPtrAdapter,i.xCallWrapped=function(m,N,O,...z){return Array.isArray(arguments[3])&&(z=arguments[3]),i.xWrap(m,N,O||[]).apply(null,z||[])},i.xWrap.testConvertArg=d.xWrap.convertArg,i.xWrap.testConvertResult=d.xWrap.convertResult,i},globalThis.WhWasmUtilInstaller.yawl=(function(i){const l=()=>fetch(i.uri,{credentials:"same-origin"}),a=this,c=function(b){if(i.wasmUtilTarget){const k=(...X)=>{throw new Error(X.join(" "))},L=i.wasmUtilTarget;if(L.module=b.module,L.instance=b.instance,L.instance.exports.memory||(L.memory=i.imports&&i.imports.env&&i.imports.env.memory||k("Missing 'memory' object!")),!L.alloc&&b.instance.exports.malloc){const X=b.instance.exports;L.alloc=function(ee){return X.malloc(ee)||k("Allocation of",ee,"bytes failed.")},L.dealloc=function(ee){X.free(ee)}}a(L)}return i.onload&&i.onload(b,i),b};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(l(),i.imports||{}).then(c)}:function(){return l().then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,i.imports||{})).then(c)}}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(l){const a=(...E)=>{throw new Error(E.join(" "))};!(l.heap instanceof WebAssembly.Memory)&&!(l.heap instanceof Function)&&a("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(E){l[E]instanceof Function||a("Config option '"+E+"' must be a function.")});const c=i,d=l.heap instanceof Function?l.heap:()=>new Uint8Array(l.heap.buffer),b=l.alloc,k=l.dealloc,L=l.log||console.log.bind(console),X=l.memberPrefix||"",ee=l.memberSuffix||"",oe=l.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!l.bigIntEnabled,T=globalThis.BigInt,g=globalThis.BigInt64Array,w=l.ptrSizeof||4,S=l.ptrIR||"i32";c.debugFlags||(c.__makeDebugFlags=function(E=null){E&&E.__flags&&(E=E.__flags);const P=function D($){return arguments.length===0?D.__flags:($<0?(delete D.__flags.getter,delete D.__flags.setter,delete D.__flags.alloc,delete D.__flags.dealloc):(D.__flags.getter=(1&$)!==0,D.__flags.setter=(2&$)!==0,D.__flags.alloc=(4&$)!==0,D.__flags.dealloc=(8&$)!==0),D._flags)};return Object.defineProperty(P,"__flags",{iterable:!1,writable:!1,value:Object.create(E)}),E||P(0),P},c.debugFlags=c.__makeDebugFlags());const A=function(){const E=new ArrayBuffer(2);return new DataView(E).setInt16(0,256,!0),new Int16Array(E)[0]===256}(),q=E=>E[1]==="(",B=E=>E==="P",J=E=>q(E)?"p":E[0],H=function(E){switch(J(E)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return S;case"j":return"i64";case"f":return"float";case"d":return"double"}a("Unhandled signature IR:",E)},U=g?()=>!0:()=>a("BigInt64Array is not available."),ce=function(E){switch(J(E)){case"p":case"P":case"s":{switch(w){case 4:return"getInt32";case 8:return U()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return U()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}a("Unhandled DataView getter for signature:",E)},m=function(E){switch(J(E)){case"p":case"P":case"s":{switch(w){case 4:return"setInt32";case 8:return U()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return U()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}a("Unhandled DataView setter for signature:",E)},N=function(E){switch(J(E)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return U()&&T;case"p":case"P":case"s":switch(w){case 4:return Number;case 8:return U()&&T}break}a("Unhandled DataView set wrapper for signature:",E)},O=(E,P)=>E+"::"+P,z=function(E,P){return()=>a(O(E,P),"is read-only.")},y=new WeakMap,v="(pointer-is-external)",f=function(E,P,D){if(D||(D=y.get(P)),D){if(y.delete(P),Array.isArray(P.ondispose)){let $;for(;$=P.ondispose.shift();)try{$ instanceof Function?$.call(P):$ instanceof le?$.dispose():typeof $=="number"&&k($)}catch(fe){console.warn("ondispose() for",E.structName,"@",D,"threw. NOT propagating it.",fe)}}else if(P.ondispose instanceof Function)try{P.ondispose()}catch($){console.warn("ondispose() for",E.structName,"@",D,"threw. NOT propagating it.",$)}delete P.ondispose,E.debugFlags.__flags.dealloc&&L("debug.dealloc:",P[v]?"EXTERNAL":"",E.structName,"instance:",E.structInfo.sizeof,"bytes @"+D),P[v]||k(D)}},p=E=>({configurable:!1,writable:!1,iterable:!1,value:E}),_=function(E,P,D){let $=!D;D?Object.defineProperty(P,v,p(D)):(D=b(E.structInfo.sizeof),D||a("Allocation of",E.structName,"structure failed."));try{E.debugFlags.__flags.alloc&&L("debug.alloc:",$?"":"EXTERNAL",E.structName,"instance:",E.structInfo.sizeof,"bytes @"+D),$&&d().fill(0,D,D+E.structInfo.sizeof),y.set(P,D)}catch(fe){throw f(E,P,D),fe}},F=function(){const E=this.pointer;return E?new Uint8Array(d().slice(E,E+this.structInfo.sizeof)):null},re=p(E=>X+E+ee),ae=function(E,P,D=!0){let $=E.members[P];if(!$&&(X||ee)){for(const fe of Object.values(E.members))if(fe.key===P){$=fe;break}!$&&D&&a(O(E.name,P),"is not a mapped struct member.")}return $},ie=function E(P,D,$=!1){E._||(E._=be=>be.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const fe=ae(P.structInfo,D,!0);return $?E._(fe.signature):fe.signature},ue={configurable:!1,enumerable:!1,get:function(){return y.get(this)},set:()=>a("Cannot assign the 'pointer' property of a struct.")},de=p(function(){const E=[];for(const P of Object.keys(this.structInfo.members))E.push(this.memberKey(P));return E}),ye=new TextDecoder("utf-8"),Ee=new TextEncoder,Be=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,_t=function(E,P,D){return ye.decode(E.buffer instanceof Be?E.slice(P,D):E.subarray(P,D))},C=function(E,P,D=!1){const $=ae(E.structInfo,P,D);return $&&$.signature.length===1&&$.signature[0]==="s"?$:!1},j=function(E){E.signature!=="s"&&a("Invalid member type signature for C-string value:",JSON.stringify(E))},V=function(P,D){const $=ae(P.structInfo,D,!0);j($);const fe=P[$.key];if(!fe)return null;let be=fe;const ke=d();for(;ke[be]!==0;++be);return fe===be?"":_t(ke,fe,be)},ne=function(E,...P){E.ondispose?Array.isArray(E.ondispose)||(E.ondispose=[E.ondispose]):E.ondispose=[],E.ondispose.push(...P)},Z=function(E){const P=Ee.encode(E),D=b(P.length+1);D||a("Allocation error while duplicating string:",E);const $=d();return $.set(P,D),$[D+P.length]=0,D},Ae=function(E,P,D){const $=ae(E.structInfo,P,!0);j($);const fe=Z(D);return E[$.key]=fe,ne(E,fe),E},le=function(P,D){arguments[2]!==p&&a("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:p(P),structInfo:p(D)})};le.prototype=Object.create(null,{dispose:p(function(){f(this.constructor,this)}),lookupMember:p(function(E,P=!0){return ae(this.structInfo,E,P)}),memberToJsString:p(function(E){return V(this,E)}),memberIsString:p(function(E,P=!0){return C(this,E,P)}),memberKey:re,memberKeys:de,memberSignature:p(function(E,P=!1){return ie(this,E,P)}),memoryDump:p(F),pointer:ue,setMemberCString:p(function(E,P){return Ae(this,E,P)})}),Object.assign(le.prototype,{addOnDispose:function(...E){return ne(this,...E),this}}),Object.defineProperties(le,{allocCString:p(Z),isA:p(E=>E instanceof le),hasExternalPointer:p(E=>E instanceof le&&!!E[v]),memberKey:re});const M=E=>Number.isFinite(E)||E instanceof(T||Number),I=function E(P,D,$){if(!E._){E._={getters:{},setters:{},sw:{}};const Et=["i","c","C","p","P","s","f","d","v()"];oe&&Et.push("j"),Et.forEach(function(sn){E._.getters[sn]=ce(sn),E._.setters[sn]=m(sn),E._.sw[sn]=N(sn)});const Yd=/^[ipPsjfdcC]$/,Zd=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;E.sigCheck=function(sn,ef,El,Do){Object.prototype.hasOwnProperty.call(sn,El)&&a(sn.structName,"already has a property named",El+"."),Yd.test(Do)||Zd.test(Do)||a("Malformed signature for",O(sn.structName,ef)+":",Do)}}const fe=P.memberKey(D);E.sigCheck(P.prototype,D,fe,$.signature),$.key=fe,$.name=D;const be=J($.signature),ke=O(P.prototype.structName,fe),Ve=P.prototype.debugFlags.__flags,jr=Object.create(null);jr.configurable=!1,jr.enumerable=!1,jr.get=function(){Ve.getter&&L("debug.getter:",E._.getters[be],"for",H(be),ke,"@",this.pointer,"+",$.offset,"sz",$.sizeof);let Et=new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[E._.getters[be]](0,A);return Ve.getter&&L("debug.getter:",ke,"result =",Et),Et},$.readOnly?jr.set=z(P.prototype.structName,fe):jr.set=function(Et){if(Ve.setter&&L("debug.setter:",E._.setters[be],"for",H(be),ke,"@",this.pointer,"+",$.offset,"sz",$.sizeof,Et),this.pointer||a("Cannot set struct property on disposed instance."),Et===null)Et=0;else for(;!M(Et);){if(B($.signature)&&Et instanceof le){Et=Et.pointer||0,Ve.setter&&L("debug.setter:",ke,"resolved to",Et);break}a("Invalid value for pointer-type",ke+".")}new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[E._.setters[be]](0,E._.sw[be](Et),A)},Object.defineProperty(P.prototype,fe,jr)},W=function E(P,D){arguments.length===1?(D=P,P=D.name):D.name||(D.name=P),P||a("Struct name is required.");let $=!1;Object.keys(D.members).forEach(ke=>{const Ve=D.members[ke];Ve.sizeof?Ve.sizeof===1?Ve.signature==="c"||Ve.signature==="C"||a("Unexpected sizeof==1 member",O(D.name,ke),"with signature",Ve.signature):(Ve.sizeof%4!==0&&(console.warn("Invalid struct member description =",Ve,"from",D),a(P,"member",ke,"sizeof is not aligned. sizeof="+Ve.sizeof)),Ve.offset%4!==0&&(console.warn("Invalid struct member description =",Ve,"from",D),a(P,"member",ke,"offset is not aligned. offset="+Ve.offset))):a(P,"member",ke,"is missing sizeof."),(!$||$.offset<Ve.offset)&&($=Ve)}),$?D.sizeof<$.offset+$.sizeof&&a("Invalid struct config:",P,"max member offset ("+$.offset+") ","extends past end of struct (sizeof="+D.sizeof+")."):a("No member property descriptions found.");const fe=p(c.__makeDebugFlags(E.debugFlags)),be=function ke(Ve){this instanceof ke?arguments.length?((Ve!==(Ve|0)||Ve<=0)&&a("Invalid pointer value for",P,"constructor."),_(ke,this,Ve)):_(ke,this):a("The",P,"constructor may only be called via 'new'.")};return Object.defineProperties(be,{debugFlags:fe,isA:p(ke=>ke instanceof be),memberKey:re,memberKeys:de,methodInfoForKey:p(function(ke){}),structInfo:p(D),structName:p(P)}),be.prototype=new le(P,D,p),Object.defineProperties(be.prototype,{debugFlags:fe,constructor:p(be)}),Object.keys(D.members).forEach(ke=>I(be,ke,D.members[ke])),be};return W.StructType=le,W.config=l,W.allocCString=Z,W.debugFlags||(W.debugFlags=c.__makeDebugFlags(c.debugFlags)),W},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...T)=>{throw new Error(T.join(" "))};i.SQLite3Error.toss;const a=i.capi,c=i.wasm,d=i.util;if(globalThis.WhWasmUtilInstaller(c),delete globalThis.WhWasmUtilInstaller,c.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new c.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:T=>{let g;return(w,S,A,q)=>{try{const B=c.cArgvToJs(S,A);return g||(g=c.cArgvToJs(S,q)),T(B,g)|0}catch(B){return B.resultCode||a.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(T,g)=>T[0],callProxy:T=>(g,w,S,A,q,B)=>{try{return S=S&&c.cstrToJs(S),A=A&&c.cstrToJs(A),q=q&&c.cstrToJs(q),B=B&&c.cstrToJs(B),T(g,w,S,A,q,B)||0}catch(J){return J.resultCode||a.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new c.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(T,g)=>T[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],c.exports.sqlite3_activate_see instanceof Function&&c.bindingSignatures.push(["sqlite3_key","int","sqlite3*","string","int"],["sqlite3_key_v2","int","sqlite3*","string","*","int"],["sqlite3_rekey","int","sqlite3*","string","int"],["sqlite3_rekey_v2","int","sqlite3*","string","*","int"],["sqlite3_activate_see",void 0,"string"]),c.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:T=>T[0],callProxy:T=>(g,w,S,A,q,B,J)=>{T(g,w,S,c.cstrToJs(A),c.cstrToJs(q),B,J)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:T=>T[0],callProxy:T=>(g,w,S,A,q)=>{T(g,w,c.cstrToJs(S),c.cstrToJs(A),q)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],c.bigIntEnabled&&c.exports.sqlite3changegroup_add){const T={signature:"i(ps)",callProxy:g=>(w,S)=>{try{return g(w,c.cstrToJs(S))|0}catch(A){return A.resultCode||a.SQLITE_ERROR}}};c.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xFilter",...T,contextKey:(g,w)=>g[0]}),"*"]])}c.bindingSignatures.wasm=[["sqlite3_wasm_db_reset","int","sqlite3*"],["sqlite3_wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3_wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3_wasm_posix_create_file","int","string","*","int"],["sqlite3_wasm_vfs_unlink","int","sqlite3_vfs*","string"]],i.StructBinder=globalThis.Jaccwabyt({heap:c.heap8u,alloc:c.alloc,dealloc:c.dealloc,bigIntEnabled:c.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const T=c.xWrap.argAdapter("string");c.xWrap.argAdapter("string:flexible",q=>T(d.flexibleString(q))),c.xWrap.argAdapter("string:static",(function(q){return c.isPtr(q)?q:(q=""+q,this[q]||(this[q]=c.allocCString(q)))}).bind(Object.create(null)));const g=c.xWrap.argAdapter("*"),w=function(){};c.xWrap.argAdapter("sqlite3_filename",g)("sqlite3_context*",g)("sqlite3_value*",g)("void*",g)("sqlite3_changegroup*",g)("sqlite3_changeset_iter*",g)("sqlite3_session*",g)("sqlite3_stmt*",q=>{var B;return g(q instanceof(((B=i==null?void 0:i.oo1)==null?void 0:B.Stmt)||w)?q.pointer:q)})("sqlite3*",q=>{var B;return g(q instanceof(((B=i==null?void 0:i.oo1)==null?void 0:B.DB)||w)?q.pointer:q)})("sqlite3_index_info*",q=>g(q instanceof(a.sqlite3_index_info||w)?q.pointer:q))("sqlite3_module*",q=>g(q instanceof(a.sqlite3_module||w)?q.pointer:q))("sqlite3_vfs*",q=>typeof q=="string"?a.sqlite3_vfs_find(q)||i.SQLite3Error.toss(a.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",q):g(q instanceof(a.sqlite3_vfs||w)?q.pointer:q));const S=c.xWrap.resultAdapter("*");c.xWrap.resultAdapter("sqlite3*",S)("sqlite3_context*",S)("sqlite3_stmt*",S)("sqlite3_value*",S)("sqlite3_vfs*",S)("void*",S),c.exports.sqlite3_step.length===0&&(c.xWrap.doArgcCheck=!1,i.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const q of c.bindingSignatures)a[q[0]]=c.xWrap.apply(null,q);for(const q of c.bindingSignatures.wasm)c[q[0]]=c.xWrap.apply(null,q);const A=function(q){return()=>l(q+"() is unavailable due to lack","of BigInt support in this build.")};for(const q of c.bindingSignatures.int64)a[q[0]]=c.bigIntEnabled?c.xWrap.apply(null,q):A(q[0]);if(delete c.bindingSignatures,c.exports.sqlite3_wasm_db_error){const q=c.xWrap("sqlite3_wasm_db_error","int","sqlite3*","int","string");d.sqlite3_wasm_db_error=function(B,J,H){return J instanceof i.WasmAllocError?(J=a.SQLITE_NOMEM,H=0):J instanceof Error&&(H=H||""+J,J=J.resultCode||a.SQLITE_ERROR),B?q(B,J,H):J}}else d.sqlite3_wasm_db_error=function(q,B,J){return console.warn("sqlite3_wasm_db_error() is not exported.",arguments),B}}{const T=c.xCall("sqlite3_wasm_enum_json");T||l("Maintenance required: increase sqlite3_wasm_enum_json()'s","static buffer size!"),c.ctype=JSON.parse(c.cstrToJs(T));const g=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];c.bigIntEnabled&&g.push("serialize","session","vtab");for(const A of g)for(const q of Object.entries(c.ctype[A]))a[q[0]]=q[1];c.functionEntry(a.SQLITE_WASM_DEALLOC)||l("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+a.SQLITE_WASM_DEALLOC+").");const w=Object.create(null);for(const A of["resultCodes"])for(const q of Object.entries(c.ctype[A]))w[q[1]]=q[0];a.sqlite3_js_rc_str=A=>w[A];const S=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!d.isUIThread(),sqlite3_index_info:!c.bigIntEnabled,sqlite3_index_constraint:!c.bigIntEnabled,sqlite3_index_orderby:!c.bigIntEnabled,sqlite3_index_constraint_usage:!c.bigIntEnabled});for(const A of c.ctype.structs)S[A.name]||(a[A.name]=i.StructBinder(A));if(a.sqlite3_index_info){for(const A of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])a.sqlite3_index_info[A]=a[A],delete a[A];a.sqlite3_vtab_config=c.xWrap("sqlite3_wasm_vtab_config","int",["sqlite3*","int","int"])}}const b=(T,g,w)=>i.util.sqlite3_wasm_db_error(T,a.SQLITE_MISUSE,g+"() requires "+w+" argument"+(w===1?"":"s")+"."),k=T=>d.sqlite3_wasm_db_error(T,a.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),L=T=>c.xWrap.argAdapter("sqlite3*")(T),X=T=>c.isPtr(T)?c.cstrToJs(T):T,ee=(function(T,g){T=L(T);let w=this.dbMap.get(T);if(g)!w&&g>0&&this.dbMap.set(T,w=Object.create(null));else return this.dbMap.delete(T),w;return w}).bind(Object.assign(Object.create(null),{dbMap:new Map}));ee.addCollation=function(T,g){const w=ee(T,1);w.collation||(w.collation=new Set),w.collation.add(X(g).toLowerCase())},ee._addUDF=function(T,g,w,S){g=X(g).toLowerCase();let A=S.get(g);A||S.set(g,A=new Set),A.add(w<0?-1:w)},ee.addFunction=function(T,g,w){const S=ee(T,1);S.udf||(S.udf=new Map),this._addUDF(T,g,w,S.udf)},ee.addWindowFunc=function(T,g,w){const S=ee(T,1);S.wudf||(S.wudf=new Map),this._addUDF(T,g,w,S.wudf)},ee.cleanup=function(T){T=L(T);const g=[T];for(const A of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const q=c.exports[A];g.length=q.length;try{a[A](...g)}catch(B){console.warn("close-time call of",A+"(",g,") threw:",B)}}const w=ee(T,0);if(!w)return;if(w.collation){for(const A of w.collation)try{a.sqlite3_create_collation_v2(T,A,a.SQLITE_UTF8,0,0,0)}catch{}delete w.collation}let S;for(S=0;S<2;++S){const A=S?w.wudf:w.udf;if(!A)continue;const q=S?a.sqlite3_create_window_function:a.sqlite3_create_function_v2;for(const B of A){const J=B[0],H=B[1],U=[T,J,0,a.SQLITE_UTF8,0,0,0,0,0];S&&U.push(0);for(const ce of H)try{U[2]=ce,q.apply(null,U)}catch{}H.clear()}A.clear()}delete w.udf,delete w.wudf};{const T=c.xWrap("sqlite3_close_v2","int","sqlite3*");a.sqlite3_close_v2=function(g){if(arguments.length!==1)return b(g,"sqlite3_close_v2",1);if(g)try{ee.cleanup(g)}catch{}return T(g)}}if(a.sqlite3session_table_filter){const T=c.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);a.sqlite3session_delete=function(g){if(arguments.length!==1)return b(pDb,"sqlite3session_delete",1);g&&a.sqlite3session_table_filter(g,0,0),T(g)}}{const T=(w,S)=>"argv["+S+"]:"+w[0]+":"+c.cstrToJs(w[1]).toLowerCase(),g=c.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new c.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:T}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:T})]);a.sqlite3_create_collation_v2=function(w,S,A,q,B,J){if(arguments.length!==6)return b(w,"sqlite3_create_collation_v2",6);if(!(A&15))A|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(A&15))return k(w);try{const H=g(w,S,A,q,B,J);return H===0&&B instanceof Function&&ee.addCollation(w,S),H}catch(H){return d.sqlite3_wasm_db_error(w,H)}},a.sqlite3_create_collation=(w,S,A,q,B)=>arguments.length===5?a.sqlite3_create_collation_v2(w,S,A,q,B,0):b(w,"sqlite3_create_collation",5)}{const T=function(A,q){return A[0]+":"+(A[2]<0?-1:A[2])+":"+q+":"+c.cstrToJs(A[1]).toLowerCase()},g=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:T,callProxy:A=>(q,B,J)=>{try{A(q,...a.sqlite3_values_to_js(B,J))}catch(H){a.sqlite3_result_error_js(q,H)}}},xFinalAndValue:{signature:"v(p)",contextKey:T,callProxy:A=>q=>{try{a.sqlite3_result_js(q,A(q))}catch(B){a.sqlite3_result_error_js(q,B)}}},xFunc:{signature:"v(pip)",contextKey:T,callProxy:A=>(q,B,J)=>{try{a.sqlite3_result_js(q,A(q,...a.sqlite3_values_to_js(B,J)))}catch(H){a.sqlite3_result_error_js(q,H)}}},xDestroy:{signature:"v(p)",contextKey:T,callProxy:A=>q=>{try{A(q)}catch(B){console.error("UDF xDestroy method threw:",B)}}}}),w=c.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xFunc",...g.xFunc}),new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]),S=c.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xValue",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xInverse",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]);a.sqlite3_create_function_v2=function A(q,B,J,H,U,ce,m,N,O){if(A.length!==arguments.length)return b(q,"sqlite3_create_function_v2",A.length);if(!(H&15))H|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(H&15))return k(q);try{const z=w(q,B,J,H,U,ce,m,N,O);return z===0&&(ce instanceof Function||m instanceof Function||N instanceof Function||O instanceof Function)&&ee.addFunction(q,B,J),z}catch(z){return console.error("sqlite3_create_function_v2() setup threw:",z),d.sqlite3_wasm_db_error(q,z,"Creation of UDF threw: "+z)}},a.sqlite3_create_function=function A(q,B,J,H,U,ce,m,N){return A.length===arguments.length?a.sqlite3_create_function_v2(q,B,J,H,U,ce,m,N,0):b(q,"sqlite3_create_function",A.length)},a.sqlite3_create_window_function=function A(q,B,J,H,U,ce,m,N,O,z){if(A.length!==arguments.length)return b(q,"sqlite3_create_window_function",A.length);if(!(H&15))H|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(H&15))return k(q);try{const y=S(q,B,J,H,U,ce,m,N,O,z);return y===0&&(ce instanceof Function||m instanceof Function||N instanceof Function||O instanceof Function||z instanceof Function)&&ee.addWindowFunc(q,B,J),y}catch(y){return console.error("sqlite3_create_window_function() setup threw:",y),d.sqlite3_wasm_db_error(q,y,"Creation of UDF threw: "+y)}},a.sqlite3_create_function_v2.udfSetResult=a.sqlite3_create_function.udfSetResult=a.sqlite3_create_window_function.udfSetResult=a.sqlite3_result_js,a.sqlite3_create_function_v2.udfConvertArgs=a.sqlite3_create_function.udfConvertArgs=a.sqlite3_create_window_function.udfConvertArgs=a.sqlite3_values_to_js,a.sqlite3_create_function_v2.udfSetError=a.sqlite3_create_function.udfSetError=a.sqlite3_create_window_function.udfSetError=a.sqlite3_result_error_js}{const T=(w,S)=>(typeof w=="string"?S=-1:d.isSQLableTypedArray(w)?(S=w.byteLength,w=d.typedArrayToString(w instanceof ArrayBuffer?new Uint8Array(w):w)):Array.isArray(w)&&(w=w.join(""),S=-1),[w,S]),g={basic:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};a.sqlite3_prepare_v3=function w(S,A,q,B,J,H){if(w.length!==arguments.length)return b(S,"sqlite3_prepare_v3",w.length);const[U,ce]=T(A,q);switch(typeof U){case"string":return g.basic(S,U,ce,B,J,null);case"number":return g.full(S,U,ce,B,J,H);default:return d.sqlite3_wasm_db_error(S,a.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},a.sqlite3_prepare_v2=function w(S,A,q,B,J){return w.length===arguments.length?a.sqlite3_prepare_v3(S,A,q,0,B,J):b(S,"sqlite3_prepare_v2",w.length)}}{const T=c.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),g=c.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);a.sqlite3_bind_text=function w(S,A,q,B,J){if(w.length!==arguments.length)return b(a.sqlite3_db_handle(S),"sqlite3_bind_text",w.length);if(c.isPtr(q)||q===null)return T(S,A,q,B,J);q instanceof ArrayBuffer?q=new Uint8Array(q):Array.isArray(pMem)&&(q=pMem.join(""));let H,U;try{if(d.isSQLableTypedArray(q))H=c.allocFromTypedArray(q),U=q.byteLength;else if(typeof q=="string")[H,U]=c.allocCString(q);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(S),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return T(S,A,H,U,a.SQLITE_WASM_DEALLOC)}catch(ce){return c.dealloc(H),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(S),ce)}},a.sqlite3_bind_blob=function w(S,A,q,B,J){if(w.length!==arguments.length)return b(a.sqlite3_db_handle(S),"sqlite3_bind_blob",w.length);if(c.isPtr(q)||q===null)return g(S,A,q,B,J);q instanceof ArrayBuffer?q=new Uint8Array(q):Array.isArray(q)&&(q=q.join(""));let H,U;try{if(d.isBindableTypedArray(q))H=c.allocFromTypedArray(q),U=B>=0?B:q.byteLength;else if(typeof q=="string")[H,U]=c.allocCString(q);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(S),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return g(S,A,H,U,a.SQLITE_WASM_DEALLOC)}catch(ce){return c.dealloc(H),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(S),ce)}}}a.sqlite3_config=function(T,...g){if(arguments.length<2)return a.SQLITE_MISUSE;switch(T){case a.SQLITE_CONFIG_COVERING_INDEX_SCAN:case a.SQLITE_CONFIG_MEMSTATUS:case a.SQLITE_CONFIG_SMALL_MALLOC:case a.SQLITE_CONFIG_SORTERREF_SIZE:case a.SQLITE_CONFIG_STMTJRNL_SPILL:case a.SQLITE_CONFIG_URI:return c.exports.sqlite3_wasm_config_i(T,g[0]);case a.SQLITE_CONFIG_LOOKASIDE:return c.exports.sqlite3_wasm_config_ii(T,g[0],g[1]);case a.SQLITE_CONFIG_MEMDB_MAXSIZE:return c.exports.sqlite3_wasm_config_j(T,g[0]);case a.SQLITE_CONFIG_GETMALLOC:case a.SQLITE_CONFIG_GETMUTEX:case a.SQLITE_CONFIG_GETPCACHE2:case a.SQLITE_CONFIG_GETPCACHE:case a.SQLITE_CONFIG_HEAP:case a.SQLITE_CONFIG_LOG:case a.SQLITE_CONFIG_MALLOC:case a.SQLITE_CONFIG_MMAP_SIZE:case a.SQLITE_CONFIG_MULTITHREAD:case a.SQLITE_CONFIG_MUTEX:case a.SQLITE_CONFIG_PAGECACHE:case a.SQLITE_CONFIG_PCACHE2:case a.SQLITE_CONFIG_PCACHE:case a.SQLITE_CONFIG_PCACHE_HDRSZ:case a.SQLITE_CONFIG_PMASZ:case a.SQLITE_CONFIG_SERIALIZED:case a.SQLITE_CONFIG_SINGLETHREAD:case a.SQLITE_CONFIG_SQLLOG:case a.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return a.SQLITE_NOTFOUND}};{const T=new Set;a.sqlite3_auto_extension=function(g){if(g instanceof Function)g=c.installFunction("i(ppp)",g);else if(arguments.length!==1||!c.isPtr(g))return a.SQLITE_MISUSE;const w=c.exports.sqlite3_auto_extension(g);return g!==arguments[0]&&(w===0?T.add(g):c.uninstallFunction(g)),w},a.sqlite3_cancel_auto_extension=function(g){return!g||arguments.length!==1||!c.isPtr(g)?0:c.exports.sqlite3_cancel_auto_extension(g)},a.sqlite3_reset_auto_extension=function(){c.exports.sqlite3_reset_auto_extension();for(const g of T)c.uninstallFunction(g);T.clear()}}const oe=a.sqlite3_vfs_find("kvvfs");if(oe)if(d.isUIThread()){const T=new a.sqlite3_kvvfs_methods(c.exports.sqlite3_wasm_kvvfs_methods());delete a.sqlite3_kvvfs_methods;const g=c.exports.sqlite3_wasm_kvvfsMakeKeyOnPstack,w=c.pstack,S=q=>c.peek(q)===115?sessionStorage:localStorage,A={xRead:(q,B,J,H)=>{const U=w.pointer,ce=c.scopedAllocPush();try{const m=g(q,B);if(!m)return-3;const N=c.cstrToJs(m),O=S(q).getItem(N);if(!O)return-1;const z=O.length;if(H<=0)return z;if(H===1)return c.poke(J,0),z;const y=c.scopedAllocCString(O);return H>z+1&&(H=z+1),c.heap8u().copyWithin(J,y,y+H-1),c.poke(J+H-1,0),H-1}catch(m){return console.error("kvstorageRead()",m),-2}finally{w.restore(U),c.scopedAllocPop(ce)}},xWrite:(q,B,J)=>{const H=w.pointer;try{const U=g(q,B);if(!U)return 1;const ce=c.cstrToJs(U);return S(q).setItem(ce,c.cstrToJs(J)),0}catch(U){return console.error("kvstorageWrite()",U),a.SQLITE_IOERR}finally{w.restore(H)}},xDelete:(q,B)=>{const J=w.pointer;try{const H=g(q,B);return H?(S(q).removeItem(c.cstrToJs(H)),0):1}catch(H){return console.error("kvstorageDelete()",H),a.SQLITE_IOERR}finally{w.restore(J)}}};for(const q of Object.keys(A))T[T.memberKey(q)]=c.installFunction(T.memberSignature(q),A[q])}else a.sqlite3_vfs_unregister(oe);c.xWrap.FuncPtrAdapter.warnOnUse=!0}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.43.0",libVersionNumber:3043e3,sourceId:"2023-08-24 12:36:59 0f80b798b3f4b81a7bb4233c58294edd0f1156f36b6ecf5ab8e83631d468778c",downloadVersion:343e4}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...y)=>{throw new i.SQLite3Error(...y)},a=i.capi,c=i.wasm,d=i.util,b=new WeakMap,k=new WeakMap,L=(y,v,f)=>{const p=Object.getOwnPropertyDescriptor(y,v);return p?p.value:f},X=function(y,v){return v&&(y instanceof g&&(y=y.pointer),l(v,"sqlite3 result code",v+":",y?a.sqlite3_errmsg(y):a.sqlite3_errstr(v))),arguments[0]},ee=c.installFunction("i(ippp)",(function(y,v,f,p){a.SQLITE_TRACE_STMT===y&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+v+":",c.cstrToJs(p))}).bind({counter:0})),oe=Object.create(null),T=function y(...v){if(!y._name2vfs){y._name2vfs=Object.create(null);const de=typeof importScripts=="function"?ye=>l("The VFS for",ye,"is only available in the main window thread."):!1;y._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:de||(()=>"local")},y._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:de||(()=>"session")}}const f=y.normalizeArgs(...v);let p=f.filename,_=f.vfs,F=f.flags;(typeof p!="string"&&typeof p!="number"||typeof F!="string"||_&&typeof _!="string"&&typeof _!="number")&&(i.config.error("Invalid DB ctor args",f,arguments),l("Invalid arguments for DB constructor."));let G=typeof p=="number"?c.cstrToJs(p):p;const re=y._name2vfs[G];re&&(_=re.vfs,p=G=re.filename(G));let ae,ie=0;F.indexOf("c")>=0&&(ie|=a.SQLITE_OPEN_CREATE|a.SQLITE_OPEN_READWRITE),F.indexOf("w")>=0&&(ie|=a.SQLITE_OPEN_READWRITE),ie===0&&(ie|=a.SQLITE_OPEN_READONLY),ie|=a.SQLITE_OPEN_EXRESCODE;const ue=c.pstack.pointer;try{const de=c.pstack.allocPtr();let ye=a.sqlite3_open_v2(p,de,ie,_||0);ae=c.peekPtr(de),X(ae,ye),a.sqlite3_extended_result_codes(ae,1),F.indexOf("t")>=0&&a.sqlite3_trace_v2(ae,a.SQLITE_TRACE_STMT,ee,ae)}catch(de){throw ae&&a.sqlite3_close_v2(ae),de}finally{c.pstack.restore(ue)}this.filename=G,b.set(this,ae),k.set(this,Object.create(null));try{const de=a.sqlite3_js_db_vfs(ae);de||l("Internal error: cannot get VFS for new db handle.");const ye=oe[de];ye instanceof Function?ye(this,i):ye&&X(ae,a.sqlite3_exec(ae,ye,0,0,0))}catch(de){throw this.close(),de}};T.setVfsPostOpenSql=function(y,v){oe[y]=v},T.normalizeArgs=function(y=":memory:",v="c",f=null){const p={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(p,arguments[0]),p.flags===void 0&&(p.flags="c"),p.vfs===void 0&&(p.vfs=null),p.filename===void 0&&(p.filename=":memory:")):(p.filename=y,p.flags=v,p.vfs=f),p};const g=function(...y){T.apply(this,y)};g.dbCtorHelper=T;const w={null:1,number:2,string:3,boolean:4,blob:5};w.undefined==w.null,c.bigIntEnabled&&(w.bigint=w.number);const S=function(){w!==arguments[2]&&l(a.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],b.set(this,arguments[1]),this.parameterCount=a.sqlite3_bind_parameter_count(this.pointer)},A=function(y){return y.pointer||l("DB has been closed."),y},q=function(y,v){return(v!==(v|0)||v<0||v>=y.columnCount)&&l("Column index",v,"is out of range."),y},B=function(y,v){const f=Object.create(null);switch(f.opt=Object.create(null),v.length){case 1:typeof v[0]=="string"||d.isSQLableTypedArray(v[0])||Array.isArray(v[0])?f.sql=v[0]:v[0]&&typeof v[0]=="object"&&(f.opt=v[0],f.sql=f.opt.sql);break;case 2:f.sql=v[0],f.opt=v[1];break;default:l("Invalid argument count for exec().")}f.sql=d.flexibleString(f.sql),typeof f.sql!="string"&&l("Missing SQL argument or unsupported SQL value type.");const p=f.opt;switch(p.returnValue){case"resultRows":p.resultRows||(p.resultRows=[]),f.returnVal=()=>p.resultRows;break;case"saveSql":p.saveSql||(p.saveSql=[]),f.returnVal=()=>p.saveSql;break;case void 0:case"this":f.returnVal=()=>y;break;default:l("Invalid returnValue value:",p.returnValue)}if(!p.callback&&!p.returnValue&&p.rowMode!==void 0&&(p.resultRows||(p.resultRows=[]),f.returnVal=()=>p.resultRows),p.callback||p.resultRows)switch(p.rowMode===void 0?"array":p.rowMode){case"object":f.cbArg=_=>_.get(Object.create(null));break;case"array":f.cbArg=_=>_.get([]);break;case"stmt":Array.isArray(p.resultRows)&&l("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),f.cbArg=_=>_;break;default:if(d.isInt32(p.rowMode)){f.cbArg=_=>_.get(p.rowMode);break}else if(typeof p.rowMode=="string"&&p.rowMode.length>1&&p.rowMode[0]==="$"){const _=p.rowMode.substr(1);f.cbArg=F=>{const G=F.get(Object.create(null))[_];return G===void 0?l(a.SQLITE_NOTFOUND,"exec(): unknown result column:",_):G};break}l("Invalid rowMode:",p.rowMode)}return f},J=(y,v,f,...p)=>{const _=y.prepare(v);try{const F=_.bind(f).step()?_.get(...p):void 0;return _.reset(),F}finally{_.finalize()}},H=(y,v,f,p)=>y.exec({sql:v,bind:f,rowMode:p,returnValue:"resultRows"});g.checkRc=(y,v)=>X(y,v),g.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return A(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const y=this.pointer;if(Object.keys(k.get(this)).forEach((v,f)=>{if(f&&f.pointer)try{f.finalize()}catch{}}),b.delete(this),k.delete(this),a.sqlite3_close_v2(y),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(y=!1,v=!1){const f=A(this).pointer;return y?v?a.sqlite3_total_changes64(f):a.sqlite3_total_changes(f):v?a.sqlite3_changes64(f):a.sqlite3_changes(f)},dbFilename:function(y="main"){return a.sqlite3_db_filename(A(this).pointer,y)},dbName:function(y=0){return a.sqlite3_db_name(A(this).pointer,y)},dbVfsName:function(y=0){let v;const f=a.sqlite3_js_db_vfs(A(this).pointer,y);if(f){const p=new a.sqlite3_vfs(f);try{v=c.cstrToJs(p.$zName)}finally{p.dispose()}}return v},prepare:function(y){A(this);const v=c.pstack.pointer;let f,p;try{f=c.pstack.alloc(8),g.checkRc(this,a.sqlite3_prepare_v2(this.pointer,y,-1,f,null)),p=c.peekPtr(f)}finally{c.pstack.restore(v)}p||l("Cannot prepare empty SQL.");const _=new S(this,p,w);return k.get(this)[p]=_,_},exec:function(){A(this);const y=B(this,arguments);if(!y.sql)return l("exec() requires an SQL string.");const v=y.opt,f=v.callback,p=Array.isArray(v.resultRows)?v.resultRows:void 0;let _,F=v.bind,G=!!(y.cbArg||v.columnNames||p);const re=c.scopedAllocPush(),ae=Array.isArray(v.saveSql)?v.saveSql:void 0;try{const ie=d.isSQLableTypedArray(y.sql);let ue=ie?y.sql.byteLength:c.jstrlen(y.sql);const de=c.scopedAlloc(2*c.ptrSizeof+(ue+1)),ye=de+c.ptrSizeof;let Ee=ye+c.ptrSizeof;const Be=Ee+ue;for(ie?c.heap8().set(y.sql,Ee):c.jstrcpy(y.sql,c.heap8(),Ee,ue,!1),c.poke(Ee+ue,0);Ee&&c.peek(Ee,"i8");){c.pokePtr([de,ye],0),g.checkRc(this,a.sqlite3_prepare_v3(this.pointer,Ee,ue,0,de,ye));const _t=c.peekPtr(de);if(Ee=c.peekPtr(ye),ue=Be-Ee,!!_t){if(ae&&ae.push(a.sqlite3_sql(_t).trim()),_=new S(this,_t,w),F&&_.parameterCount&&(_.bind(F),F=null),G&&_.columnCount){let C=Array.isArray(v.columnNames)?0:1;if(G=!1,y.cbArg||p){for(;_.step();_._lockedByExec=!1){C++===0&&_.getColumnNames(v.columnNames),_._lockedByExec=!0;const j=y.cbArg(_);if(p&&p.push(j),f&&f.call(v,j,_)===!1)break}_._lockedByExec=!1}C===0&&_.getColumnNames(v.columnNames)}else _.step();_.reset().finalize(),_=null}}}finally{c.scopedAllocPop(re),_&&(delete _._lockedByExec,_.finalize())}return y.returnVal()},createFunction:function(v,f,p){const _=j=>j instanceof Function;switch(arguments.length){case 1:p=v,v=p.name,f=p.xFunc||0;break;case 2:_(f)||(p=f,f=p.xFunc||0);break}p||(p={}),typeof v!="string"&&l("Invalid arguments: missing function name.");let F=p.xStep||0,G=p.xFinal||0;const re=p.xValue||0,ae=p.xInverse||0;let ie;_(f)?(ie=!1,(_(F)||_(G))&&l("Ambiguous arguments: scalar or aggregate?"),F=G=null):_(F)?(_(G)||l("Missing xFinal() callback for aggregate or window UDF."),f=null):_(G)?l("Missing xStep() callback for aggregate or window UDF."):l("Missing function-type properties."),ie===!1?(_(re)||_(ae))&&l("xValue and xInverse are not permitted for non-window UDFs."):_(re)?(_(ae)||l("xInverse must be provided if xValue is."),ie=!0):_(ae)&&l("xValue must be provided if xInverse is.");const ue=p.pApp;ue!=null&&(typeof ue!="number"||!d.isInt32(ue))&&l("Invalid value for pApp property. Must be a legal WASM pointer value.");const de=p.xDestroy||0;de&&!_(de)&&l("xDestroy property must be a function.");let ye=0;L(p,"deterministic")&&(ye|=a.SQLITE_DETERMINISTIC),L(p,"directOnly")&&(ye|=a.SQLITE_DIRECTONLY),L(p,"innocuous")&&(ye|=a.SQLITE_INNOCUOUS),v=v.toLowerCase();const Ee=f||F,Be=L(p,"arity"),_t=typeof Be=="number"?Be:Ee.length?Ee.length-1:0;let C;return ie?C=a.sqlite3_create_window_function(this.pointer,v,_t,a.SQLITE_UTF8|ye,ue||0,F,G,re,ae,de):C=a.sqlite3_create_function_v2(this.pointer,v,_t,a.SQLITE_UTF8|ye,ue||0,f,F,G,de),g.checkRc(this,C),this},selectValue:function(y,v,f){return J(this,y,v,0,f)},selectValues:function(y,v,f){const p=this.prepare(y),_=[];try{for(p.bind(v);p.step();)_.push(p.get(0,f));p.reset()}finally{p.finalize()}return _},selectArray:function(y,v){return J(this,y,v,[])},selectObject:function(y,v){return J(this,y,v,{})},selectArrays:function(y,v){return H(this,y,v,"array")},selectObjects:function(y,v){return H(this,y,v,"object")},openStatementCount:function(){return this.pointer?Object.keys(k.get(this)).length:0},transaction:function(y){let v="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&l(a.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),v+=" "+arguments[0],y=arguments[1]),A(this).exec(v);try{const f=y(this);return this.exec("COMMIT"),f}catch(f){throw this.exec("ROLLBACK"),f}},savepoint:function(y){A(this).exec("SAVEPOINT oo1");try{const v=y(this);return this.exec("RELEASE oo1"),v}catch(v){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),v}},checkRc:function(y){return X(this,y)}};const U=function(y){return y.pointer||l("Stmt has been closed."),y},ce=function(y){let v=w[y==null?"null":typeof y];switch(v){case w.boolean:case w.null:case w.number:case w.string:return v;case w.bigint:if(c.bigIntEnabled)return v;default:return d.isBindableTypedArray(y)?w.blob:void 0}},m=function(y){return ce(y)||l("Unsupported bind() argument type:",typeof y)},N=function(y,v){const f=typeof v=="number"?v:a.sqlite3_bind_parameter_index(y.pointer,v);return f===0||!d.isInt32(f)?l("Invalid bind() parameter name: "+v):(f<1||f>y.parameterCount)&&l("Bind index",v,"is out of range."),f},O=function(y,v){return y._lockedByExec&&l("Operation is illegal when statement is locked:",v),y},z=function y(v,f,p,_){O(U(v),"bind()"),y._||(y._tooBigInt=G=>l("BigInt value is too big to store without precision loss:",G),y._={string:function(G,re,ae,ie){const[ue,de]=c.allocCString(ae,!0);return(ie?a.sqlite3_bind_blob:a.sqlite3_bind_text)(G.pointer,re,ue,de,a.SQLITE_WASM_DEALLOC)}}),m(_),f=N(v,f);let F=0;switch(_==null?w.null:p){case w.null:F=a.sqlite3_bind_null(v.pointer,f);break;case w.string:F=y._.string(v,f,_,!1);break;case w.number:{let G;d.isInt32(_)?G=a.sqlite3_bind_int:typeof _=="bigint"?d.bigIntFits64(_)?c.bigIntEnabled?G=a.sqlite3_bind_int64:d.bigIntFitsDouble(_)?(_=Number(_),G=a.sqlite3_bind_double):y._tooBigInt(_):y._tooBigInt(_):(_=Number(_),c.bigIntEnabled&&Number.isInteger(_)?G=a.sqlite3_bind_int64:G=a.sqlite3_bind_double),F=G(v.pointer,f,_);break}case w.boolean:F=a.sqlite3_bind_int(v.pointer,f,_?1:0);break;case w.blob:{if(typeof _=="string"){F=y._.string(v,f,_,!0);break}else _ instanceof ArrayBuffer?_=new Uint8Array(_):d.isBindableTypedArray(_)||l("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const G=c.alloc(_.byteLength||1);c.heap8().set(_.byteLength?_:[0],G),F=a.sqlite3_bind_blob(v.pointer,f,G,_.byteLength,a.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",_),l("Unsupported bind() argument type: "+typeof _)}return F&&g.checkRc(v.db.pointer,F),v._mayGet=!1,v};S.prototype={finalize:function(){if(this.pointer){O(this,"finalize()");const y=a.sqlite3_finalize(this.pointer);return delete k.get(this.db)[this.pointer],b.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,y}},clearBindings:function(){return O(U(this),"clearBindings()"),a.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(y){O(this,"reset()"),y&&this.clearBindings();const v=a.sqlite3_reset(U(this).pointer);return this._mayGet=!1,X(this.db,v),this},bind:function(){U(this);let y,v;switch(arguments.length){case 1:y=1,v=arguments[0];break;case 2:y=arguments[0],v=arguments[1];break;default:l("Invalid bind() arguments.")}return v===void 0?this:(this.parameterCount||l("This statement has no bindable parameters."),this._mayGet=!1,v===null?z(this,y,w.null,v):Array.isArray(v)?(arguments.length!==1&&l("When binding an array, an index argument is not permitted."),v.forEach((f,p)=>z(this,p+1,m(f),f)),this):(v instanceof ArrayBuffer&&(v=new Uint8Array(v)),typeof v=="object"&&!d.isBindableTypedArray(v)?(arguments.length!==1&&l("When binding an object, an index argument is not permitted."),Object.keys(v).forEach(f=>z(this,f,m(v[f]),v[f])),this):z(this,y,m(v),v)))},bindAsBlob:function(y,v){U(this),arguments.length===1&&(v=y,y=1);const f=m(v);return w.string!==f&&w.blob!==f&&w.null!==f&&l("Invalid value type for bindAsBlob()"),z(this,y,w.blob,v)},step:function(){O(this,"step()");const y=a.sqlite3_step(U(this).pointer);switch(y){case a.SQLITE_DONE:return this._mayGet=!1;case a.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,i.config.warn("sqlite3_step() rc=",y,a.sqlite3_js_rc_str(y),"SQL =",a.sqlite3_sql(this.pointer)),g.checkRc(this.db.pointer,y)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const y=this.step();return this.reset(),y}finally{try{this.finalize()}catch{}}},get:function(y,v){if(U(this)._mayGet||l("Stmt.step() has not (recently) returned true."),Array.isArray(y)){let f=0;const p=this.columnCount;for(;f<p;)y[f]=this.get(f++);return y}else if(y&&typeof y=="object"){let f=0;const p=this.columnCount;for(;f<p;)y[a.sqlite3_column_name(this.pointer,f)]=this.get(f++);return y}switch(q(this,y),v===void 0?a.sqlite3_column_type(this.pointer,y):v){case a.SQLITE_NULL:return null;case a.SQLITE_INTEGER:if(c.bigIntEnabled){const f=a.sqlite3_column_int64(this.pointer,y);return f>=Number.MIN_SAFE_INTEGER&&f<=Number.MAX_SAFE_INTEGER?Number(f).valueOf():f}else{const f=a.sqlite3_column_double(this.pointer,y);return(f>Number.MAX_SAFE_INTEGER||f<Number.MIN_SAFE_INTEGER)&&l("Integer is out of range for JS integer range: "+f),d.isInt32(f)?f|0:f}case a.SQLITE_FLOAT:return a.sqlite3_column_double(this.pointer,y);case a.SQLITE_TEXT:return a.sqlite3_column_text(this.pointer,y);case a.SQLITE_BLOB:{const f=a.sqlite3_column_bytes(this.pointer,y),p=a.sqlite3_column_blob(this.pointer,y),_=new Uint8Array(f);return f&&_.set(c.heap8u().slice(p,p+f),0),f&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(_.buffer),_}default:l("Don't know how to translate","type of result column #"+y+".")}l("Not reached.")},getInt:function(y){return this.get(y,a.SQLITE_INTEGER)},getFloat:function(y){return this.get(y,a.SQLITE_FLOAT)},getString:function(y){return this.get(y,a.SQLITE_TEXT)},getBlob:function(y){return this.get(y,a.SQLITE_BLOB)},getJSON:function(y){const v=this.get(y,a.SQLITE_STRING);return v===null?v:JSON.parse(v)},getColumnName:function(y){return a.sqlite3_column_name(q(U(this),y).pointer,y)},getColumnNames:function(y=[]){q(U(this),0);const v=this.columnCount;for(let f=0;f<v;++f)y.push(a.sqlite3_column_name(this.pointer,f));return y},getParamIndex:function(y){return U(this).parameterCount?a.sqlite3_bind_parameter_index(this.pointer,y):void 0}};{const y={enumerable:!0,get:function(){return b.get(this)},set:()=>l("The pointer property is read-only.")};Object.defineProperty(S.prototype,"pointer",y),Object.defineProperty(g.prototype,"pointer",y)}if(Object.defineProperty(S.prototype,"columnCount",{enumerable:!1,get:function(){return a.sqlite3_column_count(this.pointer)},set:()=>l("The columnCount property is read-only.")}),i.oo1={DB:g,Stmt:S},d.isUIThread()){i.oo1.JsStorageDb=function(v="session"){v!=="session"&&v!=="local"&&l("JsStorageDb db name must be one of 'session' or 'local'."),T.call(this,{filename:v,flags:"c",vfs:"kvvfs"})};const y=i.oo1.JsStorageDb;y.prototype=Object.create(g.prototype),y.clearStorage=a.sqlite3_js_kvvfs_clear,y.prototype.clearStorage=function(){return y.clearStorage(A(this).filename)},y.storageSize=a.sqlite3_js_kvvfs_size,y.prototype.storageSize=function(){return y.storageSize(A(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.initWorker1API=(function(){const l=(...g)=>{throw new Error(g.join(" "))};globalThis.WorkerGlobalScope instanceof Function||l("initWorker1API() must be run from a Worker thread."),this.self;const a=this.sqlite3||l("Missing this.sqlite3 object."),c=a.oo1.DB,d=function(g){let w=b.idMap.get(g);return w||(w="db#"+ ++b.idSeq+"@"+g.pointer,b.idMap.set(g,w),w)},b={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(g){const w=new c(g);return this.dbs[d(w)]=w,this.dbList.indexOf(w)<0&&this.dbList.push(w),w},close:function(g,w){if(g){delete this.dbs[d(g)];const S=g.filename,A=a.wasm.sqlite3_wasm_db_vfs(g.pointer,0);g.close();const q=this.dbList.indexOf(g);q>=0&&this.dbList.splice(q,1),w&&S&&A&&a.wasm.sqlite3_wasm_vfs_unlink(A,S)}},post:function(g,w){w&&w.length?(globalThis.postMessage(g,Array.from(w)),w.length=0):globalThis.postMessage(g)},dbs:Object.create(null),getDb:function(g,w=!0){return this.dbs[g]||(w?l("Unknown (or closed) DB ID:",g):void 0)}},k=function(g=b.dbList[0]){return g&&g.pointer?g:l("DB is not opened.")},L=function(g,w=!0){const S=b.getDb(g.dbId,!1)||b.dbList[0];return w?k(S):S},X=function(){return b.dbList[0]&&d(b.dbList[0])},ee=function(g){const w=/^file:.+(vfs=(\w+))/.exec(g);return a.capi.sqlite3_vfs_find(w?w[2]:0)},oe=g=>g===""||g[0]===":",T={open:function(g){const w=Object.create(null),S=g.args||Object.create(null);S.simulateError&&l("Throwing because of simulateError flag.");const A=Object.create(null);let q,B;if(w.vfs=S.vfs,oe(S.filename)?w.filename=S.filename||"":(w.filename=S.filename,q=S.byteArray,q&&(B=ee(S.filename))),B){let H;try{H=a.wasm.allocFromTypedArray(q);const U=a.wasm.sqlite3_wasm_vfs_create_file(B,w.filename,H,q.byteLength);U&&a.SQLite3Error.toss(U)}catch(U){throw new a.SQLite3Error(U.name+" creating "+S.filename+": "+U.message,{cause:U})}finally{H&&a.wasm.dealloc(H)}}const J=b.open(w);return A.filename=J.filename,A.persistent=!!a.capi.sqlite3_js_db_uses_vfs(J.pointer,"opfs"),A.dbId=d(J),A.vfs=J.dbVfsName(),A},close:function(g){const w=L(g,!1),S={filename:w&&w.filename};if(w){const A=g.args&&typeof g.args=="object"?!!g.args.unlink:!1;b.close(w,A)}return S},exec:function(g){const w=typeof g.args=="string"?{sql:g.args}:g.args||Object.create(null);w.rowMode==="stmt"?l("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):w.sql||l("'exec' requires input SQL.");const S=L(g);(w.callback||Array.isArray(w.resultRows))&&(S._blobXfer=b.xfer);const A=w.callback;let q=0;const B=!!w.columnNames;typeof A=="string"&&(B||(w.columnNames=[]),w.callback=function(J,H){b.post({type:A,columnNames:w.columnNames,rowNumber:++q,row:J},b.xfer)});try{const J=w.countChanges?S.changes(!0,w.countChanges===64):void 0;S.exec(w),J!==void 0&&(w.changeCount=S.changes(!0,w.countChanges===64)-J),w.callback instanceof Function&&(w.callback=A,b.post({type:A,columnNames:w.columnNames,rowNumber:null,row:void 0}))}finally{delete S._blobXfer,w.callback&&(w.callback=A)}return w},"config-get":function(){const g=Object.create(null),w=a.config;return["bigIntEnabled"].forEach(function(S){Object.getOwnPropertyDescriptor(w,S)&&(g[S]=w[S])}),g.version=a.version,g.vfsList=a.capi.sqlite3_js_vfs_list(),g.opfsEnabled=!!a.opfs,g},export:function(g){const w=L(g),S={byteArray:a.capi.sqlite3_js_db_export(w.pointer),filename:w.filename,mimetype:"application/x-sqlite3"};return b.xfer.push(S.byteArray.buffer),S},toss:function(g){l("Testing worker exception")},"opfs-tree":async function(g){return a.opfs||l("OPFS support is unavailable."),await a.opfs.treeList()}};globalThis.onmessage=async function(g){g=g.data;let w,S=g.dbId,A=g.type;const q=performance.now();try{T.hasOwnProperty(A)&&T[A]instanceof Function?w=await T[A](g):l("Unknown db worker message type:",g.type)}catch(B){A="error",w={operation:g.type,message:B.message,errorClass:B.name,input:g},B.stack&&(w.stack=typeof B.stack=="string"?B.stack.split(/\n\s*/):B.stack)}S||(S=w.dbId||X()),b.post({type:A,dbId:S,messageId:g.messageId,workerReceivedTime:q,workerRespondTime:performance.now(),departureTime:g.departureTime,result:w},b.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({self,sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=i.wasm,a=i.capi,c=i.util.toss3,d=Object.create(null),b=Object.create(null),k=i.StructBinder;i.vfs=d,i.vtab=b;const L=a.sqlite3_index_info;L.prototype.nthConstraint=function(g,w=!1){if(g<0||g>=this.$nConstraint)return!1;const S=this.$aConstraint+L.sqlite3_index_constraint.structInfo.sizeof*g;return w?S:new L.sqlite3_index_constraint(S)},L.prototype.nthConstraintUsage=function(g,w=!1){if(g<0||g>=this.$nConstraint)return!1;const S=this.$aConstraintUsage+L.sqlite3_index_constraint_usage.structInfo.sizeof*g;return w?S:new L.sqlite3_index_constraint_usage(S)},L.prototype.nthOrderBy=function(g,w=!1){if(g<0||g>=this.$nOrderBy)return!1;const S=this.$aOrderBy+L.sqlite3_index_orderby.structInfo.sizeof*g;return w?S:new L.sqlite3_index_orderby(S)};const X=function g(w,S,A,q=g.installMethodArgcCheck){if(w instanceof k.StructType?!(A instanceof Function)&&!l.isPtr(A)&&c("Usage errror: expecting a Function or WASM pointer to one."):c("Usage error: target object is-not-a StructType."),arguments.length===1)return(U,ce)=>g(w,U,ce,q);g.argcProxy||(g.argcProxy=function(U,ce,m,N){return function(...O){return m.length!==arguments.length&&c("Argument mismatch for",U.structInfo.name+"::"+ce+": Native signature is:",N),m.apply(this,O)}},g.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((U,ce)=>{if(typeof U=="number")try{l.uninstallFunction(U)}catch{}}),delete this.ondispose.__removeFuncList)});const B=w.memberSignature(S);B.length<2&&c("Member",S,"does not have a function pointer signature:",B);const J=w.memberKey(S),H=q&&!l.isPtr(A)?g.argcProxy(w,J,A,B):A;if(l.isPtr(H))H&&!l.functionEntry(H)&&c("Pointer",H,"is not a WASM function table entry."),w[J]=H;else{const U=l.installFunction(H,w.memberSignature(S,!0));w[J]=U,(!w.ondispose||!w.ondispose.__removeFuncList)&&(w.addOnDispose("ondispose.__removeFuncList handler",g.removeFuncList),w.ondispose.__removeFuncList=[]),w.ondispose.__removeFuncList.push(J,U)}return(U,ce)=>g(w,U,ce,q)};X.installMethodArgcCheck=!1;const ee=function(g,w,S=X.installMethodArgcCheck){const A=new Map;for(const q of Object.keys(w)){const B=w[q],J=A.get(B);if(J){const H=g.memberKey(q);g[H]=g[g.memberKey(J)]}else X(g,q,B,S),A.set(B,q)}return g};k.StructType.prototype.installMethod=function(w,S,A=X.installMethodArgcCheck){return arguments.length<3&&w&&typeof w=="object"?ee(this,...arguments):X(this,...arguments)},k.StructType.prototype.installMethods=function(g,w=X.installMethodArgcCheck){return ee(this,g,w)},a.sqlite3_vfs.prototype.registerVfs=function(g=!1){this instanceof i.capi.sqlite3_vfs||c("Expecting a sqlite3_vfs-type argument.");const w=a.sqlite3_vfs_register(this,g?1:0);return w&&c("sqlite3_vfs_register(",this,") failed with rc",w),this.pointer!==a.sqlite3_vfs_find(this.$zName)&&c("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},d.installVfs=function(g){let w=0;const S=["io","vfs"];for(const A of S){const q=g[A];q&&(++w,ee(q.struct,q.methods,!!q.applyArgcCheck),A==="vfs"&&(!q.struct.$zName&&typeof q.name=="string"&&q.struct.addOnDispose(q.struct.$zName=l.allocCString(q.name)),q.struct.registerVfs(!!q.asDefault)))}return w||c("Misuse: installVfs() options object requires at least","one of:",S),this};const oe=function(g,w){return(function(S,A=!1){if(arguments.length===0&&(S=new w),S instanceof w)return this.set(S.pointer,S),S;l.isPtr(S)||i.SQLite3Error.toss("Invalid argument to",g+"()");let q=this.get(S);return A&&this.delete(S),q}).bind(new Map)},T=function(g,w){const S=oe(g,w);return Object.assign(Object.create(null),{StructType:w,create:A=>{const q=S();return l.pokePtr(A,q.pointer),q},get:A=>S(A),unget:A=>S(A,!0),dispose:A=>{const q=S(A,!0);q&&q.dispose()}})};b.xVtab=T("xVtab",a.sqlite3_vtab),b.xCursor=T("xCursor",a.sqlite3_vtab_cursor),b.xIndexInfo=g=>new a.sqlite3_index_info(g),b.xError=function g(w,S,A){if(g.errorReporter instanceof Function)try{g.errorReporter("sqlite3_module::"+w+"(): "+S.message)}catch{}let q;return S instanceof i.WasmAllocError?q=a.SQLITE_NOMEM:arguments.length>2?q=A:S instanceof i.SQLite3Error&&(q=S.resultCode),q||a.SQLITE_ERROR},b.xError.errorReporter=console.error.bind(console),b.xRowid=(g,w)=>l.poke(g,w,"i64"),b.setupModule=function(g){let w=!1;const S=this instanceof a.sqlite3_module?this:g.struct||(w=new a.sqlite3_module);try{const A=g.methods||c("Missing 'methods' object.");for(const q of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const B=q[0],J=q[1];A[B]===!0?A[B]=A[J]:A[J]===!0&&(A[J]=A[B])}if(g.catchExceptions){const q=function(H,U){return["xConnect","xCreate"].indexOf(H)>=0?function(ce,m,N,O,z,y){try{return U(...arguments)||0}catch(v){return v instanceof i.WasmAllocError||(l.dealloc(l.peekPtr(y)),l.pokePtr(y,l.allocCString(v.message))),b.xError(H,v)}}:function(...ce){try{return U(...ce)||0}catch(m){return b.xError(H,m)}}},B=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],J=Object.create(null);for(const H of B){const U=A[H];if(U instanceof Function)H==="xConnect"&&A.xCreate===U?J[H]=A.xCreate:H==="xCreate"&&A.xConnect===U?J[H]=A.xConnect:J[H]=q(H,U);else continue}ee(S,J,!1)}else ee(S,A,!!g.applyArgcCheck);if(S.$iVersion===0){let q;typeof g.iVersion=="number"?q=g.iVersion:S.$xShadowName?q=3:S.$xSavePoint||S.$xRelease||S.$xRollbackTo?q=2:q=1,S.$iVersion=q}}catch(A){throw w&&w.dispose(),A}return S},a.sqlite3_module.prototype.setupModule=function(g){return b.setupModule.call(this,g)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=function a(c){var k;if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((k=navigator==null?void 0:navigator.storage)!=null&&k.getDirectory))return Promise.reject(new Error("Missing required OPFS APIs."));(!c||typeof c!="object")&&(c=Object.create(null));const d=new URL(globalThis.location.href).searchParams;return d.has("opfs-disable")?Promise.resolve(i):(c.verbose===void 0&&(c.verbose=d.has("opfs-verbose")?+d.get("opfs-verbose")||2:1),c.sanityChecks===void 0&&(c.sanityChecks=d.has("opfs-sanity-check")),c.proxyUri===void 0&&(c.proxyUri=a.defaultProxyUri),typeof c.proxyUri=="function"&&(c.proxyUri=c.proxyUri()),new Promise(function(L,X){const ee=[i.config.error,i.config.warn,i.config.log],oe=(C,...j)=>{c.verbose>C&&ee[C]("OPFS syncer:",...j)},T=(...C)=>oe(2,...C),g=(...C)=>oe(1,...C),w=(...C)=>oe(0,...C),S=i.util.toss,A=i.capi,q=i.wasm,B=A.sqlite3_vfs,J=A.sqlite3_file,H=A.sqlite3_io_methods,U=Object.create(null),ce=()=>{var C;return globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&((C=navigator==null?void 0:navigator.storage)==null?void 0:C.getDirectory)};U.metrics={dump:function(){let C,j=0,V=0,ne=0;for(C in _.opIds){const Z=F[C];j+=Z.count,V+=Z.time,ne+=Z.wait,Z.avgTime=Z.count&&Z.time?Z.time/Z.count:0,Z.avgWait=Z.count&&Z.wait?Z.wait/Z.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",F,`
Total of`,j,"op(s) for",V,"ms (incl. "+ne+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",F.s11n),v.postMessage({type:"opfs-async-metrics"})},reset:function(){let C;const j=ne=>ne.count=ne.time=ne.wait=0;for(C in _.opIds)j(F[C]=Object.create(null));let V=F.s11n=Object.create(null);V=V.serialize=Object.create(null),V.count=V.time=0,V=F.s11n.deserialize=Object.create(null),V.count=V.time=0}};const m=new H,N=new B().addOnDispose(()=>m.dispose());let O;const z=C=>(O=!0,N.dispose(),X(C)),y=()=>(O=!1,L(i)),v=new Worker(new URL(""+new URL("sqlite3-opfs-async-proxy-5de694f2.js",self.location.href).href,self.location));setTimeout(()=>{O===void 0&&z(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),v._originalOnError=v.onerror,v.onerror=function(C){w("Error initializing OPFS asyncer:",C),z(new Error("Loading OPFS async Worker failed for unknown reasons."))};const f=A.sqlite3_vfs_find(null),p=f?new B(f):null;m.$iVersion=1,N.$iVersion=2,N.$szOsFile=A.sqlite3_file.structInfo.sizeof,N.$mxPathname=1024,N.$zName=q.allocCString("opfs"),N.$xDlOpen=N.$xDlError=N.$xDlSym=N.$xDlClose=null,N.addOnDispose("$zName",N.$zName,"cleanup default VFS wrapper",()=>p?p.dispose():null);const _=Object.create(null);_.verbose=c.verbose,_.littleEndian=(()=>{const C=new ArrayBuffer(2);return new DataView(C).setInt16(0,256,!0),new Int16Array(C)[0]===256})(),_.asyncIdleWaitTime=150,_.asyncS11nExceptions=1,_.fileBufferSize=1024*64,_.sabS11nOffset=_.fileBufferSize,_.sabS11nSize=N.$mxPathname*2,_.sabIO=new SharedArrayBuffer(_.fileBufferSize+_.sabS11nSize),_.opIds=Object.create(null);const F=Object.create(null);{let C=0;_.opIds.whichOp=C++,_.opIds.rc=C++,_.opIds.xAccess=C++,_.opIds.xClose=C++,_.opIds.xDelete=C++,_.opIds.xDeleteNoWait=C++,_.opIds.xFileSize=C++,_.opIds.xLock=C++,_.opIds.xOpen=C++,_.opIds.xRead=C++,_.opIds.xSleep=C++,_.opIds.xSync=C++,_.opIds.xTruncate=C++,_.opIds.xUnlock=C++,_.opIds.xWrite=C++,_.opIds.mkdir=C++,_.opIds["opfs-async-metrics"]=C++,_.opIds["opfs-async-shutdown"]=C++,_.opIds.retry=C++,_.sabOP=new SharedArrayBuffer(C*4),U.metrics.reset()}_.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(C=>{(_.sq3Codes[C]=A[C])===void 0&&S("Maintenance required: not found:",C)}),_.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,defaultUnlockAsap:!1});const G=(C,...j)=>{const V=_.opIds[C]||S("Invalid op ID:",C);_.s11n.serialize(...j),Atomics.store(_.sabOPView,_.opIds.rc,-1),Atomics.store(_.sabOPView,_.opIds.whichOp,V),Atomics.notify(_.sabOPView,_.opIds.whichOp);const ne=performance.now();Atomics.wait(_.sabOPView,_.opIds.rc,-1);const Z=Atomics.load(_.sabOPView,_.opIds.rc);if(F[C].wait+=performance.now()-ne,Z&&_.asyncS11nExceptions){const Ae=_.s11n.deserialize();Ae&&w(C+"() async error:",...Ae)}return Z};U.debug={asyncShutdown:()=>{g("Shutting down OPFS async listener. The OPFS VFS will no longer work."),G("opfs-async-shutdown")},asyncRestart:()=>{g("Attempting to restart OPFS VFS async listener. Might work, might not."),v.postMessage({type:"opfs-async-restart"})}};const re=()=>{if(_.s11n)return _.s11n;const C=new TextDecoder,j=new TextEncoder("utf-8"),V=new Uint8Array(_.sabIO,_.sabS11nOffset,_.sabS11nSize),ne=new DataView(_.sabIO,_.sabS11nOffset,_.sabS11nSize);_.s11n=Object.create(null);const Z=Object.create(null);Z.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Z.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Z.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Z.string={id:4};const Ae=M=>Z[typeof M]||S("Maintenance required: this value type cannot be serialized.",M),le=M=>{switch(M){case Z.number.id:return Z.number;case Z.bigint.id:return Z.bigint;case Z.boolean.id:return Z.boolean;case Z.string.id:return Z.string;default:S("Invalid type ID:",M)}};return _.s11n.deserialize=function(M=!1){++F.s11n.deserialize.count;const I=performance.now(),W=V[0],E=W?[]:null;if(W){const P=[];let D=1,$,fe,be;for($=0;$<W;++$,++D)P.push(le(V[D]));for($=0;$<W;++$){const ke=P[$];ke.getter?(be=ne[ke.getter](D,_.littleEndian),D+=ke.size):(fe=ne.getInt32(D,_.littleEndian),D+=4,be=C.decode(V.slice(D,D+fe)),D+=fe),E.push(be)}}return M&&(V[0]=0),F.s11n.deserialize.time+=performance.now()-I,E},_.s11n.serialize=function(...M){const I=performance.now();if(++F.s11n.serialize.count,M.length){const W=[];let E=0,P=1;for(V[0]=M.length&255;E<M.length;++E,++P)W.push(Ae(M[E])),V[P]=W[E].id;for(E=0;E<M.length;++E){const D=W[E];if(D.setter)ne[D.setter](P,M[E],_.littleEndian),P+=D.size;else{const $=j.encode(M[E]);ne.setInt32(P,$.byteLength,_.littleEndian),P+=4,V.set($,P),P+=$.byteLength}}}else V[0]=0;F.s11n.serialize.time+=performance.now()-I},_.s11n},ae=function C(j=16){C._chars||(C._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",C._n=C._chars.length);const V=[];let ne=0;for(;ne<j;++ne){const Z=Math.random()*(C._n*64)%C._n|0;V[ne]=C._chars[Z]}return V.join("")},ie=Object.create(null),ue=Object.create(null);ue.op=void 0,ue.start=void 0;const de=C=>{ue.start=performance.now(),ue.op=C,++F[C].count},ye=()=>F[ue.op].time+=performance.now()-ue.start,Ee={xCheckReservedLock:function(C,j){const V=ie[C];return q.poke(j,V.lockType?1:0,"i32"),0},xClose:function(C){de("xClose");let j=0;const V=ie[C];return V&&(delete ie[C],j=G("xClose",C),V.sq3File&&V.sq3File.dispose()),ye(),j},xDeviceCharacteristics:function(C){return A.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(C,j,V){return A.SQLITE_NOTFOUND},xFileSize:function(C,j){de("xFileSize");let V=G("xFileSize",C);if(V==0)try{const ne=_.s11n.deserialize()[0];q.poke(j,ne,"i64")}catch(ne){w("Unexpected error reading xFileSize() result:",ne),V=_.sq3Codes.SQLITE_IOERR}return ye(),V},xLock:function(C,j){de("xLock");const V=ie[C];let ne=0;return V.lockType?V.lockType=j:(ne=G("xLock",C,j),ne===0&&(V.lockType=j)),ye(),ne},xRead:function(C,j,V,ne){de("xRead");const Z=ie[C];let Ae;try{Ae=G("xRead",C,V,Number(ne)),(Ae===0||A.SQLITE_IOERR_SHORT_READ===Ae)&&q.heap8u().set(Z.sabView.subarray(0,V),j)}catch(le){w("xRead(",arguments,") failed:",le,Z),Ae=A.SQLITE_IOERR_READ}return ye(),Ae},xSync:function(C,j){de("xSync"),++F.xSync.count;const V=G("xSync",C,j);return ye(),V},xTruncate:function(C,j){de("xTruncate");const V=G("xTruncate",C,Number(j));return ye(),V},xUnlock:function(C,j){de("xUnlock");const V=ie[C];let ne=0;return A.SQLITE_LOCK_NONE===j&&V.lockType&&(ne=G("xUnlock",C,j)),ne===0&&(V.lockType=j),ye(),ne},xWrite:function(C,j,V,ne){de("xWrite");const Z=ie[C];let Ae;try{Z.sabView.set(q.heap8u().subarray(j,j+V)),Ae=G("xWrite",C,V,Number(ne))}catch(le){w("xWrite(",arguments,") failed:",le,Z),Ae=A.SQLITE_IOERR_WRITE}return ye(),Ae}},Be={xAccess:function(C,j,V,ne){de("xAccess");const Z=G("xAccess",q.cstrToJs(j));return q.poke(ne,Z?0:1,"i32"),ye(),0},xCurrentTime:function(C,j){return q.poke(j,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(C,j){return q.poke(j,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(C,j,V){de("xDelete");const ne=G("xDelete",q.cstrToJs(j),V,!1);return ye(),ne},xFullPathname:function(C,j,V,ne){return q.cstrncpy(ne,j,V)<V?0:A.SQLITE_CANTOPEN},xGetLastError:function(C,j,V){return g("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(j,V,ne,Z,Ae){de("xOpen");let le=0;V===0?V=ae():typeof V=="number"&&(A.sqlite3_uri_boolean(V,"opfs-unlock-asap",0)&&(le|=_.opfsFlags.OPFS_UNLOCK_ASAP),V=q.cstrToJs(V));const M=Object.create(null);M.fid=ne,M.filename=V,M.sab=new SharedArrayBuffer(_.fileBufferSize),M.flags=Z;const I=G("xOpen",ne,V,Z,le);return I||(M.readOnly&&q.poke(Ae,A.SQLITE_OPEN_READONLY,"i32"),ie[ne]=M,M.sabView=_.sabFileBufView,M.sq3File=new J(ne),M.sq3File.$pMethods=m.pointer,M.lockType=A.SQLITE_LOCK_NONE),ye(),I}};if(p&&(N.$xRandomness=p.$xRandomness,N.$xSleep=p.$xSleep),N.$xRandomness||(Be.xRandomness=function(C,j,V){const ne=q.heap8u();let Z=0;for(;Z<j;++Z)ne[V+Z]=Math.random()*255e3&255;return Z}),N.$xSleep||(Be.xSleep=function(C,j){return Atomics.wait(_.sabOPView,_.opIds.xSleep,0,j),0}),U.getResolvedPath=function(C,j){const V=new URL(C,"file://irrelevant").pathname;return j?V.split("/").filter(ne=>!!ne):V},U.getDirForFilename=async function(j,V=!1){const ne=U.getResolvedPath(j,!0),Z=ne.pop();let Ae=U.rootDirectory;for(const le of ne)le&&(Ae=await Ae.getDirectoryHandle(le,{create:!!V}));return[Ae,Z]},U.mkdir=async function(C){try{return await U.getDirForFilename(C+"/filepart",!0),!0}catch{return!1}},U.entryExists=async function(C){try{const[j,V]=await U.getDirForFilename(C);return await j.getFileHandle(V),!0}catch{return!1}},U.randomFilename=ae,U.registerVfs=(C=!1)=>q.exports.sqlite3_vfs_register(N.pointer,C?1:0),U.treeList=async function(){const C=async function V(ne,Z){Z.name=ne.name,Z.dirs=[],Z.files=[];for await(const Ae of ne.values())if(Ae.kind==="directory"){const le=Object.create(null);Z.dirs.push(le),await V(Ae,le)}else Z.files.push(Ae.name)},j=Object.create(null);return await C(U.rootDirectory,j),j},U.rmfr=async function(){const C=U.rootDirectory,j={recurse:!0};for await(const V of C.values())C.removeEntry(V.name,j)},U.unlink=async function(C,j=!1,V=!1){try{const[ne,Z]=await U.getDirForFilename(C,!1);return await ne.removeEntry(Z,{recursive:j}),!0}catch(ne){if(V)throw new Error("unlink(",arguments[0],") failed: "+ne.message,{cause:ne});return!1}},U.traverse=async function(C){const j={recursive:!0,directory:U.rootDirectory};typeof C=="function"&&(C={callback:C}),C=Object.assign(j,C||{}),async function ne(Z,Ae){for await(const le of Z.values()){if(C.callback(le,Z,Ae)===!1)return!1;if(C.recursive&&le.kind==="directory"&&await ne(le,Ae+1)===!1)break}}(C.directory,0)},U.importDb=async function(C,j){j instanceof ArrayBuffer&&(j=new Uint8Array(j));const V=j.byteLength;(V<512||V%512!=0)&&S("Byte array size is invalid for an SQLite db.");const ne="SQLite format 3";for(let W=0;W<ne.length;++W)ne.charCodeAt(W)!==j[W]&&S("Input does not contain an SQLite database header.");const[Z,Ae]=await U.getDirForFilename(C,!0),M=await(await Z.getFileHandle(Ae,{create:!0})).createSyncAccessHandle();M.truncate(0);const I=M.write(j,{at:0});return M.close(),I!=V&&S("Expected to write "+V+" bytes but wrote "+I+"."),I},i.oo1){const C=function(...j){const V=i.oo1.DB.dbCtorHelper.normalizeArgs(...j);V.vfs=N.$zName,i.oo1.DB.dbCtorHelper.call(this,V)};C.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=C,C.importDb=U.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenSql(N.pointer,function(j,V){V.capi.sqlite3_busy_timeout(j,1e4),V.capi.sqlite3_exec(j,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}const _t=function(){const C=q.scopedAllocPush(),j=new J;try{const V=j.pointer,ne=A.SQLITE_OPEN_CREATE|A.SQLITE_OPEN_READWRITE|A.SQLITE_OPEN_MAIN_DB,Z=q.scopedAlloc(8),Ae="/sanity/check/file"+ae(8),le=q.scopedAllocCString(Ae);let M;if(_.s11n.serialize("This is ä string."),M=_.s11n.deserialize(),T("deserialize() says:",M),M[0]!=="This is ä string."&&S("String d13n error."),Be.xAccess(N.pointer,le,0,Z),M=q.peek(Z,"i32"),T("xAccess(",Ae,") exists ?=",M),M=Be.xOpen(N.pointer,le,V,ne,Z),T("open rc =",M,"state.sabOPView[xOpen] =",_.sabOPView[_.opIds.xOpen]),M!==0){w("open failed with code",M);return}Be.xAccess(N.pointer,le,0,Z),M=q.peek(Z,"i32"),M||S("xAccess() failed to detect file."),M=Ee.xSync(j.pointer,0),M&&S("sync failed w/ rc",M),M=Ee.xTruncate(j.pointer,1024),M&&S("truncate failed w/ rc",M),q.poke(Z,0,"i64"),M=Ee.xFileSize(j.pointer,Z),M&&S("xFileSize failed w/ rc",M),T("xFileSize says:",q.peek(Z,"i64")),M=Ee.xWrite(j.pointer,le,10,1),M&&S("xWrite() failed!");const I=q.scopedAlloc(16);M=Ee.xRead(j.pointer,I,6,2),q.poke(I+6,0);let W=q.cstrToJs(I);T("xRead() got:",W),W!=="sanity"&&S("Unexpected xRead() value."),Be.xSleep&&(T("xSleep()ing before close()ing..."),Be.xSleep(N.pointer,2e3),T("waking up from xSleep()")),M=Ee.xClose(V),T("xClose rc =",M,"sabOPView =",_.sabOPView),T("Deleting file:",Ae),Be.xDelete(N.pointer,le,4660),Be.xAccess(N.pointer,le,0,Z),M=q.peek(Z,"i32"),M&&S("Expecting 0 from xAccess(",Ae,") after xDelete()."),g("End of OPFS sanity checks.")}finally{j.dispose(),q.scopedAllocPop(C)}};v.onmessage=function({data:C}){switch(C.type){case"opfs-unavailable":z(new Error(C.payload.join(" ")));break;case"opfs-async-loaded":v.postMessage({type:"opfs-async-init",args:_});break;case"opfs-async-inited":{if(O===!0)break;try{i.vfs.installVfs({io:{struct:m,methods:Ee},vfs:{struct:N,methods:Be}}),_.sabOPView=new Int32Array(_.sabOP),_.sabFileBufView=new Uint8Array(_.sabIO,0,_.fileBufferSize),_.sabS11nView=new Uint8Array(_.sabIO,_.sabS11nOffset,_.sabS11nSize),re(),c.sanityChecks&&(g("Running sanity checks because of opfs-sanity-check URL arg..."),_t()),ce()?navigator.storage.getDirectory().then(j=>{v.onerror=v._originalOnError,delete v._originalOnError,i.opfs=U,U.rootDirectory=j,T("End of OPFS sqlite3_vfs setup.",N),y()}).catch(z):y()}catch(j){w(j),z(j)}break}default:{const j="Unexpected message from the OPFS async worker: "+JSON.stringify(C);w(j),z(new Error(j));break}}}}))};l.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async a=>{try{let c=l.defaultProxyUri;return a.scriptInfo.sqlite3Dir&&(l.defaultProxyUri=a.scriptInfo.sqlite3Dir+c),l().catch(d=>{a.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",d.message)})}catch(c){return a.config.error("installOpfsVfs() exception:",c),Promise.reject(c)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){var ie,ue,de,ye,Ee,Be,_t,C,j,V,ne,Z,$s,le;const l=i.util.toss,a=i.util.toss3,c=Object.create(null),d=i.capi,b=i.wasm,k=4096,L=512,X=4,ee=8,oe=L+X,T=L,g=oe,w=k,S=d.SQLITE_OPEN_MAIN_DB|d.SQLITE_OPEN_MAIN_JOURNAL|d.SQLITE_OPEN_SUPER_JOURNAL|d.SQLITE_OPEN_WAL,A=".opaque",q=()=>Math.random().toString(36).slice(2),B=new TextDecoder,J=new TextEncoder,H=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),U=[i.config.error,i.config.warn,i.config.log];i.config.log;const ce=i.config.warn;i.config.error;const m=new Map,N=M=>m.get(M),O=(M,I)=>{I?m.set(M,I):m.delete(M)},z=new Map,y=M=>z.get(M),v=(M,I)=>{I?z.set(M,I):z.delete(M)},f={xCheckReservedLock:function(M,I){const W=y(M);return W.log("xCheckReservedLock"),W.storeErr(),b.poke32(I,1),0},xClose:function(M){const I=y(M);I.storeErr();const W=I.getOFileForS3File(M);if(W)try{I.log(`xClose ${W.path}`),I.mapS3FileToOFile(M,!1),W.sah.flush(),W.flags&d.SQLITE_OPEN_DELETEONCLOSE&&I.deletePath(W.path)}catch(E){return I.storeErr(E),d.SQLITE_IOERR}return 0},xDeviceCharacteristics:function(M){return d.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(M,I,W){return d.SQLITE_NOTFOUND},xFileSize:function(M,I){const W=y(M);W.log("xFileSize");const P=W.getOFileForS3File(M).sah.getSize()-w;return b.poke64(I,BigInt(P)),0},xLock:function(M,I){const W=y(M);W.log(`xLock ${I}`),W.storeErr();const E=W.getOFileForS3File(M);return E.lockType=I,0},xRead:function(M,I,W,E){const P=y(M);P.storeErr();const D=P.getOFileForS3File(M);P.log(`xRead ${D.path} ${W} @ ${E}`);try{const $=D.sah.read(b.heap8u().subarray(I,I+W),{at:w+Number(E)});return $<W?(b.heap8u().fill(0,I+$,I+W),d.SQLITE_IOERR_SHORT_READ):0}catch($){return P.storeErr($),d.SQLITE_IOERR}},xSectorSize:function(M){return k},xSync:function(M,I){const W=y(M);W.log(`xSync ${I}`),W.storeErr();const E=W.getOFileForS3File(M);try{return E.sah.flush(),0}catch(P){return W.storeErr(P),d.SQLITE_IOERR}},xTruncate:function(M,I){const W=y(M);W.log(`xTruncate ${I}`),W.storeErr();const E=W.getOFileForS3File(M);try{return E.sah.truncate(w+Number(I)),0}catch(P){return W.storeErr(P),d.SQLITE_IOERR}},xUnlock:function(M,I){const W=y(M);W.log("xUnlock");const E=W.getOFileForS3File(M);return E.lockType=I,0},xWrite:function(M,I,W,E){const P=y(M);P.storeErr();const D=P.getOFileForS3File(M);P.log(`xWrite ${D.path} ${W} ${E}`);try{return D.sah.write(b.heap8u().subarray(I,I+W),{at:w+Number(E)})===W?0:d.SQLITE_IOERR}catch($){return P.storeErr($),d.SQLITE_IOERR}}},p=new d.sqlite3_io_methods;p.$iVersion=1,i.vfs.installVfs({io:{struct:p,methods:f}});const _={xAccess:function(M,I,W,E){const P=N(M);P.storeErr();try{const D=P.getPath(I);b.poke32(E,P.hasFilename(D)?1:0)}catch{b.poke32(E,0)}return 0},xCurrentTime:function(M,I){return b.poke(I,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(M,I){return b.poke(I,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(M,I,W){const E=N(M);E.log(`xDelete ${b.cstrToJs(I)}`),E.storeErr();try{return E.deletePath(E.getPath(I)),0}catch(P){return E.storeErr(P),d.SQLITE_IOERR_DELETE}},xFullPathname:function(M,I,W,E){return b.cstrncpy(E,I,W)<W?0:d.SQLITE_CANTOPEN},xGetLastError:function(M,I,W){const E=N(M);E.log(`xGetLastError ${I}`);const P=E.popErr();if(P){const D=b.scopedAllocPush();try{const[$,fe]=b.scopedAllocCString(P.message,!0);b.cstrncpy(W,$,I),fe>I&&b.poke8(W+I-1,0)}catch{return d.SQLITE_NOMEM}finally{b.scopedAllocPop(D)}}return 0},xOpen:function(I,W,E,P,D){const $=N(I);try{$.log(`xOpen ${b.cstrToJs(W)} ${P}`);const fe=W&&b.peek8(W)?$.getPath(W):q();let be=$.getSAHForPath(fe);!be&&P&d.SQLITE_OPEN_CREATE&&($.getFileCount()<$.getCapacity()?(be=$.nextAvailableSAH(),$.setAssociatedPath(be,fe,P)):l("SAH pool is full. Cannot create file",fe)),be||l("file not found:",fe);const ke={path:fe,flags:P,sah:be};$.mapS3FileToOFile(E,ke),ke.lockType=d.SQLITE_LOCK_NONE;const Ve=new d.sqlite3_file(E);return Ve.$pMethods=p.pointer,Ve.dispose(),b.poke32(D,P),0}catch(fe){return $.storeErr(fe),d.SQLITE_CANTOPEN}}},F=function(M){i.capi.sqlite3_vfs_find(M)&&a("VFS name is already registered:",M);const I=new d.sqlite3_vfs,W=d.sqlite3_vfs_find(null),E=W?new d.sqlite3_vfs(W):null;return I.$iVersion=2,I.$szOsFile=d.sqlite3_file.structInfo.sizeof,I.$mxPathname=L,I.addOnDispose(I.$zName=b.allocCString(M),()=>O(I.pointer,0)),E&&(I.$xRandomness=E.$xRandomness,I.$xSleep=E.$xSleep,E.dispose()),!I.$xRandomness&&!_.xRandomness&&(_.xRandomness=function(P,D,$){const fe=b.heap8u();let be=0;for(;be<D;++be)fe[$+be]=Math.random()*255e3&255;return be}),!I.$xSleep&&!_.xSleep&&(_.xSleep=(P,D)=>0),i.vfs.installVfs({vfs:{struct:I,methods:_}}),I};class G{constructor(I=Object.create(null)){Q(this,Z);De(this,"vfsDir");Q(this,ie,void 0);Q(this,ue,void 0);Q(this,de,void 0);Q(this,ye,new Map);Q(this,Ee,new Map);Q(this,Be,new Set);Q(this,_t,new Map);Q(this,C,new Uint8Array(oe));Q(this,j,void 0);Q(this,V,void 0);Q(this,ne,void 0);K(this,ne,I.verbosity??H.verbosity),this.vfsName=I.name||H.name,K(this,V,F(this.vfsName)),O(s(this,V).pointer,this),this.vfsDir=I.directory||"."+this.vfsName,K(this,j,new DataView(s(this,C).buffer,s(this,C).byteOffset)),this.isReady=this.reset(!!(I.clearOnInit??H.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(I.initialCapacity||H.initialCapacity)})}log(...I){Pe(this,Z,$s).call(this,2,...I)}warn(...I){Pe(this,Z,$s).call(this,1,...I)}error(...I){Pe(this,Z,$s).call(this,0,...I)}getVfs(){return s(this,V)}getCapacity(){return s(this,ye).size}getFileCount(){return s(this,Ee).size}getFileNames(){const I=[],W=s(this,Ee).keys();for(const E of W)I.push(E);return I}async addCapacity(I){for(let W=0;W<I;++W){const E=q(),D=await(await s(this,ue).getFileHandle(E,{create:!0})).createSyncAccessHandle();s(this,ye).set(D,E),this.setAssociatedPath(D,"",0)}return this.getCapacity()}async reduceCapacity(I){let W=0;for(const E of Array.from(s(this,Be))){if(W===I||this.getFileCount()===this.getCapacity())break;const P=s(this,ye).get(E);E.close(),await s(this,ue).removeEntry(P),s(this,ye).delete(E),s(this,Be).delete(E),++W}return W}releaseAccessHandles(){for(const I of s(this,ye).keys())I.close();s(this,ye).clear(),s(this,Ee).clear(),s(this,Be).clear()}async acquireAccessHandles(I){const W=[];for await(const[E,P]of s(this,ue))P.kind==="file"&&W.push([E,P]);return Promise.all(W.map(async([E,P])=>{try{const D=await P.createSyncAccessHandle();if(s(this,ye).set(D,E),I)D.truncate(w),this.setAssociatedPath(D,"",0);else{const $=this.getAssociatedPath(D);$?s(this,Ee).set($,D):s(this,Be).add(D)}}catch(D){throw this.storeErr(D),this.releaseAccessHandles(),D}}))}getAssociatedPath(I){I.read(s(this,C),{at:0});const W=s(this,j).getUint32(T);if(s(this,C)[0]&&(W&d.SQLITE_OPEN_DELETEONCLOSE||!(W&S)))return ce(`Removing file with unexpected flags ${W.toString(16)}`,s(this,C)),this.setAssociatedPath(I,"",0),"";const E=new Uint32Array(ee/4);I.read(E,{at:g});const P=this.computeDigest(s(this,C));if(E.every((D,$)=>D===P[$])){const D=s(this,C).findIndex($=>$===0);return D===0&&I.truncate(w),D?B.decode(s(this,C).subarray(0,D)):""}else return ce("Disassociating file with bad digest."),this.setAssociatedPath(I,"",0),""}setAssociatedPath(I,W,E){const P=J.encodeInto(W,s(this,C));L<=P.written+1&&l("Path too long:",W),s(this,C).fill(0,P.written,L),s(this,j).setUint32(T,E);const D=this.computeDigest(s(this,C));I.write(s(this,C),{at:0}),I.write(D,{at:g}),I.flush(),W?(s(this,Ee).set(W,I),s(this,Be).delete(I)):(I.truncate(w),s(this,Be).add(I))}computeDigest(I){let W=3735928559,E=1103547991;for(const P of I)W=31*W+P*307,E=31*E+P*307;return new Uint32Array([W>>>0,E>>>0])}async reset(I){await this.isReady;let W=await navigator.storage.getDirectory(),E;for(const P of this.vfsDir.split("/"))P&&(E=W,W=await W.getDirectoryHandle(P,{create:!0}));return K(this,ie,W),K(this,de,E),K(this,ue,await s(this,ie).getDirectoryHandle(A,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(I)}getPath(I){return b.isPtr(I)&&(I=b.cstrToJs(I)),(I instanceof URL?I:new URL(I,"file://localhost/")).pathname}deletePath(I){const W=s(this,Ee).get(I);return W&&(s(this,Ee).delete(I),this.setAssociatedPath(W,"",0)),!!W}storeErr(I){return I&&this.error(I),this.$error=I}popErr(){const I=this.$error;return this.$error=void 0,I}nextAvailableSAH(){const[I]=s(this,Be).keys();return I}getOFileForS3File(I){return s(this,_t).get(I)}mapS3FileToOFile(I,W){W?(s(this,_t).set(I,W),v(I,this)):(s(this,_t).delete(I),v(I,!1))}hasFilename(I){return s(this,Ee).has(I)}getSAHForPath(I){return s(this,Ee).get(I)}async removeVfs(){if(!s(this,V).pointer||!s(this,ue))return!1;d.sqlite3_vfs_unregister(s(this,V).pointer),s(this,V).dispose();try{this.releaseAccessHandles(),await s(this,ie).removeEntry(A,{recursive:!0}),K(this,ue,void 0),await s(this,de).removeEntry(s(this,ie).name,{recursive:!0}),K(this,ie,K(this,de,void 0))}catch(I){i.config.error(this.vfsName,"removeVfs() failed:",I)}return!0}exportFile(I){const W=s(this,Ee).get(I)||l("File not found:",I),E=W.getSize()-w,P=new Uint8Array(E>0?E:0);if(E>0){const D=W.read(P,{at:w});D!=E&&l("Expected to read "+E+" bytes but read "+D+".")}return P}importDb(I,W){W instanceof ArrayBuffer&&(W=new Uint8Array(W));const E=W.byteLength;(E<512||E%512!=0)&&l("Byte array size is invalid for an SQLite db.");const P="SQLite format 3";for(let fe=0;fe<P.length;++fe)P.charCodeAt(fe)!==W[fe]&&l("Input does not contain an SQLite database header.");const D=s(this,Ee).get(I)||this.nextAvailableSAH()||l("No available handles to import to."),$=D.write(W,{at:w});$!=E?(this.setAssociatedPath(D,"",0),l("Expected to write "+E+" bytes but wrote "+$+".")):this.setAssociatedPath(D,I,d.SQLITE_OPEN_MAIN_DB)}}ie=new WeakMap,ue=new WeakMap,de=new WeakMap,ye=new WeakMap,Ee=new WeakMap,Be=new WeakMap,_t=new WeakMap,C=new WeakMap,j=new WeakMap,V=new WeakMap,ne=new WeakMap,Z=new WeakSet,$s=function(I,...W){s(this,ne)>I&&U[I](this.vfsName+":",...W)};class re{constructor(I){Q(this,le,void 0);K(this,le,I),this.vfsName=I.vfsName}async addCapacity(I){return s(this,le).addCapacity(I)}async reduceCapacity(I){return s(this,le).reduceCapacity(I)}getCapacity(){return s(this,le).getCapacity(s(this,le))}getFileCount(){return s(this,le).getFileCount()}getFileNames(){return s(this,le).getFileNames()}async reserveMinimumCapacity(I){const W=s(this,le).getCapacity();return W<I?s(this,le).addCapacity(I-W):W}exportFile(I){return s(this,le).exportFile(I)}importDb(I,W){return s(this,le).importDb(I,W)}async wipeFiles(){return s(this,le).reset(!0)}unlink(I){return s(this,le).deletePath(I)}async removeVfs(){return s(this,le).removeVfs()}}le=new WeakMap;const ae=async()=>{const M=await navigator.storage.getDirectory(),I=".opfs-sahpool-sync-check-"+q(),P=(await(await M.getFileHandle(I,{create:!0})).createSyncAccessHandle()).close();return await P,await M.removeEntry(I),P!=null&&P.then&&l("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(M=Object.create(null)){var W;const I=M.name||H.name;return c[I]?c[I]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((W=navigator==null?void 0:navigator.storage)!=null&&W.getDirectory)?c[I]=Promise.reject(new Error("Missing required OPFS APIs.")):c[I]=ae().then(async function(){if(M.$testThrowInInit)throw M.$testThrowInInit;const E=new G(M);return E.isReady.then(async()=>{const P=new re(E);if(i.oo1){const D=i.oo1,$=E.getVfs(),fe=function(...be){const ke=D.DB.dbCtorHelper.normalizeArgs(...be);ke.vfs=$.$zName,D.DB.dbCtorHelper.call(this,ke)};fe.prototype=Object.create(D.DB.prototype),P.OpfsSAHPoolDb=fe,D.DB.dbCtorHelper.setVfsPostOpenSql($.pointer,function(be,ke){ke.capi.sqlite3_exec(be,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return E.log("VFS initialized."),P}).catch(async P=>(await E.removeVfs().catch(()=>{}),P))}).catch(E=>c[I]=Promise.reject(E))}}),typeof o<"u"){const i=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?o.asm:wasmExports,memory:o.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=i;let l;try{l=globalThis.sqlite3ApiBootstrap()}catch(a){throw console.error("sqlite3ApiBootstrap() error:",a),a}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}o.sqlite3=l}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),r.ready}})();xo=function(){var r,n;const t=xo;if(!t)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:(r=globalThis==null?void 0:globalThis.document)==null?void 0:r.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:(n=globalThis==null?void 0:globalThis.location)!=null&&n.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...x)=>console.warn("sqlite3.debugModule:",...x):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const x=e.moduleScript.src.split("/");x.pop(),e.sqlite3Dir=x.join("/")+"/"}if(globalThis.sqlite3InitModule=function x(...R){return t(...R).then(te=>{const pe=te.sqlite3;pe.scriptInfo=e,x.__isUnderTest&&(pe.__isUnderTest=!0);const Oe=pe.asyncPostInit;return delete pe.asyncPostInit,Oe()}).catch(te=>{throw console.error("Exception loading sqlite3 module:",te),te})},globalThis.sqlite3InitModule.ready=t.ready,globalThis.sqlite3InitModuleState.moduleScript){const x=globalThis.sqlite3InitModuleState;let R=x.moduleScript.src.split("/");R.pop(),x.scriptDir=R.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();var gu=xo;/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wu(t){return t.constructor.name==="MessagePort"}function bu(t){wu(t)&&t.close()}function qu(t){return Nu(t,{type:"RELEASE"}).then(()=>{bu(t)})}const Ga=new WeakMap;"FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Ga.get(t)||0)-1;Ga.set(t,e),e===0&&qu(t)});function Nu(t,e,r){return new Promise(n=>{const x=vu();t.addEventListener("message",function R(te){!te.data||!te.data.id||te.data.id!==x||(t.removeEventListener("message",R),n(te.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:x},e),r)})}function vu(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Ka=t=>t==null||typeof t=="bigint"||typeof t=="string"||typeof t=="number"||typeof t=="object"&&"buffer"in t?t:typeof t=="boolean"?`${t}`:t instanceof Date?t.toISOString():JSON.stringify(t),xu=t=>{if(t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t)return t;if(typeof t=="string"){const e=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/;if(/^(true|false)$/.test(t))return t==="true";if(e.test(t))return new Date(t);try{return JSON.parse(t,(r,n)=>typeof n=="string"&&e.exec(n)?new Date(n):n)}catch{}}return t},Eu=class extends uo{constructor(e){super();De(this,"serializer");this.serializer=e||Ka}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:n,...x}=r,R=this.serializer(n);return n===R?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...x,value:R}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Su=class{constructor({selectOrRawOnly:t,deserializer:e,serializer:r}={}){De(this,"serializeParametersTransformer");De(this,"deserializer");De(this,"only");De(this,"ctx");this.serializeParametersTransformer=new Eu(r),this.deserializer=e||xu,this.only=t||!1}transformQuery({node:t,queryId:e}){var r;return this.only&&(t.kind==="SelectQueryNode"||t.kind==="RawNode")&&((r=this.ctx)==null||r.add(e)),this.serializeParametersTransformer.transformNode(t)}async parseResult(t){return t.length?await Promise.all(t.map(async e=>{const r={...e};for(const n in r)r[n]=await this.deserializer(r[n]);return r})):[]}async transformResult({result:t,queryId:e}){var n,x;const r=async()=>({...t,rows:await this.parseResult(t.rows)});return this.only?(n=this.ctx)!=null&&n.has(e)?((x=this.ctx)==null||x.delete(e),await r()):t:await r()}};function Au(t){return`__precomile_${t}`}function ku(t,e=r=>r){return{setParam:r=>{let n;return(x,R)=>{if(!n){const{parameters:te,sql:pe,query:Oe}=r({qb:t,param:Au}).compile();n={sql:pe,query:(R==null?void 0:R(Oe))||{kind:Oe.kind},parameters:te}}return{...n,parameters:n.parameters.map(te=>typeof te=="string"&&te.startsWith("__precomile_")?e(x[te.slice(12)]):te)}}}}}async function Iu(t){return(await Ge`PRAGMA integrity_check`.execute(t)).rows[0].integrity_check==="ok"}async function Ou(t,e){const r=e||`sp_${Date.now()%1e8}`;return await Ge`savepoint ${Ge.raw(r)}`.execute(t),{release:async()=>{await Ge`release savepoint ${Ge.raw(r)}`.execute(t)},rollback:async()=>{await Ge`rollback to savepoint ${Ge.raw(r)}`.execute(t)}}}function Xa(t){const{logger:e,merge:r,queryNode:n}=t;return x=>{const{level:R,queryDurationMillis:te,query:{parameters:pe,sql:Oe,query:Xe}}=x,Ye=R==="error"?x.error:void 0;let se=Oe.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&pe.forEach(mn=>{se=se.replace("?",JSON.stringify(mn))});const xe={sql:se,params:pe,duration:te,error:Ye};n&&(xe.queryNode=Xe),e(xe)}}var Tu=class extends Error{constructor(){super("db file maybe broken")}};function Cu(t){return t.toOperationNode().kind==="SelectQueryNode"}var Pu=class{constructor(t){De(this,"kysely");De(this,"trxCount",0);De(this,"trx");De(this,"logger");De(this,"serializer",Ka);const{dialect:e,logger:r,onQuery:n,plugins:x=[],serializerPluginOptions:R}=t;this.logger=r,R!=null&&R.serializer&&(this.serializer=R.serializer),x.push(new Su(R));let te;n===!0?te=Xa({logger:console.log,merge:!0}):n&&(te=Xa(n)),this.kysely=new oi({dialect:e,log:te,plugins:x})}async updateTables(t,e){var r,n;try{if(e&&!await Iu(this.kysely))return(r=this.logger)==null||r.error("integrity check fail"),{ready:!1,error:new Tu};await t(this.kysely,this.logger)}catch(x){return this.logError(x,"sync table fail"),{ready:!1,error:x}}return(n=this.logger)==null||n.info("table updated"),{ready:!0}}getDB(){return this.trx||this.kysely}logError(t,e){var r;e&&((r=this.logger)==null||r.error(e,t instanceof Error?t:void 0))}async transaction(t,e){var x;if(!this.trx)try{return await this.kysely.transaction().execute(async R=>{var pe;return this.trx=R,(pe=this.logger)==null||pe.debug("run in transaction"),await t(R)})}catch(R){this.logError(R,e);return}finally{this.trx=void 0}this.trxCount++;const r=this.getDB(),n=await Ou(r,`sp_${this.trxCount}`);(x=this.logger)==null||x.debug(`run in savepoint:${this.trxCount}`);try{const R=await t(r);return await n.release(),this.trxCount--,R}catch(R){await n.rollback(),this.logError(R,e),this.trxCount--;return}}async execute(t,e){try{return await t(this.getDB()).execute()}catch(r){this.logError(r,e);return}}async executeTakeFirst(t,e){try{let r=t(this.getDB());return Cu(r)&&(r=r.limit(1)),await r.executeTakeFirstOrThrow()}catch(r){this.logError(r,e);return}}precompile(t){var e,r;return(r=(e=this.logger)==null?void 0:e.debug)==null||r.call(e,"precompile"),ku(t(this.kysely),this.serializer)}async executeCompiled(t,e){try{return await this.getDB().executeQuery(t)}catch(r){this.logError(r,e);return}}async executeCompiledTakeList(t,e){const r=await this.executeCompiled(t,e);return r==null?void 0:r.rows}async raw(t,e){try{return typeof t=="string"?await this.getDB().executeQuery(cn.raw(t)):await t.execute(this.getDB())}catch(r){this.logError(r,e);return}}async destroy(){var t;(t=this.logger)==null||t.info("destroyed"),await this.kysely.destroy(),this.trx=void 0}},Ya="__TIME_TRIGGER__";function Fu(t,e){const{create:r,update:n}=(e==null?void 0:e.timeTrigger)||{},x={type:"date",defaultTo:Ya};return r===!0?t.createAt=x:r&&(t[r]=x),n===!0?t.updateAt={...x,notNull:0}:n&&(t[n]={...x,notNull:0}),{columns:t,...e}}function Za(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function Eo(t){return Array.isArray(t)?t:[t]}function Lu(t){return typeof t=="function"}async function ys(t,e){await t.schema.dropTable(e).execute()}async function el(t,e,r){const{index:n,...x}=r;await t.transaction().execute(async R=>{const te=await So(R,e,x);await nl(R,e,te),await tl(R,e,n)})}async function tl(t,e,r){for(const n of r||[]){const x=Eo(n);await t.schema.createIndex(`idx_${e}_${x.join("_")}`).on(e).columns(x).ifNotExists().execute()}}async function So(t,e,{columns:r,primary:n,timeTrigger:x,unique:R},te=!1){const pe=x?{triggerKey:"rowid",update:void 0}:void 0;let Oe=!1,Xe=t.schema.createTable(e);te&&(Xe=Xe.temporary());for(const[Ye,se]of Object.entries(r)){let xe="text";const{type:mn,notNull:Rn,defaultTo:nn}=se,wt=Za(mn);xe=wt.dataType,Xe=Xe.addColumn(Ye,xe,ut=>wt.isIncrements?(Oe=!0,pe&&(pe.triggerKey=Ye),ut.autoIncrement().primaryKey()):nn===Ya?(pe&&Rn===0&&(pe.update=Ye),ut.defaultTo(Ge`CURRENT_TIMESTAMP`)):(Rn&&(ut=ut.notNull()),nn!==void 0&&(ut=ut.defaultTo(Lu(nn)?nn(Ge):nn)),ut))}if(!Oe&&n){const Ye=Eo(n);Xe=Xe.addPrimaryKeyConstraint(`pk#${Ye.join("#")}`,Ye)}for(const Ye of R||[]){const se=Eo(Ye);Xe=Xe.addUniqueConstraint(`un#${se.join("#")}`,se)}return await Xe.ifNotExists().execute(),pe}async function nl(t,e,r){if(!r||!r.update)return;const{triggerKey:n,update:x}=r,R=`tgr_${e}_${x}`;await Ge`create trigger if not exists ${Ge.ref(R)}
after update
on ${Ge.table(e)}
begin
  update ${Ge.table(e)}
  set ${Ge.ref(x)} = CURRENT_TIMESTAMP
  where ${Ge.ref(n)} = NEW.${Ge.ref(n)};
end`.execute(t)}function Wu(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/g,[,n,x]=t.replace(/\r\n?/g,"").match(e),R={columns:{},name:n,primary:void 0,unique:[]},te=x.matchAll(r);for(const pe of te){const[,Oe,Xe,Ye]=pe;if(Oe.startsWith("pk#")){const[,...se]=Oe.split("#");R.primary=se}else if(Oe.startsWith("un#")){const[,...se]=Oe.split("#");R.unique.push(se)}else R.columns[Oe]={type:Xe,notNull:!!Ye}}return R}async function Du(t,e=[]){const r=await t.selectFrom("sqlite_master").where(({eb:x,and:R})=>{const te=R([x("type","in",["table","trigger","index"]),x("name","!=",Ha),x("name","!=",Ja),x("name","not like","sqlite_%")]);return e.forEach(pe=>te.and("name","not like",`${pe}%`)),te}).select(["name","sql","type"]).$castTo().execute(),n={existTables:{},indexList:[],triggerList:[]};for(const{name:x,sql:R,type:te}of r)R&&(te==="table"?n.existTables[x]=Wu(R):te==="index"?n.indexList.push(x):n.triggerList.push(x));return n}async function Ru(t,e,r={},n){n==null||n.debug("====== sync tables start ======");const{existTables:x,indexList:R,triggerList:te}=await Du(t),{reserveOldData:pe,truncateIfExists:Oe=[]}=r,Xe=new Set(Array.isArray(Oe)?Oe:Oe?Object.keys(x):[]);for(const se of R)await t.schema.dropIndex(se).ifExists().execute();for(const se of te)await Ge`drop trigger if exists ${Ge.ref(se)}`.execute(t);for(const[se,xe]of Object.entries(x))se in e?(n==null||n.debug(`diff table: ${se}`),await Ye(se,xe,e[se])):(n==null||n.debug(`remove table: ${se}`),await ys(t,se));for(const[se,xe]of Object.entries(e))se in x||(n==null||n.debug(`create table: ${se}`),await el(t,se,xe));n==null||n.debug("======= sync tables end =======");async function Ye(se,xe,mn){if(Xe.has(se)){await t.transaction().execute(async He=>{await ys(He,se),await el(He,se,mn),n==null||n.debug("clear and sync structure")});return}const{index:Rn,...nn}=mn,wt=[],ut=Mu(xe.columns,mn.columns);if(ut.length===Object.keys(xe.columns).length){n==null||n.debug("same table structure, skip");return}n==null||n.debug("different table structure, update"),await t.transaction().execute(async He=>{const bt=`_temp_${se}`;await So(He,bt,xe,!0),wt.push(`copy table ${se} structure to ${bt}`),await He.insertInto(bt).expression(Mr=>Mr.selectFrom(se).selectAll()).execute(),wt.push(`copy table ${se} all data to ${bt}`),await ys(He,se),wt.push(`remove table ${se}`);const rn=await So(He,se,nn);wt.push(`create table ${se}`),ut.length&&(await He.insertInto(se).columns(ut).expression(Mr=>Mr.selectFrom(bt).select(ut)).execute(),wt.push(`copy columns: ${JSON.stringify(ut)}`)),await tl(He,se,Rn),await nl(He,se,rn),wt.push(`add index and trigger for ${se}`),pe||(await ys(He,bt),wt.push(`remove temporary table ${bt}`))}).then(()=>{var He;return(He=n==null?void 0:n.trace)==null?void 0:He.call(n,wt.join(`
`))}).catch(He=>{var bt;(bt=n==null?void 0:n.trace)==null||bt.call(n,wt.join(`
`)),n==null||n.error(`fail to sync ${se}`,He)})}}function Mu(t,e){const r=[];for(const[n,x]of Object.entries(e))if(n in t){const{type:R,notNull:te=!1}=t[n];Za(x.type).dataType===R&&(x.notNull||!1)===te&&r.push(n)}return r}function Bu(t,e={}){const{logger:r,...n}=e;return async(x,R)=>{await Ru(x,t,n,r?R:void 0)}}const Qu={test:Fu({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function Uu(t){const e=new Pu({dialect:t}),r=await e.updateTables(Bu(Qu));if(!r.ready)throw r.error;console.log("test"),console.log(await e.raw(Ge`PRAGMA table_info(${Ge.table("test")});`)),console.log(await e.raw(Ge`select last_insert_rowid()`));for(let n=0;n<10;n++)await e.transaction(async x=>{await x.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}).execute()});return e.execute(n=>n.selectFrom("test").selectAll())}const ju=new mu({database:async()=>{const t=(await gu()).oo1;if(!t)return Promise.reject("fail to load sqlite");const e="/test.db";return t.OpfsDb?(console.log("support OPFS"),new t.OpfsDb(e)):(console.log("doesn't support OPFS"),new t.DB(e))},async onCreateConnection(t){await yu(t)}});onmessage=()=>{console.log("start official wasm test"),Uu(ju).then(t=>{t==null||t.forEach(e=>console.log("[official wasm]",e))})}})();
