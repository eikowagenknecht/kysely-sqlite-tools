var Hl=Object.defineProperty;var Yl=(J,_,me)=>_ in J?Hl(J,_,{enumerable:!0,configurable:!0,writable:!0,value:me}):J[_]=me;var Xe=(J,_,me)=>(Yl(J,typeof _!="symbol"?_+"":_,me),me),Eo=(J,_,me)=>{if(!_.has(J))throw TypeError("Cannot "+me)};var n=(J,_,me)=>(Eo(J,_,"read from private field"),me?me.call(J):_.get(J)),w=(J,_,me)=>{if(_.has(J))throw TypeError("Cannot add the same private member more than once");_ instanceof WeakSet?_.add(J):_.set(J,me)},g=(J,_,me,dn)=>(Eo(J,_,"write to private field"),dn?dn.call(J,me):_.set(J,me),me);var X=(J,_,me)=>(Eo(J,_,"access private method"),me);(function(){var se,or,Mr,Tn,An,B,Sn,oe,L,Dn,x,Rn,q,Pr,rs,_r,ar,ns,Qu,is,Uu,ur,di,Ln,To,ss,Vu,Bn,ee,Mn,Fr,Qr,cr,Pn,Ao,m,Ur,Vr,jr,$r,jt,re,Jr,Gr,Kr,zr,bt,Hr,z,lr,dt,De,Ne,ne,le,H,Ge,U,Ce,Me,Pe,cs,ae,ke,Ke,ze,xe,Yr,Wt,Ot,St,ft,Jt,Dt,pr,Vn,ls,ju,ds,$u,fs,Ju,ps,Gu,jn,So,$n,Gt,ms,Ku,Kt,mr,Ie,pt,yr,mt,Ve,en,Bs,Jn,Do,Gn,Ro,tn,zt,Ns,rn,Nr,nn,ws,zu,Kn,vs,Fa,wr,sn,Qa,He,on,Ua,Ht,an,Va,zn,ja,vr,$a,Hn,Yn,un,Ja,Yt,Xn,Ga;"use strict";function J(t){return typeof t>"u"||t===void 0}function _(t){return typeof t=="string"}function me(t){return typeof t=="number"}function dn(t){return typeof t=="boolean"}function Lo(t){return t===null}function Hu(t){return t instanceof Date}function Yu(t){return typeof t=="bigint"}function Ze(t){return typeof t=="function"}function wt(t){return typeof t=="object"&&t!==null}function a(t){return Object.freeze(t)}function fn(t){return Array.isArray(t)}function Cr(t){return t}const ye=a({is(t){return t.kind==="AlterTableNode"},create(t){return a({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return a({...t,...e})},cloneWithColumnAlteration(t,e){return a({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),ue=a({is(t){return t.kind==="IdentifierNode"},create(t){return a({kind:"IdentifierNode",name:t})}}),Pt=a({is(t){return t.kind==="CreateIndexNode"},create(t){return a({kind:"CreateIndexNode",name:ue.create(t)})},cloneWith(t,e){return a({...t,...e})},cloneWithColumns(t,e){return a({...t,columns:[...t.columns||[],...e]})}}),Bo=a({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return a({kind:"CreateSchemaNode",schema:ue.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Xu=["preserve rows","delete rows","drop"],at=a({is(t){return t.kind==="CreateTableNode"},create(t){return a({kind:"CreateTableNode",table:t,columns:a([])})},cloneWithColumn(t,e){return a({...t,columns:a([...t.columns,e])})},cloneWithConstraint(t,e){return a({...t,constraints:t.constraints?a([...t.constraints,e]):a([e])})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWith(t,e){return a({...t,...e})}}),_t=a({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return a({kind:"SchemableIdentifierNode",identifier:ue.create(t)})},createWithSchema(t,e){return a({kind:"SchemableIdentifierNode",schema:ue.create(t),identifier:ue.create(e)})}}),fi=a({is(t){return t.kind==="DropIndexNode"},create(t,e){return a({kind:"DropIndexNode",name:_t.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Ms=a({is(t){return t.kind==="DropSchemaNode"},create(t,e){return a({kind:"DropSchemaNode",schema:ue.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Ps=a({is(t){return t.kind==="DropTableNode"},create(t,e){return a({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return a({...t,...e})}}),ir=a({is(t){return t.kind==="AliasNode"},create(t,e){return a({kind:"AliasNode",node:t,alias:e})}}),Ft=a({is(t){return t.kind==="TableNode"},create(t){return a({kind:"TableNode",table:_t.create(t)})},createWithSchema(t,e){return a({kind:"TableNode",table:_t.createWithSchema(t,e)})}});function Le(t){return wt(t)&&Ze(t.toOperationNode)}function Zu(t){return wt(t)&&"expressionType"in t&&Le(t)}function eh(t){return wt(t)&&"expression"in t&&_(t.alias)&&Le(t)}const It=a({is(t){return t.kind==="SelectModifierNode"},create(t){return a({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return a({kind:"SelectModifierNode",rawModifier:t})}}),pn=a({is(t){return t.kind==="AndNode"},create(t,e){return a({kind:"AndNode",left:t,right:e})}}),mn=a({is(t){return t.kind==="OrNode"},create(t,e){return a({kind:"OrNode",left:t,right:e})}}),yn=a({is(t){return t.kind==="OnNode"},create(t){return a({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return a({...t,on:e==="And"?pn.create(t.on,r):mn.create(t.on,r)})}}),et=a({is(t){return t.kind==="JoinNode"},create(t,e){return a({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return a({kind:"JoinNode",joinType:t,table:e,on:yn.create(r)})},cloneWithOn(t,e){return a({...t,on:t.on?yn.cloneWithOperation(t.on,"And",e):yn.create(e)})},cloneWithOrOn(t,e){return a({...t,on:t.on?yn.cloneWithOperation(t.on,"Or",e):yn.create(e)})}}),pi=a({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return a({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),Te=a({is(t){return t.kind==="RawNode"},create(t,e){return a({kind:"RawNode",sqlFragments:a(t),parameters:a(e)})},createWithSql(t){return Te.create([t],[])},createWithChild(t){return Te.create(["",""],[t])},createWithChildren(t){return Te.create(new Array(t.length+1).fill(""),t)}}),Mo=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->"],th=["+","-","*","/","%","^","&","|","#","<<",">>"],Po=[...Mo,...th,"&&","||"],rh=["not","-",...["exists","not exists"]],nh=[...Po,...rh],_s=a({is(t){return t.kind==="OperatorNode"},create(t){return a({kind:"OperatorNode",operator:t})}});function _o(t){return _(t)&&Po.includes(t)}function Fo(t){return _(t)&&Mo.includes(t)}const kr=a({is(t){return t.kind==="ParensNode"},create(t){return a({kind:"ParensNode",node:t})}}),he=a({is(t){return t.kind==="ColumnNode"},create(t){return a({kind:"ColumnNode",column:ue.create(t)})}}),Fs=a({is(t){return t.kind==="SelectAllNode"},create(){return a({kind:"SelectAllNode"})}}),mi=a({is(t){return t.kind==="ReferenceNode"},create(t,e){return a({kind:"ReferenceNode",table:t,column:e})},createSelectAll(t){return a({kind:"ReferenceNode",table:t,column:Fs.create()})}}),ih=a({is(t){return t.kind==="OrderByItemNode"},create(t,e){return a({kind:"OrderByItemNode",orderBy:t,direction:e})}});function sh(t){return t==="asc"||t==="desc"}function yi(t,e){return ih.create(oh(t),ah(e))}function oh(t){return Et(t)}function ah(t){if(t)return t==="asc"||t==="desc"?Te.createWithSql(t):t.toOperationNode()}function Qo(t){return _(t)?Ir(t):t.toOperationNode()}function Nn(t){return fn(t)?t.map(e=>Et(e)):[Et(t)]}function Et(t){return Di(t)?Si(t):Qo(t)}function Ir(t){const e=".";if(t.includes(e)){const r=t.split(e).map(Qs);if(r.length===3)return hh(r);if(r.length===2)return ch(r);throw new Error(`invalid column reference ${t}`)}else return he.create(t)}function uh(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(Qs);return ir.create(Ir(r),ue.create(u))}else return Ir(t)}function Uo(t){return he.create(t)}function Vo(t){const e=" ";if(t.includes(e)){const[r,u]=t.split(e).map(Qs);if(!sh(u))throw new Error(`invalid order direction "${u}" next to "${r}"`);return yi(r,u)}else return Uo(t)}function hh(t){const[e,r,u]=t;return mi.create(Ft.createWithSchema(e,r),he.create(u))}function ch(t){const[e,r]=t;return mi.create(Ft.create(e),he.create(r))}function Qs(t){return t.trim()}const jo=a({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return a({kind:"PrimitiveValueListNode",values:a([...t])})}}),Us=a({is(t){return t.kind==="ValueListNode"},create(t){return a({kind:"ValueListNode",values:a(t)})}}),vt=a({is(t){return t.kind==="ValueNode"},create(t){return a({kind:"ValueNode",value:t})},createImmediate(t){return a({kind:"ValueNode",value:t,immediate:!0})}});function $o(t){return fn(t)?lh(t):Tt(t)}function Tt(t){return Di(t)?Si(t):vt.create(t)}function lh(t){return t.some(Di)?Us.create(t.map(e=>Tt(e))):jo.create(t)}const Er=a({is(t){return t.kind==="OrderByNode"},create(t){return a({kind:"OrderByNode",items:a([t])})},cloneWithItem(t,e){return a({...t,items:a([...t.items,e])})}}),Jo=a({is(t){return t.kind==="PartitionByNode"},create(t){return a({kind:"PartitionByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),Vs=a({is(t){return t.kind==="OverNode"},create(){return a({kind:"OverNode"})},cloneWithOrderByItem(t,e){return a({...t,orderBy:t.orderBy?Er.cloneWithItem(t.orderBy,e):Er.create(e)})},cloneWithPartitionByItems(t,e){return a({...t,partitionBy:t.partitionBy?Jo.cloneWithItems(t.partitionBy,e):Jo.create(e)})}}),Ni=a({is(t){return t.kind==="FromNode"},create(t){return a({kind:"FromNode",froms:a(t)})},cloneWithFroms(t,e){return a({...t,froms:a([...t.froms,...e])})}}),Go=a({is(t){return t.kind==="GroupByNode"},create(t){return a({kind:"GroupByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),wi=a({is(t){return t.kind==="HavingNode"},create(t){return a({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return a({...t,having:e==="And"?pn.create(t.having,r):mn.create(t.having,r)})}}),D=a({is(t){return t.kind==="SelectQueryNode"},create(t,e){return a({kind:"SelectQueryNode",from:Ni.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})},cloneWithDistinctOn(t,e){return a({...t,distinctOn:t.distinctOn?a([...t.distinctOn,...e]):a(e)})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWithOrderByItem(t,e){return a({...t,orderBy:t.orderBy?Er.cloneWithItem(t.orderBy,e):Er.create(e)})},cloneWithGroupByItems(t,e){return a({...t,groupBy:t.groupBy?Go.cloneWithItems(t.groupBy,e):Go.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithOffset(t,e){return a({...t,offset:e})},cloneWithHaving(t,e){return a({...t,having:t.having?wi.cloneWithOperation(t.having,"And",e):wi.create(e)})},cloneWithOrHaving(t,e){return a({...t,having:t.having?wi.cloneWithOperation(t.having,"Or",e):wi.create(e)})},cloneWithSetOperation(t,e){return a({...t,setOperations:t.setOperations?a([...t.setOperations,e]):a([e])})},cloneWithoutSelections(t){return a({...t,selections:[]})},cloneWithoutLimit(t){return a({...t,limit:void 0})},cloneWithoutOffset(t){return a({...t,offset:void 0})},cloneWithoutOrderBy(t){return a({...t,orderBy:void 0})}}),Ko=a({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return a({kind:"UnaryOperationNode",operator:t,operand:e})}});function Ae(t){return js("exists",t)}function Oe(t){return js("not exists",t)}function js(t,e){return Ko.create(_s.create(t),Et(e))}function Q(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}const ct=class{constructor(e){w(this,se,void 0);g(this,se,a(e))}on(...e){return new ct({...n(this,se),joinNode:et.cloneWithOn(n(this,se).joinNode,fa(e))})}orOn(...e){return new ct({...n(this,se),joinNode:et.cloneWithOrOn(n(this,se).joinNode,fa(e))})}onRef(e,r,u){return new ct({...n(this,se),joinNode:et.cloneWithOn(n(this,se).joinNode,qe(e,r,u))})}orOnRef(e,r,u){return new ct({...n(this,se),joinNode:et.cloneWithOrOn(n(this,se).joinNode,qe(e,r,u))})}onExists(e){return new ct({...n(this,se),joinNode:et.cloneWithOn(n(this,se).joinNode,Ae(e))})}onNotExists(e){return new ct({...n(this,se),joinNode:et.cloneWithOn(n(this,se).joinNode,Oe(e))})}orOnExists(e){return new ct({...n(this,se),joinNode:et.cloneWithOrOn(n(this,se).joinNode,Ae(e))})}orOnNotExists(e){return new ct({...n(this,se),joinNode:et.cloneWithOrOn(n(this,se).joinNode,Oe(e))})}onTrue(){return new ct({...n(this,se),joinNode:et.cloneWithOn(n(this,se).joinNode,Te.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return n(this,se).joinNode}};let vi=ct;se=new WeakMap,Q(vi,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const dh=a({is(t){return t.kind==="PartitionByItemNode"},create(t){return a({kind:"PartitionByItemNode",partitionBy:t})}});function fh(t){return Nn(t).map(dh.create)}const ts=class{constructor(e){w(this,or,void 0);g(this,or,a(e))}orderBy(e,r){return new ts({overNode:Vs.cloneWithOrderByItem(n(this,or).overNode,yi(e,r))})}partitionBy(e){return new ts({overNode:Vs.cloneWithPartitionByItems(n(this,or).overNode,fh(e))})}$call(e){return e(this)}toOperationNode(){return n(this,or).overNode}};let gi=ts;or=new WeakMap,Q(gi,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const wn=a({is(t){return t.kind==="SelectionNode"},create(t){return a({kind:"SelectionNode",selection:t})},createSelectAll(){return a({kind:"SelectionNode",selection:Fs.create()})},createSelectAllFromTable(t){return a({kind:"SelectionNode",selection:mi.createSelectAll(t)})}});class ph{constructor(e){w(this,Mr,void 0);g(this,Mr,e)}get dynamicReference(){return n(this,Mr)}get refType(){}toOperationNode(){return Qo(n(this,Mr))}}Mr=new WeakMap;function mh(t){return wt(t)&&Le(t)&&_(t.dynamicReference)}function vn(t){return Ze(t)?vn(t(At())):fn(t)?t.map(e=>zo(e)):[zo(t)]}function zo(t){return _(t)?wn.create(uh(t)):mh(t)?wn.create(t.toOperationNode()):wn.create(ba(t))}function gn(t){return t?Array.isArray(t)?t.map(Ho):[Ho(t)]:[wn.createSelectAll()]}function Ho(t){if(_(t))return wn.createSelectAllFromTable(Ue(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const yh=a({is(t){return t.kind==="ValuesNode"},create(t){return a({kind:"ValuesNode",values:a(t)})}}),Nh=a({is(t){return t.kind==="DefaultInsertValueNode"},create(){return a({kind:"DefaultInsertValueNode"})}});function wh(t){const e=Ze(t)?t(At()):t,r=fn(e)?e:a([e]);return vh(r)}function vh(t){const e=gh(t);return[a([...e.keys()].map(he.create)),yh.create(t.map(r=>bh(r,e)))]}function gh(t){const e=new Map;for(const r of t){const u=Object.keys(r);for(const d of u)!e.has(d)&&r[d]!==void 0&&e.set(d,e.size)}return e}function bh(t,e){const r=Object.keys(t),u=Array.from({length:e.size});let d=!1;for(const k of r){const I=e.get(k);if(J(I))continue;const j=t[k];(J(j)||Di(j))&&(d=!0),u[I]=j}if(r.length<e.size||d){const k=Nh.create();return Us.create(u.map(I=>J(I)?k:Tt(I)))}return jo.create(u)}const gt=a({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return a({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return a({...t,...e})}}),bi=a({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return a({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return a({...t,from:t.from?Ni.cloneWithFroms(t.from,e):Ni.create(e)})},cloneWithUpdates(t,e){return a({...t,updates:t.updates?a([...t.updates,...e]):e})}}),Yo=a({is(t){return t.kind==="UsingNode"},create(t){return a({kind:"UsingNode",tables:a(t)})},cloneWithTables(t,e){return a({...t,tables:a([...t.tables,...e])})}}),bn=a({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return a({kind:"DeleteQueryNode",from:Ni.create(t),...e&&{with:e}})},cloneWithOrderByItem(t,e){return a({...t,orderBy:t.orderBy?Er.cloneWithItem(t.orderBy,e):Er.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithUsing(t,e){return a({...t,using:t.using!==void 0?Yo.cloneWithTables(t.using,e):Yo.create(e)})}}),Se=a({is(t){return t.kind==="WhereNode"},create(t){return a({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return a({...t,where:e==="And"?pn.create(t.where,r):mn.create(t.where,r)})}}),Xo=a({is(t){return t.kind==="ReturningNode"},create(t){return a({kind:"ReturningNode",selections:a(t)})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})}}),xh=a({is(t){return t.kind==="ExplainNode"},create(t,e){return a({kind:"ExplainNode",format:t,options:e})}}),C=a({is(t){return D.is(t)||gt.is(t)||bi.is(t)||bn.is(t)},cloneWithWhere(t,e){return a({...t,where:t.where?Se.cloneWithOperation(t.where,"And",e):Se.create(e)})},cloneWithOrWhere(t,e){return a({...t,where:t.where?Se.cloneWithOperation(t.where,"Or",e):Se.create(e)})},cloneWithJoin(t,e){return a({...t,joins:t.joins?a([...t.joins,e]):a([e])})},cloneWithReturning(t,e){return a({...t,returning:t.returning?Xo.cloneWithSelections(t.returning,e):Xo.create(e)})},cloneWithoutWhere(t){return a({...t,where:void 0})},cloneWithExplain(t,e,r){return a({...t,explain:xh.create(e,r==null?void 0:r.toOperationNode())})}}),Wh=a({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return a({kind:"ColumnUpdateNode",column:t,value:e})}});function $s(t){const e=Ze(t)?t(At()):t;return Object.entries(e).filter(([r,u])=>u!==void 0).map(([r,u])=>Wh.create(he.create(r),Tt(u)))}const Oh=a({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return a({kind:"OnDuplicateKeyNode",updates:t})}});class Zo{constructor(e,r){w(this,Tn,void 0);w(this,An,void 0);g(this,Tn,e),g(this,An,r)}get insertId(){return n(this,Tn)}get numInsertedOrUpdatedRows(){return n(this,An)}}Tn=new WeakMap,An=new WeakMap;for(const t of["insertId","numInsertedOrUpdatedRows"])Object.defineProperty(Zo.prototype,t,{enumerable:!0});class xi extends Error{constructor(r){super("no result");Xe(this,"node");this.node=r}}function Wi(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const te=a({is(t){return t.kind==="OnConflictNode"},create(){return a({kind:"OnConflictNode"})},cloneWith(t,e){return a({...t,...e})},cloneWithIndexWhere(t,e){return a({...t,indexWhere:t.indexWhere?Se.cloneWithOperation(t.indexWhere,"And",e):Se.create(e)})},cloneWithIndexOrWhere(t,e){return a({...t,indexWhere:t.indexWhere?Se.cloneWithOperation(t.indexWhere,"Or",e):Se.create(e)})},cloneWithUpdateWhere(t,e){return a({...t,updateWhere:t.updateWhere?Se.cloneWithOperation(t.updateWhere,"And",e):Se.create(e)})},cloneWithUpdateOrWhere(t,e){return a({...t,updateWhere:t.updateWhere?Se.cloneWithOperation(t.updateWhere,"Or",e):Se.create(e)})},cloneWithoutIndexWhere(t){return a({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return a({...t,updateWhere:void 0})}}),Be=class{constructor(e){w(this,B,void 0);g(this,B,a(e))}column(e){const r=he.create(e);return new Be({...n(this,B),onConflictNode:te.cloneWith(n(this,B).onConflictNode,{columns:n(this,B).onConflictNode.columns?a([...n(this,B).onConflictNode.columns,r]):a([r])})})}columns(e){const r=e.map(he.create);return new Be({...n(this,B),onConflictNode:te.cloneWith(n(this,B).onConflictNode,{columns:n(this,B).onConflictNode.columns?a([...n(this,B).onConflictNode.columns,...r]):a(r)})})}constraint(e){return new Be({...n(this,B),onConflictNode:te.cloneWith(n(this,B).onConflictNode,{constraint:ue.create(e)})})}expression(e){return new Be({...n(this,B),onConflictNode:te.cloneWith(n(this,B).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexWhere(n(this,B).onConflictNode,$e(e))})}whereRef(e,r,u){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexWhere(n(this,B).onConflictNode,qe(e,r,u))})}orWhere(...e){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexOrWhere(n(this,B).onConflictNode,$e(e))})}orWhereRef(e,r,u){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexOrWhere(n(this,B).onConflictNode,qe(e,r,u))})}whereExists(e){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexWhere(n(this,B).onConflictNode,Ae(e))})}whereNotExists(e){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexWhere(n(this,B).onConflictNode,Oe(e))})}orWhereExists(e){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexOrWhere(n(this,B).onConflictNode,Ae(e))})}orWhereNotExists(e){return new Be({...n(this,B),onConflictNode:te.cloneWithIndexOrWhere(n(this,B).onConflictNode,Oe(e))})}clearWhere(){return new Be({...n(this,B),onConflictNode:te.cloneWithoutIndexWhere(n(this,B).onConflictNode)})}doNothing(){return new ea({...n(this,B),onConflictNode:te.cloneWith(n(this,B).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new qi({...n(this,B),onConflictNode:te.cloneWith(n(this,B).onConflictNode,{updates:$s(e)})})}$call(e){return e(this)}};let Oi=Be;B=new WeakMap,Q(Oi,"don't await OnConflictBuilder instances.");class ea{constructor(e){w(this,Sn,void 0);g(this,Sn,a(e))}toOperationNode(){return n(this,Sn).onConflictNode}}Sn=new WeakMap,Q(ea,"don't await OnConflictDoNothingBuilder instances.");const lt=class{constructor(e){w(this,oe,void 0);g(this,oe,a(e))}where(...e){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateWhere(n(this,oe).onConflictNode,$e(e))})}whereRef(e,r,u){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateWhere(n(this,oe).onConflictNode,qe(e,r,u))})}orWhere(...e){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateOrWhere(n(this,oe).onConflictNode,$e(e))})}orWhereRef(e,r,u){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateOrWhere(n(this,oe).onConflictNode,qe(e,r,u))})}whereExists(e){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateWhere(n(this,oe).onConflictNode,Ae(e))})}whereNotExists(e){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateWhere(n(this,oe).onConflictNode,Oe(e))})}orWhereExists(e){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateOrWhere(n(this,oe).onConflictNode,Ae(e))})}orWhereNotExists(e){return new lt({...n(this,oe),onConflictNode:te.cloneWithUpdateOrWhere(n(this,oe).onConflictNode,Oe(e))})}clearWhere(){return new lt({...n(this,oe),onConflictNode:te.cloneWithoutUpdateWhere(n(this,oe).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return n(this,oe).onConflictNode}};let qi=lt;oe=new WeakMap,Q(qi,"don't await OnConflictUpdateBuilder instances.");const ge=class{constructor(e){w(this,L,void 0);g(this,L,a(e))}values(e){const[r,u]=wh(e);return new ge({...n(this,L),queryNode:gt.cloneWith(n(this,L).queryNode,{columns:r,values:u})})}columns(e){return new ge({...n(this,L),queryNode:gt.cloneWith(n(this,L).queryNode,{columns:a(e.map(he.create))})})}expression(e){return new ge({...n(this,L),queryNode:gt.cloneWith(n(this,L).queryNode,{values:Si(e)})})}ignore(){return new ge({...n(this,L),queryNode:gt.cloneWith(n(this,L).queryNode,{ignore:!0})})}onConflict(e){return new ge({...n(this,L),queryNode:gt.cloneWith(n(this,L).queryNode,{onConflict:e(new Oi({onConflictNode:te.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new ge({...n(this,L),queryNode:gt.cloneWith(n(this,L).queryNode,{onDuplicateKey:Oh.create($s(e))})})}returning(e){return new ge({...n(this,L),queryNode:C.cloneWithReturning(n(this,L).queryNode,vn(e))})}returningAll(){return new ge({...n(this,L),queryNode:C.cloneWithReturning(n(this,L).queryNode,gn())})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,r){return e?r(this):new ge({...n(this,L)})}if(e,r){return e?r(this):new ge({...n(this,L)})}$castTo(){return new ge(n(this,L))}castTo(){return this.$castTo()}$narrowType(){return new ge(n(this,L))}$assertType(){return new ge(n(this,L))}assertType(){return new ge(n(this,L))}withPlugin(e){return new ge({...n(this,L),executor:n(this,L).executor.withPlugin(e)})}toOperationNode(){return n(this,L).executor.transformQuery(n(this,L).queryNode,n(this,L).queryId)}compile(){return n(this,L).executor.compileQuery(this.toOperationNode(),n(this,L).queryId)}async execute(){const e=this.compile(),r=e.query,u=await n(this,L).executor.executeQuery(e,n(this,L).queryId);return n(this,L).executor.adapter.supportsReturning&&r.returning?u.rows:[new Zo(u.insertId,u.numAffectedRows??u.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=xi){const r=await this.executeTakeFirst();if(r===void 0)throw Wi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,L).executor.stream(r,e,n(this,L).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new ge({...n(this,L),queryNode:C.cloneWithExplain(n(this,L).queryNode,e,r)}).execute()}};let xn=ge;L=new WeakMap,Q(xn,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class ta{constructor(e){w(this,Dn,void 0);g(this,Dn,e)}get numDeletedRows(){return n(this,Dn)}}Dn=new WeakMap,Object.defineProperty(ta.prototype,"numDeletedRows",{enumerable:!0});const ra=a({is(t){return t.kind==="LimitNode"},create(t){return a({kind:"LimitNode",limit:vt.create(t)})}}),K=class{constructor(e){w(this,x,void 0);g(this,x,a(e))}where(...e){return new K({...n(this,x),queryNode:C.cloneWithWhere(n(this,x).queryNode,$e(e))})}whereRef(e,r,u){return new K({...n(this,x),queryNode:C.cloneWithWhere(n(this,x).queryNode,qe(e,r,u))})}orWhere(...e){return new K({...n(this,x),queryNode:C.cloneWithOrWhere(n(this,x).queryNode,$e(e))})}orWhereRef(e,r,u){return new K({...n(this,x),queryNode:C.cloneWithOrWhere(n(this,x).queryNode,qe(e,r,u))})}whereExists(e){return new K({...n(this,x),queryNode:C.cloneWithWhere(n(this,x).queryNode,Ae(e))})}whereNotExists(e){return new K({...n(this,x),queryNode:C.cloneWithWhere(n(this,x).queryNode,Oe(e))})}orWhereExists(e){return new K({...n(this,x),queryNode:C.cloneWithOrWhere(n(this,x).queryNode,Ae(e))})}orWhereNotExists(e){return new K({...n(this,x),queryNode:C.cloneWithOrWhere(n(this,x).queryNode,Oe(e))})}clearWhere(){return new K({...n(this,x),queryNode:C.cloneWithoutWhere(n(this,x).queryNode)})}using(e){return new K({...n(this,x),queryNode:bn.cloneWithUsing(n(this,x).queryNode,Dr(e))})}innerJoin(...e){return new K({...n(this,x),queryNode:C.cloneWithJoin(n(this,x).queryNode,Qe("InnerJoin",e))})}leftJoin(...e){return new K({...n(this,x),queryNode:C.cloneWithJoin(n(this,x).queryNode,Qe("LeftJoin",e))})}rightJoin(...e){return new K({...n(this,x),queryNode:C.cloneWithJoin(n(this,x).queryNode,Qe("RightJoin",e))})}fullJoin(...e){return new K({...n(this,x),queryNode:C.cloneWithJoin(n(this,x).queryNode,Qe("FullJoin",e))})}returning(e){return new K({...n(this,x),queryNode:C.cloneWithReturning(n(this,x).queryNode,vn(e))})}returningAll(e){return new K({...n(this,x),queryNode:C.cloneWithReturning(n(this,x).queryNode,gn(e))})}orderBy(e,r){return new K({...n(this,x),queryNode:bn.cloneWithOrderByItem(n(this,x).queryNode,yi(e,r))})}limit(e){return new K({...n(this,x),queryNode:bn.cloneWithLimit(n(this,x).queryNode,ra.create(e))})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,r){return e?r(this):new K({...n(this,x)})}if(e,r){return this.$if(e,r)}$castTo(){return new K(n(this,x))}castTo(){return this.$castTo()}$narrowType(){return new K(n(this,x))}$assertType(){return new K(n(this,x))}assertType(){return new K(n(this,x))}withPlugin(e){return new K({...n(this,x),executor:n(this,x).executor.withPlugin(e)})}toOperationNode(){return n(this,x).executor.transformQuery(n(this,x).queryNode,n(this,x).queryId)}compile(){return n(this,x).executor.compileQuery(this.toOperationNode(),n(this,x).queryId)}async execute(){const e=this.compile(),r=e.query,u=await n(this,x).executor.executeQuery(e,n(this,x).queryId);return n(this,x).executor.adapter.supportsReturning&&r.returning?u.rows:[new ta(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=xi){const r=await this.executeTakeFirst();if(r===void 0)throw Wi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,x).executor.stream(r,e,n(this,x).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new K({...n(this,x),queryNode:C.cloneWithExplain(n(this,x).queryNode,e,r)}).execute()}};let Ci=K;x=new WeakMap,Q(Ci,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class na{constructor(e){w(this,Rn,void 0);g(this,Rn,e)}get numUpdatedRows(){return n(this,Rn)}}Rn=new WeakMap,Object.defineProperty(na.prototype,"numUpdatedRows",{enumerable:!0});const Z=class{constructor(e){w(this,q,void 0);g(this,q,a(e))}where(...e){return new Z({...n(this,q),queryNode:C.cloneWithWhere(n(this,q).queryNode,$e(e))})}whereRef(e,r,u){return new Z({...n(this,q),queryNode:C.cloneWithWhere(n(this,q).queryNode,qe(e,r,u))})}orWhere(...e){return new Z({...n(this,q),queryNode:C.cloneWithOrWhere(n(this,q).queryNode,$e(e))})}orWhereRef(e,r,u){return new Z({...n(this,q),queryNode:C.cloneWithOrWhere(n(this,q).queryNode,qe(e,r,u))})}whereExists(e){return new Z({...n(this,q),queryNode:C.cloneWithWhere(n(this,q).queryNode,Ae(e))})}whereNotExists(e){return new Z({...n(this,q),queryNode:C.cloneWithWhere(n(this,q).queryNode,Oe(e))})}orWhereExists(e){return new Z({...n(this,q),queryNode:C.cloneWithOrWhere(n(this,q).queryNode,Ae(e))})}orWhereNotExists(e){return new Z({...n(this,q),queryNode:C.cloneWithOrWhere(n(this,q).queryNode,Oe(e))})}clearWhere(){return new Z({...n(this,q),queryNode:C.cloneWithoutWhere(n(this,q).queryNode)})}from(e){return new Z({...n(this,q),queryNode:bi.cloneWithFromItems(n(this,q).queryNode,Dr(e))})}innerJoin(...e){return new Z({...n(this,q),queryNode:C.cloneWithJoin(n(this,q).queryNode,Qe("InnerJoin",e))})}leftJoin(...e){return new Z({...n(this,q),queryNode:C.cloneWithJoin(n(this,q).queryNode,Qe("LeftJoin",e))})}rightJoin(...e){return new Z({...n(this,q),queryNode:C.cloneWithJoin(n(this,q).queryNode,Qe("RightJoin",e))})}fullJoin(...e){return new Z({...n(this,q),queryNode:C.cloneWithJoin(n(this,q).queryNode,Qe("FullJoin",e))})}set(e){return new Z({...n(this,q),queryNode:bi.cloneWithUpdates(n(this,q).queryNode,$s(e))})}returning(e){return new Z({...n(this,q),queryNode:C.cloneWithReturning(n(this,q).queryNode,vn(e))})}returningAll(){return new Z({...n(this,q),queryNode:C.cloneWithReturning(n(this,q).queryNode,gn())})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,r){return e?r(this):new Z({...n(this,q)})}if(e,r){return this.$if(e,r)}$castTo(){return new Z(n(this,q))}castTo(){return this.$castTo()}$narrowType(){return new Z(n(this,q))}$assertType(){return new Z(n(this,q))}assertType(){return new Z(n(this,q))}withPlugin(e){return new Z({...n(this,q),executor:n(this,q).executor.withPlugin(e)})}toOperationNode(){return n(this,q).executor.transformQuery(n(this,q).queryNode,n(this,q).queryId)}compile(){return n(this,q).executor.compileQuery(this.toOperationNode(),n(this,q).queryId)}async execute(){const e=this.compile(),r=e.query,u=await n(this,q).executor.executeQuery(e,n(this,q).queryId);return n(this,q).executor.adapter.supportsReturning&&r.returning?u.rows:[new na(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=xi){const r=await this.executeTakeFirst();if(r===void 0)throw Wi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,q).executor.stream(r,e,n(this,q).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new Z({...n(this,q),queryNode:C.cloneWithExplain(n(this,q).queryNode,e,r)}).execute()}};let ki=Z;q=new WeakMap,Q(ki,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const qh=a({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return a({kind:"CommonTableExpressionNode",name:t,expression:e})}}),ia=a({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return a({kind:"CommonTableExpressionNameNode",table:Ft.create(t),columns:e?a(e.map(he.create)):void 0})}});function sa(t,e){const r=e(Lh());return qh.create(Ch(t),r.toOperationNode())}function Ch(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],u=e[1].split(",").map(d=>d.trim());return ia.create(r,u)}else return ia.create(t)}const Ii=a({is(t){return t.kind==="WithNode"},create(t,e){return a({kind:"WithNode",expressions:a([t]),...e})},cloneWithExpression(t,e){return a({...t,expressions:a([...t.expressions,e])})}}),oa=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function kh(t){let e="";for(let r=0;r<t;++r)e+=Ih();return e}function Ih(){return oa[~~(Math.random()*oa.length)]}function G(){return new Eh}class Eh{constructor(){w(this,Pr,void 0)}get queryId(){return n(this,Pr)===void 0&&g(this,Pr,kh(8)),n(this,Pr)}}Pr=new WeakMap;function Zl(t){return t}class Js{constructor(){Xe(this,"nodeStack",[]);w(this,rs,a({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),a(r)}transformNodeImpl(e){return n(this,rs)[e.kind](e)}transformNodeList(e){return e&&a(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",table:this.transformNode(e.table),column:this.transformNode(e.column)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:a([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}rs=new WeakMap;const Th=a({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});class Ah extends Js{constructor(r){super();w(this,ns);w(this,is);w(this,ur);w(this,Ln);w(this,ss);w(this,_r,void 0);w(this,ar,new Set);g(this,_r,r)}transformNodeImpl(r){if(!X(this,ns,Qu).call(this,r))return super.transformNodeImpl(r);const u=X(this,is,Uu).call(this,r);for(const b of u)n(this,ar).add(b);const d=super.transformNodeImpl(r);for(const b of u)n(this,ar).delete(b);return d}transformSchemableIdentifier(r){const u=super.transformSchemableIdentifier(r);return u.schema||!n(this,ar).has(r.identifier.name)?u:{...u,schema:ue.create(n(this,_r))}}transformReferences(r){const u=super.transformReferences(r);return u.table.table.schema?u:{...u,table:Ft.createWithSchema(n(this,_r),u.table.table.identifier.name)}}}_r=new WeakMap,ar=new WeakMap,ns=new WeakSet,Qu=function(r){return r.kind in Th},is=new WeakSet,Uu=function(r){const u=new Set;if("name"in r&&r.name&&_t.is(r.name)&&X(this,Ln,To).call(this,r.name,u),"from"in r&&r.from)for(const d of r.from.froms)X(this,ur,di).call(this,d,u);if("into"in r&&r.into&&X(this,ur,di).call(this,r.into,u),"table"in r&&r.table&&X(this,ur,di).call(this,r.table,u),"joins"in r&&r.joins)for(const d of r.joins)X(this,ur,di).call(this,d.table,u);return"with"in r&&r.with&&X(this,ss,Vu).call(this,r.with,u),u},ur=new WeakSet,di=function(r,u){const d=Ft.is(r)?r:ir.is(r)&&Ft.is(r.node)?r.node:null;d&&X(this,Ln,To).call(this,d.table,u)},Ln=new WeakSet,To=function(r,u){n(this,ar).has(r.identifier.name)||u.add(r.identifier.name)},ss=new WeakSet,Vu=function(r,u){for(const d of r.expressions)u.delete(d.name.table.table.identifier.name)};class Wn{constructor(e){w(this,Bn,void 0);g(this,Bn,new Ah(e))}transformQuery(e){return n(this,Bn).transformNode(e.node)}async transformResult(e){return e.result}}Bn=new WeakMap;const hr=class{constructor(e){w(this,ee,void 0);g(this,ee,a(e))}selectFrom(e){return new Sr({queryId:G(),executor:n(this,ee).executor,queryNode:D.create(Dr(e),n(this,ee).withNode)})}insertInto(e){return new xn({queryId:G(),executor:n(this,ee).executor,queryNode:gt.create(Ue(e),n(this,ee).withNode)})}replaceInto(e){return new xn({queryId:G(),executor:n(this,ee).executor,queryNode:gt.create(Ue(e),n(this,ee).withNode,!0)})}deleteFrom(e){return new Ci({queryId:G(),executor:n(this,ee).executor,queryNode:bn.create(Dr(e),n(this,ee).withNode)})}updateTable(e){return new ki({queryId:G(),executor:n(this,ee).executor,queryNode:bi.create(qn(e),n(this,ee).withNode)})}with(e,r){const u=sa(e,r);return new hr({...n(this,ee),withNode:n(this,ee).withNode?Ii.cloneWithExpression(n(this,ee).withNode,u):Ii.create(u)})}withRecursive(e,r){const u=sa(e,r);return new hr({...n(this,ee),withNode:n(this,ee).withNode?Ii.cloneWithExpression(n(this,ee).withNode,u):Ii.create(u,{recursive:!0})})}withPlugin(e){return new hr({...n(this,ee),executor:n(this,ee).executor.withPlugin(e)})}withoutPlugins(){return new hr({...n(this,ee),executor:n(this,ee).executor.withoutPlugins()})}withSchema(e){return new hr({...n(this,ee),executor:n(this,ee).executor.withPluginAtFront(new Wn(e))})}};let Ei=hr;ee=new WeakMap;class aa{constructor(){w(this,Mn,void 0);w(this,Fr,void 0);w(this,Qr,void 0);Xe(this,"resolve",e=>{n(this,Fr)&&n(this,Fr).call(this,e)});Xe(this,"reject",e=>{n(this,Qr)&&n(this,Qr).call(this,e)});g(this,Mn,new Promise((e,r)=>{g(this,Qr,r),g(this,Fr,e)}))}get promise(){return n(this,Mn)}}Mn=new WeakMap,Fr=new WeakMap,Qr=new WeakMap;const ua=new Set;function Sh(t){ua.has(t)||(ua.add(t),console.log(t))}const Dh=a([]);class ha{constructor(e=Dh){w(this,Pn);w(this,cr,void 0);g(this,cr,e)}get plugins(){return n(this,cr)}transformQuery(e,r){for(const u of n(this,cr)){const d=u.transformQuery({node:e,queryId:r});if(d.kind===e.kind)e=d;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${d.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async u=>{const d=await u.executeQuery(e),b=await X(this,Pn,Ao).call(this,d,r);return Rh(d,b),b})}async*stream(e,r,u){const d=new aa,b=new aa;this.provideConnection(async I=>(d.resolve(I),await b.promise)).catch(I=>d.reject(I));const k=await d.promise;try{for await(const I of k.streamQuery(e,r))yield await X(this,Pn,Ao).call(this,I,u)}finally{b.resolve()}}}cr=new WeakMap,Pn=new WeakSet,Ao=async function(e,r){for(const u of n(this,cr))e=await u.transformResult({result:e,queryId:r});return e};function Rh(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Sh("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class Tr extends ha{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new Tr([...this.plugins,e])}withPlugins(e){return new Tr([...this.plugins,...e])}withPluginAtFront(e){return new Tr([e,...this.plugins])}withoutPlugins(){return new Tr([])}}const Ti=new Tr;function ca(){return new Sr({queryId:G(),executor:Ti,queryNode:D.create(Dr([]))})}function Lh(){return new Ei({executor:Ti})}function la(t,e){return new vi({joinNode:et.create(t,qn(e))})}function Bh(){return new gi({overNode:Vs.create()})}const Gs=a({is(t){return t.kind==="WhenNode"},create(t){return a({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return a({...t,result:e})}}),ut=a({is(t){return t.kind==="CaseNode"},create(t){return a({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return a({...t,when:a(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return a({...t,when:t.when?a([...t.when.slice(0,-1),Gs.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return a({...t,...e})}});function Ks(t,e,r){if(!_o(e)&&!Le(e))throw new Error(`invalid binary operator ${JSON.stringify(e)}`);return _h(e,r)?Fh(t,e,r):pi.create(Et(t),zs(e),$o(r))}function Mh(t,e,r){if(!_o(e)&&!Le(e))throw new Error(`invalid binary operator ${JSON.stringify(e)}`);return pi.create(Et(t),zs(e),Et(r))}function Ph(t,e,r){if(!Fo(e)&&!Le(e))throw new Error(`invalid comparison operator ${JSON.stringify(e)}`);return Ks(t,e,r)}function qe(t,e,r){if(!Fo(e)&&!Le(e))throw new Error(`invalid comparison operator ${JSON.stringify(e)}`);return Mh(t,e,r)}function $e(t){return Ai("where",t)}function da(t){return Ai("having",t)}function fa(t){return Ai("on",t)}function pa(t){return Ai("when",t)}function Ai(t,e){if(e.length===3)return Ph(e[0],e[1],e[2]);if(e.length===1)return Qh(t,e[0]);throw ma(t,e)}function _h(t,e){return(t==="is"||t==="is not")&&(Lo(e)||dn(e))}function Fh(t,e,r){return pi.create(Et(t),zs(e),vt.createImmediate(r))}function zs(t){if(_(t)&&nh.includes(t))return _s.create(t);if(Le(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Qh(t,e){if(Ze(e)){if(t==="when")throw new Error("when method doesn't accept a callback as an argument");return Uh[t](e)}else if(Le(e)){const r=e.toOperationNode();if(Te.is(r)||pi.is(r)||Ko.is(r)||kr.is(r)||ut.is(r))return r}else if(t==="when")return vt.create(e);throw ma(t,e)}function ma(t,e){return new Error(`invalid arguments passed to a '${t}' method: ${JSON.stringify(e)}`)}const Uh=a({where(t){const e=ca(),r=At(),d=t(Object.assign(e,r)).toOperationNode();if(D.is(d)){if(!d.where)throw new Error("no `where` methods called inside a group callback");return kr.create(d.where.where)}else return d},having(t){const e=ca(),r=At(),d=t(Object.assign(e,r)).toOperationNode();if(D.is(d)){if(!d.having)throw new Error("no `having` methods called inside a group callback");return kr.create(d.having.having)}else return d},on(t){const e=la("InnerJoin","table"),r=At(),d=t(Object.assign(e,r)).toOperationNode();if(et.is(d)){if(!d.on)throw new Error("no `on` methods called inside a group callback");return kr.create(d.on.on)}else return d}});function Qe(t,e){if(e.length===3)return jh(t,e[0],e[1],e[2]);if(e.length===2)return Vh(t,e[0],e[1]);throw new Error("not implemented")}function Vh(t,e,r){return r(la(t,e)).toOperationNode()}function jh(t,e,r,u){return et.createWithOn(t,qn(e),qe(r,"=",u))}const $h=a({is(t){return t.kind==="OffsetNode"},create(t){return a({kind:"OffsetNode",offset:vt.create(t)})}}),Jh=a({is(t){return t.kind==="GroupByItemNode"},create(t){return a({kind:"GroupByItemNode",groupBy:t})}});function Gh(t){return t=Ze(t)?t(At()):t,Nn(t).map(Jh.create)}const ya=a({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return a({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function Ar(t,e,r){return ya.create(t,e.toOperationNode(),r)}const W=class{constructor(e){w(this,m,void 0);g(this,m,a(e))}get expressionType(){}where(...e){return new W({...n(this,m),queryNode:C.cloneWithWhere(n(this,m).queryNode,$e(e))})}whereRef(e,r,u){return new W({...n(this,m),queryNode:C.cloneWithWhere(n(this,m).queryNode,qe(e,r,u))})}orWhere(...e){return new W({...n(this,m),queryNode:C.cloneWithOrWhere(n(this,m).queryNode,$e(e))})}orWhereRef(e,r,u){return new W({...n(this,m),queryNode:C.cloneWithOrWhere(n(this,m).queryNode,qe(e,r,u))})}whereExists(e){return new W({...n(this,m),queryNode:C.cloneWithWhere(n(this,m).queryNode,Ae(e))})}whereNotExists(e){return new W({...n(this,m),queryNode:C.cloneWithWhere(n(this,m).queryNode,Oe(e))})}orWhereExists(e){return new W({...n(this,m),queryNode:C.cloneWithOrWhere(n(this,m).queryNode,Ae(e))})}orWhereNotExists(e){return new W({...n(this,m),queryNode:C.cloneWithOrWhere(n(this,m).queryNode,Oe(e))})}having(...e){return new W({...n(this,m),queryNode:D.cloneWithHaving(n(this,m).queryNode,da(e))})}havingRef(e,r,u){return new W({...n(this,m),queryNode:D.cloneWithHaving(n(this,m).queryNode,qe(e,r,u))})}orHaving(...e){return new W({...n(this,m),queryNode:D.cloneWithOrHaving(n(this,m).queryNode,da(e))})}orHavingRef(e,r,u){return new W({...n(this,m),queryNode:D.cloneWithOrHaving(n(this,m).queryNode,qe(e,r,u))})}havingExists(e){return new W({...n(this,m),queryNode:D.cloneWithHaving(n(this,m).queryNode,Ae(e))})}havingNotExist(e){return new W({...n(this,m),queryNode:D.cloneWithHaving(n(this,m).queryNode,Oe(e))})}havingNotExists(e){return new W({...n(this,m),queryNode:D.cloneWithHaving(n(this,m).queryNode,Oe(e))})}orHavingExists(e){return new W({...n(this,m),queryNode:D.cloneWithOrHaving(n(this,m).queryNode,Ae(e))})}orHavingNotExists(e){return new W({...n(this,m),queryNode:D.cloneWithOrHaving(n(this,m).queryNode,Oe(e))})}select(e){return new W({...n(this,m),queryNode:D.cloneWithSelections(n(this,m).queryNode,vn(e))})}distinctOn(e){return new W({...n(this,m),queryNode:D.cloneWithDistinctOn(n(this,m).queryNode,Nn(e))})}modifyFront(e){return new W({...n(this,m),queryNode:D.cloneWithFrontModifier(n(this,m).queryNode,It.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.createWithExpression(e.toOperationNode()))})}distinct(){return new W({...n(this,m),queryNode:D.cloneWithFrontModifier(n(this,m).queryNode,It.create("Distinct"))})}forUpdate(){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.create("ForUpdate"))})}forShare(){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.create("ForShare"))})}forKeyShare(){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.create("ForKeyShare"))})}forNoKeyUpdate(){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.create("ForNoKeyUpdate"))})}skipLocked(){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.create("SkipLocked"))})}noWait(){return new W({...n(this,m),queryNode:D.cloneWithEndModifier(n(this,m).queryNode,It.create("NoWait"))})}selectAll(e){return new W({...n(this,m),queryNode:D.cloneWithSelections(n(this,m).queryNode,gn(e))})}innerJoin(...e){return new W({...n(this,m),queryNode:C.cloneWithJoin(n(this,m).queryNode,Qe("InnerJoin",e))})}leftJoin(...e){return new W({...n(this,m),queryNode:C.cloneWithJoin(n(this,m).queryNode,Qe("LeftJoin",e))})}rightJoin(...e){return new W({...n(this,m),queryNode:C.cloneWithJoin(n(this,m).queryNode,Qe("RightJoin",e))})}fullJoin(...e){return new W({...n(this,m),queryNode:C.cloneWithJoin(n(this,m).queryNode,Qe("FullJoin",e))})}innerJoinLateral(...e){return new W({...n(this,m),queryNode:C.cloneWithJoin(n(this,m).queryNode,Qe("LateralInnerJoin",e))})}leftJoinLateral(...e){return new W({...n(this,m),queryNode:C.cloneWithJoin(n(this,m).queryNode,Qe("LateralLeftJoin",e))})}orderBy(e,r){return new W({...n(this,m),queryNode:D.cloneWithOrderByItem(n(this,m).queryNode,yi(e,r))})}groupBy(e){return new W({...n(this,m),queryNode:D.cloneWithGroupByItems(n(this,m).queryNode,Gh(e))})}limit(e){return new W({...n(this,m),queryNode:D.cloneWithLimit(n(this,m).queryNode,ra.create(e))})}offset(e){return new W({...n(this,m),queryNode:D.cloneWithOffset(n(this,m).queryNode,$h.create(e))})}union(e){return new W({...n(this,m),queryNode:D.cloneWithSetOperation(n(this,m).queryNode,Ar("union",e,!1))})}unionAll(e){return new W({...n(this,m),queryNode:D.cloneWithSetOperation(n(this,m).queryNode,Ar("union",e,!0))})}intersect(e){return new W({...n(this,m),queryNode:D.cloneWithSetOperation(n(this,m).queryNode,Ar("intersect",e,!1))})}intersectAll(e){return new W({...n(this,m),queryNode:D.cloneWithSetOperation(n(this,m).queryNode,Ar("intersect",e,!0))})}except(e){return new W({...n(this,m),queryNode:D.cloneWithSetOperation(n(this,m).queryNode,Ar("except",e,!1))})}exceptAll(e){return new W({...n(this,m),queryNode:D.cloneWithSetOperation(n(this,m).queryNode,Ar("except",e,!0))})}as(e){return new Kh(this,e)}clearSelect(){return new W({...n(this,m),queryNode:D.cloneWithoutSelections(n(this,m).queryNode)})}clearWhere(){return new W({...n(this,m),queryNode:C.cloneWithoutWhere(n(this,m).queryNode)})}clearLimit(){return new W({...n(this,m),queryNode:D.cloneWithoutLimit(n(this,m).queryNode)})}clearOffset(){return new W({...n(this,m),queryNode:D.cloneWithoutOffset(n(this,m).queryNode)})}clearOrderBy(){return new W({...n(this,m),queryNode:D.cloneWithoutOrderBy(n(this,m).queryNode)})}$call(e){return e(this)}call(e){return this.$call(e)}$if(e,r){return e?r(this):new W({...n(this,m)})}if(e,r){return this.$if(e,r)}$castTo(){return new W(n(this,m))}castTo(){return this.$castTo()}$narrowType(){return new W(n(this,m))}$assertType(){return new W(n(this,m))}assertType(){return new W(n(this,m))}withPlugin(e){return new W({...n(this,m),executor:n(this,m).executor.withPlugin(e)})}toOperationNode(){return n(this,m).executor.transformQuery(n(this,m).queryNode,n(this,m).queryId)}compile(){return n(this,m).executor.compileQuery(this.toOperationNode(),n(this,m).queryId)}async execute(){const e=this.compile();return(await n(this,m).executor.executeQuery(e,n(this,m).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=xi){const r=await this.executeTakeFirst();if(r===void 0)throw Wi(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,m).executor.stream(r,e,n(this,m).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new W({...n(this,m),queryNode:C.cloneWithExplain(n(this,m).queryNode,e,r)}).execute()}};let Sr=W;m=new WeakMap,Q(Sr,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Kh{constructor(e,r){w(this,Ur,void 0);w(this,Vr,void 0);g(this,Ur,e),g(this,Vr,r)}get expression(){return n(this,Ur)}get alias(){return n(this,Vr)}toOperationNode(){return ir.create(n(this,Ur).toOperationNode(),ue.create(n(this,Vr)))}}Ur=new WeakMap,Vr=new WeakMap;const ro=class{constructor(e){w(this,jr,void 0);g(this,jr,e)}get expressionType(){}as(e){return new zh(this,e)}$castTo(){return new ro(n(this,jr))}toOperationNode(){return n(this,jr)}};let ve=ro;jr=new WeakMap;class zh{constructor(e,r){w(this,$r,void 0);w(this,jt,void 0);g(this,$r,e),g(this,jt,r)}get expression(){return n(this,$r)}get alias(){return n(this,jt)}toOperationNode(){return ir.create(n(this,$r).toOperationNode(),Le(n(this,jt))?n(this,jt).toOperationNode():ue.create(n(this,jt)))}}$r=new WeakMap,jt=new WeakMap;const tt=a({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return a({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return a({...t,distinct:!0})},cloneWithFilter(t,e){return a({...t,filter:t.filter?Se.cloneWithOperation(t.filter,"And",e):Se.create(e)})},cloneWithOrFilter(t,e){return a({...t,filter:t.filter?Se.cloneWithOperation(t.filter,"Or",e):Se.create(e)})},cloneWithOver(t,e){return a({...t,over:e})}}),Hh=a({is(t){return t.kind==="FunctionNode"},create(t,e){return a({kind:"FunctionNode",func:t,arguments:e})}}),rt=class{constructor(e){w(this,re,void 0);g(this,re,a(e))}get expressionType(){}as(e){return new Yh(this,e)}distinct(){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithDistinct(n(this,re).aggregateFunctionNode)})}filterWhere(...e){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithFilter(n(this,re).aggregateFunctionNode,$e(e))})}filterWhereExists(e){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithFilter(n(this,re).aggregateFunctionNode,Ae(e))})}filterWhereNotExists(e){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithFilter(n(this,re).aggregateFunctionNode,Oe(e))})}filterWhereRef(e,r,u){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithFilter(n(this,re).aggregateFunctionNode,qe(e,r,u))})}orFilterWhere(...e){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithOrFilter(n(this,re).aggregateFunctionNode,$e(e))})}orFilterWhereExists(e){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithOrFilter(n(this,re).aggregateFunctionNode,Ae(e))})}orFilterWhereNotExists(e){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithOrFilter(n(this,re).aggregateFunctionNode,Oe(e))})}orFilterWhereRef(e,r,u){return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithOrFilter(n(this,re).aggregateFunctionNode,qe(e,r,u))})}over(e){const r=Bh();return new rt({...n(this,re),aggregateFunctionNode:tt.cloneWithOver(n(this,re).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return n(this,re).aggregateFunctionNode}};let On=rt;re=new WeakMap,Q(On,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Yh{constructor(e,r){w(this,Jr,void 0);w(this,Gr,void 0);g(this,Jr,e),g(this,Gr,r)}get expression(){return n(this,Jr)}get alias(){return n(this,Gr)}toOperationNode(){return ir.create(n(this,Jr).toOperationNode(),ue.create(n(this,Gr)))}}Jr=new WeakMap,Gr=new WeakMap;function Na(){const t=(r,u)=>new ve(Hh.create(r,Nn(u))),e=(r,u)=>new On({aggregateFunctionNode:tt.create(r,u?Nn(u):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(r,...u){return t("coalesce",[r,...u])},count(r){return e("count",[r])},countAll(r){return new On({aggregateFunctionNode:tt.create("count",gn(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])}})}class wa{constructor(e){w(this,Kr,void 0);g(this,Kr,a(e))}when(...e){return new va({...n(this,Kr),node:ut.cloneWithWhen(n(this,Kr).node,Gs.create(pa(e)))})}}Kr=new WeakMap;class va{constructor(e){w(this,zr,void 0);g(this,zr,a(e))}then(e){return new Xh({...n(this,zr),node:ut.cloneWithThen(n(this,zr).node,Tt(e))})}}zr=new WeakMap;class Xh{constructor(e){w(this,bt,void 0);g(this,bt,a(e))}when(...e){return new va({...n(this,bt),node:ut.cloneWithWhen(n(this,bt).node,Gs.create(pa(e)))})}else(e){return new Zh({...n(this,bt),node:ut.cloneWith(n(this,bt).node,{else:Tt(e)})})}end(){return new ve(ut.cloneWith(n(this,bt).node,{isStatement:!1}))}endCase(){return new ve(ut.cloneWith(n(this,bt).node,{isStatement:!0}))}}bt=new WeakMap;class Zh{constructor(e){w(this,Hr,void 0);g(this,Hr,a(e))}end(){return new ve(ut.cloneWith(n(this,Hr).node,{isStatement:!1}))}endCase(){return new ve(ut.cloneWith(n(this,Hr).node,{isStatement:!0}))}}Hr=new WeakMap;function ga(t=Ti){function e(r,u){return new ve(js(r,u))}return{get fn(){return Na()},selectFrom(r){return new Sr({queryId:G(),executor:t,queryNode:D.create(Dr(r))})},case(r){return new wa({node:ut.create(J(r)?void 0:Et(r))})},ref(r){return new ve(Ir(r))},val(r){return new ve($o(r))},cmpr(r,u,d){return new ve(Ks(r,u,d))},bxp(r,u,d){return new ve(Ks(r,u,d))},unary:e,not(r){return e("not",r)},exists(r){return e("exists",r)},neg(r){return e("-",r)},and(r){if(r.length===0)return new ve(vt.createImmediate(!0));if(r.length===1)return new ve(r[0].toOperationNode());let u=pn.create(r[0].toOperationNode(),r[1].toOperationNode());for(let d=2;d<r.length;++d)u=pn.create(u,r[d].toOperationNode());return new ve(kr.create(u))},or(r){if(r.length===0)return new ve(vt.createImmediate(!1));if(r.length===1)return new ve(r[0].toOperationNode());let u=mn.create(r[0].toOperationNode(),r[1].toOperationNode());for(let d=2;d<r.length;++d)u=mn.create(u,r[d].toOperationNode());return new ve(kr.create(u))},withSchema(r){return ga(t.withPluginAtFront(new Wn(r)))}}}function At(t){return ga()}function Si(t){if(Le(t))return t.toOperationNode();if(Ze(t))return t(At()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function ba(t){if(Le(t))return t.toOperationNode();if(Ze(t))return t(At()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Di(t){return Zu(t)||eh(t)||Ze(t)}function Dr(t){return fn(t)?t.map(e=>qn(e)):[qn(t)]}function qn(t){return _(t)?ec(t):ba(t)}function ec(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(xa);return ir.create(Ue(r),ue.create(u))}else return Ue(t)}function Ue(t){const e=".";if(t.includes(e)){const[r,u]=t.split(e).map(xa);return Ft.createWithSchema(r,u)}else return Ft.create(t)}function xa(t){return t.trim()}const Wa=a({is(t){return t.kind==="AddColumnNode"},create(t){return a({kind:"AddColumnNode",column:t})}}),sr=a({is(t){return t.kind==="AlterColumnNode"},create(t){return a({kind:"AlterColumnNode",column:he.create(t)})},cloneWith(t,e){return a({...t,...e})}}),ce=a({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return a({kind:"ColumnDefinitionNode",column:he.create(t),dataType:e})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):[e]})},cloneWith(t,e){return a({...t,...e})}}),Oa=a({is(t){return t.kind==="DropColumnNode"},create(t){return a({kind:"DropColumnNode",column:he.create(t)})}}),qa=a({is(t){return t.kind==="RenameColumnNode"},create(t,e){return a({kind:"RenameColumnNode",column:he.create(t),renameTo:he.create(e)})}}),Hs=a({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return a({kind:"CheckConstraintNode",expression:t,name:e?ue.create(e):void 0})}}),tc=["no action","restrict","cascade","set null","set default"],Ri=a({is(t){return t.kind==="ReferencesNode"},create(t,e){return a({kind:"ReferencesNode",table:t,columns:a([...e])})},cloneWithOnDelete(t,e){return a({...t,onDelete:e})},cloneWithOnUpdate(t,e){return a({...t,onUpdate:e})}});function Ca(t){return Le(t)?t.toOperationNode():vt.createImmediate(t)}const Li=a({is(t){return t.kind==="GeneratedNode"},create(t){return a({kind:"GeneratedNode",...t})},createWithExpression(t){return a({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return a({...t,...e})}}),rc=a({is(t){return t.kind==="DefaultValueNode"},create(t){return a({kind:"DefaultValueNode",defaultValue:t})}});function Bi(t){if(tc.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}const be=class{constructor(e){w(this,z,void 0);g(this,z,e)}autoIncrement(){return new be(ce.cloneWith(n(this,z),{autoIncrement:!0}))}primaryKey(){return new be(ce.cloneWith(n(this,z),{primaryKey:!0}))}references(e){const r=Ir(e);if(!mi.is(r)||Fs.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new be(ce.cloneWith(n(this,z),{references:Ri.create(r.table,[r.column])}))}onDelete(e){if(!n(this,z).references)throw new Error("on delete constraint can only be added for foreign keys");return new be(ce.cloneWith(n(this,z),{references:Ri.cloneWithOnDelete(n(this,z).references,Bi(e))}))}onUpdate(e){if(!n(this,z).references)throw new Error("on update constraint can only be added for foreign keys");return new be(ce.cloneWith(n(this,z),{references:Ri.cloneWithOnUpdate(n(this,z).references,Bi(e))}))}unique(){return new be(ce.cloneWith(n(this,z),{unique:!0}))}notNull(){return new be(ce.cloneWith(n(this,z),{notNull:!0}))}unsigned(){return new be(ce.cloneWith(n(this,z),{unsigned:!0}))}defaultTo(e){return new be(ce.cloneWith(n(this,z),{defaultTo:rc.create(Ca(e))}))}check(e){return new be(ce.cloneWith(n(this,z),{check:Hs.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new be(ce.cloneWith(n(this,z),{generated:Li.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new be(ce.cloneWith(n(this,z),{generated:Li.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new be(ce.cloneWith(n(this,z),{generated:Li.create({identity:!0,byDefault:!0})}))}stored(){if(!n(this,z).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new be(ce.cloneWith(n(this,z),{generated:Li.cloneWith(n(this,z).generated,{stored:!0})}))}modifyFront(e){return new be(ce.cloneWithFrontModifier(n(this,z),e.toOperationNode()))}modifyEnd(e){return new be(ce.cloneWithEndModifier(n(this,z),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return n(this,z)}};let Qt=be;z=new WeakMap,Q(Qt,"don't await ColumnDefinitionBuilder instances directly.");const ka=a({is(t){return t.kind==="ModifyColumnNode"},create(t){return a({kind:"ModifyColumnNode",column:t})}}),nc=a({is(t){return t.kind==="DataTypeNode"},create(t){return a({kind:"DataTypeNode",dataType:t})}});function Rr(t){return Le(t)?t.toOperationNode():nc.create(t)}const Mi=a({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,u){return a({kind:"ForeignKeyConstraintNode",columns:t,references:Ri.create(e,r),name:u?ue.create(u):void 0})},cloneWith(t,e){return a({...t,...e})}}),os=class{constructor(e){w(this,lr,void 0);g(this,lr,e)}onDelete(e){return new os(Mi.cloneWith(n(this,lr),{onDelete:Bi(e)}))}onUpdate(e){return new os(Mi.cloneWith(n(this,lr),{onUpdate:Bi(e)}))}$call(e){return e(this)}toOperationNode(){return n(this,lr)}};let Cn=os;lr=new WeakMap,Q(Cn,"don't await ForeignKeyConstraintBuilder instances directly.");const Ys=a({is(t){return t.kind==="AddConstraintNode"},create(t){return a({kind:"AddConstraintNode",constraint:t})}}),Ia=a({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return a({kind:"UniqueConstraintNode",columns:a(t.map(he.create)),name:e?ue.create(e):void 0})}}),Pi=a({is(t){return t.kind==="DropConstraintNode"},create(t){return a({kind:"DropConstraintNode",constraintName:ue.create(t)})},cloneWith(t,e){return a({...t,...e})}});class _i{constructor(e){Xe(this,"alterColumnNode");this.alterColumnNode=e}setDataType(e){return new kn(sr.cloneWith(this.alterColumnNode,{dataType:Rr(e)}))}setDefault(e){return new kn(sr.cloneWith(this.alterColumnNode,{setDefault:Ca(e)}))}dropDefault(){return new kn(sr.cloneWith(this.alterColumnNode,{dropDefault:!0}))}setNotNull(){return new kn(sr.cloneWith(this.alterColumnNode,{setNotNull:!0}))}dropNotNull(){return new kn(sr.cloneWith(this.alterColumnNode,{dropNotNull:!0}))}$call(e){return e(this)}}class kn extends _i{toOperationNode(){return this.alterColumnNode}}class In{constructor(e){w(this,dt,void 0);g(this,dt,a(e))}toOperationNode(){return n(this,dt).executor.transformQuery(n(this,dt).node,n(this,dt).queryId)}compile(){return n(this,dt).executor.compileQuery(this.toOperationNode(),n(this,dt).queryId)}async execute(){await n(this,dt).executor.executeQuery(this.compile(),n(this,dt).queryId)}}dt=new WeakMap,Q(In,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");const as=class{constructor(e){w(this,De,void 0);g(this,De,a(e))}onDelete(e){return new as({...n(this,De),constraintBuilder:n(this,De).constraintBuilder.onDelete(e)})}onUpdate(e){return new as({...n(this,De),constraintBuilder:n(this,De).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return n(this,De).executor.transformQuery(ye.cloneWithTableProps(n(this,De).node,{addConstraint:Ys.create(n(this,De).constraintBuilder.toOperationNode())}),n(this,De).queryId)}compile(){return n(this,De).executor.compileQuery(this.toOperationNode(),n(this,De).queryId)}async execute(){await n(this,De).executor.executeQuery(this.compile(),n(this,De).queryId)}};let Fi=as;De=new WeakMap,Q(Fi,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");const _n=class{constructor(e){w(this,Ne,void 0);g(this,Ne,a(e))}ifExists(){return new _n({...n(this,Ne),node:ye.cloneWithTableProps(n(this,Ne).node,{dropConstraint:Pi.cloneWith(n(this,Ne).node.dropConstraint,{ifExists:!0})})})}cascade(){return new _n({...n(this,Ne),node:ye.cloneWithTableProps(n(this,Ne).node,{dropConstraint:Pi.cloneWith(n(this,Ne).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new _n({...n(this,Ne),node:ye.cloneWithTableProps(n(this,Ne).node,{dropConstraint:Pi.cloneWith(n(this,Ne).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return n(this,Ne).executor.transformQuery(n(this,Ne).node,n(this,Ne).queryId)}compile(){return n(this,Ne).executor.compileQuery(this.toOperationNode(),n(this,Ne).queryId)}async execute(){await n(this,Ne).executor.executeQuery(this.compile(),n(this,Ne).queryId)}};let Qi=_n;Ne=new WeakMap,Q(Qi,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");class Ea{constructor(e){w(this,ne,void 0);g(this,ne,a(e))}renameTo(e){return new In({...n(this,ne),node:ye.cloneWithTableProps(n(this,ne).node,{renameTo:Ue(e)})})}setSchema(e){return new In({...n(this,ne),node:ye.cloneWithTableProps(n(this,ne).node,{setSchema:ue.create(e)})})}alterColumn(e,r){const u=r(new _i(sr.create(e)));return new Ut({...n(this,ne),node:ye.cloneWithColumnAlteration(n(this,ne).node,u.toOperationNode())})}dropColumn(e){return new Ut({...n(this,ne),node:ye.cloneWithColumnAlteration(n(this,ne).node,Oa.create(e))})}renameColumn(e,r){return new Ut({...n(this,ne),node:ye.cloneWithColumnAlteration(n(this,ne).node,qa.create(e,r))})}addColumn(e,r,u=Cr){const d=u(new Qt(ce.create(e,Rr(r))));return new Ut({...n(this,ne),node:ye.cloneWithColumnAlteration(n(this,ne).node,Wa.create(d.toOperationNode()))})}modifyColumn(e,r,u=Cr){const d=u(new Qt(ce.create(e,Rr(r))));return new Ut({...n(this,ne),node:ye.cloneWithColumnAlteration(n(this,ne).node,ka.create(d.toOperationNode()))})}addUniqueConstraint(e,r){return new In({...n(this,ne),node:ye.cloneWithTableProps(n(this,ne).node,{addConstraint:Ys.create(Ia.create(r,e))})})}addCheckConstraint(e,r){return new In({...n(this,ne),node:ye.cloneWithTableProps(n(this,ne).node,{addConstraint:Ys.create(Hs.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,u,d){return new Fi({...n(this,ne),constraintBuilder:new Cn(Mi.create(r.map(he.create),Ue(u),d.map(he.create),e))})}dropConstraint(e){return new Qi({...n(this,ne),node:ye.cloneWithTableProps(n(this,ne).node,{dropConstraint:Pi.create(e)})})}$call(e){return e(this)}call(e){return this.$call(e)}}ne=new WeakMap;const dr=class{constructor(e){w(this,le,void 0);g(this,le,a(e))}alterColumn(e,r){const u=r(new _i(sr.create(e)));return new dr({...n(this,le),node:ye.cloneWithColumnAlteration(n(this,le).node,u.toOperationNode())})}dropColumn(e){return new dr({...n(this,le),node:ye.cloneWithColumnAlteration(n(this,le).node,Oa.create(e))})}renameColumn(e,r){return new dr({...n(this,le),node:ye.cloneWithColumnAlteration(n(this,le).node,qa.create(e,r))})}addColumn(e,r,u=Cr){const d=u(new Qt(ce.create(e,Rr(r))));return new dr({...n(this,le),node:ye.cloneWithColumnAlteration(n(this,le).node,Wa.create(d.toOperationNode()))})}modifyColumn(e,r,u=Cr){const d=u(new Qt(ce.create(e,Rr(r))));return new dr({...n(this,le),node:ye.cloneWithColumnAlteration(n(this,le).node,ka.create(d.toOperationNode()))})}toOperationNode(){return n(this,le).executor.transformQuery(n(this,le).node,n(this,le).queryId)}compile(){return n(this,le).executor.compileQuery(this.toOperationNode(),n(this,le).queryId)}async execute(){await n(this,le).executor.executeQuery(this.compile(),n(this,le).queryId)}};let Ut=dr;le=new WeakMap,Q(Ea,"don't await AlterTableBuilder instances"),Q(_i,"don't await AlterColumnBuilder instances"),Q(Ut,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Ta extends Js{transformValue(e){return{...super.transformValue(e),immediate:!0}}}const xt=class{constructor(e){w(this,H,void 0);g(this,H,a(e))}ifNotExists(){return new xt({...n(this,H),node:Pt.cloneWith(n(this,H).node,{ifNotExists:!0})})}unique(){return new xt({...n(this,H),node:Pt.cloneWith(n(this,H).node,{unique:!0})})}on(e){return new xt({...n(this,H),node:Pt.cloneWith(n(this,H).node,{table:Ue(e)})})}column(e){return new xt({...n(this,H),node:Pt.cloneWithColumns(n(this,H).node,[Vo(e)])})}columns(e){return new xt({...n(this,H),node:Pt.cloneWithColumns(n(this,H).node,e.map(Vo))})}expression(e){return new xt({...n(this,H),node:Pt.cloneWithColumns(n(this,H).node,[e.toOperationNode()])})}using(e){return new xt({...n(this,H),node:Pt.cloneWith(n(this,H).node,{using:Te.createWithSql(e)})})}where(...e){const r=new Ta;return new xt({...n(this,H),node:C.cloneWithWhere(n(this,H).node,r.transformNode($e(e)))})}$call(e){return e(this)}toOperationNode(){return n(this,H).executor.transformQuery(n(this,H).node,n(this,H).queryId)}compile(){return n(this,H).executor.compileQuery(this.toOperationNode(),n(this,H).queryId)}async execute(){await n(this,H).executor.executeQuery(this.compile(),n(this,H).queryId)}};let Ui=xt;H=new WeakMap,Q(Ui,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");const no=class{constructor(e){w(this,Ge,void 0);g(this,Ge,a(e))}ifNotExists(){return new no({...n(this,Ge),node:Bo.cloneWith(n(this,Ge).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Ge).executor.transformQuery(n(this,Ge).node,n(this,Ge).queryId)}compile(){return n(this,Ge).executor.compileQuery(this.toOperationNode(),n(this,Ge).queryId)}async execute(){await n(this,Ge).executor.executeQuery(this.compile(),n(this,Ge).queryId)}};let Vi=no;Ge=new WeakMap,Q(Vi,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");const ic=a({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return a({kind:"PrimaryKeyConstraintNode",columns:a(t.map(he.create)),name:e?ue.create(e):void 0})}});function sc(t){if(Xu.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}const nt=class{constructor(e){w(this,U,void 0);g(this,U,a(e))}temporary(){return new nt({...n(this,U),node:at.cloneWith(n(this,U).node,{temporary:!0})})}onCommit(e){return new nt({...n(this,U),node:at.cloneWith(n(this,U).node,{onCommit:sc(e)})})}ifNotExists(){return new nt({...n(this,U),node:at.cloneWith(n(this,U).node,{ifNotExists:!0})})}addColumn(e,r,u=Cr){const d=u(new Qt(ce.create(e,Rr(r))));return new nt({...n(this,U),node:at.cloneWithColumn(n(this,U).node,d.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new nt({...n(this,U),node:at.cloneWithConstraint(n(this,U).node,ic.create(r,e))})}addUniqueConstraint(e,r){return new nt({...n(this,U),node:at.cloneWithConstraint(n(this,U).node,Ia.create(r,e))})}addCheckConstraint(e,r){return new nt({...n(this,U),node:at.cloneWithConstraint(n(this,U).node,Hs.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,u,d,b=Cr){const k=b(new Cn(Mi.create(r.map(he.create),Ue(u),d.map(he.create),e)));return new nt({...n(this,U),node:at.cloneWithConstraint(n(this,U).node,k.toOperationNode())})}modifyFront(e){return new nt({...n(this,U),node:at.cloneWithFrontModifier(n(this,U).node,e.toOperationNode())})}modifyEnd(e){return new nt({...n(this,U),node:at.cloneWithEndModifier(n(this,U).node,e.toOperationNode())})}$call(e){return e(this)}call(e){return this.$call(e)}toOperationNode(){return n(this,U).executor.transformQuery(n(this,U).node,n(this,U).queryId)}compile(){return n(this,U).executor.compileQuery(this.toOperationNode(),n(this,U).queryId)}async execute(){await n(this,U).executor.executeQuery(this.compile(),n(this,U).queryId)}};let ji=nt;U=new WeakMap,Q(ji,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");const Fn=class{constructor(e){w(this,Ce,void 0);g(this,Ce,a(e))}on(e){return new Fn({...n(this,Ce),node:fi.cloneWith(n(this,Ce).node,{table:Ue(e)})})}ifExists(){return new Fn({...n(this,Ce),node:fi.cloneWith(n(this,Ce).node,{ifExists:!0})})}cascade(){return new Fn({...n(this,Ce),node:fi.cloneWith(n(this,Ce).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Ce).executor.transformQuery(n(this,Ce).node,n(this,Ce).queryId)}compile(){return n(this,Ce).executor.compileQuery(this.toOperationNode(),n(this,Ce).queryId)}async execute(){await n(this,Ce).executor.executeQuery(this.compile(),n(this,Ce).queryId)}};let $i=Fn;Ce=new WeakMap,Q($i,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");const us=class{constructor(e){w(this,Me,void 0);g(this,Me,a(e))}ifExists(){return new us({...n(this,Me),node:Ms.cloneWith(n(this,Me).node,{ifExists:!0})})}cascade(){return new us({...n(this,Me),node:Ms.cloneWith(n(this,Me).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Me).executor.transformQuery(n(this,Me).node,n(this,Me).queryId)}compile(){return n(this,Me).executor.compileQuery(this.toOperationNode(),n(this,Me).queryId)}async execute(){await n(this,Me).executor.executeQuery(this.compile(),n(this,Me).queryId)}};let Ji=us;Me=new WeakMap,Q(Ji,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");const hs=class{constructor(e){w(this,Pe,void 0);g(this,Pe,a(e))}ifExists(){return new hs({...n(this,Pe),node:Ps.cloneWith(n(this,Pe).node,{ifExists:!0})})}cascade(){return new hs({...n(this,Pe),node:Ps.cloneWith(n(this,Pe).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Pe).executor.transformQuery(n(this,Pe).node,n(this,Pe).queryId)}compile(){return n(this,Pe).executor.compileQuery(this.toOperationNode(),n(this,Pe).queryId)}async execute(){await n(this,Pe).executor.executeQuery(this.compile(),n(this,Pe).queryId)}};let Gi=hs;Pe=new WeakMap,Q(Gi,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Vt=a({is(t){return t.kind==="CreateViewNode"},create(t){return a({kind:"CreateViewNode",name:_t.create(t)})},cloneWith(t,e){return a({...t,...e})}});class oc{constructor(){w(this,cs,new Ta)}transformQuery(e){return n(this,cs).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}cs=new WeakMap;const $t=class{constructor(e){w(this,ae,void 0);g(this,ae,a(e))}temporary(){return new $t({...n(this,ae),node:Vt.cloneWith(n(this,ae).node,{temporary:!0})})}materialized(){return new $t({...n(this,ae),node:Vt.cloneWith(n(this,ae).node,{materialized:!0})})}ifNotExists(){return new $t({...n(this,ae),node:Vt.cloneWith(n(this,ae).node,{ifNotExists:!0})})}orReplace(){return new $t({...n(this,ae),node:Vt.cloneWith(n(this,ae).node,{orReplace:!0})})}columns(e){return new $t({...n(this,ae),node:Vt.cloneWith(n(this,ae).node,{columns:e.map(Uo)})})}as(e){const r=e.withPlugin(new oc).toOperationNode();return new $t({...n(this,ae),node:Vt.cloneWith(n(this,ae).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return n(this,ae).executor.transformQuery(n(this,ae).node,n(this,ae).queryId)}compile(){return n(this,ae).executor.compileQuery(this.toOperationNode(),n(this,ae).queryId)}async execute(){await n(this,ae).executor.executeQuery(this.compile(),n(this,ae).queryId)}};let Ki=$t;ae=new WeakMap,Q(Ki,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const zi=a({is(t){return t.kind==="DropViewNode"},create(t){return a({kind:"DropViewNode",name:_t.create(t)})},cloneWith(t,e){return a({...t,...e})}}),Qn=class{constructor(e){w(this,ke,void 0);g(this,ke,a(e))}materialized(){return new Qn({...n(this,ke),node:zi.cloneWith(n(this,ke).node,{materialized:!0})})}ifExists(){return new Qn({...n(this,ke),node:zi.cloneWith(n(this,ke).node,{ifExists:!0})})}cascade(){return new Qn({...n(this,ke),node:zi.cloneWith(n(this,ke).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,ke).executor.transformQuery(n(this,ke).node,n(this,ke).queryId)}compile(){return n(this,ke).executor.compileQuery(this.toOperationNode(),n(this,ke).queryId)}async execute(){await n(this,ke).executor.executeQuery(this.compile(),n(this,ke).queryId)}};let Hi=Qn;ke=new WeakMap,Q(Hi,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Aa=a({is(t){return t.kind==="CreateTypeNode"},create(t){return a({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return a({...t,enum:Us.create(e.map(r=>vt.createImmediate(r)))})}}),io=class{constructor(e){w(this,Ke,void 0);g(this,Ke,a(e))}toOperationNode(){return n(this,Ke).executor.transformQuery(n(this,Ke).node,n(this,Ke).queryId)}asEnum(e){return new io({...n(this,Ke),node:Aa.cloneWithEnum(n(this,Ke).node,e)})}$call(e){return e(this)}compile(){return n(this,Ke).executor.compileQuery(this.toOperationNode(),n(this,Ke).queryId)}async execute(){await n(this,Ke).executor.executeQuery(this.compile(),n(this,Ke).queryId)}};let Yi=io;Ke=new WeakMap,Q(Yi,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Sa=a({is(t){return t.kind==="DropTypeNode"},create(t){return a({kind:"DropTypeNode",name:t})},cloneWith(t,e){return a({...t,...e})}}),so=class{constructor(e){w(this,ze,void 0);g(this,ze,a(e))}ifExists(){return new so({...n(this,ze),node:Sa.cloneWith(n(this,ze).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,ze).executor.transformQuery(n(this,ze).node,n(this,ze).queryId)}compile(){return n(this,ze).executor.compileQuery(this.toOperationNode(),n(this,ze).queryId)}async execute(){await n(this,ze).executor.executeQuery(this.compile(),n(this,ze).queryId)}};let Xi=so;ze=new WeakMap,Q(Xi,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function Da(t){const e=".";if(t.includes(e)){const r=t.split(e).map(ac);if(r.length===2)return _t.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return _t.create(t)}function ac(t){return t.trim()}const Un=class{constructor(e){w(this,xe,void 0);g(this,xe,e)}createTable(e){return new ji({queryId:G(),executor:n(this,xe),node:at.create(Ue(e))})}dropTable(e){return new Gi({queryId:G(),executor:n(this,xe),node:Ps.create(Ue(e))})}createIndex(e){return new Ui({queryId:G(),executor:n(this,xe),node:Pt.create(e)})}dropIndex(e){return new $i({queryId:G(),executor:n(this,xe),node:fi.create(e)})}createSchema(e){return new Vi({queryId:G(),executor:n(this,xe),node:Bo.create(e)})}dropSchema(e){return new Ji({queryId:G(),executor:n(this,xe),node:Ms.create(e)})}alterTable(e){return new Ea({queryId:G(),executor:n(this,xe),node:ye.create(Ue(e))})}createView(e){return new Ki({queryId:G(),executor:n(this,xe),node:Vt.create(e)})}dropView(e){return new Hi({queryId:G(),executor:n(this,xe),node:zi.create(e)})}createType(e){return new Yi({queryId:G(),executor:n(this,xe),node:Aa.create(Da(e))})}dropType(e){return new Xi({queryId:G(),executor:n(this,xe),node:Sa.create(Da(e))})}withPlugin(e){return new Un(n(this,xe).withPlugin(e))}withoutPlugins(){return new Un(n(this,xe).withoutPlugins())}withSchema(e){return new Un(n(this,xe).withPluginAtFront(new Wn(e)))}};let Xs=Un;xe=new WeakMap;class uc{ref(e){return new ph(e)}}class hc{constructor(e){w(this,Yr,void 0);g(this,Yr,e)}async provideConnection(e){const r=await n(this,Yr).acquireConnection();try{return await e(r)}finally{await n(this,Yr).releaseConnection(r)}}}Yr=new WeakMap;const fr=class extends ha{constructor(r,u,d,b=[]){super(b);w(this,Wt,void 0);w(this,Ot,void 0);w(this,St,void 0);g(this,Wt,r),g(this,Ot,u),g(this,St,d)}get adapter(){return n(this,Ot)}compileQuery(r){return n(this,Wt).compileQuery(r)}provideConnection(r){return n(this,St).provideConnection(r)}withPlugins(r){return new fr(n(this,Wt),n(this,Ot),n(this,St),[...this.plugins,...r])}withPlugin(r){return new fr(n(this,Wt),n(this,Ot),n(this,St),[...this.plugins,r])}withPluginAtFront(r){return new fr(n(this,Wt),n(this,Ot),n(this,St),[r,...this.plugins])}withConnectionProvider(r){return new fr(n(this,Wt),n(this,Ot),r,[...this.plugins])}withoutPlugins(){return new fr(n(this,Wt),n(this,Ot),n(this,St),[])}};let Zs=fr;Wt=new WeakMap,Ot=new WeakMap,St=new WeakMap;function Ra(){return typeof performance<"u"&&Ze(performance.now)?performance.now():Date.now()}class cc{constructor(e,r){w(this,ls);w(this,ds);w(this,fs);w(this,ps);w(this,jn);w(this,ft,void 0);w(this,Jt,void 0);w(this,Dt,void 0);w(this,pr,void 0);w(this,Vn,new WeakSet);g(this,ft,e),g(this,Jt,r)}async init(){n(this,Dt)||g(this,Dt,n(this,ft).init().catch(e=>(g(this,Dt,void 0),Promise.reject(e)))),await n(this,Dt)}async acquireConnection(){await this.init();const e=await n(this,ft).acquireConnection();return n(this,Vn).has(e)||(X(this,ls,ju).call(this)&&X(this,ds,$u).call(this,e),n(this,Vn).add(e)),e}async releaseConnection(e){await n(this,ft).releaseConnection(e)}beginTransaction(e,r){return n(this,ft).beginTransaction(e,r)}commitTransaction(e){return n(this,ft).commitTransaction(e)}rollbackTransaction(e){return n(this,ft).rollbackTransaction(e)}async destroy(){n(this,Dt)&&(await n(this,Dt),n(this,pr)||g(this,pr,n(this,ft).destroy().catch(e=>(g(this,pr,void 0),Promise.reject(e)))),await n(this,pr))}}ft=new WeakMap,Jt=new WeakMap,Dt=new WeakMap,pr=new WeakMap,Vn=new WeakMap,ls=new WeakSet,ju=function(){return n(this,Jt).isLevelEnabled("query")||n(this,Jt).isLevelEnabled("error")},ds=new WeakSet,$u=function(e){const r=e.executeQuery;e.executeQuery=async u=>{const d=Ra();try{return await r.call(e,u)}catch(b){throw await X(this,fs,Ju).call(this,b,u,d),b}finally{await X(this,ps,Gu).call(this,u,d)}}},fs=new WeakSet,Ju=async function(e,r,u){await n(this,Jt).error(()=>({level:"error",error:e,query:r,queryDurationMillis:X(this,jn,So).call(this,u)}))},ps=new WeakSet,Gu=async function(e,r){await n(this,Jt).query(()=>({level:"query",query:e,queryDurationMillis:X(this,jn,So).call(this,r)}))},jn=new WeakSet,So=function(e){return Ra()-e};class La{constructor(e){w(this,ms);w(this,$n,void 0);w(this,Gt,void 0);g(this,$n,e)}async provideConnection(e){for(;n(this,Gt);)await n(this,Gt);const r=X(this,ms,Ku).call(this,e);return g(this,Gt,r.then(()=>{g(this,Gt,void 0)}).catch(()=>{g(this,Gt,void 0)})),r}}$n=new WeakMap,Gt=new WeakMap,ms=new WeakSet,Ku=async function(e){return await e(n(this,$n))};const lc=["read uncommitted","read committed","repeatable read","serializable"];a(["query","error"]);class dc{constructor(e){w(this,Kt,void 0);w(this,mr,void 0);Ze(e)?(g(this,mr,e),g(this,Kt,a({query:!0,error:!0}))):(g(this,mr,fc),g(this,Kt,a({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return n(this,Kt)[e]}async query(e){n(this,Kt).query&&await n(this,mr).call(this,e())}async error(e){n(this,Kt).error&&await n(this,mr).call(this,e())}}Kt=new WeakMap,mr=new WeakMap;function fc(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function pc(t){return wt(t)&&Ze(t.compile)}const Xr=class extends Ei{constructor(r){let u,d;if(mc(r))u={executor:r.executor},d={...r};else{const b=r.dialect,k=b.createDriver(),I=b.createQueryCompiler(),j=b.createAdapter(),c=new dc(r.log??[]),_e=new cc(k,c),Fe=new hc(_e),P=new Zs(I,j,Fe,r.plugins??[]);u={executor:P},d={config:r,executor:P,dialect:b,driver:_e}}super(u);w(this,Ie,void 0);g(this,Ie,a(d))}get schema(){return new Xs(n(this,Ie).executor)}get dynamic(){return new uc}get introspection(){return n(this,Ie).dialect.createIntrospector(this.withoutPlugins())}case(r){return new wa({node:ut.create(J(r)?void 0:Si(r))})}get fn(){return Na()}transaction(){return new Zi({...n(this,Ie)})}connection(){return new Ba({...n(this,Ie)})}withPlugin(r){return new Xr({...n(this,Ie),executor:n(this,Ie).executor.withPlugin(r)})}withoutPlugins(){return new Xr({...n(this,Ie),executor:n(this,Ie).executor.withoutPlugins()})}withSchema(r){return new Xr({...n(this,Ie),executor:n(this,Ie).executor.withPluginAtFront(new Wn(r))})}withTables(){return new Xr({...n(this,Ie)})}async destroy(){await n(this,Ie).driver.destroy()}get isTransaction(){return!1}getExecutor(){return n(this,Ie).executor}executeQuery(r,u=G()){const d=pc(r)?r.compile():r;return this.getExecutor().executeQuery(d,u)}};let En=Xr;Ie=new WeakMap;const Zr=class extends En{constructor(r){super(r);w(this,pt,void 0);g(this,pt,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new Zr({...n(this,pt),executor:n(this,pt).executor.withPlugin(r)})}withoutPlugins(){return new Zr({...n(this,pt),executor:n(this,pt).executor.withoutPlugins()})}withSchema(r){return new Zr({...n(this,pt),executor:n(this,pt).executor.withPluginAtFront(new Wn(r))})}withTables(){return new Zr({...n(this,pt)})}};let eo=Zr;pt=new WeakMap;function mc(t){return wt(t)&&wt(t.config)&&wt(t.driver)&&wt(t.executor)&&wt(t.dialect)}class Ba{constructor(e){w(this,yr,void 0);g(this,yr,a(e))}async execute(e){return n(this,yr).executor.provideConnection(async r=>{const u=n(this,yr).executor.withConnectionProvider(new La(r)),d=new En({...n(this,yr),executor:u});return await e(d)})}}yr=new WeakMap,Q(Ba,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");const oo=class{constructor(e){w(this,mt,void 0);g(this,mt,a(e))}setIsolationLevel(e){return new oo({...n(this,mt),isolationLevel:e})}async execute(e){const{isolationLevel:r,...u}=n(this,mt),d={isolationLevel:r};return yc(d),n(this,mt).executor.provideConnection(async b=>{const k=n(this,mt).executor.withConnectionProvider(new La(b)),I=new eo({...u,executor:k});try{await n(this,mt).driver.beginTransaction(b,d);const j=await e(I);return await n(this,mt).driver.commitTransaction(b),j}catch(j){throw await n(this,mt).driver.rollbackTransaction(b),j}})}};let Zi=oo;mt=new WeakMap,Q(Zi,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function yc(t){if(t.isolationLevel&&!lc.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}const ys=class{constructor(e){w(this,en);w(this,Jn);w(this,Gn);w(this,Ve,void 0);g(this,Ve,a(e))}get expressionType(){}as(e){return new Nc(this,e)}$castTo(){return new ys({...n(this,Ve)})}castTo(){return this.$castTo()}withPlugin(e){return new ys({...n(this,Ve),plugins:n(this,Ve).plugins!==void 0?a([...n(this,Ve).plugins,e]):a([e])})}toOperationNode(){return X(this,Jn,Do).call(this,X(this,en,Bs).call(this))}compile(e){return X(this,Gn,Ro).call(this,X(this,en,Bs).call(this,e))}async execute(e){const r=X(this,en,Bs).call(this,e);return r.executeQuery(X(this,Gn,Ro).call(this,r),n(this,Ve).queryId)}};let ht=ys;Ve=new WeakMap,en=new WeakSet,Bs=function(e){const r=e!==void 0?e.getExecutor():Ti;return n(this,Ve).plugins!==void 0?r.withPlugins(n(this,Ve).plugins):r},Jn=new WeakSet,Do=function(e){return e.transformQuery(n(this,Ve).rawNode,n(this,Ve).queryId)},Gn=new WeakSet,Ro=function(e){return e.compileQuery(X(this,Jn,Do).call(this,e),n(this,Ve).queryId)},Q(ht,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class Nc{constructor(e,r){w(this,tn,void 0);w(this,zt,void 0);g(this,tn,e),g(this,zt,r)}get expression(){return n(this,tn)}get alias(){return n(this,zt)}toOperationNode(){return ir.create(n(this,tn).toOperationNode(),Le(n(this,zt))?n(this,zt).toOperationNode():ue.create(n(this,zt)))}}tn=new WeakMap,zt=new WeakMap;const Je=Object.assign((t,...e)=>new ht({queryId:G(),rawNode:Te.create(t,(e==null?void 0:e.map(Tt))??[])}),{ref(t){return new ht({queryId:G(),rawNode:Te.createWithChild(Ir(t))})},val(t){return new ht({queryId:G(),rawNode:Te.createWithChild(Tt(t))})},value(t){return this.val(t)},table(t){return new ht({queryId:G(),rawNode:Te.createWithChild(Ue(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",new ht({queryId:G(),rawNode:Te.create(e,t.map(ue.create))})},lit(t){return new ht({queryId:G(),rawNode:Te.createWithChild(vt.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return new ht({queryId:G(),rawNode:Te.createWithSql(t)})},join(t,e=Je`, `){const r=new Array(2*t.length-1),u=e.toOperationNode();for(let d=0;d<t.length;++d)r[2*d]=Tt(t[d]),d!==t.length-1&&(r[2*d+1]=u);return new ht({queryId:G(),rawNode:Te.createWithChildren(r)})}});class wc{constructor(){Xe(this,"nodeStack",[]);w(this,Ns,a({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this)}));Xe(this,"visitNode",e=>{this.nodeStack.push(e),n(this,Ns)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Ns=new WeakMap;class vc extends wc{constructor(){super(...arguments);w(this,rn,"");w(this,Nr,[])}get numParameters(){return n(this,Nr).length}compileQuery(r){return g(this,rn,""),g(this,Nr,[]),this.visitNode(r),a({query:r,sql:this.getSql(),parameters:[...n(this,Nr)]})}getSql(){return n(this,rn)}visitSelectQuery(r){const u=this.parentNode!==void 0&&!gt.is(this.parentNode)&&!Vt.is(this.parentNode)&&!ya.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select "),r.distinctOn&&(this.compileDistinctOn(r.distinctOn),this.append(" ")),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.selections&&(this.compileList(r.selections),this.append(" ")),this.visitNode(r.from),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," ")),u&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,u=", "){const d=r.length-1;for(let b=0;b<=d;b++)this.visitNode(r[b]),b<d&&this.append(u)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const u=this.nodeStack.find(C.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const u=this.nodeStack.find(C.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){this.visitNode(r.table),this.append("."),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!_(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:u}=r;for(let d=0;d<u.length;++d)this.appendValue(u[d]),d!==u.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(bc[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:u,parameters:d}=r;for(let b=0;b<u.length;++b)this.append(u[b]),d.length>b&&this.visitNode(d[b])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const u=this.nodeStack.find(C.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileList(r.columnAlterations)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(gc[r.modifier])}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return _s.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}append(r){g(this,rn,n(this,rn)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const u=this.getLeftIdentifierWrapper(),d=this.getRightIdentifierWrapper();let b="";for(const k of r)b+=k,k===u?b+=u:k===d&&(b+=d);return b}addParameter(r){n(this,Nr).push(r)}appendImmediateValue(r){if(_(r))this.append(`'${r}'`);else if(me(r)||dn(r))this.append(r.toString());else if(Lo(r))this.append("null");else if(Hu(r))this.appendImmediateValue(r.toISOString());else if(Yu(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}}rn=new WeakMap,Nr=new WeakMap;const gc=a({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),bc=a({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),Lr=a({raw(t){return a({sql:t,query:Te.createWithSql(t),parameters:a([])})}}),xc=/"/g;class Wc extends vc{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(xc,'""')}visitDefaultInsertValue(e){this.append("null")}}const Oc="kysely_migration",qc="kysely_migration_lock";a({__noMigrations__:!0});class Cc{constructor(e){w(this,ws);w(this,nn,void 0);g(this,nn,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=n(this,nn).selectFrom("sqlite_schema").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",Oc).where("name","!=",qc));const u=await r.execute();return Promise.all(u.map(({name:d})=>X(this,ws,zu).call(this,d)))}async getMetadata(e){return{tables:await this.getTables(e)}}}nn=new WeakMap,ws=new WeakSet,zu=async function(e){var k,I,j,c,_e,Fe;const r=n(this,nn),u=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),d=(Fe=(_e=(c=(j=(I=(k=u.sql)==null?void 0:k.split(/[\(\),]/))==null?void 0:I.find(P=>P.toLowerCase().includes("autoincrement")))==null?void 0:j.trimStart())==null?void 0:c.split(/\s+/))==null?void 0:_e[0])==null?void 0:Fe.replace(/["`]/g,""),b=await r.selectFrom(Je`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:u.type==="view",columns:b.map(P=>({name:P.name,dataType:P.type,isNullable:!P.notnull,isAutoIncrementing:P.name===d,hasDefaultValue:P.dflt_value!=null}))}};class kc{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(){}async releaseMigrationLock(){}}var Ic=class{createQueryCompiler(){return new Wc}createAdapter(){return new kc}createIntrospector(t){return new Cc(t)}},Ec=(Fa=class{constructor(){w(this,Kn,new Tc);Xe(this,"connection");w(this,vs,void 0)}async acquireConnection(){return await n(this,Kn).lock(),this.connection}async beginTransaction(t){await t.executeQuery(Lr.raw("begin"))}async commitTransaction(t){await t.executeQuery(Lr.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(Lr.raw("rollback"))}async releaseConnection(){n(this,Kn).unlock()}async destroy(){var t;(t=n(this,vs))==null||t.close()}},Kn=new WeakMap,vs=new WeakMap,Fa),Tc=(Qa=class{constructor(){w(this,wr,void 0);w(this,sn,void 0)}async lock(){for(;n(this,wr);)await n(this,wr);g(this,wr,new Promise(t=>{g(this,sn,t)}))}unlock(){const t=n(this,sn);g(this,wr,void 0),g(this,sn,void 0),t==null||t()}},wr=new WeakMap,sn=new WeakMap,Qa),Ac=class{streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}async executeQuery(t){const{parameters:e,sql:r,query:u}=t;return["SelectQueryNode","RawNode"].includes(u.kind)?{rows:await this.query(r,e)}:{rows:[],...await this.exec(r,e)}}};function Sc({func:t,delay:e,maxCalls:r}){let u,d=0,b=null;function k(){u&&clearTimeout(u),d=0,b=null}function I(){d>=r?(t(b),k()):(u&&clearTimeout(u),u=setTimeout(()=>{t(b),k(),u=void 0},e))}return j=>{d++,b=j,u===void 0&&d===0?(t(j),d++):I()}}var Dc=(Ua=class extends Ec{constructor(e){super();w(this,He,void 0);w(this,on,void 0);g(this,He,e)}async init(){var e,r,u,d;if(g(this,on,typeof n(this,He).database=="function"?await n(this,He).database():n(this,He).database),!n(this,on))throw new Error("no database");this.connection=new Rc(n(this,on),(e=n(this,He).onWrite)==null?void 0:e.func,(r=n(this,He).onWrite)==null?void 0:r.isThrottle,(u=n(this,He).onWrite)==null?void 0:u.maxCalls,(d=n(this,He).onWrite)==null?void 0:d.delay),n(this,He).onCreateConnection&&await n(this,He).onCreateConnection(this.connection)}async beginTransaction(e){await e.executeQuery(Lr.raw("begin")),this.connection&&this.connection.transactionNum++}async commitTransaction(e){await e.executeQuery(Lr.raw("commit")),this.connection&&this.connection.transactionNum--}async rollbackTransaction(e){await e.executeQuery(Lr.raw("rollback")),this.connection&&this.connection.transactionNum--}},He=new WeakMap,on=new WeakMap,Ua),Rc=(Va=class extends Ac{constructor(e,r,u=!1,d=1e3,b=2e3){super();w(this,Ht,void 0);w(this,an,void 0);Xe(this,"transactionNum",0);g(this,Ht,e),g(this,an,r?u?Sc({func:r,maxCalls:d,delay:b}):r:void 0)}query(e,r){const u=n(this,Ht).prepare(e);u.bind(r);const d=[];for(;u.step();)d.push(u.getAsObject());return u.free(),d}exec(e,r){n(this,Ht).run(e,r);const u=BigInt(this.query("SELECT last_insert_rowid() as id")[0].id),d=BigInt(n(this,Ht).getRowsModified());return this.transactionNum===0&&n(this,an)&&n(this,an).call(this,n(this,Ht).export()),{numAffectedRows:d,insertId:u}}},Ht=new WeakMap,an=new WeakMap,Va),Lc=(ja=class extends Ic{constructor(e){super();w(this,zn,void 0);g(this,zn,e)}createDriver(){return new Dc(n(this,zn))}},zn=new WeakMap,ja);function Bc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Mc(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function u(){if(this instanceof u){var d=[null];d.push.apply(d,arguments);var b=Function.bind.apply(e,d);return new b}return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(u){var d=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(r,u,d.get?d:{enumerable:!0,get:function(){return t[u]}})}),r}var Ma={exports:{}},Pc={},_c=Object.freeze({__proto__:null,default:Pc}),es=Mc(_c);(function(t,e){var r=void 0,u=function(d){return r||(r=new Promise(function(b,k){var I=typeof d<"u"?d:{},j=I.onAbort;I.onAbort=function(i){k(new Error(i)),j&&j(i)},I.postRun=I.postRun||[],I.postRun.push(function(){b(I)}),t=void 0;var c;c||(c=typeof I<"u"?I:{}),c.onRuntimeInitialized=function(){function i(f,v){switch(typeof v){case"boolean":Gl(f,v?1:0);break;case"number":jl(f,v);break;case"string":$l(f,v,-1,-1);break;case"object":if(v===null)_u(f);else if(v.length!=null){var O=Io(v);Jl(f,O,v.length,-1),Ds(O)}else Ls(f,"Wrong API use : tried to return a value of an unknown type ("+v+").",-1);break;default:_u(f)}}function s(f,v){for(var O=[],E=0;E<f;E+=1){var M=Lt(v+4*E,"i32"),$=_l(M);if($===1||$===2)M=Vl(M);else if($===3)M=Ql(M);else if($===4){$=M,M=Fl($),$=Ul($);for(var kt=new Uint8Array(M),Ye=0;Ye<M;Ye+=1)kt[Ye]=we[$+Ye];M=kt}else M=null;O.push(M)}return O}function o(f,v){this.La=f,this.db=v,this.Ja=1,this.fb=[]}function h(f,v){if(this.db=v,v=hn(f)+1,this.Ya=Ss(v),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");br(f,qt,this.Ya,v),this.eb=this.Ya,this.Ua=this.ib=null}function l(f){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),f!=null){var v=this.filename,O="/",E=v;if(O&&(O=typeof O=="string"?O:ii(O),E=v?Bt(O+"/"+v):O),v=Cu(!0,!0),E=qs(E,(v!==void 0?v:438)&4095|32768,0),f){if(typeof f=="string"){O=Array(f.length);for(var M=0,$=f.length;M<$;++M)O[M]=f.charCodeAt(M);f=O}ks(E,v|146),O=ln(E,577),Wu(O,f,0,f.length,0),go(O),ks(E,v)}}this.handleError(A(this.filename,p)),this.db=Lt(p,"i32"),Kl(this.db),this.Za={},this.Na={}}var p=nr(4),y=c.cwrap,A=y("sqlite3_open","number",["string","number"]),V=y("sqlite3_close_v2","number",["number"]),F=y("sqlite3_exec","number",["number","string","number","number","number"]),pe=y("sqlite3_changes","number",["number"]),Mt=y("sqlite3_prepare_v2","number",["number","string","number","number","number"]),Ru=y("sqlite3_sql","string",["number"]),xl=y("sqlite3_normalized_sql","string",["number"]),Lu=y("sqlite3_prepare_v2","number",["number","number","number","number","number"]),Wl=y("sqlite3_bind_text","number",["number","number","number","number","number"]),Bu=y("sqlite3_bind_blob","number",["number","number","number","number","number"]),Ol=y("sqlite3_bind_double","number",["number","number","number"]),ql=y("sqlite3_bind_int","number",["number","number","number"]),Cl=y("sqlite3_bind_parameter_index","number",["number","string"]),kl=y("sqlite3_step","number",["number"]),Il=y("sqlite3_errmsg","string",["number"]),El=y("sqlite3_column_count","number",["number"]),Tl=y("sqlite3_data_count","number",["number"]),Al=y("sqlite3_column_double","number",["number","number"]),Mu=y("sqlite3_column_text","string",["number","number"]),Sl=y("sqlite3_column_blob","number",["number","number"]),Dl=y("sqlite3_column_bytes","number",["number","number"]),Rl=y("sqlite3_column_type","number",["number","number"]),Ll=y("sqlite3_column_name","string",["number","number"]),Bl=y("sqlite3_reset","number",["number"]),Ml=y("sqlite3_clear_bindings","number",["number"]),Pl=y("sqlite3_finalize","number",["number"]),Pu=y("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),_l=y("sqlite3_value_type","number",["number"]),Fl=y("sqlite3_value_bytes","number",["number"]),Ql=y("sqlite3_value_text","string",["number"]),Ul=y("sqlite3_value_blob","number",["number"]),Vl=y("sqlite3_value_double","number",["number"]),jl=y("sqlite3_result_double","",["number","number"]),_u=y("sqlite3_result_null","",["number"]),$l=y("sqlite3_result_text","",["number","string","number","number"]),Jl=y("sqlite3_result_blob","",["number","number","number","number"]),Gl=y("sqlite3_result_int","",["number","number"]),Ls=y("sqlite3_result_error","",["number","string","number"]),Fu=y("sqlite3_aggregate_context","number",["number","number"]),Kl=y("RegisterExtensionFunctions","number",["number"]);o.prototype.bind=function(f){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(f)?this.xb(f):f!=null&&typeof f=="object"?this.yb(f):!0},o.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var f=kl(this.La);switch(f){case 100:return!0;case 101:return!1;default:throw this.db.handleError(f)}},o.prototype.sb=function(f){return f==null&&(f=this.Ja,this.Ja+=1),Al(this.La,f)},o.prototype.Cb=function(f){if(f==null&&(f=this.Ja,this.Ja+=1),f=Mu(this.La,f),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(f)},o.prototype.Db=function(f){return f==null&&(f=this.Ja,this.Ja+=1),Mu(this.La,f)},o.prototype.getBlob=function(f){f==null&&(f=this.Ja,this.Ja+=1);var v=Dl(this.La,f);f=Sl(this.La,f);for(var O=new Uint8Array(v),E=0;E<v;E+=1)O[E]=we[f+E];return O},o.prototype.get=function(f,v){v=v||{},f!=null&&this.bind(f)&&this.step(),f=[];for(var O=Tl(this.La),E=0;E<O;E+=1)switch(Rl(this.La,E)){case 1:var M=v.useBigInt?this.Cb(E):this.sb(E);f.push(M);break;case 2:f.push(this.sb(E));break;case 3:f.push(this.Db(E));break;case 4:f.push(this.getBlob(E));break;default:f.push(null)}return f},o.prototype.getColumnNames=function(){for(var f=[],v=El(this.La),O=0;O<v;O+=1)f.push(Ll(this.La,O));return f},o.prototype.getAsObject=function(f,v){f=this.get(f,v),v=this.getColumnNames();for(var O={},E=0;E<v.length;E+=1)O[v[E]]=f[E];return O},o.prototype.getSQL=function(){return Ru(this.La)},o.prototype.getNormalizedSQL=function(){return xl(this.La)},o.prototype.run=function(f){return f!=null&&this.bind(f),this.step(),this.reset()},o.prototype.nb=function(f,v){v==null&&(v=this.Ja,this.Ja+=1),f=iu(f);var O=Io(f);this.fb.push(O),this.db.handleError(Wl(this.La,v,O,f.length-1,0))},o.prototype.wb=function(f,v){v==null&&(v=this.Ja,this.Ja+=1);var O=Io(f);this.fb.push(O),this.db.handleError(Bu(this.La,v,O,f.length,0))},o.prototype.mb=function(f,v){v==null&&(v=this.Ja,this.Ja+=1),this.db.handleError((f===(f|0)?ql:Ol)(this.La,v,f))},o.prototype.zb=function(f){f==null&&(f=this.Ja,this.Ja+=1),Bu(this.La,f,0,0,0)},o.prototype.ob=function(f,v){switch(v==null&&(v=this.Ja,this.Ja+=1),typeof f){case"string":this.nb(f,v);return;case"number":this.mb(f,v);return;case"bigint":this.nb(f.toString(),v);return;case"boolean":this.mb(f+0,v);return;case"object":if(f===null){this.zb(v);return}if(f.length!=null){this.wb(f,v);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+f+")."},o.prototype.yb=function(f){var v=this;return Object.keys(f).forEach(function(O){var E=Cl(v.La,O);E!==0&&v.ob(f[O],E)}),!0},o.prototype.xb=function(f){for(var v=0;v<f.length;v+=1)this.ob(f[v],v+1);return!0},o.prototype.reset=function(){return this.freemem(),Ml(this.La)===0&&Bl(this.La)===0},o.prototype.freemem=function(){for(var f;(f=this.fb.pop())!==void 0;)Ds(f)},o.prototype.free=function(){this.freemem();var f=Pl(this.La)===0;return delete this.db.Za[this.La],this.La=0,f},h.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var f=hi(),v=nr(4);ni(p),ni(v);try{this.db.handleError(Lu(this.db.db,this.eb,-1,p,v)),this.eb=Lt(v,"i32");var O=Lt(p,"i32");return O===0?(this.gb(),{done:!0}):(this.Ua=new o(O,this.db),this.db.Za[O]=this.Ua,{value:this.Ua,done:!1})}catch(E){throw this.ib=We(this.eb),this.gb(),E}finally{ci(f)}},h.prototype.gb=function(){Ds(this.Ya),this.Ya=null},h.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:We(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(h.prototype[Symbol.iterator]=function(){return this}),l.prototype.run=function(f,v){if(!this.db)throw"Database closed";if(v){f=this.prepare(f,v);try{f.step()}finally{f.free()}}else this.handleError(F(this.db,f,0,0,p));return this},l.prototype.exec=function(f,v,O){if(!this.db)throw"Database closed";var E=hi(),M=null;try{var $=hn(f)+1,kt=nr($);br(f,we,kt,$);var Ye=kt,st=nr(4);for(f=[];Lt(Ye,"i8")!==0;){ni(p),ni(st),this.handleError(Lu(this.db,Ye,-1,p,st));var ot=Lt(p,"i32");if(Ye=Lt(st,"i32"),ot!==0){for($=null,M=new o(ot,this),v!=null&&M.bind(v);M.step();)$===null&&($={columns:M.getColumnNames(),values:[]},f.push($)),$.values.push(M.get(null,O));M.free()}}return f}catch(li){throw M&&M.free(),li}finally{ci(E)}},l.prototype.each=function(f,v,O,E,M){typeof v=="function"&&(E=O,O=v,v=void 0),f=this.prepare(f,v);try{for(;f.step();)O(f.getAsObject(null,M))}finally{f.free()}if(typeof E=="function")return E()},l.prototype.prepare=function(f,v){if(ni(p),this.handleError(Mt(this.db,f,-1,p,0)),f=Lt(p,"i32"),f===0)throw"Nothing to prepare";var O=new o(f,this);return v!=null&&O.bind(v),this.Za[f]=O},l.prototype.iterateStatements=function(f){return new h(f,this)},l.prototype.export=function(){Object.values(this.Za).forEach(function(v){v.free()}),Object.values(this.Na).forEach(ui),this.Na={},this.handleError(V(this.db));var f=wl(this.filename);return this.handleError(A(this.filename,p)),this.db=Lt(p,"i32"),f},l.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(f){f.free()}),Object.values(this.Na).forEach(ui),this.Na={},this.handleError(V(this.db)),Nu("/"+this.filename),this.db=null)},l.prototype.handleError=function(f){if(f===0)return null;throw f=Il(this.db),Error(f)},l.prototype.getRowsModified=function(){return pe(this.db)},l.prototype.create_function=function(f,v){Object.prototype.hasOwnProperty.call(this.Na,f)&&(ui(this.Na[f]),delete this.Na[f]);var O=ko(function(E,M,$){M=s(M,$);try{var kt=v.apply(null,M)}catch(Ye){Ls(E,Ye,-1);return}i(E,kt)},"viii");return this.Na[f]=O,this.handleError(Pu(this.db,f,v.length,1,0,O,0,0,0)),this},l.prototype.create_aggregate=function(f,v){var O=v.init||function(){return null},E=v.finalize||function(st){return st},M=v.step;if(!M)throw"An aggregate function must have a step function in "+f;var $={};Object.hasOwnProperty.call(this.Na,f)&&(ui(this.Na[f]),delete this.Na[f]),v=f+"__finalize",Object.hasOwnProperty.call(this.Na,v)&&(ui(this.Na[v]),delete this.Na[v]);var kt=ko(function(st,ot,li){var qr=Fu(st,1);Object.hasOwnProperty.call($,qr)||($[qr]=O()),ot=s(ot,li),ot=[$[qr]].concat(ot);try{$[qr]=M.apply(null,ot)}catch(zl){delete $[qr],Ls(st,zl,-1)}},"viii"),Ye=ko(function(st){var ot=Fu(st,1);try{var li=E($[ot])}catch(qr){delete $[ot],Ls(st,qr,-1);return}i(st,li),delete $[ot]},"vi");return this.Na[f]=kt,this.Na[v]=Ye,this.handleError(Pu(this.db,f,M.length-1,1,0,0,kt,Ye,0)),this},c.Database=l};var _e=Object.assign({},c),Fe="./this.program",P=typeof window=="object",Re=typeof importScripts=="function",Y=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",Ee="",Zn,Rt,yt,gs,bs,ao;Y?(Ee=Re?es.dirname(Ee)+"/":__dirname+"/",ao=()=>{bs||(gs=es,bs=es)},Zn=function(i,s){return ao(),i=bs.normalize(i),gs.readFileSync(i,s?void 0:"utf8")},yt=i=>(i=Zn(i,!0),i.buffer||(i=new Uint8Array(i)),i),Rt=(i,s,o)=>{ao(),i=bs.normalize(i),gs.readFile(i,function(h,l){h?o(h):s(l.buffer)})},1<process.argv.length&&(Fe=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=c,c.inspect=function(){return"[Emscripten Module object]"}):(P||Re)&&(Re?Ee=self.location.href:typeof document<"u"&&document.currentScript&&(Ee=document.currentScript.src),Ee=Ee.indexOf("blob:")!==0?Ee.substr(0,Ee.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Zn=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.send(null),s.responseText},Re&&(yt=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),Rt=(i,s,o)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{h.status==200||h.status==0&&h.response?s(h.response):o()},h.onerror=o,h.send(null)});var Ka=c.print||console.log.bind(console),gr=c.printErr||console.warn.bind(console);Object.assign(c,_e),_e=null,c.thisProgram&&(Fe=c.thisProgram);var ei;c.wasmBinary&&(ei=c.wasmBinary),c.noExitRuntime,typeof WebAssembly!="object"&&Zt("no native wasm support detected");var uo,za=!1,Ha=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function ti(i,s,o){var h=s+o;for(o=s;i[o]&&!(o>=h);)++o;if(16<o-s&&i.buffer&&Ha)return Ha.decode(i.subarray(s,o));for(h="";s<o;){var l=i[s++];if(l&128){var p=i[s++]&63;if((l&224)==192)h+=String.fromCharCode((l&31)<<6|p);else{var y=i[s++]&63;l=(l&240)==224?(l&15)<<12|p<<6|y:(l&7)<<18|p<<12|y<<6|i[s++]&63,65536>l?h+=String.fromCharCode(l):(l-=65536,h+=String.fromCharCode(55296|l>>10,56320|l&1023))}}else h+=String.fromCharCode(l)}return h}function We(i,s){return i?ti(qt,i,s):""}function br(i,s,o,h){if(!(0<h))return 0;var l=o;h=o+h-1;for(var p=0;p<i.length;++p){var y=i.charCodeAt(p);if(55296<=y&&57343>=y){var A=i.charCodeAt(++p);y=65536+((y&1023)<<10)|A&1023}if(127>=y){if(o>=h)break;s[o++]=y}else{if(2047>=y){if(o+1>=h)break;s[o++]=192|y>>6}else{if(65535>=y){if(o+2>=h)break;s[o++]=224|y>>12}else{if(o+3>=h)break;s[o++]=240|y>>18,s[o++]=128|y>>12&63}s[o++]=128|y>>6&63}s[o++]=128|y&63}}return s[o]=0,o-l}function hn(i){for(var s=0,o=0;o<i.length;++o){var h=i.charCodeAt(o);127>=h?s++:2047>=h?s+=2:55296<=h&&57343>=h?(s+=4,++o):s+=3}return s}var ho,we,qt,xs,T,de,co,lo;function Ya(){var i=uo.buffer;ho=i,c.HEAP8=we=new Int8Array(i),c.HEAP16=xs=new Int16Array(i),c.HEAP32=T=new Int32Array(i),c.HEAPU8=qt=new Uint8Array(i),c.HEAPU16=new Uint16Array(i),c.HEAPU32=de=new Uint32Array(i),c.HEAPF32=co=new Float32Array(i),c.HEAPF64=lo=new Float64Array(i)}var Xt,Xa=[],Za=[],eu=[];function al(){var i=c.preRun.shift();Xa.unshift(i)}var xr=0,ri=null;function Zt(i){throw c.onAbort&&c.onAbort(i),i="Aborted("+i+")",gr(i),za=!0,new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info.")}function tu(){return it.startsWith("data:application/octet-stream;base64,")}var it;if(it="sql-wasm.wasm",!tu()){var ru=it;it=c.locateFile?c.locateFile(ru,Ee):Ee+ru}function nu(){var i=it;try{if(i==it&&ei)return new Uint8Array(ei);if(yt)return yt(i);throw"both async and sync fetching of the wasm failed"}catch(s){Zt(s)}}function ul(){if(!ei&&(P||Re)){if(typeof fetch=="function"&&!it.startsWith("file://"))return fetch(it,{credentials:"same-origin"}).then(function(i){if(!i.ok)throw"failed to load wasm binary file at '"+it+"'";return i.arrayBuffer()}).catch(function(){return nu()});if(Rt)return new Promise(function(i,s){Rt(it,function(o){i(new Uint8Array(o))},s)})}return Promise.resolve().then(function(){return nu()})}var S,fe;function fo(i){for(;0<i.length;)i.shift()(c)}function Lt(i,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return we[i>>0];case"i8":return we[i>>0];case"i16":return xs[i>>1];case"i32":return T[i>>2];case"i64":return T[i>>2];case"float":return co[i>>2];case"double":return lo[i>>3];case"*":return de[i>>2];default:Zt("invalid type for getValue: "+s)}return null}function ni(i){var s="i32";switch(s.endsWith("*")&&(s="*"),s){case"i1":we[i>>0]=0;break;case"i8":we[i>>0]=0;break;case"i16":xs[i>>1]=0;break;case"i32":T[i>>2]=0;break;case"i64":fe=[0,(S=0,1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[i>>2]=fe[0],T[i+4>>2]=fe[1];break;case"float":co[i>>2]=0;break;case"double":lo[i>>3]=0;break;case"*":de[i>>2]=0;break;default:Zt("invalid type for setValue: "+s)}}var po=(i,s)=>{for(var o=0,h=i.length-1;0<=h;h--){var l=i[h];l==="."?i.splice(h,1):l===".."?(i.splice(h,1),o++):o&&(i.splice(h,1),o--)}if(s)for(;o;o--)i.unshift("..");return i},Bt=i=>{var s=i.charAt(0)==="/",o=i.substr(-1)==="/";return(i=po(i.split("/").filter(h=>!!h),!s).join("/"))||s||(i="."),i&&o&&(i+="/"),(s?"/":"")+i},hl=i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=s[0],s=s[1],!i&&!s?".":(s&&(s=s.substr(0,s.length-1)),i+s)},Ws=i=>{if(i==="/")return"/";i=Bt(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)};function cl(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var i=new Uint8Array(1);return()=>(crypto.getRandomValues(i),i[0])}if(Y)try{var s=es;return()=>s.randomBytes(1)[0]}catch{}return()=>Zt("randomDevice")}function Os(){for(var i="",s=!1,o=arguments.length-1;-1<=o&&!s;o--){if(s=0<=o?arguments[o]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";i=s+"/"+i,s=s.charAt(0)==="/"}return i=po(i.split("/").filter(h=>!!h),!s).join("/"),(s?"/":"")+i||"."}function iu(i,s){var o=Array(hn(i)+1);return i=br(i,o,0,o.length),s&&(o.length=i),o}var su=[];function ou(i,s){su[i]={input:[],output:[],Xa:s},wo(i,ll)}var ll={open:function(i){var s=su[i.node.rdev];if(!s)throw new N(43);i.tty=s,i.seekable=!1},close:function(i){i.tty.Xa.fsync(i.tty)},fsync:function(i){i.tty.Xa.fsync(i.tty)},read:function(i,s,o,h){if(!i.tty||!i.tty.Xa.tb)throw new N(60);for(var l=0,p=0;p<h;p++){try{var y=i.tty.Xa.tb(i.tty)}catch{throw new N(29)}if(y===void 0&&l===0)throw new N(6);if(y==null)break;l++,s[o+p]=y}return l&&(i.node.timestamp=Date.now()),l},write:function(i,s,o,h){if(!i.tty||!i.tty.Xa.jb)throw new N(60);try{for(var l=0;l<h;l++)i.tty.Xa.jb(i.tty,s[o+l])}catch{throw new N(29)}return h&&(i.node.timestamp=Date.now()),l}},dl={tb:function(i){if(!i.input.length){var s=null;if(Y){var o=Buffer.alloc(256),h=0;try{h=gs.readSync(process.stdin.fd,o,0,256,-1)}catch(l){if(l.toString().includes("EOF"))h=0;else throw l}0<h?s=o.slice(0,h).toString("utf-8"):s=null}else typeof window<"u"&&typeof window.prompt=="function"?(s=window.prompt("Input: "),s!==null&&(s+=`
`)):typeof readline=="function"&&(s=readline(),s!==null&&(s+=`
`));if(!s)return null;i.input=iu(s,!0)}return i.input.shift()},jb:function(i,s){s===null||s===10?(Ka(ti(i.output,0)),i.output=[]):s!=0&&i.output.push(s)},fsync:function(i){i.output&&0<i.output.length&&(Ka(ti(i.output,0)),i.output=[])}},fl={jb:function(i,s){s===null||s===10?(gr(ti(i.output,0)),i.output=[]):s!=0&&i.output.push(s)},fsync:function(i){i.output&&0<i.output.length&&(gr(ti(i.output,0)),i.output=[])}},R={Qa:null,Ra:function(){return R.createNode(null,"/",16895,0)},createNode:function(i,s,o,h){if((o&61440)===24576||(o&61440)===4096)throw new N(63);return R.Qa||(R.Qa={dir:{node:{Pa:R.Ga.Pa,Oa:R.Ga.Oa,lookup:R.Ga.lookup,ab:R.Ga.ab,rename:R.Ga.rename,unlink:R.Ga.unlink,rmdir:R.Ga.rmdir,readdir:R.Ga.readdir,symlink:R.Ga.symlink},stream:{Ta:R.Ha.Ta}},file:{node:{Pa:R.Ga.Pa,Oa:R.Ga.Oa},stream:{Ta:R.Ha.Ta,read:R.Ha.read,write:R.Ha.write,lb:R.Ha.lb,bb:R.Ha.bb,cb:R.Ha.cb}},link:{node:{Pa:R.Ga.Pa,Oa:R.Ga.Oa,readlink:R.Ga.readlink},stream:{}},pb:{node:{Pa:R.Ga.Pa,Oa:R.Ga.Oa},stream:Nl}}),o=cu(i,s,o,h),(o.mode&61440)===16384?(o.Ga=R.Qa.dir.node,o.Ha=R.Qa.dir.stream,o.Ia={}):(o.mode&61440)===32768?(o.Ga=R.Qa.file.node,o.Ha=R.Qa.file.stream,o.Ma=0,o.Ia=null):(o.mode&61440)===40960?(o.Ga=R.Qa.link.node,o.Ha=R.Qa.link.stream):(o.mode&61440)===8192&&(o.Ga=R.Qa.pb.node,o.Ha=R.Qa.pb.stream),o.timestamp=Date.now(),i&&(i.Ia[s]=o,i.timestamp=o.timestamp),o},Jb:function(i){return i.Ia?i.Ia.subarray?i.Ia.subarray(0,i.Ma):new Uint8Array(i.Ia):new Uint8Array(0)},qb:function(i,s){var o=i.Ia?i.Ia.length:0;o>=s||(s=Math.max(s,o*(1048576>o?2:1.125)>>>0),o!=0&&(s=Math.max(s,256)),o=i.Ia,i.Ia=new Uint8Array(s),0<i.Ma&&i.Ia.set(o.subarray(0,i.Ma),0))},Gb:function(i,s){if(i.Ma!=s)if(s==0)i.Ia=null,i.Ma=0;else{var o=i.Ia;i.Ia=new Uint8Array(s),o&&i.Ia.set(o.subarray(0,Math.min(s,i.Ma))),i.Ma=s}},Ga:{Pa:function(i){var s={};return s.dev=(i.mode&61440)===8192?i.id:1,s.ino=i.id,s.mode=i.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=i.rdev,(i.mode&61440)===16384?s.size=4096:(i.mode&61440)===32768?s.size=i.Ma:(i.mode&61440)===40960?s.size=i.link.length:s.size=0,s.atime=new Date(i.timestamp),s.mtime=new Date(i.timestamp),s.ctime=new Date(i.timestamp),s.Ab=4096,s.blocks=Math.ceil(s.size/s.Ab),s},Oa:function(i,s){s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&R.Gb(i,s.size)},lookup:function(){throw yo[44]},ab:function(i,s,o,h){return R.createNode(i,s,o,h)},rename:function(i,s,o){if((i.mode&61440)===16384){try{var h=Wr(s,o)}catch{}if(h)for(var l in h.Ia)throw new N(55)}delete i.parent.Ia[i.name],i.parent.timestamp=Date.now(),i.name=o,s.Ia[o]=i,s.timestamp=i.parent.timestamp,i.parent=s},unlink:function(i,s){delete i.Ia[s],i.timestamp=Date.now()},rmdir:function(i,s){var o=Wr(i,s),h;for(h in o.Ia)throw new N(55);delete i.Ia[s],i.timestamp=Date.now()},readdir:function(i){var s=[".",".."],o;for(o in i.Ia)i.Ia.hasOwnProperty(o)&&s.push(o);return s},symlink:function(i,s,o){return i=R.createNode(i,s,41471,0),i.link=o,i},readlink:function(i){if((i.mode&61440)!==40960)throw new N(28);return i.link}},Ha:{read:function(i,s,o,h,l){var p=i.node.Ia;if(l>=i.node.Ma)return 0;if(i=Math.min(i.node.Ma-l,h),8<i&&p.subarray)s.set(p.subarray(l,l+i),o);else for(h=0;h<i;h++)s[o+h]=p[l+h];return i},write:function(i,s,o,h,l,p){if(s.buffer===we.buffer&&(p=!1),!h)return 0;if(i=i.node,i.timestamp=Date.now(),s.subarray&&(!i.Ia||i.Ia.subarray)){if(p)return i.Ia=s.subarray(o,o+h),i.Ma=h;if(i.Ma===0&&l===0)return i.Ia=s.slice(o,o+h),i.Ma=h;if(l+h<=i.Ma)return i.Ia.set(s.subarray(o,o+h),l),h}if(R.qb(i,l+h),i.Ia.subarray&&s.subarray)i.Ia.set(s.subarray(o,o+h),l);else for(p=0;p<h;p++)i.Ia[l+p]=s[o+p];return i.Ma=Math.max(i.Ma,l+h),h},Ta:function(i,s,o){if(o===1?s+=i.position:o===2&&(i.node.mode&61440)===32768&&(s+=i.node.Ma),0>s)throw new N(28);return s},lb:function(i,s,o){R.qb(i.node,s+o),i.node.Ma=Math.max(i.node.Ma,s+o)},bb:function(i,s,o,h,l){if((i.node.mode&61440)!==32768)throw new N(43);if(i=i.node.Ia,l&2||i.buffer!==ho){if((0<o||o+s<i.length)&&(i.subarray?i=i.subarray(o,o+s):i=Array.prototype.slice.call(i,o,o+s)),o=!0,s=65536*Math.ceil(s/65536),(l=Su(65536,s))?(qt.fill(0,l,l+s),s=l):s=0,!s)throw new N(48);we.set(i,s)}else o=!1,s=i.byteOffset;return{Fb:s,vb:o}},cb:function(i,s,o,h,l){if((i.node.mode&61440)!==32768)throw new N(43);return l&2||R.Ha.write(i,s,0,h,o,!1),0}}},mo=null,au={},er=[],pl=1,tr=null,uu=!0,N=null,yo={},je=(i,s={})=>{if(i=Os("/",i),!i)return{path:"",node:null};if(s=Object.assign({rb:!0,kb:0},s),8<s.kb)throw new N(32);i=po(i.split("/").filter(y=>!!y),!1);for(var o=mo,h="/",l=0;l<i.length;l++){var p=l===i.length-1;if(p&&s.parent)break;if(o=Wr(o,i[l]),h=Bt(h+"/"+i[l]),o.Va&&(!p||p&&s.rb)&&(o=o.Va.root),!p||s.Sa){for(p=0;(o.mode&61440)===40960;)if(o=wu(h),h=Os(hl(h),o),o=je(h,{kb:s.kb+1}).node,40<p++)throw new N(32)}}return{path:h,node:o}},ii=i=>{for(var s;;){if(i===i.parent)return i=i.Ra.ub,s?i[i.length-1]!=="/"?i+"/"+s:i+s:i;s=s?i.name+"/"+s:i.name,i=i.parent}},No=(i,s)=>{for(var o=0,h=0;h<s.length;h++)o=(o<<5)-o+s.charCodeAt(h)|0;return(i+o>>>0)%tr.length},hu=i=>{var s=No(i.parent.id,i.name);if(tr[s]===i)tr[s]=i.Wa;else for(s=tr[s];s;){if(s.Wa===i){s.Wa=i.Wa;break}s=s.Wa}},Wr=(i,s)=>{var o;if(o=(o=cn(i,"x"))?o:i.Ga.lookup?0:2)throw new N(o,i);for(o=tr[No(i.id,s)];o;o=o.Wa){var h=o.name;if(o.parent.id===i.id&&h===s)return o}return i.Ga.lookup(i,s)},cu=(i,s,o,h)=>(i=new Tu(i,s,o,h),s=No(i.parent.id,i.name),i.Wa=tr[s],tr[s]=i),ml={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},lu=i=>{var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s},cn=(i,s)=>{if(uu)return 0;if(!s.includes("r")||i.mode&292){if(s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73))return 2}else return 2;return 0},du=(i,s)=>{try{return Wr(i,s),20}catch{}return cn(i,"wx")},fu=(i,s,o)=>{try{var h=Wr(i,s)}catch(l){return l.Ka}if(i=cn(i,"wx"))return i;if(o){if((h.mode&61440)!==16384)return 54;if(h===h.parent||ii(h)==="/")return 10}else if((h.mode&61440)===16384)return 31;return 0},yl=(i=0)=>{for(;4096>=i;i++)if(!er[i])return i;throw new N(33)},pu=(i,s)=>(ai||(ai=function(){this.$a={}},ai.prototype={},Object.defineProperties(ai.prototype,{object:{get:function(){return this.node},set:function(o){this.node=o}},flags:{get:function(){return this.$a.flags},set:function(o){this.$a.flags=o}},position:{get:function(){return this.$a.position},set:function(o){this.$a.position=o}}})),i=Object.assign(new ai,i),s=yl(s),i.fd=s,er[s]=i),Nl={open:i=>{i.Ha=au[i.node.rdev].Ha,i.Ha.open&&i.Ha.open(i)},Ta:()=>{throw new N(70)}},wo=(i,s)=>{au[i]={Ha:s}},mu=(i,s)=>{var o=s==="/",h=!s;if(o&&mo)throw new N(10);if(!o&&!h){var l=je(s,{rb:!1});if(s=l.path,l=l.node,l.Va)throw new N(10);if((l.mode&61440)!==16384)throw new N(54)}s={type:i,Kb:{},ub:s,Eb:[]},i=i.Ra(s),i.Ra=s,s.root=i,o?mo=i:l&&(l.Va=s,l.Ra&&l.Ra.Eb.push(s))},qs=(i,s,o)=>{var h=je(i,{parent:!0}).node;if(i=Ws(i),!i||i==="."||i==="..")throw new N(28);var l=du(h,i);if(l)throw new N(l);if(!h.Ga.ab)throw new N(63);return h.Ga.ab(h,i,s,o)},Ct=(i,s)=>qs(i,(s!==void 0?s:511)&1023|16384,0),Cs=(i,s,o)=>{typeof o>"u"&&(o=s,s=438),qs(i,s|8192,o)},vo=(i,s)=>{if(!Os(i))throw new N(44);var o=je(s,{parent:!0}).node;if(!o)throw new N(44);s=Ws(s);var h=du(o,s);if(h)throw new N(h);if(!o.Ga.symlink)throw new N(63);o.Ga.symlink(o,s,i)},yu=i=>{var s=je(i,{parent:!0}).node;i=Ws(i);var o=Wr(s,i),h=fu(s,i,!0);if(h)throw new N(h);if(!s.Ga.rmdir)throw new N(63);if(o.Va)throw new N(10);s.Ga.rmdir(s,i),hu(o)},Nu=i=>{var s=je(i,{parent:!0}).node;if(!s)throw new N(44);i=Ws(i);var o=Wr(s,i),h=fu(s,i,!1);if(h)throw new N(h);if(!s.Ga.unlink)throw new N(63);if(o.Va)throw new N(10);s.Ga.unlink(s,i),hu(o)},wu=i=>{if(i=je(i).node,!i)throw new N(44);if(!i.Ga.readlink)throw new N(28);return Os(ii(i.parent),i.Ga.readlink(i))},si=(i,s)=>{if(i=je(i,{Sa:!s}).node,!i)throw new N(44);if(!i.Ga.Pa)throw new N(63);return i.Ga.Pa(i)},vu=i=>si(i,!0),ks=(i,s)=>{if(i=typeof i=="string"?je(i,{Sa:!0}).node:i,!i.Ga.Oa)throw new N(63);i.Ga.Oa(i,{mode:s&4095|i.mode&-4096,timestamp:Date.now()})},gu=(i,s)=>{if(0>s)throw new N(28);if(i=typeof i=="string"?je(i,{Sa:!0}).node:i,!i.Ga.Oa)throw new N(63);if((i.mode&61440)===16384)throw new N(31);if((i.mode&61440)!==32768)throw new N(28);var o=cn(i,"w");if(o)throw new N(o);i.Ga.Oa(i,{size:s,timestamp:Date.now()})},ln=(i,s,o)=>{if(i==="")throw new N(44);if(typeof s=="string"){var h=ml[s];if(typeof h>"u")throw Error("Unknown file open mode: "+s);s=h}if(o=s&64?(typeof o>"u"?438:o)&4095|32768:0,typeof i=="object")var l=i;else{i=Bt(i);try{l=je(i,{Sa:!(s&131072)}).node}catch{}}if(h=!1,s&64)if(l){if(s&128)throw new N(20)}else l=qs(i,o,0),h=!0;if(!l)throw new N(44);if((l.mode&61440)===8192&&(s&=-513),s&65536&&(l.mode&61440)!==16384)throw new N(54);if(!h&&(o=l?(l.mode&61440)===40960?32:(l.mode&61440)===16384&&(lu(s)!=="r"||s&512)?31:cn(l,lu(s)):44))throw new N(o);return s&512&&!h&&gu(l,0),s&=-131713,l=pu({node:l,path:ii(l),flags:s,seekable:!0,position:0,Ha:l.Ha,Ib:[],error:!1}),l.Ha.open&&l.Ha.open(l),!c.logReadFiles||s&1||(Is||(Is={}),i in Is||(Is[i]=1)),l},go=i=>{if(i.fd===null)throw new N(8);i.hb&&(i.hb=null);try{i.Ha.close&&i.Ha.close(i)}catch(s){throw s}finally{er[i.fd]=null}i.fd=null},bu=(i,s,o)=>{if(i.fd===null)throw new N(8);if(!i.seekable||!i.Ha.Ta)throw new N(70);if(o!=0&&o!=1&&o!=2)throw new N(28);i.position=i.Ha.Ta(i,s,o),i.Ib=[]},xu=(i,s,o,h,l)=>{if(0>h||0>l)throw new N(28);if(i.fd===null)throw new N(8);if((i.flags&2097155)===1)throw new N(8);if((i.node.mode&61440)===16384)throw new N(31);if(!i.Ha.read)throw new N(28);var p=typeof l<"u";if(!p)l=i.position;else if(!i.seekable)throw new N(70);return s=i.Ha.read(i,s,o,h,l),p||(i.position+=s),s},Wu=(i,s,o,h,l)=>{if(0>h||0>l)throw new N(28);if(i.fd===null)throw new N(8);if(!(i.flags&2097155))throw new N(8);if((i.node.mode&61440)===16384)throw new N(31);if(!i.Ha.write)throw new N(28);i.seekable&&i.flags&1024&&bu(i,0,2);var p=typeof l<"u";if(!p)l=i.position;else if(!i.seekable)throw new N(70);return s=i.Ha.write(i,s,o,h,l,void 0),p||(i.position+=s),s},wl=i=>{var s,o=ln(i,o||0);i=si(i).size;var h=new Uint8Array(i);return xu(o,h,0,i,0),s=h,go(o),s},Ou=()=>{N||(N=function(i,s){this.node=s,this.Hb=function(o){this.Ka=o},this.Hb(i),this.message="FS error"},N.prototype=Error(),N.prototype.constructor=N,[44].forEach(i=>{yo[i]=new N(i),yo[i].stack="<generic error, no stack>"}))},qu,Cu=(i,s)=>{var o=0;return i&&(o|=365),s&&(o|=146),o},oi=(i,s,o)=>{i=Bt("/dev/"+i);var h=Cu(!!s,!!o);bo||(bo=64);var l=bo++<<8|0;wo(l,{open:p=>{p.seekable=!1},close:()=>{o&&o.buffer&&o.buffer.length&&o(10)},read:(p,y,A,V)=>{for(var F=0,pe=0;pe<V;pe++){try{var Mt=s()}catch{throw new N(29)}if(Mt===void 0&&F===0)throw new N(6);if(Mt==null)break;F++,y[A+pe]=Mt}return F&&(p.node.timestamp=Date.now()),F},write:(p,y,A,V)=>{for(var F=0;F<V;F++)try{o(y[A+F])}catch{throw new N(29)}return V&&(p.node.timestamp=Date.now()),F}}),Cs(i,h,l)},bo,ie={},ai,Is;function Or(i,s,o){if(s.charAt(0)==="/")return s;if(i=i===-100?"/":Nt(i).path,s.length==0){if(!o)throw new N(44);return i}return Bt(i+"/"+s)}function Es(i,s,o){try{var h=i(s)}catch(l){if(l&&l.node&&Bt(s)!==Bt(ii(l.node)))return-54;throw l}return T[o>>2]=h.dev,T[o+8>>2]=h.ino,T[o+12>>2]=h.mode,de[o+16>>2]=h.nlink,T[o+20>>2]=h.uid,T[o+24>>2]=h.gid,T[o+28>>2]=h.rdev,fe=[h.size>>>0,(S=h.size,1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[o+40>>2]=fe[0],T[o+44>>2]=fe[1],T[o+48>>2]=4096,T[o+52>>2]=h.blocks,fe=[Math.floor(h.atime.getTime()/1e3)>>>0,(S=Math.floor(h.atime.getTime()/1e3),1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[o+56>>2]=fe[0],T[o+60>>2]=fe[1],de[o+64>>2]=0,fe=[Math.floor(h.mtime.getTime()/1e3)>>>0,(S=Math.floor(h.mtime.getTime()/1e3),1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[o+72>>2]=fe[0],T[o+76>>2]=fe[1],de[o+80>>2]=0,fe=[Math.floor(h.ctime.getTime()/1e3)>>>0,(S=Math.floor(h.ctime.getTime()/1e3),1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[o+88>>2]=fe[0],T[o+92>>2]=fe[1],de[o+96>>2]=0,fe=[h.ino>>>0,(S=h.ino,1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[o+104>>2]=fe[0],T[o+108>>2]=fe[1],0}var Ts=void 0;function As(){return Ts+=4,T[Ts-4>>2]}function Nt(i){if(i=er[i],!i)throw new N(8);return i}function xo(i){return de[i>>2]+4294967296*T[i+4>>2]}function ku(i){var s=hn(i)+1,o=Ss(s);return o&&br(i,we,o,s),o}function vl(i,s,o){function h(V){return(V=V.toTimeString().match(/\(([A-Za-z ]+)\)$/))?V[1]:"GMT"}var l=new Date().getFullYear(),p=new Date(l,0,1),y=new Date(l,6,1);l=p.getTimezoneOffset();var A=y.getTimezoneOffset();T[i>>2]=60*Math.max(l,A),T[s>>2]=+(l!=A),i=h(p),s=h(y),i=ku(i),s=ku(s),A<l?(de[o>>2]=i,de[o+4>>2]=s):(de[o>>2]=s,de[o+4>>2]=i)}function Wo(i,s,o){Wo.Bb||(Wo.Bb=!0,vl(i,s,o))}var Iu;Iu=Y?()=>{var i=process.hrtime();return 1e3*i[0]+i[1]/1e6}:()=>performance.now();var Oo={};function Eu(){if(!qo){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Fe||"./this.program"},s;for(s in Oo)Oo[s]===void 0?delete i[s]:i[s]=Oo[s];var o=[];for(s in i)o.push(s+"="+i[s]);qo=o}return qo}var qo,rr=void 0,Co=[];function ko(i,s){if(!rr){rr=new WeakMap;var o=Xt.length;if(rr)for(var h=0;h<0+o;h++){var l=Xt.get(h);l&&rr.set(l,h)}}if(rr.has(i))return rr.get(i);if(Co.length)o=Co.pop();else{try{Xt.grow(1)}catch(A){throw A instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":A}o=Xt.length-1}try{Xt.set(o,i)}catch(A){if(!(A instanceof TypeError))throw A;if(typeof WebAssembly.Function=="function"){h=WebAssembly.Function,l={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"};for(var p={parameters:[],results:s[0]=="v"?[]:[l[s[0]]]},y=1;y<s.length;++y)p.parameters.push(l[s[y]]);s=new h(p,i)}else{for(h=[1,96],l=s.slice(0,1),s=s.slice(1),p={i:127,p:127,j:126,f:125,d:124},y=s.length,128>y?h.push(y):h.push(y%128|128,y>>7),y=0;y<s.length;++y)h.push(p[s[y]]);l=="v"?h.push(0):h.push(1,p[l]),s=[0,97,115,109,1,0,0,0,1],l=h.length,128>l?s.push(l):s.push(l%128|128,l>>7),s.push.apply(s,h),s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),s=new WebAssembly.Module(new Uint8Array(s)),s=new WebAssembly.Instance(s,{e:{f:i}}).exports.f}Xt.set(o,s)}return rr.set(i,o),o}function ui(i){rr.delete(Xt.get(i)),Co.push(i)}function Io(i){var s=Ss(i.length);return i.subarray||i.slice||(i=new Uint8Array(i)),qt.set(i,s),s}function gl(i,s,o,h){var l={string:F=>{var pe=0;if(F!=null&&F!==0){var Mt=(F.length<<2)+1;pe=nr(Mt),br(F,qt,pe,Mt)}return pe},array:F=>{var pe=nr(F.length);return we.set(F,pe),pe}};i=c["_"+i];var p=[],y=0;if(h)for(var A=0;A<h.length;A++){var V=l[o[A]];V?(y===0&&(y=hi()),p[A]=V(h[A])):p[A]=h[A]}return o=i.apply(null,p),o=function(F){return y!==0&&ci(y),s==="string"?We(F):s==="boolean"?!!F:F}(o)}function Tu(i,s,o,h){i||(i=this),this.parent=i,this.Ra=i.Ra,this.Va=null,this.id=pl++,this.name=s,this.mode=o,this.Ga={},this.Ha={},this.rdev=h}Object.defineProperties(Tu.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),Ou(),tr=Array(4096),mu(R,"/"),Ct("/tmp"),Ct("/home"),Ct("/home/web_user"),(()=>{Ct("/dev"),wo(259,{read:()=>0,write:(s,o,h,l)=>l}),Cs("/dev/null",259),ou(1280,dl),ou(1536,fl),Cs("/dev/tty",1280),Cs("/dev/tty1",1536);var i=cl();oi("random",i),oi("urandom",i),Ct("/dev/shm"),Ct("/dev/shm/tmp")})(),(()=>{Ct("/proc");var i=Ct("/proc/self");Ct("/proc/self/fd"),mu({Ra:()=>{var s=cu(i,"fd",16895,73);return s.Ga={lookup:(o,h)=>{var l=er[+h];if(!l)throw new N(8);return o={parent:null,Ra:{ub:"fake"},Ga:{readlink:()=>l.path}},o.parent=o}},s}},"/proc/self/fd")})();var bl={a:function(i,s,o,h){Zt("Assertion failed: "+We(i)+", at: "+[s?We(s):"unknown filename",o,h?We(h):"unknown function"])},h:function(i,s){try{return i=We(i),ks(i,s),0}catch(o){if(typeof ie>"u"||!(o instanceof N))throw o;return-o.Ka}},H:function(i,s,o){try{if(s=We(s),s=Or(i,s),o&-8)return-28;var h=je(s,{Sa:!0}).node;return h?(i="",o&4&&(i+="r"),o&2&&(i+="w"),o&1&&(i+="x"),i&&cn(h,i)?-2:0):-44}catch(l){if(typeof ie>"u"||!(l instanceof N))throw l;return-l.Ka}},i:function(i,s){try{var o=er[i];if(!o)throw new N(8);return ks(o.node,s),0}catch(h){if(typeof ie>"u"||!(h instanceof N))throw h;return-h.Ka}},g:function(i){try{var s=er[i];if(!s)throw new N(8);var o=s.node,h=typeof o=="string"?je(o,{Sa:!0}).node:o;if(!h.Ga.Oa)throw new N(63);return h.Ga.Oa(h,{timestamp:Date.now()}),0}catch(l){if(typeof ie>"u"||!(l instanceof N))throw l;return-l.Ka}},b:function(i,s,o){Ts=o;try{var h=Nt(i);switch(s){case 0:var l=As();return 0>l?-28:pu(h,l).fd;case 1:case 2:return 0;case 3:return h.flags;case 4:return l=As(),h.flags|=l,0;case 5:return l=As(),xs[l+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return T[Au()>>2]=28,-1;default:return-28}}catch(p){if(typeof ie>"u"||!(p instanceof N))throw p;return-p.Ka}},G:function(i,s){try{var o=Nt(i);return Es(si,o.path,s)}catch(h){if(typeof ie>"u"||!(h instanceof N))throw h;return-h.Ka}},l:function(i,s,o){try{if(s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN,isNaN(s))return-61;var h=er[i];if(!h)throw new N(8);if(!(h.flags&2097155))throw new N(28);return gu(h.node,s),0}catch(l){if(typeof ie>"u"||!(l instanceof N))throw l;return-l.Ka}},B:function(i,s){try{if(s===0)return-28;var o=hn("/")+1;return s<o?-68:(br("/",qt,i,s),o)}catch(h){if(typeof ie>"u"||!(h instanceof N))throw h;return-h.Ka}},E:function(i,s){try{return i=We(i),Es(vu,i,s)}catch(o){if(typeof ie>"u"||!(o instanceof N))throw o;return-o.Ka}},y:function(i,s,o){try{return s=We(s),s=Or(i,s),s=Bt(s),s[s.length-1]==="/"&&(s=s.substr(0,s.length-1)),Ct(s,o),0}catch(h){if(typeof ie>"u"||!(h instanceof N))throw h;return-h.Ka}},D:function(i,s,o,h){try{s=We(s);var l=h&256;return s=Or(i,s,h&4096),Es(l?vu:si,s,o)}catch(p){if(typeof ie>"u"||!(p instanceof N))throw p;return-p.Ka}},v:function(i,s,o,h){Ts=h;try{s=We(s),s=Or(i,s);var l=h?As():0;return ln(s,o,l).fd}catch(p){if(typeof ie>"u"||!(p instanceof N))throw p;return-p.Ka}},t:function(i,s,o,h){try{if(s=We(s),s=Or(i,s),0>=h)return-28;var l=wu(s),p=Math.min(h,hn(l)),y=we[o+p];return br(l,qt,o,h+1),we[o+p]=y,p}catch(A){if(typeof ie>"u"||!(A instanceof N))throw A;return-A.Ka}},s:function(i){try{return i=We(i),yu(i),0}catch(s){if(typeof ie>"u"||!(s instanceof N))throw s;return-s.Ka}},F:function(i,s){try{return i=We(i),Es(si,i,s)}catch(o){if(typeof ie>"u"||!(o instanceof N))throw o;return-o.Ka}},p:function(i,s,o){try{return s=We(s),s=Or(i,s),o===0?Nu(s):o===512?yu(s):Zt("Invalid flags passed to unlinkat"),0}catch(h){if(typeof ie>"u"||!(h instanceof N))throw h;return-h.Ka}},o:function(i,s,o){try{if(s=We(s),s=Or(i,s,!0),o){var h=xo(o),l=T[o+8>>2];p=1e3*h+l/1e6,o+=16,h=xo(o),l=T[o+8>>2],y=1e3*h+l/1e6}else var p=Date.now(),y=p;i=p;var A=je(s,{Sa:!0}).node;return A.Ga.Oa(A,{timestamp:Math.max(i,y)}),0}catch(V){if(typeof ie>"u"||!(V instanceof N))throw V;return-V.Ka}},e:function(){return Date.now()},j:function(i,s){i=new Date(1e3*xo(i)),T[s>>2]=i.getSeconds(),T[s+4>>2]=i.getMinutes(),T[s+8>>2]=i.getHours(),T[s+12>>2]=i.getDate(),T[s+16>>2]=i.getMonth(),T[s+20>>2]=i.getFullYear()-1900,T[s+24>>2]=i.getDay();var o=new Date(i.getFullYear(),0,1);T[s+28>>2]=(i.getTime()-o.getTime())/864e5|0,T[s+36>>2]=-(60*i.getTimezoneOffset());var h=new Date(i.getFullYear(),6,1).getTimezoneOffset();o=o.getTimezoneOffset(),T[s+32>>2]=(h!=o&&i.getTimezoneOffset()==Math.min(o,h))|0},w:function(i,s,o,h,l,p){try{var y=Nt(h);if(s&2&&!(o&2)&&(y.flags&2097155)!==2)throw new N(2);if((y.flags&2097155)===1)throw new N(2);if(!y.Ha.bb)throw new N(43);var A=y.Ha.bb(y,i,l,s,o),V=A.Fb;return T[p>>2]=A.vb,V}catch(F){if(typeof ie>"u"||!(F instanceof N))throw F;return-F.Ka}},x:function(i,s,o,h,l,p){try{var y=Nt(l);if(o&2){var A=qt.slice(i,i+s);y&&y.Ha.cb&&y.Ha.cb(y,A,p,s,h)}}catch(V){if(typeof ie>"u"||!(V instanceof N))throw V;return-V.Ka}},n:Wo,q:function(){return 2147483648},d:Iu,c:function(i){var s=qt.length;if(i>>>=0,2147483648<i)return!1;for(var o=1;4>=o;o*=2){var h=s*(1+.2/o);h=Math.min(h,i+100663296);var l=Math;h=Math.max(i,h),l=l.min.call(l,2147483648,h+(65536-h%65536)%65536);e:{try{uo.grow(l-ho.byteLength+65535>>>16),Ya();var p=1;break e}catch{}p=void 0}if(p)return!0}return!1},z:function(i,s){var o=0;return Eu().forEach(function(h,l){var p=s+o;for(l=de[i+4*l>>2]=p,p=0;p<h.length;++p)we[l++>>0]=h.charCodeAt(p);we[l>>0]=0,o+=h.length+1}),0},A:function(i,s){var o=Eu();de[i>>2]=o.length;var h=0;return o.forEach(function(l){h+=l.length+1}),de[s>>2]=h,0},f:function(i){try{var s=Nt(i);return go(s),0}catch(o){if(typeof ie>"u"||!(o instanceof N))throw o;return o.Ka}},m:function(i,s){try{var o=Nt(i);return we[s>>0]=o.tty?2:(o.mode&61440)===16384?3:(o.mode&61440)===40960?7:4,0}catch(h){if(typeof ie>"u"||!(h instanceof N))throw h;return h.Ka}},u:function(i,s,o,h){try{e:{var l=Nt(i);i=s;for(var p=s=0;p<o;p++){var y=de[i>>2],A=de[i+4>>2];i+=8;var V=xu(l,we,y,A);if(0>V){var F=-1;break e}if(s+=V,V<A)break}F=s}return de[h>>2]=F,0}catch(pe){if(typeof ie>"u"||!(pe instanceof N))throw pe;return pe.Ka}},k:function(i,s,o,h,l){try{if(s=o+2097152>>>0<4194305-!!s?(s>>>0)+4294967296*o:NaN,isNaN(s))return 61;var p=Nt(i);return bu(p,s,h),fe=[p.position>>>0,(S=p.position,1<=+Math.abs(S)?0<S?(Math.min(+Math.floor(S/4294967296),4294967295)|0)>>>0:~~+Math.ceil((S-+(~~S>>>0))/4294967296)>>>0:0)],T[l>>2]=fe[0],T[l+4>>2]=fe[1],p.hb&&s===0&&h===0&&(p.hb=null),0}catch(y){if(typeof ie>"u"||!(y instanceof N))throw y;return y.Ka}},C:function(i){try{var s=Nt(i);return s.Ha&&s.Ha.fsync?s.Ha.fsync(s):0}catch(o){if(typeof ie>"u"||!(o instanceof N))throw o;return o.Ka}},r:function(i,s,o,h){try{e:{var l=Nt(i);i=s;for(var p=s=0;p<o;p++){var y=de[i>>2],A=de[i+4>>2];i+=8;var V=Wu(l,we,y,A);if(0>V){var F=-1;break e}s+=V}F=s}return de[h>>2]=F,0}catch(pe){if(typeof ie>"u"||!(pe instanceof N))throw pe;return pe.Ka}}};(function(){function i(l){c.asm=l.exports,uo=c.asm.I,Ya(),Xt=c.asm.Aa,Za.unshift(c.asm.J),xr--,c.monitorRunDependencies&&c.monitorRunDependencies(xr),xr==0&&ri&&(l=ri,ri=null,l())}function s(l){i(l.instance)}function o(l){return ul().then(function(p){return WebAssembly.instantiate(p,h)}).then(function(p){return p}).then(l,function(p){gr("failed to asynchronously prepare wasm: "+p),Zt(p)})}var h={a:bl};if(xr++,c.monitorRunDependencies&&c.monitorRunDependencies(xr),c.instantiateWasm)try{return c.instantiateWasm(h,i)}catch(l){return gr("Module.instantiateWasm callback failed with error: "+l),!1}return function(){return ei||typeof WebAssembly.instantiateStreaming!="function"||tu()||it.startsWith("file://")||Y||typeof fetch!="function"?o(s):fetch(it,{credentials:"same-origin"}).then(function(l){return WebAssembly.instantiateStreaming(l,h).then(s,function(p){return gr("wasm streaming compile failed: "+p),gr("falling back to ArrayBuffer instantiation"),o(s)})})}(),{}})(),c.___wasm_call_ctors=function(){return(c.___wasm_call_ctors=c.asm.J).apply(null,arguments)},c._sqlite3_free=function(){return(c._sqlite3_free=c.asm.K).apply(null,arguments)},c._sqlite3_value_double=function(){return(c._sqlite3_value_double=c.asm.L).apply(null,arguments)},c._sqlite3_value_text=function(){return(c._sqlite3_value_text=c.asm.M).apply(null,arguments)};var Au=c.___errno_location=function(){return(Au=c.___errno_location=c.asm.N).apply(null,arguments)};c._sqlite3_prepare_v2=function(){return(c._sqlite3_prepare_v2=c.asm.O).apply(null,arguments)},c._sqlite3_step=function(){return(c._sqlite3_step=c.asm.P).apply(null,arguments)},c._sqlite3_finalize=function(){return(c._sqlite3_finalize=c.asm.Q).apply(null,arguments)},c._sqlite3_reset=function(){return(c._sqlite3_reset=c.asm.R).apply(null,arguments)},c._sqlite3_value_int=function(){return(c._sqlite3_value_int=c.asm.S).apply(null,arguments)},c._sqlite3_clear_bindings=function(){return(c._sqlite3_clear_bindings=c.asm.T).apply(null,arguments)},c._sqlite3_value_blob=function(){return(c._sqlite3_value_blob=c.asm.U).apply(null,arguments)},c._sqlite3_value_bytes=function(){return(c._sqlite3_value_bytes=c.asm.V).apply(null,arguments)},c._sqlite3_value_type=function(){return(c._sqlite3_value_type=c.asm.W).apply(null,arguments)},c._sqlite3_result_blob=function(){return(c._sqlite3_result_blob=c.asm.X).apply(null,arguments)},c._sqlite3_result_double=function(){return(c._sqlite3_result_double=c.asm.Y).apply(null,arguments)},c._sqlite3_result_error=function(){return(c._sqlite3_result_error=c.asm.Z).apply(null,arguments)},c._sqlite3_result_int=function(){return(c._sqlite3_result_int=c.asm._).apply(null,arguments)},c._sqlite3_result_int64=function(){return(c._sqlite3_result_int64=c.asm.$).apply(null,arguments)},c._sqlite3_result_null=function(){return(c._sqlite3_result_null=c.asm.aa).apply(null,arguments)},c._sqlite3_result_text=function(){return(c._sqlite3_result_text=c.asm.ba).apply(null,arguments)},c._sqlite3_sql=function(){return(c._sqlite3_sql=c.asm.ca).apply(null,arguments)},c._sqlite3_aggregate_context=function(){return(c._sqlite3_aggregate_context=c.asm.da).apply(null,arguments)},c._sqlite3_column_count=function(){return(c._sqlite3_column_count=c.asm.ea).apply(null,arguments)},c._sqlite3_data_count=function(){return(c._sqlite3_data_count=c.asm.fa).apply(null,arguments)},c._sqlite3_column_blob=function(){return(c._sqlite3_column_blob=c.asm.ga).apply(null,arguments)},c._sqlite3_column_bytes=function(){return(c._sqlite3_column_bytes=c.asm.ha).apply(null,arguments)},c._sqlite3_column_double=function(){return(c._sqlite3_column_double=c.asm.ia).apply(null,arguments)},c._sqlite3_column_text=function(){return(c._sqlite3_column_text=c.asm.ja).apply(null,arguments)},c._sqlite3_column_type=function(){return(c._sqlite3_column_type=c.asm.ka).apply(null,arguments)},c._sqlite3_column_name=function(){return(c._sqlite3_column_name=c.asm.la).apply(null,arguments)},c._sqlite3_bind_blob=function(){return(c._sqlite3_bind_blob=c.asm.ma).apply(null,arguments)},c._sqlite3_bind_double=function(){return(c._sqlite3_bind_double=c.asm.na).apply(null,arguments)},c._sqlite3_bind_int=function(){return(c._sqlite3_bind_int=c.asm.oa).apply(null,arguments)},c._sqlite3_bind_text=function(){return(c._sqlite3_bind_text=c.asm.pa).apply(null,arguments)},c._sqlite3_bind_parameter_index=function(){return(c._sqlite3_bind_parameter_index=c.asm.qa).apply(null,arguments)},c._sqlite3_normalized_sql=function(){return(c._sqlite3_normalized_sql=c.asm.ra).apply(null,arguments)},c._sqlite3_errmsg=function(){return(c._sqlite3_errmsg=c.asm.sa).apply(null,arguments)},c._sqlite3_exec=function(){return(c._sqlite3_exec=c.asm.ta).apply(null,arguments)},c._sqlite3_changes=function(){return(c._sqlite3_changes=c.asm.ua).apply(null,arguments)},c._sqlite3_close_v2=function(){return(c._sqlite3_close_v2=c.asm.va).apply(null,arguments)},c._sqlite3_create_function_v2=function(){return(c._sqlite3_create_function_v2=c.asm.wa).apply(null,arguments)},c._sqlite3_open=function(){return(c._sqlite3_open=c.asm.xa).apply(null,arguments)};var Ss=c._malloc=function(){return(Ss=c._malloc=c.asm.ya).apply(null,arguments)},Ds=c._free=function(){return(Ds=c._free=c.asm.za).apply(null,arguments)};c._RegisterExtensionFunctions=function(){return(c._RegisterExtensionFunctions=c.asm.Ba).apply(null,arguments)};var Su=c._emscripten_builtin_memalign=function(){return(Su=c._emscripten_builtin_memalign=c.asm.Ca).apply(null,arguments)},hi=c.stackSave=function(){return(hi=c.stackSave=c.asm.Da).apply(null,arguments)},ci=c.stackRestore=function(){return(ci=c.stackRestore=c.asm.Ea).apply(null,arguments)},nr=c.stackAlloc=function(){return(nr=c.stackAlloc=c.asm.Fa).apply(null,arguments)};c.UTF8ToString=We,c.stackAlloc=nr,c.stackSave=hi,c.stackRestore=ci,c.cwrap=function(i,s,o,h){o=o||[];var l=o.every(p=>p==="number"||p==="boolean");return s!=="string"&&l&&!h?c["_"+i]:function(){return gl(i,s,o,arguments)}};var Rs;ri=function i(){Rs||Du(),Rs||(ri=i)};function Du(){function i(){if(!Rs&&(Rs=!0,c.calledRun=!0,!za)){if(c.noFSInit||qu||(qu=!0,Ou(),c.stdin=c.stdin,c.stdout=c.stdout,c.stderr=c.stderr,c.stdin?oi("stdin",c.stdin):vo("/dev/tty","/dev/stdin"),c.stdout?oi("stdout",null,c.stdout):vo("/dev/tty","/dev/stdout"),c.stderr?oi("stderr",null,c.stderr):vo("/dev/tty1","/dev/stderr"),ln("/dev/stdin",0),ln("/dev/stdout",1),ln("/dev/stderr",1)),uu=!1,fo(Za),c.onRuntimeInitialized&&c.onRuntimeInitialized(),c.postRun)for(typeof c.postRun=="function"&&(c.postRun=[c.postRun]);c.postRun.length;){var s=c.postRun.shift();eu.unshift(s)}fo(eu)}}if(!(0<xr)){if(c.preRun)for(typeof c.preRun=="function"&&(c.preRun=[c.preRun]);c.preRun.length;)al();fo(Xa),0<xr||(c.setStatus?(c.setStatus("Running..."),setTimeout(function(){setTimeout(function(){c.setStatus("")},1),i()},1)):i())}}if(c.preInit)for(typeof c.preInit=="function"&&(c.preInit=[c.preInit]);0<c.preInit.length;)c.preInit.pop()();return Du(),I}),r)};t.exports=u,t.exports.default=u})(Ma);var Fc=Ma.exports,Qc=Bc(Fc),Uc=""+new URL("sql-wasm-18fc45ef.wasm",self.location.href).href;const Vc="sqlitevfs",Br=new Map,jc=2048,$c=65536;class Jc{constructor(e){Xe(this,"_data");Xe(this,"_size");this._data=e??new Uint8Array,this._size=this._data.length}get size(){return this._size}read(e,r){if(e>=this._size)return 0;const u=this._data.subarray(e,Math.min(this._size,e+r.length));return r.set(u),u.length}reserve(e){if(this._data.length>=e)return;const r=e-this._data.length,u=Math.min($c,Math.max(jc,this._data.length)),d=new Uint8Array(this._data.length+Math.max(u,r));d.set(this._data),this._data=d}write(e,r){return this.reserve(e+r.length),this._data.set(r,e),this._size=Math.max(this._size,e+r.length),r.length}truncate(e){this._size=e}toUint8Array(){return this._data.subarray(0,this._size)}}const Gc=self.indexedDB||window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,Pa=new Promise((t,e)=>{const r=Gc.open(Vc,1);r.onupgradeneeded=()=>r.result.createObjectStore("files",{keyPath:"name"}),r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)});async function Kc(t){const e=await Pa,r=await new Promise((u,d)=>{const k=e.transaction("files","readonly").objectStore("files").get(t);k.onsuccess=()=>u(k.result),k.onerror=()=>d(k.error)});if(r&&!Br.has(t)){const u=new Jc(r.data);return Br.set(t,u),u}else return Br.has(t)?Br.get(t):null}async function zc(t,e){const r=await Pa;await new Promise((u,d)=>{const k=r.transaction("files","readwrite").objectStore("files").put({name:t,data:e});k.onsuccess=()=>u(!0),k.onerror=()=>d(k.error)})}async function Hc(t,e){if(await zc(t,e),Br.has(t)){const r=Br.get(t);r.truncate(0),r.write(0,e)}}var Yc=t=>t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t?t:typeof t=="boolean"?`${t}`:t instanceof Date?t.toISOString():JSON.stringify(t),Xc=t=>{if(t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t)return t;if(typeof t=="string"){const e=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/;if(/^(true|false)$/.test(t))return t==="true";if(e.test(t))return new Date(t);try{return JSON.parse(t,(r,u)=>typeof u=="string"&&e.exec(u)?new Date(u):u)}catch{}}return t},Zc=($a=class extends Js{constructor(e){super();w(this,vr,void 0);g(this,vr,e||Yc)}transformPrimitiveValueList(e){return{...e,values:e.values.map(n(this,vr))}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:u,...d}=r,b=n(this,vr).call(this,u);return u===b?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...d,value:b}})}transformValue(e){return{...e,value:n(this,vr).call(this,e.value)}}},vr=new WeakMap,$a),el=(Ja=class{constructor(t={}){w(this,Hn,void 0);w(this,Yn,void 0);w(this,un,void 0);g(this,Hn,new Zc(t.serializer)),g(this,Yn,t.deserializer||Xc),g(this,un,new WeakMap)}transformQuery(t){const{node:e,queryId:r}=t;return e.kind==="SelectQueryNode"&&n(this,un).set(r,e.kind),n(this,Hn).transformNode(t.node)}async parseResult(t){return await Promise.all(t.map(async e=>{const r={...e};for(const u in r)r[u]=await n(this,Yn).call(this,r[u]);return r}))}async transformResult(t){const{result:e,queryId:r}=t,{rows:u}=e,d=n(this,un).get(r);return u&&d==="SelectQueryNode"?{...t.result,rows:await this.parseResult(u)}:t.result}},Hn=new WeakMap,Yn=new WeakMap,un=new WeakMap,Ja);function to(t){return typeof t=="string"}function tl(t){return typeof t=="boolean"}async function _a(t,e,r,u,d="rowid"){await Je`
      create trigger if not exists ${Je.raw(e)}_${Je.raw(u)}
      after ${Je.raw(r)}
      on ${Je.table(e)}
      begin
        update ${Je.table(e)}
        set ${Je.ref(u)} = datetime('now','localtime')
        where ${Je.ref(d)} = NEW.${Je.ref(d)};
      end
    `.execute(t).catch(b=>{console.error(b)})}function rl(t){const e=new Map;for(const r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;const u=t[r];e.set(r,u)}return e}async function nl(t,e,r=!1){for(const[u,d]of e){const{columns:b,property:k}=d;r&&await t.schema.dropTable(u).ifExists().execute().catch();let I=t.schema.createTable(u),j="rowid",c=!1,_e="createAt",Fe="updateAt";if(k!=null&&k.timestamp&&!tl(k.timestamp)){const{create:P,update:Re}=k.timestamp;_e=P??"createAt",Fe=Re??"updateAt"}for(const P in b){if(!Object.prototype.hasOwnProperty.call(b,P))continue;const Re=b[P];let Y="text";const{type:Ee,notNull:Zn,defaultTo:Rt}=Re;switch(Ee){case"boolean":case"date":case"object":case"string":Y="text";break;case"increments":j=P;case"number":Y="integer";break;case"blob":Y="blob"}[_e,Fe].includes(P)||(I=I.addColumn(P,Y,yt=>Ee==="increments"?(c=!0,yt.autoIncrement().primaryKey()):(Zn&&(yt=yt.notNull()),Rt!==void 0&&(yt=yt.defaultTo(Rt instanceof Function?Rt(Je):Rt)),yt)))}if(k){const P=k.primary,Re=k.unique;if(k.timestamp&&(_e&&(I=I.addColumn(_e,"text")),Fe&&(I=I.addColumn(Fe,"text"))),!c&&P){const Y=to(P);j=Y?P:P[0],I=I.addPrimaryKeyConstraint(`pk_${Y?P:P.join("_")}`,Y?[P]:P)}Re==null||Re.forEach(Y=>{const Ee=to(Y);j=!P&&!c?Ee?Y:Y[0]:j,I=I.addUniqueConstraint(`un_${Ee?Y:Y.join("_")}`,Ee?[Y]:Y)})}if(await I.ifNotExists().execute(),k!=null&&k.index)for(const P of k.index){const Re=to(P);let Y=t.schema.createIndex(`idx_${Re?P:P.join("_")}`).on(u);Y=Re?Y.column(P):Y.columns(P),await Y.ifNotExists().execute()}k!=null&&k.timestamp&&(_e&&await _a(t,u,"insert",_e,j),Fe&&await _a(t,u,"update",Fe,j))}}var il=(Ga=class{constructor(t){Xe(this,"kysely");w(this,Yt,void 0);w(this,Xn,void 0);const{dialect:e,tables:r,dropTableBeforeInit:u,onError:d,onQuery:b,plugins:k}=t,I=k??[];I.push(new el),this.kysely=new En({dialect:e,log:j=>{j.level==="error"?d&&d(j.error):b&&b(j.query,j.queryDurationMillis)},plugins:I}),g(this,Yt,u?0:1),g(this,Xn,rl(r))}async init(t=!1){const e=t||n(this,Yt)===0;return await nl(this.kysely,n(this,Xn),e),g(this,Yt,2),this}async checkInit(){if(n(this,Yt)!==2&&await this.init(),n(this,Yt)!==2)throw new Error("fail to init table")}async transaction(t,e=!1){return await this.checkInit(),await this.kysely.transaction().execute(t).catch(r=>{e&&console.error(r)})}async exec(t,e=!1){return await this.checkInit(),t(this.kysely).catch(r=>{e&&console.error(r)})}async toSQL(t){return await this.checkInit(),t(this.kysely).compile()}async raw(t){return await this.checkInit(),t(Je).execute(this.kysely)}},Yt=new WeakMap,Xn=new WeakMap,Ga);async function sl(t){const e=await new il({dialect:t,tables:{test:{columns:{id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"},createAt:{type:"date"},updateAt:{type:"date"}},property:{timestamp:!0}}}}).init();console.log("test"),console.log(await e.raw(r=>r`PRAGMA table_info(${r.table("test")});`)),console.log(await e.raw(r=>r`select last_insert_rowid()`));for(let r=0;r<100;r++)await e.transaction(u=>u.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}).execute());return e.exec(r=>r.selectFrom("test").selectAll().execute())}const ol=new Lc({async database(){const t=await Qc({locateFile:()=>Uc});return new t.Database(await Kc("sqlijsWorker"))},onWrite:{func(t){console.log(`[sqljs worker] write to indexeddb, length: ${t.length}`),Hc("sqlijsWorker",t)}}});onmessage=()=>{console.log("start sqljs test"),sl(ol).then(t=>{t==null||t.forEach(e=>console.log("[sqlijs]",e))})}})();
