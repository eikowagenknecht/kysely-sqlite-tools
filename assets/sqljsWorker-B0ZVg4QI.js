var Qd=Object.defineProperty;var Ud=(t,e,r)=>e in t?Qd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var F=(t,e,r)=>(Ud(t,typeof e!="symbol"?e+"":e,r),r),Ao=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var n=(t,e,r)=>(Ao(t,e,"read from private field"),r?r.call(t):e.get(t)),N=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},g=(t,e,r,u)=>(Ao(t,e,"write to private field"),u?u.call(t,r):e.set(t,r),r);var M=(t,e,r)=>(Ao(t,e,"access private method"),r);function cr(t){return typeof t>"u"||t===void 0}function rt(t){return typeof t=="string"}function co(t){return typeof t=="number"}function hs(t){return typeof t=="boolean"}function ra(t){return t===null}function $d(t){return t instanceof Date}function ia(t){return typeof t=="bigint"}function it(t){return typeof t=="function"}function Wt(t){return typeof t=="object"&&t!==null}function a(t){return Object.freeze(t)}function es(t){return Vt(t)?t:[t]}function Vt(t){return Array.isArray(t)}function lr(t){return t}const Y=a({is(t){return t.kind==="AlterTableNode"},create(t){return a({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return a({...t,...e})},cloneWithColumnAlteration(t,e){return a({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),de=a({is(t){return t.kind==="IdentifierNode"},create(t){return a({kind:"IdentifierNode",name:t})}}),Lt=a({is(t){return t.kind==="CreateIndexNode"},create(t){return a({kind:"CreateIndexNode",name:de.create(t)})},cloneWith(t,e){return a({...t,...e})},cloneWithColumns(t,e){return a({...t,columns:[...t.columns||[],...e]})}}),zu=a({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return a({kind:"CreateSchemaNode",schema:de.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Jd=["preserve rows","delete rows","drop"],ze=a({is(t){return t.kind==="CreateTableNode"},create(t){return a({kind:"CreateTableNode",table:t,columns:a([])})},cloneWithColumn(t,e){return a({...t,columns:a([...t.columns,e])})},cloneWithConstraint(t,e){return a({...t,constraints:t.constraints?a([...t.constraints,e]):a([e])})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWith(t,e){return a({...t,...e})}}),pr=a({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return a({kind:"SchemableIdentifierNode",identifier:de.create(t)})},createWithSchema(t,e){return a({kind:"SchemableIdentifierNode",schema:de.create(t),identifier:de.create(e)})}}),Ki=a({is(t){return t.kind==="DropIndexNode"},create(t,e){return a({kind:"DropIndexNode",name:pr.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Po=a({is(t){return t.kind==="DropSchemaNode"},create(t,e){return a({kind:"DropSchemaNode",schema:de.create(t),...e})},cloneWith(t,e){return a({...t,...e})}}),Bo=a({is(t){return t.kind==="DropTableNode"},create(t,e){return a({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return a({...t,...e})}}),wr=a({is(t){return t.kind==="AliasNode"},create(t,e){return a({kind:"AliasNode",node:t,alias:e})}}),fr=a({is(t){return t.kind==="TableNode"},create(t){return a({kind:"TableNode",table:pr.create(t)})},createWithSchema(t,e){return a({kind:"TableNode",table:pr.createWithSchema(t,e)})}});function Ve(t){return Wt(t)&&it(t.toOperationNode)}function Vd(t){return Wt(t)&&"expressionType"in t&&Ve(t)}function jd(t){return Wt(t)&&"expression"in t&&rt(t.alias)&&Ve(t)}const Rt=a({is(t){return t.kind==="SelectModifierNode"},create(t,e){return a({kind:"SelectModifierNode",modifier:t,of:e})},createWithExpression(t){return a({kind:"SelectModifierNode",rawModifier:t})}}),mr=a({is(t){return t.kind==="AndNode"},create(t,e){return a({kind:"AndNode",left:t,right:e})}}),Ai=a({is(t){return t.kind==="OrNode"},create(t,e){return a({kind:"OrNode",left:t,right:e})}}),Do=a({is(t){return t.kind==="OnNode"},create(t){return a({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return a({...t,on:e==="And"?mr.create(t.on,r):Ai.create(t.on,r)})}}),Hi=a({is(t){return t.kind==="JoinNode"},create(t,e){return a({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return a({kind:"JoinNode",joinType:t,table:e,on:Do.create(r)})},cloneWithOn(t,e){return a({...t,on:t.on?Do.cloneWithOperation(t.on,"And",e):Do.create(e)})}}),Ti=a({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return a({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),Gd=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],zd=["+","-","*","/","%","^","&","|","#","<<",">>"],Ku=["->","->>"],Kd=[...Gd,...zd,"&&","||"],Hd=["exists","not exists"],Yd=["not","-",...Hd],Xd=[...Kd,...Ku,...Yd,"between","between symmetric"],yr=a({is(t){return t.kind==="OperatorNode"},create(t){return a({kind:"OperatorNode",operator:t})}});function gu(t){return rt(t)&&Ku.includes(t)}const Ne=a({is(t){return t.kind==="ColumnNode"},create(t){return a({kind:"ColumnNode",column:de.create(t)})}}),na=a({is(t){return t.kind==="SelectAllNode"},create(){return a({kind:"SelectAllNode"})}}),lo=a({is(t){return t.kind==="ReferenceNode"},create(t,e){return a({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return a({kind:"ReferenceNode",table:t,column:na.create()})}});var ui;class Zd{constructor(e){N(this,ui,void 0);g(this,ui,e)}get dynamicReference(){return n(this,ui)}get refType(){}toOperationNode(){return eh(n(this,ui))}}ui=new WeakMap;function Hu(t){return Wt(t)&&Ve(t)&&rt(t.dynamicReference)}const _o=a({is(t){return t.kind==="OrderByItemNode"},create(t,e){return a({kind:"OrderByItemNode",orderBy:t,direction:e})}}),Ae=a({is(t){return t.kind==="RawNode"},create(t,e){return a({kind:"RawNode",sqlFragments:a(t),parameters:a(e)})},createWithSql(t){return Ae.create([t],[])},createWithChild(t){return Ae.create(["",""],[t])},createWithChildren(t){return Ae.create(new Array(t.length+1).fill(""),t)}});function Yu(t){return t==="asc"||t==="desc"}function fo(t){if(t.length===2)return[Ro(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>Ro(r)):[Ro(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function Ro(t,e){const r=ec(t);if(_o.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return _o.create(r,Xu(e))}function ec(t){if(Ln(t))return jr(t);if(Hu(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!Yu(r))throw new Error(`Invalid order by direction: ${r}`);return _o.create(jt(e),Xu(r))}return jt(t)}function Xu(t){if(t)return t==="asc"||t==="desc"?Ae.createWithSql(t):t.toOperationNode()}const ds=a({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return a({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return a({...t,traversal:e})}}),Zu=a({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return a({kind:"JSONOperatorChainNode",operator:t,values:a([])})},cloneWithValue(t,e){return a({...t,values:a([...t.values,e])})}}),Yi=a({is(t){return t.kind==="JSONPathNode"},create(t){return a({kind:"JSONPathNode",inOperator:t,pathLegs:a([])})},cloneWithLeg(t,e){return a({...t,pathLegs:a([...t.pathLegs,e])})}});function eh(t){return rt(t)?jt(t):t.toOperationNode()}function hn(t){return Vt(t)?t.map(e=>tt(e)):[tt(t)]}function tt(t){return Ln(t)?jr(t):eh(t)}function tc(t,e){const r=jt(t);if(gu(e))return ds.create(r,Zu.create(yr.create(e)));const u=e.slice(0,-1);if(gu(u))return ds.create(r,Yi.create(yr.create(u)));throw new Error(`Invalid JSON operator: ${e}`)}function jt(t){const e=".";if(!t.includes(e))return lo.create(Ne.create(t));const r=t.split(e).map(sa);if(r.length===3)return ic(r);if(r.length===2)return nc(r);throw new Error(`invalid column reference ${t}`)}function rc(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(sa);return wr.create(jt(r),de.create(u))}else return jt(t)}function th(t){return Ne.create(t)}function cs(t){const e=" ";if(t.includes(e)){const[r,u]=t.split(e).map(sa);if(!Yu(u))throw new Error(`invalid order direction "${u}" next to "${r}"`);return fo([r,u])[0]}else return th(t)}function ic(t){const[e,r,u]=t;return lo.create(Ne.create(u),fr.createWithSchema(e,r))}function nc(t){const[e,r]=t;return lo.create(Ne.create(r),fr.create(e))}function sa(t){return t.trim()}const rh=a({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return a({kind:"PrimitiveValueListNode",values:a([...t])})}}),oa=a({is(t){return t.kind==="ValueListNode"},create(t){return a({kind:"ValueListNode",values:a(t)})}}),kt=a({is(t){return t.kind==="ValueNode"},create(t){return a({kind:"ValueNode",value:t})},createImmediate(t){return a({kind:"ValueNode",value:t,immediate:!0})}});function sc(t){return Vt(t)?oc(t):qe(t)}function qe(t){return Ln(t)?jr(t):kt.create(t)}function aa(t){return co(t)||hs(t)||ra(t)}function ua(t){if(!aa(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return kt.createImmediate(t)}function oc(t){return t.some(Ln)?oa.create(t.map(e=>qe(e))):rh.create(t)}const Ei=a({is(t){return t.kind==="ParensNode"},create(t){return a({kind:"ParensNode",node:t})}});function De(t){if(t.length===3)return ha(t[0],t[1],t[2]);if(t.length===1)return qe(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function ha(t,e,r){return ac(e)&&ih(r)?Ti.create(tt(t),Fo(e),kt.createImmediate(r)):Ti.create(tt(t),Fo(e),sc(r))}function It(t,e,r){return Ti.create(tt(t),Fo(e),tt(r))}function bu(t,e){return ls(Object.entries(t).filter(([,r])=>!cr(r)).map(([r,u])=>ha(r,ih(u)?"is":"=",u)),e)}function ls(t,e,r=!0){const u=e==="and"?mr.create:Ai.create;if(t.length===0)return Ti.create(kt.createImmediate(1),yr.create("="),kt.createImmediate(e==="and"?1:0));let d=xu(t[0]);for(let m=1;m<t.length;++m)d=u(d,xu(t[m]));return t.length>1&&r?Ei.create(d):d}function ac(t){return t==="is"||t==="is not"}function ih(t){return ra(t)||hs(t)}function Fo(t){if(rt(t)&&Xd.includes(t))return yr.create(t);if(Ve(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function xu(t){return Ve(t)?t.toOperationNode():t}const Si=a({is(t){return t.kind==="OrderByNode"},create(t){return a({kind:"OrderByNode",items:a([...t])})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),qu=a({is(t){return t.kind==="PartitionByNode"},create(t){return a({kind:"PartitionByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),Qo=a({is(t){return t.kind==="OverNode"},create(){return a({kind:"OverNode"})},cloneWithOrderByItems(t,e){return a({...t,orderBy:t.orderBy?Si.cloneWithItems(t.orderBy,e):Si.create(e)})},cloneWithPartitionByItems(t,e){return a({...t,partitionBy:t.partitionBy?qu.cloneWithItems(t.partitionBy,e):qu.create(e)})}}),fs=a({is(t){return t.kind==="FromNode"},create(t){return a({kind:"FromNode",froms:a(t)})},cloneWithFroms(t,e){return a({...t,froms:a([...t.froms,...e])})}}),Ou=a({is(t){return t.kind==="GroupByNode"},create(t){return a({kind:"GroupByNode",items:a(t)})},cloneWithItems(t,e){return a({...t,items:a([...t.items,...e])})}}),Wu=a({is(t){return t.kind==="HavingNode"},create(t){return a({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return a({...t,having:e==="And"?mr.create(t.having,r):Ai.create(t.having,r)})}}),Q=a({is(t){return t.kind==="SelectQueryNode"},create(t){return a({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return a({kind:"SelectQueryNode",from:fs.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})},cloneWithDistinctOn(t,e){return a({...t,distinctOn:t.distinctOn?a([...t.distinctOn,...e]):a(e)})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):a([e])})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):a([e])})},cloneWithOrderByItems(t,e){return a({...t,orderBy:t.orderBy?Si.cloneWithItems(t.orderBy,e):Si.create(e)})},cloneWithGroupByItems(t,e){return a({...t,groupBy:t.groupBy?Ou.cloneWithItems(t.groupBy,e):Ou.create(e)})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithOffset(t,e){return a({...t,offset:e})},cloneWithFetch(t,e){return a({...t,fetch:e})},cloneWithHaving(t,e){return a({...t,having:t.having?Wu.cloneWithOperation(t.having,"And",e):Wu.create(e)})},cloneWithSetOperations(t,e){return a({...t,setOperations:t.setOperations?a([...t.setOperations,...e]):a([...e])})},cloneWithoutSelections(t){return a({...t,selections:[]})},cloneWithoutLimit(t){return a({...t,limit:void 0})},cloneWithoutOffset(t){return a({...t,offset:void 0})},cloneWithoutOrderBy(t){return a({...t,orderBy:void 0})}});function P(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var ct;const tn=class tn{constructor(e){N(this,ct,void 0);g(this,ct,a(e))}on(...e){return new tn({...n(this,ct),joinNode:Hi.cloneWithOn(n(this,ct).joinNode,De(e))})}onRef(e,r,u){return new tn({...n(this,ct),joinNode:Hi.cloneWithOn(n(this,ct).joinNode,It(e,r,u))})}onTrue(){return new tn({...n(this,ct),joinNode:Hi.cloneWithOn(n(this,ct).joinNode,Ae.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return n(this,ct).joinNode}};ct=new WeakMap;let ps=tn;P(ps,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const uc=a({is(t){return t.kind==="PartitionByItemNode"},create(t){return a({kind:"PartitionByItemNode",partitionBy:t})}});function hc(t){return hn(t).map(uc.create)}var Ar;const Qs=class Qs{constructor(e){N(this,Ar,void 0);g(this,Ar,a(e))}orderBy(e,r){return new Qs({overNode:Qo.cloneWithOrderByItems(n(this,Ar).overNode,fo([e,r]))})}partitionBy(e){return new Qs({overNode:Qo.cloneWithPartitionByItems(n(this,Ar).overNode,hc(e))})}$call(e){return e(this)}toOperationNode(){return n(this,Ar).overNode}};Ar=new WeakMap;let ms=Qs;P(ms,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const Xi=a({is(t){return t.kind==="SelectionNode"},create(t){return a({kind:"SelectionNode",selection:t})},createSelectAll(){return a({kind:"SelectionNode",selection:na.create()})},createSelectAllFromTable(t){return a({kind:"SelectionNode",selection:lo.createSelectAll(t)})}});function Di(t){return it(t)?Di(t(Li())):Vt(t)?t.map(e=>Cu(e)):[Cu(t)]}function Cu(t){return rt(t)?Xi.create(rc(t)):Hu(t)?Xi.create(t.toOperationNode()):Xi.create(vh(t))}function En(t){return t?Array.isArray(t)?t.map(ku):[ku(t)]:[Xi.createSelectAll()]}function ku(t){if(rt(t))return Xi.createSelectAllFromTable(ye(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const dc=a({is(t){return t.kind==="ValuesNode"},create(t){return a({kind:"ValuesNode",values:a(t)})}}),cc=a({is(t){return t.kind==="DefaultInsertValueNode"},create(){return a({kind:"DefaultInsertValueNode"})}});function nh(t){const e=it(t)?t(Li()):t,r=Vt(e)?e:a([e]);return lc(r)}function lc(t){const e=fc(t);return[a([...e.keys()].map(Ne.create)),dc.create(t.map(r=>pc(r,e)))]}function fc(t){const e=new Map;for(const r of t){const u=Object.keys(r);for(const d of u)!e.has(d)&&r[d]!==void 0&&e.set(d,e.size)}return e}function pc(t,e){const r=Object.keys(t),u=Array.from({length:e.size});let d=!1;for(const x of r){const E=e.get(x);if(cr(E))continue;const H=t[x];(cr(H)||Ln(H))&&(d=!0),u[E]=H}if(r.length<e.size||d){const x=cc.create();return oa.create(u.map(E=>cr(E)?x:qe(E)))}return rh.create(u)}const et=a({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return a({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},createWithoutInto(){return a({kind:"InsertQueryNode"})},cloneWith(t,e){return a({...t,...e})}}),oi=a({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return a({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},createWithoutTable(){return a({kind:"UpdateQueryNode"})},cloneWithFromItems(t,e){return a({...t,from:t.from?fs.cloneWithFroms(t.from,e):fs.create(e)})},cloneWithUpdates(t,e){return a({...t,updates:t.updates?a([...t.updates,...e]):e})},cloneWithLimit(t,e){return a({...t,limit:e})}}),Iu=a({is(t){return t.kind==="UsingNode"},create(t){return a({kind:"UsingNode",tables:a(t)})},cloneWithTables(t,e){return a({...t,tables:a([...t.tables,...e])})}}),Cr=a({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return a({kind:"DeleteQueryNode",from:fs.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return a({...t,orderBy:t.orderBy?Si.cloneWithItems(t.orderBy,e):Si.create(e)})},cloneWithoutOrderBy(t){return a({...t,orderBy:void 0})},cloneWithLimit(t,e){return a({...t,limit:e})},cloneWithoutLimit(t){return a({...t,limit:void 0})},cloneWithUsing(t,e){return a({...t,using:t.using!==void 0?Iu.cloneWithTables(t.using,e):Iu.create(e)})}}),$e=a({is(t){return t.kind==="WhereNode"},create(t){return a({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return a({...t,where:e==="And"?mr.create(t.where,r):Ai.create(t.where,r)})}}),Tu=a({is(t){return t.kind==="ReturningNode"},create(t){return a({kind:"ReturningNode",selections:a(t)})},cloneWithSelections(t,e){return a({...t,selections:t.selections?a([...t.selections,...e]):a(e)})}}),mc=a({is(t){return t.kind==="ExplainNode"},create(t,e){return a({kind:"ExplainNode",format:t,options:e})}}),Sn=a({is(t){return t.kind==="WhenNode"},create(t){return a({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return a({...t,result:e})}}),Je=a({is(t){return t.kind==="MergeQueryNode"},create(t,e){return a({kind:"MergeQueryNode",into:t,...e&&{with:e}})},cloneWithUsing(t,e){return a({...t,using:e})},cloneWithWhen(t,e){return a({...t,whens:t.whens?a([...t.whens,e]):a([e])})},cloneWithThen(t,e){return a({...t,whens:t.whens?a([...t.whens.slice(0,-1),Sn.cloneWithResult(t.whens[t.whens.length-1],e)]):void 0})}}),S=a({is(t){return Q.is(t)||et.is(t)||oi.is(t)||Cr.is(t)||Je.is(t)},cloneWithWhere(t,e){return a({...t,where:t.where?$e.cloneWithOperation(t.where,"And",e):$e.create(e)})},cloneWithJoin(t,e){return a({...t,joins:t.joins?a([...t.joins,e]):a([e])})},cloneWithReturning(t,e){return a({...t,returning:t.returning?Tu.cloneWithSelections(t.returning,e):Tu.create(e)})},cloneWithoutReturning(t){return a({...t,returning:void 0})},cloneWithoutWhere(t){return a({...t,where:void 0})},cloneWithExplain(t,e,r){return a({...t,explain:mc.create(e,r?.toOperationNode())})},cloneWithTop(t,e){return a({...t,top:e})}}),sh=a({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return a({kind:"ColumnUpdateNode",column:t,value:e})}});function yc(...t){return t.length===2?[sh.create(tt(t[0]),qe(t[1]))]:da(t[0])}function da(t){const e=it(t)?t(Li()):t;return Object.entries(e).filter(([r,u])=>u!==void 0).map(([r,u])=>sh.create(Ne.create(r),qe(u)))}const Nc=a({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return a({kind:"OnDuplicateKeyNode",updates:t})}});class wc{constructor(e,r){F(this,"insertId");F(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class An extends Error{constructor(r){super("no result");F(this,"node");this.node=r}}function Dn(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Ze=a({is(t){return t.kind==="OnConflictNode"},create(){return a({kind:"OnConflictNode"})},cloneWith(t,e){return a({...t,...e})},cloneWithIndexWhere(t,e){return a({...t,indexWhere:t.indexWhere?$e.cloneWithOperation(t.indexWhere,"And",e):$e.create(e)})},cloneWithIndexOrWhere(t,e){return a({...t,indexWhere:t.indexWhere?$e.cloneWithOperation(t.indexWhere,"Or",e):$e.create(e)})},cloneWithUpdateWhere(t,e){return a({...t,updateWhere:t.updateWhere?$e.cloneWithOperation(t.updateWhere,"And",e):$e.create(e)})},cloneWithUpdateOrWhere(t,e){return a({...t,updateWhere:t.updateWhere?$e.cloneWithOperation(t.updateWhere,"Or",e):$e.create(e)})},cloneWithoutIndexWhere(t){return a({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return a({...t,updateWhere:void 0})}});var re;const Mt=class Mt{constructor(e){N(this,re,void 0);g(this,re,a(e))}column(e){const r=Ne.create(e);return new Mt({...n(this,re),onConflictNode:Ze.cloneWith(n(this,re).onConflictNode,{columns:n(this,re).onConflictNode.columns?a([...n(this,re).onConflictNode.columns,r]):a([r])})})}columns(e){const r=e.map(Ne.create);return new Mt({...n(this,re),onConflictNode:Ze.cloneWith(n(this,re).onConflictNode,{columns:n(this,re).onConflictNode.columns?a([...n(this,re).onConflictNode.columns,...r]):a(r)})})}constraint(e){return new Mt({...n(this,re),onConflictNode:Ze.cloneWith(n(this,re).onConflictNode,{constraint:de.create(e)})})}expression(e){return new Mt({...n(this,re),onConflictNode:Ze.cloneWith(n(this,re).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new Mt({...n(this,re),onConflictNode:Ze.cloneWithIndexWhere(n(this,re).onConflictNode,De(e))})}whereRef(e,r,u){return new Mt({...n(this,re),onConflictNode:Ze.cloneWithIndexWhere(n(this,re).onConflictNode,It(e,r,u))})}clearWhere(){return new Mt({...n(this,re),onConflictNode:Ze.cloneWithoutIndexWhere(n(this,re).onConflictNode)})}doNothing(){return new oh({...n(this,re),onConflictNode:Ze.cloneWith(n(this,re).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new Ns({...n(this,re),onConflictNode:Ze.cloneWith(n(this,re).onConflictNode,{updates:da(e)})})}$call(e){return e(this)}};re=new WeakMap;let ys=Mt;P(ys,"don't await OnConflictBuilder instances.");var Nn;class oh{constructor(e){N(this,Nn,void 0);g(this,Nn,a(e))}toOperationNode(){return n(this,Nn).onConflictNode}}Nn=new WeakMap;P(oh,"don't await OnConflictDoNothingBuilder instances.");var lt;const rn=class rn{constructor(e){N(this,lt,void 0);g(this,lt,a(e))}where(...e){return new rn({...n(this,lt),onConflictNode:Ze.cloneWithUpdateWhere(n(this,lt).onConflictNode,De(e))})}whereRef(e,r,u){return new rn({...n(this,lt),onConflictNode:Ze.cloneWithUpdateWhere(n(this,lt).onConflictNode,It(e,r,u))})}clearWhere(){return new rn({...n(this,lt),onConflictNode:Ze.cloneWithoutUpdateWhere(n(this,lt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return n(this,lt).onConflictNode}};lt=new WeakMap;let Ns=rn;P(Ns,"don't await OnConflictUpdateBuilder instances.");const vc=a({is(t){return t.kind==="TopNode"},create(t,e){return a({kind:"TopNode",expression:t,modifiers:e})}});function Ri(t,e){if(!co(t)&&!ia(t))throw new Error(`Invalid top expression: ${t}`);if(!cr(e)&&!gc(e))throw new Error(`Invalid top modifiers: ${e}`);return vc.create(t,e)}function gc(t){return t==="percent"||t==="with ties"||t==="percent with ties"}var R;const Oe=class Oe{constructor(e){N(this,R,void 0);g(this,R,a(e))}values(e){const[r,u]=nh(e);return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{columns:r,values:u})})}columns(e){return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{columns:a(e.map(Ne.create))})})}expression(e){return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{values:jr(e)})})}defaultValues(){return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{defaultValues:!0})})}ignore(){return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{ignore:!0})})}top(e,r){return new Oe({...n(this,R),queryNode:S.cloneWithTop(n(this,R).queryNode,Ri(e,r))})}onConflict(e){return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{onConflict:e(new ys({onConflictNode:Ze.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new Oe({...n(this,R),queryNode:et.cloneWith(n(this,R).queryNode,{onDuplicateKey:Nc.create(da(e))})})}returning(e){return new Oe({...n(this,R),queryNode:S.cloneWithReturning(n(this,R).queryNode,Di(e))})}returningAll(){return new Oe({...n(this,R),queryNode:S.cloneWithReturning(n(this,R).queryNode,En())})}clearReturning(){return new Oe({...n(this,R),queryNode:S.cloneWithoutReturning(n(this,R).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new Oe({...n(this,R)})}$castTo(){return new Oe(n(this,R))}$narrowType(){return new Oe(n(this,R))}$assertType(){return new Oe(n(this,R))}withPlugin(e){return new Oe({...n(this,R),executor:n(this,R).executor.withPlugin(e)})}toOperationNode(){return n(this,R).executor.transformQuery(n(this,R).queryNode,n(this,R).queryId)}compile(){return n(this,R).executor.compileQuery(this.toOperationNode(),n(this,R).queryId)}async execute(){const e=this.compile(),r=e.query,u=await n(this,R).executor.executeQuery(e,n(this,R).queryId);return n(this,R).executor.adapter.supportsReturning&&r.returning?u.rows:[new wc(u.insertId,u.numAffectedRows??u.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=An){const r=await this.executeTakeFirst();if(r===void 0)throw Dn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,R).executor.stream(r,e,n(this,R).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new Oe({...n(this,R),queryNode:S.cloneWithExplain(n(this,R).queryNode,e,r)}).execute()}};R=new WeakMap;let dn=Oe;P(dn,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class bc{constructor(e){F(this,"numDeletedRows");this.numDeletedRows=e}}const ca=a({is(t){return t.kind==="LimitNode"},create(t){return a({kind:"LimitNode",limit:t})}});var W;const he=class he{constructor(e){N(this,W,void 0);g(this,W,a(e))}where(...e){return new he({...n(this,W),queryNode:S.cloneWithWhere(n(this,W).queryNode,De(e))})}whereRef(e,r,u){return new he({...n(this,W),queryNode:S.cloneWithWhere(n(this,W).queryNode,It(e,r,u))})}clearWhere(){return new he({...n(this,W),queryNode:S.cloneWithoutWhere(n(this,W).queryNode)})}top(e,r){return new he({...n(this,W),queryNode:S.cloneWithTop(n(this,W).queryNode,Ri(e,r))})}using(e){return new he({...n(this,W),queryNode:Cr.cloneWithUsing(n(this,W).queryNode,ln(e))})}innerJoin(...e){return new he({...n(this,W),queryNode:S.cloneWithJoin(n(this,W).queryNode,Qe("InnerJoin",e))})}leftJoin(...e){return new he({...n(this,W),queryNode:S.cloneWithJoin(n(this,W).queryNode,Qe("LeftJoin",e))})}rightJoin(...e){return new he({...n(this,W),queryNode:S.cloneWithJoin(n(this,W).queryNode,Qe("RightJoin",e))})}fullJoin(...e){return new he({...n(this,W),queryNode:S.cloneWithJoin(n(this,W).queryNode,Qe("FullJoin",e))})}returning(e){return new he({...n(this,W),queryNode:S.cloneWithReturning(n(this,W).queryNode,Di(e))})}returningAll(e){return new he({...n(this,W),queryNode:S.cloneWithReturning(n(this,W).queryNode,En(e))})}clearReturning(){return new he({...n(this,W),queryNode:S.cloneWithoutReturning(n(this,W).queryNode)})}clearLimit(){return new he({...n(this,W),queryNode:Cr.cloneWithoutLimit(n(this,W).queryNode)})}clearOrderBy(){return new he({...n(this,W),queryNode:Cr.cloneWithoutOrderBy(n(this,W).queryNode)})}orderBy(e,r){return new he({...n(this,W),queryNode:Cr.cloneWithOrderByItems(n(this,W).queryNode,fo([e,r]))})}limit(e){return new he({...n(this,W),queryNode:Cr.cloneWithLimit(n(this,W).queryNode,ca.create(qe(e)))})}$call(e){return e(this)}$if(e,r){return e?r(this):new he({...n(this,W)})}$castTo(){return new he(n(this,W))}$narrowType(){return new he(n(this,W))}$assertType(){return new he(n(this,W))}withPlugin(e){return new he({...n(this,W),executor:n(this,W).executor.withPlugin(e)})}toOperationNode(){return n(this,W).executor.transformQuery(n(this,W).queryNode,n(this,W).queryId)}compile(){return n(this,W).executor.compileQuery(this.toOperationNode(),n(this,W).queryId)}async execute(){const e=this.compile(),r=e.query,u=await n(this,W).executor.executeQuery(e,n(this,W).queryId);return n(this,W).executor.adapter.supportsReturning&&r.returning?u.rows:[new bc(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=An){const r=await this.executeTakeFirst();if(r===void 0)throw Dn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,W).executor.stream(r,e,n(this,W).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new he({...n(this,W),queryNode:S.cloneWithExplain(n(this,W).queryNode,e,r)}).execute()}};W=new WeakMap;let ws=he;P(ws,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class xc{constructor(e,r){F(this,"numUpdatedRows");F(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}var C;const fe=class fe{constructor(e){N(this,C,void 0);g(this,C,a(e))}where(...e){return new fe({...n(this,C),queryNode:S.cloneWithWhere(n(this,C).queryNode,De(e))})}whereRef(e,r,u){return new fe({...n(this,C),queryNode:S.cloneWithWhere(n(this,C).queryNode,It(e,r,u))})}clearWhere(){return new fe({...n(this,C),queryNode:S.cloneWithoutWhere(n(this,C).queryNode)})}top(e,r){return new fe({...n(this,C),queryNode:S.cloneWithTop(n(this,C).queryNode,Ri(e,r))})}from(e){return new fe({...n(this,C),queryNode:oi.cloneWithFromItems(n(this,C).queryNode,ln(e))})}innerJoin(...e){return new fe({...n(this,C),queryNode:S.cloneWithJoin(n(this,C).queryNode,Qe("InnerJoin",e))})}leftJoin(...e){return new fe({...n(this,C),queryNode:S.cloneWithJoin(n(this,C).queryNode,Qe("LeftJoin",e))})}rightJoin(...e){return new fe({...n(this,C),queryNode:S.cloneWithJoin(n(this,C).queryNode,Qe("RightJoin",e))})}fullJoin(...e){return new fe({...n(this,C),queryNode:S.cloneWithJoin(n(this,C).queryNode,Qe("FullJoin",e))})}limit(e){return new fe({...n(this,C),queryNode:oi.cloneWithLimit(n(this,C).queryNode,ca.create(qe(e)))})}set(...e){return new fe({...n(this,C),queryNode:oi.cloneWithUpdates(n(this,C).queryNode,yc(...e))})}returning(e){return new fe({...n(this,C),queryNode:S.cloneWithReturning(n(this,C).queryNode,Di(e))})}returningAll(){return new fe({...n(this,C),queryNode:S.cloneWithReturning(n(this,C).queryNode,En())})}clearReturning(){return new fe({...n(this,C),queryNode:S.cloneWithoutReturning(n(this,C).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new fe({...n(this,C)})}$castTo(){return new fe(n(this,C))}$narrowType(){return new fe(n(this,C))}$assertType(){return new fe(n(this,C))}withPlugin(e){return new fe({...n(this,C),executor:n(this,C).executor.withPlugin(e)})}toOperationNode(){return n(this,C).executor.transformQuery(n(this,C).queryNode,n(this,C).queryId)}compile(){return n(this,C).executor.compileQuery(this.toOperationNode(),n(this,C).queryId)}async execute(){const e=this.compile(),r=e.query,u=await n(this,C).executor.executeQuery(e,n(this,C).queryId);return n(this,C).executor.adapter.supportsReturning&&r.returning?u.rows:[new xc(u.numAffectedRows??u.numUpdatedOrDeletedRows??BigInt(0),u.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=An){const r=await this.executeTakeFirst();if(r===void 0)throw Dn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,C).executor.stream(r,e,n(this,C).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new fe({...n(this,C),queryNode:S.cloneWithExplain(n(this,C).queryNode,e,r)}).execute()}};C=new WeakMap;let cn=fe;P(cn,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const Eu=a({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return a({kind:"CommonTableExpressionNameNode",table:fr.create(t),columns:e?a(e.map(Ne.create)):void 0})}}),vs=a({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return a({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return a({...t,...e})}});var Pt;const Us=class Us{constructor(e){N(this,Pt,void 0);g(this,Pt,a(e))}materialized(){return new Us({...n(this,Pt),node:vs.cloneWith(n(this,Pt).node,{materialized:!0})})}notMaterialized(){return new Us({...n(this,Pt),node:vs.cloneWith(n(this,Pt).node,{materialized:!1})})}toOperationNode(){return n(this,Pt).node}};Pt=new WeakMap;let gs=Us;P(gs,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function Su(t,e){const r=e(Rc()).toOperationNode();return it(t)?t(qc(r)).toOperationNode():vs.create(ah(t),r)}function qc(t){return e=>new gs({node:vs.create(ah(e),t)})}function ah(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],u=e[1].split(",").map(d=>d.trim());return Eu.create(r,u)}else return Eu.create(t)}const ts=a({is(t){return t.kind==="WithNode"},create(t,e){return a({kind:"WithNode",expressions:a([t]),...e})},cloneWithExpression(t,e){return a({...t,expressions:a([...t.expressions,e])})}}),Au=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function Oc(t){let e="";for(let r=0;r<t;++r)e+=Wc();return e}function Wc(){return Au[~~(Math.random()*Au.length)]}function X(){return new Cc}var hi;class Cc{constructor(){N(this,hi,void 0)}get queryId(){return n(this,hi)===void 0&&g(this,hi,Oc(8)),n(this,hi)}}hi=new WeakMap;var $s;class la{constructor(){F(this,"nodeStack",[]);N(this,$s,a({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),a(r)}transformNodeImpl(e){return n(this,$s)[e.kind](e)}transformNodeList(e){return e&&a(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:a([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}$s=new WeakMap;const kc=a({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0});var di,Dr,Rr,Js,uh,Vs,hh,js,dh,rr,ei,wn,Uo,Gs,ch;class Ic extends la{constructor(r){super();N(this,Js);N(this,Vs);N(this,js);N(this,rr);N(this,wn);N(this,Gs);N(this,di,void 0);N(this,Dr,new Set);N(this,Rr,new Set);g(this,di,r)}transformNodeImpl(r){if(!M(this,Js,uh).call(this,r))return super.transformNodeImpl(r);const u=M(this,js,dh).call(this,r);for(const x of u)n(this,Rr).add(x);const d=M(this,Vs,hh).call(this,r);for(const x of d)n(this,Dr).add(x);const m=super.transformNodeImpl(r);for(const x of d)n(this,Dr).delete(x);for(const x of u)n(this,Rr).delete(x);return m}transformSchemableIdentifier(r){const u=super.transformSchemableIdentifier(r);return u.schema||!n(this,Dr).has(r.identifier.name)?u:{...u,schema:de.create(n(this,di))}}transformReferences(r){const u=super.transformReferences(r);return u.table.table.schema?u:{...u,table:fr.createWithSchema(n(this,di),u.table.table.identifier.name)}}}di=new WeakMap,Dr=new WeakMap,Rr=new WeakMap,Js=new WeakSet,uh=function(r){return r.kind in kc},Vs=new WeakSet,hh=function(r){const u=new Set;if("name"in r&&r.name&&pr.is(r.name)&&M(this,wn,Uo).call(this,r.name,u),"from"in r&&r.from)for(const d of r.from.froms)M(this,rr,ei).call(this,d,u);if("into"in r&&r.into&&M(this,rr,ei).call(this,r.into,u),"table"in r&&r.table&&M(this,rr,ei).call(this,r.table,u),"joins"in r&&r.joins)for(const d of r.joins)M(this,rr,ei).call(this,d.table,u);return"using"in r&&r.using&&M(this,rr,ei).call(this,r.using,u),u},js=new WeakSet,dh=function(r){const u=new Set;return"with"in r&&r.with&&M(this,Gs,ch).call(this,r.with,u),u},rr=new WeakSet,ei=function(r,u){const d=fr.is(r)?r:wr.is(r)&&fr.is(r.node)?r.node:null;d&&M(this,wn,Uo).call(this,d.table,u)},wn=new WeakSet,Uo=function(r,u){const d=r.identifier.name;!n(this,Dr).has(d)&&!n(this,Rr).has(d)&&u.add(d)},Gs=new WeakSet,ch=function(r,u){for(const d of r.expressions){const m=d.name.table.table.identifier.name;n(this,Rr).has(m)||u.add(m)}};var vn;class Rn{constructor(e){N(this,vn,void 0);g(this,vn,new Ic(e))}transformQuery(e){return n(this,vn).transformNode(e.node)}async transformResult(e){return e.result}}vn=new WeakMap;const Tc=a({is(t){return t.kind==="MatchedNode"},create(t,e=!1){return a({kind:"MatchedNode",not:t,bySource:e})}});function Du(t,e,r){return Sn.create(ls([Tc.create(!t.isMatched,t.bySource),...e&&e.length>0?[e.length===3&&r?It(e[0],e[1],e[2]):De(e)]:[]],"and",!1))}function Zi(t){return rt(t)?Ae.create([t],[]):Ve(t)?t.toOperationNode():t}var gn,ci,li;class Ru{constructor(){N(this,gn,void 0);N(this,ci,void 0);N(this,li,void 0);F(this,"resolve",e=>{n(this,ci)&&n(this,ci).call(this,e)});F(this,"reject",e=>{n(this,li)&&n(this,li).call(this,e)});g(this,gn,new Promise((e,r)=>{g(this,li,r),g(this,ci,e)}))}get promise(){return n(this,gn)}}gn=new WeakMap,ci=new WeakMap,li=new WeakMap;const Lu=new Set;function Ec(t){Lu.has(t)||(Lu.add(t),console.log(t))}const Sc=a([]);var Lr,bn,$o;class lh{constructor(e=Sc){N(this,bn);N(this,Lr,void 0);g(this,Lr,e)}get plugins(){return n(this,Lr)}transformQuery(e,r){for(const u of n(this,Lr)){const d=u.transformQuery({node:e,queryId:r});if(d.kind===e.kind)e=d;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${d.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async u=>{const d=await u.executeQuery(e),m=await M(this,bn,$o).call(this,d,r);return Ac(d,m),m})}async*stream(e,r,u){const d=new Ru,m=new Ru;this.provideConnection(async E=>(d.resolve(E),await m.promise)).catch(E=>d.reject(E));const x=await d.promise;try{for await(const E of x.streamQuery(e,r))yield await M(this,bn,$o).call(this,E,u)}finally{m.resolve()}}}Lr=new WeakMap,bn=new WeakSet,$o=async function(e,r){for(const u of n(this,Lr))e=await u.transformResult({result:e,queryId:r});return e};function Ac(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Ec("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class ri extends lh{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new ri([...this.plugins,e])}withPlugins(e){return new ri([...this.plugins,...e])}withPluginAtFront(e){return new ri([e,...this.plugins])}withoutPlugins(){return new ri([])}}const po=new ri;class Dc{constructor(e){F(this,"numChangedRows");this.numChangedRows=e}}var ir;const wa=class wa{constructor(e){N(this,ir,void 0);g(this,ir,a(e))}top(e,r){return new wa({...n(this,ir),queryNode:S.cloneWithTop(n(this,ir).queryNode,Ri(e,r))})}using(...e){return new Jt({...n(this,ir),queryNode:Je.cloneWithUsing(n(this,ir).queryNode,Qe("Using",e))})}};ir=new WeakMap;let bs=wa;P(bs,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var We,fi,is,Bt,Or;const zs=class zs{constructor(e){N(this,fi);N(this,Bt);N(this,We,void 0);g(this,We,a(e))}top(e,r){return new zs({...n(this,We),queryNode:S.cloneWithTop(n(this,We).queryNode,Ri(e,r))})}whenMatched(){return M(this,fi,is).call(this,[])}whenMatchedAnd(...e){return M(this,fi,is).call(this,e)}whenMatchedAndRef(e,r,u){return M(this,fi,is).call(this,[e,r,u],!0)}whenNotMatched(){return M(this,Bt,Or).call(this,[])}whenNotMatchedAnd(...e){return M(this,Bt,Or).call(this,e)}whenNotMatchedAndRef(e,r,u){return M(this,Bt,Or).call(this,[e,r,u],!0)}whenNotMatchedBySource(){return M(this,Bt,Or).call(this,[],!1,!0)}whenNotMatchedBySourceAnd(...e){return M(this,Bt,Or).call(this,e,!1,!0)}whenNotMatchedBySourceAndRef(e,r,u){return M(this,Bt,Or).call(this,[e,r,u],!0,!0)}$call(e){return e(this)}$if(e,r){return e?r(this):new zs({...n(this,We)})}toOperationNode(){return n(this,We).executor.transformQuery(n(this,We).queryNode,n(this,We).queryId)}compile(){return n(this,We).executor.compileQuery(n(this,We).queryNode,n(this,We).queryId)}async execute(){const e=this.compile(),r=await n(this,We).executor.executeQuery(e,n(this,We).queryId);return[new Dc(r.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=An){const r=await this.executeTakeFirst();if(r===void 0)throw Dn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}};We=new WeakMap,fi=new WeakSet,is=function(e,r){return new Jo({...n(this,We),queryNode:Je.cloneWithWhen(n(this,We).queryNode,Du({isMatched:!0},e,r))})},Bt=new WeakSet,Or=function(e,r=!1,u=!1){const d={...n(this,We),queryNode:Je.cloneWithWhen(n(this,We).queryNode,Du({isMatched:!1,bySource:u},e,r))},m=u?Jo:fh;return new m(d)};let Jt=zs;P(Jt,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");var ft;class Jo{constructor(e){N(this,ft,void 0);g(this,ft,a(e))}thenDelete(){return new Jt({...n(this,ft),queryNode:Je.cloneWithThen(n(this,ft).queryNode,Zi("delete"))})}thenDoNothing(){return new Jt({...n(this,ft),queryNode:Je.cloneWithThen(n(this,ft).queryNode,Zi("do nothing"))})}thenUpdate(e){return new Jt({...n(this,ft),queryNode:Je.cloneWithThen(n(this,ft).queryNode,Zi(e(new cn({queryId:n(this,ft).queryId,executor:po,queryNode:oi.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate(r=>r.set(...e))}}ft=new WeakMap;P(Jo,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var nr;class fh{constructor(e){N(this,nr,void 0);g(this,nr,a(e))}thenDoNothing(){return new Jt({...n(this,nr),queryNode:Je.cloneWithThen(n(this,nr).queryNode,Zi("do nothing"))})}thenInsertValues(e){const[r,u]=nh(e);return new Jt({...n(this,nr),queryNode:Je.cloneWithThen(n(this,nr).queryNode,Zi(et.cloneWith(et.createWithoutInto(),{columns:r,values:u})))})}}nr=new WeakMap;P(fh,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");var G;const kr=class kr{constructor(e){N(this,G,void 0);g(this,G,a(e))}selectFrom(e){return Go({queryId:X(),executor:n(this,G).executor,queryNode:Q.createFrom(ln(e),n(this,G).withNode)})}selectNoFrom(e){return Go({queryId:X(),executor:n(this,G).executor,queryNode:Q.cloneWithSelections(Q.create(n(this,G).withNode),Di(e))})}insertInto(e){return new dn({queryId:X(),executor:n(this,G).executor,queryNode:et.create(ye(e),n(this,G).withNode)})}replaceInto(e){return new dn({queryId:X(),executor:n(this,G).executor,queryNode:et.create(ye(e),n(this,G).withNode,!0)})}deleteFrom(e){return new ws({queryId:X(),executor:n(this,G).executor,queryNode:Cr.create(ln(e),n(this,G).withNode)})}updateTable(e){return new cn({queryId:X(),executor:n(this,G).executor,queryNode:oi.create(fn(e),n(this,G).withNode)})}mergeInto(e){return new bs({queryId:X(),executor:n(this,G).executor,queryNode:Je.create(gh(e),n(this,G).withNode)})}with(e,r){const u=Su(e,r);return new kr({...n(this,G),withNode:n(this,G).withNode?ts.cloneWithExpression(n(this,G).withNode,u):ts.create(u)})}withRecursive(e,r){const u=Su(e,r);return new kr({...n(this,G),withNode:n(this,G).withNode?ts.cloneWithExpression(n(this,G).withNode,u):ts.create(u,{recursive:!0})})}withPlugin(e){return new kr({...n(this,G),executor:n(this,G).executor.withPlugin(e)})}withoutPlugins(){return new kr({...n(this,G),executor:n(this,G).executor.withoutPlugins()})}withSchema(e){return new kr({...n(this,G),executor:n(this,G).executor.withPluginAtFront(new Rn(e))})}};G=new WeakMap;let xs=kr;function Rc(){return new xs({executor:po})}function Lc(t,e){return new ps({joinNode:Hi.create(t,fn(e))})}function Mc(){return new ms({overNode:Qo.create()})}function Qe(t,e){if(e.length===3)return Bc(t,e[0],e[1],e[2]);if(e.length===2)return Pc(t,e[0],e[1]);throw new Error("not implemented")}function Pc(t,e,r){return r(Lc(t,e)).toOperationNode()}function Bc(t,e,r,u){return Hi.createWithOn(t,fn(e),It(r,"=",u))}const _c=a({is(t){return t.kind==="OffsetNode"},create(t){return a({kind:"OffsetNode",offset:t})}}),Fc=a({is(t){return t.kind==="GroupByItemNode"},create(t){return a({kind:"GroupByItemNode",groupBy:t})}});function Qc(t){return t=it(t)?t(Li()):t,hn(t).map(Fc.create)}const ph=a({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return a({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function Zr(t,e,r){return it(e)&&(e=e(pa())),Vt(e)||(e=[e]),e.map(u=>ph.create(t,jr(u),r))}var _t;const Ks=class Ks{constructor(e){N(this,_t,void 0);g(this,_t,e)}get expressionType(){}as(e){return new fa(this,e)}or(...e){return new Vo(Ai.create(n(this,_t),De(e)))}and(...e){return new jo(mr.create(n(this,_t),De(e)))}$castTo(){return new Ks(n(this,_t))}$notNull(){return new Ks(n(this,_t))}toOperationNode(){return n(this,_t)}};_t=new WeakMap;let ne=Ks;var pi,sr;class fa{constructor(e,r){N(this,pi,void 0);N(this,sr,void 0);g(this,pi,e),g(this,sr,r)}get expression(){return n(this,pi)}get alias(){return n(this,sr)}toOperationNode(){return wr.create(n(this,pi).toOperationNode(),Ve(n(this,sr))?n(this,sr).toOperationNode():de.create(n(this,sr)))}}pi=new WeakMap,sr=new WeakMap;var Mr;const Hs=class Hs{constructor(e){N(this,Mr,void 0);g(this,Mr,e)}get expressionType(){}as(e){return new fa(this,e)}or(...e){return new Hs(Ai.create(n(this,Mr),De(e)))}$castTo(){return new Hs(n(this,Mr))}toOperationNode(){return Ei.create(n(this,Mr))}};Mr=new WeakMap;let Vo=Hs;var Pr;const Ys=class Ys{constructor(e){N(this,Pr,void 0);g(this,Pr,e)}get expressionType(){}as(e){return new fa(this,e)}and(...e){return new Ys(mr.create(n(this,Pr),De(e)))}$castTo(){return new Ys(n(this,Pr))}toOperationNode(){return Ei.create(n(this,Pr))}};Pr=new WeakMap;let jo=Ys;const Uc={is(t){return t.kind==="FetchNode"},create(t,e){return{kind:"FetchNode",rowCount:kt.create(t),modifier:e}}};function $c(t,e){if(!co(t)&&!ia(t))throw new Error(`Invalid fetch row count: ${t}`);if(!Jc(e))throw new Error(`Invalid fetch modifier: ${e}`);return Uc.create(t,e)}function Jc(t){return t==="only"||t==="with ties"}var v;const T=class T{constructor(e){N(this,v,void 0);g(this,v,a(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new T({...n(this,v),queryNode:S.cloneWithWhere(n(this,v).queryNode,De(e))})}whereRef(e,r,u){return new T({...n(this,v),queryNode:S.cloneWithWhere(n(this,v).queryNode,It(e,r,u))})}having(...e){return new T({...n(this,v),queryNode:Q.cloneWithHaving(n(this,v).queryNode,De(e))})}havingRef(e,r,u){return new T({...n(this,v),queryNode:Q.cloneWithHaving(n(this,v).queryNode,It(e,r,u))})}select(e){return new T({...n(this,v),queryNode:Q.cloneWithSelections(n(this,v).queryNode,Di(e))})}distinctOn(e){return new T({...n(this,v),queryNode:Q.cloneWithDistinctOn(n(this,v).queryNode,hn(e))})}modifyFront(e){return new T({...n(this,v),queryNode:Q.cloneWithFrontModifier(n(this,v).queryNode,Rt.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.createWithExpression(e.toOperationNode()))})}distinct(){return new T({...n(this,v),queryNode:Q.cloneWithFrontModifier(n(this,v).queryNode,Rt.create("Distinct"))})}forUpdate(e){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.create("ForUpdate",e?es(e).map(ye):void 0))})}forShare(e){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.create("ForShare",e?es(e).map(ye):void 0))})}forKeyShare(e){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.create("ForKeyShare",e?es(e).map(ye):void 0))})}forNoKeyUpdate(e){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.create("ForNoKeyUpdate",e?es(e).map(ye):void 0))})}skipLocked(){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.create("SkipLocked"))})}noWait(){return new T({...n(this,v),queryNode:Q.cloneWithEndModifier(n(this,v).queryNode,Rt.create("NoWait"))})}selectAll(e){return new T({...n(this,v),queryNode:Q.cloneWithSelections(n(this,v).queryNode,En(e))})}innerJoin(...e){return new T({...n(this,v),queryNode:S.cloneWithJoin(n(this,v).queryNode,Qe("InnerJoin",e))})}leftJoin(...e){return new T({...n(this,v),queryNode:S.cloneWithJoin(n(this,v).queryNode,Qe("LeftJoin",e))})}rightJoin(...e){return new T({...n(this,v),queryNode:S.cloneWithJoin(n(this,v).queryNode,Qe("RightJoin",e))})}fullJoin(...e){return new T({...n(this,v),queryNode:S.cloneWithJoin(n(this,v).queryNode,Qe("FullJoin",e))})}innerJoinLateral(...e){return new T({...n(this,v),queryNode:S.cloneWithJoin(n(this,v).queryNode,Qe("LateralInnerJoin",e))})}leftJoinLateral(...e){return new T({...n(this,v),queryNode:S.cloneWithJoin(n(this,v).queryNode,Qe("LateralLeftJoin",e))})}orderBy(...e){return new T({...n(this,v),queryNode:Q.cloneWithOrderByItems(n(this,v).queryNode,fo(e))})}groupBy(e){return new T({...n(this,v),queryNode:Q.cloneWithGroupByItems(n(this,v).queryNode,Qc(e))})}limit(e){return new T({...n(this,v),queryNode:Q.cloneWithLimit(n(this,v).queryNode,ca.create(qe(e)))})}offset(e){return new T({...n(this,v),queryNode:Q.cloneWithOffset(n(this,v).queryNode,_c.create(qe(e)))})}fetch(e,r="only"){return new T({...n(this,v),queryNode:Q.cloneWithFetch(n(this,v).queryNode,$c(e,r))})}top(e,r){return new T({...n(this,v),queryNode:S.cloneWithTop(n(this,v).queryNode,Ri(e,r))})}union(e){return new T({...n(this,v),queryNode:Q.cloneWithSetOperations(n(this,v).queryNode,Zr("union",e,!1))})}unionAll(e){return new T({...n(this,v),queryNode:Q.cloneWithSetOperations(n(this,v).queryNode,Zr("union",e,!0))})}intersect(e){return new T({...n(this,v),queryNode:Q.cloneWithSetOperations(n(this,v).queryNode,Zr("intersect",e,!1))})}intersectAll(e){return new T({...n(this,v),queryNode:Q.cloneWithSetOperations(n(this,v).queryNode,Zr("intersect",e,!0))})}except(e){return new T({...n(this,v),queryNode:Q.cloneWithSetOperations(n(this,v).queryNode,Zr("except",e,!1))})}exceptAll(e){return new T({...n(this,v),queryNode:Q.cloneWithSetOperations(n(this,v).queryNode,Zr("except",e,!0))})}as(e){return new mh(this,e)}clearSelect(){return new T({...n(this,v),queryNode:Q.cloneWithoutSelections(n(this,v).queryNode)})}clearWhere(){return new T({...n(this,v),queryNode:S.cloneWithoutWhere(n(this,v).queryNode)})}clearLimit(){return new T({...n(this,v),queryNode:Q.cloneWithoutLimit(n(this,v).queryNode)})}clearOffset(){return new T({...n(this,v),queryNode:Q.cloneWithoutOffset(n(this,v).queryNode)})}clearOrderBy(){return new T({...n(this,v),queryNode:Q.cloneWithoutOrderBy(n(this,v).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new T({...n(this,v)})}$castTo(){return new T(n(this,v))}$narrowType(){return new T(n(this,v))}$assertType(){return new T(n(this,v))}$asTuple(){return new ne(this.toOperationNode())}withPlugin(e){return new T({...n(this,v),executor:n(this,v).executor.withPlugin(e)})}toOperationNode(){return n(this,v).executor.transformQuery(n(this,v).queryNode,n(this,v).queryId)}compile(){return n(this,v).executor.compileQuery(this.toOperationNode(),n(this,v).queryId)}async execute(){const e=this.compile();return(await n(this,v).executor.executeQuery(e,n(this,v).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=An){const r=await this.executeTakeFirst();if(r===void 0)throw Dn(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),u=n(this,v).executor.stream(r,e,n(this,v).queryId);for await(const d of u)yield*d.rows}async explain(e,r){return await new T({...n(this,v),queryNode:S.cloneWithExplain(n(this,v).queryNode,e,r)}).execute()}};v=new WeakMap;let qs=T;P(qs,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function Go(t){return new qs(t)}var mi,yi;class mh{constructor(e,r){N(this,mi,void 0);N(this,yi,void 0);g(this,mi,e),g(this,yi,r)}get expression(){return n(this,mi)}get alias(){return n(this,yi)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return wr.create(n(this,mi).toOperationNode(),de.create(n(this,yi)))}}mi=new WeakMap,yi=new WeakMap;P(mh,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const Sr=a({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return a({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return a({...t,distinct:!0})},cloneWithFilter(t,e){return a({...t,filter:t.filter?$e.cloneWithOperation(t.filter,"And",e):$e.create(e)})},cloneWithOrFilter(t,e){return a({...t,filter:t.filter?$e.cloneWithOperation(t.filter,"Or",e):$e.create(e)})},cloneWithOver(t,e){return a({...t,over:e})}}),Mu=a({is(t){return t.kind==="FunctionNode"},create(t,e){return a({kind:"FunctionNode",func:t,arguments:e})}});var Pe;const Zt=class Zt{constructor(e){N(this,Pe,void 0);g(this,Pe,a(e))}get expressionType(){}as(e){return new Vc(this,e)}distinct(){return new Zt({...n(this,Pe),aggregateFunctionNode:Sr.cloneWithDistinct(n(this,Pe).aggregateFunctionNode)})}filterWhere(...e){return new Zt({...n(this,Pe),aggregateFunctionNode:Sr.cloneWithFilter(n(this,Pe).aggregateFunctionNode,De(e))})}filterWhereRef(e,r,u){return new Zt({...n(this,Pe),aggregateFunctionNode:Sr.cloneWithFilter(n(this,Pe).aggregateFunctionNode,It(e,r,u))})}over(e){const r=Mc();return new Zt({...n(this,Pe),aggregateFunctionNode:Sr.cloneWithOver(n(this,Pe).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}$castTo(){return new Zt(n(this,Pe))}$notNull(){return new Zt(n(this,Pe))}toOperationNode(){return n(this,Pe).aggregateFunctionNode}};Pe=new WeakMap;let ai=Zt;P(ai,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var Ni,wi;class Vc{constructor(e,r){N(this,Ni,void 0);N(this,wi,void 0);g(this,Ni,e),g(this,wi,r)}get expression(){return n(this,Ni)}get alias(){return n(this,wi)}toOperationNode(){return wr.create(n(this,Ni).toOperationNode(),de.create(n(this,wi)))}}Ni=new WeakMap,wi=new WeakMap;function yh(){const t=(r,u)=>new ne(Mu.create(r,hn(u??[]))),e=(r,u)=>new ai({aggregateFunctionNode:Sr.create(r,u?hn(u):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(...r){return t("coalesce",r)},count(r){return e("count",[r])},countAll(r){return new ai({aggregateFunctionNode:Sr.create("count",En(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])},jsonAgg(r){return new ai({aggregateFunctionNode:Sr.create("json_agg",[rt(r)?ye(r):r.toOperationNode()])})},toJson(r){return new ne(Mu.create("to_json",[rt(r)?ye(r):r.toOperationNode()]))}})}const jc=a({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return a({kind:"UnaryOperationNode",operator:t,operand:e})}});function Gc(t,e){return jc.create(yr.create(t),tt(e))}const Ct=a({is(t){return t.kind==="CaseNode"},create(t){return a({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return a({...t,when:a(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return a({...t,when:t.when?a([...t.when.slice(0,-1),Sn.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return a({...t,...e})}});var vi;class Nh{constructor(e){N(this,vi,void 0);g(this,vi,a(e))}when(...e){return new wh({...n(this,vi),node:Ct.cloneWithWhen(n(this,vi).node,Sn.create(De(e)))})}}vi=new WeakMap;var gi;class wh{constructor(e){N(this,gi,void 0);g(this,gi,a(e))}then(e){return new zc({...n(this,gi),node:Ct.cloneWithThen(n(this,gi).node,aa(e)?ua(e):qe(e))})}}gi=new WeakMap;var bt;class zc{constructor(e){N(this,bt,void 0);g(this,bt,a(e))}when(...e){return new wh({...n(this,bt),node:Ct.cloneWithWhen(n(this,bt).node,Sn.create(De(e)))})}else(e){return new Kc({...n(this,bt),node:Ct.cloneWith(n(this,bt).node,{else:aa(e)?ua(e):qe(e)})})}end(){return new ne(Ct.cloneWith(n(this,bt).node,{isStatement:!1}))}endCase(){return new ne(Ct.cloneWith(n(this,bt).node,{isStatement:!0}))}}bt=new WeakMap;var bi;class Kc{constructor(e){N(this,bi,void 0);g(this,bi,a(e))}end(){return new ne(Ct.cloneWith(n(this,bi).node,{isStatement:!1}))}endCase(){return new ne(Ct.cloneWith(n(this,bi).node,{isStatement:!0}))}}bi=new WeakMap;const Pu=a({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return a({kind:"JSONPathLegNode",type:t,value:e})}});var xt,xn,zo;class en{constructor(e){N(this,xn);N(this,xt,void 0);g(this,xt,e)}at(e){return M(this,xn,zo).call(this,"ArrayLocation",e)}key(e){return M(this,xn,zo).call(this,"Member",e)}}xt=new WeakMap,xn=new WeakSet,zo=function(e,r){return ds.is(n(this,xt))?new Bu(ds.cloneWithTraversal(n(this,xt),Yi.is(n(this,xt).traversal)?Yi.cloneWithLeg(n(this,xt).traversal,Pu.create(e,r)):Zu.cloneWithValue(n(this,xt).traversal,kt.createImmediate(r)))):new Bu(Yi.cloneWithLeg(n(this,xt),Pu.create(e,r)))};var Br;class Bu extends en{constructor(r){super(r);N(this,Br,void 0);g(this,Br,r)}get expressionType(){}as(r){return new Hc(this,r)}$castTo(){return new en(n(this,Br))}$notNull(){return new en(n(this,Br))}toOperationNode(){return n(this,Br)}}Br=new WeakMap;var xi,or;class Hc{constructor(e,r){N(this,xi,void 0);N(this,or,void 0);g(this,xi,e),g(this,or,r)}get expression(){return n(this,xi)}get alias(){return n(this,or)}toOperationNode(){return wr.create(n(this,xi).toOperationNode(),Ve(n(this,or))?n(this,or).toOperationNode():de.create(n(this,or)))}}xi=new WeakMap,or=new WeakMap;const _u=a({is(t){return t.kind==="TupleNode"},create(t){return a({kind:"TupleNode",values:a(t)})}}),Yc=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob"],Xc=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timez\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/],Zc=a({is(t){return t.kind==="DataTypeNode"},create(t){return a({kind:"DataTypeNode",dataType:t})}});function el(t){return!!(Yc.includes(t)||Xc.some(e=>e.test(t)))}function Vr(t){if(Ve(t))return t.toOperationNode();if(el(t))return Zc.create(t);throw new Error(`invalid column data type ${JSON.stringify(t)}`)}const tl=a({is(t){return t.kind==="CastNode"},create(t,e){return a({kind:"CastNode",expression:t,dataType:e})}});function pa(t=po){function e(d,m,x){return new ne(ha(d,m,x))}function r(d,m){return new ne(Gc(d,m))}const u=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(d){return Go({queryId:X(),executor:t,queryNode:Q.createFrom(ln(d))})},case(d){return new Nh({node:Ct.create(cr(d)?void 0:tt(d))})},ref(d,m){return cr(m)?new ne(jt(d)):new en(tc(d,m))},jsonPath(){return new en(Yi.create())},table(d){return new ne(ye(d))},val(d){return new ne(qe(d))},refTuple(...d){return new ne(_u.create(d.map(tt)))},tuple(...d){return new ne(_u.create(d.map(qe)))},lit(d){return new ne(ua(d))},unary:r,not(d){return r("not",d)},exists(d){return r("exists",d)},neg(d){return r("-",d)},between(d,m,x){return new ne(Ti.create(tt(d),yr.create("between"),mr.create(qe(m),qe(x))))},betweenSymmetric(d,m,x){return new ne(Ti.create(tt(d),yr.create("between symmetric"),mr.create(qe(m),qe(x))))},and(d){return Vt(d)?new ne(ls(d,"and")):new ne(bu(d,"and"))},or(d){return Vt(d)?new ne(ls(d,"or")):new ne(bu(d,"or"))},parens(...d){const m=De(d);return Ei.is(m)?new ne(m):new ne(Ei.create(m))},cast(d,m){return new ne(tl.create(tt(d),Vr(m)))},withSchema(d){return pa(t.withPluginAtFront(new Rn(d)))}});return u.fn=yh(),u.eb=u,u}function Li(t){return pa()}function jr(t){if(Ve(t))return t.toOperationNode();if(it(t))return t(Li()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function vh(t){if(Ve(t))return t.toOperationNode();if(it(t))return t(Li()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Ln(t){return Vd(t)||jd(t)||it(t)}function ln(t){return Vt(t)?t.map(e=>fn(e)):[fn(t)]}function fn(t){return rt(t)?gh(t):vh(t)}function gh(t){const e=" as ";if(t.includes(e)){const[r,u]=t.split(e).map(bh);return wr.create(ye(r),de.create(u))}else return ye(t)}function ye(t){const e=".";if(t.includes(e)){const[r,u]=t.split(e).map(bh);return fr.createWithSchema(r,u)}else return fr.create(t)}function bh(t){return t.trim()}const xh=a({is(t){return t.kind==="AddColumnNode"},create(t){return a({kind:"AddColumnNode",column:t})}}),le=a({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return a({kind:"ColumnDefinitionNode",column:Ne.create(t),dataType:e})},cloneWithFrontModifier(t,e){return a({...t,frontModifiers:t.frontModifiers?a([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return a({...t,endModifiers:t.endModifiers?a([...t.endModifiers,e]):[e]})},cloneWith(t,e){return a({...t,...e})}}),qh=a({is(t){return t.kind==="DropColumnNode"},create(t){return a({kind:"DropColumnNode",column:Ne.create(t)})}}),Oh=a({is(t){return t.kind==="RenameColumnNode"},create(t,e){return a({kind:"RenameColumnNode",column:Ne.create(t),renameTo:Ne.create(e)})}}),ma=a({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return a({kind:"CheckConstraintNode",expression:t,name:e?de.create(e):void 0})}}),rl=["no action","restrict","cascade","set null","set default"],ns=a({is(t){return t.kind==="ReferencesNode"},create(t,e){return a({kind:"ReferencesNode",table:t,columns:a([...e])})},cloneWithOnDelete(t,e){return a({...t,onDelete:e})},cloneWithOnUpdate(t,e){return a({...t,onUpdate:e})}});function Wh(t){return Ve(t)?t.toOperationNode():kt.createImmediate(t)}const rs=a({is(t){return t.kind==="GeneratedNode"},create(t){return a({kind:"GeneratedNode",...t})},createWithExpression(t){return a({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return a({...t,...e})}}),il=a({is(t){return t.kind==="DefaultValueNode"},create(t){return a({kind:"DefaultValueNode",defaultValue:t})}});function Os(t){if(rl.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var z;const be=class be{constructor(e){N(this,z,void 0);g(this,z,e)}autoIncrement(){return new be(le.cloneWith(n(this,z),{autoIncrement:!0}))}identity(){return new be(le.cloneWith(n(this,z),{identity:!0}))}primaryKey(){return new be(le.cloneWith(n(this,z),{primaryKey:!0}))}references(e){const r=jt(e);if(!r.table||na.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new be(le.cloneWith(n(this,z),{references:ns.create(r.table,[r.column])}))}onDelete(e){if(!n(this,z).references)throw new Error("on delete constraint can only be added for foreign keys");return new be(le.cloneWith(n(this,z),{references:ns.cloneWithOnDelete(n(this,z).references,Os(e))}))}onUpdate(e){if(!n(this,z).references)throw new Error("on update constraint can only be added for foreign keys");return new be(le.cloneWith(n(this,z),{references:ns.cloneWithOnUpdate(n(this,z).references,Os(e))}))}unique(){return new be(le.cloneWith(n(this,z),{unique:!0}))}notNull(){return new be(le.cloneWith(n(this,z),{notNull:!0}))}unsigned(){return new be(le.cloneWith(n(this,z),{unsigned:!0}))}defaultTo(e){return new be(le.cloneWith(n(this,z),{defaultTo:il.create(Wh(e))}))}check(e){return new be(le.cloneWith(n(this,z),{check:ma.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new be(le.cloneWith(n(this,z),{generated:rs.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new be(le.cloneWith(n(this,z),{generated:rs.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new be(le.cloneWith(n(this,z),{generated:rs.create({identity:!0,byDefault:!0})}))}stored(){if(!n(this,z).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new be(le.cloneWith(n(this,z),{generated:rs.cloneWith(n(this,z).generated,{stored:!0})}))}modifyFront(e){return new be(le.cloneWithFrontModifier(n(this,z),e.toOperationNode()))}nullsNotDistinct(){return new be(le.cloneWith(n(this,z),{nullsNotDistinct:!0}))}modifyEnd(e){return new be(le.cloneWithEndModifier(n(this,z),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return n(this,z)}};z=new WeakMap;let Nr=be;P(Nr,"don't await ColumnDefinitionBuilder instances directly.");const Ch=a({is(t){return t.kind==="ModifyColumnNode"},create(t){return a({kind:"ModifyColumnNode",column:t})}}),Ws=a({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,u){return a({kind:"ForeignKeyConstraintNode",columns:t,references:ns.create(e,r),name:u?de.create(u):void 0})},cloneWith(t,e){return a({...t,...e})}});var _r;const Xs=class Xs{constructor(e){N(this,_r,void 0);g(this,_r,e)}onDelete(e){return new Xs(Ws.cloneWith(n(this,_r),{onDelete:Os(e)}))}onUpdate(e){return new Xs(Ws.cloneWith(n(this,_r),{onUpdate:Os(e)}))}$call(e){return e(this)}toOperationNode(){return n(this,_r)}};_r=new WeakMap;let pn=Xs;P(pn,"don't await ForeignKeyConstraintBuilder instances directly.");const ss=a({is(t){return t.kind==="AddConstraintNode"},create(t){return a({kind:"AddConstraintNode",constraint:t})}}),ya=a({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,r){return a({kind:"UniqueConstraintNode",columns:a(t.map(Ne.create)),name:e?de.create(e):void 0,nullsNotDistinct:r})},cloneWith(t,e){return a({...t,...e})}}),os=a({is(t){return t.kind==="DropConstraintNode"},create(t){return a({kind:"DropConstraintNode",constraintName:de.create(t)})},cloneWith(t,e){return a({...t,...e})}}),Gi=a({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return a({kind:"AlterColumnNode",column:Ne.create(t),[e]:r})}});var Ft;class Na{constructor(e){N(this,Ft,void 0);g(this,Ft,e)}setDataType(e){return new zi(Gi.create(n(this,Ft),"dataType",Vr(e)))}setDefault(e){return new zi(Gi.create(n(this,Ft),"setDefault",Wh(e)))}dropDefault(){return new zi(Gi.create(n(this,Ft),"dropDefault",!0))}setNotNull(){return new zi(Gi.create(n(this,Ft),"setNotNull",!0))}dropNotNull(){return new zi(Gi.create(n(this,Ft),"dropNotNull",!0))}$call(e){return e(this)}}Ft=new WeakMap;var qn;class zi{constructor(e){N(this,qn,void 0);g(this,qn,e)}toOperationNode(){return n(this,qn)}}qn=new WeakMap;var pt;class Wr{constructor(e){N(this,pt,void 0);g(this,pt,a(e))}toOperationNode(){return n(this,pt).executor.transformQuery(n(this,pt).node,n(this,pt).queryId)}compile(){return n(this,pt).executor.compileQuery(this.toOperationNode(),n(this,pt).queryId)}async execute(){await n(this,pt).executor.executeQuery(this.compile(),n(this,pt).queryId)}}pt=new WeakMap;P(Wr,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var Le;const Zs=class Zs{constructor(e){N(this,Le,void 0);g(this,Le,a(e))}onDelete(e){return new Zs({...n(this,Le),constraintBuilder:n(this,Le).constraintBuilder.onDelete(e)})}onUpdate(e){return new Zs({...n(this,Le),constraintBuilder:n(this,Le).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return n(this,Le).executor.transformQuery(Y.cloneWithTableProps(n(this,Le).node,{addConstraint:ss.create(n(this,Le).constraintBuilder.toOperationNode())}),n(this,Le).queryId)}compile(){return n(this,Le).executor.compileQuery(this.toOperationNode(),n(this,Le).queryId)}async execute(){await n(this,Le).executor.executeQuery(this.compile(),n(this,Le).queryId)}};Le=new WeakMap;let Cs=Zs;P(Cs,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var xe;const nn=class nn{constructor(e){N(this,xe,void 0);g(this,xe,a(e))}ifExists(){return new nn({...n(this,xe),node:Y.cloneWithTableProps(n(this,xe).node,{dropConstraint:os.cloneWith(n(this,xe).node.dropConstraint,{ifExists:!0})})})}cascade(){return new nn({...n(this,xe),node:Y.cloneWithTableProps(n(this,xe).node,{dropConstraint:os.cloneWith(n(this,xe).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new nn({...n(this,xe),node:Y.cloneWithTableProps(n(this,xe).node,{dropConstraint:os.cloneWith(n(this,xe).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return n(this,xe).executor.transformQuery(n(this,xe).node,n(this,xe).queryId)}compile(){return n(this,xe).executor.compileQuery(this.toOperationNode(),n(this,xe).queryId)}async execute(){await n(this,xe).executor.executeQuery(this.compile(),n(this,xe).queryId)}};xe=new WeakMap;let ks=nn;P(ks,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const kh=a({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return a({kind:"PrimaryKeyConstraintNode",columns:a(t.map(Ne.create)),name:e?de.create(e):void 0})}}),ti=a({is(t){return t.kind==="AddIndexNode"},create(t){return a({kind:"AddIndexNode",name:de.create(t)})},cloneWith(t,e){return a({...t,...e})},cloneWithColumns(t,e){return a({...t,columns:[...t.columns||[],...e]})}});var ie;const Ir=class Ir{constructor(e){N(this,ie,void 0);g(this,ie,a(e))}unique(){return new Ir({...n(this,ie),node:Y.cloneWithTableProps(n(this,ie).node,{addIndex:ti.cloneWith(n(this,ie).node.addIndex,{unique:!0})})})}column(e){return new Ir({...n(this,ie),node:Y.cloneWithTableProps(n(this,ie).node,{addIndex:ti.cloneWithColumns(n(this,ie).node.addIndex,[cs(e)])})})}columns(e){return new Ir({...n(this,ie),node:Y.cloneWithTableProps(n(this,ie).node,{addIndex:ti.cloneWithColumns(n(this,ie).node.addIndex,e.map(cs))})})}expression(e){return new Ir({...n(this,ie),node:Y.cloneWithTableProps(n(this,ie).node,{addIndex:ti.cloneWithColumns(n(this,ie).node.addIndex,[e.toOperationNode()])})})}using(e){return new Ir({...n(this,ie),node:Y.cloneWithTableProps(n(this,ie).node,{addIndex:ti.cloneWith(n(this,ie).node.addIndex,{using:Ae.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return n(this,ie).executor.transformQuery(n(this,ie).node,n(this,ie).queryId)}compile(){return n(this,ie).executor.compileQuery(this.toOperationNode(),n(this,ie).queryId)}async execute(){await n(this,ie).executor.executeQuery(this.compile(),n(this,ie).queryId)}};ie=new WeakMap;let Is=Ir;P(Is,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var qi;const va=class va{constructor(e){N(this,qi,void 0);g(this,qi,e)}toOperationNode(){return n(this,qi)}nullsNotDistinct(){return new va(ya.cloneWith(n(this,qi),{nullsNotDistinct:!0}))}};qi=new WeakMap;let mn=va;P(mn,"don't await UniqueConstraintNodeBuilder instances directly.");var V;class Ih{constructor(e){N(this,V,void 0);g(this,V,a(e))}renameTo(e){return new Wr({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{renameTo:ye(e)})})}setSchema(e){return new Wr({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{setSchema:de.create(e)})})}alterColumn(e,r){const u=r(new Na(e));return new tr({...n(this,V),node:Y.cloneWithColumnAlteration(n(this,V).node,u.toOperationNode())})}dropColumn(e){return new tr({...n(this,V),node:Y.cloneWithColumnAlteration(n(this,V).node,qh.create(e))})}renameColumn(e,r){return new tr({...n(this,V),node:Y.cloneWithColumnAlteration(n(this,V).node,Oh.create(e,r))})}addColumn(e,r,u=lr){const d=u(new Nr(le.create(e,Vr(r))));return new tr({...n(this,V),node:Y.cloneWithColumnAlteration(n(this,V).node,xh.create(d.toOperationNode()))})}modifyColumn(e,r,u=lr){const d=u(new Nr(le.create(e,Vr(r))));return new tr({...n(this,V),node:Y.cloneWithColumnAlteration(n(this,V).node,Ch.create(d.toOperationNode()))})}addUniqueConstraint(e,r,u=lr){const d=u(new mn(ya.create(r,e)));return new Wr({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{addConstraint:ss.create(d.toOperationNode())})})}addCheckConstraint(e,r){return new Wr({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{addConstraint:ss.create(ma.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,u,d){return new Cs({...n(this,V),constraintBuilder:new pn(Ws.create(r.map(Ne.create),ye(u),d.map(Ne.create),e))})}addPrimaryKeyConstraint(e,r){return new Wr({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{addConstraint:ss.create(kh.create(r,e))})})}dropConstraint(e){return new ks({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{dropConstraint:os.create(e)})})}addIndex(e){return new Is({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{addIndex:ti.create(e)})})}dropIndex(e){return new Wr({...n(this,V),node:Y.cloneWithTableProps(n(this,V).node,{dropIndex:Ki.create(e)})})}$call(e){return e(this)}}V=new WeakMap;var me;const Tr=class Tr{constructor(e){N(this,me,void 0);g(this,me,a(e))}alterColumn(e,r){const u=r(new Na(e));return new Tr({...n(this,me),node:Y.cloneWithColumnAlteration(n(this,me).node,u.toOperationNode())})}dropColumn(e){return new Tr({...n(this,me),node:Y.cloneWithColumnAlteration(n(this,me).node,qh.create(e))})}renameColumn(e,r){return new Tr({...n(this,me),node:Y.cloneWithColumnAlteration(n(this,me).node,Oh.create(e,r))})}addColumn(e,r,u=lr){const d=u(new Nr(le.create(e,Vr(r))));return new Tr({...n(this,me),node:Y.cloneWithColumnAlteration(n(this,me).node,xh.create(d.toOperationNode()))})}modifyColumn(e,r,u=lr){const d=u(new Nr(le.create(e,Vr(r))));return new Tr({...n(this,me),node:Y.cloneWithColumnAlteration(n(this,me).node,Ch.create(d.toOperationNode()))})}toOperationNode(){return n(this,me).executor.transformQuery(n(this,me).node,n(this,me).queryId)}compile(){return n(this,me).executor.compileQuery(this.toOperationNode(),n(this,me).queryId)}async execute(){await n(this,me).executor.executeQuery(this.compile(),n(this,me).queryId)}};me=new WeakMap;let tr=Tr;P(Ih,"don't await AlterTableBuilder instances");P(Na,"don't await AlterColumnBuilder instances");P(tr,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Th extends la{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var K;const dt=class dt{constructor(e){N(this,K,void 0);g(this,K,a(e))}ifNotExists(){return new dt({...n(this,K),node:Lt.cloneWith(n(this,K).node,{ifNotExists:!0})})}unique(){return new dt({...n(this,K),node:Lt.cloneWith(n(this,K).node,{unique:!0})})}nullsNotDistinct(){return new dt({...n(this,K),node:Lt.cloneWith(n(this,K).node,{nullsNotDistinct:!0})})}on(e){return new dt({...n(this,K),node:Lt.cloneWith(n(this,K).node,{table:ye(e)})})}column(e){return new dt({...n(this,K),node:Lt.cloneWithColumns(n(this,K).node,[cs(e)])})}columns(e){return new dt({...n(this,K),node:Lt.cloneWithColumns(n(this,K).node,e.map(cs))})}expression(e){return new dt({...n(this,K),node:Lt.cloneWithColumns(n(this,K).node,[e.toOperationNode()])})}using(e){return new dt({...n(this,K),node:Lt.cloneWith(n(this,K).node,{using:Ae.createWithSql(e)})})}where(...e){const r=new Th;return new dt({...n(this,K),node:S.cloneWithWhere(n(this,K).node,r.transformNode(De(e)))})}$call(e){return e(this)}toOperationNode(){return n(this,K).executor.transformQuery(n(this,K).node,n(this,K).queryId)}compile(){return n(this,K).executor.compileQuery(this.toOperationNode(),n(this,K).queryId)}async execute(){await n(this,K).executor.executeQuery(this.compile(),n(this,K).queryId)}};K=new WeakMap;let Ts=dt;P(Ts,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var He;const ga=class ga{constructor(e){N(this,He,void 0);g(this,He,a(e))}ifNotExists(){return new ga({...n(this,He),node:zu.cloneWith(n(this,He).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,He).executor.transformQuery(n(this,He).node,n(this,He).queryId)}compile(){return n(this,He).executor.compileQuery(this.toOperationNode(),n(this,He).queryId)}async execute(){await n(this,He).executor.executeQuery(this.compile(),n(this,He).queryId)}};He=new WeakMap;let Es=ga;P(Es,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function nl(t){if(Jd.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var $;const Ke=class Ke{constructor(e){N(this,$,void 0);g(this,$,a(e))}temporary(){return new Ke({...n(this,$),node:ze.cloneWith(n(this,$).node,{temporary:!0})})}onCommit(e){return new Ke({...n(this,$),node:ze.cloneWith(n(this,$).node,{onCommit:nl(e)})})}ifNotExists(){return new Ke({...n(this,$),node:ze.cloneWith(n(this,$).node,{ifNotExists:!0})})}addColumn(e,r,u=lr){const d=u(new Nr(le.create(e,Vr(r))));return new Ke({...n(this,$),node:ze.cloneWithColumn(n(this,$).node,d.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Ke({...n(this,$),node:ze.cloneWithConstraint(n(this,$).node,kh.create(r,e))})}addUniqueConstraint(e,r,u=lr){const d=u(new mn(ya.create(r,e)));return new Ke({...n(this,$),node:ze.cloneWithConstraint(n(this,$).node,d.toOperationNode())})}addCheckConstraint(e,r){return new Ke({...n(this,$),node:ze.cloneWithConstraint(n(this,$).node,ma.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,u,d,m=lr){const x=m(new pn(Ws.create(r.map(Ne.create),ye(u),d.map(Ne.create),e)));return new Ke({...n(this,$),node:ze.cloneWithConstraint(n(this,$).node,x.toOperationNode())})}modifyFront(e){return new Ke({...n(this,$),node:ze.cloneWithFrontModifier(n(this,$).node,e.toOperationNode())})}modifyEnd(e){return new Ke({...n(this,$),node:ze.cloneWithEndModifier(n(this,$).node,e.toOperationNode())})}as(e){return new Ke({...n(this,$),node:ze.cloneWith(n(this,$).node,{selectQuery:jr(e)})})}$call(e){return e(this)}toOperationNode(){return n(this,$).executor.transformQuery(n(this,$).node,n(this,$).queryId)}compile(){return n(this,$).executor.compileQuery(this.toOperationNode(),n(this,$).queryId)}async execute(){await n(this,$).executor.executeQuery(this.compile(),n(this,$).queryId)}};$=new WeakMap;let Ss=Ke;P(Ss,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var Te;const sn=class sn{constructor(e){N(this,Te,void 0);g(this,Te,a(e))}on(e){return new sn({...n(this,Te),node:Ki.cloneWith(n(this,Te).node,{table:ye(e)})})}ifExists(){return new sn({...n(this,Te),node:Ki.cloneWith(n(this,Te).node,{ifExists:!0})})}cascade(){return new sn({...n(this,Te),node:Ki.cloneWith(n(this,Te).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Te).executor.transformQuery(n(this,Te).node,n(this,Te).queryId)}compile(){return n(this,Te).executor.compileQuery(this.toOperationNode(),n(this,Te).queryId)}async execute(){await n(this,Te).executor.executeQuery(this.compile(),n(this,Te).queryId)}};Te=new WeakMap;let As=sn;P(As,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var Be;const eo=class eo{constructor(e){N(this,Be,void 0);g(this,Be,a(e))}ifExists(){return new eo({...n(this,Be),node:Po.cloneWith(n(this,Be).node,{ifExists:!0})})}cascade(){return new eo({...n(this,Be),node:Po.cloneWith(n(this,Be).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Be).executor.transformQuery(n(this,Be).node,n(this,Be).queryId)}compile(){return n(this,Be).executor.compileQuery(this.toOperationNode(),n(this,Be).queryId)}async execute(){await n(this,Be).executor.executeQuery(this.compile(),n(this,Be).queryId)}};Be=new WeakMap;let Ds=eo;P(Ds,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var _e;const to=class to{constructor(e){N(this,_e,void 0);g(this,_e,a(e))}ifExists(){return new to({...n(this,_e),node:Bo.cloneWith(n(this,_e).node,{ifExists:!0})})}cascade(){return new to({...n(this,_e),node:Bo.cloneWith(n(this,_e).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,_e).executor.transformQuery(n(this,_e).node,n(this,_e).queryId)}compile(){return n(this,_e).executor.compileQuery(this.toOperationNode(),n(this,_e).queryId)}async execute(){await n(this,_e).executor.executeQuery(this.compile(),n(this,_e).queryId)}};_e=new WeakMap;let Rs=to;P(Rs,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const Xt=a({is(t){return t.kind==="CreateViewNode"},create(t){return a({kind:"CreateViewNode",name:pr.create(t)})},cloneWith(t,e){return a({...t,...e})}});var ro;class sl{constructor(){N(this,ro,new Th)}transformQuery(e){return n(this,ro).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}ro=new WeakMap;var ce;const er=class er{constructor(e){N(this,ce,void 0);g(this,ce,a(e))}temporary(){return new er({...n(this,ce),node:Xt.cloneWith(n(this,ce).node,{temporary:!0})})}materialized(){return new er({...n(this,ce),node:Xt.cloneWith(n(this,ce).node,{materialized:!0})})}ifNotExists(){return new er({...n(this,ce),node:Xt.cloneWith(n(this,ce).node,{ifNotExists:!0})})}orReplace(){return new er({...n(this,ce),node:Xt.cloneWith(n(this,ce).node,{orReplace:!0})})}columns(e){return new er({...n(this,ce),node:Xt.cloneWith(n(this,ce).node,{columns:e.map(th)})})}as(e){const r=e.withPlugin(new sl).toOperationNode();return new er({...n(this,ce),node:Xt.cloneWith(n(this,ce).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return n(this,ce).executor.transformQuery(n(this,ce).node,n(this,ce).queryId)}compile(){return n(this,ce).executor.compileQuery(this.toOperationNode(),n(this,ce).queryId)}async execute(){await n(this,ce).executor.executeQuery(this.compile(),n(this,ce).queryId)}};ce=new WeakMap;let Ls=er;P(Ls,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const as=a({is(t){return t.kind==="DropViewNode"},create(t){return a({kind:"DropViewNode",name:pr.create(t)})},cloneWith(t,e){return a({...t,...e})}});var Ee;const on=class on{constructor(e){N(this,Ee,void 0);g(this,Ee,a(e))}materialized(){return new on({...n(this,Ee),node:as.cloneWith(n(this,Ee).node,{materialized:!0})})}ifExists(){return new on({...n(this,Ee),node:as.cloneWith(n(this,Ee).node,{ifExists:!0})})}cascade(){return new on({...n(this,Ee),node:as.cloneWith(n(this,Ee).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Ee).executor.transformQuery(n(this,Ee).node,n(this,Ee).queryId)}compile(){return n(this,Ee).executor.compileQuery(this.toOperationNode(),n(this,Ee).queryId)}async execute(){await n(this,Ee).executor.executeQuery(this.compile(),n(this,Ee).queryId)}};Ee=new WeakMap;let Ms=on;P(Ms,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Eh=a({is(t){return t.kind==="CreateTypeNode"},create(t){return a({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return a({...t,enum:oa.create(e.map(r=>kt.createImmediate(r)))})}});var Ye;const ba=class ba{constructor(e){N(this,Ye,void 0);g(this,Ye,a(e))}toOperationNode(){return n(this,Ye).executor.transformQuery(n(this,Ye).node,n(this,Ye).queryId)}asEnum(e){return new ba({...n(this,Ye),node:Eh.cloneWithEnum(n(this,Ye).node,e)})}$call(e){return e(this)}compile(){return n(this,Ye).executor.compileQuery(this.toOperationNode(),n(this,Ye).queryId)}async execute(){await n(this,Ye).executor.executeQuery(this.compile(),n(this,Ye).queryId)}};Ye=new WeakMap;let Ps=ba;P(Ps,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Sh=a({is(t){return t.kind==="DropTypeNode"},create(t){return a({kind:"DropTypeNode",name:t})},cloneWith(t,e){return a({...t,...e})}});var Xe;const xa=class xa{constructor(e){N(this,Xe,void 0);g(this,Xe,a(e))}ifExists(){return new xa({...n(this,Xe),node:Sh.cloneWith(n(this,Xe).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return n(this,Xe).executor.transformQuery(n(this,Xe).node,n(this,Xe).queryId)}compile(){return n(this,Xe).executor.compileQuery(this.toOperationNode(),n(this,Xe).queryId)}async execute(){await n(this,Xe).executor.executeQuery(this.compile(),n(this,Xe).queryId)}};Xe=new WeakMap;let Bs=xa;P(Bs,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function Fu(t){const e=".";if(t.includes(e)){const r=t.split(e).map(ol);if(r.length===2)return pr.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return pr.create(t)}function ol(t){return t.trim()}var Ie;const an=class an{constructor(e){N(this,Ie,void 0);g(this,Ie,e)}createTable(e){return new Ss({queryId:X(),executor:n(this,Ie),node:ze.create(ye(e))})}dropTable(e){return new Rs({queryId:X(),executor:n(this,Ie),node:Bo.create(ye(e))})}createIndex(e){return new Ts({queryId:X(),executor:n(this,Ie),node:Lt.create(e)})}dropIndex(e){return new As({queryId:X(),executor:n(this,Ie),node:Ki.create(e)})}createSchema(e){return new Es({queryId:X(),executor:n(this,Ie),node:zu.create(e)})}dropSchema(e){return new Ds({queryId:X(),executor:n(this,Ie),node:Po.create(e)})}alterTable(e){return new Ih({queryId:X(),executor:n(this,Ie),node:Y.create(ye(e))})}createView(e){return new Ls({queryId:X(),executor:n(this,Ie),node:Xt.create(e)})}dropView(e){return new Ms({queryId:X(),executor:n(this,Ie),node:as.create(e)})}createType(e){return new Ps({queryId:X(),executor:n(this,Ie),node:Eh.create(Fu(e))})}dropType(e){return new Bs({queryId:X(),executor:n(this,Ie),node:Sh.create(Fu(e))})}withPlugin(e){return new an(n(this,Ie).withPlugin(e))}withoutPlugins(){return new an(n(this,Ie).withoutPlugins())}withSchema(e){return new an(n(this,Ie).withPluginAtFront(new Rn(e)))}};Ie=new WeakMap;let Ko=an;class al{ref(e){return new Zd(e)}}var Oi;class ul{constructor(e){N(this,Oi,void 0);g(this,Oi,e)}async provideConnection(e){const r=await n(this,Oi).acquireConnection();try{return await e(r)}finally{await n(this,Oi).releaseConnection(r)}}}Oi=new WeakMap;var qt,Ot,Qt;const Er=class Er extends lh{constructor(r,u,d,m=[]){super(m);N(this,qt,void 0);N(this,Ot,void 0);N(this,Qt,void 0);g(this,qt,r),g(this,Ot,u),g(this,Qt,d)}get adapter(){return n(this,Ot)}compileQuery(r){return n(this,qt).compileQuery(r)}provideConnection(r){return n(this,Qt).provideConnection(r)}withPlugins(r){return new Er(n(this,qt),n(this,Ot),n(this,Qt),[...this.plugins,...r])}withPlugin(r){return new Er(n(this,qt),n(this,Ot),n(this,Qt),[...this.plugins,r])}withPluginAtFront(r){return new Er(n(this,qt),n(this,Ot),n(this,Qt),[r,...this.plugins])}withConnectionProvider(r){return new Er(n(this,qt),n(this,Ot),r,[...this.plugins])}withoutPlugins(){return new Er(n(this,qt),n(this,Ot),n(this,Qt),[])}};qt=new WeakMap,Ot=new WeakMap,Qt=new WeakMap;let Ho=Er;function Qu(){return typeof performance<"u"&&it(performance.now)?performance.now():Date.now()}var mt,ar,Ut,Wi,$t,On,io,Ah,no,Dh,so,Rh,oo,Lh,Wn,Yo;class hl{constructor(e,r){N(this,io);N(this,no);N(this,so);N(this,oo);N(this,Wn);N(this,mt,void 0);N(this,ar,void 0);N(this,Ut,void 0);N(this,Wi,void 0);N(this,$t,void 0);N(this,On,new WeakSet);g(this,Wi,!1),g(this,mt,e),g(this,ar,r)}async init(){if(n(this,$t))throw new Error("driver has already been destroyed");n(this,Ut)||g(this,Ut,n(this,mt).init().then(()=>{g(this,Wi,!0)}).catch(e=>(g(this,Ut,void 0),Promise.reject(e)))),await n(this,Ut)}async acquireConnection(){if(n(this,$t))throw new Error("driver has already been destroyed");n(this,Wi)||await this.init();const e=await n(this,mt).acquireConnection();return n(this,On).has(e)||(M(this,io,Ah).call(this)&&M(this,no,Dh).call(this,e),n(this,On).add(e)),e}async releaseConnection(e){await n(this,mt).releaseConnection(e)}beginTransaction(e,r){return n(this,mt).beginTransaction(e,r)}commitTransaction(e){return n(this,mt).commitTransaction(e)}rollbackTransaction(e){return n(this,mt).rollbackTransaction(e)}async destroy(){n(this,Ut)&&(await n(this,Ut),n(this,$t)||g(this,$t,n(this,mt).destroy().catch(e=>(g(this,$t,void 0),Promise.reject(e)))),await n(this,$t))}}mt=new WeakMap,ar=new WeakMap,Ut=new WeakMap,Wi=new WeakMap,$t=new WeakMap,On=new WeakMap,io=new WeakSet,Ah=function(){return n(this,ar).isLevelEnabled("query")||n(this,ar).isLevelEnabled("error")},no=new WeakSet,Dh=function(e){const r=e.executeQuery;e.executeQuery=async u=>{let d;const m=Qu();try{return await r.call(e,u)}catch(x){throw d=x,await M(this,so,Rh).call(this,x,u,m),x}finally{d||await M(this,oo,Lh).call(this,u,m)}}},so=new WeakSet,Rh=async function(e,r,u){await n(this,ar).error(()=>({level:"error",error:e,query:r,queryDurationMillis:M(this,Wn,Yo).call(this,u)}))},oo=new WeakSet,Lh=async function(e,r){await n(this,ar).query(()=>({level:"query",query:e,queryDurationMillis:M(this,Wn,Yo).call(this,r)}))},Wn=new WeakSet,Yo=function(e){return Qu()-e};const dl=()=>{};var Cn,ur,ao,Ph;class Mh{constructor(e){N(this,ao);N(this,Cn,void 0);N(this,ur,void 0);g(this,Cn,e)}async provideConnection(e){for(;n(this,ur);)await n(this,ur).catch(dl);return g(this,ur,M(this,ao,Ph).call(this,e).finally(()=>{g(this,ur,void 0)})),n(this,ur)}}Cn=new WeakMap,ur=new WeakMap,ao=new WeakSet,Ph=async function(e){return await e(n(this,Cn))};const cl=["read uncommitted","read committed","repeatable read","serializable","snapshot"];a(["query","error"]);var hr,Fr;class ll{constructor(e){N(this,hr,void 0);N(this,Fr,void 0);it(e)?(g(this,Fr,e),g(this,hr,a({query:!0,error:!0}))):(g(this,Fr,fl),g(this,hr,a({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return n(this,hr)[e]}async query(e){n(this,hr).query&&await n(this,Fr).call(this,e())}async error(e){n(this,hr).error&&await n(this,Fr).call(this,e())}}hr=new WeakMap,Fr=new WeakMap;function fl(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function pl(t){return Wt(t)&&it(t.compile)}var Se;const ni=class ni extends xs{constructor(r){let u,d;if(ml(r))u={executor:r.executor},d={...r};else{const m=r.dialect,x=m.createDriver(),E=m.createQueryCompiler(),H=m.createAdapter(),l=new ll(r.log??[]),pe=new hl(x,l),Z=new ul(pe),Re=new Ho(E,H,Z,r.plugins??[]);u={executor:Re},d={config:r,executor:Re,dialect:m,driver:pe}}super(u);N(this,Se,void 0);g(this,Se,a(d))}get schema(){return new Ko(n(this,Se).executor)}get dynamic(){return new al}get introspection(){return n(this,Se).dialect.createIntrospector(this.withoutPlugins())}case(r){return new Nh({node:Ct.create(cr(r)?void 0:jr(r))})}get fn(){return yh()}transaction(){return new _s({...n(this,Se)})}connection(){return new Bh({...n(this,Se)})}withPlugin(r){return new ni({...n(this,Se),executor:n(this,Se).executor.withPlugin(r)})}withoutPlugins(){return new ni({...n(this,Se),executor:n(this,Se).executor.withoutPlugins()})}withSchema(r){return new ni({...n(this,Se),executor:n(this,Se).executor.withPluginAtFront(new Rn(r))})}withTables(){return new ni({...n(this,Se)})}async destroy(){await n(this,Se).driver.destroy()}get isTransaction(){return!1}getExecutor(){return n(this,Se).executor}executeQuery(r,u=X()){const d=pl(r)?r.compile():r;return this.getExecutor().executeQuery(d,u)}};Se=new WeakMap;let yn=ni;var yt;const si=class si extends yn{constructor(r){super(r);N(this,yt,void 0);g(this,yt,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new si({...n(this,yt),executor:n(this,yt).executor.withPlugin(r)})}withoutPlugins(){return new si({...n(this,yt),executor:n(this,yt).executor.withoutPlugins()})}withSchema(r){return new si({...n(this,yt),executor:n(this,yt).executor.withPluginAtFront(new Rn(r))})}withTables(){return new si({...n(this,yt)})}};yt=new WeakMap;let Xo=si;function ml(t){return Wt(t)&&Wt(t.config)&&Wt(t.driver)&&Wt(t.executor)&&Wt(t.dialect)}var Qr;class Bh{constructor(e){N(this,Qr,void 0);g(this,Qr,a(e))}async execute(e){return n(this,Qr).executor.provideConnection(async r=>{const u=n(this,Qr).executor.withConnectionProvider(new Mh(r)),d=new yn({...n(this,Qr),executor:u});return await e(d)})}}Qr=new WeakMap;P(Bh,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Nt;const qa=class qa{constructor(e){N(this,Nt,void 0);g(this,Nt,a(e))}setIsolationLevel(e){return new qa({...n(this,Nt),isolationLevel:e})}async execute(e){const{isolationLevel:r,...u}=n(this,Nt),d={isolationLevel:r};return yl(d),n(this,Nt).executor.provideConnection(async m=>{const x=n(this,Nt).executor.withConnectionProvider(new Mh(m)),E=new Xo({...u,executor:x});try{await n(this,Nt).driver.beginTransaction(m,d);const H=await e(E);return await n(this,Nt).driver.commitTransaction(m),H}catch(H){throw await n(this,Nt).driver.rollbackTransaction(m),H}})}};Nt=new WeakMap;let _s=qa;P(_s,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function yl(t){if(t.isolationLevel&&!cl.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var Fe,Ci,us,kn,Zo,In,ea;const un=class un{constructor(e){N(this,Ci);N(this,kn);N(this,In);N(this,Fe,void 0);g(this,Fe,a(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new _h(this,e)}$castTo(){return new un({...n(this,Fe)})}$notNull(){return new un(n(this,Fe))}withPlugin(e){return new un({...n(this,Fe),plugins:n(this,Fe).plugins!==void 0?a([...n(this,Fe).plugins,e]):a([e])})}toOperationNode(){return M(this,kn,Zo).call(this,M(this,Ci,us).call(this))}compile(e){return M(this,In,ea).call(this,M(this,Ci,us).call(this,e))}async execute(e){const r=M(this,Ci,us).call(this,e);return r.executeQuery(M(this,In,ea).call(this,r),n(this,Fe).queryId)}};Fe=new WeakMap,Ci=new WeakSet,us=function(e){const r=e!==void 0?e.getExecutor():po;return n(this,Fe).plugins!==void 0?r.withPlugins(n(this,Fe).plugins):r},kn=new WeakSet,Zo=function(e){return e.transformQuery(n(this,Fe).rawNode,n(this,Fe).queryId)},In=new WeakSet,ea=function(e){return e.compileQuery(M(this,kn,Zo).call(this,e),n(this,Fe).queryId)};let Fs=un;function Yt(t){return new Fs(t)}P(Fs,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var Ur,dr;class _h{constructor(e,r){N(this,Ur,void 0);N(this,dr,void 0);g(this,Ur,e),g(this,dr,r)}get expression(){return n(this,Ur)}get alias(){return n(this,dr)}get rawBuilder(){return n(this,Ur)}toOperationNode(){return wr.create(n(this,Ur).toOperationNode(),Ve(n(this,dr))?n(this,dr).toOperationNode():de.create(n(this,dr)))}}Ur=new WeakMap,dr=new WeakMap;P(_h,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const Ce=Object.assign((t,...e)=>Yt({queryId:X(),rawNode:Ae.create(t,e?.map(Uu)??[])}),{ref(t){return Yt({queryId:X(),rawNode:Ae.createWithChild(jt(t))})},val(t){return Yt({queryId:X(),rawNode:Ae.createWithChild(qe(t))})},value(t){return this.val(t)},table(t){return Yt({queryId:X(),rawNode:Ae.createWithChild(ye(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",Yt({queryId:X(),rawNode:Ae.create(e,t.map(de.create))})},lit(t){return Yt({queryId:X(),rawNode:Ae.createWithChild(kt.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return Yt({queryId:X(),rawNode:Ae.createWithSql(t)})},join(t,e=Ce`, `){const r=new Array(2*t.length-1),u=e.toOperationNode();for(let d=0;d<t.length;++d)r[2*d]=Uu(t[d]),d!==t.length-1&&(r[2*d+1]=u);return Yt({queryId:X(),rawNode:Ae.createWithChildren(r)})}});function Uu(t){return Ve(t)?t.toOperationNode():qe(t)}var uo;class Nl{constructor(){F(this,"nodeStack",[]);N(this,uo,a({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this)}));F(this,"visitNode",e=>{this.nodeStack.push(e),n(this,uo)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}uo=new WeakMap;var ki,$r;class wl extends Nl{constructor(){super(...arguments);N(this,ki,"");N(this,$r,[])}get numParameters(){return n(this,$r).length}compileQuery(r){return g(this,ki,""),g(this,$r,[]),this.visitNode(r),a({query:r,sql:this.getSql(),parameters:[...n(this,$r)]})}getSql(){return n(this,ki)}visitSelectQuery(r){const u=this.parentNode!==void 0&&!Ei.is(this.parentNode)&&!et.is(this.parentNode)&&!ze.is(this.parentNode)&&!Xt.is(this.parentNode)&&!ph.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),r.frontModifiers?.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.top&&(this.append(" "),this.visitNode(r.top)),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),r.fetch&&(this.append(" "),this.visitNode(r.fetch)),r.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),u&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,u=", "){const d=r.length-1;for(let m=0;m<=d;m++)this.visitNode(r[m]),m<d&&this.append(u)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const u=this.nodeStack.find(S.is),d=u!==r;!d&&r.explain&&(this.visitNode(r.explain),this.append(" ")),d&&!Je.is(u)&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),r.top&&(this.append(" "),this.visitNode(r.top)),r.into&&(this.append(" into "),this.visitNode(r.into)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.defaultValues&&(this.append(" "),this.append("default values")),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),d&&!Je.is(u)&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const u=this.nodeStack.find(S.is)!==r;!u&&r.explain&&(this.visitNode(r.explain),this.append(" ")),u&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),r.top&&(this.visitNode(r.top),this.append(" ")),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),u&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!rt(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:u}=r;for(let d=0;d<u.length;++d)this.appendValue(u[d]),d!==u.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(gl[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:u,parameters:d}=r;for(let m=0;m<u.length;++m)this.append(u[m]),d.length>m&&this.visitNode(d[m])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),r.selectQuery?(this.append(" as "),this.visitNode(r.selectQuery)):(this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," ")))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.identity&&this.append(" identity"),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.nullsNotDistinct&&this.append(" nulls not distinct"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const u=this.nodeStack.find(S.is),d=u!==r;!d&&r.explain&&(this.visitNode(r.explain),this.append(" ")),d&&!Je.is(u)&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),r.top&&(this.visitNode(r.top),this.append(" ")),r.table&&(this.visitNode(r.table),this.append(" ")),this.append("set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),d&&!Je.is(u)&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.nullsNotDistinct&&this.append(" nulls not distinct"),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique"),r.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),hs(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileColumnAlterations(r.columnAlterations),r.addIndex&&this.visitNode(r.addIndex),r.dropIndex&&this.visitNode(r.dropIndex)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(vl[r.modifier]),r.of&&(this.append(" of "),this.compileList(r.of,", "))}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return yr.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const u of r.pathLegs)this.visitNode(u);this.append("'")}visitJSONPathLeg(r){const u=r.type==="ArrayLocation";this.append(u?"[":"."),this.append(String(r.value)),u&&this.append("]")}visitJSONOperatorChain(r){for(let u=0,d=r.values.length;u<d;u++)u===d-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[u])}visitMergeQuery(r){r.with&&(this.visitNode(r.with),this.append(" ")),this.append("merge "),r.top&&(this.visitNode(r.top),this.append(" ")),this.append("into "),this.visitNode(r.into),r.using&&(this.append(" "),this.visitNode(r.using)),r.whens&&(this.append(" "),this.compileList(r.whens))}visitMatched(r){r.not&&this.append("not "),this.append("matched"),r.bySource&&this.append(" by source")}visitAddIndex(r){this.append("add "),r.unique&&this.append("unique "),this.append("index "),this.visitNode(r.name),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.using&&(this.append(" using "),this.visitNode(r.using))}visitCast(r){this.append("cast("),this.visitNode(r.expression),this.append(" as "),this.visitNode(r.dataType),this.append(")")}visitFetch(r){this.append("fetch next "),this.visitNode(r.rowCount),this.append(` rows ${r.modifier}`)}visitTop(r){this.append(`top(${r.expression})`),r.modifiers&&this.append(` ${r.modifiers}`)}append(r){g(this,ki,n(this,ki)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const u=this.getLeftIdentifierWrapper(),d=this.getRightIdentifierWrapper();let m="";for(const x of r)m+=x,x===u?m+=u:x===d&&(m+=d);return m}addParameter(r){n(this,$r).push(r)}appendImmediateValue(r){if(rt(r))this.append(`'${r}'`);else if(co(r)||hs(r))this.append(r.toString());else if(ra(r))this.append("null");else if($d(r))this.appendImmediateValue(r.toISOString());else if(ia(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((u,d)=>u.modifier&&d.modifier?$u[u.modifier]-$u[d.modifier]:1),a(r)}compileColumnAlterations(r){this.compileList(r)}announcesNewColumnDataType(){return!0}}ki=new WeakMap,$r=new WeakMap;const vl=a({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),$u=a({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),gl=a({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",Using:"using"}),Jr=a({raw(t,e=[]){return a({sql:t,query:Ae.createWithSql(t),parameters:a(e)})}});class bl{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}}const xl=/"/g;class ql extends wl{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(xl,'""')}visitDefaultInsertValue(e){this.append("null")}}const Fh="kysely_migration",Qh="kysely_migration_lock";a({__noMigrations__:!0});var Ii,ho,Uh;class Ol{constructor(e){N(this,ho);N(this,Ii,void 0);g(this,Ii,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=n(this,Ii).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",Fh).where("name","!=",Qh));const u=await r.execute();return Promise.all(u.map(({name:d})=>M(this,ho,Uh).call(this,d)))}async getMetadata(e){return{tables:await this.getTables(e)}}}Ii=new WeakMap,ho=new WeakSet,Uh=async function(e){const r=n(this,Ii),u=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),d=u.sql?.split(/[\(\),]/)?.find(x=>x.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),m=await r.selectFrom(Ce`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:u.type==="view",columns:m.map(x=>({name:x.name,dataType:x.type,isNullable:!x.notnull,isAutoIncrementing:x.name===d,hasDefaultValue:x.dflt_value!=null,comment:void 0}))}};class Wl extends bl{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var Cl=class{createQueryCompiler(){return new ql}createAdapter(){return new Wl}createIntrospector(t){return new Ol(t)}},Tn,Gu,kl=(Gu=class{constructor(){N(this,Tn,new Il);F(this,"connection")}async acquireConnection(){return await n(this,Tn).lock(),this.connection}async beginTransaction(t){await t.executeQuery(Jr.raw("begin"))}async commitTransaction(t){await t.executeQuery(Jr.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(Jr.raw("rollback"))}async releaseConnection(){n(this,Tn).unlock()}},Tn=new WeakMap,Gu),Il=class{constructor(){F(this,"promise");F(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t?.()}},Tl=class{streamQuery(){throw new Error("sqlite-wasm driver doesn't support streaming")}async executeQuery({parameters:t,query:e,sql:r}){const u=await this.query(r,t);return Q.is(e)||u.length?{rows:u}:{rows:u,...await this.info()}}};function El(t,e,r){let u,d=0,m=null;function x(){u&&clearTimeout(u),d=0,m=null}function E(){d>=r?(t(m),x()):(u&&clearTimeout(u),u=setTimeout(()=>{t(m),x(),u=void 0},e))}return H=>{d++,m=H,u===void 0&&d===0?(t(H),d++):E()}}var Sl=class extends kl{constructor(e){super();F(this,"config");F(this,"db");this.config=e}async init(){if(this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,!this.db)throw new Error("no database");this.connection=new Al(this.db,this.config.onWrite?.func,this.config.onWrite?.isThrottle,this.config.onWrite?.delay,this.config.onWrite?.maxCalls),await this.config.onCreateConnection?.(this.connection)}async beginTransaction(e){e.trxCount++,await super.beginTransaction(e)}async commitTransaction(e){e.trxCount--,await super.commitTransaction(e)}async rollbackTransaction(e){e.trxCount--,await super.rollbackTransaction(e)}async destroy(){this.db?.close()}},Al=class extends Tl{constructor(e,r,u=!1,d=2e3,m=1e3){super();F(this,"db");F(this,"onWrite");F(this,"trxCount",0);this.db=e,this.onWrite=r?u?El(r,d,m):r:void 0}async query(e,r){const u=this.db.prepare(e);u.bind(r);const d=[];for(;u.step();)d.push(u.getAsObject());return u.free(),d}async info(){let e=0;const r=this.db.prepare("SELECT last_insert_rowid()");try{r.step(),e=r.get()[0]}finally{r.free()}return this.trxCount===0&&this.onWrite?.(this.db.export()),{insertId:BigInt(e),numAffectedRows:BigInt(this.db.getRowsModified())}}},Dl=class extends Cl{constructor(e){super();F(this,"config");this.config=e}createDriver(){return new Sl(this.config)}};function Rl(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function Ll(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var r=function u(){return this instanceof u?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(u){var d=Object.getOwnPropertyDescriptor(t,u);Object.defineProperty(r,u,d.get?d:{enumerable:!0,get:function(){return t[u]}})}),r}var $h={exports:{}},Ml={},Pl=Object.freeze({__proto__:null,default:Ml}),Lo=Ll(Pl);(function(t,e){var r=void 0,u=function(d){return r||(r=new Promise(function(m,x){var E=typeof d<"u"?d:{},H=E.onAbort;E.onAbort=function(i){x(new Error(i)),H&&H(i)},E.postRun=E.postRun||[],E.postRun.push(function(){m(E)}),t=void 0;var l;l||(l=typeof E<"u"?E:{}),l.onRuntimeInitialized=function(){function i(f,w){switch(typeof w){case"boolean":_d(f,w?1:0);break;case"number":Md(f,w);break;case"string":Pd(f,w,-1,-1);break;case"object":if(w===null)Nu(f);else if(w.length!=null){var q=zn(w,Gn);Bd(f,q,w.length,-1),Yn(q)}else Zn(f,"Wrong API use : tried to return a value of an unknown type ("+w+").",-1);break;default:Nu(f)}}function s(f,w){for(var q=[],A=0;A<f;A+=1){var _=St(w+4*A,"i32"),te=Sd(_);if(te===1||te===2)_=Ld(_);else if(te===3)_=Dd(_);else if(te===4){te=_,_=Ad(te),te=Rd(te);for(var ut=new Uint8Array(_),ot=0;ot<_;ot+=1)ut[ot]=we[te+ot];_=ut}else _=null;q.push(_)}return q}function o(f,w){this.La=f,this.db=w,this.Ja=1,this.fb=[]}function h(f,w){if(this.db=w,w=zr(f)+1,this.Ya=Hn(w),this.Ya===null)throw Error("Unable to allocate memory for the SQL string");Kr(f,ee,this.Ya,w),this.eb=this.Ya,this.Ua=this.ib=null}function c(f){if(this.filename="dbfile_"+(4294967295*Math.random()>>>0),f!=null){var w=this.filename,q="/",A=w;if(q&&(q=typeof q=="string"?q:Fi(q),A=w?At(q+"/"+w):q),w=_a(!0,!0),A=Qn(A,(w!==void 0?w:438)&4095|32768,0),f){if(typeof f=="string"){q=Array(f.length);for(var _=0,te=f.length;_<te;++_)q[_]=f.charCodeAt(_);f=q}$n(A,w|146),q=Yr(A,577),ru(q,f,0,f.length,0),Wo(q),$n(A,w)}}this.handleError(I(this.filename,p)),this.db=St(p,"i32"),vu(this.db),this.Za={},this.Na={}}var p=Ht(4),y=l.cwrap,I=y("sqlite3_open","number",["string","number"]),U=y("sqlite3_close_v2","number",["number"]),L=y("sqlite3_exec","number",["number","string","number","number","number"]),ge=y("sqlite3_changes","number",["number"]),ke=y("sqlite3_prepare_v2","number",["number","string","number","number","number"]),lu=y("sqlite3_sql","string",["number"]),pd=y("sqlite3_normalized_sql","string",["number"]),fu=y("sqlite3_prepare_v2","number",["number","number","number","number","number"]),md=y("sqlite3_bind_text","number",["number","number","number","number","number"]),pu=y("sqlite3_bind_blob","number",["number","number","number","number","number"]),yd=y("sqlite3_bind_double","number",["number","number","number"]),Nd=y("sqlite3_bind_int","number",["number","number","number"]),wd=y("sqlite3_bind_parameter_index","number",["number","string"]),vd=y("sqlite3_step","number",["number"]),gd=y("sqlite3_errmsg","string",["number"]),bd=y("sqlite3_column_count","number",["number"]),xd=y("sqlite3_data_count","number",["number"]),qd=y("sqlite3_column_double","number",["number","number"]),mu=y("sqlite3_column_text","string",["number","number"]),Od=y("sqlite3_column_blob","number",["number","number"]),Wd=y("sqlite3_column_bytes","number",["number","number"]),Cd=y("sqlite3_column_type","number",["number","number"]),kd=y("sqlite3_column_name","string",["number","number"]),Id=y("sqlite3_reset","number",["number"]),Td=y("sqlite3_clear_bindings","number",["number"]),Ed=y("sqlite3_finalize","number",["number"]),yu=y("sqlite3_create_function_v2","number","number string number number number number number number number".split(" ")),Sd=y("sqlite3_value_type","number",["number"]),Ad=y("sqlite3_value_bytes","number",["number"]),Dd=y("sqlite3_value_text","string",["number"]),Rd=y("sqlite3_value_blob","number",["number"]),Ld=y("sqlite3_value_double","number",["number"]),Md=y("sqlite3_result_double","",["number","number"]),Nu=y("sqlite3_result_null","",["number"]),Pd=y("sqlite3_result_text","",["number","string","number","number"]),Bd=y("sqlite3_result_blob","",["number","number","number","number"]),_d=y("sqlite3_result_int","",["number","number"]),Zn=y("sqlite3_result_error","",["number","string","number"]),wu=y("sqlite3_aggregate_context","number",["number","number"]),vu=y("RegisterExtensionFunctions","number",["number"]);o.prototype.bind=function(f){if(!this.La)throw"Statement closed";return this.reset(),Array.isArray(f)?this.wb(f):f!=null&&typeof f=="object"?this.xb(f):!0},o.prototype.step=function(){if(!this.La)throw"Statement closed";this.Ja=1;var f=vd(this.La);switch(f){case 100:return!0;case 101:return!1;default:throw this.db.handleError(f)}},o.prototype.rb=function(f){return f==null&&(f=this.Ja,this.Ja+=1),qd(this.La,f)},o.prototype.Ab=function(f){if(f==null&&(f=this.Ja,this.Ja+=1),f=mu(this.La,f),typeof BigInt!="function")throw Error("BigInt is not supported");return BigInt(f)},o.prototype.Bb=function(f){return f==null&&(f=this.Ja,this.Ja+=1),mu(this.La,f)},o.prototype.getBlob=function(f){f==null&&(f=this.Ja,this.Ja+=1);var w=Wd(this.La,f);f=Od(this.La,f);for(var q=new Uint8Array(w),A=0;A<w;A+=1)q[A]=we[f+A];return q},o.prototype.get=function(f,w){w=w||{},f!=null&&this.bind(f)&&this.step(),f=[];for(var q=xd(this.La),A=0;A<q;A+=1)switch(Cd(this.La,A)){case 1:var _=w.useBigInt?this.Ab(A):this.rb(A);f.push(_);break;case 2:f.push(this.rb(A));break;case 3:f.push(this.Bb(A));break;case 4:f.push(this.getBlob(A));break;default:f.push(null)}return f},o.prototype.getColumnNames=function(){for(var f=[],w=bd(this.La),q=0;q<w;q+=1)f.push(kd(this.La,q));return f},o.prototype.getAsObject=function(f,w){f=this.get(f,w),w=this.getColumnNames();for(var q={},A=0;A<w.length;A+=1)q[w[A]]=f[A];return q},o.prototype.getSQL=function(){return lu(this.La)},o.prototype.getNormalizedSQL=function(){return pd(this.La)},o.prototype.run=function(f){return f!=null&&this.bind(f),this.step(),this.reset()},o.prototype.nb=function(f,w){w==null&&(w=this.Ja,this.Ja+=1),f=La(f);var q=zn(f,Gn);this.fb.push(q),this.db.handleError(md(this.La,w,q,f.length-1,0))},o.prototype.vb=function(f,w){w==null&&(w=this.Ja,this.Ja+=1);var q=zn(f,Gn);this.fb.push(q),this.db.handleError(pu(this.La,w,q,f.length,0))},o.prototype.mb=function(f,w){w==null&&(w=this.Ja,this.Ja+=1),this.db.handleError((f===(f|0)?Nd:yd)(this.La,w,f))},o.prototype.yb=function(f){f==null&&(f=this.Ja,this.Ja+=1),pu(this.La,f,0,0,0)},o.prototype.ob=function(f,w){switch(w==null&&(w=this.Ja,this.Ja+=1),typeof f){case"string":this.nb(f,w);return;case"number":this.mb(f,w);return;case"bigint":this.nb(f.toString(),w);return;case"boolean":this.mb(f+0,w);return;case"object":if(f===null){this.yb(w);return}if(f.length!=null){this.vb(f,w);return}}throw"Wrong API use : tried to bind a value of an unknown type ("+f+")."},o.prototype.xb=function(f){var w=this;return Object.keys(f).forEach(function(q){var A=wd(w.La,q);A!==0&&w.ob(f[q],A)}),!0},o.prototype.wb=function(f){for(var w=0;w<f.length;w+=1)this.ob(f[w],w+1);return!0},o.prototype.reset=function(){return this.freemem(),Td(this.La)===0&&Id(this.La)===0},o.prototype.freemem=function(){for(var f;(f=this.fb.pop())!==void 0;)Yn(f)},o.prototype.free=function(){this.freemem();var f=Ed(this.La)===0;return delete this.db.Za[this.La],this.La=0,f},h.prototype.next=function(){if(this.Ya===null)return{done:!0};if(this.Ua!==null&&(this.Ua.free(),this.Ua=null),!this.db.db)throw this.gb(),Error("Database closed");var f=Vi(),w=Ht(4);Bi(p),Bi(w);try{this.db.handleError(fu(this.db.db,this.eb,-1,p,w)),this.eb=St(w,"i32");var q=St(p,"i32");return q===0?(this.gb(),{done:!0}):(this.Ua=new o(q,this.db),this.db.Za[q]=this.Ua,{value:this.Ua,done:!1})}catch(A){throw this.ib=wo(this.eb),this.gb(),A}finally{ji(f)}},h.prototype.gb=function(){Yn(this.Ya),this.Ya=null},h.prototype.getRemainingSQL=function(){return this.ib!==null?this.ib:wo(this.eb)},typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"&&(h.prototype[Symbol.iterator]=function(){return this}),c.prototype.run=function(f,w){if(!this.db)throw"Database closed";if(w){f=this.prepare(f,w);try{f.step()}finally{f.free()}}else this.handleError(L(this.db,f,0,0,p));return this},c.prototype.exec=function(f,w,q){if(!this.db)throw"Database closed";var A=Vi(),_=null;try{var te=To(f),ut=Ht(4);for(f=[];St(te,"i8")!==0;){Bi(p),Bi(ut),this.handleError(fu(this.db,te,-1,p,ut));var ot=St(p,"i32");if(te=St(ut,"i32"),ot!==0){var Ge=null;for(_=new o(ot,this),w!=null&&_.bind(w);_.step();)Ge===null&&(Ge={columns:_.getColumnNames(),values:[]},f.push(Ge)),Ge.values.push(_.get(null,q));_.free()}}return f}catch(ht){throw _&&_.free(),ht}finally{ji(A)}},c.prototype.each=function(f,w,q,A,_){typeof w=="function"&&(A=q,q=w,w=void 0),f=this.prepare(f,w);try{for(;f.step();)q(f.getAsObject(null,_))}finally{f.free()}if(typeof A=="function")return A()},c.prototype.prepare=function(f,w){if(Bi(p),this.handleError(ke(this.db,f,-1,p,0)),f=St(p,"i32"),f===0)throw"Nothing to prepare";var q=new o(f,this);return w!=null&&q.bind(w),this.Za[f]=q},c.prototype.iterateStatements=function(f){return new h(f,this)},c.prototype.export=function(){Object.values(this.Za).forEach(function(w){w.free()}),Object.values(this.Na).forEach(Xr),this.Na={},this.handleError(U(this.db));var f=hd(this.filename);return this.handleError(I(this.filename,p)),this.db=St(p,"i32"),vu(this.db),f},c.prototype.close=function(){this.db!==null&&(Object.values(this.Za).forEach(function(f){f.free()}),Object.values(this.Na).forEach(Xr),this.Na={},this.handleError(U(this.db)),Ha("/"+this.filename),this.db=null)},c.prototype.handleError=function(f){if(f===0)return null;throw f=gd(this.db),Error(f)},c.prototype.getRowsModified=function(){return ge(this.db)},c.prototype.create_function=function(f,w){Object.prototype.hasOwnProperty.call(this.Na,f)&&(Xr(this.Na[f]),delete this.Na[f]);var q=Kn(function(A,_,te){_=s(_,te);try{var ut=w.apply(null,_)}catch(ot){Zn(A,ot,-1);return}i(A,ut)},"viii");return this.Na[f]=q,this.handleError(yu(this.db,f,w.length,1,0,q,0,0,0)),this},c.prototype.create_aggregate=function(f,w){var q=w.init||function(){return null},A=w.finalize||function(Ge){return Ge},_=w.step;if(!_)throw"An aggregate function must have a step function in "+f;var te={};Object.hasOwnProperty.call(this.Na,f)&&(Xr(this.Na[f]),delete this.Na[f]),w=f+"__finalize",Object.hasOwnProperty.call(this.Na,w)&&(Xr(this.Na[w]),delete this.Na[w]);var ut=Kn(function(Ge,ht,So){var qr=wu(Ge,1);Object.hasOwnProperty.call(te,qr)||(te[qr]=q()),ht=s(ht,So),ht=[te[qr]].concat(ht);try{te[qr]=_.apply(null,ht)}catch(Fd){delete te[qr],Zn(Ge,Fd,-1)}},"viii"),ot=Kn(function(Ge){var ht=wu(Ge,1);try{var So=A(te[ht])}catch(qr){delete te[ht],Zn(Ge,qr,-1);return}i(Ge,So),delete te[ht]},"vi");return this.Na[f]=ut,this.Na[w]=ot,this.handleError(yu(this.db,f,_.length-1,1,0,0,ut,ot,0)),this},l.Database=c};var pe=Object.assign({},l),Z="./this.program",Re=typeof window=="object",nt=typeof importScripts=="function",je=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",oe="",Gt,J,j;if(je){var wt=Lo,vt=Lo;oe=nt?vt.dirname(oe)+"/":__dirname+"/",Gt=(i,s)=>(i=Bn(i)?new URL(i):vt.normalize(i),wt.readFileSync(i,s?void 0:"utf8")),j=i=>(i=Gt(i,!0),i.buffer||(i=new Uint8Array(i)),i),J=(i,s,o,h=!0)=>{i=Bn(i)?new URL(i):vt.normalize(i),wt.readFile(i,h?void 0:"utf8",(c,p)=>{c?o(c):s(h?p.buffer:p)})},!l.thisProgram&&1<process.argv.length&&(Z=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),t.exports=l,l.inspect=()=>"[Emscripten Module object]"}else(Re||nt)&&(nt?oe=self.location.href:typeof document<"u"&&document.currentScript&&(oe=document.currentScript.src),oe=oe.indexOf("blob:")!==0?oe.substr(0,oe.replace(/[?#].*/,"").lastIndexOf("/")+1):"",Gt=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.send(null),s.responseText},nt&&(j=i=>{var s=new XMLHttpRequest;return s.open("GET",i,!1),s.responseType="arraybuffer",s.send(null),new Uint8Array(s.response)}),J=(i,s,o)=>{var h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{h.status==200||h.status==0&&h.response?s(h.response):o()},h.onerror=o,h.send(null)});var Mn=l.print||console.log.bind(console),Tt=l.printErr||console.error.bind(console);Object.assign(l,pe),pe=null,l.thisProgram&&(Z=l.thisProgram);var at;l.wasmBinary&&(at=l.wasmBinary),typeof WebAssembly!="object"&&Et("no native wasm support detected");var zt,Pn=!1,we,ee,Mi,D,ae,mo,yo;function Oa(){var i=zt.buffer;l.HEAP8=we=new Int8Array(i),l.HEAP16=Mi=new Int16Array(i),l.HEAPU8=ee=new Uint8Array(i),l.HEAPU16=new Uint16Array(i),l.HEAP32=D=new Int32Array(i),l.HEAPU32=ae=new Uint32Array(i),l.HEAPF32=mo=new Float32Array(i),l.HEAPF64=yo=new Float64Array(i)}var Wa=[],Ca=[],ka=[];function Xh(){var i=l.preRun.shift();Wa.unshift(i)}var vr=0,Pi=null;function Et(i){throw l.onAbort?.(i),i="Aborted("+i+")",Tt(i),Pn=!0,new WebAssembly.RuntimeError(i+". Build with -sASSERTIONS for more info.")}var Ia=i=>i.startsWith("data:application/octet-stream;base64,"),Bn=i=>i.startsWith("file://"),Gr;if(Gr="sql-wasm.wasm",!Ia(Gr)){var Ta=Gr;Gr=l.locateFile?l.locateFile(Ta,oe):oe+Ta}function Ea(i){if(i==Gr&&at)return new Uint8Array(at);if(j)return j(i);throw"both async and sync fetching of the wasm failed"}function Zh(i){if(!at&&(Re||nt)){if(typeof fetch=="function"&&!Bn(i))return fetch(i,{credentials:"same-origin"}).then(s=>{if(!s.ok)throw"failed to load wasm binary file at '"+i+"'";return s.arrayBuffer()}).catch(()=>Ea(i));if(J)return new Promise((s,o)=>{J(i,h=>s(new Uint8Array(h)),o)})}return Promise.resolve().then(()=>Ea(i))}function Sa(i,s,o){return Zh(i).then(h=>WebAssembly.instantiate(h,s)).then(h=>h).then(o,h=>{Tt(`failed to asynchronously prepare wasm: ${h}`),Et(h)})}function ed(i,s){var o=Gr;at||typeof WebAssembly.instantiateStreaming!="function"||Ia(o)||Bn(o)||je||typeof fetch!="function"?Sa(o,i,s):fetch(o,{credentials:"same-origin"}).then(h=>WebAssembly.instantiateStreaming(h,i).then(s,function(c){return Tt(`wasm streaming compile failed: ${c}`),Tt("falling back to ArrayBuffer instantiation"),Sa(o,i,s)}))}var k,ue,No=i=>{for(;0<i.length;)i.shift()(l)};function St(i,s="i8"){switch(s.endsWith("*")&&(s="*"),s){case"i1":return we[i>>0];case"i8":return we[i>>0];case"i16":return Mi[i>>1];case"i32":return D[i>>2];case"i64":Et("to do getValue(i64) use WASM_BIGINT");case"float":return mo[i>>2];case"double":return yo[i>>3];case"*":return ae[i>>2];default:Et(`invalid type for getValue: ${s}`)}}function Bi(i){var s="i32";switch(s.endsWith("*")&&(s="*"),s){case"i1":we[i>>0]=0;break;case"i8":we[i>>0]=0;break;case"i16":Mi[i>>1]=0;break;case"i32":D[i>>2]=0;break;case"i64":Et("to do setValue(i64) use WASM_BIGINT");case"float":mo[i>>2]=0;break;case"double":yo[i>>3]=0;break;case"*":ae[i>>2]=0;break;default:Et(`invalid type for setValue: ${s}`)}}var Aa=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,ve=(i,s,o)=>{var h=s+o;for(o=s;i[o]&&!(o>=h);)++o;if(16<o-s&&i.buffer&&Aa)return Aa.decode(i.subarray(s,o));for(h="";s<o;){var c=i[s++];if(c&128){var p=i[s++]&63;if((c&224)==192)h+=String.fromCharCode((c&31)<<6|p);else{var y=i[s++]&63;c=(c&240)==224?(c&15)<<12|p<<6|y:(c&7)<<18|p<<12|y<<6|i[s++]&63,65536>c?h+=String.fromCharCode(c):(c-=65536,h+=String.fromCharCode(55296|c>>10,56320|c&1023))}}else h+=String.fromCharCode(c)}return h},wo=(i,s)=>i?ve(ee,i,s):"",Da=(i,s)=>{for(var o=0,h=i.length-1;0<=h;h--){var c=i[h];c==="."?i.splice(h,1):c===".."?(i.splice(h,1),o++):o&&(i.splice(h,1),o--)}if(s)for(;o;o--)i.unshift("..");return i},At=i=>{var s=i.charAt(0)==="/",o=i.substr(-1)==="/";return(i=Da(i.split("/").filter(h=>!!h),!s).join("/"))||s||(i="."),i&&o&&(i+="/"),(s?"/":"")+i},td=i=>{var s=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(i).slice(1);return i=s[0],s=s[1],!i&&!s?".":(s&&(s=s.substr(0,s.length-1)),i+s)},_n=i=>{if(i==="/")return"/";i=At(i),i=i.replace(/\/$/,"");var s=i.lastIndexOf("/");return s===-1?i:i.substr(s+1)},rd=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return o=>crypto.getRandomValues(o);if(je)try{var i=Lo;if(i.randomFillSync)return o=>i.randomFillSync(o);var s=i.randomBytes;return o=>(o.set(s(o.byteLength)),o)}catch{}Et("initRandomDevice")},Ra=i=>(Ra=rd())(i);function Fn(){for(var i="",s=!1,o=arguments.length-1;-1<=o&&!s;o--){if(s=0<=o?arguments[o]:"/",typeof s!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!s)return"";i=s+"/"+i,s=s.charAt(0)==="/"}return i=Da(i.split("/").filter(h=>!!h),!s).join("/"),(s?"/":"")+i||"."}var vo=[],zr=i=>{for(var s=0,o=0;o<i.length;++o){var h=i.charCodeAt(o);127>=h?s++:2047>=h?s+=2:55296<=h&&57343>=h?(s+=4,++o):s+=3}return s},Kr=(i,s,o,h)=>{if(!(0<h))return 0;var c=o;h=o+h-1;for(var p=0;p<i.length;++p){var y=i.charCodeAt(p);if(55296<=y&&57343>=y){var I=i.charCodeAt(++p);y=65536+((y&1023)<<10)|I&1023}if(127>=y){if(o>=h)break;s[o++]=y}else{if(2047>=y){if(o+1>=h)break;s[o++]=192|y>>6}else{if(65535>=y){if(o+2>=h)break;s[o++]=224|y>>12}else{if(o+3>=h)break;s[o++]=240|y>>18,s[o++]=128|y>>12&63}s[o++]=128|y>>6&63}s[o++]=128|y&63}}return s[o]=0,o-c};function La(i,s){var o=Array(zr(i)+1);return i=Kr(i,o,0,o.length),s&&(o.length=i),o}var Ma=[];function Pa(i,s){Ma[i]={input:[],output:[],Xa:s},qo(i,id)}var id={open(i){var s=Ma[i.node.rdev];if(!s)throw new b(43);i.tty=s,i.seekable=!1},close(i){i.tty.Xa.fsync(i.tty)},fsync(i){i.tty.Xa.fsync(i.tty)},read(i,s,o,h){if(!i.tty||!i.tty.Xa.sb)throw new b(60);for(var c=0,p=0;p<h;p++){try{var y=i.tty.Xa.sb(i.tty)}catch{throw new b(29)}if(y===void 0&&c===0)throw new b(6);if(y==null)break;c++,s[o+p]=y}return c&&(i.node.timestamp=Date.now()),c},write(i,s,o,h){if(!i.tty||!i.tty.Xa.jb)throw new b(60);try{for(var c=0;c<h;c++)i.tty.Xa.jb(i.tty,s[o+c])}catch{throw new b(29)}return h&&(i.node.timestamp=Date.now()),c}},nd={sb(){e:{if(!vo.length){var i=null;if(je){var s=Buffer.alloc(256),o=0,h=process.stdin.fd;try{o=wt.readSync(h,s)}catch(c){if(c.toString().includes("EOF"))o=0;else throw c}0<o?i=s.slice(0,o).toString("utf-8"):i=null}else typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`));if(!i){i=null;break e}vo=La(i,!0)}i=vo.shift()}return i},jb(i,s){s===null||s===10?(Mn(ve(i.output,0)),i.output=[]):s!=0&&i.output.push(s)},fsync(i){i.output&&0<i.output.length&&(Mn(ve(i.output,0)),i.output=[])},Mb(){return{Ib:25856,Kb:5,Hb:191,Jb:35387,Gb:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},Nb(){return 0},Ob(){return[24,80]}},sd={jb(i,s){s===null||s===10?(Tt(ve(i.output,0)),i.output=[]):s!=0&&i.output.push(s)},fsync(i){i.output&&0<i.output.length&&(Tt(ve(i.output,0)),i.output=[])}};function Ba(i,s){var o=i.Ia?i.Ia.length:0;o>=s||(s=Math.max(s,o*(1048576>o?2:1.125)>>>0),o!=0&&(s=Math.max(s,256)),o=i.Ia,i.Ia=new Uint8Array(s),0<i.Ma&&i.Ia.set(o.subarray(0,i.Ma),0))}var B={Qa:null,Ra(){return B.createNode(null,"/",16895,0)},createNode(i,s,o,h){if((o&61440)===24576||(o&61440)===4096)throw new b(63);return B.Qa||(B.Qa={dir:{node:{Pa:B.Ga.Pa,Oa:B.Ga.Oa,lookup:B.Ga.lookup,ab:B.Ga.ab,rename:B.Ga.rename,unlink:B.Ga.unlink,rmdir:B.Ga.rmdir,readdir:B.Ga.readdir,symlink:B.Ga.symlink},stream:{Ta:B.Ha.Ta}},file:{node:{Pa:B.Ga.Pa,Oa:B.Ga.Oa},stream:{Ta:B.Ha.Ta,read:B.Ha.read,write:B.Ha.write,lb:B.Ha.lb,bb:B.Ha.bb,cb:B.Ha.cb}},link:{node:{Pa:B.Ga.Pa,Oa:B.Ga.Oa,readlink:B.Ga.readlink},stream:{}},pb:{node:{Pa:B.Ga.Pa,Oa:B.Ga.Oa},stream:ud}}),o=$a(i,s,o,h),st(o.mode)?(o.Ga=B.Qa.dir.node,o.Ha=B.Qa.dir.stream,o.Ia={}):(o.mode&61440)===32768?(o.Ga=B.Qa.file.node,o.Ha=B.Qa.file.stream,o.Ma=0,o.Ia=null):(o.mode&61440)===40960?(o.Ga=B.Qa.link.node,o.Ha=B.Qa.link.stream):(o.mode&61440)===8192&&(o.Ga=B.Qa.pb.node,o.Ha=B.Qa.pb.stream),o.timestamp=Date.now(),i&&(i.Ia[s]=o,i.timestamp=o.timestamp),o},Lb(i){return i.Ia?i.Ia.subarray?i.Ia.subarray(0,i.Ma):new Uint8Array(i.Ia):new Uint8Array(0)},Ga:{Pa(i){var s={};return s.dev=(i.mode&61440)===8192?i.id:1,s.ino=i.id,s.mode=i.mode,s.nlink=1,s.uid=0,s.gid=0,s.rdev=i.rdev,st(i.mode)?s.size=4096:(i.mode&61440)===32768?s.size=i.Ma:(i.mode&61440)===40960?s.size=i.link.length:s.size=0,s.atime=new Date(i.timestamp),s.mtime=new Date(i.timestamp),s.ctime=new Date(i.timestamp),s.zb=4096,s.blocks=Math.ceil(s.size/s.zb),s},Oa(i,s){if(s.mode!==void 0&&(i.mode=s.mode),s.timestamp!==void 0&&(i.timestamp=s.timestamp),s.size!==void 0&&(s=s.size,i.Ma!=s))if(s==0)i.Ia=null,i.Ma=0;else{var o=i.Ia;i.Ia=new Uint8Array(s),o&&i.Ia.set(o.subarray(0,Math.min(s,i.Ma))),i.Ma=s}},lookup(){throw bo[44]},ab(i,s,o,h){return B.createNode(i,s,o,h)},rename(i,s,o){if(st(i.mode)){try{var h=gr(s,o)}catch{}if(h)for(var c in h.Ia)throw new b(55)}delete i.parent.Ia[i.name],i.parent.timestamp=Date.now(),i.name=o,s.Ia[o]=i,s.timestamp=i.parent.timestamp,i.parent=s},unlink(i,s){delete i.Ia[s],i.timestamp=Date.now()},rmdir(i,s){var o=gr(i,s),h;for(h in o.Ia)throw new b(55);delete i.Ia[s],i.timestamp=Date.now()},readdir(i){var s=[".",".."],o;for(o of Object.keys(i.Ia))s.push(o);return s},symlink(i,s,o){return i=B.createNode(i,s,41471,0),i.link=o,i},readlink(i){if((i.mode&61440)!==40960)throw new b(28);return i.link}},Ha:{read(i,s,o,h,c){var p=i.node.Ia;if(c>=i.node.Ma)return 0;if(i=Math.min(i.node.Ma-c,h),8<i&&p.subarray)s.set(p.subarray(c,c+i),o);else for(h=0;h<i;h++)s[o+h]=p[c+h];return i},write(i,s,o,h,c,p){if(s.buffer===we.buffer&&(p=!1),!h)return 0;if(i=i.node,i.timestamp=Date.now(),s.subarray&&(!i.Ia||i.Ia.subarray)){if(p)return i.Ia=s.subarray(o,o+h),i.Ma=h;if(i.Ma===0&&c===0)return i.Ia=s.slice(o,o+h),i.Ma=h;if(c+h<=i.Ma)return i.Ia.set(s.subarray(o,o+h),c),h}if(Ba(i,c+h),i.Ia.subarray&&s.subarray)i.Ia.set(s.subarray(o,o+h),c);else for(p=0;p<h;p++)i.Ia[c+p]=s[o+p];return i.Ma=Math.max(i.Ma,c+h),h},Ta(i,s,o){if(o===1?s+=i.position:o===2&&(i.node.mode&61440)===32768&&(s+=i.node.Ma),0>s)throw new b(28);return s},lb(i,s,o){Ba(i.node,s+o),i.node.Ma=Math.max(i.node.Ma,s+o)},bb(i,s,o,h,c){if((i.node.mode&61440)!==32768)throw new b(43);if(i=i.node.Ia,c&2||i.buffer!==we.buffer){if((0<o||o+s<i.length)&&(i.subarray?i=i.subarray(o,o+s):i=Array.prototype.slice.call(i,o,o+s)),o=!0,s=65536*Math.ceil(s/65536),(c=du(65536,s))?(ee.fill(0,c,c+s),s=c):s=0,!s)throw new b(48);we.set(i,s)}else o=!1,s=i.byteOffset;return{Db:s,ub:o}},cb(i,s,o,h){return B.Ha.write(i,s,0,h,o,!1),0}}},_a=(i,s)=>{var o=0;return i&&(o|=365),s&&(o|=146),o},go=null,Fa={},_i=[],od=1,Kt=null,Qa=!0,b=null,bo={};function Ue(i,s={}){if(i=Fn(i),!i)return{path:"",node:null};if(s=Object.assign({qb:!0,kb:0},s),8<s.kb)throw new b(32);i=i.split("/").filter(y=>!!y);for(var o=go,h="/",c=0;c<i.length;c++){var p=c===i.length-1;if(p&&s.parent)break;if(o=gr(o,i[c]),h=At(h+"/"+i[c]),o.Va&&(!p||p&&s.qb)&&(o=o.Va.root),!p||s.Sa){for(p=0;(o.mode&61440)===40960;)if(o=Ya(h),h=Fn(td(h),o),o=Ue(h,{kb:s.kb+1}).node,40<p++)throw new b(32)}}return{path:h,node:o}}function Fi(i){for(var s;;){if(i===i.parent)return i=i.Ra.tb,s?i[i.length-1]!=="/"?`${i}/${s}`:i+s:i;s=s?`${i.name}/${s}`:i.name,i=i.parent}}function xo(i,s){for(var o=0,h=0;h<s.length;h++)o=(o<<5)-o+s.charCodeAt(h)|0;return(i+o>>>0)%Kt.length}function Ua(i){var s=xo(i.parent.id,i.name);if(Kt[s]===i)Kt[s]=i.Wa;else for(s=Kt[s];s;){if(s.Wa===i){s.Wa=i.Wa;break}s=s.Wa}}function gr(i,s){var o;if(o=(o=Hr(i,"x"))?o:i.Ga.lookup?0:2)throw new b(o,i);for(o=Kt[xo(i.id,s)];o;o=o.Wa){var h=o.name;if(o.parent.id===i.id&&h===s)return o}return i.Ga.lookup(i,s)}function $a(i,s,o,h){return i=new uu(i,s,o,h),s=xo(i.parent.id,i.name),i.Wa=Kt[s],Kt[s]=i}function st(i){return(i&61440)===16384}function Ja(i){var s=["r","w","rw"][i&3];return i&512&&(s+="w"),s}function Hr(i,s){if(Qa)return 0;if(!s.includes("r")||i.mode&292){if(s.includes("w")&&!(i.mode&146)||s.includes("x")&&!(i.mode&73))return 2}else return 2;return 0}function Va(i,s){try{return gr(i,s),20}catch{}return Hr(i,"wx")}function ja(i,s,o){try{var h=gr(i,s)}catch(c){return c.Ka}if(i=Hr(i,"wx"))return i;if(o){if(!st(h.mode))return 54;if(h===h.parent||Fi(h)==="/")return 10}else if(st(h.mode))return 31;return 0}function ad(){for(var i=0;4096>=i;i++)if(!_i[i])return i;throw new b(33)}function Me(i){if(i=_i[i],!i)throw new b(8);return i}function Ga(i,s=-1){return $i||($i=function(){this.$a={}},$i.prototype={},Object.defineProperties($i.prototype,{object:{get(){return this.node},set(o){this.node=o}},flags:{get(){return this.$a.flags},set(o){this.$a.flags=o}},position:{get(){return this.$a.position},set(o){this.$a.position=o}}})),i=Object.assign(new $i,i),s==-1&&(s=ad()),i.fd=s,_i[s]=i}var ud={open(i){i.Ha=Fa[i.node.rdev].Ha,i.Ha.open?.(i)},Ta(){throw new b(70)}};function qo(i,s){Fa[i]={Ha:s}}function za(i,s){var o=s==="/",h=!s;if(o&&go)throw new b(10);if(!o&&!h){var c=Ue(s,{qb:!1});if(s=c.path,c=c.node,c.Va)throw new b(10);if(!st(c.mode))throw new b(54)}s={type:i,Pb:{},tb:s,Cb:[]},i=i.Ra(s),i.Ra=s,s.root=i,o?go=i:c&&(c.Va=s,c.Ra&&c.Ra.Cb.push(s))}function Qn(i,s,o){var h=Ue(i,{parent:!0}).node;if(i=_n(i),!i||i==="."||i==="..")throw new b(28);var c=Va(h,i);if(c)throw new b(c);if(!h.Ga.ab)throw new b(63);return h.Ga.ab(h,i,s,o)}function gt(i,s){return Qn(i,(s!==void 0?s:511)&1023|16384,0)}function Un(i,s,o){typeof o>"u"&&(o=s,s=438),Qn(i,s|8192,o)}function Oo(i,s){if(!Fn(i))throw new b(44);var o=Ue(s,{parent:!0}).node;if(!o)throw new b(44);s=_n(s);var h=Va(o,s);if(h)throw new b(h);if(!o.Ga.symlink)throw new b(63);o.Ga.symlink(o,s,i)}function Ka(i){var s=Ue(i,{parent:!0}).node;i=_n(i);var o=gr(s,i),h=ja(s,i,!0);if(h)throw new b(h);if(!s.Ga.rmdir)throw new b(63);if(o.Va)throw new b(10);s.Ga.rmdir(s,i),Ua(o)}function Ha(i){var s=Ue(i,{parent:!0}).node;if(!s)throw new b(44);i=_n(i);var o=gr(s,i),h=ja(s,i,!1);if(h)throw new b(h);if(!s.Ga.unlink)throw new b(63);if(o.Va)throw new b(10);s.Ga.unlink(s,i),Ua(o)}function Ya(i){if(i=Ue(i).node,!i)throw new b(44);if(!i.Ga.readlink)throw new b(28);return Fn(Fi(i.parent),i.Ga.readlink(i))}function Qi(i,s){if(i=Ue(i,{Sa:!s}).node,!i)throw new b(44);if(!i.Ga.Pa)throw new b(63);return i.Ga.Pa(i)}function Xa(i){return Qi(i,!0)}function $n(i,s){if(i=typeof i=="string"?Ue(i,{Sa:!0}).node:i,!i.Ga.Oa)throw new b(63);i.Ga.Oa(i,{mode:s&4095|i.mode&-4096,timestamp:Date.now()})}function Za(i,s){if(0>s)throw new b(28);if(i=typeof i=="string"?Ue(i,{Sa:!0}).node:i,!i.Ga.Oa)throw new b(63);if(st(i.mode))throw new b(31);if((i.mode&61440)!==32768)throw new b(28);var o=Hr(i,"w");if(o)throw new b(o);i.Ga.Oa(i,{size:s,timestamp:Date.now()})}function Yr(i,s,o){if(i==="")throw new b(44);if(typeof s=="string"){var h={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090}[s];if(typeof h>"u")throw Error(`Unknown file open mode: ${s}`);s=h}if(o=s&64?(typeof o>"u"?438:o)&4095|32768:0,typeof i=="object")var c=i;else{i=At(i);try{c=Ue(i,{Sa:!(s&131072)}).node}catch{}}if(h=!1,s&64)if(c){if(s&128)throw new b(20)}else c=Qn(i,o,0),h=!0;if(!c)throw new b(44);if((c.mode&61440)===8192&&(s&=-513),s&65536&&!st(c.mode))throw new b(54);if(!h&&(o=c?(c.mode&61440)===40960?32:st(c.mode)&&(Ja(s)!=="r"||s&512)?31:Hr(c,Ja(s)):44))throw new b(o);return s&512&&!h&&Za(c,0),s&=-131713,c=Ga({node:c,path:Fi(c),flags:s,seekable:!0,position:0,Ha:c.Ha,Fb:[],error:!1}),c.Ha.open&&c.Ha.open(c),!l.logReadFiles||s&1||(Co||(Co={}),i in Co||(Co[i]=1)),c}function Wo(i){if(i.fd===null)throw new b(8);i.hb&&(i.hb=null);try{i.Ha.close&&i.Ha.close(i)}catch(s){throw s}finally{_i[i.fd]=null}i.fd=null}function eu(i,s,o){if(i.fd===null)throw new b(8);if(!i.seekable||!i.Ha.Ta)throw new b(70);if(o!=0&&o!=1&&o!=2)throw new b(28);i.position=i.Ha.Ta(i,s,o),i.Fb=[]}function tu(i,s,o,h,c){if(0>h||0>c)throw new b(28);if(i.fd===null)throw new b(8);if((i.flags&2097155)===1)throw new b(8);if(st(i.node.mode))throw new b(31);if(!i.Ha.read)throw new b(28);var p=typeof c<"u";if(!p)c=i.position;else if(!i.seekable)throw new b(70);return s=i.Ha.read(i,s,o,h,c),p||(i.position+=s),s}function ru(i,s,o,h,c){if(0>h||0>c)throw new b(28);if(i.fd===null)throw new b(8);if(!(i.flags&2097155))throw new b(8);if(st(i.node.mode))throw new b(31);if(!i.Ha.write)throw new b(28);i.seekable&&i.flags&1024&&eu(i,0,2);var p=typeof c<"u";if(!p)c=i.position;else if(!i.seekable)throw new b(70);return s=i.Ha.write(i,s,o,h,c,void 0),p||(i.position+=s),s}function hd(i){var s,o=Yr(i,o||0);i=Qi(i).size;var h=new Uint8Array(i);return tu(o,h,0,i,0),s=h,Wo(o),s}function iu(){b||(b=function(i,s){this.name="ErrnoError",this.node=s,this.Eb=function(o){this.Ka=o},this.Eb(i),this.message="FS error"},b.prototype=Error(),b.prototype.constructor=b,[44].forEach(i=>{bo[i]=new b(i),bo[i].stack="<generic error, no stack>"}))}var nu;function Ui(i,s,o){i=At("/dev/"+i);var h=_a(!!s,!!o);su||(su=64);var c=su++<<8|0;qo(c,{open(p){p.seekable=!1},close(){o?.buffer?.length&&o(10)},read(p,y,I,U){for(var L=0,ge=0;ge<U;ge++){try{var ke=s()}catch{throw new b(29)}if(ke===void 0&&L===0)throw new b(6);if(ke==null)break;L++,y[I+ge]=ke}return L&&(p.node.timestamp=Date.now()),L},write(p,y,I,U){for(var L=0;L<U;L++)try{o(y[I+L])}catch{throw new b(29)}return U&&(p.node.timestamp=Date.now()),L}}),Un(i,h,c)}var su,se={},$i,Co;function br(i,s,o){if(s.charAt(0)==="/")return s;if(i=i===-100?"/":Me(i).path,s.length==0){if(!o)throw new b(44);return i}return At(i+"/"+s)}function Jn(i,s,o){try{var h=i(s)}catch(p){if(p&&p.node&&At(s)!==At(Fi(p.node)))return-54;throw p}D[o>>2]=h.dev,D[o+4>>2]=h.mode,ae[o+8>>2]=h.nlink,D[o+12>>2]=h.uid,D[o+16>>2]=h.gid,D[o+20>>2]=h.rdev,ue=[h.size>>>0,(k=h.size,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[o+24>>2]=ue[0],D[o+28>>2]=ue[1],D[o+32>>2]=4096,D[o+36>>2]=h.blocks,i=h.atime.getTime(),s=h.mtime.getTime();var c=h.ctime.getTime();return ue=[Math.floor(i/1e3)>>>0,(k=Math.floor(i/1e3),1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[o+40>>2]=ue[0],D[o+44>>2]=ue[1],ae[o+48>>2]=i%1e3*1e3,ue=[Math.floor(s/1e3)>>>0,(k=Math.floor(s/1e3),1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[o+56>>2]=ue[0],D[o+60>>2]=ue[1],ae[o+64>>2]=s%1e3*1e3,ue=[Math.floor(c/1e3)>>>0,(k=Math.floor(c/1e3),1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[o+72>>2]=ue[0],D[o+76>>2]=ue[1],ae[o+80>>2]=c%1e3*1e3,ue=[h.ino>>>0,(k=h.ino,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[o+88>>2]=ue[0],D[o+92>>2]=ue[1],0}var Vn=void 0;function jn(){var i=D[+Vn>>2];return Vn+=4,i}var Ji=(i,s)=>s+2097152>>>0<4194305-!!i?(i>>>0)+4294967296*s:NaN,dd=[0,31,60,91,121,152,182,213,244,274,305,335],cd=[0,31,59,90,120,151,181,212,243,273,304,334],ou=i=>{var s=zr(i)+1,o=Hn(s);return o&&Kr(i,ee,o,s),o},ko={},au=()=>{if(!Io){var i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:Z||"./this.program"},s;for(s in ko)ko[s]===void 0?delete i[s]:i[s]=ko[s];var o=[];for(s in i)o.push(`${s}=${i[s]}`);Io=o}return Io},Io,To=i=>{var s=zr(i)+1,o=Ht(s);return Kr(i,ee,o,s),o},ld=(i,s,o,h)=>{var c={string:L=>{var ge=0;return L!=null&&L!==0&&(ge=To(L)),ge},array:L=>{var ge=Ht(L.length);return we.set(L,ge),ge}};i=l["_"+i];var p=[],y=0;if(h)for(var I=0;I<h.length;I++){var U=c[o[I]];U?(y===0&&(y=Vi()),p[I]=U(h[I])):p[I]=h[I]}return o=i.apply(null,p),o=function(L){return y!==0&&ji(y),s==="string"?L?ve(ee,L):"":s==="boolean"?!!L:L}(o)},Gn=0,zn=(i,s)=>(s=s==1?Ht(i.length):Hn(i.length),i.subarray||i.slice||(i=new Uint8Array(i)),ee.set(i,s),s),xr,Eo=[],Dt,Xr=i=>{xr.delete(Dt.get(i)),Dt.set(i,null),Eo.push(i)},Kn=(i,s)=>{if(!xr){xr=new WeakMap;var o=Dt.length;if(xr)for(var h=0;h<0+o;h++){var c=Dt.get(h);c&&xr.set(c,h)}}if(o=xr.get(i)||0)return o;if(Eo.length)o=Eo.pop();else{try{Dt.grow(1)}catch(I){throw I instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":I}o=Dt.length-1}try{Dt.set(o,i)}catch(I){if(!(I instanceof TypeError))throw I;if(typeof WebAssembly.Function=="function"){h=WebAssembly.Function,c={i:"i32",j:"i64",f:"f32",d:"f64",e:"externref",p:"i32"};for(var p={parameters:[],results:s[0]=="v"?[]:[c[s[0]]]},y=1;y<s.length;++y)p.parameters.push(c[s[y]]);s=new h(p,i)}else{for(h=[1],c=s.slice(0,1),s=s.slice(1),p={i:127,p:127,j:126,f:125,d:124,e:111},h.push(96),y=s.length,128>y?h.push(y):h.push(y%128|128,y>>7),y=0;y<s.length;++y)h.push(p[s[y]]);c=="v"?h.push(0):h.push(1,p[c]),s=[0,97,115,109,1,0,0,0,1],c=h.length,128>c?s.push(c):s.push(c%128|128,c>>7),s.push.apply(s,h),s.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),s=new WebAssembly.Module(new Uint8Array(s)),s=new WebAssembly.Instance(s,{e:{f:i}}).exports.f}Dt.set(o,s)}return xr.set(i,o),o};function uu(i,s,o,h){i||(i=this),this.parent=i,this.Ra=i.Ra,this.Va=null,this.id=od++,this.name=s,this.mode=o,this.Ga={},this.Ha={},this.rdev=h}Object.defineProperties(uu.prototype,{read:{get:function(){return(this.mode&365)===365},set:function(i){i?this.mode|=365:this.mode&=-366}},write:{get:function(){return(this.mode&146)===146},set:function(i){i?this.mode|=146:this.mode&=-147}}}),iu(),Kt=Array(4096),za(B,"/"),gt("/tmp"),gt("/home"),gt("/home/web_user"),function(){gt("/dev"),qo(259,{read:()=>0,write:(h,c,p,y)=>y}),Un("/dev/null",259),Pa(1280,nd),Pa(1536,sd),Un("/dev/tty",1280),Un("/dev/tty1",1536);var i=new Uint8Array(1024),s=0,o=()=>(s===0&&(s=Ra(i).byteLength),i[--s]);Ui("random",o),Ui("urandom",o),gt("/dev/shm"),gt("/dev/shm/tmp")}(),function(){gt("/proc");var i=gt("/proc/self");gt("/proc/self/fd"),za({Ra(){var s=$a(i,"fd",16895,73);return s.Ga={lookup(o,h){var c=Me(+h);return o={parent:null,Ra:{tb:"fake"},Ga:{readlink:()=>c.path}},o.parent=o}},s}},"/proc/self/fd")}();var fd={a:(i,s,o,h)=>{Et(`Assertion failed: ${i?ve(ee,i):""}, at: `+[s?s?ve(ee,s):"":"unknown filename",o,h?h?ve(ee,h):"":"unknown function"])},h:function(i,s){try{return i=i?ve(ee,i):"",$n(i,s),0}catch(o){if(typeof se>"u"||o.name!=="ErrnoError")throw o;return-o.Ka}},H:function(i,s,o){try{if(s=s?ve(ee,s):"",s=br(i,s),o&-8)return-28;var h=Ue(s,{Sa:!0}).node;return h?(i="",o&4&&(i+="r"),o&2&&(i+="w"),o&1&&(i+="x"),i&&Hr(h,i)?-2:0):-44}catch(c){if(typeof se>"u"||c.name!=="ErrnoError")throw c;return-c.Ka}},i:function(i,s){try{var o=Me(i);return $n(o.node,s),0}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return-h.Ka}},g:function(i){try{var s=Me(i).node,o=typeof s=="string"?Ue(s,{Sa:!0}).node:s;if(!o.Ga.Oa)throw new b(63);return o.Ga.Oa(o,{timestamp:Date.now()}),0}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return-h.Ka}},b:function(i,s,o){Vn=o;try{var h=Me(i);switch(s){case 0:var c=jn();if(0>c)return-28;for(;_i[c];)c++;return Ga(h,c).fd;case 1:case 2:return 0;case 3:return h.flags;case 4:return c=jn(),h.flags|=c,0;case 5:return c=jn(),Mi[c+0>>1]=2,0;case 6:case 7:return 0;case 16:case 8:return-28;case 9:return D[hu()>>2]=28,-1;default:return-28}}catch(p){if(typeof se>"u"||p.name!=="ErrnoError")throw p;return-p.Ka}},f:function(i,s){try{var o=Me(i);return Jn(Qi,o.path,s)}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return-h.Ka}},n:function(i,s,o){s=Ji(s,o);try{if(isNaN(s))return 61;var h=Me(i);if(!(h.flags&2097155))throw new b(28);return Za(h.node,s),0}catch(c){if(typeof se>"u"||c.name!=="ErrnoError")throw c;return-c.Ka}},C:function(i,s){try{if(s===0)return-28;var o=zr("/")+1;return s<o?-68:(Kr("/",ee,i,s),o)}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return-h.Ka}},F:function(i,s){try{return i=i?ve(ee,i):"",Jn(Xa,i,s)}catch(o){if(typeof se>"u"||o.name!=="ErrnoError")throw o;return-o.Ka}},z:function(i,s,o){try{return s=s?ve(ee,s):"",s=br(i,s),s=At(s),s[s.length-1]==="/"&&(s=s.substr(0,s.length-1)),gt(s,o),0}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return-h.Ka}},E:function(i,s,o,h){try{s=s?ve(ee,s):"";var c=h&256;return s=br(i,s,h&4096),Jn(c?Xa:Qi,s,o)}catch(p){if(typeof se>"u"||p.name!=="ErrnoError")throw p;return-p.Ka}},y:function(i,s,o,h){Vn=h;try{s=s?ve(ee,s):"",s=br(i,s);var c=h?jn():0;return Yr(s,o,c).fd}catch(p){if(typeof se>"u"||p.name!=="ErrnoError")throw p;return-p.Ka}},w:function(i,s,o,h){try{if(s=s?ve(ee,s):"",s=br(i,s),0>=h)return-28;var c=Ya(s),p=Math.min(h,zr(c)),y=we[o+p];return Kr(c,ee,o,h+1),we[o+p]=y,p}catch(I){if(typeof se>"u"||I.name!=="ErrnoError")throw I;return-I.Ka}},v:function(i){try{return i=i?ve(ee,i):"",Ka(i),0}catch(s){if(typeof se>"u"||s.name!=="ErrnoError")throw s;return-s.Ka}},G:function(i,s){try{return i=i?ve(ee,i):"",Jn(Qi,i,s)}catch(o){if(typeof se>"u"||o.name!=="ErrnoError")throw o;return-o.Ka}},r:function(i,s,o){try{return s=s?ve(ee,s):"",s=br(i,s),o===0?Ha(s):o===512?Ka(s):Et("Invalid flags passed to unlinkat"),0}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return-h.Ka}},q:function(i,s,o){try{if(s=s?ve(ee,s):"",s=br(i,s,!0),o){var h=ae[o>>2]+4294967296*D[o+4>>2],c=D[o+8>>2];p=1e3*h+c/1e6,o+=16,h=ae[o>>2]+4294967296*D[o+4>>2],c=D[o+8>>2],y=1e3*h+c/1e6}else var p=Date.now(),y=p;i=p;var I=Ue(s,{Sa:!0}).node;return I.Ga.Oa(I,{timestamp:Math.max(i,y)}),0}catch(U){if(typeof se>"u"||U.name!=="ErrnoError")throw U;return-U.Ka}},l:function(i,s,o){i=new Date(1e3*Ji(i,s)),D[o>>2]=i.getSeconds(),D[o+4>>2]=i.getMinutes(),D[o+8>>2]=i.getHours(),D[o+12>>2]=i.getDate(),D[o+16>>2]=i.getMonth(),D[o+20>>2]=i.getFullYear()-1900,D[o+24>>2]=i.getDay(),s=i.getFullYear(),D[o+28>>2]=(s%4!==0||s%100===0&&s%400!==0?cd:dd)[i.getMonth()]+i.getDate()-1|0,D[o+36>>2]=-(60*i.getTimezoneOffset()),s=new Date(i.getFullYear(),6,1).getTimezoneOffset();var h=new Date(i.getFullYear(),0,1).getTimezoneOffset();D[o+32>>2]=(s!=h&&i.getTimezoneOffset()==Math.min(h,s))|0},j:function(i,s,o,h,c,p,y,I){c=Ji(c,p);try{if(isNaN(c))return 61;var U=Me(h);if(s&2&&!(o&2)&&(U.flags&2097155)!==2)throw new b(2);if((U.flags&2097155)===1)throw new b(2);if(!U.Ha.bb)throw new b(43);var L=U.Ha.bb(U,i,c,s,o),ge=L.Db;return D[y>>2]=L.ub,ae[I>>2]=ge,0}catch(ke){if(typeof se>"u"||ke.name!=="ErrnoError")throw ke;return-ke.Ka}},k:function(i,s,o,h,c,p,y){p=Ji(p,y);try{if(isNaN(p))return 61;var I=Me(c);if(o&2){if((I.node.mode&61440)!==32768)throw new b(43);if(!(h&2)){var U=ee.slice(i,i+s);I.Ha.cb&&I.Ha.cb(I,U,p,s,h)}}}catch(L){if(typeof se>"u"||L.name!=="ErrnoError")throw L;return-L.Ka}},s:(i,s,o)=>{function h(U){return(U=U.toTimeString().match(/\(([A-Za-z ]+)\)$/))?U[1]:"GMT"}var c=new Date().getFullYear(),p=new Date(c,0,1),y=new Date(c,6,1);c=p.getTimezoneOffset();var I=y.getTimezoneOffset();ae[i>>2]=60*Math.max(c,I),D[s>>2]=+(c!=I),i=h(p),s=h(y),i=ou(i),s=ou(s),I<c?(ae[o>>2]=i,ae[o+4>>2]=s):(ae[o>>2]=s,ae[o+4>>2]=i)},d:()=>Date.now(),t:()=>2147483648,c:()=>performance.now(),o:i=>{var s=ee.length;if(i>>>=0,2147483648<i)return!1;for(var o=1;4>=o;o*=2){var h=s*(1+.2/o);h=Math.min(h,i+100663296);var c=Math;h=Math.max(i,h);e:{c=(c.min.call(c,2147483648,h+(65536-h%65536)%65536)-zt.buffer.byteLength+65535)/65536;try{zt.grow(c),Oa();var p=1;break e}catch{}p=void 0}if(p)return!0}return!1},A:(i,s)=>{var o=0;return au().forEach((h,c)=>{var p=s+o;for(c=ae[i+4*c>>2]=p,p=0;p<h.length;++p)we[c++>>0]=h.charCodeAt(p);we[c>>0]=0,o+=h.length+1}),0},B:(i,s)=>{var o=au();ae[i>>2]=o.length;var h=0;return o.forEach(c=>h+=c.length+1),ae[s>>2]=h,0},e:function(i){try{var s=Me(i);return Wo(s),0}catch(o){if(typeof se>"u"||o.name!=="ErrnoError")throw o;return o.Ka}},p:function(i,s){try{var o=Me(i);return we[s>>0]=o.tty?2:st(o.mode)?3:(o.mode&61440)===40960?7:4,Mi[s+2>>1]=0,ue=[0,(k=0,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[s+8>>2]=ue[0],D[s+12>>2]=ue[1],ue=[0,(k=0,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[s+16>>2]=ue[0],D[s+20>>2]=ue[1],0}catch(h){if(typeof se>"u"||h.name!=="ErrnoError")throw h;return h.Ka}},x:function(i,s,o,h){try{e:{var c=Me(i);i=s;for(var p,y=s=0;y<o;y++){var I=ae[i>>2],U=ae[i+4>>2];i+=8;var L=tu(c,we,I,U,p);if(0>L){var ge=-1;break e}if(s+=L,L<U)break;typeof p<"u"&&(p+=L)}ge=s}return ae[h>>2]=ge,0}catch(ke){if(typeof se>"u"||ke.name!=="ErrnoError")throw ke;return ke.Ka}},m:function(i,s,o,h,c){s=Ji(s,o);try{if(isNaN(s))return 61;var p=Me(i);return eu(p,s,h),ue=[p.position>>>0,(k=p.position,1<=+Math.abs(k)?0<k?+Math.floor(k/4294967296)>>>0:~~+Math.ceil((k-+(~~k>>>0))/4294967296)>>>0:0)],D[c>>2]=ue[0],D[c+4>>2]=ue[1],p.hb&&s===0&&h===0&&(p.hb=null),0}catch(y){if(typeof se>"u"||y.name!=="ErrnoError")throw y;return y.Ka}},D:function(i){try{var s=Me(i);return s.Ha?.fsync?s.Ha.fsync(s):0}catch(o){if(typeof se>"u"||o.name!=="ErrnoError")throw o;return o.Ka}},u:function(i,s,o,h){try{e:{var c=Me(i);i=s;for(var p,y=s=0;y<o;y++){var I=ae[i>>2],U=ae[i+4>>2];i+=8;var L=ru(c,we,I,U,p);if(0>L){var ge=-1;break e}s+=L,typeof p<"u"&&(p+=L)}ge=s}return ae[h>>2]=ge,0}catch(ke){if(typeof se>"u"||ke.name!=="ErrnoError")throw ke;return ke.Ka}}},O=function(){function i(o){return O=o.exports,zt=O.I,Oa(),Dt=O.Aa,Ca.unshift(O.J),vr--,l.monitorRunDependencies?.(vr),vr==0&&Pi&&(o=Pi,Pi=null,o()),O}var s={a:fd};if(vr++,l.monitorRunDependencies?.(vr),l.instantiateWasm)try{return l.instantiateWasm(s,i)}catch(o){return Tt(`Module.instantiateWasm callback failed with error: ${o}`),!1}return ed(s,function(o){i(o.instance)}),{}}();l._sqlite3_free=i=>(l._sqlite3_free=O.K)(i),l._sqlite3_value_text=i=>(l._sqlite3_value_text=O.L)(i);var hu=()=>(hu=O.M)();l._sqlite3_prepare_v2=(i,s,o,h,c)=>(l._sqlite3_prepare_v2=O.N)(i,s,o,h,c),l._sqlite3_step=i=>(l._sqlite3_step=O.O)(i),l._sqlite3_finalize=i=>(l._sqlite3_finalize=O.P)(i),l._sqlite3_reset=i=>(l._sqlite3_reset=O.Q)(i),l._sqlite3_clear_bindings=i=>(l._sqlite3_clear_bindings=O.R)(i),l._sqlite3_value_blob=i=>(l._sqlite3_value_blob=O.S)(i),l._sqlite3_value_bytes=i=>(l._sqlite3_value_bytes=O.T)(i),l._sqlite3_value_double=i=>(l._sqlite3_value_double=O.U)(i),l._sqlite3_value_int=i=>(l._sqlite3_value_int=O.V)(i),l._sqlite3_value_type=i=>(l._sqlite3_value_type=O.W)(i),l._sqlite3_result_blob=(i,s,o,h)=>(l._sqlite3_result_blob=O.X)(i,s,o,h),l._sqlite3_result_double=(i,s)=>(l._sqlite3_result_double=O.Y)(i,s),l._sqlite3_result_error=(i,s,o)=>(l._sqlite3_result_error=O.Z)(i,s,o),l._sqlite3_result_int=(i,s)=>(l._sqlite3_result_int=O._)(i,s),l._sqlite3_result_int64=(i,s,o)=>(l._sqlite3_result_int64=O.$)(i,s,o),l._sqlite3_result_null=i=>(l._sqlite3_result_null=O.aa)(i),l._sqlite3_result_text=(i,s,o,h)=>(l._sqlite3_result_text=O.ba)(i,s,o,h),l._sqlite3_aggregate_context=(i,s)=>(l._sqlite3_aggregate_context=O.ca)(i,s),l._sqlite3_column_count=i=>(l._sqlite3_column_count=O.da)(i),l._sqlite3_data_count=i=>(l._sqlite3_data_count=O.ea)(i),l._sqlite3_column_blob=(i,s)=>(l._sqlite3_column_blob=O.fa)(i,s),l._sqlite3_column_bytes=(i,s)=>(l._sqlite3_column_bytes=O.ga)(i,s),l._sqlite3_column_double=(i,s)=>(l._sqlite3_column_double=O.ha)(i,s),l._sqlite3_column_text=(i,s)=>(l._sqlite3_column_text=O.ia)(i,s),l._sqlite3_column_type=(i,s)=>(l._sqlite3_column_type=O.ja)(i,s),l._sqlite3_column_name=(i,s)=>(l._sqlite3_column_name=O.ka)(i,s),l._sqlite3_bind_blob=(i,s,o,h,c)=>(l._sqlite3_bind_blob=O.la)(i,s,o,h,c),l._sqlite3_bind_double=(i,s,o)=>(l._sqlite3_bind_double=O.ma)(i,s,o),l._sqlite3_bind_int=(i,s,o)=>(l._sqlite3_bind_int=O.na)(i,s,o),l._sqlite3_bind_text=(i,s,o,h,c)=>(l._sqlite3_bind_text=O.oa)(i,s,o,h,c),l._sqlite3_bind_parameter_index=(i,s)=>(l._sqlite3_bind_parameter_index=O.pa)(i,s),l._sqlite3_sql=i=>(l._sqlite3_sql=O.qa)(i),l._sqlite3_normalized_sql=i=>(l._sqlite3_normalized_sql=O.ra)(i),l._sqlite3_errmsg=i=>(l._sqlite3_errmsg=O.sa)(i),l._sqlite3_exec=(i,s,o,h,c)=>(l._sqlite3_exec=O.ta)(i,s,o,h,c),l._sqlite3_changes=i=>(l._sqlite3_changes=O.ua)(i),l._sqlite3_close_v2=i=>(l._sqlite3_close_v2=O.va)(i),l._sqlite3_create_function_v2=(i,s,o,h,c,p,y,I,U)=>(l._sqlite3_create_function_v2=O.wa)(i,s,o,h,c,p,y,I,U),l._sqlite3_open=(i,s)=>(l._sqlite3_open=O.xa)(i,s);var Hn=l._malloc=i=>(Hn=l._malloc=O.ya)(i),Yn=l._free=i=>(Yn=l._free=O.za)(i);l._RegisterExtensionFunctions=i=>(l._RegisterExtensionFunctions=O.Ba)(i);var du=(i,s)=>(du=O.Ca)(i,s),Vi=()=>(Vi=O.Da)(),ji=i=>(ji=O.Ea)(i),Ht=i=>(Ht=O.Fa)(i);l.stackAlloc=Ht,l.stackSave=Vi,l.stackRestore=ji,l.cwrap=(i,s,o,h)=>{var c=!o||o.every(p=>p==="number"||p==="boolean");return s!=="string"&&c&&!h?l["_"+i]:function(){return ld(i,s,o,arguments)}},l.addFunction=Kn,l.removeFunction=Xr,l.UTF8ToString=wo,l.ALLOC_NORMAL=Gn,l.allocate=zn,l.allocateUTF8OnStack=To;var Xn;Pi=function i(){Xn||cu(),Xn||(Pi=i)};function cu(){function i(){if(!Xn&&(Xn=!0,l.calledRun=!0,!Pn)){if(l.noFSInit||nu||(nu=!0,iu(),l.stdin=l.stdin,l.stdout=l.stdout,l.stderr=l.stderr,l.stdin?Ui("stdin",l.stdin):Oo("/dev/tty","/dev/stdin"),l.stdout?Ui("stdout",null,l.stdout):Oo("/dev/tty","/dev/stdout"),l.stderr?Ui("stderr",null,l.stderr):Oo("/dev/tty1","/dev/stderr"),Yr("/dev/stdin",0),Yr("/dev/stdout",1),Yr("/dev/stderr",1)),Qa=!1,No(Ca),l.onRuntimeInitialized&&l.onRuntimeInitialized(),l.postRun)for(typeof l.postRun=="function"&&(l.postRun=[l.postRun]);l.postRun.length;){var s=l.postRun.shift();ka.unshift(s)}No(ka)}}if(!(0<vr)){if(l.preRun)for(typeof l.preRun=="function"&&(l.preRun=[l.preRun]);l.preRun.length;)Xh();No(Wa),0<vr||(l.setStatus?(l.setStatus("Running..."),setTimeout(function(){setTimeout(function(){l.setStatus("")},1),i()},1)):i())}}if(l.preInit)for(typeof l.preInit=="function"&&(l.preInit=[l.preInit]);0<l.preInit.length;)l.preInit.pop()();return cu(),E}),r)};t.exports=u,t.exports.default=u})($h);var Bl=$h.exports,_l=Rl(Bl),Fl=""+new URL("sql-wasm-785JABKZ.wasm",import.meta.url).href;const Ql="sqlitevfs",ii=new Map,Ul=2048,$l=65536;class Jl{constructor(e){F(this,"_data");F(this,"_size");this._data=e??new Uint8Array,this._size=this._data.length}get size(){return this._size}read(e,r){if(e>=this._size)return 0;const u=this._data.subarray(e,Math.min(this._size,e+r.length));return r.set(u),u.length}reserve(e){if(this._data.length>=e)return;const r=e-this._data.length,u=Math.min($l,Math.max(Ul,this._data.length)),d=new Uint8Array(this._data.length+Math.max(u,r));d.set(this._data),this._data=d}write(e,r){return this.reserve(e+r.length),this._data.set(r,e),this._size=Math.max(this._size,e+r.length),r.length}truncate(e){this._size=e}toUint8Array(){return this._data.subarray(0,this._size)}}const Vl=globalThis.indexedDB||window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.shimIndexedDB,Jh=new Promise((t,e)=>{const r=Vl.open(Ql,1);r.onupgradeneeded=()=>r.result.createObjectStore("files",{keyPath:"name"}),r.onsuccess=()=>t(r.result),r.onerror=()=>e(r.error)});async function jl(t){const e=await Jh,r=await new Promise((u,d)=>{const x=e.transaction("files","readonly").objectStore("files").get(t);x.onsuccess=()=>u(x.result),x.onerror=()=>d(x.error)});if(r&&!ii.has(t)){const u=new Jl(r.data);return ii.set(t,u),u}else return ii.has(t)?ii.get(t):null}async function Gl(t,e){const r=await Jh;await new Promise((u,d)=>{const x=r.transaction("files","readwrite").objectStore("files").put({name:t,data:e});x.onsuccess=()=>u(!0),x.onerror=()=>d(x.error)})}async function zl(t,e){if(await Gl(t,e),ii.has(t)){const r=ii.get(t);r.truncate(0),r.write(0,e)}}var Kl=class extends la{constructor(e){super();F(this,"serializer");this.serializer=e}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:u,...d}=r,m=this.serializer(u);return u===m?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...d,value:m}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Vh=t=>{if(jh(t)||typeof t=="string")return t;if(typeof t=="boolean")return""+t;if(t instanceof Date)return t.toISOString();try{return JSON.stringify(t)}catch{return t}},Hl=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/,Yl=t=>{if(jh(t))return t;if(typeof t=="string"){if(t==="true")return!0;if(t==="false")return!1;if(Hl.test(t))return new Date(t);if(t[0]==="{"&&t[t.length-1]==="}"||t[0]==="["&&t[t.length-1]==="]")try{return JSON.parse(t)}catch{}return t}};function jh(t){return t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t}var Xl=class{constructor(t={}){F(this,"transformer");F(this,"deserializer");F(this,"skipNodeSet");F(this,"ctx");const{deserializer:e=Yl,serializer:r=Vh,skipNodeKind:u=[]}=t;this.transformer=new Kl(r),this.deserializer=e,u.length&&(this.skipNodeSet=new Set(u),this.ctx=new WeakSet)}transformQuery({node:t,queryId:e}){return this.skipNodeSet?.has(t.kind)?(this.ctx?.add(e),t):this.transformer.transformNode(t)}async transformResult({result:t,queryId:e}){return this.ctx?.has(e)?t:{...t,rows:this.parseRows(t.rows)}}parseRows(t){const e=[];for(const r of t){const u={};for(const[d,m]of Object.entries(r))u[d]=this.deserializer(m);e.push(u)}return e}};function Ju(t){const{logger:e,merge:r,logQueryNode:u}=t;return d=>{const{level:m,queryDurationMillis:x,query:{parameters:E,sql:H,query:l}}=d,pe="__Q__",Z=m==="error"?d.error:void 0;let Re=H.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&E.forEach(je=>{let oe=je;je instanceof Date&&(oe=je.toLocaleString()),typeof oe=="string"&&(oe=`'${oe}'`.replace(/\?/g,pe)),Re=Re.replace(/\?/,oe)});const nt={sql:Re.replace(new RegExp(pe,"g"),"?"),params:E,duration:x,error:Z};u&&(nt.queryNode=l),e(nt)}}async function Zl(t){const{rows:e}=await t.executeQuery(Jr.raw("PRAGMA integrity_check"));if(!e.length)throw new Error("fail to check integrity");return e[0].integrity_check==="ok"}async function Vu(t,e){if(e)return await t.executeQuery(Jr.raw(`PRAGMA user_version = ${e}`)),e;const{rows:r}=await t.executeQuery(Jr.raw("PRAGMA user_version"));if(!r.length)throw new Error("fail to get DBVersion");return r[0].user_version}function ef(t){return`__pre_${t}`}function tf(t){return typeof t=="string"&&t.startsWith("__pre_")?t.slice(6):void 0}async function rf(t,e){const r=e||`sp_${Date.now()%1e8}`;return await Ce`savepoint ${Ce.raw(r)}`.execute(t),{release:async()=>{await Ce`release savepoint ${Ce.raw(r)}`.execute(t)},rollback:async()=>{await Ce`rollback to savepoint ${Ce.raw(r)}`.execute(t)}}}async function nf(t,e,r){const{release:u,rollback:d}=await rf(t,r);try{const m=await e(t);return await u(),m}catch(m){throw await d(),m}}function sf(t){return{selectFrom:e=>t().selectFrom(e),insertInto:e=>t().insertInto(e),updateTable:e=>t().updateTable(e),deleteFrom:e=>t().deleteFrom(e)}}var of=class extends Error{constructor(){super("db file maybe broken")}};function af(t){return t.toOperationNode().kind==="SelectQueryNode"}var uf=class{constructor(t){F(this,"_kysely");F(this,"trxCount",0);F(this,"trx");F(this,"logger");F(this,"executor");F(this,"serializer",Vh);const{dialect:e,logger:r,onQuery:u,plugins:d=[],serializerPluginOptions:m,executorFn:x=sf}=t;this.logger=r,m?.serializer&&(this.serializer=m.serializer),d.push(new Xl(m));let E;u===!0?E=Ju({logger:this.logger?.debug||console.log,merge:!0}):u&&(E=Ju(u)),this._kysely=new yn({dialect:e,log:E,plugins:d}),this.executor=x(()=>this.kysely)}get kysely(){return this.trx||this._kysely}async syncDB(t,e){try{if(e&&!await Zl(this._kysely))return this.logger?.error("integrity check fail"),{ready:!1,error:new of};const r=await t(this._kysely,this.logger);return this.logger?.info("table updated"),r}catch(r){return this.logError(r,"sync table fail"),{ready:!1,error:r}}}logError(t,e){e&&this.logger?.error(e,t instanceof Error?t:void 0)}async transaction(t,e={}){return this.trx?(this.trxCount++,this.logger?.debug(`run in savepoint: sp_${this.trxCount}`),await nf(this.trx,t,`sp_${this.trxCount}`).then(async r=>(await e.onCommit?.(r),r)).catch(async r=>{await e.onRollback?.(r),this.logError(r,e.errorMsg)}).finally(()=>this.trxCount--)):await this._kysely.transaction().execute(async r=>(this.trx=r,this.logger?.debug("run in transaction"),await t(r))).then(async r=>(await e.onCommit?.(r),r)).catch(async r=>{await e.onRollback?.(r),this.logError(r,e.errorMsg)}).finally(()=>this.trx=void 0)}async execute(t){return typeof t=="function"?await t(this.executor).execute():await this.kysely.executeQuery(t)}async executeTakeFirst(t){let e=t(this.executor);return af(e)&&(e=e.limit(1)),await e.executeTakeFirst()}precompile(t=e=>({kind:e.kind})){return this.logger?.debug?.("precompile"),{build:e=>{let r;const u=()=>r=null;return{[Symbol.dispose]:u,dispose:u,compile:d=>{if(!r){const{parameters:m,sql:x,query:E}=e(this.executor,ef).compile();r={sql:x,query:t(E),parameters:m}}return{...r,parameters:r.parameters.map(m=>{const x=tf(m);return x?this.serializer(d[x]):m})}}}}}}async raw(t,e){return typeof t=="string"?await this.kysely.executeQuery(Jr.raw(t,e)):await t.execute(this.kysely)}async optimize(t){await this.raw(t?"vacuum":"pragma optimize")}async destroy(){this.logger?.info("destroyed"),await this._kysely.destroy(),this.trx=void 0}},Gh="__TIME_TRIGGER__";function hf(t,e){const{create:r,update:u}=e?.timeTrigger||{},d={type:"date",defaultTo:Gh};r===!0?t.createAt=d:r&&(t[r]=d),u===!0?t.updateAt={...d,notNull:!0}:u&&(t[u]={...d,notNull:!0});const m=e?.softDelete,x={type:"int",defaultTo:0};return m===!0?t.isDeleted=x:m&&(t[m]=x),{columns:t,...e}}function zh(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function ta(t){return Array.isArray(t)?t:[t]}function df(t){return typeof t=="function"}async function Mo(t,e){await t.schema.dropTable(e).execute()}async function ju(t,e,r){const{index:u,...d}=r,m=await Hh(t,e,d);await Yh(t,e,m),await Kh(t,e,u)}async function Kh(t,e,r){for(const u of r||[]){const d=ta(u);await t.schema.createIndex(`idx_${e}_${d.join("_")}`).on(e).columns(d).ifNotExists().execute()}}async function Hh(t,e,{columns:r,primary:u,timeTrigger:d,unique:m},x=!1){const E=d?{triggerKey:"rowid",update:void 0}:void 0;let H=!1,l=t.schema.createTable(e);x&&(l=l.temporary());for(const[pe,Z]of Object.entries(r)){let Re="text";const{type:nt,notNull:je,defaultTo:oe}=Z,Gt=zh(nt);Re=Gt.dataType,l=l.addColumn(pe,Re,J=>Gt.isIncrements?(H=!0,E&&(E.triggerKey=pe),J.autoIncrement().primaryKey()):oe===Gh?(E&&je&&(E.update=pe),J.defaultTo(Ce`CURRENT_TIMESTAMP`)):(je===!0&&(J=J.notNull()),oe!==void 0&&(J=J.defaultTo(df(oe)?oe(Ce):oe)),J))}if(!H&&u){const pe=ta(u);l=l.addPrimaryKeyConstraint(`pk#${pe.join("#")}`,pe)}for(const pe of m||[]){const Z=ta(pe);l=l.addUniqueConstraint(`un#${Z.join("#")}`,Z)}return await l.ifNotExists().execute(),E}async function Yh(t,e,r){if(!r||!r.update)return;const{triggerKey:u,update:d}=r,m=`tgr_${e}_${d}`;await Ce`create trigger if not exists ${Ce.ref(m)}
after update
on ${Ce.table(e)}
begin
  update ${Ce.table(e)}
  set ${Ce.ref(d)} = CURRENT_TIMESTAMP
  where ${Ce.ref(u)} = NEW.${Ce.ref(u)};
end`.execute(t)}async function cf(t,e,r){await t.schema.alterTable(e).renameTo(r).execute()}function lf(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/gi,[,u,d]=t.replace(/\r?\n/g,"").match(e),m={columns:{},name:u,primary:void 0,unique:[]},x=d.matchAll(r);for(const E of x){const[,H,l,pe]=E;if(H.startsWith("pk#")){const[,...Z]=H.split("#");m.primary=Z}else if(H.startsWith("un#")){const[,...Z]=H.split("#");m.unique.push(Z)}else m.columns[H]={type:l,notNull:!!pe}}return m}async function ff(t,e=[]){const r=await t.selectFrom("sqlite_master").where("type","in",["table","trigger","index"]).where("name","!=",Fh).where("name","!=",Qh).where("name","not like","sqlite_%").$if(!!e.length,d=>d.where(m=>m.and(e.map(x=>m("name","not like",`${x}%`))))).select(["name","sql","type"]).$castTo().execute(),u={existTables:{},indexList:[],triggerList:[]};for(const{name:d,sql:m,type:x}of r)m&&(x==="table"?u.existTables[d]=lf(m):x==="index"?u.indexList.push(d):u.triggerList.push(d));return u}async function pf(t,e,r={},u){const{truncateIfExists:d=[],log:m,version:{current:x,skipSyncWhenSame:E}={},excludeTablePrefix:H,onSyncSuccess:l,onSyncFail:pe}=r;if(x){if(E&&x===await Vu(t))return{ready:!0};await Vu(t,x)}const Z=J=>m&&u?.debug(J),{existTables:Re,indexList:nt,triggerList:je}=await ff(t,H);Z("====== update tables start ======");const oe=new Set(Array.isArray(d)?d:d?Object.keys(Re):[]);return await t.transaction().execute(async J=>{for(const j of nt)await J.schema.dropIndex(j).ifExists().execute();for(const j of je)await Ce`drop trigger if exists ${Ce.ref(j)}`.execute(J);for(const[j,wt]of Object.entries(Re))if(!(j in e))Z(`remove table: ${j}`),await Mo(J,j);else{Z(`diff table: ${j}`);try{await Gt(J,j,wt,e[j])}catch(vt){throw u?.error(`fail to sync ${j}`,vt),vt}}for(const[j,wt]of Object.entries(e))j in Re||(Z(`create table: ${j}`),await ju(J,j,wt))}).then(()=>(l?.(t),Z("======= update tables success ======="),{ready:!0})).catch(J=>(pe?.(J),Z("======= update tables fail ======="),{ready:!1,error:J}));async function Gt(J,j,wt,vt){if(oe.has(j)){await Mo(J,j),await ju(J,j,vt),Z("clear and sync structure");return}const{index:Mn,...Tt}=vt,at=mf(wt.columns,vt.columns);if(at.length===Object.keys(wt.columns).length){Z("same table structure, skip");return}Z("different table structure, update");const zt=`_temp_${j}`,Pn=await Hh(J,zt,Tt);at.length&&await J.insertInto(zt).columns(at).expression(we=>we.selectFrom(j).select(at)).execute(),await Mo(J,j),await cf(J,zt,j),await Kh(J,j,Mn),await Yh(J,j,Pn),Z(`restore columns: ${at}`)}}function mf(t,e){const r=[];for(const[u,d]of Object.entries(e))u in t&&zh(d.type).dataType===t[u].type&&(d.notNull||!1)===(t[u].notNull||!1)&&r.push(u);return r}function yf(t,e={}){const{log:r}=e;return(u,d)=>pf(u,t,e,r?d:void 0)}const Nf={test:hf({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function wf(t){const e=new uf({dialect:t}),r=await e.syncDB(yf(Nf));if(!r.ready)throw r.error;console.log(await e.raw("PRAGMA table_info('test')"));for(let u=0;u<10;u++)await e.transaction(async()=>{await e.transaction(async()=>{if(u>8)throw console.log("test rollback"),new Error("test rollback");await e.execute(d=>d.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}))})});return e.execute(u=>u.selectFrom("test").selectAll()).then(async u=>(await e.destroy(),console.log(u),u))}const vf=new Dl({async database(){const t=await _l({locateFile:()=>Fl});return new t.Database(await jl("sqljsWorker"))},onWrite:{func(t){console.log(`[sqljs worker] write to indexeddb, length: ${t.length}`),zl("sqljsWorker",t)}}});onmessage=()=>{console.log("start sqljs worker test"),wf(vf).then(t=>{t?.forEach(e=>console.log("[sqljs Worker]",e))})};
