var au=Object.defineProperty;var lu=(t,e,r)=>e in t?au(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Qe=(t,e,r)=>(lu(t,typeof e!="symbol"?e+"":e,r),r),po=(t,e,r)=>{if(!e.has(t))throw TypeError("Cannot "+r)};var s=(t,e,r)=>(po(t,e,"read from private field"),r?r.call(t):e.get(t)),Q=(t,e,r)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,r)},X=(t,e,r,n)=>(po(t,e,"write to private field"),n?n.call(t,r):e.set(t,r),r);var Pe=(t,e,r)=>(po(t,e,"access private method"),r);function dr(t){return typeof t>"u"||t===void 0}function zt(t){return typeof t=="string"}function Ya(t){return typeof t=="number"}function ns(t){return typeof t=="boolean"}function Lo(t){return t===null}function cu(t){return t instanceof Date}function uu(t){return typeof t=="bigint"}function Rt(t){return typeof t=="function"}function on(t){return typeof t=="object"&&t!==null}function h(t){return Object.freeze(t)}function Hi(t){return qn(t)?t:[t]}function qn(t){return Array.isArray(t)}function Ln(t){return t}const Ve=h({is(t){return t.kind==="AlterTableNode"},create(t){return h({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return h({...t,...e})},cloneWithColumnAlteration(t,e){return h({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),Xe=h({is(t){return t.kind==="IdentifierNode"},create(t){return h({kind:"IdentifierNode",name:t})}}),fn=h({is(t){return t.kind==="CreateIndexNode"},create(t){return h({kind:"CreateIndexNode",name:Xe.create(t)})},cloneWith(t,e){return h({...t,...e})},cloneWithColumns(t,e){return h({...t,columns:[...t.columns||[],...e]})}}),Za=h({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return h({kind:"CreateSchemaNode",schema:Xe.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),du=["preserve rows","delete rows","drop"],Ct=h({is(t){return t.kind==="CreateTableNode"},create(t){return h({kind:"CreateTableNode",table:t,columns:h([])})},cloneWithColumn(t,e){return h({...t,columns:h([...t.columns,e])})},cloneWithConstraint(t,e){return h({...t,constraints:t.constraints?h([...t.constraints,e]):h([e])})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):h([e])})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):h([e])})},cloneWith(t,e){return h({...t,...e})}}),Bn=h({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return h({kind:"SchemableIdentifierNode",identifier:Xe.create(t)})},createWithSchema(t,e){return h({kind:"SchemableIdentifierNode",schema:Xe.create(t),identifier:Xe.create(e)})}}),ii=h({is(t){return t.kind==="DropIndexNode"},create(t,e){return h({kind:"DropIndexNode",name:Bn.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),yo=h({is(t){return t.kind==="DropSchemaNode"},create(t,e){return h({kind:"DropSchemaNode",schema:Xe.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),go=h({is(t){return t.kind==="DropTableNode"},create(t,e){return h({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return h({...t,...e})}}),jn=h({is(t){return t.kind==="AliasNode"},create(t,e){return h({kind:"AliasNode",node:t,alias:e})}}),Rn=h({is(t){return t.kind==="TableNode"},create(t){return h({kind:"TableNode",table:Bn.create(t)})},createWithSchema(t,e){return h({kind:"TableNode",table:Bn.createWithSchema(t,e)})}});function Bt(t){return on(t)&&Rt(t.toOperationNode)}function fu(t){return on(t)&&"expressionType"in t&&Bt(t)}function hu(t){return on(t)&&"expression"in t&&zt(t.alias)&&Bt(t)}const dn=h({is(t){return t.kind==="SelectModifierNode"},create(t,e){return h({kind:"SelectModifierNode",modifier:t,of:e})},createWithExpression(t){return h({kind:"SelectModifierNode",rawModifier:t})}}),Mn=h({is(t){return t.kind==="AndNode"},create(t,e){return h({kind:"AndNode",left:t,right:e})}}),Gr=h({is(t){return t.kind==="OrNode"},create(t,e){return h({kind:"OrNode",left:t,right:e})}}),mo=h({is(t){return t.kind==="OnNode"},create(t){return h({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return h({...t,on:e==="And"?Mn.create(t.on,r):Gr.create(t.on,r)})}}),si=h({is(t){return t.kind==="JoinNode"},create(t,e){return h({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return h({kind:"JoinNode",joinType:t,table:e,on:mo.create(r)})},cloneWithOn(t,e){return h({...t,on:t.on?mo.cloneWithOperation(t.on,"And",e):mo.create(e)})}}),Vr=h({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return h({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),pu=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],mu=["+","-","*","/","%","^","&","|","#","<<",">>"],el=["->","->>"],_u=[...pu,...mu,"&&","||"],yu=["exists","not exists"],gu=["not","-",...yu],wu=[..._u,...el,...gu,"between","between symmetric"],Qn=h({is(t){return t.kind==="OperatorNode"},create(t){return h({kind:"OperatorNode",operator:t})}});function xa(t){return zt(t)&&el.includes(t)}const it=h({is(t){return t.kind==="ColumnNode"},create(t){return h({kind:"ColumnNode",column:Xe.create(t)})}}),Ro=h({is(t){return t.kind==="SelectAllNode"},create(){return h({kind:"SelectAllNode"})}}),no=h({is(t){return t.kind==="ReferenceNode"},create(t,e){return h({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return h({kind:"ReferenceNode",table:t,column:Ro.create()})}});var Er;class bu{constructor(e){Q(this,Er,void 0);X(this,Er,e)}get dynamicReference(){return s(this,Er)}get refType(){}toOperationNode(){return sl(s(this,Er))}}Er=new WeakMap;function tl(t){return on(t)&&Bt(t)&&zt(t.dynamicReference)}const wo=h({is(t){return t.kind==="OrderByItemNode"},create(t,e){return h({kind:"OrderByItemNode",orderBy:t,direction:e})}}),bt=h({is(t){return t.kind==="RawNode"},create(t,e){return h({kind:"RawNode",sqlFragments:h(t),parameters:h(e)})},createWithSql(t){return bt.create([t],[])},createWithChild(t){return bt.create(["",""],[t])},createWithChildren(t){return bt.create(new Array(t.length+1).fill(""),t)}});function nl(t){return t==="asc"||t==="desc"}function ro(t){if(t.length===2)return[_o(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>_o(r)):[_o(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function _o(t,e){const r=qu(t);if(wo.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return wo.create(r,rl(e))}function qu(t){if(Mi(t))return hr(t);if(tl(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!nl(r))throw new Error(`Invalid order by direction: ${r}`);return wo.create(Nn(e),rl(r))}return Nn(t)}function rl(t){if(t)return t==="asc"||t==="desc"?bt.createWithSql(t):t.toOperationNode()}const rs=h({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return h({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return h({...t,traversal:e})}}),il=h({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return h({kind:"JSONOperatorChainNode",operator:t,values:h([])})},cloneWithValue(t,e){return h({...t,values:h([...t.values,e])})}}),oi=h({is(t){return t.kind==="JSONPathNode"},create(t){return h({kind:"JSONPathNode",inOperator:t,pathLegs:h([])})},cloneWithLeg(t,e){return h({...t,pathLegs:h([...t.pathLegs,e])})}});function sl(t){return zt(t)?Nn(t):t.toOperationNode()}function yi(t){return qn(t)?t.map(e=>jt(e)):[jt(t)]}function jt(t){return Mi(t)?hr(t):sl(t)}function Nu(t,e){const r=Nn(t);if(xa(e))return rs.create(r,il.create(Qn.create(e)));const n=e.slice(0,-1);if(xa(n))return rs.create(r,oi.create(Qn.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function Nn(t){const e=".";if(!t.includes(e))return no.create(it.create(t));const r=t.split(e).map(Bo);if(r.length===3)return xu(r);if(r.length===2)return Eu(r);throw new Error(`invalid column reference ${t}`)}function vu(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(Bo);return jn.create(Nn(r),Xe.create(n))}else return Nn(t)}function ol(t){return it.create(t)}function is(t){const e=" ";if(t.includes(e)){const[r,n]=t.split(e).map(Bo);if(!nl(n))throw new Error(`invalid order direction "${n}" next to "${r}"`);return ro([r,n])[0]}else return ol(t)}function xu(t){const[e,r,n]=t;return no.create(it.create(n),Rn.createWithSchema(e,r))}function Eu(t){const[e,r]=t;return no.create(it.create(r),Rn.create(e))}function Bo(t){return t.trim()}const al=h({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return h({kind:"PrimitiveValueListNode",values:h([...t])})}}),Mo=h({is(t){return t.kind==="ValueListNode"},create(t){return h({kind:"ValueListNode",values:h(t)})}}),vn=h({is(t){return t.kind==="ValueNode"},create(t){return h({kind:"ValueNode",value:t})},createImmediate(t){return h({kind:"ValueNode",value:t,immediate:!0})}});function Su(t){return qn(t)?Iu(t):ut(t)}function ut(t){return Mi(t)?hr(t):vn.create(t)}function Qo(t){return Ya(t)||ns(t)||Lo(t)}function Uo(t){if(!Qo(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return vn.createImmediate(t)}function Iu(t){return t.some(Mi)?Mo.create(t.map(e=>ut(e))):al.create(t)}const Hr=h({is(t){return t.kind==="ParensNode"},create(t){return h({kind:"ParensNode",node:t})}});function qt(t){if(t.length===3)return jo(t[0],t[1],t[2]);if(t.length===1)return ut(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function jo(t,e,r){return Au(e)&&ll(r)?Vr.create(jt(t),qo(e),vn.createImmediate(r)):Vr.create(jt(t),qo(e),Su(r))}function xn(t,e,r){return Vr.create(jt(t),qo(e),jt(r))}function Ea(t,e){return bo(Object.entries(t).filter(([,r])=>!dr(r)).map(([r,n])=>jo(r,ll(n)?"is":"=",n)),e)}function bo(t,e){const r=e==="and"?Mn.create:Gr.create;if(t.length===0)return Vr.create(vn.createImmediate(1),Qn.create("="),vn.createImmediate(e==="and"?1:0));let n=Sa(t[0]);for(let A=1;A<t.length;++A)n=r(n,Sa(t[A]));return t.length>1?Hr.create(n):n}function Au(t){return t==="is"||t==="is not"}function ll(t){return Lo(t)||ns(t)}function qo(t){if(zt(t)&&wu.includes(t))return Qn.create(t);if(Bt(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function Sa(t){return Bt(t)?t.toOperationNode():t}const $r=h({is(t){return t.kind==="OrderByNode"},create(t){return h({kind:"OrderByNode",items:h([...t])})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),Ia=h({is(t){return t.kind==="PartitionByNode"},create(t){return h({kind:"PartitionByNode",items:h(t)})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),No=h({is(t){return t.kind==="OverNode"},create(){return h({kind:"OverNode"})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?$r.cloneWithItems(t.orderBy,e):$r.create(e)})},cloneWithPartitionByItems(t,e){return h({...t,partitionBy:t.partitionBy?Ia.cloneWithItems(t.partitionBy,e):Ia.create(e)})}}),ss=h({is(t){return t.kind==="FromNode"},create(t){return h({kind:"FromNode",froms:h(t)})},cloneWithFroms(t,e){return h({...t,froms:h([...t.froms,...e])})}}),Aa=h({is(t){return t.kind==="GroupByNode"},create(t){return h({kind:"GroupByNode",items:h(t)})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),ka=h({is(t){return t.kind==="HavingNode"},create(t){return h({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return h({...t,having:e==="And"?Mn.create(t.having,r):Gr.create(t.having,r)})}}),Oe=h({is(t){return t.kind==="SelectQueryNode"},create(t){return h({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return h({kind:"SelectQueryNode",from:ss.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return h({...t,selections:t.selections?h([...t.selections,...e]):h(e)})},cloneWithDistinctOn(t,e){return h({...t,distinctOn:t.distinctOn?h([...t.distinctOn,...e]):h(e)})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):h([e])})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):h([e])})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?$r.cloneWithItems(t.orderBy,e):$r.create(e)})},cloneWithGroupByItems(t,e){return h({...t,groupBy:t.groupBy?Aa.cloneWithItems(t.groupBy,e):Aa.create(e)})},cloneWithLimit(t,e){return h({...t,limit:e})},cloneWithOffset(t,e){return h({...t,offset:e})},cloneWithHaving(t,e){return h({...t,having:t.having?ka.cloneWithOperation(t.having,"And",e):ka.create(e)})},cloneWithSetOperations(t,e){return h({...t,setOperations:t.setOperations?h([...t.setOperations,...e]):h([...e])})},cloneWithoutSelections(t){return h({...t,selections:[]})},cloneWithoutLimit(t){return h({...t,limit:void 0})},cloneWithoutOffset(t){return h({...t,offset:void 0})},cloneWithoutOrderBy(t){return h({...t,orderBy:void 0})}});function ke(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}var Ht;const ui=class ui{constructor(e){Q(this,Ht,void 0);X(this,Ht,h(e))}on(...e){return new ui({...s(this,Ht),joinNode:si.cloneWithOn(s(this,Ht).joinNode,qt(e))})}onRef(e,r,n){return new ui({...s(this,Ht),joinNode:si.cloneWithOn(s(this,Ht).joinNode,xn(e,r,n))})}onTrue(){return new ui({...s(this,Ht),joinNode:si.cloneWithOn(s(this,Ht).joinNode,bt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return s(this,Ht).joinNode}};Ht=new WeakMap;let os=ui;ke(os,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const ku=h({is(t){return t.kind==="PartitionByItemNode"},create(t){return h({kind:"PartitionByItemNode",partitionBy:t})}});function Ou(t){return yi(t).map(ku.create)}var Yn;const Fs=class Fs{constructor(e){Q(this,Yn,void 0);X(this,Yn,h(e))}orderBy(e,r){return new Fs({overNode:No.cloneWithOrderByItems(s(this,Yn).overNode,ro([e,r]))})}partitionBy(e){return new Fs({overNode:No.cloneWithPartitionByItems(s(this,Yn).overNode,Ou(e))})}$call(e){return e(this)}toOperationNode(){return s(this,Yn).overNode}};Yn=new WeakMap;let as=Fs;ke(as,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const ai=h({is(t){return t.kind==="SelectionNode"},create(t){return h({kind:"SelectionNode",selection:t})},createSelectAll(){return h({kind:"SelectionNode",selection:Ro.create()})},createSelectAllFromTable(t){return h({kind:"SelectionNode",selection:no.createSelectAll(t)})}});function Kr(t){return Rt(t)?Kr(t(Xr())):qn(t)?t.map(e=>Oa(e)):[Oa(t)]}function Oa(t){return zt(t)?ai.create(vu(t)):tl(t)?ai.create(t.toOperationNode()):ai.create(vl(t))}function Ri(t){return t?Array.isArray(t)?t.map(Ta):[Ta(t)]:[ai.createSelectAll()]}function Ta(t){if(zt(t))return ai.createSelectAllFromTable(rt(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const Tu=h({is(t){return t.kind==="ValuesNode"},create(t){return h({kind:"ValuesNode",values:h(t)})}}),Cu=h({is(t){return t.kind==="DefaultInsertValueNode"},create(){return h({kind:"DefaultInsertValueNode"})}});function Pu(t){const e=Rt(t)?t(Xr()):t,r=qn(e)?e:h([e]);return Fu(r)}function Fu(t){const e=Wu(t);return[h([...e.keys()].map(it.create)),Tu.create(t.map(r=>Du(r,e)))]}function Wu(t){const e=new Map;for(const r of t){const n=Object.keys(r);for(const A of n)!e.has(A)&&r[A]!==void 0&&e.set(A,e.size)}return e}function Du(t,e){const r=Object.keys(t),n=Array.from({length:e.size});let A=!1;for(const re of r){const Se=e.get(re);if(dr(Se))continue;const Le=t[re];(dr(Le)||Mi(Le))&&(A=!0),n[Se]=Le}if(r.length<e.size||A){const re=Cu.create();return Mo.create(n.map(Se=>dr(Se)?re:ut(Se)))}return al.create(n)}const Yt=h({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return h({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return h({...t,...e})}}),ls=h({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return h({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return h({...t,from:t.from?ss.cloneWithFroms(t.from,e):ss.create(e)})},cloneWithUpdates(t,e){return h({...t,updates:t.updates?h([...t.updates,...e]):e})}}),Ca=h({is(t){return t.kind==="UsingNode"},create(t){return h({kind:"UsingNode",tables:h(t)})},cloneWithTables(t,e){return h({...t,tables:h([...t.tables,...e])})}}),li=h({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return h({kind:"DeleteQueryNode",from:ss.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?$r.cloneWithItems(t.orderBy,e):$r.create(e)})},cloneWithLimit(t,e){return h({...t,limit:e})},cloneWithUsing(t,e){return h({...t,using:t.using!==void 0?Ca.cloneWithTables(t.using,e):Ca.create(e)})}}),At=h({is(t){return t.kind==="WhereNode"},create(t){return h({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return h({...t,where:e==="And"?Mn.create(t.where,r):Gr.create(t.where,r)})}}),Pa=h({is(t){return t.kind==="ReturningNode"},create(t){return h({kind:"ReturningNode",selections:h(t)})},cloneWithSelections(t,e){return h({...t,selections:t.selections?h([...t.selections,...e]):h(e)})}}),Lu=h({is(t){return t.kind==="ExplainNode"},create(t,e){return h({kind:"ExplainNode",format:t,options:e})}}),Ie=h({is(t){return Oe.is(t)||Yt.is(t)||ls.is(t)||li.is(t)},cloneWithWhere(t,e){return h({...t,where:t.where?At.cloneWithOperation(t.where,"And",e):At.create(e)})},cloneWithJoin(t,e){return h({...t,joins:t.joins?h([...t.joins,e]):h([e])})},cloneWithReturning(t,e){return h({...t,returning:t.returning?Pa.cloneWithSelections(t.returning,e):Pa.create(e)})},cloneWithoutWhere(t){return h({...t,where:void 0})},cloneWithExplain(t,e,r){return h({...t,explain:Lu.create(e,r?.toOperationNode())})}}),cl=h({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return h({kind:"ColumnUpdateNode",column:t,value:e})}});function Ru(...t){return t.length===2?[cl.create(jt(t[0]),ut(t[1]))]:zo(t[0])}function zo(t){const e=Rt(t)?t(Xr()):t;return Object.entries(e).filter(([r,n])=>n!==void 0).map(([r,n])=>cl.create(it.create(r),ut(n)))}const Bu=h({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return h({kind:"OnDuplicateKeyNode",updates:t})}});class Mu{constructor(e,r){Qe(this,"insertId");Qe(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class io extends Error{constructor(r){super("no result");Qe(this,"node");this.node=r}}function so(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Lt=h({is(t){return t.kind==="OnConflictNode"},create(){return h({kind:"OnConflictNode"})},cloneWith(t,e){return h({...t,...e})},cloneWithIndexWhere(t,e){return h({...t,indexWhere:t.indexWhere?At.cloneWithOperation(t.indexWhere,"And",e):At.create(e)})},cloneWithIndexOrWhere(t,e){return h({...t,indexWhere:t.indexWhere?At.cloneWithOperation(t.indexWhere,"Or",e):At.create(e)})},cloneWithUpdateWhere(t,e){return h({...t,updateWhere:t.updateWhere?At.cloneWithOperation(t.updateWhere,"And",e):At.create(e)})},cloneWithUpdateOrWhere(t,e){return h({...t,updateWhere:t.updateWhere?At.cloneWithOperation(t.updateWhere,"Or",e):At.create(e)})},cloneWithoutIndexWhere(t){return h({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return h({...t,updateWhere:void 0})}});var Je;const pn=class pn{constructor(e){Q(this,Je,void 0);X(this,Je,h(e))}column(e){const r=it.create(e);return new pn({...s(this,Je),onConflictNode:Lt.cloneWith(s(this,Je).onConflictNode,{columns:s(this,Je).onConflictNode.columns?h([...s(this,Je).onConflictNode.columns,r]):h([r])})})}columns(e){const r=e.map(it.create);return new pn({...s(this,Je),onConflictNode:Lt.cloneWith(s(this,Je).onConflictNode,{columns:s(this,Je).onConflictNode.columns?h([...s(this,Je).onConflictNode.columns,...r]):h(r)})})}constraint(e){return new pn({...s(this,Je),onConflictNode:Lt.cloneWith(s(this,Je).onConflictNode,{constraint:Xe.create(e)})})}expression(e){return new pn({...s(this,Je),onConflictNode:Lt.cloneWith(s(this,Je).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new pn({...s(this,Je),onConflictNode:Lt.cloneWithIndexWhere(s(this,Je).onConflictNode,qt(e))})}whereRef(e,r,n){return new pn({...s(this,Je),onConflictNode:Lt.cloneWithIndexWhere(s(this,Je).onConflictNode,xn(e,r,n))})}clearWhere(){return new pn({...s(this,Je),onConflictNode:Lt.cloneWithoutIndexWhere(s(this,Je).onConflictNode)})}doNothing(){return new ul({...s(this,Je),onConflictNode:Lt.cloneWith(s(this,Je).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new us({...s(this,Je),onConflictNode:Lt.cloneWith(s(this,Je).onConflictNode,{updates:zo(e)})})}$call(e){return e(this)}};Je=new WeakMap;let cs=pn;ke(cs,"don't await OnConflictBuilder instances.");var xi;class ul{constructor(e){Q(this,xi,void 0);X(this,xi,h(e))}toOperationNode(){return s(this,xi).onConflictNode}}xi=new WeakMap;ke(ul,"don't await OnConflictDoNothingBuilder instances.");var $t;const di=class di{constructor(e){Q(this,$t,void 0);X(this,$t,h(e))}where(...e){return new di({...s(this,$t),onConflictNode:Lt.cloneWithUpdateWhere(s(this,$t).onConflictNode,qt(e))})}whereRef(e,r,n){return new di({...s(this,$t),onConflictNode:Lt.cloneWithUpdateWhere(s(this,$t).onConflictNode,xn(e,r,n))})}clearWhere(){return new di({...s(this,$t),onConflictNode:Lt.cloneWithoutUpdateWhere(s(this,$t).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return s(this,$t).onConflictNode}};$t=new WeakMap;let us=di;ke(us,"don't await OnConflictUpdateBuilder instances.");var ve;const pt=class pt{constructor(e){Q(this,ve,void 0);X(this,ve,h(e))}values(e){const[r,n]=Pu(e);return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{columns:r,values:n})})}columns(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{columns:h(e.map(it.create))})})}expression(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{values:hr(e)})})}defaultValues(){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{defaultValues:!0})})}ignore(){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{ignore:!0})})}onConflict(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{onConflict:e(new cs({onConflictNode:Lt.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new pt({...s(this,ve),queryNode:Yt.cloneWith(s(this,ve).queryNode,{onDuplicateKey:Bu.create(zo(e))})})}returning(e){return new pt({...s(this,ve),queryNode:Ie.cloneWithReturning(s(this,ve).queryNode,Kr(e))})}returningAll(){return new pt({...s(this,ve),queryNode:Ie.cloneWithReturning(s(this,ve).queryNode,Ri())})}$call(e){return e(this)}$if(e,r){return e?r(this):new pt({...s(this,ve)})}$castTo(){return new pt(s(this,ve))}$narrowType(){return new pt(s(this,ve))}$assertType(){return new pt(s(this,ve))}withPlugin(e){return new pt({...s(this,ve),executor:s(this,ve).executor.withPlugin(e)})}toOperationNode(){return s(this,ve).executor.transformQuery(s(this,ve).queryNode,s(this,ve).queryId)}compile(){return s(this,ve).executor.compileQuery(this.toOperationNode(),s(this,ve).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,ve).executor.executeQuery(e,s(this,ve).queryId);return s(this,ve).executor.adapter.supportsReturning&&r.returning?n.rows:[new Mu(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=io){const r=await this.executeTakeFirst();if(r===void 0)throw so(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,ve).executor.stream(r,e,s(this,ve).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new pt({...s(this,ve),queryNode:Ie.cloneWithExplain(s(this,ve).queryNode,e,r)}).execute()}};ve=new WeakMap;let gi=pt;ke(gi,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Qu{constructor(e){Qe(this,"numDeletedRows");this.numDeletedRows=e}}const dl=h({is(t){return t.kind==="LimitNode"},create(t){return h({kind:"LimitNode",limit:t})}});var _e;const st=class st{constructor(e){Q(this,_e,void 0);X(this,_e,h(e))}where(...e){return new st({...s(this,_e),queryNode:Ie.cloneWithWhere(s(this,_e).queryNode,qt(e))})}whereRef(e,r,n){return new st({...s(this,_e),queryNode:Ie.cloneWithWhere(s(this,_e).queryNode,xn(e,r,n))})}clearWhere(){return new st({...s(this,_e),queryNode:Ie.cloneWithoutWhere(s(this,_e).queryNode)})}using(e){return new st({...s(this,_e),queryNode:li.cloneWithUsing(s(this,_e).queryNode,wi(e))})}innerJoin(...e){return new st({...s(this,_e),queryNode:Ie.cloneWithJoin(s(this,_e).queryNode,kt("InnerJoin",e))})}leftJoin(...e){return new st({...s(this,_e),queryNode:Ie.cloneWithJoin(s(this,_e).queryNode,kt("LeftJoin",e))})}rightJoin(...e){return new st({...s(this,_e),queryNode:Ie.cloneWithJoin(s(this,_e).queryNode,kt("RightJoin",e))})}fullJoin(...e){return new st({...s(this,_e),queryNode:Ie.cloneWithJoin(s(this,_e).queryNode,kt("FullJoin",e))})}returning(e){return new st({...s(this,_e),queryNode:Ie.cloneWithReturning(s(this,_e).queryNode,Kr(e))})}returningAll(e){return new st({...s(this,_e),queryNode:Ie.cloneWithReturning(s(this,_e).queryNode,Ri(e))})}orderBy(e,r){return new st({...s(this,_e),queryNode:li.cloneWithOrderByItems(s(this,_e).queryNode,ro([e,r]))})}limit(e){return new st({...s(this,_e),queryNode:li.cloneWithLimit(s(this,_e).queryNode,dl.create(ut(e)))})}$call(e){return e(this)}$if(e,r){return e?r(this):new st({...s(this,_e)})}$castTo(){return new st(s(this,_e))}$narrowType(){return new st(s(this,_e))}$assertType(){return new st(s(this,_e))}withPlugin(e){return new st({...s(this,_e),executor:s(this,_e).executor.withPlugin(e)})}toOperationNode(){return s(this,_e).executor.transformQuery(s(this,_e).queryNode,s(this,_e).queryId)}compile(){return s(this,_e).executor.compileQuery(this.toOperationNode(),s(this,_e).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,_e).executor.executeQuery(e,s(this,_e).queryId);return s(this,_e).executor.adapter.supportsReturning&&r.returning?n.rows:[new Qu(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=io){const r=await this.executeTakeFirst();if(r===void 0)throw so(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,_e).executor.stream(r,e,s(this,_e).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new st({...s(this,_e),queryNode:Ie.cloneWithExplain(s(this,_e).queryNode,e,r)}).execute()}};_e=new WeakMap;let ds=st;ke(ds,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class Uu{constructor(e,r){Qe(this,"numUpdatedRows");Qe(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}var we;const at=class at{constructor(e){Q(this,we,void 0);X(this,we,h(e))}where(...e){return new at({...s(this,we),queryNode:Ie.cloneWithWhere(s(this,we).queryNode,qt(e))})}whereRef(e,r,n){return new at({...s(this,we),queryNode:Ie.cloneWithWhere(s(this,we).queryNode,xn(e,r,n))})}clearWhere(){return new at({...s(this,we),queryNode:Ie.cloneWithoutWhere(s(this,we).queryNode)})}from(e){return new at({...s(this,we),queryNode:ls.cloneWithFromItems(s(this,we).queryNode,wi(e))})}innerJoin(...e){return new at({...s(this,we),queryNode:Ie.cloneWithJoin(s(this,we).queryNode,kt("InnerJoin",e))})}leftJoin(...e){return new at({...s(this,we),queryNode:Ie.cloneWithJoin(s(this,we).queryNode,kt("LeftJoin",e))})}rightJoin(...e){return new at({...s(this,we),queryNode:Ie.cloneWithJoin(s(this,we).queryNode,kt("RightJoin",e))})}fullJoin(...e){return new at({...s(this,we),queryNode:Ie.cloneWithJoin(s(this,we).queryNode,kt("FullJoin",e))})}set(...e){return new at({...s(this,we),queryNode:ls.cloneWithUpdates(s(this,we).queryNode,Ru(...e))})}returning(e){return new at({...s(this,we),queryNode:Ie.cloneWithReturning(s(this,we).queryNode,Kr(e))})}returningAll(){return new at({...s(this,we),queryNode:Ie.cloneWithReturning(s(this,we).queryNode,Ri())})}$call(e){return e(this)}$if(e,r){return e?r(this):new at({...s(this,we)})}$castTo(){return new at(s(this,we))}$narrowType(){return new at(s(this,we))}$assertType(){return new at(s(this,we))}withPlugin(e){return new at({...s(this,we),executor:s(this,we).executor.withPlugin(e)})}toOperationNode(){return s(this,we).executor.transformQuery(s(this,we).queryNode,s(this,we).queryId)}compile(){return s(this,we).executor.compileQuery(this.toOperationNode(),s(this,we).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,we).executor.executeQuery(e,s(this,we).queryId);return s(this,we).executor.adapter.supportsReturning&&r.returning?n.rows:[new Uu(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=io){const r=await this.executeTakeFirst();if(r===void 0)throw so(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,we).executor.stream(r,e,s(this,we).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new at({...s(this,we),queryNode:Ie.cloneWithExplain(s(this,we).queryNode,e,r)}).execute()}};we=new WeakMap;let fs=at;ke(fs,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const Fa=h({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return h({kind:"CommonTableExpressionNameNode",table:Rn.create(t),columns:e?h(e.map(it.create)):void 0})}}),hs=h({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return h({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return h({...t,...e})}});var mn;const Ws=class Ws{constructor(e){Q(this,mn,void 0);X(this,mn,h(e))}materialized(){return new Ws({...s(this,mn),node:hs.cloneWith(s(this,mn).node,{materialized:!0})})}notMaterialized(){return new Ws({...s(this,mn),node:hs.cloneWith(s(this,mn).node,{materialized:!1})})}toOperationNode(){return s(this,mn).node}};mn=new WeakMap;let ps=Ws;ke(ps,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function Wa(t,e){const r=e(Yu()).toOperationNode();return Rt(t)?t(ju(r)).toOperationNode():hs.create(fl(t),r)}function ju(t){return e=>new ps({node:hs.create(fl(e),t)})}function fl(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],n=e[1].split(",").map(A=>A.trim());return Fa.create(r,n)}else return Fa.create(t)}const $i=h({is(t){return t.kind==="WithNode"},create(t,e){return h({kind:"WithNode",expressions:h([t]),...e})},cloneWithExpression(t,e){return h({...t,expressions:h([...t.expressions,e])})}}),Da=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function zu(t){let e="";for(let r=0;r<t;++r)e+=Vu();return e}function Vu(){return Da[~~(Math.random()*Da.length)]}function $e(){return new Hu}var Sr;class Hu{constructor(){Q(this,Sr,void 0)}get queryId(){return s(this,Sr)===void 0&&X(this,Sr,zu(8)),s(this,Sr)}}Sr=new WeakMap;var Ds;class Vo{constructor(){Qe(this,"nodeStack",[]);Q(this,Ds,h({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),AddIndexNode:this.transformAddIndex.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),h(r)}transformNodeImpl(e){return s(this,Ds)[e.kind](e)}transformNodeList(e){return e&&h(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:h([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}Ds=new WeakMap;const $u=h({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});var Ir,Zn,er,Ls,hl,Rs,pl,Bs,ml,tr,ri,Ei,vo,Ms,_l;class Ju extends Vo{constructor(r){super();Q(this,Ls);Q(this,Rs);Q(this,Bs);Q(this,tr);Q(this,Ei);Q(this,Ms);Q(this,Ir,void 0);Q(this,Zn,new Set);Q(this,er,new Set);X(this,Ir,r)}transformNodeImpl(r){if(!Pe(this,Ls,hl).call(this,r))return super.transformNodeImpl(r);const n=Pe(this,Bs,ml).call(this,r);for(const re of n)s(this,er).add(re);const A=Pe(this,Rs,pl).call(this,r);for(const re of A)s(this,Zn).add(re);const V=super.transformNodeImpl(r);for(const re of A)s(this,Zn).delete(re);for(const re of n)s(this,er).delete(re);return V}transformSchemableIdentifier(r){const n=super.transformSchemableIdentifier(r);return n.schema||!s(this,Zn).has(r.identifier.name)?n:{...n,schema:Xe.create(s(this,Ir))}}transformReferences(r){const n=super.transformReferences(r);return n.table.table.schema?n:{...n,table:Rn.createWithSchema(s(this,Ir),n.table.table.identifier.name)}}}Ir=new WeakMap,Zn=new WeakMap,er=new WeakMap,Ls=new WeakSet,hl=function(r){return r.kind in $u},Rs=new WeakSet,pl=function(r){const n=new Set;if("name"in r&&r.name&&Bn.is(r.name)&&Pe(this,Ei,vo).call(this,r.name,n),"from"in r&&r.from)for(const A of r.from.froms)Pe(this,tr,ri).call(this,A,n);if("into"in r&&r.into&&Pe(this,tr,ri).call(this,r.into,n),"table"in r&&r.table&&Pe(this,tr,ri).call(this,r.table,n),"joins"in r&&r.joins)for(const A of r.joins)Pe(this,tr,ri).call(this,A.table,n);return n},Bs=new WeakSet,ml=function(r){const n=new Set;return"with"in r&&r.with&&Pe(this,Ms,_l).call(this,r.with,n),n},tr=new WeakSet,ri=function(r,n){const A=Rn.is(r)?r:jn.is(r)&&Rn.is(r.node)?r.node:null;A&&Pe(this,Ei,vo).call(this,A.table,n)},Ei=new WeakSet,vo=function(r,n){const A=r.identifier.name;!s(this,Zn).has(A)&&!s(this,er).has(A)&&n.add(A)},Ms=new WeakSet,_l=function(r,n){for(const A of r.expressions){const V=A.name.table.table.identifier.name;s(this,er).has(V)||n.add(V)}};var Si;class Bi{constructor(e){Q(this,Si,void 0);X(this,Si,new Ju(e))}transformQuery(e){return s(this,Si).transformNode(e.node)}async transformResult(e){return e.result}}Si=new WeakMap;var je;const $n=class $n{constructor(e){Q(this,je,void 0);X(this,je,h(e))}selectFrom(e){return Io({queryId:$e(),executor:s(this,je).executor,queryNode:Oe.createFrom(wi(e),s(this,je).withNode)})}selectNoFrom(e){return Io({queryId:$e(),executor:s(this,je).executor,queryNode:Oe.cloneWithSelections(Oe.create(s(this,je).withNode),Kr(e))})}insertInto(e){return new gi({queryId:$e(),executor:s(this,je).executor,queryNode:Yt.create(rt(e),s(this,je).withNode)})}replaceInto(e){return new gi({queryId:$e(),executor:s(this,je).executor,queryNode:Yt.create(rt(e),s(this,je).withNode,!0)})}deleteFrom(e){return new ds({queryId:$e(),executor:s(this,je).executor,queryNode:li.create(wi(e),s(this,je).withNode)})}updateTable(e){return new fs({queryId:$e(),executor:s(this,je).executor,queryNode:ls.create(bi(e),s(this,je).withNode)})}with(e,r){const n=Wa(e,r);return new $n({...s(this,je),withNode:s(this,je).withNode?$i.cloneWithExpression(s(this,je).withNode,n):$i.create(n)})}withRecursive(e,r){const n=Wa(e,r);return new $n({...s(this,je),withNode:s(this,je).withNode?$i.cloneWithExpression(s(this,je).withNode,n):$i.create(n,{recursive:!0})})}withPlugin(e){return new $n({...s(this,je),executor:s(this,je).executor.withPlugin(e)})}withoutPlugins(){return new $n({...s(this,je),executor:s(this,je).executor.withoutPlugins()})}withSchema(e){return new $n({...s(this,je),executor:s(this,je).executor.withPluginAtFront(new Bi(e))})}};je=new WeakMap;let ms=$n;var Ii,Ar,kr;class La{constructor(){Q(this,Ii,void 0);Q(this,Ar,void 0);Q(this,kr,void 0);Qe(this,"resolve",e=>{s(this,Ar)&&s(this,Ar).call(this,e)});Qe(this,"reject",e=>{s(this,kr)&&s(this,kr).call(this,e)});X(this,Ii,new Promise((e,r)=>{X(this,kr,r),X(this,Ar,e)}))}get promise(){return s(this,Ii)}}Ii=new WeakMap,Ar=new WeakMap,kr=new WeakMap;const Ra=new Set;function Gu(t){Ra.has(t)||(Ra.add(t),console.log(t))}const Ku=h([]);var nr,Ai,xo;class yl{constructor(e=Ku){Q(this,Ai);Q(this,nr,void 0);X(this,nr,e)}get plugins(){return s(this,nr)}transformQuery(e,r){for(const n of s(this,nr)){const A=n.transformQuery({node:e,queryId:r});if(A.kind===e.kind)e=A;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${A.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async n=>{const A=await n.executeQuery(e),V=await Pe(this,Ai,xo).call(this,A,r);return Xu(A,V),V})}async*stream(e,r,n){const A=new La,V=new La;this.provideConnection(async Se=>(A.resolve(Se),await V.promise)).catch(Se=>A.reject(Se));const re=await A.promise;try{for await(const Se of re.streamQuery(e,r))yield await Pe(this,Ai,xo).call(this,Se,n)}finally{V.resolve()}}}nr=new WeakMap,Ai=new WeakSet,xo=async function(e,r){for(const n of s(this,nr))e=await n.transformResult({result:e,queryId:r});return e};function Xu(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Gu("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class qr extends yl{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new qr([...this.plugins,e])}withPlugins(e){return new qr([...this.plugins,...e])}withPluginAtFront(e){return new qr([e,...this.plugins])}withoutPlugins(){return new qr([])}}const Ho=new qr;function Yu(){return new ms({executor:Ho})}function Zu(t,e){return new os({joinNode:si.create(t,bi(e))})}function ed(){return new as({overNode:No.create()})}function kt(t,e){if(e.length===3)return nd(t,e[0],e[1],e[2]);if(e.length===2)return td(t,e[0],e[1]);throw new Error("not implemented")}function td(t,e,r){return r(Zu(t,e)).toOperationNode()}function nd(t,e,r,n){return si.createWithOn(t,bi(e),xn(r,"=",n))}const rd=h({is(t){return t.kind==="OffsetNode"},create(t){return h({kind:"OffsetNode",offset:t})}}),id=h({is(t){return t.kind==="GroupByItemNode"},create(t){return h({kind:"GroupByItemNode",groupBy:t})}});function sd(t){return t=Rt(t)?t(Xr()):t,yi(t).map(id.create)}const gl=h({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return h({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function wr(t,e,r){return Rt(e)&&(e=e(Go())),qn(e)||(e=[e]),e.map(n=>gl.create(t,hr(n),r))}var _n;const Qs=class Qs{constructor(e){Q(this,_n,void 0);X(this,_n,e)}get expressionType(){}as(e){return new $o(this,e)}or(...e){return new Eo(Gr.create(s(this,_n),qt(e)))}and(...e){return new So(Mn.create(s(this,_n),qt(e)))}$castTo(){return new Qs(s(this,_n))}$notNull(){return new Qs(s(this,_n))}toOperationNode(){return s(this,_n)}};_n=new WeakMap;let Ke=Qs;var Or,Tn;class $o{constructor(e,r){Q(this,Or,void 0);Q(this,Tn,void 0);X(this,Or,e),X(this,Tn,r)}get expression(){return s(this,Or)}get alias(){return s(this,Tn)}toOperationNode(){return jn.create(s(this,Or).toOperationNode(),Bt(s(this,Tn))?s(this,Tn).toOperationNode():Xe.create(s(this,Tn)))}}Or=new WeakMap,Tn=new WeakMap;var rr;const Us=class Us{constructor(e){Q(this,rr,void 0);X(this,rr,e)}get expressionType(){}as(e){return new $o(this,e)}or(...e){return new Us(Gr.create(s(this,rr),qt(e)))}$castTo(){return new Us(s(this,rr))}toOperationNode(){return Hr.create(s(this,rr))}};rr=new WeakMap;let Eo=Us;var ir;const js=class js{constructor(e){Q(this,ir,void 0);X(this,ir,e)}get expressionType(){}as(e){return new $o(this,e)}and(...e){return new js(Mn.create(s(this,ir),qt(e)))}$castTo(){return new js(s(this,ir))}toOperationNode(){return Hr.create(s(this,ir))}};ir=new WeakMap;let So=js;var Y;const ye=class ye{constructor(e){Q(this,Y,void 0);X(this,Y,h(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithWhere(s(this,Y).queryNode,qt(e))})}whereRef(e,r,n){return new ye({...s(this,Y),queryNode:Ie.cloneWithWhere(s(this,Y).queryNode,xn(e,r,n))})}having(...e){return new ye({...s(this,Y),queryNode:Oe.cloneWithHaving(s(this,Y).queryNode,qt(e))})}havingRef(e,r,n){return new ye({...s(this,Y),queryNode:Oe.cloneWithHaving(s(this,Y).queryNode,xn(e,r,n))})}select(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSelections(s(this,Y).queryNode,Kr(e))})}distinctOn(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithDistinctOn(s(this,Y).queryNode,yi(e))})}modifyFront(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithFrontModifier(s(this,Y).queryNode,dn.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.createWithExpression(e.toOperationNode()))})}distinct(){return new ye({...s(this,Y),queryNode:Oe.cloneWithFrontModifier(s(this,Y).queryNode,dn.create("Distinct"))})}forUpdate(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.create("ForUpdate",e?Hi(e).map(rt):void 0))})}forShare(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.create("ForShare",e?Hi(e).map(rt):void 0))})}forKeyShare(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.create("ForKeyShare",e?Hi(e).map(rt):void 0))})}forNoKeyUpdate(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.create("ForNoKeyUpdate",e?Hi(e).map(rt):void 0))})}skipLocked(){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.create("SkipLocked"))})}noWait(){return new ye({...s(this,Y),queryNode:Oe.cloneWithEndModifier(s(this,Y).queryNode,dn.create("NoWait"))})}selectAll(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSelections(s(this,Y).queryNode,Ri(e))})}innerJoin(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithJoin(s(this,Y).queryNode,kt("InnerJoin",e))})}leftJoin(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithJoin(s(this,Y).queryNode,kt("LeftJoin",e))})}rightJoin(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithJoin(s(this,Y).queryNode,kt("RightJoin",e))})}fullJoin(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithJoin(s(this,Y).queryNode,kt("FullJoin",e))})}innerJoinLateral(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithJoin(s(this,Y).queryNode,kt("LateralInnerJoin",e))})}leftJoinLateral(...e){return new ye({...s(this,Y),queryNode:Ie.cloneWithJoin(s(this,Y).queryNode,kt("LateralLeftJoin",e))})}orderBy(...e){return new ye({...s(this,Y),queryNode:Oe.cloneWithOrderByItems(s(this,Y).queryNode,ro(e))})}groupBy(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithGroupByItems(s(this,Y).queryNode,sd(e))})}limit(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithLimit(s(this,Y).queryNode,dl.create(ut(e)))})}offset(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithOffset(s(this,Y).queryNode,rd.create(ut(e)))})}union(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSetOperations(s(this,Y).queryNode,wr("union",e,!1))})}unionAll(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSetOperations(s(this,Y).queryNode,wr("union",e,!0))})}intersect(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSetOperations(s(this,Y).queryNode,wr("intersect",e,!1))})}intersectAll(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSetOperations(s(this,Y).queryNode,wr("intersect",e,!0))})}except(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSetOperations(s(this,Y).queryNode,wr("except",e,!1))})}exceptAll(e){return new ye({...s(this,Y),queryNode:Oe.cloneWithSetOperations(s(this,Y).queryNode,wr("except",e,!0))})}as(e){return new wl(this,e)}clearSelect(){return new ye({...s(this,Y),queryNode:Oe.cloneWithoutSelections(s(this,Y).queryNode)})}clearWhere(){return new ye({...s(this,Y),queryNode:Ie.cloneWithoutWhere(s(this,Y).queryNode)})}clearLimit(){return new ye({...s(this,Y),queryNode:Oe.cloneWithoutLimit(s(this,Y).queryNode)})}clearOffset(){return new ye({...s(this,Y),queryNode:Oe.cloneWithoutOffset(s(this,Y).queryNode)})}clearOrderBy(){return new ye({...s(this,Y),queryNode:Oe.cloneWithoutOrderBy(s(this,Y).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new ye({...s(this,Y)})}$castTo(){return new ye(s(this,Y))}$narrowType(){return new ye(s(this,Y))}$assertType(){return new ye(s(this,Y))}$asTuple(){return new Ke(this.toOperationNode())}withPlugin(e){return new ye({...s(this,Y),executor:s(this,Y).executor.withPlugin(e)})}toOperationNode(){return s(this,Y).executor.transformQuery(s(this,Y).queryNode,s(this,Y).queryId)}compile(){return s(this,Y).executor.compileQuery(this.toOperationNode(),s(this,Y).queryId)}async execute(){const e=this.compile();return(await s(this,Y).executor.executeQuery(e,s(this,Y).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=io){const r=await this.executeTakeFirst();if(r===void 0)throw so(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,Y).executor.stream(r,e,s(this,Y).queryId);for await(const A of n)yield*A.rows}async explain(e,r){return await new ye({...s(this,Y),queryNode:Ie.cloneWithExplain(s(this,Y).queryNode,e,r)}).execute()}};Y=new WeakMap;let _s=ye;ke(_s,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function Io(t){return new _s(t)}var Tr,Cr;class wl{constructor(e,r){Q(this,Tr,void 0);Q(this,Cr,void 0);X(this,Tr,e),X(this,Cr,r)}get expression(){return s(this,Tr)}get alias(){return s(this,Cr)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return jn.create(s(this,Tr).toOperationNode(),Xe.create(s(this,Cr)))}}Tr=new WeakMap,Cr=new WeakMap;ke(wl,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const Xn=h({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return h({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return h({...t,distinct:!0})},cloneWithFilter(t,e){return h({...t,filter:t.filter?At.cloneWithOperation(t.filter,"And",e):At.create(e)})},cloneWithOrFilter(t,e){return h({...t,filter:t.filter?At.cloneWithOperation(t.filter,"Or",e):At.create(e)})},cloneWithOver(t,e){return h({...t,over:e})}}),Ba=h({is(t){return t.kind==="FunctionNode"},create(t,e){return h({kind:"FunctionNode",func:t,arguments:e})}});var vt;const An=class An{constructor(e){Q(this,vt,void 0);X(this,vt,h(e))}get expressionType(){}as(e){return new od(this,e)}distinct(){return new An({...s(this,vt),aggregateFunctionNode:Xn.cloneWithDistinct(s(this,vt).aggregateFunctionNode)})}filterWhere(...e){return new An({...s(this,vt),aggregateFunctionNode:Xn.cloneWithFilter(s(this,vt).aggregateFunctionNode,qt(e))})}filterWhereRef(e,r,n){return new An({...s(this,vt),aggregateFunctionNode:Xn.cloneWithFilter(s(this,vt).aggregateFunctionNode,xn(e,r,n))})}over(e){const r=ed();return new An({...s(this,vt),aggregateFunctionNode:Xn.cloneWithOver(s(this,vt).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}$castTo(){return new An(s(this,vt))}$notNull(){return new An(s(this,vt))}toOperationNode(){return s(this,vt).aggregateFunctionNode}};vt=new WeakMap;let xr=An;ke(xr,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");var Pr,Fr;class od{constructor(e,r){Q(this,Pr,void 0);Q(this,Fr,void 0);X(this,Pr,e),X(this,Fr,r)}get expression(){return s(this,Pr)}get alias(){return s(this,Fr)}toOperationNode(){return jn.create(s(this,Pr).toOperationNode(),Xe.create(s(this,Fr)))}}Pr=new WeakMap,Fr=new WeakMap;function bl(){const t=(r,n)=>new Ke(Ba.create(r,yi(n??[]))),e=(r,n)=>new xr({aggregateFunctionNode:Xn.create(r,n?yi(n):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(...r){return t("coalesce",r)},count(r){return e("count",[r])},countAll(r){return new xr({aggregateFunctionNode:Xn.create("count",Ri(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])},jsonAgg(r){return new xr({aggregateFunctionNode:Xn.create("json_agg",[zt(r)?rt(r):r.toOperationNode()])})},toJson(r){return new Ke(Ba.create("to_json",[zt(r)?rt(r):r.toOperationNode()]))}})}const ad=h({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return h({kind:"UnaryOperationNode",operator:t,operand:e})}});function ld(t,e){return ad.create(Qn.create(t),jt(e))}const Jo=h({is(t){return t.kind==="WhenNode"},create(t){return h({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return h({...t,result:e})}}),an=h({is(t){return t.kind==="CaseNode"},create(t){return h({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return h({...t,when:h(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return h({...t,when:t.when?h([...t.when.slice(0,-1),Jo.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return h({...t,...e})}});var Wr;class ql{constructor(e){Q(this,Wr,void 0);X(this,Wr,h(e))}when(...e){return new Nl({...s(this,Wr),node:an.cloneWithWhen(s(this,Wr).node,Jo.create(qt(e)))})}}Wr=new WeakMap;var Dr;class Nl{constructor(e){Q(this,Dr,void 0);X(this,Dr,h(e))}then(e){return new cd({...s(this,Dr),node:an.cloneWithThen(s(this,Dr).node,Qo(e)?Uo(e):ut(e))})}}Dr=new WeakMap;var tn;class cd{constructor(e){Q(this,tn,void 0);X(this,tn,h(e))}when(...e){return new Nl({...s(this,tn),node:an.cloneWithWhen(s(this,tn).node,Jo.create(qt(e)))})}else(e){return new ud({...s(this,tn),node:an.cloneWith(s(this,tn).node,{else:Qo(e)?Uo(e):ut(e)})})}end(){return new Ke(an.cloneWith(s(this,tn).node,{isStatement:!1}))}endCase(){return new Ke(an.cloneWith(s(this,tn).node,{isStatement:!0}))}}tn=new WeakMap;var Lr;class ud{constructor(e){Q(this,Lr,void 0);X(this,Lr,h(e))}end(){return new Ke(an.cloneWith(s(this,Lr).node,{isStatement:!1}))}endCase(){return new Ke(an.cloneWith(s(this,Lr).node,{isStatement:!0}))}}Lr=new WeakMap;const Ma=h({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return h({kind:"JSONPathLegNode",type:t,value:e})}});var nn,ki,Ao;class ci{constructor(e){Q(this,ki);Q(this,nn,void 0);X(this,nn,e)}at(e){return Pe(this,ki,Ao).call(this,"ArrayLocation",e)}key(e){return Pe(this,ki,Ao).call(this,"Member",e)}}nn=new WeakMap,ki=new WeakSet,Ao=function(e,r){return rs.is(s(this,nn))?new Qa(rs.cloneWithTraversal(s(this,nn),oi.is(s(this,nn).traversal)?oi.cloneWithLeg(s(this,nn).traversal,Ma.create(e,r)):il.cloneWithValue(s(this,nn).traversal,vn.createImmediate(r)))):new Qa(oi.cloneWithLeg(s(this,nn),Ma.create(e,r)))};var sr;class Qa extends ci{constructor(r){super(r);Q(this,sr,void 0);X(this,sr,r)}get expressionType(){}as(r){return new dd(this,r)}$castTo(){return new ci(s(this,sr))}$notNull(){return new ci(s(this,sr))}toOperationNode(){return s(this,sr)}}sr=new WeakMap;var Rr,Cn;class dd{constructor(e,r){Q(this,Rr,void 0);Q(this,Cn,void 0);X(this,Rr,e),X(this,Cn,r)}get expression(){return s(this,Rr)}get alias(){return s(this,Cn)}toOperationNode(){return jn.create(s(this,Rr).toOperationNode(),Bt(s(this,Cn))?s(this,Cn).toOperationNode():Xe.create(s(this,Cn)))}}Rr=new WeakMap,Cn=new WeakMap;const Ua=h({is(t){return t.kind==="TupleNode"},create(t){return h({kind:"TupleNode",values:h(t)})}});function Go(t=Ho){function e(A,V,re){return new Ke(jo(A,V,re))}function r(A,V){return new Ke(ld(A,V))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(A){return Io({queryId:$e(),executor:t,queryNode:Oe.createFrom(wi(A))})},case(A){return new ql({node:an.create(dr(A)?void 0:jt(A))})},ref(A,V){return dr(V)?new Ke(Nn(A)):new ci(Nu(A,V))},jsonPath(){return new ci(oi.create())},table(A){return new Ke(rt(A))},val(A){return new Ke(ut(A))},refTuple(...A){return new Ke(Ua.create(A.map(jt)))},tuple(...A){return new Ke(Ua.create(A.map(ut)))},lit(A){return new Ke(Uo(A))},unary:r,not(A){return r("not",A)},exists(A){return r("exists",A)},neg(A){return r("-",A)},between(A,V,re){return new Ke(Vr.create(jt(A),Qn.create("between"),Mn.create(ut(V),ut(re))))},betweenSymmetric(A,V,re){return new Ke(Vr.create(jt(A),Qn.create("between symmetric"),Mn.create(ut(V),ut(re))))},and(A){return qn(A)?new Ke(bo(A,"and")):new Ke(Ea(A,"and"))},or(A){return qn(A)?new Ke(bo(A,"or")):new Ke(Ea(A,"or"))},parens(...A){const V=qt(A);return Hr.is(V)?new Ke(V):new Ke(Hr.create(V))},withSchema(A){return Go(t.withPluginAtFront(new Bi(A)))}});return n.fn=bl(),n.eb=n,n}function Xr(t){return Go()}function hr(t){if(Bt(t))return t.toOperationNode();if(Rt(t))return t(Xr()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function vl(t){if(Bt(t))return t.toOperationNode();if(Rt(t))return t(Xr()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function Mi(t){return fu(t)||hu(t)||Rt(t)}function wi(t){return qn(t)?t.map(e=>bi(e)):[bi(t)]}function bi(t){return zt(t)?fd(t):vl(t)}function fd(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(xl);return jn.create(rt(r),Xe.create(n))}else return rt(t)}function rt(t){const e=".";if(t.includes(e)){const[r,n]=t.split(e).map(xl);return Rn.createWithSchema(r,n)}else return Rn.create(t)}function xl(t){return t.trim()}const El=h({is(t){return t.kind==="AddColumnNode"},create(t){return h({kind:"AddColumnNode",column:t})}}),Ze=h({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return h({kind:"ColumnDefinitionNode",column:it.create(t),dataType:e})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):[e]})},cloneWith(t,e){return h({...t,...e})}}),Sl=h({is(t){return t.kind==="DropColumnNode"},create(t){return h({kind:"DropColumnNode",column:it.create(t)})}}),Il=h({is(t){return t.kind==="RenameColumnNode"},create(t,e){return h({kind:"RenameColumnNode",column:it.create(t),renameTo:it.create(e)})}}),Ko=h({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return h({kind:"CheckConstraintNode",expression:t,name:e?Xe.create(e):void 0})}}),hd=["no action","restrict","cascade","set null","set default"],Ki=h({is(t){return t.kind==="ReferencesNode"},create(t,e){return h({kind:"ReferencesNode",table:t,columns:h([...e])})},cloneWithOnDelete(t,e){return h({...t,onDelete:e})},cloneWithOnUpdate(t,e){return h({...t,onUpdate:e})}});function Al(t){return Bt(t)?t.toOperationNode():vn.createImmediate(t)}const Ji=h({is(t){return t.kind==="GeneratedNode"},create(t){return h({kind:"GeneratedNode",...t})},createWithExpression(t){return h({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return h({...t,...e})}}),pd=h({is(t){return t.kind==="DefaultValueNode"},create(t){return h({kind:"DefaultValueNode",defaultValue:t})}});function ys(t){if(hd.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}var ze;const lt=class lt{constructor(e){Q(this,ze,void 0);X(this,ze,e)}autoIncrement(){return new lt(Ze.cloneWith(s(this,ze),{autoIncrement:!0}))}primaryKey(){return new lt(Ze.cloneWith(s(this,ze),{primaryKey:!0}))}references(e){const r=Nn(e);if(!r.table||Ro.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new lt(Ze.cloneWith(s(this,ze),{references:Ki.create(r.table,[r.column])}))}onDelete(e){if(!s(this,ze).references)throw new Error("on delete constraint can only be added for foreign keys");return new lt(Ze.cloneWith(s(this,ze),{references:Ki.cloneWithOnDelete(s(this,ze).references,ys(e))}))}onUpdate(e){if(!s(this,ze).references)throw new Error("on update constraint can only be added for foreign keys");return new lt(Ze.cloneWith(s(this,ze),{references:Ki.cloneWithOnUpdate(s(this,ze).references,ys(e))}))}unique(){return new lt(Ze.cloneWith(s(this,ze),{unique:!0}))}notNull(){return new lt(Ze.cloneWith(s(this,ze),{notNull:!0}))}unsigned(){return new lt(Ze.cloneWith(s(this,ze),{unsigned:!0}))}defaultTo(e){return new lt(Ze.cloneWith(s(this,ze),{defaultTo:pd.create(Al(e))}))}check(e){return new lt(Ze.cloneWith(s(this,ze),{check:Ko.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new lt(Ze.cloneWith(s(this,ze),{generated:Ji.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new lt(Ze.cloneWith(s(this,ze),{generated:Ji.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new lt(Ze.cloneWith(s(this,ze),{generated:Ji.create({identity:!0,byDefault:!0})}))}stored(){if(!s(this,ze).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new lt(Ze.cloneWith(s(this,ze),{generated:Ji.cloneWith(s(this,ze).generated,{stored:!0})}))}modifyFront(e){return new lt(Ze.cloneWithFrontModifier(s(this,ze),e.toOperationNode()))}nullsNotDistinct(){return new lt(Ze.cloneWith(s(this,ze),{nullsNotDistinct:!0}))}modifyEnd(e){return new lt(Ze.cloneWithEndModifier(s(this,ze),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return s(this,ze)}};ze=new WeakMap;let Un=lt;ke(Un,"don't await ColumnDefinitionBuilder instances directly.");const kl=h({is(t){return t.kind==="ModifyColumnNode"},create(t){return h({kind:"ModifyColumnNode",column:t})}}),md=h({is(t){return t.kind==="DataTypeNode"},create(t){return h({kind:"DataTypeNode",dataType:t})}});function Jr(t){return Bt(t)?t.toOperationNode():md.create(t)}const gs=h({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,n){return h({kind:"ForeignKeyConstraintNode",columns:t,references:Ki.create(e,r),name:n?Xe.create(n):void 0})},cloneWith(t,e){return h({...t,...e})}});var or;const zs=class zs{constructor(e){Q(this,or,void 0);X(this,or,e)}onDelete(e){return new zs(gs.cloneWith(s(this,or),{onDelete:ys(e)}))}onUpdate(e){return new zs(gs.cloneWith(s(this,or),{onUpdate:ys(e)}))}$call(e){return e(this)}toOperationNode(){return s(this,or)}};or=new WeakMap;let qi=zs;ke(qi,"don't await ForeignKeyConstraintBuilder instances directly.");const Xi=h({is(t){return t.kind==="AddConstraintNode"},create(t){return h({kind:"AddConstraintNode",constraint:t})}}),Xo=h({is(t){return t.kind==="UniqueConstraintNode"},create(t,e,r){return h({kind:"UniqueConstraintNode",columns:h(t.map(it.create)),name:e?Xe.create(e):void 0,nullsNotDistinct:r})},cloneWith(t,e){return h({...t,...e})}}),Yi=h({is(t){return t.kind==="DropConstraintNode"},create(t){return h({kind:"DropConstraintNode",constraintName:Xe.create(t)})},cloneWith(t,e){return h({...t,...e})}}),ti=h({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return h({kind:"AlterColumnNode",column:it.create(t),[e]:r})}});var yn;class Yo{constructor(e){Q(this,yn,void 0);X(this,yn,e)}setDataType(e){return new ni(ti.create(s(this,yn),"dataType",Jr(e)))}setDefault(e){return new ni(ti.create(s(this,yn),"setDefault",Al(e)))}dropDefault(){return new ni(ti.create(s(this,yn),"dropDefault",!0))}setNotNull(){return new ni(ti.create(s(this,yn),"setNotNull",!0))}dropNotNull(){return new ni(ti.create(s(this,yn),"dropNotNull",!0))}$call(e){return e(this)}}yn=new WeakMap;var Oi;class ni{constructor(e){Q(this,Oi,void 0);X(this,Oi,e)}toOperationNode(){return s(this,Oi)}}Oi=new WeakMap;var Jt;class Hn{constructor(e){Q(this,Jt,void 0);X(this,Jt,h(e))}toOperationNode(){return s(this,Jt).executor.transformQuery(s(this,Jt).node,s(this,Jt).queryId)}compile(){return s(this,Jt).executor.compileQuery(this.toOperationNode(),s(this,Jt).queryId)}async execute(){await s(this,Jt).executor.executeQuery(this.compile(),s(this,Jt).queryId)}}Jt=new WeakMap;ke(Hn,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");var wt;const Vs=class Vs{constructor(e){Q(this,wt,void 0);X(this,wt,h(e))}onDelete(e){return new Vs({...s(this,wt),constraintBuilder:s(this,wt).constraintBuilder.onDelete(e)})}onUpdate(e){return new Vs({...s(this,wt),constraintBuilder:s(this,wt).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return s(this,wt).executor.transformQuery(Ve.cloneWithTableProps(s(this,wt).node,{addConstraint:Xi.create(s(this,wt).constraintBuilder.toOperationNode())}),s(this,wt).queryId)}compile(){return s(this,wt).executor.compileQuery(this.toOperationNode(),s(this,wt).queryId)}async execute(){await s(this,wt).executor.executeQuery(this.compile(),s(this,wt).queryId)}};wt=new WeakMap;let ws=Vs;ke(ws,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");var ot;const fi=class fi{constructor(e){Q(this,ot,void 0);X(this,ot,h(e))}ifExists(){return new fi({...s(this,ot),node:Ve.cloneWithTableProps(s(this,ot).node,{dropConstraint:Yi.cloneWith(s(this,ot).node.dropConstraint,{ifExists:!0})})})}cascade(){return new fi({...s(this,ot),node:Ve.cloneWithTableProps(s(this,ot).node,{dropConstraint:Yi.cloneWith(s(this,ot).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new fi({...s(this,ot),node:Ve.cloneWithTableProps(s(this,ot).node,{dropConstraint:Yi.cloneWith(s(this,ot).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return s(this,ot).executor.transformQuery(s(this,ot).node,s(this,ot).queryId)}compile(){return s(this,ot).executor.compileQuery(this.toOperationNode(),s(this,ot).queryId)}async execute(){await s(this,ot).executor.executeQuery(this.compile(),s(this,ot).queryId)}};ot=new WeakMap;let bs=fi;ke(bs,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const Ol=h({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return h({kind:"PrimaryKeyConstraintNode",columns:h(t.map(it.create)),name:e?Xe.create(e):void 0})}}),br=h({is(t){return t.kind==="AddIndexNode"},create(t){return h({kind:"AddIndexNode",name:Xe.create(t)})},cloneWith(t,e){return h({...t,...e})},cloneWithColumns(t,e){return h({...t,columns:[...t.columns||[],...e]})}});var Ge;const Jn=class Jn{constructor(e){Q(this,Ge,void 0);X(this,Ge,h(e))}unique(){return new Jn({...s(this,Ge),node:Ve.cloneWithTableProps(s(this,Ge).node,{addIndex:br.cloneWith(s(this,Ge).node.addIndex,{unique:!0})})})}column(e){return new Jn({...s(this,Ge),node:Ve.cloneWithTableProps(s(this,Ge).node,{addIndex:br.cloneWithColumns(s(this,Ge).node.addIndex,[is(e)])})})}columns(e){return new Jn({...s(this,Ge),node:Ve.cloneWithTableProps(s(this,Ge).node,{addIndex:br.cloneWithColumns(s(this,Ge).node.addIndex,e.map(is))})})}expression(e){return new Jn({...s(this,Ge),node:Ve.cloneWithTableProps(s(this,Ge).node,{addIndex:br.cloneWithColumns(s(this,Ge).node.addIndex,[e.toOperationNode()])})})}using(e){return new Jn({...s(this,Ge),node:Ve.cloneWithTableProps(s(this,Ge).node,{addIndex:br.cloneWith(s(this,Ge).node.addIndex,{using:bt.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return s(this,Ge).executor.transformQuery(s(this,Ge).node,s(this,Ge).queryId)}compile(){return s(this,Ge).executor.compileQuery(this.toOperationNode(),s(this,Ge).queryId)}async execute(){await s(this,Ge).executor.executeQuery(this.compile(),s(this,Ge).queryId)}};Ge=new WeakMap;let qs=Jn;ke(qs,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");var Br;const ea=class ea{constructor(e){Q(this,Br,void 0);X(this,Br,e)}toOperationNode(){return s(this,Br)}nullsNotDistinct(){return new ea(Xo.cloneWith(s(this,Br),{nullsNotDistinct:!0}))}};Br=new WeakMap;let Ni=ea;ke(Ni,"don't await UniqueConstraintNodeBuilder instances directly.");var Re;class Tl{constructor(e){Q(this,Re,void 0);X(this,Re,h(e))}renameTo(e){return new Hn({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{renameTo:rt(e)})})}setSchema(e){return new Hn({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{setSchema:Xe.create(e)})})}alterColumn(e,r){const n=r(new Yo(e));return new On({...s(this,Re),node:Ve.cloneWithColumnAlteration(s(this,Re).node,n.toOperationNode())})}dropColumn(e){return new On({...s(this,Re),node:Ve.cloneWithColumnAlteration(s(this,Re).node,Sl.create(e))})}renameColumn(e,r){return new On({...s(this,Re),node:Ve.cloneWithColumnAlteration(s(this,Re).node,Il.create(e,r))})}addColumn(e,r,n=Ln){const A=n(new Un(Ze.create(e,Jr(r))));return new On({...s(this,Re),node:Ve.cloneWithColumnAlteration(s(this,Re).node,El.create(A.toOperationNode()))})}modifyColumn(e,r,n=Ln){const A=n(new Un(Ze.create(e,Jr(r))));return new On({...s(this,Re),node:Ve.cloneWithColumnAlteration(s(this,Re).node,kl.create(A.toOperationNode()))})}addUniqueConstraint(e,r,n=Ln){const A=n(new Ni(Xo.create(r,e)));return new Hn({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{addConstraint:Xi.create(A.toOperationNode())})})}addCheckConstraint(e,r){return new Hn({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{addConstraint:Xi.create(Ko.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,n,A){return new ws({...s(this,Re),constraintBuilder:new qi(gs.create(r.map(it.create),rt(n),A.map(it.create),e))})}addPrimaryKeyConstraint(e,r){return new Hn({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{addConstraint:Xi.create(Ol.create(r,e))})})}dropConstraint(e){return new bs({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{dropConstraint:Yi.create(e)})})}addIndex(e){return new qs({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{addIndex:br.create(e)})})}dropIndex(e){return new Hn({...s(this,Re),node:Ve.cloneWithTableProps(s(this,Re).node,{dropIndex:ii.create(e)})})}$call(e){return e(this)}}Re=new WeakMap;var nt;const Gn=class Gn{constructor(e){Q(this,nt,void 0);X(this,nt,h(e))}alterColumn(e,r){const n=r(new Yo(e));return new Gn({...s(this,nt),node:Ve.cloneWithColumnAlteration(s(this,nt).node,n.toOperationNode())})}dropColumn(e){return new Gn({...s(this,nt),node:Ve.cloneWithColumnAlteration(s(this,nt).node,Sl.create(e))})}renameColumn(e,r){return new Gn({...s(this,nt),node:Ve.cloneWithColumnAlteration(s(this,nt).node,Il.create(e,r))})}addColumn(e,r,n=Ln){const A=n(new Un(Ze.create(e,Jr(r))));return new Gn({...s(this,nt),node:Ve.cloneWithColumnAlteration(s(this,nt).node,El.create(A.toOperationNode()))})}modifyColumn(e,r,n=Ln){const A=n(new Un(Ze.create(e,Jr(r))));return new Gn({...s(this,nt),node:Ve.cloneWithColumnAlteration(s(this,nt).node,kl.create(A.toOperationNode()))})}toOperationNode(){return s(this,nt).executor.transformQuery(s(this,nt).node,s(this,nt).queryId)}compile(){return s(this,nt).executor.compileQuery(this.toOperationNode(),s(this,nt).queryId)}async execute(){await s(this,nt).executor.executeQuery(this.compile(),s(this,nt).queryId)}};nt=new WeakMap;let On=Gn;ke(Tl,"don't await AlterTableBuilder instances");ke(Yo,"don't await AlterColumnBuilder instances");ke(On,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Cl extends Vo{transformValue(e){return{...super.transformValue(e),immediate:!0}}}var Ue;const Vt=class Vt{constructor(e){Q(this,Ue,void 0);X(this,Ue,h(e))}ifNotExists(){return new Vt({...s(this,Ue),node:fn.cloneWith(s(this,Ue).node,{ifNotExists:!0})})}unique(){return new Vt({...s(this,Ue),node:fn.cloneWith(s(this,Ue).node,{unique:!0})})}nullsNotDistinct(){return new Vt({...s(this,Ue),node:fn.cloneWith(s(this,Ue).node,{nullsNotDistinct:!0})})}on(e){return new Vt({...s(this,Ue),node:fn.cloneWith(s(this,Ue).node,{table:rt(e)})})}column(e){return new Vt({...s(this,Ue),node:fn.cloneWithColumns(s(this,Ue).node,[is(e)])})}columns(e){return new Vt({...s(this,Ue),node:fn.cloneWithColumns(s(this,Ue).node,e.map(is))})}expression(e){return new Vt({...s(this,Ue),node:fn.cloneWithColumns(s(this,Ue).node,[e.toOperationNode()])})}using(e){return new Vt({...s(this,Ue),node:fn.cloneWith(s(this,Ue).node,{using:bt.createWithSql(e)})})}where(...e){const r=new Cl;return new Vt({...s(this,Ue),node:Ie.cloneWithWhere(s(this,Ue).node,r.transformNode(qt(e)))})}$call(e){return e(this)}toOperationNode(){return s(this,Ue).executor.transformQuery(s(this,Ue).node,s(this,Ue).queryId)}compile(){return s(this,Ue).executor.compileQuery(this.toOperationNode(),s(this,Ue).queryId)}async execute(){await s(this,Ue).executor.executeQuery(this.compile(),s(this,Ue).queryId)}};Ue=new WeakMap;let Ns=Vt;ke(Ns,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");var Ft;const ta=class ta{constructor(e){Q(this,Ft,void 0);X(this,Ft,h(e))}ifNotExists(){return new ta({...s(this,Ft),node:Za.cloneWith(s(this,Ft).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Ft).executor.transformQuery(s(this,Ft).node,s(this,Ft).queryId)}compile(){return s(this,Ft).executor.compileQuery(this.toOperationNode(),s(this,Ft).queryId)}async execute(){await s(this,Ft).executor.executeQuery(this.compile(),s(this,Ft).queryId)}};Ft=new WeakMap;let vs=ta;ke(vs,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function _d(t){if(du.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}var Fe;const Pt=class Pt{constructor(e){Q(this,Fe,void 0);X(this,Fe,h(e))}temporary(){return new Pt({...s(this,Fe),node:Ct.cloneWith(s(this,Fe).node,{temporary:!0})})}onCommit(e){return new Pt({...s(this,Fe),node:Ct.cloneWith(s(this,Fe).node,{onCommit:_d(e)})})}ifNotExists(){return new Pt({...s(this,Fe),node:Ct.cloneWith(s(this,Fe).node,{ifNotExists:!0})})}addColumn(e,r,n=Ln){const A=n(new Un(Ze.create(e,Jr(r))));return new Pt({...s(this,Fe),node:Ct.cloneWithColumn(s(this,Fe).node,A.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Pt({...s(this,Fe),node:Ct.cloneWithConstraint(s(this,Fe).node,Ol.create(r,e))})}addUniqueConstraint(e,r,n=Ln){const A=n(new Ni(Xo.create(r,e)));return new Pt({...s(this,Fe),node:Ct.cloneWithConstraint(s(this,Fe).node,A.toOperationNode())})}addCheckConstraint(e,r){return new Pt({...s(this,Fe),node:Ct.cloneWithConstraint(s(this,Fe).node,Ko.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,n,A,V=Ln){const re=V(new qi(gs.create(r.map(it.create),rt(n),A.map(it.create),e)));return new Pt({...s(this,Fe),node:Ct.cloneWithConstraint(s(this,Fe).node,re.toOperationNode())})}modifyFront(e){return new Pt({...s(this,Fe),node:Ct.cloneWithFrontModifier(s(this,Fe).node,e.toOperationNode())})}modifyEnd(e){return new Pt({...s(this,Fe),node:Ct.cloneWithEndModifier(s(this,Fe).node,e.toOperationNode())})}as(e){return new Pt({...s(this,Fe),node:Ct.cloneWith(s(this,Fe).node,{selectQuery:hr(e)})})}$call(e){return e(this)}toOperationNode(){return s(this,Fe).executor.transformQuery(s(this,Fe).node,s(this,Fe).queryId)}compile(){return s(this,Fe).executor.compileQuery(this.toOperationNode(),s(this,Fe).queryId)}async execute(){await s(this,Fe).executor.executeQuery(this.compile(),s(this,Fe).queryId)}};Fe=new WeakMap;let xs=Pt;ke(xs,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");var mt;const hi=class hi{constructor(e){Q(this,mt,void 0);X(this,mt,h(e))}on(e){return new hi({...s(this,mt),node:ii.cloneWith(s(this,mt).node,{table:rt(e)})})}ifExists(){return new hi({...s(this,mt),node:ii.cloneWith(s(this,mt).node,{ifExists:!0})})}cascade(){return new hi({...s(this,mt),node:ii.cloneWith(s(this,mt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,mt).executor.transformQuery(s(this,mt).node,s(this,mt).queryId)}compile(){return s(this,mt).executor.compileQuery(this.toOperationNode(),s(this,mt).queryId)}async execute(){await s(this,mt).executor.executeQuery(this.compile(),s(this,mt).queryId)}};mt=new WeakMap;let Es=hi;ke(Es,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");var xt;const Hs=class Hs{constructor(e){Q(this,xt,void 0);X(this,xt,h(e))}ifExists(){return new Hs({...s(this,xt),node:yo.cloneWith(s(this,xt).node,{ifExists:!0})})}cascade(){return new Hs({...s(this,xt),node:yo.cloneWith(s(this,xt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,xt).executor.transformQuery(s(this,xt).node,s(this,xt).queryId)}compile(){return s(this,xt).executor.compileQuery(this.toOperationNode(),s(this,xt).queryId)}async execute(){await s(this,xt).executor.executeQuery(this.compile(),s(this,xt).queryId)}};xt=new WeakMap;let Ss=Hs;ke(Ss,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");var Et;const $s=class $s{constructor(e){Q(this,Et,void 0);X(this,Et,h(e))}ifExists(){return new $s({...s(this,Et),node:go.cloneWith(s(this,Et).node,{ifExists:!0})})}cascade(){return new $s({...s(this,Et),node:go.cloneWith(s(this,Et).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Et).executor.transformQuery(s(this,Et).node,s(this,Et).queryId)}compile(){return s(this,Et).executor.compileQuery(this.toOperationNode(),s(this,Et).queryId)}async execute(){await s(this,Et).executor.executeQuery(this.compile(),s(this,Et).queryId)}};Et=new WeakMap;let Is=$s;ke(Is,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const In=h({is(t){return t.kind==="CreateViewNode"},create(t){return h({kind:"CreateViewNode",name:Bn.create(t)})},cloneWith(t,e){return h({...t,...e})}});var Js;class yd{constructor(){Q(this,Js,new Cl)}transformQuery(e){return s(this,Js).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}Js=new WeakMap;var Ye;const kn=class kn{constructor(e){Q(this,Ye,void 0);X(this,Ye,h(e))}temporary(){return new kn({...s(this,Ye),node:In.cloneWith(s(this,Ye).node,{temporary:!0})})}materialized(){return new kn({...s(this,Ye),node:In.cloneWith(s(this,Ye).node,{materialized:!0})})}ifNotExists(){return new kn({...s(this,Ye),node:In.cloneWith(s(this,Ye).node,{ifNotExists:!0})})}orReplace(){return new kn({...s(this,Ye),node:In.cloneWith(s(this,Ye).node,{orReplace:!0})})}columns(e){return new kn({...s(this,Ye),node:In.cloneWith(s(this,Ye).node,{columns:e.map(ol)})})}as(e){const r=e.withPlugin(new yd).toOperationNode();return new kn({...s(this,Ye),node:In.cloneWith(s(this,Ye).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return s(this,Ye).executor.transformQuery(s(this,Ye).node,s(this,Ye).queryId)}compile(){return s(this,Ye).executor.compileQuery(this.toOperationNode(),s(this,Ye).queryId)}async execute(){await s(this,Ye).executor.executeQuery(this.compile(),s(this,Ye).queryId)}};Ye=new WeakMap;let As=kn;ke(As,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const Zi=h({is(t){return t.kind==="DropViewNode"},create(t){return h({kind:"DropViewNode",name:Bn.create(t)})},cloneWith(t,e){return h({...t,...e})}});var _t;const pi=class pi{constructor(e){Q(this,_t,void 0);X(this,_t,h(e))}materialized(){return new pi({...s(this,_t),node:Zi.cloneWith(s(this,_t).node,{materialized:!0})})}ifExists(){return new pi({...s(this,_t),node:Zi.cloneWith(s(this,_t).node,{ifExists:!0})})}cascade(){return new pi({...s(this,_t),node:Zi.cloneWith(s(this,_t).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,_t).executor.transformQuery(s(this,_t).node,s(this,_t).queryId)}compile(){return s(this,_t).executor.compileQuery(this.toOperationNode(),s(this,_t).queryId)}async execute(){await s(this,_t).executor.executeQuery(this.compile(),s(this,_t).queryId)}};_t=new WeakMap;let ks=pi;ke(ks,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Pl=h({is(t){return t.kind==="CreateTypeNode"},create(t){return h({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return h({...t,enum:Mo.create(e.map(r=>vn.createImmediate(r)))})}});var Wt;const na=class na{constructor(e){Q(this,Wt,void 0);X(this,Wt,h(e))}toOperationNode(){return s(this,Wt).executor.transformQuery(s(this,Wt).node,s(this,Wt).queryId)}asEnum(e){return new na({...s(this,Wt),node:Pl.cloneWithEnum(s(this,Wt).node,e)})}$call(e){return e(this)}compile(){return s(this,Wt).executor.compileQuery(this.toOperationNode(),s(this,Wt).queryId)}async execute(){await s(this,Wt).executor.executeQuery(this.compile(),s(this,Wt).queryId)}};Wt=new WeakMap;let Os=na;ke(Os,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Fl=h({is(t){return t.kind==="DropTypeNode"},create(t){return h({kind:"DropTypeNode",name:t})},cloneWith(t,e){return h({...t,...e})}});var Dt;const ra=class ra{constructor(e){Q(this,Dt,void 0);X(this,Dt,h(e))}ifExists(){return new ra({...s(this,Dt),node:Fl.cloneWith(s(this,Dt).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Dt).executor.transformQuery(s(this,Dt).node,s(this,Dt).queryId)}compile(){return s(this,Dt).executor.compileQuery(this.toOperationNode(),s(this,Dt).queryId)}async execute(){await s(this,Dt).executor.executeQuery(this.compile(),s(this,Dt).queryId)}};Dt=new WeakMap;let Ts=ra;ke(Ts,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function ja(t){const e=".";if(t.includes(e)){const r=t.split(e).map(gd);if(r.length===2)return Bn.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return Bn.create(t)}function gd(t){return t.trim()}var ft;const mi=class mi{constructor(e){Q(this,ft,void 0);X(this,ft,e)}createTable(e){return new xs({queryId:$e(),executor:s(this,ft),node:Ct.create(rt(e))})}dropTable(e){return new Is({queryId:$e(),executor:s(this,ft),node:go.create(rt(e))})}createIndex(e){return new Ns({queryId:$e(),executor:s(this,ft),node:fn.create(e)})}dropIndex(e){return new Es({queryId:$e(),executor:s(this,ft),node:ii.create(e)})}createSchema(e){return new vs({queryId:$e(),executor:s(this,ft),node:Za.create(e)})}dropSchema(e){return new Ss({queryId:$e(),executor:s(this,ft),node:yo.create(e)})}alterTable(e){return new Tl({queryId:$e(),executor:s(this,ft),node:Ve.create(rt(e))})}createView(e){return new As({queryId:$e(),executor:s(this,ft),node:In.create(e)})}dropView(e){return new ks({queryId:$e(),executor:s(this,ft),node:Zi.create(e)})}createType(e){return new Os({queryId:$e(),executor:s(this,ft),node:Pl.create(ja(e))})}dropType(e){return new Ts({queryId:$e(),executor:s(this,ft),node:Fl.create(ja(e))})}withPlugin(e){return new mi(s(this,ft).withPlugin(e))}withoutPlugins(){return new mi(s(this,ft).withoutPlugins())}withSchema(e){return new mi(s(this,ft).withPluginAtFront(new Bi(e)))}};ft=new WeakMap;let ko=mi;class wd{ref(e){return new bu(e)}}var Mr;class bd{constructor(e){Q(this,Mr,void 0);X(this,Mr,e)}async provideConnection(e){const r=await s(this,Mr).acquireConnection();try{return await e(r)}finally{await s(this,Mr).releaseConnection(r)}}}Mr=new WeakMap;var rn,sn,gn;const Kn=class Kn extends yl{constructor(r,n,A,V=[]){super(V);Q(this,rn,void 0);Q(this,sn,void 0);Q(this,gn,void 0);X(this,rn,r),X(this,sn,n),X(this,gn,A)}get adapter(){return s(this,sn)}compileQuery(r){return s(this,rn).compileQuery(r)}provideConnection(r){return s(this,gn).provideConnection(r)}withPlugins(r){return new Kn(s(this,rn),s(this,sn),s(this,gn),[...this.plugins,...r])}withPlugin(r){return new Kn(s(this,rn),s(this,sn),s(this,gn),[...this.plugins,r])}withPluginAtFront(r){return new Kn(s(this,rn),s(this,sn),s(this,gn),[r,...this.plugins])}withConnectionProvider(r){return new Kn(s(this,rn),s(this,sn),r,[...this.plugins])}withoutPlugins(){return new Kn(s(this,rn),s(this,sn),s(this,gn),[])}};rn=new WeakMap,sn=new WeakMap,gn=new WeakMap;let Oo=Kn;function za(){return typeof performance<"u"&&Rt(performance.now)?performance.now():Date.now()}var Gt,Pn,wn,Qr,bn,Ti,Gs,Wl,Ks,Dl,Xs,Ll,Ys,Rl,Ci,To;class qd{constructor(e,r){Q(this,Gs);Q(this,Ks);Q(this,Xs);Q(this,Ys);Q(this,Ci);Q(this,Gt,void 0);Q(this,Pn,void 0);Q(this,wn,void 0);Q(this,Qr,void 0);Q(this,bn,void 0);Q(this,Ti,new WeakSet);X(this,Qr,!1),X(this,Gt,e),X(this,Pn,r)}async init(){if(s(this,bn))throw new Error("driver has already been destroyed");s(this,wn)||X(this,wn,s(this,Gt).init().then(()=>{X(this,Qr,!0)}).catch(e=>(X(this,wn,void 0),Promise.reject(e)))),await s(this,wn)}async acquireConnection(){if(s(this,bn))throw new Error("driver has already been destroyed");s(this,Qr)||await this.init();const e=await s(this,Gt).acquireConnection();return s(this,Ti).has(e)||(Pe(this,Gs,Wl).call(this)&&Pe(this,Ks,Dl).call(this,e),s(this,Ti).add(e)),e}async releaseConnection(e){await s(this,Gt).releaseConnection(e)}beginTransaction(e,r){return s(this,Gt).beginTransaction(e,r)}commitTransaction(e){return s(this,Gt).commitTransaction(e)}rollbackTransaction(e){return s(this,Gt).rollbackTransaction(e)}async destroy(){s(this,wn)&&(await s(this,wn),s(this,bn)||X(this,bn,s(this,Gt).destroy().catch(e=>(X(this,bn,void 0),Promise.reject(e)))),await s(this,bn))}}Gt=new WeakMap,Pn=new WeakMap,wn=new WeakMap,Qr=new WeakMap,bn=new WeakMap,Ti=new WeakMap,Gs=new WeakSet,Wl=function(){return s(this,Pn).isLevelEnabled("query")||s(this,Pn).isLevelEnabled("error")},Ks=new WeakSet,Dl=function(e){const r=e.executeQuery;e.executeQuery=async n=>{let A;const V=za();try{return await r.call(e,n)}catch(re){throw A=re,await Pe(this,Xs,Ll).call(this,re,n,V),re}finally{A||await Pe(this,Ys,Rl).call(this,n,V)}}},Xs=new WeakSet,Ll=async function(e,r,n){await s(this,Pn).error(()=>({level:"error",error:e,query:r,queryDurationMillis:Pe(this,Ci,To).call(this,n)}))},Ys=new WeakSet,Rl=async function(e,r){await s(this,Pn).query(()=>({level:"query",query:e,queryDurationMillis:Pe(this,Ci,To).call(this,r)}))},Ci=new WeakSet,To=function(e){return za()-e};const Nd=()=>{};var Pi,Fn,Zs,Ml;class Bl{constructor(e){Q(this,Zs);Q(this,Pi,void 0);Q(this,Fn,void 0);X(this,Pi,e)}async provideConnection(e){for(;s(this,Fn);)await s(this,Fn).catch(Nd);return X(this,Fn,Pe(this,Zs,Ml).call(this,e).finally(()=>{X(this,Fn,void 0)})),s(this,Fn)}}Pi=new WeakMap,Fn=new WeakMap,Zs=new WeakSet,Ml=async function(e){return await e(s(this,Pi))};const vd=["read uncommitted","read committed","repeatable read","serializable","snapshot"];h(["query","error"]);var Wn,ar;class xd{constructor(e){Q(this,Wn,void 0);Q(this,ar,void 0);Rt(e)?(X(this,ar,e),X(this,Wn,h({query:!0,error:!0}))):(X(this,ar,Ed),X(this,Wn,h({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return s(this,Wn)[e]}async query(e){s(this,Wn).query&&await s(this,ar).call(this,e())}async error(e){s(this,Wn).error&&await s(this,ar).call(this,e())}}Wn=new WeakMap,ar=new WeakMap;function Ed(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:t.error,query:t.query.sql,queryDurationMillis:t.queryDurationMillis})}`))}function Sd(t){return on(t)&&Rt(t.compile)}var yt;const Nr=class Nr extends ms{constructor(r){let n,A;if(Id(r))n={executor:r.executor},A={...r};else{const V=r.dialect,re=V.createDriver(),Se=V.createQueryCompiler(),Le=V.createAdapter(),He=new xd(r.log??[]),ie=new qd(re,He),Ee=new bd(ie),Ne=new Oo(Se,Le,Ee,r.plugins??[]);n={executor:Ne},A={config:r,executor:Ne,dialect:V,driver:ie}}super(n);Q(this,yt,void 0);X(this,yt,h(A))}get schema(){return new ko(s(this,yt).executor)}get dynamic(){return new wd}get introspection(){return s(this,yt).dialect.createIntrospector(this.withoutPlugins())}case(r){return new ql({node:an.create(dr(r)?void 0:hr(r))})}get fn(){return bl()}transaction(){return new Cs({...s(this,yt)})}connection(){return new Ql({...s(this,yt)})}withPlugin(r){return new Nr({...s(this,yt),executor:s(this,yt).executor.withPlugin(r)})}withoutPlugins(){return new Nr({...s(this,yt),executor:s(this,yt).executor.withoutPlugins()})}withSchema(r){return new Nr({...s(this,yt),executor:s(this,yt).executor.withPluginAtFront(new Bi(r))})}withTables(){return new Nr({...s(this,yt)})}async destroy(){await s(this,yt).driver.destroy()}get isTransaction(){return!1}getExecutor(){return s(this,yt).executor}executeQuery(r,n=$e()){const A=Sd(r)?r.compile():r;return this.getExecutor().executeQuery(A,n)}};yt=new WeakMap;let vi=Nr;var Kt;const vr=class vr extends vi{constructor(r){super(r);Q(this,Kt,void 0);X(this,Kt,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new vr({...s(this,Kt),executor:s(this,Kt).executor.withPlugin(r)})}withoutPlugins(){return new vr({...s(this,Kt),executor:s(this,Kt).executor.withoutPlugins()})}withSchema(r){return new vr({...s(this,Kt),executor:s(this,Kt).executor.withPluginAtFront(new Bi(r))})}withTables(){return new vr({...s(this,Kt)})}};Kt=new WeakMap;let Co=vr;function Id(t){return on(t)&&on(t.config)&&on(t.driver)&&on(t.executor)&&on(t.dialect)}var lr;class Ql{constructor(e){Q(this,lr,void 0);X(this,lr,h(e))}async execute(e){return s(this,lr).executor.provideConnection(async r=>{const n=s(this,lr).executor.withConnectionProvider(new Bl(r)),A=new vi({...s(this,lr),executor:n});return await e(A)})}}lr=new WeakMap;ke(Ql,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");var Xt;const ia=class ia{constructor(e){Q(this,Xt,void 0);X(this,Xt,h(e))}setIsolationLevel(e){return new ia({...s(this,Xt),isolationLevel:e})}async execute(e){const{isolationLevel:r,...n}=s(this,Xt),A={isolationLevel:r};return Ad(A),s(this,Xt).executor.provideConnection(async V=>{const re=s(this,Xt).executor.withConnectionProvider(new Bl(V)),Se=new Co({...n,executor:re});try{await s(this,Xt).driver.beginTransaction(V,A);const Le=await e(Se);return await s(this,Xt).driver.commitTransaction(V),Le}catch(Le){throw await s(this,Xt).driver.rollbackTransaction(V),Le}})}};Xt=new WeakMap;let Cs=ia;ke(Cs,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function Ad(t){if(t.isolationLevel&&!vd.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}var St,Ur,es,Fi,Po,Wi,Fo;const _i=class _i{constructor(e){Q(this,Ur);Q(this,Fi);Q(this,Wi);Q(this,St,void 0);X(this,St,h(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Ul(this,e)}$castTo(){return new _i({...s(this,St)})}$notNull(){return new _i(s(this,St))}withPlugin(e){return new _i({...s(this,St),plugins:s(this,St).plugins!==void 0?h([...s(this,St).plugins,e]):h([e])})}toOperationNode(){return Pe(this,Fi,Po).call(this,Pe(this,Ur,es).call(this))}compile(e){return Pe(this,Wi,Fo).call(this,Pe(this,Ur,es).call(this,e))}async execute(e){const r=Pe(this,Ur,es).call(this,e);return r.executeQuery(Pe(this,Wi,Fo).call(this,r),s(this,St).queryId)}};St=new WeakMap,Ur=new WeakSet,es=function(e){const r=e!==void 0?e.getExecutor():Ho;return s(this,St).plugins!==void 0?r.withPlugins(s(this,St).plugins):r},Fi=new WeakSet,Po=function(e){return e.transformQuery(s(this,St).rawNode,s(this,St).queryId)},Wi=new WeakSet,Fo=function(e){return e.compileQuery(Pe(this,Fi,Po).call(this,e),s(this,St).queryId)};let Ps=_i;function Sn(t){return new Ps(t)}ke(Ps,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");var cr,Dn;class Ul{constructor(e,r){Q(this,cr,void 0);Q(this,Dn,void 0);X(this,cr,e),X(this,Dn,r)}get expression(){return s(this,cr)}get alias(){return s(this,Dn)}get rawBuilder(){return s(this,cr)}toOperationNode(){return jn.create(s(this,cr).toOperationNode(),Bt(s(this,Dn))?s(this,Dn).toOperationNode():Xe.create(s(this,Dn)))}}cr=new WeakMap,Dn=new WeakMap;ke(Ul,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const ct=Object.assign((t,...e)=>Sn({queryId:$e(),rawNode:bt.create(t,e?.map(Va)??[])}),{ref(t){return Sn({queryId:$e(),rawNode:bt.createWithChild(Nn(t))})},val(t){return Sn({queryId:$e(),rawNode:bt.createWithChild(ut(t))})},value(t){return this.val(t)},table(t){return Sn({queryId:$e(),rawNode:bt.createWithChild(rt(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",Sn({queryId:$e(),rawNode:bt.create(e,t.map(Xe.create))})},lit(t){return Sn({queryId:$e(),rawNode:bt.createWithChild(vn.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return Sn({queryId:$e(),rawNode:bt.createWithSql(t)})},join(t,e=ct`, `){const r=new Array(2*t.length-1),n=e.toOperationNode();for(let A=0;A<t.length;++A)r[2*A]=Va(t[A]),A!==t.length-1&&(r[2*A+1]=n);return Sn({queryId:$e(),rawNode:bt.createWithChildren(r)})}});function Va(t){return Bt(t)?t.toOperationNode():ut(t)}var eo;class kd{constructor(){Qe(this,"nodeStack",[]);Q(this,eo,h({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),AddIndexNode:this.visitAddIndex.bind(this)}));Qe(this,"visitNode",e=>{this.nodeStack.push(e),s(this,eo)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}eo=new WeakMap;var jr,ur;class Od extends kd{constructor(){super(...arguments);Q(this,jr,"");Q(this,ur,[])}get numParameters(){return s(this,ur).length}compileQuery(r){return X(this,jr,""),X(this,ur,[]),this.visitNode(r),h({query:r,sql:this.getSql(),parameters:[...s(this,ur)]})}getSql(){return s(this,jr)}visitSelectQuery(r){const n=this.parentNode!==void 0&&!Hr.is(this.parentNode)&&!Yt.is(this.parentNode)&&!Ct.is(this.parentNode)&&!In.is(this.parentNode)&&!gl.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),r.frontModifiers?.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),r.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),n&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,n=", "){const A=r.length-1;for(let V=0;V<=A;V++)this.visitNode(r[V]),V<A&&this.append(n)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const n=this.nodeStack.find(Ie.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.defaultValues&&(this.append(" "),this.append("default values")),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const n=this.nodeStack.find(Ie.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!zt(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:n}=r;for(let A=0;A<n.length;++A)this.appendValue(n[A]),A!==n.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(Cd[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:n,parameters:A}=r;for(let V=0;V<n.length;++V)this.append(n[V]),A.length>V&&this.visitNode(A[V])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),r.selectQuery?(this.append(" as "),this.visitNode(r.selectQuery)):(this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," ")))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.nullsNotDistinct&&this.append(" nulls not distinct"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const n=this.nodeStack.find(Ie.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.nullsNotDistinct&&this.append(" nulls not distinct"),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique"),r.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),ns(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileColumnAlterations(r.columnAlterations),r.addIndex&&this.visitNode(r.addIndex),r.dropIndex&&this.visitNode(r.dropIndex)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(Td[r.modifier]),r.of&&(this.append(" of "),this.compileList(r.of,", "))}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return Qn.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const n of r.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(r){const n=r.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(r.value)),n&&this.append("]")}visitJSONOperatorChain(r){for(let n=0,A=r.values.length;n<A;n++)n===A-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[n])}visitAddIndex(r){this.append("add "),r.unique&&this.append("unique "),this.append("index "),this.visitNode(r.name),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.using&&(this.append(" using "),this.visitNode(r.using))}append(r){X(this,jr,s(this,jr)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const n=this.getLeftIdentifierWrapper(),A=this.getRightIdentifierWrapper();let V="";for(const re of r)V+=re,re===n?V+=n:re===A&&(V+=A);return V}addParameter(r){s(this,ur).push(r)}appendImmediateValue(r){if(zt(r))this.append(`'${r}'`);else if(Ya(r)||ns(r))this.append(r.toString());else if(Lo(r))this.append("null");else if(cu(r))this.appendImmediateValue(r.toISOString());else if(uu(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((n,A)=>n.modifier&&A.modifier?Ha[n.modifier]-Ha[A.modifier]:1),h(r)}compileColumnAlterations(r){this.compileList(r)}announcesNewColumnDataType(){return!0}}jr=new WeakMap,ur=new WeakMap;const Td=h({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),Ha=h({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Cd=h({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),fr=h({raw(t,e=[]){return h({sql:t,query:bt.createWithSql(t),parameters:h(e)})}});class Pd{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}}const Fd=/"/g;class Wd extends Od{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(Fd,'""')}visitDefaultInsertValue(e){this.append("null")}}const jl="kysely_migration",zl="kysely_migration_lock";h({__noMigrations__:!0});var zr,to,Vl;class Dd{constructor(e){Q(this,to);Q(this,zr,void 0);X(this,zr,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=s(this,zr).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",jl).where("name","!=",zl));const n=await r.execute();return Promise.all(n.map(({name:A})=>Pe(this,to,Vl).call(this,A)))}async getMetadata(e){return{tables:await this.getTables(e)}}}zr=new WeakMap,to=new WeakSet,Vl=async function(e){const r=s(this,zr),n=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),A=n.sql?.split(/[\(\),]/)?.find(re=>re.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),V=await r.selectFrom(ct`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:V.map(re=>({name:re.name,dataType:re.type,isNullable:!re.notnull,isAutoIncrementing:re.name===A,hasDefaultValue:re.dflt_value!=null}))}};class Ld extends Pd{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var Rd=class{createQueryCompiler(){return new Wd}createAdapter(){return new Ld}createIntrospector(t){return new Dd(t)}},Di,Ka,Bd=(Ka=class{constructor(){Q(this,Di,new Md);Qe(this,"connection")}async acquireConnection(){return await s(this,Di).lock(),this.connection}async beginTransaction(t){await t.executeQuery(fr.raw("begin"))}async commitTransaction(t){await t.executeQuery(fr.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(fr.raw("rollback"))}async releaseConnection(){s(this,Di).unlock()}},Di=new WeakMap,Ka),Md=class{constructor(){Qe(this,"promise");Qe(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t?.()}},Qd=class{streamQuery(){throw new Error("sqlite-wasm driver doesn't support streaming")}async executeQuery({parameters:t,query:e,sql:r}){const n=await this.query(r,t);return Oe.is(e)||n.length?{rows:n}:{rows:n,...await this.info()}}},Ud=class extends Bd{constructor(e){super();Qe(this,"config");Qe(this,"db");this.config=e}async init(){this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,this.connection=new jd(this.db),await this.config.onCreateConnection?.(this.connection)}async destroy(){this.db?.close()}},jd=class extends Qd{constructor(e){super();Qe(this,"db");this.db=e}async query(e,r){return this.db.selectObjects(e,r)}async info(){return{insertId:BigInt(this.db.selectArray("SELECT last_insert_rowid()")[0]),numAffectedRows:BigInt(this.db.changes(!1,!0))}}},Li,Xa,zd=(Xa=class extends Rd{constructor(e){super();Q(this,Li,void 0);X(this,Li,e)}createDriver(){return new Ud(s(this,Li))}},Li=new WeakMap,Xa),Zo=(()=>{var t=import.meta.url;return function(e){var r=e||{},n=typeof r<"u"?r:{},A,V;n.ready=new Promise(function(o,i){A=o,V=i});const re=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,re.debugModule("globalThis.location =",globalThis.location);const Se="emscripten-bug-17951";n[Se]=function o(i,l){i.env.foo=function(){};const a=n.locateFile(o.uri,typeof Ne>"u"?"":Ne);re.debugModule("instantiateWasm() uri =",a);const c=()=>fetch(a,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(c(),i).then(q=>l(q.instance,q.module)):async()=>c().then(q=>q.arrayBuffer()).then(q=>WebAssembly.instantiate(q,i)).then(q=>l(q.instance,q.module)))(),{}},n[Se].uri="sqlite3.wasm";var Le=Object.assign({},n),He="./this.program",ie=typeof window=="object",Ee=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var Ne="";function Ot(o){return n.locateFile?n.locateFile(o,Ne):Ne+o}var Zt,Mt,En;(ie||Ee)&&(Ee?Ne=self.location.href:typeof document<"u"&&document.currentScript&&(Ne=document.currentScript.src),t&&(Ne=t),Ne.indexOf("blob:")!==0?Ne=Ne.substr(0,Ne.replace(/[?#].*/,"").lastIndexOf("/")+1):Ne="",Zt=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.send(null),i.responseText},Ee&&(En=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.responseType="arraybuffer",i.send(null),new Uint8Array(i.response)}),Mt=(o,i,l)=>{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onload=()=>{if(a.status==200||a.status==0&&a.response){i(a.response);return}l()},a.onerror=l,a.send(null)});var It=n.print||console.log.bind(console),Be=n.printErr||console.warn.bind(console);Object.assign(n,Le),Le=null,n.arguments&&n.arguments,n.thisProgram&&(He=n.thisProgram),n.quit&&n.quit;var We;n.wasmBinary&&(We=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&gr("no native wasm support detected");var gt,ln=!1;function oo(o,i){o||gr(i)}var Qi=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Qt(o,i,l){for(var a=i+l,c=i;o[c]&&!(c>=a);)++c;if(c-i>16&&o.buffer&&Qi)return Qi.decode(o.subarray(i,c));for(var d="";i<c;){var q=o[i++];if(!(q&128)){d+=String.fromCharCode(q);continue}var I=o[i++]&63;if((q&224)==192){d+=String.fromCharCode((q&31)<<6|I);continue}var L=o[i++]&63;if((q&240)==224?q=(q&15)<<12|I<<6|L:q=(q&7)<<18|I<<12|L<<6|o[i++]&63,q<65536)d+=String.fromCharCode(q);else{var J=q-65536;d+=String.fromCharCode(55296|J>>10,56320|J&1023)}}return d}function pr(o,i){return o?Qt(yr,o,i):""}function mr(o,i,l,a){if(!(a>0))return 0;for(var c=l,d=l+a-1,q=0;q<o.length;++q){var I=o.charCodeAt(q);if(I>=55296&&I<=57343){var L=o.charCodeAt(++q);I=65536+((I&1023)<<10)|L&1023}if(I<=127){if(l>=d)break;i[l++]=I}else if(I<=2047){if(l+1>=d)break;i[l++]=192|I>>6,i[l++]=128|I&63}else if(I<=65535){if(l+2>=d)break;i[l++]=224|I>>12,i[l++]=128|I>>6&63,i[l++]=128|I&63}else{if(l+3>=d)break;i[l++]=240|I>>18,i[l++]=128|I>>12&63,i[l++]=128|I>>6&63,i[l++]=128|I&63}}return i[l]=0,l-c}function _r(o,i,l){return mr(o,yr,i,l)}function Yr(o){for(var i=0,l=0;l<o.length;++l){var a=o.charCodeAt(l);a<=127?i++:a<=2047?i+=2:a>=55296&&a<=57343?(i+=4,++l):i+=3}return i}var Tt,yr,sa,xe,et;function oa(){var o=gt.buffer;n.HEAP8=Tt=new Int8Array(o),n.HEAP16=sa=new Int16Array(o),n.HEAP32=xe=new Int32Array(o),n.HEAPU8=yr=new Uint8Array(o),n.HEAPU16=new Uint16Array(o),n.HEAPU32=et=new Uint32Array(o),n.HEAPF32=new Float32Array(o),n.HEAPF64=new Float64Array(o),n.HEAP64=new BigInt64Array(o),n.HEAPU64=new BigUint64Array(o)}var aa=n.INITIAL_MEMORY||16777216;n.wasmMemory?gt=n.wasmMemory:gt=new WebAssembly.Memory({initial:aa/65536,maximum:2147483648/65536}),oa(),aa=gt.buffer.byteLength;var la=[],ca=[],ua=[];function Yl(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)tc(n.preRun.shift());lo(la)}function Zl(){!n.noFSInit&&!u.init.initialized&&u.init(),u.ignorePermissions=!1,lo(ca)}function ec(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)rc(n.postRun.shift());lo(ua)}function tc(o){la.unshift(o)}function nc(o){ca.unshift(o)}function rc(o){ua.unshift(o)}var zn=0,Zr=null;function _f(o){return o}function ao(o){zn++,n.monitorRunDependencies&&n.monitorRunDependencies(zn)}function Ui(o){if(zn--,n.monitorRunDependencies&&n.monitorRunDependencies(zn),zn==0&&Zr){var i=Zr;Zr=null,i()}}function gr(o){n.onAbort&&n.onAbort(o),o="Aborted("+o+")",Be(o),ln=!0,o+=". Build with -sASSERTIONS for more info.";var i=new WebAssembly.RuntimeError(o);throw V(i),i}var ic="data:application/octet-stream;base64,";function da(o){return o.startsWith(ic)}var Ut;n.locateFile?(Ut="sqlite3.wasm",da(Ut)||(Ut=Ot(Ut))):Ut=new URL(""+new URL("sqlite3-Sc2bb0G-.wasm",import.meta.url).href,import.meta.url).href;function fa(o){try{if(o==Ut&&We)return new Uint8Array(We);if(En)return En(o);throw"both async and sync fetching of the wasm failed"}catch(i){gr(i)}}function sc(){return!We&&(ie||Ee)&&typeof fetch=="function"?fetch(Ut,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+Ut+"'";return o.arrayBuffer()}).catch(function(){return fa(Ut)}):Promise.resolve().then(function(){return fa(Ut)})}function oc(){var o={env:ga,wasi_snapshot_preview1:ga};function i(q,I){var L=q.exports;n.asm=L,n.asm.__indirect_function_table,nc(n.asm.__wasm_call_ctors),Ui()}ao();function l(q){i(q.instance)}function a(q){return sc().then(function(I){return WebAssembly.instantiate(I,o)}).then(function(I){return I}).then(q,function(I){Be("failed to asynchronously prepare wasm: "+I),gr(I)})}function c(){return!We&&typeof WebAssembly.instantiateStreaming=="function"&&!da(Ut)&&typeof fetch=="function"?fetch(Ut,{credentials:"same-origin"}).then(function(q){var I=WebAssembly.instantiateStreaming(q,o);return I.then(l,function(L){return Be("wasm streaming compile failed: "+L),Be("falling back to ArrayBuffer instantiation"),a(l)})}):a(l)}if(n.instantiateWasm)try{var d=n.instantiateWasm(o,i);return d}catch(q){Be("Module.instantiateWasm callback failed with error: "+q),V(q)}return c().catch(V),{}}var Ae,dt;function lo(o){for(;o.length>0;)o.shift()(n)}var De={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return i.exec(o).slice(1)},normalizeArray:(o,i)=>{for(var l=0,a=o.length-1;a>=0;a--){var c=o[a];c==="."?o.splice(a,1):c===".."?(o.splice(a,1),l++):l&&(o.splice(a,1),l--)}if(i)for(;l;l--)o.unshift("..");return o},normalize:o=>{var i=De.isAbs(o),l=o.substr(-1)==="/";return o=De.normalizeArray(o.split("/").filter(a=>!!a),!i).join("/"),!o&&!i&&(o="."),o&&l&&(o+="/"),(i?"/":"")+o},dirname:o=>{var i=De.splitPath(o),l=i[0],a=i[1];return!l&&!a?".":(a&&(a=a.substr(0,a.length-1)),l+a)},basename:o=>{if(o==="/")return"/";o=De.normalize(o),o=o.replace(/\/$/,"");var i=o.lastIndexOf("/");return i===-1?o:o.substr(i+1)},join:function(){var o=Array.prototype.slice.call(arguments);return De.normalize(o.join("/"))},join2:(o,i)=>De.normalize(o+"/"+i)};function ac(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var o=new Uint8Array(1);return()=>(crypto.getRandomValues(o),o[0])}else return()=>gr("randomDevice")}var cn={resolve:function(){for(var o="",i=!1,l=arguments.length-1;l>=-1&&!i;l--){var a=l>=0?arguments[l]:u.cwd();if(typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";o=a+"/"+o,i=De.isAbs(a)}return o=De.normalizeArray(o.split("/").filter(c=>!!c),!i).join("/"),(i?"/":"")+o||"."},relative:(o,i)=>{o=cn.resolve(o).substr(1),i=cn.resolve(i).substr(1);function l(J){for(var ee=0;ee<J.length&&J[ee]==="";ee++);for(var se=J.length-1;se>=0&&J[se]==="";se--);return ee>se?[]:J.slice(ee,se-ee+1)}for(var a=l(o.split("/")),c=l(i.split("/")),d=Math.min(a.length,c.length),q=d,I=0;I<d;I++)if(a[I]!==c[I]){q=I;break}for(var L=[],I=q;I<a.length;I++)L.push("..");return L=L.concat(c.slice(q)),L.join("/")}};function co(o,i,l){var a=l>0?l:Yr(o)+1,c=new Array(a),d=mr(o,c,0,c.length);return i&&(c.length=d),c}var Vn={ttys:[],init:function(){},shutdown:function(){},register:function(o,i){Vn.ttys[o]={input:[],output:[],ops:i},u.registerDevice(o,Vn.stream_ops)},stream_ops:{open:function(o){var i=Vn.ttys[o.node.rdev];if(!i)throw new u.ErrnoError(43);o.tty=i,o.seekable=!1},close:function(o){o.tty.ops.fsync(o.tty)},fsync:function(o){o.tty.ops.fsync(o.tty)},read:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.get_char)throw new u.ErrnoError(60);for(var d=0,q=0;q<a;q++){var I;try{I=o.tty.ops.get_char(o.tty)}catch{throw new u.ErrnoError(29)}if(I===void 0&&d===0)throw new u.ErrnoError(6);if(I==null)break;d++,i[l+q]=I}return d&&(o.node.timestamp=Date.now()),d},write:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var d=0;d<a;d++)o.tty.ops.put_char(o.tty,i[l+d])}catch{throw new u.ErrnoError(29)}return a&&(o.node.timestamp=Date.now()),d}},default_tty_ops:{get_char:function(o){if(!o.input.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i)return null;o.input=co(i,!0)}return o.input.shift()},put_char:function(o,i){i===null||i===10?(It(Qt(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(It(Qt(o.output,0)),o.output=[])}},default_tty1_ops:{put_char:function(o,i){i===null||i===10?(Be(Qt(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(Be(Qt(o.output,0)),o.output=[])}}};function lc(o,i){return yr.fill(0,o,o+i),o}function cc(o,i){return Math.ceil(o/i)*i}function ha(o){o=cc(o,65536);var i=qa(65536,o);return i?lc(i,o):0}var be={ops_table:null,mount:function(o){return be.createNode(null,"/",16895,0)},createNode:function(o,i,l,a){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);be.ops_table||(be.ops_table={dir:{node:{getattr:be.node_ops.getattr,setattr:be.node_ops.setattr,lookup:be.node_ops.lookup,mknod:be.node_ops.mknod,rename:be.node_ops.rename,unlink:be.node_ops.unlink,rmdir:be.node_ops.rmdir,readdir:be.node_ops.readdir,symlink:be.node_ops.symlink},stream:{llseek:be.stream_ops.llseek}},file:{node:{getattr:be.node_ops.getattr,setattr:be.node_ops.setattr},stream:{llseek:be.stream_ops.llseek,read:be.stream_ops.read,write:be.stream_ops.write,allocate:be.stream_ops.allocate,mmap:be.stream_ops.mmap,msync:be.stream_ops.msync}},link:{node:{getattr:be.node_ops.getattr,setattr:be.node_ops.setattr,readlink:be.node_ops.readlink},stream:{}},chrdev:{node:{getattr:be.node_ops.getattr,setattr:be.node_ops.setattr},stream:u.chrdev_stream_ops}});var c=u.createNode(o,i,l,a);return u.isDir(c.mode)?(c.node_ops=be.ops_table.dir.node,c.stream_ops=be.ops_table.dir.stream,c.contents={}):u.isFile(c.mode)?(c.node_ops=be.ops_table.file.node,c.stream_ops=be.ops_table.file.stream,c.usedBytes=0,c.contents=null):u.isLink(c.mode)?(c.node_ops=be.ops_table.link.node,c.stream_ops=be.ops_table.link.stream):u.isChrdev(c.mode)&&(c.node_ops=be.ops_table.chrdev.node,c.stream_ops=be.ops_table.chrdev.stream),c.timestamp=Date.now(),o&&(o.contents[i]=c,o.timestamp=c.timestamp),c},getFileDataAsTypedArray:function(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage:function(o,i){var l=o.contents?o.contents.length:0;if(!(l>=i)){var a=1024*1024;i=Math.max(i,l*(l<a?2:1.125)>>>0),l!=0&&(i=Math.max(i,256));var c=o.contents;o.contents=new Uint8Array(i),o.usedBytes>0&&o.contents.set(c.subarray(0,o.usedBytes),0)}},resizeFileStorage:function(o,i){if(o.usedBytes!=i)if(i==0)o.contents=null,o.usedBytes=0;else{var l=o.contents;o.contents=new Uint8Array(i),l&&o.contents.set(l.subarray(0,Math.min(i,o.usedBytes))),o.usedBytes=i}},node_ops:{getattr:function(o){var i={};return i.dev=u.isChrdev(o.mode)?o.id:1,i.ino=o.id,i.mode=o.mode,i.nlink=1,i.uid=0,i.gid=0,i.rdev=o.rdev,u.isDir(o.mode)?i.size=4096:u.isFile(o.mode)?i.size=o.usedBytes:u.isLink(o.mode)?i.size=o.link.length:i.size=0,i.atime=new Date(o.timestamp),i.mtime=new Date(o.timestamp),i.ctime=new Date(o.timestamp),i.blksize=4096,i.blocks=Math.ceil(i.size/i.blksize),i},setattr:function(o,i){i.mode!==void 0&&(o.mode=i.mode),i.timestamp!==void 0&&(o.timestamp=i.timestamp),i.size!==void 0&&be.resizeFileStorage(o,i.size)},lookup:function(o,i){throw u.genericErrors[44]},mknod:function(o,i,l,a){return be.createNode(o,i,l,a)},rename:function(o,i,l){if(u.isDir(o.mode)){var a;try{a=u.lookupNode(i,l)}catch{}if(a)for(var c in a.contents)throw new u.ErrnoError(55)}delete o.parent.contents[o.name],o.parent.timestamp=Date.now(),o.name=l,i.contents[l]=o,i.timestamp=o.parent.timestamp,o.parent=i},unlink:function(o,i){delete o.contents[i],o.timestamp=Date.now()},rmdir:function(o,i){var l=u.lookupNode(o,i);for(var a in l.contents)throw new u.ErrnoError(55);delete o.contents[i],o.timestamp=Date.now()},readdir:function(o){var i=[".",".."];for(var l in o.contents)o.contents.hasOwnProperty(l)&&i.push(l);return i},symlink:function(o,i,l){var a=be.createNode(o,i,41471,0);return a.link=l,a},readlink:function(o){if(!u.isLink(o.mode))throw new u.ErrnoError(28);return o.link}},stream_ops:{read:function(o,i,l,a,c){var d=o.node.contents;if(c>=o.node.usedBytes)return 0;var q=Math.min(o.node.usedBytes-c,a);if(q>8&&d.subarray)i.set(d.subarray(c,c+q),l);else for(var I=0;I<q;I++)i[l+I]=d[c+I];return q},write:function(o,i,l,a,c,d){if(i.buffer===Tt.buffer&&(d=!1),!a)return 0;var q=o.node;if(q.timestamp=Date.now(),i.subarray&&(!q.contents||q.contents.subarray)){if(d)return q.contents=i.subarray(l,l+a),q.usedBytes=a,a;if(q.usedBytes===0&&c===0)return q.contents=i.slice(l,l+a),q.usedBytes=a,a;if(c+a<=q.usedBytes)return q.contents.set(i.subarray(l,l+a),c),a}if(be.expandFileStorage(q,c+a),q.contents.subarray&&i.subarray)q.contents.set(i.subarray(l,l+a),c);else for(var I=0;I<a;I++)q.contents[c+I]=i[l+I];return q.usedBytes=Math.max(q.usedBytes,c+a),a},llseek:function(o,i,l){var a=i;if(l===1?a+=o.position:l===2&&u.isFile(o.node.mode)&&(a+=o.node.usedBytes),a<0)throw new u.ErrnoError(28);return a},allocate:function(o,i,l){be.expandFileStorage(o.node,i+l),o.node.usedBytes=Math.max(o.node.usedBytes,i+l)},mmap:function(o,i,l,a,c){if(!u.isFile(o.node.mode))throw new u.ErrnoError(43);var d,q,I=o.node.contents;if(!(c&2)&&I.buffer===Tt.buffer)q=!1,d=I.byteOffset;else{if((l>0||l+i<I.length)&&(I.subarray?I=I.subarray(l,l+i):I=Array.prototype.slice.call(I,l,l+i)),q=!0,d=ha(i),!d)throw new u.ErrnoError(48);Tt.set(I,d)}return{ptr:d,allocated:q}},msync:function(o,i,l,a,c){return be.stream_ops.write(o,i,0,a,l,!1),0}}};function uc(o,i,l,a){var c=a?"":"al "+o;Mt(o,d=>{oo(d,'Loading data file "'+o+'" failed (no arrayBuffer).'),i(new Uint8Array(d)),c&&Ui()},d=>{if(l)l();else throw'Loading data file "'+o+'" failed.'}),c&&ao()}var u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(o,i={})=>{if(o=cn.resolve(o),!o)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(i=Object.assign(l,i),i.recurse_count>8)throw new u.ErrnoError(32);for(var a=o.split("/").filter(se=>!!se),c=u.root,d="/",q=0;q<a.length;q++){var I=q===a.length-1;if(I&&i.parent)break;if(c=u.lookupNode(c,a[q]),d=De.join2(d,a[q]),u.isMountpoint(c)&&(!I||I&&i.follow_mount)&&(c=c.mounted.root),!I||i.follow)for(var L=0;u.isLink(c.mode);){var J=u.readlink(d);d=cn.resolve(De.dirname(d),J);var ee=u.lookupPath(d,{recurse_count:i.recurse_count+1});if(c=ee.node,L++>40)throw new u.ErrnoError(32)}}return{path:d,node:c}},getPath:o=>{for(var i;;){if(u.isRoot(o)){var l=o.mount.mountpoint;return i?l[l.length-1]!=="/"?l+"/"+i:l+i:l}i=i?o.name+"/"+i:o.name,o=o.parent}},hashName:(o,i)=>{for(var l=0,a=0;a<i.length;a++)l=(l<<5)-l+i.charCodeAt(a)|0;return(o+l>>>0)%u.nameTable.length},hashAddNode:o=>{var i=u.hashName(o.parent.id,o.name);o.name_next=u.nameTable[i],u.nameTable[i]=o},hashRemoveNode:o=>{var i=u.hashName(o.parent.id,o.name);if(u.nameTable[i]===o)u.nameTable[i]=o.name_next;else for(var l=u.nameTable[i];l;){if(l.name_next===o){l.name_next=o.name_next;break}l=l.name_next}},lookupNode:(o,i)=>{var l=u.mayLookup(o);if(l)throw new u.ErrnoError(l,o);for(var a=u.hashName(o.id,i),c=u.nameTable[a];c;c=c.name_next){var d=c.name;if(c.parent.id===o.id&&d===i)return c}return u.lookup(o,i)},createNode:(o,i,l,a)=>{var c=new u.FSNode(o,i,l,a);return u.hashAddNode(c),c},destroyNode:o=>{u.hashRemoveNode(o)},isRoot:o=>o===o.parent,isMountpoint:o=>!!o.mounted,isFile:o=>(o&61440)===32768,isDir:o=>(o&61440)===16384,isLink:o=>(o&61440)===40960,isChrdev:o=>(o&61440)===8192,isBlkdev:o=>(o&61440)===24576,isFIFO:o=>(o&61440)===4096,isSocket:o=>(o&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:o=>{var i=u.flagModes[o];if(typeof i>"u")throw new Error("Unknown file open mode: "+o);return i},flagsToPermissionString:o=>{var i=["r","w","rw"][o&3];return o&512&&(i+="w"),i},nodePermissions:(o,i)=>u.ignorePermissions?0:i.includes("r")&&!(o.mode&292)||i.includes("w")&&!(o.mode&146)||i.includes("x")&&!(o.mode&73)?2:0,mayLookup:o=>{var i=u.nodePermissions(o,"x");return i||(o.node_ops.lookup?0:2)},mayCreate:(o,i)=>{try{var l=u.lookupNode(o,i);return 20}catch{}return u.nodePermissions(o,"wx")},mayDelete:(o,i,l)=>{var a;try{a=u.lookupNode(o,i)}catch(d){return d.errno}var c=u.nodePermissions(o,"wx");if(c)return c;if(l){if(!u.isDir(a.mode))return 54;if(u.isRoot(a)||u.getPath(a)===u.cwd())return 10}else if(u.isDir(a.mode))return 31;return 0},mayOpen:(o,i)=>o?u.isLink(o.mode)?32:u.isDir(o.mode)&&(u.flagsToPermissionString(i)!=="r"||i&512)?31:u.nodePermissions(o,u.flagsToPermissionString(i)):44,MAX_OPEN_FDS:4096,nextfd:(o=0,i=u.MAX_OPEN_FDS)=>{for(var l=o;l<=i;l++)if(!u.streams[l])return l;throw new u.ErrnoError(33)},getStream:o=>u.streams[o],createStream:(o,i,l)=>{u.FSStream||(u.FSStream=function(){this.shared={}},u.FSStream.prototype={},Object.defineProperties(u.FSStream.prototype,{object:{get:function(){return this.node},set:function(c){this.node=c}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(c){this.shared.flags=c}},position:{get:function(){return this.shared.position},set:function(c){this.shared.position=c}}})),o=Object.assign(new u.FSStream,o);var a=u.nextfd(i,l);return o.fd=a,u.streams[a]=o,o},closeStream:o=>{u.streams[o]=null},chrdev_stream_ops:{open:o=>{var i=u.getDevice(o.node.rdev);o.stream_ops=i.stream_ops,o.stream_ops.open&&o.stream_ops.open(o)},llseek:()=>{throw new u.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,i)=>o<<8|i,registerDevice:(o,i)=>{u.devices[o]={stream_ops:i}},getDevice:o=>u.devices[o],getMounts:o=>{for(var i=[],l=[o];l.length;){var a=l.pop();i.push(a),l.push.apply(l,a.mounts)}return i},syncfs:(o,i)=>{typeof o=="function"&&(i=o,o=!1),u.syncFSRequests++,u.syncFSRequests>1&&Be("warning: "+u.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=u.getMounts(u.root.mount),a=0;function c(q){return u.syncFSRequests--,i(q)}function d(q){if(q)return d.errored?void 0:(d.errored=!0,c(q));++a>=l.length&&c(null)}l.forEach(q=>{if(!q.type.syncfs)return d(null);q.type.syncfs(q,o,d)})},mount:(o,i,l)=>{var a=l==="/",c=!l,d;if(a&&u.root)throw new u.ErrnoError(10);if(!a&&!c){var q=u.lookupPath(l,{follow_mount:!1});if(l=q.path,d=q.node,u.isMountpoint(d))throw new u.ErrnoError(10);if(!u.isDir(d.mode))throw new u.ErrnoError(54)}var I={type:o,opts:i,mountpoint:l,mounts:[]},L=o.mount(I);return L.mount=I,I.root=L,a?u.root=L:d&&(d.mounted=I,d.mount&&d.mount.mounts.push(I)),L},unmount:o=>{var i=u.lookupPath(o,{follow_mount:!1});if(!u.isMountpoint(i.node))throw new u.ErrnoError(28);var l=i.node,a=l.mounted,c=u.getMounts(a);Object.keys(u.nameTable).forEach(q=>{for(var I=u.nameTable[q];I;){var L=I.name_next;c.includes(I.mount)&&u.destroyNode(I),I=L}}),l.mounted=null;var d=l.mount.mounts.indexOf(a);l.mount.mounts.splice(d,1)},lookup:(o,i)=>o.node_ops.lookup(o,i),mknod:(o,i,l)=>{var a=u.lookupPath(o,{parent:!0}),c=a.node,d=De.basename(o);if(!d||d==="."||d==="..")throw new u.ErrnoError(28);var q=u.mayCreate(c,d);if(q)throw new u.ErrnoError(q);if(!c.node_ops.mknod)throw new u.ErrnoError(63);return c.node_ops.mknod(c,d,i,l)},create:(o,i)=>(i=i!==void 0?i:438,i&=4095,i|=32768,u.mknod(o,i,0)),mkdir:(o,i)=>(i=i!==void 0?i:511,i&=1023,i|=16384,u.mknod(o,i,0)),mkdirTree:(o,i)=>{for(var l=o.split("/"),a="",c=0;c<l.length;++c)if(l[c]){a+="/"+l[c];try{u.mkdir(a,i)}catch(d){if(d.errno!=20)throw d}}},mkdev:(o,i,l)=>(typeof l>"u"&&(l=i,i=438),i|=8192,u.mknod(o,i,l)),symlink:(o,i)=>{if(!cn.resolve(o))throw new u.ErrnoError(44);var l=u.lookupPath(i,{parent:!0}),a=l.node;if(!a)throw new u.ErrnoError(44);var c=De.basename(i),d=u.mayCreate(a,c);if(d)throw new u.ErrnoError(d);if(!a.node_ops.symlink)throw new u.ErrnoError(63);return a.node_ops.symlink(a,c,o)},rename:(o,i)=>{var l=De.dirname(o),a=De.dirname(i),c=De.basename(o),d=De.basename(i),q,I,L;if(q=u.lookupPath(o,{parent:!0}),I=q.node,q=u.lookupPath(i,{parent:!0}),L=q.node,!I||!L)throw new u.ErrnoError(44);if(I.mount!==L.mount)throw new u.ErrnoError(75);var J=u.lookupNode(I,c),ee=cn.relative(o,a);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=cn.relative(i,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var se;try{se=u.lookupNode(L,d)}catch{}if(J!==se){var P=u.isDir(J.mode),y=u.mayDelete(I,c,P);if(y)throw new u.ErrnoError(y);if(y=se?u.mayDelete(L,d,P):u.mayCreate(L,d),y)throw new u.ErrnoError(y);if(!I.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(J)||se&&u.isMountpoint(se))throw new u.ErrnoError(10);if(L!==I&&(y=u.nodePermissions(I,"w"),y))throw new u.ErrnoError(y);u.hashRemoveNode(J);try{I.node_ops.rename(J,L,d)}catch(g){throw g}finally{u.hashAddNode(J)}}},rmdir:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node,a=De.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!0);if(d)throw new u.ErrnoError(d);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.rmdir(l,a),u.destroyNode(c)},readdir:o=>{var i=u.lookupPath(o,{follow:!0}),l=i.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node;if(!l)throw new u.ErrnoError(44);var a=De.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!1);if(d)throw new u.ErrnoError(d);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.unlink(l,a),u.destroyNode(c)},readlink:o=>{var i=u.lookupPath(o),l=i.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return cn.resolve(u.getPath(l.parent),l.node_ops.readlink(l))},stat:(o,i)=>{var l=u.lookupPath(o,{follow:!i}),a=l.node;if(!a)throw new u.ErrnoError(44);if(!a.node_ops.getattr)throw new u.ErrnoError(63);return a.node_ops.getattr(a)},lstat:o=>u.stat(o,!0),chmod:(o,i,l)=>{var a;if(typeof o=="string"){var c=u.lookupPath(o,{follow:!l});a=c.node}else a=o;if(!a.node_ops.setattr)throw new u.ErrnoError(63);a.node_ops.setattr(a,{mode:i&4095|a.mode&-4096,timestamp:Date.now()})},lchmod:(o,i)=>{u.chmod(o,i,!0)},fchmod:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);u.chmod(l.node,i)},chown:(o,i,l,a)=>{var c;if(typeof o=="string"){var d=u.lookupPath(o,{follow:!a});c=d.node}else c=o;if(!c.node_ops.setattr)throw new u.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown:(o,i,l)=>{u.chown(o,i,l,!0)},fchown:(o,i,l)=>{var a=u.getStream(o);if(!a)throw new u.ErrnoError(8);u.chown(a.node,i,l)},truncate:(o,i)=>{if(i<0)throw new u.ErrnoError(28);var l;if(typeof o=="string"){var a=u.lookupPath(o,{follow:!0});l=a.node}else l=o;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var c=u.nodePermissions(l,"w");if(c)throw new u.ErrnoError(c);l.node_ops.setattr(l,{size:i,timestamp:Date.now()})},ftruncate:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,i)},utime:(o,i,l)=>{var a=u.lookupPath(o,{follow:!0}),c=a.node;c.node_ops.setattr(c,{timestamp:Math.max(i,l)})},open:(o,i,l)=>{if(o==="")throw new u.ErrnoError(44);i=typeof i=="string"?u.modeStringToFlags(i):i,l=typeof l>"u"?438:l,i&64?l=l&4095|32768:l=0;var a;if(typeof o=="object")a=o;else{o=De.normalize(o);try{var c=u.lookupPath(o,{follow:!(i&131072)});a=c.node}catch{}}var d=!1;if(i&64)if(a){if(i&128)throw new u.ErrnoError(20)}else a=u.mknod(o,l,0),d=!0;if(!a)throw new u.ErrnoError(44);if(u.isChrdev(a.mode)&&(i&=-513),i&65536&&!u.isDir(a.mode))throw new u.ErrnoError(54);if(!d){var q=u.mayOpen(a,i);if(q)throw new u.ErrnoError(q)}i&512&&!d&&u.truncate(a,0),i&=-131713;var I=u.createStream({node:a,path:u.getPath(a),flags:i,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1});return I.stream_ops.open&&I.stream_ops.open(I),n.logReadFiles&&!(i&1)&&(u.readFiles||(u.readFiles={}),o in u.readFiles||(u.readFiles[o]=1)),I},close:o=>{if(u.isClosed(o))throw new u.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(i){throw i}finally{u.closeStream(o.fd)}o.fd=null},isClosed:o=>o.fd===null,llseek:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return o.position=o.stream_ops.llseek(o,i,l),o.ungotten=[],o.position},read:(o,i,l,a,c)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if((o.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.read)throw new u.ErrnoError(28);var d=typeof c<"u";if(!d)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var q=o.stream_ops.read(o,i,l,a,c);return d||(o.position+=q),q},write:(o,i,l,a,c,d)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.write)throw new u.ErrnoError(28);o.seekable&&o.flags&1024&&u.llseek(o,0,2);var q=typeof c<"u";if(!q)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var I=o.stream_ops.write(o,i,l,a,c,d);return q||(o.position+=I),I},allocate:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(i<0||l<=0)throw new u.ErrnoError(28);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(o.node.mode)&&!u.isDir(o.node.mode))throw new u.ErrnoError(43);if(!o.stream_ops.allocate)throw new u.ErrnoError(138);o.stream_ops.allocate(o,i,l)},mmap:(o,i,l,a,c)=>{if(a&2&&!(c&2)&&(o.flags&2097155)!==2)throw new u.ErrnoError(2);if((o.flags&2097155)===1)throw new u.ErrnoError(2);if(!o.stream_ops.mmap)throw new u.ErrnoError(43);return o.stream_ops.mmap(o,i,l,a,c)},msync:(o,i,l,a,c)=>o.stream_ops.msync?o.stream_ops.msync(o,i,l,a,c):0,munmap:o=>0,ioctl:(o,i,l)=>{if(!o.stream_ops.ioctl)throw new u.ErrnoError(59);return o.stream_ops.ioctl(o,i,l)},readFile:(o,i={})=>{if(i.flags=i.flags||0,i.encoding=i.encoding||"binary",i.encoding!=="utf8"&&i.encoding!=="binary")throw new Error('Invalid encoding type "'+i.encoding+'"');var l,a=u.open(o,i.flags),c=u.stat(o),d=c.size,q=new Uint8Array(d);return u.read(a,q,0,d,0),i.encoding==="utf8"?l=Qt(q,0):i.encoding==="binary"&&(l=q),u.close(a),l},writeFile:(o,i,l={})=>{l.flags=l.flags||577;var a=u.open(o,l.flags,l.mode);if(typeof i=="string"){var c=new Uint8Array(Yr(i)+1),d=mr(i,c,0,c.length);u.write(a,c,0,d,void 0,l.canOwn)}else if(ArrayBuffer.isView(i))u.write(a,i,0,i.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(a)},cwd:()=>u.currentPath,chdir:o=>{var i=u.lookupPath(o,{follow:!0});if(i.node===null)throw new u.ErrnoError(44);if(!u.isDir(i.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(i.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=i.path},createDefaultDirectories:()=>{u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices:()=>{u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(i,l,a,c,d)=>c}),u.mkdev("/dev/null",u.makedev(1,3)),Vn.register(u.makedev(5,0),Vn.default_tty_ops),Vn.register(u.makedev(6,0),Vn.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var o=ac();u.createDevice("/dev","random",o),u.createDevice("/dev","urandom",o),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{u.mkdir("/proc");var o=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount:()=>{var i=u.createNode(o,"fd",16895,73);return i.node_ops={lookup:(l,a)=>{var c=+a,d=u.getStream(c);if(!d)throw new u.ErrnoError(8);var q={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>d.path}};return q.parent=q,q}},i}},{},"/proc/self/fd")},createStandardStreams:()=>{n.stdin?u.createDevice("/dev","stdin",n.stdin):u.symlink("/dev/tty","/dev/stdin"),n.stdout?u.createDevice("/dev","stdout",null,n.stdout):u.symlink("/dev/tty","/dev/stdout"),n.stderr?u.createDevice("/dev","stderr",null,n.stderr):u.symlink("/dev/tty1","/dev/stderr"),u.open("/dev/stdin",0),u.open("/dev/stdout",1),u.open("/dev/stderr",1)},ensureErrnoError:()=>{u.ErrnoError||(u.ErrnoError=function(i,l){this.node=l,this.setErrno=function(a){this.errno=a},this.setErrno(i),this.message="FS error"},u.ErrnoError.prototype=new Error,u.ErrnoError.prototype.constructor=u.ErrnoError,[44].forEach(o=>{u.genericErrors[o]=new u.ErrnoError(o),u.genericErrors[o].stack="<generic error, no stack>"}))},staticInit:()=>{u.ensureErrnoError(),u.nameTable=new Array(4096),u.mount(be,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:be}},init:(o,i,l)=>{u.init.initialized=!0,u.ensureErrnoError(),n.stdin=o||n.stdin,n.stdout=i||n.stdout,n.stderr=l||n.stderr,u.createStandardStreams()},quit:()=>{u.init.initialized=!1;for(var o=0;o<u.streams.length;o++){var i=u.streams[o];i&&u.close(i)}},getMode:(o,i)=>{var l=0;return o&&(l|=365),i&&(l|=146),l},findObject:(o,i)=>{var l=u.analyzePath(o,i);return l.exists?l.object:null},analyzePath:(o,i)=>{try{var l=u.lookupPath(o,{follow:!i});o=l.path}catch{}var a={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(o,{parent:!0});a.parentExists=!0,a.parentPath=l.path,a.parentObject=l.node,a.name=De.basename(o),l=u.lookupPath(o,{follow:!i}),a.exists=!0,a.path=l.path,a.object=l.node,a.name=l.node.name,a.isRoot=l.path==="/"}catch(c){a.error=c.errno}return a},createPath:(o,i,l,a)=>{o=typeof o=="string"?o:u.getPath(o);for(var c=i.split("/").reverse();c.length;){var d=c.pop();if(d){var q=De.join2(o,d);try{u.mkdir(q)}catch{}o=q}}return q},createFile:(o,i,l,a,c)=>{var d=De.join2(typeof o=="string"?o:u.getPath(o),i),q=u.getMode(a,c);return u.create(d,q)},createDataFile:(o,i,l,a,c,d)=>{var q=i;o&&(o=typeof o=="string"?o:u.getPath(o),q=i?De.join2(o,i):o);var I=u.getMode(a,c),L=u.create(q,I);if(l){if(typeof l=="string"){for(var J=new Array(l.length),ee=0,se=l.length;ee<se;++ee)J[ee]=l.charCodeAt(ee);l=J}u.chmod(L,I|146);var P=u.open(L,577);u.write(P,l,0,l.length,0,d),u.close(P),u.chmod(L,I)}return L},createDevice:(o,i,l,a)=>{var c=De.join2(typeof o=="string"?o:u.getPath(o),i),d=u.getMode(!!l,!!a);u.createDevice.major||(u.createDevice.major=64);var q=u.makedev(u.createDevice.major++,0);return u.registerDevice(q,{open:I=>{I.seekable=!1},close:I=>{a&&a.buffer&&a.buffer.length&&a(10)},read:(I,L,J,ee,se)=>{for(var P=0,y=0;y<ee;y++){var g;try{g=l()}catch{throw new u.ErrnoError(29)}if(g===void 0&&P===0)throw new u.ErrnoError(6);if(g==null)break;P++,L[J+y]=g}return P&&(I.node.timestamp=Date.now()),P},write:(I,L,J,ee,se)=>{for(var P=0;P<ee;P++)try{a(L[J+P])}catch{throw new u.ErrnoError(29)}return ee&&(I.node.timestamp=Date.now()),P}}),u.mkdev(c,d,q)},forceLoadFile:o=>{if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Zt)try{o.contents=co(Zt(o.url),!0),o.usedBytes=o.contents.length}catch{throw new u.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(o,i,l,a,c)=>{function d(){this.lengthKnown=!1,this.chunks=[]}if(d.prototype.get=function(y){if(!(y>this.length-1||y<0)){var g=y%this.chunkSize,E=y/this.chunkSize|0;return this.getter(E)[g]}},d.prototype.setDataGetter=function(y){this.getter=y},d.prototype.cacheLength=function(){var y=new XMLHttpRequest;if(y.open("HEAD",l,!1),y.send(null),!(y.status>=200&&y.status<300||y.status===304))throw new Error("Couldn't load "+l+". Status: "+y.status);var g=Number(y.getResponseHeader("Content-length")),E,O=(E=y.getResponseHeader("Accept-Ranges"))&&E==="bytes",N=(E=y.getResponseHeader("Content-Encoding"))&&E==="gzip",U=1024*1024;O||(U=g);var $=(M,fe)=>{if(M>fe)throw new Error("invalid range ("+M+", "+fe+") or no bytes requested!");if(fe>g-1)throw new Error("only "+g+" bytes available! programmer error!");var _=new XMLHttpRequest;if(_.open("GET",l,!1),g!==U&&_.setRequestHeader("Range","bytes="+M+"-"+fe),_.responseType="arraybuffer",_.overrideMimeType&&_.overrideMimeType("text/plain; charset=x-user-defined"),_.send(null),!(_.status>=200&&_.status<300||_.status===304))throw new Error("Couldn't load "+l+". Status: "+_.status);return _.response!==void 0?new Uint8Array(_.response||[]):co(_.responseText||"",!0)},G=this;G.setDataGetter(M=>{var fe=M*U,_=(M+1)*U-1;if(_=Math.min(_,g-1),typeof G.chunks[M]>"u"&&(G.chunks[M]=$(fe,_)),typeof G.chunks[M]>"u")throw new Error("doXHR failed!");return G.chunks[M]}),(N||!g)&&(U=g=1,g=this.getter(0).length,U=g,It("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=g,this._chunkSize=U,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!Ee)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var q=new d;Object.defineProperties(q,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var I={isDevice:!1,contents:q}}else var I={isDevice:!1,url:l};var L=u.createFile(o,i,I,a,c);I.contents?L.contents=I.contents:I.url&&(L.contents=null,L.url=I.url),Object.defineProperties(L,{usedBytes:{get:function(){return this.contents.length}}});var J={},ee=Object.keys(L.stream_ops);ee.forEach(P=>{var y=L.stream_ops[P];J[P]=function(){return u.forceLoadFile(L),y.apply(null,arguments)}});function se(P,y,g,E,O){var N=P.node.contents;if(O>=N.length)return 0;var U=Math.min(N.length-O,E);if(N.slice)for(var $=0;$<U;$++)y[g+$]=N[O+$];else for(var $=0;$<U;$++)y[g+$]=N.get(O+$);return U}return J.read=(P,y,g,E,O)=>(u.forceLoadFile(L),se(P,y,g,E,O)),J.mmap=(P,y,g,E,O)=>{u.forceLoadFile(L);var N=ha(y);if(!N)throw new u.ErrnoError(48);return se(P,Tt,N,y,g),{ptr:N,allocated:!0}},L.stream_ops=J,L},createPreloadedFile:(o,i,l,a,c,d,q,I,L,J)=>{var ee=i?cn.resolve(De.join2(o,i)):o;function se(P){function y(g){J&&J(),I||u.createDataFile(o,i,g,a,c,L),d&&d(),Ui()}Browser.handledByPreloadPlugin(P,ee,y,()=>{q&&q(),Ui()})||y(P)}ao(),typeof l=="string"?uc(l,P=>se(P),q):se(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=()=>{It("creating db");var d=c.result;d.createObjectStore(u.DB_STORE_NAME)},c.onsuccess=()=>{var d=c.result,q=d.transaction([u.DB_STORE_NAME],"readwrite"),I=q.objectStore(u.DB_STORE_NAME),L=0,J=0,ee=o.length;function se(){J==0?i():l()}o.forEach(P=>{var y=I.put(u.analyzePath(P).object.contents,P);y.onsuccess=()=>{L++,L+J==ee&&se()},y.onerror=()=>{J++,L+J==ee&&se()}}),q.onerror=l},c.onerror=l},loadFilesFromDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=l,c.onsuccess=()=>{var d=c.result;try{var q=d.transaction([u.DB_STORE_NAME],"readonly")}catch(P){l(P);return}var I=q.objectStore(u.DB_STORE_NAME),L=0,J=0,ee=o.length;function se(){J==0?i():l()}o.forEach(P=>{var y=I.get(P);y.onsuccess=()=>{u.analyzePath(P).exists&&u.unlink(P),u.createDataFile(De.dirname(P),De.basename(P),y.result,!0,!0,!0),L++,L+J==ee&&se()},y.onerror=()=>{J++,L+J==ee&&se()}}),q.onerror=l},c.onerror=l}},me={DEFAULT_POLLMASK:5,calculateAt:function(o,i,l){if(De.isAbs(i))return i;var a;if(o===-100)a=u.cwd();else{var c=me.getStreamFromFD(o);a=c.path}if(i.length==0){if(!l)throw new u.ErrnoError(44);return a}return De.join2(a,i)},doStat:function(o,i,l){try{var a=o(i)}catch(I){if(I&&I.node&&De.normalize(i)!==De.normalize(u.getPath(I.node)))return-54;throw I}xe[l>>2]=a.dev,xe[l+8>>2]=a.ino,xe[l+12>>2]=a.mode,et[l+16>>2]=a.nlink,xe[l+20>>2]=a.uid,xe[l+24>>2]=a.gid,xe[l+28>>2]=a.rdev,dt=[a.size>>>0,(Ae=a.size,+Math.abs(Ae)>=1?Ae>0?(Math.min(+Math.floor(Ae/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],xe[l+40>>2]=dt[0],xe[l+44>>2]=dt[1],xe[l+48>>2]=4096,xe[l+52>>2]=a.blocks;var c=a.atime.getTime(),d=a.mtime.getTime(),q=a.ctime.getTime();return dt=[Math.floor(c/1e3)>>>0,(Ae=Math.floor(c/1e3),+Math.abs(Ae)>=1?Ae>0?(Math.min(+Math.floor(Ae/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],xe[l+56>>2]=dt[0],xe[l+60>>2]=dt[1],et[l+64>>2]=c%1e3*1e3,dt=[Math.floor(d/1e3)>>>0,(Ae=Math.floor(d/1e3),+Math.abs(Ae)>=1?Ae>0?(Math.min(+Math.floor(Ae/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],xe[l+72>>2]=dt[0],xe[l+76>>2]=dt[1],et[l+80>>2]=d%1e3*1e3,dt=[Math.floor(q/1e3)>>>0,(Ae=Math.floor(q/1e3),+Math.abs(Ae)>=1?Ae>0?(Math.min(+Math.floor(Ae/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],xe[l+88>>2]=dt[0],xe[l+92>>2]=dt[1],et[l+96>>2]=q%1e3*1e3,dt=[a.ino>>>0,(Ae=a.ino,+Math.abs(Ae)>=1?Ae>0?(Math.min(+Math.floor(Ae/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],xe[l+104>>2]=dt[0],xe[l+108>>2]=dt[1],0},doMsync:function(o,i,l,a,c){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);if(a&2)return 0;var d=yr.slice(o,o+l);u.msync(i,d,c,l,a)},varargs:void 0,get:function(){me.varargs+=4;var o=xe[me.varargs-4>>2];return o},getStr:function(o){var i=pr(o);return i},getStreamFromFD:function(o){var i=u.getStream(o);if(!i)throw new u.ErrnoError(8);return i}};function dc(o,i){try{return o=me.getStr(o),u.chmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function fc(o,i,l,a){try{if(i=me.getStr(i),i=me.calculateAt(o,i),l&-8)return-28;var c=u.lookupPath(i,{follow:!0}),d=c.node;if(!d)return-44;var q="";return l&4&&(q+="r"),l&2&&(q+="w"),l&1&&(q+="x"),q&&u.nodePermissions(d,q)?-2:0}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function hc(o,i){try{return u.fchmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function pc(o,i,l){try{return u.fchown(o,i,l),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function mc(o){return xe[wa()>>2]=o,o}function _c(o,i,l){me.varargs=l;try{var a=me.getStreamFromFD(o);switch(i){case 0:{var c=me.get();if(c<0)return-28;var d;return d=u.createStream(a,c),d.fd}case 1:case 2:return 0;case 3:return a.flags;case 4:{var c=me.get();return a.flags|=c,0}case 5:{var c=me.get(),q=0;return sa[c+q>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return mc(28),-1;default:return-28}}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function yc(o,i){try{var l=me.getStreamFromFD(o);return me.doStat(u.stat,l.path,i)}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}var gc=9007199254740992,wc=-9007199254740992;function pa(o){return o<wc||o>gc?NaN:Number(o)}function bc(o,i){try{return i=pa(i),isNaN(i)?-61:(u.ftruncate(o,i),0)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function qc(o,i){try{if(i===0)return-28;var l=u.cwd(),a=Yr(l)+1;return i<a?-68:(_r(l,o,i),a)}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return-c.errno}}function Nc(o,i,l){me.varargs=l;try{var a=me.getStreamFromFD(o);switch(i){case 21509:case 21505:return a.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return a.tty?0:-59;case 21519:{if(!a.tty)return-59;var c=me.get();return xe[c>>2]=0,0}case 21520:return a.tty?-28:-59;case 21531:{var c=me.get();return u.ioctl(a,i,c)}case 21523:return a.tty?0:-59;case 21524:return a.tty?0:-59;default:return-28}}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function vc(o,i){try{return o=me.getStr(o),me.doStat(u.lstat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function xc(o,i,l){try{return i=me.getStr(i),i=me.calculateAt(o,i),i=De.normalize(i),i[i.length-1]==="/"&&(i=i.substr(0,i.length-1)),u.mkdir(i,l,0),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function Ec(o,i,l,a){try{i=me.getStr(i);var c=a&256,d=a&4096;return a=a&-6401,i=me.calculateAt(o,i,d),me.doStat(c?u.lstat:u.stat,i,l)}catch(q){if(typeof u>"u"||!(q instanceof u.ErrnoError))throw q;return-q.errno}}function Sc(o,i,l,a){me.varargs=a;try{i=me.getStr(i),i=me.calculateAt(o,i);var c=a?me.get():0;return u.open(i,l,c).fd}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function Ic(o,i,l,a){try{if(i=me.getStr(i),i=me.calculateAt(o,i),a<=0)return-28;var c=u.readlink(i),d=Math.min(a,Yr(c)),q=Tt[l+d];return _r(c,l,a+1),Tt[l+d]=q,d}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function Ac(o){try{return o=me.getStr(o),u.rmdir(o),0}catch(i){if(typeof u>"u"||!(i instanceof u.ErrnoError))throw i;return-i.errno}}function kc(o,i){try{return o=me.getStr(o),me.doStat(u.stat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function Oc(o,i,l){try{return i=me.getStr(i),i=me.calculateAt(o,i),l===0?u.unlink(i):l===512?u.rmdir(i):gr("Invalid flags passed to unlinkat"),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function uo(o){return et[o>>2]+xe[o+4>>2]*4294967296}function Tc(o,i,l,a){try{if(i=me.getStr(i),i=me.calculateAt(o,i,!0),l){var q=uo(l),I=xe[l+8>>2];c=q*1e3+I/(1e3*1e3),l+=16,q=uo(l),I=xe[l+8>>2],d=q*1e3+I/(1e3*1e3)}else var c=Date.now(),d=c;return u.utime(i,c,d),0}catch(L){if(typeof u>"u"||!(L instanceof u.ErrnoError))throw L;return-L.errno}}var Cc=!0;function Pc(){return Cc}function Fc(o){return o%4===0&&(o%100!==0||o%400===0)}var Wc=[0,31,60,91,121,152,182,213,244,274,305,335],Dc=[0,31,59,90,120,151,181,212,243,273,304,334];function Lc(o){var i=Fc(o.getFullYear()),l=i?Wc:Dc,a=l[o.getMonth()]+o.getDate()-1;return a}function Rc(o,i){var l=new Date(uo(o)*1e3);xe[i>>2]=l.getSeconds(),xe[i+4>>2]=l.getMinutes(),xe[i+8>>2]=l.getHours(),xe[i+12>>2]=l.getDate(),xe[i+16>>2]=l.getMonth(),xe[i+20>>2]=l.getFullYear()-1900,xe[i+24>>2]=l.getDay();var a=Lc(l)|0;xe[i+28>>2]=a,xe[i+36>>2]=-(l.getTimezoneOffset()*60);var c=new Date(l.getFullYear(),0,1),d=new Date(l.getFullYear(),6,1).getTimezoneOffset(),q=c.getTimezoneOffset(),I=(d!=q&&l.getTimezoneOffset()==Math.min(q,d))|0;xe[i+32>>2]=I}function Bc(o,i,l,a,c,d,q){try{var I=me.getStreamFromFD(a),L=u.mmap(I,o,c,i,l),J=L.ptr;return xe[d>>2]=L.allocated,et[q>>2]=J,0}catch(ee){if(typeof u>"u"||!(ee instanceof u.ErrnoError))throw ee;return-ee.errno}}function Mc(o,i,l,a,c,d){try{var q=me.getStreamFromFD(c);l&2&&me.doMsync(o,q,i,a,d),u.munmap(q)}catch(I){if(typeof u>"u"||!(I instanceof u.ErrnoError))throw I;return-I.errno}}function ma(o){var i=Yr(o)+1,l=ba(i);return l&&mr(o,Tt,l,i),l}function Qc(o,i,l){var a=new Date().getFullYear(),c=new Date(a,0,1),d=new Date(a,6,1),q=c.getTimezoneOffset(),I=d.getTimezoneOffset(),L=Math.max(q,I);et[o>>2]=L*60,xe[i>>2]=+(q!=I);function J(g){var E=g.toTimeString().match(/\(([A-Za-z ]+)\)$/);return E?E[1]:"GMT"}var ee=J(c),se=J(d),P=ma(ee),y=ma(se);I<q?(et[l>>2]=P,et[l+4>>2]=y):(et[l>>2]=y,et[l+4>>2]=P)}function Uc(){return Date.now()}var _a;_a=()=>performance.now();function jc(){return 2147483648}function zc(o){var i=gt.buffer;try{return gt.grow(o-i.byteLength+65535>>>16),oa(),1}catch{}}function Vc(o){var i=yr.length;o=o>>>0;var l=jc();if(o>l)return!1;let a=(L,J)=>L+(J-L%J)%J;for(var c=1;c<=4;c*=2){var d=i*(1+.2/c);d=Math.min(d,o+100663296);var q=Math.min(l,a(Math.max(o,d),65536)),I=zc(q);if(I)return!0}return!1}var fo={};function Hc(){return He||"./this.program"}function ei(){if(!ei.strings){var o=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:Hc()};for(var l in fo)fo[l]===void 0?delete i[l]:i[l]=fo[l];var a=[];for(var l in i)a.push(l+"="+i[l]);ei.strings=a}return ei.strings}function $c(o,i,l){for(var a=0;a<o.length;++a)Tt[i++>>0]=o.charCodeAt(a);l||(Tt[i>>0]=0)}function Jc(o,i){var l=0;return ei().forEach(function(a,c){var d=i+l;et[o+c*4>>2]=d,$c(a,d),l+=a.length+1}),0}function Gc(o,i){var l=ei();et[o>>2]=l.length;var a=0;return l.forEach(function(c){a+=c.length+1}),et[i>>2]=a,0}function Kc(o){try{var i=me.getStreamFromFD(o);return u.close(i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Xc(o,i){try{var l=me.getStreamFromFD(o),a=l.tty?2:u.isDir(l.mode)?3:u.isLink(l.mode)?7:4;return Tt[i>>0]=a,0}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return c.errno}}function Yc(o,i,l,a){for(var c=0,d=0;d<l;d++){var q=et[i>>2],I=et[i+4>>2];i+=8;var L=u.read(o,Tt,q,I,a);if(L<0)return-1;if(c+=L,L<I)break;typeof a<"u"&&(a+=L)}return c}function Zc(o,i,l,a){try{var c=me.getStreamFromFD(o),d=Yc(c,i,l);return et[a>>2]=d,0}catch(q){if(typeof u>"u"||!(q instanceof u.ErrnoError))throw q;return q.errno}}function eu(o,i,l,a){try{if(i=pa(i),isNaN(i))return 61;var c=me.getStreamFromFD(o);return u.llseek(c,i,l),dt=[c.position>>>0,(Ae=c.position,+Math.abs(Ae)>=1?Ae>0?(Math.min(+Math.floor(Ae/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ae-+(~~Ae>>>0))/4294967296)>>>0:0)],xe[a>>2]=dt[0],xe[a+4>>2]=dt[1],c.getdents&&i===0&&l===0&&(c.getdents=null),0}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return d.errno}}function tu(o){try{var i=me.getStreamFromFD(o);return i.stream_ops&&i.stream_ops.fsync?i.stream_ops.fsync(i):0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function nu(o,i,l,a){for(var c=0,d=0;d<l;d++){var q=et[i>>2],I=et[i+4>>2];i+=8;var L=u.write(o,Tt,q,I,a);if(L<0)return-1;c+=L,typeof a<"u"&&(a+=L)}return c}function ru(o,i,l,a){try{var c=me.getStreamFromFD(o),d=nu(c,i,l);return et[a>>2]=d,0}catch(q){if(typeof u>"u"||!(q instanceof u.ErrnoError))throw q;return q.errno}}var ya=function(o,i,l,a){o||(o=this),this.parent=o,this.mount=o.mount,this.mounted=null,this.id=u.nextInode++,this.name=i,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=a},ji=365,zi=146;Object.defineProperties(ya.prototype,{read:{get:function(){return(this.mode&ji)===ji},set:function(o){o?this.mode|=ji:this.mode&=~ji}},write:{get:function(){return(this.mode&zi)===zi},set:function(o){o?this.mode|=zi:this.mode&=~zi}},isFolder:{get:function(){return u.isDir(this.mode)}},isDevice:{get:function(){return u.isChrdev(this.mode)}}}),u.FSNode=ya,u.staticInit();var ga={__syscall_chmod:dc,__syscall_faccessat:fc,__syscall_fchmod:hc,__syscall_fchown32:pc,__syscall_fcntl64:_c,__syscall_fstat64:yc,__syscall_ftruncate64:bc,__syscall_getcwd:qc,__syscall_ioctl:Nc,__syscall_lstat64:vc,__syscall_mkdirat:xc,__syscall_newfstatat:Ec,__syscall_openat:Sc,__syscall_readlinkat:Ic,__syscall_rmdir:Ac,__syscall_stat64:kc,__syscall_unlinkat:Oc,__syscall_utimensat:Tc,_emscripten_get_now_is_monotonic:Pc,_localtime_js:Rc,_mmap_js:Bc,_munmap_js:Mc,_tzset_js:Qc,emscripten_date_now:Uc,emscripten_get_now:_a,emscripten_resize_heap:Vc,environ_get:Jc,environ_sizes_get:Gc,fd_close:Kc,fd_fdstat_get:Xc,fd_read:Zc,fd_seek:eu,fd_sync:tu,fd_write:ru,memory:gt};oc(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._sqlite3_status64=function(){return(n._sqlite3_status64=n.asm.sqlite3_status64).apply(null,arguments)},n._sqlite3_status=function(){return(n._sqlite3_status=n.asm.sqlite3_status).apply(null,arguments)},n._sqlite3_db_status=function(){return(n._sqlite3_db_status=n.asm.sqlite3_db_status).apply(null,arguments)},n._sqlite3_msize=function(){return(n._sqlite3_msize=n.asm.sqlite3_msize).apply(null,arguments)},n._sqlite3_vfs_find=function(){return(n._sqlite3_vfs_find=n.asm.sqlite3_vfs_find).apply(null,arguments)},n._sqlite3_initialize=function(){return(n._sqlite3_initialize=n.asm.sqlite3_initialize).apply(null,arguments)},n._sqlite3_malloc=function(){return(n._sqlite3_malloc=n.asm.sqlite3_malloc).apply(null,arguments)},n._sqlite3_free=function(){return(n._sqlite3_free=n.asm.sqlite3_free).apply(null,arguments)},n._sqlite3_vfs_register=function(){return(n._sqlite3_vfs_register=n.asm.sqlite3_vfs_register).apply(null,arguments)},n._sqlite3_vfs_unregister=function(){return(n._sqlite3_vfs_unregister=n.asm.sqlite3_vfs_unregister).apply(null,arguments)},n._sqlite3_malloc64=function(){return(n._sqlite3_malloc64=n.asm.sqlite3_malloc64).apply(null,arguments)},n._sqlite3_realloc=function(){return(n._sqlite3_realloc=n.asm.sqlite3_realloc).apply(null,arguments)},n._sqlite3_realloc64=function(){return(n._sqlite3_realloc64=n.asm.sqlite3_realloc64).apply(null,arguments)},n._sqlite3_value_text=function(){return(n._sqlite3_value_text=n.asm.sqlite3_value_text).apply(null,arguments)},n._sqlite3_randomness=function(){return(n._sqlite3_randomness=n.asm.sqlite3_randomness).apply(null,arguments)},n._sqlite3_stricmp=function(){return(n._sqlite3_stricmp=n.asm.sqlite3_stricmp).apply(null,arguments)},n._sqlite3_strnicmp=function(){return(n._sqlite3_strnicmp=n.asm.sqlite3_strnicmp).apply(null,arguments)},n._sqlite3_uri_parameter=function(){return(n._sqlite3_uri_parameter=n.asm.sqlite3_uri_parameter).apply(null,arguments)};var wa=n.___errno_location=function(){return(wa=n.___errno_location=n.asm.__errno_location).apply(null,arguments)};n._sqlite3_uri_boolean=function(){return(n._sqlite3_uri_boolean=n.asm.sqlite3_uri_boolean).apply(null,arguments)},n._sqlite3_serialize=function(){return(n._sqlite3_serialize=n.asm.sqlite3_serialize).apply(null,arguments)},n._sqlite3_prepare_v2=function(){return(n._sqlite3_prepare_v2=n.asm.sqlite3_prepare_v2).apply(null,arguments)},n._sqlite3_step=function(){return(n._sqlite3_step=n.asm.sqlite3_step).apply(null,arguments)},n._sqlite3_column_int64=function(){return(n._sqlite3_column_int64=n.asm.sqlite3_column_int64).apply(null,arguments)},n._sqlite3_column_int=function(){return(n._sqlite3_column_int=n.asm.sqlite3_column_int).apply(null,arguments)},n._sqlite3_finalize=function(){return(n._sqlite3_finalize=n.asm.sqlite3_finalize).apply(null,arguments)},n._sqlite3_file_control=function(){return(n._sqlite3_file_control=n.asm.sqlite3_file_control).apply(null,arguments)},n._sqlite3_reset=function(){return(n._sqlite3_reset=n.asm.sqlite3_reset).apply(null,arguments)},n._sqlite3_deserialize=function(){return(n._sqlite3_deserialize=n.asm.sqlite3_deserialize).apply(null,arguments)},n._sqlite3_clear_bindings=function(){return(n._sqlite3_clear_bindings=n.asm.sqlite3_clear_bindings).apply(null,arguments)},n._sqlite3_value_blob=function(){return(n._sqlite3_value_blob=n.asm.sqlite3_value_blob).apply(null,arguments)},n._sqlite3_value_bytes=function(){return(n._sqlite3_value_bytes=n.asm.sqlite3_value_bytes).apply(null,arguments)},n._sqlite3_value_double=function(){return(n._sqlite3_value_double=n.asm.sqlite3_value_double).apply(null,arguments)},n._sqlite3_value_int=function(){return(n._sqlite3_value_int=n.asm.sqlite3_value_int).apply(null,arguments)},n._sqlite3_value_int64=function(){return(n._sqlite3_value_int64=n.asm.sqlite3_value_int64).apply(null,arguments)},n._sqlite3_value_subtype=function(){return(n._sqlite3_value_subtype=n.asm.sqlite3_value_subtype).apply(null,arguments)},n._sqlite3_value_pointer=function(){return(n._sqlite3_value_pointer=n.asm.sqlite3_value_pointer).apply(null,arguments)},n._sqlite3_value_type=function(){return(n._sqlite3_value_type=n.asm.sqlite3_value_type).apply(null,arguments)},n._sqlite3_value_nochange=function(){return(n._sqlite3_value_nochange=n.asm.sqlite3_value_nochange).apply(null,arguments)},n._sqlite3_value_frombind=function(){return(n._sqlite3_value_frombind=n.asm.sqlite3_value_frombind).apply(null,arguments)},n._sqlite3_value_dup=function(){return(n._sqlite3_value_dup=n.asm.sqlite3_value_dup).apply(null,arguments)},n._sqlite3_value_free=function(){return(n._sqlite3_value_free=n.asm.sqlite3_value_free).apply(null,arguments)},n._sqlite3_result_blob=function(){return(n._sqlite3_result_blob=n.asm.sqlite3_result_blob).apply(null,arguments)},n._sqlite3_result_error_toobig=function(){return(n._sqlite3_result_error_toobig=n.asm.sqlite3_result_error_toobig).apply(null,arguments)},n._sqlite3_result_error_nomem=function(){return(n._sqlite3_result_error_nomem=n.asm.sqlite3_result_error_nomem).apply(null,arguments)},n._sqlite3_result_double=function(){return(n._sqlite3_result_double=n.asm.sqlite3_result_double).apply(null,arguments)},n._sqlite3_result_error=function(){return(n._sqlite3_result_error=n.asm.sqlite3_result_error).apply(null,arguments)},n._sqlite3_result_int=function(){return(n._sqlite3_result_int=n.asm.sqlite3_result_int).apply(null,arguments)},n._sqlite3_result_int64=function(){return(n._sqlite3_result_int64=n.asm.sqlite3_result_int64).apply(null,arguments)},n._sqlite3_result_null=function(){return(n._sqlite3_result_null=n.asm.sqlite3_result_null).apply(null,arguments)},n._sqlite3_result_pointer=function(){return(n._sqlite3_result_pointer=n.asm.sqlite3_result_pointer).apply(null,arguments)},n._sqlite3_result_subtype=function(){return(n._sqlite3_result_subtype=n.asm.sqlite3_result_subtype).apply(null,arguments)},n._sqlite3_result_text=function(){return(n._sqlite3_result_text=n.asm.sqlite3_result_text).apply(null,arguments)},n._sqlite3_result_zeroblob=function(){return(n._sqlite3_result_zeroblob=n.asm.sqlite3_result_zeroblob).apply(null,arguments)},n._sqlite3_result_zeroblob64=function(){return(n._sqlite3_result_zeroblob64=n.asm.sqlite3_result_zeroblob64).apply(null,arguments)},n._sqlite3_result_error_code=function(){return(n._sqlite3_result_error_code=n.asm.sqlite3_result_error_code).apply(null,arguments)},n._sqlite3_user_data=function(){return(n._sqlite3_user_data=n.asm.sqlite3_user_data).apply(null,arguments)},n._sqlite3_context_db_handle=function(){return(n._sqlite3_context_db_handle=n.asm.sqlite3_context_db_handle).apply(null,arguments)},n._sqlite3_vtab_nochange=function(){return(n._sqlite3_vtab_nochange=n.asm.sqlite3_vtab_nochange).apply(null,arguments)},n._sqlite3_vtab_in_first=function(){return(n._sqlite3_vtab_in_first=n.asm.sqlite3_vtab_in_first).apply(null,arguments)},n._sqlite3_vtab_in_next=function(){return(n._sqlite3_vtab_in_next=n.asm.sqlite3_vtab_in_next).apply(null,arguments)},n._sqlite3_aggregate_context=function(){return(n._sqlite3_aggregate_context=n.asm.sqlite3_aggregate_context).apply(null,arguments)},n._sqlite3_get_auxdata=function(){return(n._sqlite3_get_auxdata=n.asm.sqlite3_get_auxdata).apply(null,arguments)},n._sqlite3_set_auxdata=function(){return(n._sqlite3_set_auxdata=n.asm.sqlite3_set_auxdata).apply(null,arguments)},n._sqlite3_column_count=function(){return(n._sqlite3_column_count=n.asm.sqlite3_column_count).apply(null,arguments)},n._sqlite3_data_count=function(){return(n._sqlite3_data_count=n.asm.sqlite3_data_count).apply(null,arguments)},n._sqlite3_column_blob=function(){return(n._sqlite3_column_blob=n.asm.sqlite3_column_blob).apply(null,arguments)},n._sqlite3_column_bytes=function(){return(n._sqlite3_column_bytes=n.asm.sqlite3_column_bytes).apply(null,arguments)},n._sqlite3_column_double=function(){return(n._sqlite3_column_double=n.asm.sqlite3_column_double).apply(null,arguments)},n._sqlite3_column_text=function(){return(n._sqlite3_column_text=n.asm.sqlite3_column_text).apply(null,arguments)},n._sqlite3_column_value=function(){return(n._sqlite3_column_value=n.asm.sqlite3_column_value).apply(null,arguments)},n._sqlite3_column_type=function(){return(n._sqlite3_column_type=n.asm.sqlite3_column_type).apply(null,arguments)},n._sqlite3_column_name=function(){return(n._sqlite3_column_name=n.asm.sqlite3_column_name).apply(null,arguments)},n._sqlite3_bind_blob=function(){return(n._sqlite3_bind_blob=n.asm.sqlite3_bind_blob).apply(null,arguments)},n._sqlite3_bind_double=function(){return(n._sqlite3_bind_double=n.asm.sqlite3_bind_double).apply(null,arguments)},n._sqlite3_bind_int=function(){return(n._sqlite3_bind_int=n.asm.sqlite3_bind_int).apply(null,arguments)},n._sqlite3_bind_int64=function(){return(n._sqlite3_bind_int64=n.asm.sqlite3_bind_int64).apply(null,arguments)},n._sqlite3_bind_null=function(){return(n._sqlite3_bind_null=n.asm.sqlite3_bind_null).apply(null,arguments)},n._sqlite3_bind_pointer=function(){return(n._sqlite3_bind_pointer=n.asm.sqlite3_bind_pointer).apply(null,arguments)},n._sqlite3_bind_text=function(){return(n._sqlite3_bind_text=n.asm.sqlite3_bind_text).apply(null,arguments)},n._sqlite3_bind_parameter_count=function(){return(n._sqlite3_bind_parameter_count=n.asm.sqlite3_bind_parameter_count).apply(null,arguments)},n._sqlite3_bind_parameter_index=function(){return(n._sqlite3_bind_parameter_index=n.asm.sqlite3_bind_parameter_index).apply(null,arguments)},n._sqlite3_db_handle=function(){return(n._sqlite3_db_handle=n.asm.sqlite3_db_handle).apply(null,arguments)},n._sqlite3_stmt_readonly=function(){return(n._sqlite3_stmt_readonly=n.asm.sqlite3_stmt_readonly).apply(null,arguments)},n._sqlite3_stmt_isexplain=function(){return(n._sqlite3_stmt_isexplain=n.asm.sqlite3_stmt_isexplain).apply(null,arguments)},n._sqlite3_stmt_status=function(){return(n._sqlite3_stmt_status=n.asm.sqlite3_stmt_status).apply(null,arguments)},n._sqlite3_sql=function(){return(n._sqlite3_sql=n.asm.sqlite3_sql).apply(null,arguments)},n._sqlite3_expanded_sql=function(){return(n._sqlite3_expanded_sql=n.asm.sqlite3_expanded_sql).apply(null,arguments)},n._sqlite3_preupdate_old=function(){return(n._sqlite3_preupdate_old=n.asm.sqlite3_preupdate_old).apply(null,arguments)},n._sqlite3_preupdate_count=function(){return(n._sqlite3_preupdate_count=n.asm.sqlite3_preupdate_count).apply(null,arguments)},n._sqlite3_preupdate_depth=function(){return(n._sqlite3_preupdate_depth=n.asm.sqlite3_preupdate_depth).apply(null,arguments)},n._sqlite3_preupdate_blobwrite=function(){return(n._sqlite3_preupdate_blobwrite=n.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},n._sqlite3_preupdate_new=function(){return(n._sqlite3_preupdate_new=n.asm.sqlite3_preupdate_new).apply(null,arguments)},n._sqlite3_value_numeric_type=function(){return(n._sqlite3_value_numeric_type=n.asm.sqlite3_value_numeric_type).apply(null,arguments)},n._sqlite3_errmsg=function(){return(n._sqlite3_errmsg=n.asm.sqlite3_errmsg).apply(null,arguments)},n._sqlite3_set_authorizer=function(){return(n._sqlite3_set_authorizer=n.asm.sqlite3_set_authorizer).apply(null,arguments)},n._sqlite3_strglob=function(){return(n._sqlite3_strglob=n.asm.sqlite3_strglob).apply(null,arguments)},n._sqlite3_strlike=function(){return(n._sqlite3_strlike=n.asm.sqlite3_strlike).apply(null,arguments)},n._sqlite3_exec=function(){return(n._sqlite3_exec=n.asm.sqlite3_exec).apply(null,arguments)},n._sqlite3_auto_extension=function(){return(n._sqlite3_auto_extension=n.asm.sqlite3_auto_extension).apply(null,arguments)},n._sqlite3_cancel_auto_extension=function(){return(n._sqlite3_cancel_auto_extension=n.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},n._sqlite3_reset_auto_extension=function(){return(n._sqlite3_reset_auto_extension=n.asm.sqlite3_reset_auto_extension).apply(null,arguments)},n._sqlite3_prepare_v3=function(){return(n._sqlite3_prepare_v3=n.asm.sqlite3_prepare_v3).apply(null,arguments)},n._sqlite3_create_module=function(){return(n._sqlite3_create_module=n.asm.sqlite3_create_module).apply(null,arguments)},n._sqlite3_create_module_v2=function(){return(n._sqlite3_create_module_v2=n.asm.sqlite3_create_module_v2).apply(null,arguments)},n._sqlite3_drop_modules=function(){return(n._sqlite3_drop_modules=n.asm.sqlite3_drop_modules).apply(null,arguments)},n._sqlite3_declare_vtab=function(){return(n._sqlite3_declare_vtab=n.asm.sqlite3_declare_vtab).apply(null,arguments)},n._sqlite3_vtab_on_conflict=function(){return(n._sqlite3_vtab_on_conflict=n.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},n._sqlite3_vtab_collation=function(){return(n._sqlite3_vtab_collation=n.asm.sqlite3_vtab_collation).apply(null,arguments)},n._sqlite3_vtab_in=function(){return(n._sqlite3_vtab_in=n.asm.sqlite3_vtab_in).apply(null,arguments)},n._sqlite3_vtab_rhs_value=function(){return(n._sqlite3_vtab_rhs_value=n.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},n._sqlite3_vtab_distinct=function(){return(n._sqlite3_vtab_distinct=n.asm.sqlite3_vtab_distinct).apply(null,arguments)},n._sqlite3_keyword_name=function(){return(n._sqlite3_keyword_name=n.asm.sqlite3_keyword_name).apply(null,arguments)},n._sqlite3_keyword_count=function(){return(n._sqlite3_keyword_count=n.asm.sqlite3_keyword_count).apply(null,arguments)},n._sqlite3_keyword_check=function(){return(n._sqlite3_keyword_check=n.asm.sqlite3_keyword_check).apply(null,arguments)},n._sqlite3_complete=function(){return(n._sqlite3_complete=n.asm.sqlite3_complete).apply(null,arguments)},n._sqlite3_libversion=function(){return(n._sqlite3_libversion=n.asm.sqlite3_libversion).apply(null,arguments)},n._sqlite3_libversion_number=function(){return(n._sqlite3_libversion_number=n.asm.sqlite3_libversion_number).apply(null,arguments)},n._sqlite3_shutdown=function(){return(n._sqlite3_shutdown=n.asm.sqlite3_shutdown).apply(null,arguments)},n._sqlite3_last_insert_rowid=function(){return(n._sqlite3_last_insert_rowid=n.asm.sqlite3_last_insert_rowid).apply(null,arguments)},n._sqlite3_set_last_insert_rowid=function(){return(n._sqlite3_set_last_insert_rowid=n.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},n._sqlite3_changes64=function(){return(n._sqlite3_changes64=n.asm.sqlite3_changes64).apply(null,arguments)},n._sqlite3_changes=function(){return(n._sqlite3_changes=n.asm.sqlite3_changes).apply(null,arguments)},n._sqlite3_total_changes64=function(){return(n._sqlite3_total_changes64=n.asm.sqlite3_total_changes64).apply(null,arguments)},n._sqlite3_total_changes=function(){return(n._sqlite3_total_changes=n.asm.sqlite3_total_changes).apply(null,arguments)},n._sqlite3_txn_state=function(){return(n._sqlite3_txn_state=n.asm.sqlite3_txn_state).apply(null,arguments)},n._sqlite3_close_v2=function(){return(n._sqlite3_close_v2=n.asm.sqlite3_close_v2).apply(null,arguments)},n._sqlite3_busy_handler=function(){return(n._sqlite3_busy_handler=n.asm.sqlite3_busy_handler).apply(null,arguments)},n._sqlite3_progress_handler=function(){return(n._sqlite3_progress_handler=n.asm.sqlite3_progress_handler).apply(null,arguments)},n._sqlite3_busy_timeout=function(){return(n._sqlite3_busy_timeout=n.asm.sqlite3_busy_timeout).apply(null,arguments)},n._sqlite3_create_function=function(){return(n._sqlite3_create_function=n.asm.sqlite3_create_function).apply(null,arguments)},n._sqlite3_create_function_v2=function(){return(n._sqlite3_create_function_v2=n.asm.sqlite3_create_function_v2).apply(null,arguments)},n._sqlite3_create_window_function=function(){return(n._sqlite3_create_window_function=n.asm.sqlite3_create_window_function).apply(null,arguments)},n._sqlite3_overload_function=function(){return(n._sqlite3_overload_function=n.asm.sqlite3_overload_function).apply(null,arguments)},n._sqlite3_trace_v2=function(){return(n._sqlite3_trace_v2=n.asm.sqlite3_trace_v2).apply(null,arguments)},n._sqlite3_commit_hook=function(){return(n._sqlite3_commit_hook=n.asm.sqlite3_commit_hook).apply(null,arguments)},n._sqlite3_update_hook=function(){return(n._sqlite3_update_hook=n.asm.sqlite3_update_hook).apply(null,arguments)},n._sqlite3_rollback_hook=function(){return(n._sqlite3_rollback_hook=n.asm.sqlite3_rollback_hook).apply(null,arguments)},n._sqlite3_preupdate_hook=function(){return(n._sqlite3_preupdate_hook=n.asm.sqlite3_preupdate_hook).apply(null,arguments)},n._sqlite3_error_offset=function(){return(n._sqlite3_error_offset=n.asm.sqlite3_error_offset).apply(null,arguments)},n._sqlite3_errcode=function(){return(n._sqlite3_errcode=n.asm.sqlite3_errcode).apply(null,arguments)},n._sqlite3_extended_errcode=function(){return(n._sqlite3_extended_errcode=n.asm.sqlite3_extended_errcode).apply(null,arguments)},n._sqlite3_errstr=function(){return(n._sqlite3_errstr=n.asm.sqlite3_errstr).apply(null,arguments)},n._sqlite3_limit=function(){return(n._sqlite3_limit=n.asm.sqlite3_limit).apply(null,arguments)},n._sqlite3_open=function(){return(n._sqlite3_open=n.asm.sqlite3_open).apply(null,arguments)},n._sqlite3_open_v2=function(){return(n._sqlite3_open_v2=n.asm.sqlite3_open_v2).apply(null,arguments)},n._sqlite3_create_collation=function(){return(n._sqlite3_create_collation=n.asm.sqlite3_create_collation).apply(null,arguments)},n._sqlite3_create_collation_v2=function(){return(n._sqlite3_create_collation_v2=n.asm.sqlite3_create_collation_v2).apply(null,arguments)},n._sqlite3_collation_needed=function(){return(n._sqlite3_collation_needed=n.asm.sqlite3_collation_needed).apply(null,arguments)},n._sqlite3_get_autocommit=function(){return(n._sqlite3_get_autocommit=n.asm.sqlite3_get_autocommit).apply(null,arguments)},n._sqlite3_table_column_metadata=function(){return(n._sqlite3_table_column_metadata=n.asm.sqlite3_table_column_metadata).apply(null,arguments)},n._sqlite3_extended_result_codes=function(){return(n._sqlite3_extended_result_codes=n.asm.sqlite3_extended_result_codes).apply(null,arguments)},n._sqlite3_uri_key=function(){return(n._sqlite3_uri_key=n.asm.sqlite3_uri_key).apply(null,arguments)},n._sqlite3_uri_int64=function(){return(n._sqlite3_uri_int64=n.asm.sqlite3_uri_int64).apply(null,arguments)},n._sqlite3_db_name=function(){return(n._sqlite3_db_name=n.asm.sqlite3_db_name).apply(null,arguments)},n._sqlite3_db_filename=function(){return(n._sqlite3_db_filename=n.asm.sqlite3_db_filename).apply(null,arguments)},n._sqlite3_compileoption_used=function(){return(n._sqlite3_compileoption_used=n.asm.sqlite3_compileoption_used).apply(null,arguments)},n._sqlite3_compileoption_get=function(){return(n._sqlite3_compileoption_get=n.asm.sqlite3_compileoption_get).apply(null,arguments)},n._sqlite3session_diff=function(){return(n._sqlite3session_diff=n.asm.sqlite3session_diff).apply(null,arguments)},n._sqlite3session_attach=function(){return(n._sqlite3session_attach=n.asm.sqlite3session_attach).apply(null,arguments)},n._sqlite3session_create=function(){return(n._sqlite3session_create=n.asm.sqlite3session_create).apply(null,arguments)},n._sqlite3session_delete=function(){return(n._sqlite3session_delete=n.asm.sqlite3session_delete).apply(null,arguments)},n._sqlite3session_table_filter=function(){return(n._sqlite3session_table_filter=n.asm.sqlite3session_table_filter).apply(null,arguments)},n._sqlite3session_changeset=function(){return(n._sqlite3session_changeset=n.asm.sqlite3session_changeset).apply(null,arguments)},n._sqlite3session_changeset_strm=function(){return(n._sqlite3session_changeset_strm=n.asm.sqlite3session_changeset_strm).apply(null,arguments)},n._sqlite3session_patchset_strm=function(){return(n._sqlite3session_patchset_strm=n.asm.sqlite3session_patchset_strm).apply(null,arguments)},n._sqlite3session_patchset=function(){return(n._sqlite3session_patchset=n.asm.sqlite3session_patchset).apply(null,arguments)},n._sqlite3session_enable=function(){return(n._sqlite3session_enable=n.asm.sqlite3session_enable).apply(null,arguments)},n._sqlite3session_indirect=function(){return(n._sqlite3session_indirect=n.asm.sqlite3session_indirect).apply(null,arguments)},n._sqlite3session_isempty=function(){return(n._sqlite3session_isempty=n.asm.sqlite3session_isempty).apply(null,arguments)},n._sqlite3session_memory_used=function(){return(n._sqlite3session_memory_used=n.asm.sqlite3session_memory_used).apply(null,arguments)},n._sqlite3session_object_config=function(){return(n._sqlite3session_object_config=n.asm.sqlite3session_object_config).apply(null,arguments)},n._sqlite3session_changeset_size=function(){return(n._sqlite3session_changeset_size=n.asm.sqlite3session_changeset_size).apply(null,arguments)},n._sqlite3changeset_start=function(){return(n._sqlite3changeset_start=n.asm.sqlite3changeset_start).apply(null,arguments)},n._sqlite3changeset_start_v2=function(){return(n._sqlite3changeset_start_v2=n.asm.sqlite3changeset_start_v2).apply(null,arguments)},n._sqlite3changeset_start_strm=function(){return(n._sqlite3changeset_start_strm=n.asm.sqlite3changeset_start_strm).apply(null,arguments)},n._sqlite3changeset_start_v2_strm=function(){return(n._sqlite3changeset_start_v2_strm=n.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},n._sqlite3changeset_next=function(){return(n._sqlite3changeset_next=n.asm.sqlite3changeset_next).apply(null,arguments)},n._sqlite3changeset_op=function(){return(n._sqlite3changeset_op=n.asm.sqlite3changeset_op).apply(null,arguments)},n._sqlite3changeset_pk=function(){return(n._sqlite3changeset_pk=n.asm.sqlite3changeset_pk).apply(null,arguments)},n._sqlite3changeset_old=function(){return(n._sqlite3changeset_old=n.asm.sqlite3changeset_old).apply(null,arguments)},n._sqlite3changeset_new=function(){return(n._sqlite3changeset_new=n.asm.sqlite3changeset_new).apply(null,arguments)},n._sqlite3changeset_conflict=function(){return(n._sqlite3changeset_conflict=n.asm.sqlite3changeset_conflict).apply(null,arguments)},n._sqlite3changeset_fk_conflicts=function(){return(n._sqlite3changeset_fk_conflicts=n.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},n._sqlite3changeset_finalize=function(){return(n._sqlite3changeset_finalize=n.asm.sqlite3changeset_finalize).apply(null,arguments)},n._sqlite3changeset_invert=function(){return(n._sqlite3changeset_invert=n.asm.sqlite3changeset_invert).apply(null,arguments)},n._sqlite3changeset_invert_strm=function(){return(n._sqlite3changeset_invert_strm=n.asm.sqlite3changeset_invert_strm).apply(null,arguments)},n._sqlite3changeset_apply_v2=function(){return(n._sqlite3changeset_apply_v2=n.asm.sqlite3changeset_apply_v2).apply(null,arguments)},n._sqlite3changeset_apply=function(){return(n._sqlite3changeset_apply=n.asm.sqlite3changeset_apply).apply(null,arguments)},n._sqlite3changeset_apply_v2_strm=function(){return(n._sqlite3changeset_apply_v2_strm=n.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},n._sqlite3changeset_apply_strm=function(){return(n._sqlite3changeset_apply_strm=n.asm.sqlite3changeset_apply_strm).apply(null,arguments)},n._sqlite3changegroup_new=function(){return(n._sqlite3changegroup_new=n.asm.sqlite3changegroup_new).apply(null,arguments)},n._sqlite3changegroup_add=function(){return(n._sqlite3changegroup_add=n.asm.sqlite3changegroup_add).apply(null,arguments)},n._sqlite3changegroup_output=function(){return(n._sqlite3changegroup_output=n.asm.sqlite3changegroup_output).apply(null,arguments)},n._sqlite3changegroup_add_strm=function(){return(n._sqlite3changegroup_add_strm=n.asm.sqlite3changegroup_add_strm).apply(null,arguments)},n._sqlite3changegroup_output_strm=function(){return(n._sqlite3changegroup_output_strm=n.asm.sqlite3changegroup_output_strm).apply(null,arguments)},n._sqlite3changegroup_delete=function(){return(n._sqlite3changegroup_delete=n.asm.sqlite3changegroup_delete).apply(null,arguments)},n._sqlite3changeset_concat=function(){return(n._sqlite3changeset_concat=n.asm.sqlite3changeset_concat).apply(null,arguments)},n._sqlite3changeset_concat_strm=function(){return(n._sqlite3changeset_concat_strm=n.asm.sqlite3changeset_concat_strm).apply(null,arguments)},n._sqlite3session_config=function(){return(n._sqlite3session_config=n.asm.sqlite3session_config).apply(null,arguments)},n._sqlite3_sourceid=function(){return(n._sqlite3_sourceid=n.asm.sqlite3_sourceid).apply(null,arguments)},n._sqlite3_wasm_pstack_ptr=function(){return(n._sqlite3_wasm_pstack_ptr=n.asm.sqlite3_wasm_pstack_ptr).apply(null,arguments)},n._sqlite3_wasm_pstack_restore=function(){return(n._sqlite3_wasm_pstack_restore=n.asm.sqlite3_wasm_pstack_restore).apply(null,arguments)},n._sqlite3_wasm_pstack_alloc=function(){return(n._sqlite3_wasm_pstack_alloc=n.asm.sqlite3_wasm_pstack_alloc).apply(null,arguments)},n._sqlite3_wasm_pstack_remaining=function(){return(n._sqlite3_wasm_pstack_remaining=n.asm.sqlite3_wasm_pstack_remaining).apply(null,arguments)},n._sqlite3_wasm_pstack_quota=function(){return(n._sqlite3_wasm_pstack_quota=n.asm.sqlite3_wasm_pstack_quota).apply(null,arguments)},n._sqlite3_wasm_db_error=function(){return(n._sqlite3_wasm_db_error=n.asm.sqlite3_wasm_db_error).apply(null,arguments)},n._sqlite3_wasm_test_struct=function(){return(n._sqlite3_wasm_test_struct=n.asm.sqlite3_wasm_test_struct).apply(null,arguments)},n._sqlite3_wasm_enum_json=function(){return(n._sqlite3_wasm_enum_json=n.asm.sqlite3_wasm_enum_json).apply(null,arguments)},n._sqlite3_wasm_vfs_unlink=function(){return(n._sqlite3_wasm_vfs_unlink=n.asm.sqlite3_wasm_vfs_unlink).apply(null,arguments)},n._sqlite3_wasm_db_vfs=function(){return(n._sqlite3_wasm_db_vfs=n.asm.sqlite3_wasm_db_vfs).apply(null,arguments)},n._sqlite3_wasm_db_reset=function(){return(n._sqlite3_wasm_db_reset=n.asm.sqlite3_wasm_db_reset).apply(null,arguments)},n._sqlite3_wasm_db_export_chunked=function(){return(n._sqlite3_wasm_db_export_chunked=n.asm.sqlite3_wasm_db_export_chunked).apply(null,arguments)},n._sqlite3_wasm_db_serialize=function(){return(n._sqlite3_wasm_db_serialize=n.asm.sqlite3_wasm_db_serialize).apply(null,arguments)},n._sqlite3_wasm_vfs_create_file=function(){return(n._sqlite3_wasm_vfs_create_file=n.asm.sqlite3_wasm_vfs_create_file).apply(null,arguments)},n._sqlite3_wasm_posix_create_file=function(){return(n._sqlite3_wasm_posix_create_file=n.asm.sqlite3_wasm_posix_create_file).apply(null,arguments)},n._sqlite3_wasm_kvvfsMakeKeyOnPstack=function(){return(n._sqlite3_wasm_kvvfsMakeKeyOnPstack=n.asm.sqlite3_wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},n._sqlite3_wasm_kvvfs_methods=function(){return(n._sqlite3_wasm_kvvfs_methods=n.asm.sqlite3_wasm_kvvfs_methods).apply(null,arguments)},n._sqlite3_wasm_vtab_config=function(){return(n._sqlite3_wasm_vtab_config=n.asm.sqlite3_wasm_vtab_config).apply(null,arguments)},n._sqlite3_wasm_db_config_ip=function(){return(n._sqlite3_wasm_db_config_ip=n.asm.sqlite3_wasm_db_config_ip).apply(null,arguments)},n._sqlite3_wasm_db_config_pii=function(){return(n._sqlite3_wasm_db_config_pii=n.asm.sqlite3_wasm_db_config_pii).apply(null,arguments)},n._sqlite3_wasm_db_config_s=function(){return(n._sqlite3_wasm_db_config_s=n.asm.sqlite3_wasm_db_config_s).apply(null,arguments)},n._sqlite3_wasm_config_i=function(){return(n._sqlite3_wasm_config_i=n.asm.sqlite3_wasm_config_i).apply(null,arguments)},n._sqlite3_wasm_config_ii=function(){return(n._sqlite3_wasm_config_ii=n.asm.sqlite3_wasm_config_ii).apply(null,arguments)},n._sqlite3_wasm_config_j=function(){return(n._sqlite3_wasm_config_j=n.asm.sqlite3_wasm_config_j).apply(null,arguments)},n._sqlite3_wasm_init_wasmfs=function(){return(n._sqlite3_wasm_init_wasmfs=n.asm.sqlite3_wasm_init_wasmfs).apply(null,arguments)},n._sqlite3_wasm_test_intptr=function(){return(n._sqlite3_wasm_test_intptr=n.asm.sqlite3_wasm_test_intptr).apply(null,arguments)},n._sqlite3_wasm_test_voidptr=function(){return(n._sqlite3_wasm_test_voidptr=n.asm.sqlite3_wasm_test_voidptr).apply(null,arguments)},n._sqlite3_wasm_test_int64_max=function(){return(n._sqlite3_wasm_test_int64_max=n.asm.sqlite3_wasm_test_int64_max).apply(null,arguments)},n._sqlite3_wasm_test_int64_min=function(){return(n._sqlite3_wasm_test_int64_min=n.asm.sqlite3_wasm_test_int64_min).apply(null,arguments)},n._sqlite3_wasm_test_int64_times2=function(){return(n._sqlite3_wasm_test_int64_times2=n.asm.sqlite3_wasm_test_int64_times2).apply(null,arguments)},n._sqlite3_wasm_test_int64_minmax=function(){return(n._sqlite3_wasm_test_int64_minmax=n.asm.sqlite3_wasm_test_int64_minmax).apply(null,arguments)},n._sqlite3_wasm_test_int64ptr=function(){return(n._sqlite3_wasm_test_int64ptr=n.asm.sqlite3_wasm_test_int64ptr).apply(null,arguments)},n._sqlite3_wasm_test_stack_overflow=function(){return(n._sqlite3_wasm_test_stack_overflow=n.asm.sqlite3_wasm_test_stack_overflow).apply(null,arguments)},n._sqlite3_wasm_test_str_hello=function(){return(n._sqlite3_wasm_test_str_hello=n.asm.sqlite3_wasm_test_str_hello).apply(null,arguments)},n._sqlite3_wasm_SQLTester_strglob=function(){return(n._sqlite3_wasm_SQLTester_strglob=n.asm.sqlite3_wasm_SQLTester_strglob).apply(null,arguments)};var ba=n._malloc=function(){return(ba=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n._realloc=function(){return(n._realloc=n.asm.realloc).apply(null,arguments)};var qa=n._emscripten_builtin_memalign=function(){return(qa=n._emscripten_builtin_memalign=n.asm.emscripten_builtin_memalign).apply(null,arguments)};n.stackSave=function(){return(n.stackSave=n.asm.stackSave).apply(null,arguments)},n.stackRestore=function(){return(n.stackRestore=n.asm.stackRestore).apply(null,arguments)},n.stackAlloc=function(){return(n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)},n.wasmMemory=gt;var Vi;Zr=function o(){Vi||Na(),Vi||(Zr=o)};function Na(o){if(zn>0||(Yl(),zn>0))return;function i(){Vi||(Vi=!0,n.calledRun=!0,!ln&&(Zl(),A(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),ec()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),i()},1)):i()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Na(),n.postRun||(n.postRun=[]),n.postRun.push(function(o){if(globalThis.sqlite3ApiBootstrap=function i(l=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return console.warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const a=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:typeof o<"u"?!!o.HEAPU64:!!globalThis.BigInt64Array,debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},l||{});Object.assign(a,{allocExportName:a.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:a.useStdAlloc?"free":"sqlite3_free",reallocExportName:a.useStdAlloc?"realloc":"sqlite3_realloc"},a),["exports","memory","wasmfsOpfsDir"].forEach(f=>{typeof a[f]=="function"&&(a[f]=a[f]())});const c=Object.create(null),d=Object.create(null),q=f=>c.sqlite3_js_rc_str&&c.sqlite3_js_rc_str(f)||"Unknown result code #"+f,I=f=>typeof f=="number"&&f===(f|0);class L extends Error{constructor(...p){let m;if(p.length)if(I(p[0]))if(m=p[0],p.length===1)super(q(p[0]));else{const D=q(m);typeof p[1]=="object"?super(D,p[1]):(p[0]=D+":",super(p.join(" ")))}else p.length===2&&typeof p[1]=="object"?super(...p):super(p.join(" "));this.resultCode=m||c.SQLITE_ERROR,this.name="SQLite3Error"}}L.toss=(...f)=>{throw new L(...f)};const J=L.toss;a.wasmfsOpfsDir&&!/^\/[^/]+$/.test(a.wasmfsOpfsDir)&&J("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const ee=f=>typeof f!="bigint"&&f===(f|0)&&f<=2147483647&&f>=-2147483648,se=function f(p){return f._max||(f._max=BigInt("0x7fffffffffffffff"),f._min=~f._max),p>=f._min&&p<=f._max},P=f=>f>=-0x7fffffffn-1n&&f<=0x7fffffffn,y=function f(p){return f._min||(f._min=Number.MIN_SAFE_INTEGER,f._max=Number.MAX_SAFE_INTEGER),p>=f._min&&p<=f._max},g=f=>f&&f.constructor&&ee(f.constructor.BYTES_PER_ELEMENT)?f:!1,E=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,O=f=>f.buffer instanceof E,N=(f,p,m)=>O(f)?f.slice(p,m):f.subarray(p,m),U=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),$=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),G=f=>U(f)||J("Value is not of a supported TypedArray type."),M=new TextDecoder("utf-8"),fe=function(f,p,m){return M.decode(N(f,p,m))},_=function(f){return $(f)?fe(f instanceof ArrayBuffer?new Uint8Array(f):f):Array.isArray(f)?f.join(""):(d.isPtr(f)&&(f=d.cstrToJs(f)),f)};class S extends Error{constructor(...p){p.length===2&&typeof p[1]=="object"?super(...p):p.length?super(p.join(" ")):super("Allocation failed."),this.resultCode=c.SQLITE_NOMEM,this.name="WasmAllocError"}}S.toss=(...f)=>{throw new S(...f)},Object.assign(c,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(f,p,m,D,K,oe,ce,pe,he)=>{},sqlite3_create_function:(f,p,m,D,K,oe,ce,pe)=>{},sqlite3_create_window_function:(f,p,m,D,K,oe,ce,pe,he,ue)=>{},sqlite3_prepare_v3:(f,p,m,D,K,oe)=>{},sqlite3_prepare_v2:(f,p,m,D,K)=>{},sqlite3_exec:(f,p,m,D,K)=>{},sqlite3_randomness:(f,p)=>{}});const T={affirmBindableTypedArray:G,flexibleString:_,bigIntFits32:P,bigIntFits64:se,bigIntFitsDouble:y,isBindableTypedArray:U,isInt32:ee,isSQLableTypedArray:$,isTypedArray:g,typedArrayToString:fe,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:O,toss:function(...f){throw new Error(f.join(" "))},toss3:J,typedArrayPart:N,affirmDbHeader:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const p="SQLite format 3";p.length>f.byteLength&&J("Input does not contain an SQLite3 database header.");for(let m=0;m<p.length;++m)p.charCodeAt(m)!==f[m]&&J("Input does not contain an SQLite3 database header.")},affirmIsDb:function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f));const p=f.byteLength;(p<512||p%512!==0)&&J("Byte array size",p,"is invalid for an SQLite3 db."),T.affirmDbHeader(f)}};Object.assign(d,{ptrSizeof:a.wasmPtrSizeof||4,ptrIR:a.wasmPtrIR||"i32",bigIntEnabled:!!a.bigIntEnabled,exports:a.exports||J("Missing API config.exports (WASM module exports)."),memory:a.memory||a.exports.memory||J("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),d.allocFromTypedArray=function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f)),G(f);const p=d.alloc(f.byteLength||1);return d.heapForSize(f.constructor).set(f.byteLength?f:[0],p),p};{const f=a.allocExportName,p=a.deallocExportName,m=a.reallocExportName;for(const D of[f,p,m])d.exports[D]instanceof Function||J("Missing required exports[",D,"] function.");d.alloc=function D(K){return D.impl(K)||S.toss("Failed to allocate",K," bytes.")},d.alloc.impl=d.exports[f],d.realloc=function D(K,oe){const ce=D.impl(K,oe);return oe?ce||S.toss("Failed to reallocate",oe," bytes."):0},d.realloc.impl=d.exports[m],d.dealloc=d.exports[p]}d.compileOptionUsed=function f(p){if(arguments.length){if(Array.isArray(p)){const m={};return p.forEach(D=>{m[D]=c.sqlite3_compileoption_used(D)}),m}else if(typeof p=="object")return Object.keys(p).forEach(m=>{p[m]=c.sqlite3_compileoption_used(m)}),p}else{if(f._result)return f._result;f._opt||(f._rx=/^([^=]+)=(.+)/,f._rxInt=/^-?\d+$/,f._opt=function(ce,pe){const he=f._rx.exec(ce);pe[0]=he?he[1]:ce,pe[1]=he?f._rxInt.test(he[2])?+he[2]:he[2]:!0});const m={},D=[0,0];let K=0,oe;for(;oe=c.sqlite3_compileoption_get(K++);)f._opt(oe,D),m[D[0]]=D[1];return f._result=m}return typeof p=="string"?!!c.sqlite3_compileoption_used(p):!1},d.pstack=Object.assign(Object.create(null),{restore:d.exports.sqlite3_wasm_pstack_restore,alloc:function(f){return typeof f=="string"&&!(f=d.sizeofIR(f))&&S.toss("Invalid value for pstack.alloc(",arguments[0],")"),d.exports.sqlite3_wasm_pstack_alloc(f)||S.toss("Could not allocate",f,"bytes from the pstack.")},allocChunks:function(f,p){typeof p=="string"&&!(p=d.sizeofIR(p))&&S.toss("Invalid size value for allocChunks(",arguments[1],")");const m=d.pstack.alloc(f*p),D=[];let K=0,oe=0;for(;K<f;++K,oe+=p)D.push(m+oe);return D},allocPtr:(f=1,p=!0)=>f===1?d.pstack.alloc(p?8:d.ptrSizeof):d.pstack.allocChunks(f,p?8:d.ptrSizeof),call:function(f){const p=d.pstack.pointer;try{return f(x)}finally{d.pstack.restore(p)}}}),Object.defineProperties(d.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_remaining}}),c.sqlite3_randomness=(...f)=>{if(f.length===1&&T.isTypedArray(f[0])&&f[0].BYTES_PER_ELEMENT===1){const p=f[0];if(p.byteLength===0)return d.exports.sqlite3_randomness(0,0),p;const m=d.pstack.pointer;try{let D=p.byteLength,K=0;const oe=d.exports.sqlite3_randomness,ce=d.heap8u(),pe=D<512?D:512,he=d.pstack.alloc(pe);do{const ue=D>pe?pe:D;oe(ue,he),p.set(N(ce,he,he+ue),K),D-=ue,K+=ue}while(D>0)}catch(D){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",D)}finally{d.pstack.restore(m)}return p}d.exports.sqlite3_randomness(...f)};let H;if(c.sqlite3_wasmfs_opfs_dir=function(){if(H!==void 0)return H;const f=a.wasmfsOpfsDir;if(!f||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return H="";try{return f&&d.xCallWrapped("sqlite3_wasm_init_wasmfs","i32",["string"],f)===0?H=f:H=""}catch{return H=""}},c.sqlite3_wasmfs_filename_is_persistent=function(f){const p=c.sqlite3_wasmfs_opfs_dir();return p&&f?f.startsWith(p+"/"):!1},c.sqlite3_js_db_uses_vfs=function(f,p,m=0){try{const D=c.sqlite3_vfs_find(p);return D?f?D===c.sqlite3_js_db_vfs(f,m)?D:!1:D===c.sqlite3_vfs_find(0)?D:!1:!1}catch{return!1}},c.sqlite3_js_vfs_list=function(){const f=[];let p=c.sqlite3_vfs_find(0);for(;p;){const m=new c.sqlite3_vfs(p);f.push(d.cstrToJs(m.$zName)),p=m.$pNext,m.dispose()}return f},c.sqlite3_js_db_export=function(f,p=0){f=d.xWrap.testConvertArg("sqlite3*",f),f||J("Invalid sqlite3* argument."),d.bigIntEnabled||J("BigInt64 support is not enabled.");const m=d.scopedAllocPush();let D;try{const K=d.scopedAlloc(8+d.ptrSizeof),oe=K+8,ce=p?d.isPtr(p)?p:d.scopedAllocCString(""+p):0;let pe=d.exports.sqlite3_wasm_db_serialize(f,ce,oe,K,0);pe&&J("Database serialization failed with code",x.capi.sqlite3_js_rc_str(pe)),D=d.peekPtr(oe);const he=d.peek(K,"i64");return pe=he?d.heap8u().slice(D,D+Number(he)):new Uint8Array,pe}finally{D&&d.exports.sqlite3_free(D),d.scopedAllocPop(m)}},c.sqlite3_js_db_vfs=(f,p=0)=>d.sqlite3_wasm_db_vfs(f,p),c.sqlite3_js_aggregate_context=(f,p)=>c.sqlite3_aggregate_context(f,p)||(p?S.toss("Cannot allocate",p,"bytes for sqlite3_aggregate_context()"):0),c.sqlite3_js_posix_create_file=function(f,p,m){let D;p&&d.isPtr(p)?D=p:p instanceof ArrayBuffer||p instanceof Uint8Array?(D=d.allocFromTypedArray(p),(arguments.length<3||!T.isInt32(m)||m<0)&&(m=p.byteLength)):L.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!T.isInt32(m)||m<0)&&L.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const K=d.sqlite3_wasm_posix_create_file(f,D,m);K&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(K))}finally{d.dealloc(D)}},c.sqlite3_js_vfs_create_file=function(f,p,m,D){a.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let K;m?(d.isPtr(m)?K=m:m instanceof ArrayBuffer&&(m=new Uint8Array(m)),m instanceof Uint8Array?(K=d.allocFromTypedArray(m),(arguments.length<4||!T.isInt32(D)||D<0)&&(D=m.byteLength)):L.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):K=0,(!T.isInt32(D)||D<0)&&(d.dealloc(K),L.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const oe=d.sqlite3_wasm_vfs_create_file(f,p,K,D);oe&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(oe))}finally{d.dealloc(K)}},c.sqlite3_js_sql_to_string=f=>{if(typeof f=="string")return f;const p=_(v);return p===v?void 0:p},T.isUIThread()){const f=function(p){const m=Object.create(null);return m.prefix="kvvfs-"+p,m.stores=[],(p==="session"||p==="")&&m.stores.push(globalThis.sessionStorage),(p==="local"||p==="")&&m.stores.push(globalThis.localStorage),m};c.sqlite3_js_kvvfs_clear=function(p=""){let m=0;const D=f(p);return D.stores.forEach(K=>{const oe=[];let ce;for(ce=0;ce<K.length;++ce){const pe=K.key(ce);pe.startsWith(D.prefix)&&oe.push(pe)}oe.forEach(pe=>K.removeItem(pe)),m+=oe.length}),m},c.sqlite3_js_kvvfs_size=function(p=""){let m=0;const D=f(p);return D.stores.forEach(K=>{let oe;for(oe=0;oe<K.length;++oe){const ce=K.key(oe);ce.startsWith(D.prefix)&&(m+=ce.length,m+=K.getItem(ce).length)}}),m*2}}c.sqlite3_db_config=function(f,p,...m){switch(this.s||(this.s=d.xWrap("sqlite3_wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=d.xWrap("sqlite3_wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=d.xWrap("sqlite3_wasm_db_config_ip","int",["sqlite3*","int","int","*"])),p){case c.SQLITE_DBCONFIG_ENABLE_FKEY:case c.SQLITE_DBCONFIG_ENABLE_TRIGGER:case c.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case c.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case c.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case c.SQLITE_DBCONFIG_ENABLE_QPSG:case c.SQLITE_DBCONFIG_TRIGGER_EQP:case c.SQLITE_DBCONFIG_RESET_DATABASE:case c.SQLITE_DBCONFIG_DEFENSIVE:case c.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case c.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case c.SQLITE_DBCONFIG_DQS_DML:case c.SQLITE_DBCONFIG_DQS_DDL:case c.SQLITE_DBCONFIG_ENABLE_VIEW:case c.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case c.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case c.SQLITE_DBCONFIG_STMT_SCANSTATUS:case c.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(f,p,m[0],m[1]||0);case c.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(f,p,m[0],m[1],m[2]);case c.SQLITE_DBCONFIG_MAINDBNAME:return this.s(f,p,m[0]);default:return c.SQLITE_MISUSE}}.bind(Object.create(null)),c.sqlite3_value_to_js=function(f,p=!0){let m;const D=c.sqlite3_value_type(f);switch(D){case c.SQLITE_INTEGER:d.bigIntEnabled?(m=c.sqlite3_value_int64(f),T.bigIntFitsDouble(m)&&(m=Number(m))):m=c.sqlite3_value_double(f);break;case c.SQLITE_FLOAT:m=c.sqlite3_value_double(f);break;case c.SQLITE_TEXT:m=c.sqlite3_value_text(f);break;case c.SQLITE_BLOB:{const K=c.sqlite3_value_bytes(f),oe=c.sqlite3_value_blob(f);K&&!oe&&x.WasmAllocError.toss("Cannot allocate memory for blob argument of",K,"byte(s)"),m=K?d.heap8u().slice(oe,oe+Number(K)):null;break}case c.SQLITE_NULL:m=null;break;default:p&&J(c.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",D),m=void 0}return m},c.sqlite3_values_to_js=function(f,p,m=!0){let D;const K=[];for(D=0;D<f;++D)K.push(c.sqlite3_value_to_js(d.peekPtr(p+d.ptrSizeof*D),m));return K},c.sqlite3_result_error_js=function(f,p){p instanceof S?c.sqlite3_result_error_nomem(f):c.sqlite3_result_error(f,""+p,-1)},c.sqlite3_result_js=function(f,p){if(p instanceof Error){c.sqlite3_result_error_js(f,p);return}try{switch(typeof p){case"undefined":break;case"boolean":c.sqlite3_result_int(f,p?1:0);break;case"bigint":T.bigIntFits32(p)?c.sqlite3_result_int(f,Number(p)):T.bigIntFitsDouble(p)?c.sqlite3_result_double(f,Number(p)):d.bigIntEnabled?T.bigIntFits64(p)?c.sqlite3_result_int64(f,p):J("BigInt value",p.toString(),"is too BigInt for int64."):J("BigInt value",p.toString(),"is too BigInt.");break;case"number":{let m;T.isInt32(p)?m=c.sqlite3_result_int:d.bigIntEnabled&&Number.isInteger(p)&&T.bigIntFits64(BigInt(p))?m=c.sqlite3_result_int64:m=c.sqlite3_result_double,m(f,p);break}case"string":{const[m,D]=d.allocCString(p,!0);c.sqlite3_result_text(f,m,D,c.SQLITE_WASM_DEALLOC);break}case"object":if(p===null){c.sqlite3_result_null(f);break}else if(T.isBindableTypedArray(p)){const m=d.allocFromTypedArray(p);c.sqlite3_result_blob(f,m,p.byteLength,c.SQLITE_WASM_DEALLOC);break}default:J("Don't not how to handle this UDF result value:",typeof p,p)}}catch(m){c.sqlite3_result_error_js(f,m)}},c.sqlite3_column_js=function(f,p,m=!0){const D=c.sqlite3_column_value(f,p);return D===0?void 0:c.sqlite3_value_to_js(D,m)};const w=function(f,p,m){m=c[m],this.ptr?d.pokePtr(this.ptr,0):this.ptr=d.allocPtr();const D=m(f,p,this.ptr);if(D)return L.toss(D,arguments[2]+"() failed with code "+D);const K=d.peekPtr(this.ptr);return K?c.sqlite3_value_to_js(K,!0):void 0}.bind(Object.create(null));c.sqlite3_preupdate_new_js=(f,p)=>w(f,p,"sqlite3_preupdate_new"),c.sqlite3_preupdate_old_js=(f,p)=>w(f,p,"sqlite3_preupdate_old"),c.sqlite3changeset_new_js=(f,p)=>w(f,p,"sqlite3changeset_new"),c.sqlite3changeset_old_js=(f,p)=>w(f,p,"sqlite3changeset_old");const x={WasmAllocError:S,SQLite3Error:L,capi:c,util:T,wasm:d,config:a,version:Object.create(null),client:void 0,asyncPostInit:async function f(){if(f.isReady instanceof Promise)return f.isReady;let p=i.initializersAsync;delete i.initializersAsync;const m=async()=>(x.__isUnderTest||(delete x.util,delete x.StructBinder),x),D=oe=>{throw a.error("an async sqlite3 initializer failed:",oe),oe};if(!p||!p.length)return f.isReady=m().catch(D);p=p.map(oe=>oe instanceof Function?async ce=>oe(x):oe),p.push(m);let K=Promise.resolve(x);for(;p.length;)K=K.then(p.shift());return f.isReady=K.catch(D)},scriptInfo:void 0};try{i.initializers.forEach(f=>{f(x)})}catch(f){throw console.error("sqlite3 bootstrap initializer threw:",f),f}return delete i.initializers,i.sqlite3=x,x},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(i){i.bigIntEnabled===void 0&&(i.bigIntEnabled=!!globalThis.BigInt64Array);const l=(..._)=>{throw new Error(_.join(" "))};i.exports||Object.defineProperty(i,"exports",{enumerable:!0,configurable:!0,get:()=>i.instance&&i.instance.exports});const a=i.pointerIR||"i32",c=i.ptrSizeof=a==="i32"?4:a==="i64"?8:l("Unhandled ptrSizeof:",a),d=Object.create(null);d.heapSize=0,d.memory=null,d.freeFuncIndexes=[],d.scopedAlloc=[],d.utf8Decoder=new TextDecoder,d.utf8Encoder=new TextEncoder("utf-8"),i.sizeofIR=_=>{switch(_){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return c;default:return(""+_).endsWith("*")?c:void 0}};const q=function(){if(!d.memory)d.memory=i.memory instanceof WebAssembly.Memory?i.memory:i.exports.memory;else if(d.heapSize===d.memory.buffer.byteLength)return d;const _=d.memory.buffer;return d.HEAP8=new Int8Array(_),d.HEAP8U=new Uint8Array(_),d.HEAP16=new Int16Array(_),d.HEAP16U=new Uint16Array(_),d.HEAP32=new Int32Array(_),d.HEAP32U=new Uint32Array(_),i.bigIntEnabled&&(d.HEAP64=new BigInt64Array(_),d.HEAP64U=new BigUint64Array(_)),d.HEAP32F=new Float32Array(_),d.HEAP64F=new Float64Array(_),d.heapSize=_.byteLength,d};i.heap8=()=>q().HEAP8,i.heap8u=()=>q().HEAP8U,i.heap16=()=>q().HEAP16,i.heap16u=()=>q().HEAP16U,i.heap32=()=>q().HEAP32,i.heap32u=()=>q().HEAP32U,i.heapForSize=function(_,S=!0){const T=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:q();switch(_){case Int8Array:return T.HEAP8;case Uint8Array:return T.HEAP8U;case Int16Array:return T.HEAP16;case Uint16Array:return T.HEAP16U;case Int32Array:return T.HEAP32;case Uint32Array:return T.HEAP32U;case 8:return S?T.HEAP8U:T.HEAP8;case 16:return S?T.HEAP16U:T.HEAP16;case 32:return S?T.HEAP32U:T.HEAP32;case 64:if(T.HEAP64)return S?T.HEAP64U:T.HEAP64;break;default:if(i.bigIntEnabled){if(_===globalThis.BigUint64Array)return T.HEAP64U;if(_===globalThis.BigInt64Array)return T.HEAP64;break}}l("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},i.functionTable=function(){return i.exports.__indirect_function_table},i.functionEntry=function(_){const S=i.functionTable();return _<S.length?S.get(_):void 0},i.jsFuncToWasm=function _(S,T){if(_._||(_._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(x,f,p){p<128?x[f](p):x[f](p%128|128,p>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(x){const f=_._.rxJSig.exec(x);return f?f[2]:x.substr(1)},letterType:x=>_._.sigTypes[x]||l("Invalid signature letter:",x),pushSigType:(x,f)=>x.push(_._.typeCodes[_._.letterType(f)])}),typeof S=="string"){const x=T;T=S,S=x}const H=_._.sigParams(T),w=[1,96];_._.uleb128Encode(w,"push",H.length);for(const x of H)_._.pushSigType(w,x);return T[0]==="v"?w.push(0):(w.push(1),_._.pushSigType(w,T[0])),_._.uleb128Encode(w,"unshift",w.length),w.unshift(0,97,115,109,1,0,0,0,1),w.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(w)),{e:{f:S}}).exports.f};const I=function(S,T,H){if(H&&!d.scopedAlloc.length&&l("No scopedAllocPush() scope is active."),typeof S=="string"){const p=T;T=S,S=p}(typeof T!="string"||!(S instanceof Function))&&l("Invalid arguments: expecting (function,signature) or (signature,function).");const w=i.functionTable(),x=w.length;let f;for(;d.freeFuncIndexes.length&&(f=d.freeFuncIndexes.pop(),w.get(f));){f=null;continue}f||(f=x,w.grow(1));try{return w.set(f,S),H&&d.scopedAlloc[d.scopedAlloc.length-1].push(f),f}catch(p){if(!(p instanceof TypeError))throw f===x&&d.freeFuncIndexes.push(x),p}try{const p=i.jsFuncToWasm(S,T);w.set(f,p),H&&d.scopedAlloc[d.scopedAlloc.length-1].push(f)}catch(p){throw f===x&&d.freeFuncIndexes.push(x),p}return f};i.installFunction=(_,S)=>I(_,S,!1),i.scopedInstallFunction=(_,S)=>I(_,S,!0),i.uninstallFunction=function(_){if(!_&&_!==0)return;const S=d.freeFuncIndexes,T=i.functionTable();S.push(_);const H=T.get(_);return T.set(_,null),H},i.peek=function(S,T="i8"){T.endsWith("*")&&(T=a);const H=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:q(),w=Array.isArray(S)?[]:void 0;let x;do{switch(w&&(S=arguments[0].shift()),T){case"i1":case"i8":x=H.HEAP8[S>>0];break;case"i16":x=H.HEAP16[S>>1];break;case"i32":x=H.HEAP32[S>>2];break;case"float":case"f32":x=H.HEAP32F[S>>2];break;case"double":case"f64":x=Number(H.HEAP64F[S>>3]);break;case"i64":if(i.bigIntEnabled){x=BigInt(H.HEAP64[S>>3]);break}default:l("Invalid type for peek():",T)}w&&w.push(x)}while(w&&arguments[0].length);return w||x},i.poke=function(_,S,T="i8"){T.endsWith("*")&&(T=a);const H=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:q();for(const w of Array.isArray(_)?_:[_])switch(T){case"i1":case"i8":H.HEAP8[w>>0]=S;continue;case"i16":H.HEAP16[w>>1]=S;continue;case"i32":H.HEAP32[w>>2]=S;continue;case"float":case"f32":H.HEAP32F[w>>2]=S;continue;case"double":case"f64":H.HEAP64F[w>>3]=S;continue;case"i64":if(H.HEAP64){H.HEAP64[w>>3]=BigInt(S);continue}default:l("Invalid type for poke(): "+T)}return this},i.peekPtr=(..._)=>i.peek(_.length===1?_[0]:_,a),i.pokePtr=(_,S=0)=>i.poke(_,S,a),i.peek8=(..._)=>i.peek(_.length===1?_[0]:_,"i8"),i.poke8=(_,S)=>i.poke(_,S,"i8"),i.peek16=(..._)=>i.peek(_.length===1?_[0]:_,"i16"),i.poke16=(_,S)=>i.poke(_,S,"i16"),i.peek32=(..._)=>i.peek(_.length===1?_[0]:_,"i32"),i.poke32=(_,S)=>i.poke(_,S,"i32"),i.peek64=(..._)=>i.peek(_.length===1?_[0]:_,"i64"),i.poke64=(_,S)=>i.poke(_,S,"i64"),i.peek32f=(..._)=>i.peek(_.length===1?_[0]:_,"f32"),i.poke32f=(_,S)=>i.poke(_,S,"f32"),i.peek64f=(..._)=>i.peek(_.length===1?_[0]:_,"f64"),i.poke64f=(_,S)=>i.poke(_,S,"f64"),i.getMemValue=i.peek,i.getPtrValue=i.peekPtr,i.setMemValue=i.poke,i.setPtrValue=i.pokePtr,i.isPtr32=_=>typeof _=="number"&&_===(_|0)&&_>=0,i.isPtr=i.isPtr32,i.cstrlen=function(_){if(!_||!i.isPtr(_))return null;const S=q().HEAP8U;let T=_;for(;S[T]!==0;++T);return T-_};const L=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,J=function(_,S,T){return d.utf8Decoder.decode(_.buffer instanceof L?_.slice(S,T):_.subarray(S,T))};i.cstrToJs=function(_){const S=i.cstrlen(_);return S?J(q().HEAP8U,_,_+S):S===null?S:""},i.jstrlen=function(_){if(typeof _!="string")return null;const S=_.length;let T=0;for(let H=0;H<S;++H){let w=_.charCodeAt(H);w>=55296&&w<=57343&&(w=65536+((w&1023)<<10)|_.charCodeAt(++H)&1023),w<=127?++T:w<=2047?T+=2:w<=65535?T+=3:T+=4}return T},i.jstrcpy=function(_,S,T=0,H=-1,w=!0){if((!S||!(S instanceof Int8Array)&&!(S instanceof Uint8Array))&&l("jstrcpy() target must be an Int8Array or Uint8Array."),H<0&&(H=S.length-T),!(H>0)||!(T>=0))return 0;let x=0,f=_.length;const p=T,m=T+H-(w?1:0);for(;x<f&&T<m;++x){let D=_.charCodeAt(x);if(D>=55296&&D<=57343&&(D=65536+((D&1023)<<10)|_.charCodeAt(++x)&1023),D<=127){if(T>=m)break;S[T++]=D}else if(D<=2047){if(T+1>=m)break;S[T++]=192|D>>6,S[T++]=128|D&63}else if(D<=65535){if(T+2>=m)break;S[T++]=224|D>>12,S[T++]=128|D>>6&63,S[T++]=128|D&63}else{if(T+3>=m)break;S[T++]=240|D>>18,S[T++]=128|D>>12&63,S[T++]=128|D>>6&63,S[T++]=128|D&63}}return w&&(S[T++]=0),T-p},i.cstrncpy=function(_,S,T){if((!_||!S)&&l("cstrncpy() does not accept NULL strings."),T<0)T=i.cstrlen(strPtr)+1;else if(!(T>0))return 0;const H=i.heap8u();let w=0,x;for(;w<T&&(x=H[S+w]);++w)H[_+w]=x;return w<T&&(H[_+w++]=0),w},i.jstrToUintArray=(_,S=!1)=>d.utf8Encoder.encode(S?_+"\0":_);const ee=(_,S)=>{(!(_.alloc instanceof Function)||!(_.dealloc instanceof Function))&&l("Object is missing alloc() and/or dealloc() function(s)","required by",S+"().")},se=function(_,S,T,H){if(ee(i,H),typeof _!="string")return null;{const w=d.utf8Encoder.encode(_),x=T(w.length+1),f=q().HEAP8U;return f.set(w,x),f[x+w.length]=0,S?[x,w.length]:x}};i.allocCString=(_,S=!1)=>se(_,S,i.alloc,"allocCString()"),i.scopedAllocPush=function(){ee(i,"scopedAllocPush");const _=[];return d.scopedAlloc.push(_),_},i.scopedAllocPop=function(_){ee(i,"scopedAllocPop");const S=arguments.length?d.scopedAlloc.indexOf(_):d.scopedAlloc.length-1;S<0&&l("Invalid state object for scopedAllocPop()."),arguments.length===0&&(_=d.scopedAlloc[S]),d.scopedAlloc.splice(S,1);for(let T;T=_.pop();)i.functionEntry(T)?i.uninstallFunction(T):i.dealloc(T)},i.scopedAlloc=function(_){d.scopedAlloc.length||l("No scopedAllocPush() scope is active.");const S=i.alloc(_);return d.scopedAlloc[d.scopedAlloc.length-1].push(S),S},Object.defineProperty(i.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>d.scopedAlloc.length,set:()=>l("The 'active' property is read-only.")}),i.scopedAllocCString=(_,S=!1)=>se(_,S,i.scopedAlloc,"scopedAllocCString()");const P=function(_,S){const T=i[_?"scopedAlloc":"alloc"]((S.length+1)*i.ptrSizeof);let H=0;return S.forEach(w=>{i.pokePtr(T+i.ptrSizeof*H++,i[_?"scopedAllocCString":"allocCString"](""+w))}),i.pokePtr(T+i.ptrSizeof*H,0),T};i.scopedAllocMainArgv=_=>P(!0,_),i.allocMainArgv=_=>P(!1,_),i.cArgvToJs=(_,S)=>{const T=[];for(let H=0;H<_;++H){const w=i.peekPtr(S+i.ptrSizeof*H);T.push(w?i.cstrToJs(w):null)}return T},i.scopedAllocCall=function(_){i.scopedAllocPush();try{return _()}finally{i.scopedAllocPop()}};const y=function(_,S,T){ee(i,T);const H=S?"i64":a;let w=i[T](_*(S?8:c));if(i.poke(w,0,H),_===1)return w;const x=[w];for(let f=1;f<_;++f)w+=S?8:c,x[f]=w,i.poke(w,0,H);return x};i.allocPtr=(_=1,S=!0)=>y(_,S,"alloc"),i.scopedAllocPtr=(_=1,S=!0)=>y(_,S,"scopedAlloc"),i.xGet=function(_){return i.exports[_]||l("Cannot find exported symbol:",_)};const g=(_,S)=>l(_+"() requires",S,"argument(s).");i.xCall=function(_,...S){const T=i.xGet(_);return T instanceof Function||l("Exported symbol",_,"is not a function."),T.length!==S.length&&g(_,T.length),arguments.length===2&&Array.isArray(arguments[1])?T.apply(null,arguments[1]):T.apply(null,S)},d.xWrap=Object.create(null),d.xWrap.convert=Object.create(null),d.xWrap.convert.arg=new Map,d.xWrap.convert.result=new Map;const E=d.xWrap.convert.arg,O=d.xWrap.convert.result;i.bigIntEnabled&&E.set("i64",_=>BigInt(_));const N=a==="i32"?_=>_|0:_=>BigInt(_)|BigInt(0);E.set("i32",N).set("i16",_=>(_|0)&65535).set("i8",_=>(_|0)&255).set("f32",_=>Number(_).valueOf()).set("float",E.get("f32")).set("f64",E.get("f32")).set("double",E.get("f64")).set("int",E.get("i32")).set("null",_=>_).set(null,E.get("null")).set("**",N).set("*",N),O.set("*",N).set("pointer",N).set("number",_=>Number(_)).set("void",_=>{}).set("null",_=>_).set(null,O.get("null"));{const _=["i8","i16","i32","int","f32","float","f64","double"];i.bigIntEnabled&&_.push("i64");const S=E.get(a);for(const T of _)E.set(T+"*",S),O.set(T+"*",S),O.set(T,E.get(T)||l("Missing arg converter:",T))}const U=function(_){return typeof _=="string"?i.scopedAllocCString(_):_?N(_):null};E.set("string",U).set("utf8",U).set("pointer",U),O.set("string",_=>i.cstrToJs(_)).set("utf8",O.get("string")).set("string:dealloc",_=>{try{return _?i.cstrToJs(_):null}finally{i.dealloc(_)}}).set("utf8:dealloc",O.get("string:dealloc")).set("json",_=>JSON.parse(i.cstrToJs(_))).set("json:dealloc",_=>{try{return _?JSON.parse(i.cstrToJs(_)):null}finally{i.dealloc(_)}});const $=class{constructor(_){this.name=_.name||"unnamed adapter"}convertArg(_,S,T){l("AbstractArgAdapter must be subclassed.")}};E.FuncPtrAdapter=class hn extends ${constructor(S){super(S),E.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",S),this.name=S.name||"unnamed",this.signature=S.signature,S.contextKey instanceof Function&&(this.contextKey=S.contextKey,S.bindScope||(S.bindScope="context")),this.bindScope=S.bindScope||l("FuncPtrAdapter options requires a bindScope (explicit or implied)."),hn.bindScopes.indexOf(S.bindScope)<0&&l("Invalid options.bindScope ("+S.bindMod+") for FuncPtrAdapter. Expecting one of: ("+hn.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=S.callProxy instanceof Function?S.callProxy:void 0}contextKey(S,T){return this}contextMap(S){const T=this.__cmap||(this.__cmap=new Map);let H=T.get(S);return H===void 0&&T.set(S,H=[]),H}convertArg(S,T,H){let w=this.singleton;if(!w&&this.isContext&&(w=this.contextMap(this.contextKey(T,H))),w&&w[0]===S)return w[1];if(S instanceof Function){this.callProxy&&(S=this.callProxy(S));const x=I(S,this.signature,this.isTransient);if(hn.debugFuncInstall&&hn.debugOut("FuncPtrAdapter installed",this,this.contextKey(T,H),"@"+x,S),w){if(w[1]){hn.debugFuncInstall&&hn.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(T,H),"@"+w[1],S);try{d.scopedAlloc[d.scopedAlloc.length-1].push(w[1])}catch{}}w[0]=S,w[1]=x}return x}else if(i.isPtr(S)||S===null||S===void 0){if(w&&w[1]&&w[1]!==S){hn.debugFuncInstall&&hn.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(T,H),"@"+w[1],S);try{d.scopedAlloc[d.scopedAlloc.length-1].push(w[1])}catch{}w[0]=w[1]=S|0}return S||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},E.FuncPtrAdapter.warnOnUse=!1,E.FuncPtrAdapter.debugFuncInstall=!1,E.FuncPtrAdapter.debugOut=console.debug.bind(console),E.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const G=_=>E.get(_)||l("Argument adapter not found:",_),M=_=>O.get(_)||l("Result adapter not found:",_);d.xWrap.convertArg=(_,...S)=>G(_)(...S),d.xWrap.convertArgNoCheck=(_,...S)=>E.get(_)(...S),d.xWrap.convertResult=(_,S)=>_===null?S:_?M(_)(S):void 0,d.xWrap.convertResultNoCheck=(_,S)=>_===null?S:_?O.get(_)(S):void 0,i.xWrap=function(_,S,...T){arguments.length===3&&Array.isArray(arguments[2])&&(T=arguments[2]),i.isPtr(_)&&(_=i.functionEntry(_)||l("Function pointer not found in WASM function table."));const H=_ instanceof Function,w=H?_:i.xGet(_);if(H&&(_=w.name||"unnamed function"),T.length!==w.length&&g(_,w.length),S===null&&w.length===0)return w;S!=null&&M(S);for(const f of T)f instanceof $?E.set(f,(...p)=>f.convertArg(...p)):G(f);const x=d.xWrap;return w.length===0?(...f)=>f.length?g(_,w.length):x.convertResult(S,w.call(null)):function(...f){f.length!==w.length&&g(_,w.length);const p=i.scopedAllocPush();try{for(const m in f)f[m]=x.convertArgNoCheck(T[m],f[m],f,m);return x.convertResultNoCheck(S,w.apply(null,f))}finally{i.scopedAllocPop(p)}}};const fe=function(_,S,T,H,w,x){if(typeof T=="string"){if(S===1)return x.get(T);if(S===2){if(H)H instanceof Function||l(w,"requires a function argument.");else return delete x.get(T),_;return x.set(T,H),_}}l("Invalid arguments to",w)};return i.xWrap.resultAdapter=function _(S,T){return fe(_,arguments.length,S,T,"resultAdapter()",O)},i.xWrap.argAdapter=function _(S,T){return fe(_,arguments.length,S,T,"argAdapter()",E)},i.xWrap.FuncPtrAdapter=E.FuncPtrAdapter,i.xCallWrapped=function(_,S,T,...H){return Array.isArray(arguments[3])&&(H=arguments[3]),i.xWrap(_,S,T||[]).apply(null,H||[])},i.xWrap.testConvertArg=d.xWrap.convertArg,i.xWrap.testConvertResult=d.xWrap.convertResult,i},globalThis.WhWasmUtilInstaller.yawl=function(i){const l=()=>fetch(i.uri,{credentials:"same-origin"}),a=this,c=function(q){if(i.wasmUtilTarget){const I=(...J)=>{throw new Error(J.join(" "))},L=i.wasmUtilTarget;if(L.module=q.module,L.instance=q.instance,L.instance.exports.memory||(L.memory=i.imports&&i.imports.env&&i.imports.env.memory||I("Missing 'memory' object!")),!L.alloc&&q.instance.exports.malloc){const J=q.instance.exports;L.alloc=function(ee){return J.malloc(ee)||I("Allocation of",ee,"bytes failed.")},L.dealloc=function(ee){J.free(ee)}}a(L)}return i.onload&&i.onload(q,i),q};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(l(),i.imports||{}).then(c)}:function(){return l().then(I=>I.arrayBuffer()).then(I=>WebAssembly.instantiate(I,i.imports||{})).then(c)}}.bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(l){const a=(...b)=>{throw new Error(b.join(" "))};!(l.heap instanceof WebAssembly.Memory)&&!(l.heap instanceof Function)&&a("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(b){l[b]instanceof Function||a("Config option '"+b+"' must be a function.")});const c=i,d=l.heap instanceof Function?l.heap:()=>new Uint8Array(l.heap.buffer),q=l.alloc,I=l.dealloc,L=l.log||console.log.bind(console),J=l.memberPrefix||"",ee=l.memberSuffix||"",se=l.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!l.bigIntEnabled,P=globalThis.BigInt,y=globalThis.BigInt64Array,g=l.ptrSizeof||4,E=l.ptrIR||"i32";c.debugFlags||(c.__makeDebugFlags=function(b=null){b&&b.__flags&&(b=b.__flags);const C=function W(B){return arguments.length===0?W.__flags:(B<0?(delete W.__flags.getter,delete W.__flags.setter,delete W.__flags.alloc,delete W.__flags.dealloc):(W.__flags.getter=(1&B)!==0,W.__flags.setter=(2&B)!==0,W.__flags.alloc=(4&B)!==0,W.__flags.dealloc=(8&B)!==0),W._flags)};return Object.defineProperty(C,"__flags",{iterable:!1,writable:!1,value:Object.create(b)}),b||C(0),C},c.debugFlags=c.__makeDebugFlags());const O=function(){const b=new ArrayBuffer(2);return new DataView(b).setInt16(0,256,!0),new Int16Array(b)[0]===256}(),N=b=>b[1]==="(",U=b=>b==="P",$=b=>N(b)?"p":b[0],G=function(b){switch($(b)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return E;case"j":return"i64";case"f":return"float";case"d":return"double"}a("Unhandled signature IR:",b)},M=y?()=>!0:()=>a("BigInt64Array is not available."),fe=function(b){switch($(b)){case"p":case"P":case"s":{switch(g){case 4:return"getInt32";case 8:return M()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return M()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}a("Unhandled DataView getter for signature:",b)},_=function(b){switch($(b)){case"p":case"P":case"s":{switch(g){case 4:return"setInt32";case 8:return M()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return M()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}a("Unhandled DataView setter for signature:",b)},S=function(b){switch($(b)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return M()&&P;case"p":case"P":case"s":switch(g){case 4:return Number;case 8:return M()&&P}break}a("Unhandled DataView set wrapper for signature:",b)},T=(b,C)=>b+"::"+C,H=function(b,C){return()=>a(T(b,C),"is read-only.")},w=new WeakMap,x="(pointer-is-external)",f=function(b,C,W){if(W||(W=w.get(C)),W){if(w.delete(C),Array.isArray(C.ondispose)){let B;for(;B=C.ondispose.shift();)try{B instanceof Function?B.call(C):B instanceof ae?B.dispose():typeof B=="number"&&I(B)}catch(ne){console.warn("ondispose() for",b.structName,"@",W,"threw. NOT propagating it.",ne)}}else if(C.ondispose instanceof Function)try{C.ondispose()}catch(B){console.warn("ondispose() for",b.structName,"@",W,"threw. NOT propagating it.",B)}delete C.ondispose,b.debugFlags.__flags.dealloc&&L("debug.dealloc:",C[x]?"EXTERNAL":"",b.structName,"instance:",b.structInfo.sizeof,"bytes @"+W),C[x]||I(W)}},p=b=>({configurable:!1,writable:!1,iterable:!1,value:b}),m=function(b,C,W){let B=!W;W?Object.defineProperty(C,x,p(W)):(W=q(b.structInfo.sizeof),W||a("Allocation of",b.structName,"structure failed."));try{b.debugFlags.__flags.alloc&&L("debug.alloc:",B?"":"EXTERNAL",b.structName,"instance:",b.structInfo.sizeof,"bytes @"+W),B&&d().fill(0,W,W+b.structInfo.sizeof),w.set(C,W)}catch(ne){throw f(b,C,W),ne}},D=function(){const b=this.pointer;return b?new Uint8Array(d().slice(b,b+this.structInfo.sizeof)):null},oe=p(b=>J+b+ee),ce=function(b,C,W=!0){let B=b.members[C];if(!B&&(J||ee)){for(const ne of Object.values(b.members))if(ne.key===C){B=ne;break}!B&&W&&a(T(b.name,C),"is not a mapped struct member.")}return B},pe=function b(C,W,B=!1){b._||(b._=de=>de.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const ne=ce(C.structInfo,W,!0);return B?b._(ne.signature):ne.signature},he={configurable:!1,enumerable:!1,get:function(){return w.get(this)},set:()=>a("Cannot assign the 'pointer' property of a struct.")},ue=p(function(){const b=[];for(const C of Object.keys(this.structInfo.members))b.push(this.memberKey(C));return b}),qe=new TextDecoder("utf-8"),Te=new TextEncoder,Ce=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,tt=function(b,C,W){return qe.decode(b.buffer instanceof Ce?b.slice(C,W):b.subarray(C,W))},ht=function(b,C,W=!1){const B=ce(b.structInfo,C,W);return B&&B.signature.length===1&&B.signature[0]==="s"?B:!1},F=function(b){b.signature!=="s"&&a("Invalid member type signature for C-string value:",JSON.stringify(b))},z=function(C,W){const B=ce(C.structInfo,W,!0);F(B);const ne=C[B.key];if(!ne)return null;let de=ne;const ge=d();for(;ge[de]!==0;++de);return ne===de?"":tt(ge,ne,de)},j=function(b,...C){b.ondispose?Array.isArray(b.ondispose)||(b.ondispose=[b.ondispose]):b.ondispose=[],b.ondispose.push(...C)},te=function(b){const C=Te.encode(b),W=q(C.length+1);W||a("Allocation error while duplicating string:",b);const B=d();return B.set(C,W),B[W+C.length]=0,W},Z=function(b,C,W){const B=ce(b.structInfo,C,!0);F(B);const ne=te(W);return b[B.key]=ne,j(b,ne),b},ae=function(C,W){arguments[2]!==p&&a("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:p(C),structInfo:p(W)})};ae.prototype=Object.create(null,{dispose:p(function(){f(this.constructor,this)}),lookupMember:p(function(b,C=!0){return ce(this.structInfo,b,C)}),memberToJsString:p(function(b){return z(this,b)}),memberIsString:p(function(b,C=!0){return ht(this,b,C)}),memberKey:oe,memberKeys:ue,memberSignature:p(function(b,C=!1){return pe(this,b,C)}),memoryDump:p(D),pointer:he,setMemberCString:p(function(b,C){return Z(this,b,C)})}),Object.assign(ae.prototype,{addOnDispose:function(...b){return j(this,...b),this}}),Object.defineProperties(ae,{allocCString:p(te),isA:p(b=>b instanceof ae),hasExternalPointer:p(b=>b instanceof ae&&!!b[x]),memberKey:oe});const le=b=>Number.isFinite(b)||b instanceof(P||Number),R=function b(C,W,B){if(!b._){b._={getters:{},setters:{},sw:{}};const Nt=["i","c","C","p","P","s","f","d","v()"];se&&Nt.push("j"),Nt.forEach(function(en){b._.getters[en]=fe(en),b._.setters[en]=_(en),b._.sw[en]=S(en)});const iu=/^[ipPsjfdcC]$/,su=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;b.sigCheck=function(en,ou,va,ho){Object.prototype.hasOwnProperty.call(en,va)&&a(en.structName,"already has a property named",va+"."),iu.test(ho)||su.test(ho)||a("Malformed signature for",T(en.structName,ou)+":",ho)}}const ne=C.memberKey(W);b.sigCheck(C.prototype,W,ne,B.signature),B.key=ne,B.name=W;const de=$(B.signature),ge=T(C.prototype.structName,ne),Me=C.prototype.debugFlags.__flags,un=Object.create(null);un.configurable=!1,un.enumerable=!1,un.get=function(){Me.getter&&L("debug.getter:",b._.getters[de],"for",G(de),ge,"@",this.pointer,"+",B.offset,"sz",B.sizeof);let Nt=new DataView(d().buffer,this.pointer+B.offset,B.sizeof)[b._.getters[de]](0,O);return Me.getter&&L("debug.getter:",ge,"result =",Nt),Nt},B.readOnly?un.set=H(C.prototype.structName,ne):un.set=function(Nt){if(Me.setter&&L("debug.setter:",b._.setters[de],"for",G(de),ge,"@",this.pointer,"+",B.offset,"sz",B.sizeof,Nt),this.pointer||a("Cannot set struct property on disposed instance."),Nt===null)Nt=0;else for(;!le(Nt);){if(U(B.signature)&&Nt instanceof ae){Nt=Nt.pointer||0,Me.setter&&L("debug.setter:",ge,"resolved to",Nt);break}a("Invalid value for pointer-type",ge+".")}new DataView(d().buffer,this.pointer+B.offset,B.sizeof)[b._.setters[de]](0,b._.sw[de](Nt),O)},Object.defineProperty(C.prototype,ne,un)},k=function b(C,W){arguments.length===1?(W=C,C=W.name):W.name||(W.name=C),C||a("Struct name is required.");let B=!1;Object.keys(W.members).forEach(ge=>{const Me=W.members[ge];Me.sizeof?Me.sizeof===1?Me.signature==="c"||Me.signature==="C"||a("Unexpected sizeof==1 member",T(W.name,ge),"with signature",Me.signature):(Me.sizeof%4!==0&&(console.warn("Invalid struct member description =",Me,"from",W),a(C,"member",ge,"sizeof is not aligned. sizeof="+Me.sizeof)),Me.offset%4!==0&&(console.warn("Invalid struct member description =",Me,"from",W),a(C,"member",ge,"offset is not aligned. offset="+Me.offset))):a(C,"member",ge,"is missing sizeof."),(!B||B.offset<Me.offset)&&(B=Me)}),B?W.sizeof<B.offset+B.sizeof&&a("Invalid struct config:",C,"max member offset ("+B.offset+") ","extends past end of struct (sizeof="+W.sizeof+")."):a("No member property descriptions found.");const ne=p(c.__makeDebugFlags(b.debugFlags)),de=function ge(Me){this instanceof ge?arguments.length?((Me!==(Me|0)||Me<=0)&&a("Invalid pointer value for",C,"constructor."),m(ge,this,Me)):m(ge,this):a("The",C,"constructor may only be called via 'new'.")};return Object.defineProperties(de,{debugFlags:ne,isA:p(ge=>ge instanceof de),memberKey:oe,memberKeys:ue,methodInfoForKey:p(function(ge){}),structInfo:p(W),structName:p(C)}),de.prototype=new ae(C,W,p),Object.defineProperties(de.prototype,{debugFlags:ne,constructor:p(de)}),Object.keys(W.members).forEach(ge=>R(de,ge,W.members[ge])),de};return k.StructType=ae,k.config=l,k.allocCString=te,k.debugFlags||(k.debugFlags=c.__makeDebugFlags(c.debugFlags)),k},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...P)=>{throw new Error(P.join(" "))};i.SQLite3Error.toss;const a=i.capi,c=i.wasm,d=i.util;if(globalThis.WhWasmUtilInstaller(c),delete globalThis.WhWasmUtilInstaller,c.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(P,y)=>P[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:P=>P[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new c.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:P=>{let y;return(g,E,O,N)=>{try{const U=c.cArgvToJs(E,O);return y||(y=c.cArgvToJs(E,N)),P(U,y)|0}catch(U){return U.resultCode||a.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_autocommit","int","sqlite3*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(P,y)=>P[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:P=>P[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(P,y)=>P[0],callProxy:P=>(y,g,E,O,N,U)=>{try{return E=E&&c.cstrToJs(E),O=O&&c.cstrToJs(O),N=N&&c.cstrToJs(N),U=U&&c.cstrToJs(U),P(y,g,E,O,N,U)||0}catch($){return $.resultCode||a.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new c.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(P,y)=>P[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(P,y)=>P[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],c.exports.sqlite3_activate_see instanceof Function&&c.bindingSignatures.push(["sqlite3_key","int","sqlite3*","string","int"],["sqlite3_key_v2","int","sqlite3*","string","*","int"],["sqlite3_rekey","int","sqlite3*","string","int"],["sqlite3_rekey_v2","int","sqlite3*","string","*","int"],["sqlite3_activate_see",void 0,"string"]),c.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:P=>P[0],callProxy:P=>(y,g,E,O,N,U,$)=>{P(y,g,E,c.cstrToJs(O),c.cstrToJs(N),U,$)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:P=>P[0],callProxy:P=>(y,g,E,O,N)=>{P(y,g,c.cstrToJs(E),c.cstrToJs(O),N)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],c.bigIntEnabled&&c.exports.sqlite3changegroup_add){const P={signature:"i(ps)",callProxy:y=>(g,E)=>{try{return y(g,c.cstrToJs(E))|0}catch(O){return O.resultCode||a.SQLITE_ERROR}}};c.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...P}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...P}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...P}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...P}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xFilter",...P,contextKey:(y,g)=>y[0]}),"*"]])}c.bindingSignatures.wasm=[["sqlite3_wasm_db_reset","int","sqlite3*"],["sqlite3_wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3_wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3_wasm_posix_create_file","int","string","*","int"],["sqlite3_wasm_vfs_unlink","int","sqlite3_vfs*","string"]],i.StructBinder=globalThis.Jaccwabyt({heap:c.heap8u,alloc:c.alloc,dealloc:c.dealloc,bigIntEnabled:c.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const P=c.xWrap.argAdapter("string");c.xWrap.argAdapter("string:flexible",N=>P(d.flexibleString(N))),c.xWrap.argAdapter("string:static",function(N){return c.isPtr(N)?N:(N=""+N,this[N]||(this[N]=c.allocCString(N)))}.bind(Object.create(null)));const y=c.xWrap.argAdapter("*"),g=function(){};c.xWrap.argAdapter("sqlite3_filename",y)("sqlite3_context*",y)("sqlite3_value*",y)("void*",y)("sqlite3_changegroup*",y)("sqlite3_changeset_iter*",y)("sqlite3_session*",y)("sqlite3_stmt*",N=>y(N instanceof(i?.oo1?.Stmt||g)?N.pointer:N))("sqlite3*",N=>y(N instanceof(i?.oo1?.DB||g)?N.pointer:N))("sqlite3_index_info*",N=>y(N instanceof(a.sqlite3_index_info||g)?N.pointer:N))("sqlite3_module*",N=>y(N instanceof(a.sqlite3_module||g)?N.pointer:N))("sqlite3_vfs*",N=>typeof N=="string"?a.sqlite3_vfs_find(N)||i.SQLite3Error.toss(a.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",N):y(N instanceof(a.sqlite3_vfs||g)?N.pointer:N));const E=c.xWrap.resultAdapter("*");c.xWrap.resultAdapter("sqlite3*",E)("sqlite3_context*",E)("sqlite3_stmt*",E)("sqlite3_value*",E)("sqlite3_vfs*",E)("void*",E),c.exports.sqlite3_step.length===0&&(c.xWrap.doArgcCheck=!1,i.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const N of c.bindingSignatures)a[N[0]]=c.xWrap.apply(null,N);for(const N of c.bindingSignatures.wasm)c[N[0]]=c.xWrap.apply(null,N);const O=function(N){return()=>l(N+"() is unavailable due to lack","of BigInt support in this build.")};for(const N of c.bindingSignatures.int64)a[N[0]]=c.bigIntEnabled?c.xWrap.apply(null,N):O(N[0]);if(delete c.bindingSignatures,c.exports.sqlite3_wasm_db_error){const N=c.xWrap("sqlite3_wasm_db_error","int","sqlite3*","int","string");d.sqlite3_wasm_db_error=function(U,$,G){return $ instanceof i.WasmAllocError?($=a.SQLITE_NOMEM,G=0):$ instanceof Error&&(G=G||""+$,$=$.resultCode||a.SQLITE_ERROR),U?N(U,$,G):$}}else d.sqlite3_wasm_db_error=function(N,U,$){return console.warn("sqlite3_wasm_db_error() is not exported.",arguments),U}}{const P=c.xCall("sqlite3_wasm_enum_json");P||l("Maintenance required: increase sqlite3_wasm_enum_json()'s","static buffer size!"),c.ctype=JSON.parse(c.cstrToJs(P));const y=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];c.bigIntEnabled&&y.push("serialize","session","vtab");for(const O of y)for(const N of Object.entries(c.ctype[O]))a[N[0]]=N[1];c.functionEntry(a.SQLITE_WASM_DEALLOC)||l("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+a.SQLITE_WASM_DEALLOC+").");const g=Object.create(null);for(const O of["resultCodes"])for(const N of Object.entries(c.ctype[O]))g[N[1]]=N[0];a.sqlite3_js_rc_str=O=>g[O];const E=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!d.isUIThread(),sqlite3_index_info:!c.bigIntEnabled,sqlite3_index_constraint:!c.bigIntEnabled,sqlite3_index_orderby:!c.bigIntEnabled,sqlite3_index_constraint_usage:!c.bigIntEnabled});for(const O of c.ctype.structs)E[O.name]||(a[O.name]=i.StructBinder(O));if(a.sqlite3_index_info){for(const O of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])a.sqlite3_index_info[O]=a[O],delete a[O];a.sqlite3_vtab_config=c.xWrap("sqlite3_wasm_vtab_config","int",["sqlite3*","int","int"])}}const q=(P,y,g)=>d.sqlite3_wasm_db_error(P,a.SQLITE_MISUSE,y+"() requires "+g+" argument"+(g===1?"":"s")+"."),I=P=>d.sqlite3_wasm_db_error(P,a.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),L=P=>c.xWrap.argAdapter("sqlite3*")(P),J=P=>c.isPtr(P)?c.cstrToJs(P):P,ee=function(P,y){P=L(P);let g=this.dbMap.get(P);if(y)!g&&y>0&&this.dbMap.set(P,g=Object.create(null));else return this.dbMap.delete(P),g;return g}.bind(Object.assign(Object.create(null),{dbMap:new Map}));ee.addCollation=function(P,y){const g=ee(P,1);g.collation||(g.collation=new Set),g.collation.add(J(y).toLowerCase())},ee._addUDF=function(P,y,g,E){y=J(y).toLowerCase();let O=E.get(y);O||E.set(y,O=new Set),O.add(g<0?-1:g)},ee.addFunction=function(P,y,g){const E=ee(P,1);E.udf||(E.udf=new Map),this._addUDF(P,y,g,E.udf)},ee.addWindowFunc=function(P,y,g){const E=ee(P,1);E.wudf||(E.wudf=new Map),this._addUDF(P,y,g,E.wudf)},ee.cleanup=function(P){P=L(P);const y=[P];for(const O of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const N=c.exports[O];y.length=N.length;try{a[O](...y)}catch(U){console.warn("close-time call of",O+"(",y,") threw:",U)}}const g=ee(P,0);if(!g)return;if(g.collation){for(const O of g.collation)try{a.sqlite3_create_collation_v2(P,O,a.SQLITE_UTF8,0,0,0)}catch{}delete g.collation}let E;for(E=0;E<2;++E){const O=E?g.wudf:g.udf;if(!O)continue;const N=E?a.sqlite3_create_window_function:a.sqlite3_create_function_v2;for(const U of O){const $=U[0],G=U[1],M=[P,$,0,a.SQLITE_UTF8,0,0,0,0,0];E&&M.push(0);for(const fe of G)try{M[2]=fe,N.apply(null,M)}catch{}G.clear()}O.clear()}delete g.udf,delete g.wudf};{const P=c.xWrap("sqlite3_close_v2","int","sqlite3*");a.sqlite3_close_v2=function(y){if(arguments.length!==1)return q(y,"sqlite3_close_v2",1);if(y)try{ee.cleanup(y)}catch{}return P(y)}}if(a.sqlite3session_table_filter){const P=c.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);a.sqlite3session_delete=function(y){if(arguments.length!==1)return q(pDb,"sqlite3session_delete",1);y&&a.sqlite3session_table_filter(y,0,0),P(y)}}{const P=(g,E)=>"argv["+E+"]:"+g[0]+":"+c.cstrToJs(g[1]).toLowerCase(),y=c.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new c.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:P}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:P})]);a.sqlite3_create_collation_v2=function(g,E,O,N,U,$){if(arguments.length!==6)return q(g,"sqlite3_create_collation_v2",6);if(!(O&15))O|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(O&15))return I(g);try{const G=y(g,E,O,N,U,$);return G===0&&U instanceof Function&&ee.addCollation(g,E),G}catch(G){return d.sqlite3_wasm_db_error(g,G)}},a.sqlite3_create_collation=(g,E,O,N,U)=>arguments.length===5?a.sqlite3_create_collation_v2(g,E,O,N,U,0):q(g,"sqlite3_create_collation",5)}{const P=function(O,N){return O[0]+":"+(O[2]<0?-1:O[2])+":"+N+":"+c.cstrToJs(O[1]).toLowerCase()},y=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:P,callProxy:O=>(N,U,$)=>{try{O(N,...a.sqlite3_values_to_js(U,$))}catch(G){a.sqlite3_result_error_js(N,G)}}},xFinalAndValue:{signature:"v(p)",contextKey:P,callProxy:O=>N=>{try{a.sqlite3_result_js(N,O(N))}catch(U){a.sqlite3_result_error_js(N,U)}}},xFunc:{signature:"v(pip)",contextKey:P,callProxy:O=>(N,U,$)=>{try{a.sqlite3_result_js(N,O(N,...a.sqlite3_values_to_js(U,$)))}catch(G){a.sqlite3_result_error_js(N,G)}}},xDestroy:{signature:"v(p)",contextKey:P,callProxy:O=>N=>{try{O(N)}catch(U){console.error("UDF xDestroy method threw:",U)}}}}),g=c.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xFunc",...y.xFunc}),new c.xWrap.FuncPtrAdapter({name:"xStep",...y.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...y.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...y.xDestroy})]),E=c.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xStep",...y.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...y.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xValue",...y.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xInverse",...y.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...y.xDestroy})]);a.sqlite3_create_function_v2=function O(N,U,$,G,M,fe,_,S,T){if(O.length!==arguments.length)return q(N,"sqlite3_create_function_v2",O.length);if(!(G&15))G|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(G&15))return I(N);try{const H=g(N,U,$,G,M,fe,_,S,T);return H===0&&(fe instanceof Function||_ instanceof Function||S instanceof Function||T instanceof Function)&&ee.addFunction(N,U,$),H}catch(H){return console.error("sqlite3_create_function_v2() setup threw:",H),d.sqlite3_wasm_db_error(N,H,"Creation of UDF threw: "+H)}},a.sqlite3_create_function=function O(N,U,$,G,M,fe,_,S){return O.length===arguments.length?a.sqlite3_create_function_v2(N,U,$,G,M,fe,_,S,0):q(N,"sqlite3_create_function",O.length)},a.sqlite3_create_window_function=function O(N,U,$,G,M,fe,_,S,T,H){if(O.length!==arguments.length)return q(N,"sqlite3_create_window_function",O.length);if(!(G&15))G|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(G&15))return I(N);try{const w=E(N,U,$,G,M,fe,_,S,T,H);return w===0&&(fe instanceof Function||_ instanceof Function||S instanceof Function||T instanceof Function||H instanceof Function)&&ee.addWindowFunc(N,U,$),w}catch(w){return console.error("sqlite3_create_window_function() setup threw:",w),d.sqlite3_wasm_db_error(N,w,"Creation of UDF threw: "+w)}},a.sqlite3_create_function_v2.udfSetResult=a.sqlite3_create_function.udfSetResult=a.sqlite3_create_window_function.udfSetResult=a.sqlite3_result_js,a.sqlite3_create_function_v2.udfConvertArgs=a.sqlite3_create_function.udfConvertArgs=a.sqlite3_create_window_function.udfConvertArgs=a.sqlite3_values_to_js,a.sqlite3_create_function_v2.udfSetError=a.sqlite3_create_function.udfSetError=a.sqlite3_create_window_function.udfSetError=a.sqlite3_result_error_js}{const P=(g,E)=>(typeof g=="string"?E=-1:d.isSQLableTypedArray(g)?(E=g.byteLength,g=d.typedArrayToString(g instanceof ArrayBuffer?new Uint8Array(g):g)):Array.isArray(g)&&(g=g.join(""),E=-1),[g,E]),y={basic:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};a.sqlite3_prepare_v3=function g(E,O,N,U,$,G){if(g.length!==arguments.length)return q(E,"sqlite3_prepare_v3",g.length);const[M,fe]=P(O,N);switch(typeof M){case"string":return y.basic(E,M,fe,U,$,null);case"number":return y.full(E,M,fe,U,$,G);default:return d.sqlite3_wasm_db_error(E,a.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},a.sqlite3_prepare_v2=function g(E,O,N,U,$){return g.length===arguments.length?a.sqlite3_prepare_v3(E,O,N,0,U,$):q(E,"sqlite3_prepare_v2",g.length)}}{const P=c.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),y=c.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);a.sqlite3_bind_text=function g(E,O,N,U,$){if(g.length!==arguments.length)return q(a.sqlite3_db_handle(E),"sqlite3_bind_text",g.length);if(c.isPtr(N)||N===null)return P(E,O,N,U,$);N instanceof ArrayBuffer?N=new Uint8Array(N):Array.isArray(pMem)&&(N=pMem.join(""));let G,M;try{if(d.isSQLableTypedArray(N))G=c.allocFromTypedArray(N),M=N.byteLength;else if(typeof N=="string")[G,M]=c.allocCString(N);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return P(E,O,G,M,a.SQLITE_WASM_DEALLOC)}catch(fe){return c.dealloc(G),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),fe)}},a.sqlite3_bind_blob=function g(E,O,N,U,$){if(g.length!==arguments.length)return q(a.sqlite3_db_handle(E),"sqlite3_bind_blob",g.length);if(c.isPtr(N)||N===null)return y(E,O,N,U,$);N instanceof ArrayBuffer?N=new Uint8Array(N):Array.isArray(N)&&(N=N.join(""));let G,M;try{if(d.isBindableTypedArray(N))G=c.allocFromTypedArray(N),M=U>=0?U:N.byteLength;else if(typeof N=="string")[G,M]=c.allocCString(N);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return y(E,O,G,M,a.SQLITE_WASM_DEALLOC)}catch(fe){return c.dealloc(G),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),fe)}}}a.sqlite3_config=function(P,...y){if(arguments.length<2)return a.SQLITE_MISUSE;switch(P){case a.SQLITE_CONFIG_COVERING_INDEX_SCAN:case a.SQLITE_CONFIG_MEMSTATUS:case a.SQLITE_CONFIG_SMALL_MALLOC:case a.SQLITE_CONFIG_SORTERREF_SIZE:case a.SQLITE_CONFIG_STMTJRNL_SPILL:case a.SQLITE_CONFIG_URI:return c.exports.sqlite3_wasm_config_i(P,y[0]);case a.SQLITE_CONFIG_LOOKASIDE:return c.exports.sqlite3_wasm_config_ii(P,y[0],y[1]);case a.SQLITE_CONFIG_MEMDB_MAXSIZE:return c.exports.sqlite3_wasm_config_j(P,y[0]);case a.SQLITE_CONFIG_GETMALLOC:case a.SQLITE_CONFIG_GETMUTEX:case a.SQLITE_CONFIG_GETPCACHE2:case a.SQLITE_CONFIG_GETPCACHE:case a.SQLITE_CONFIG_HEAP:case a.SQLITE_CONFIG_LOG:case a.SQLITE_CONFIG_MALLOC:case a.SQLITE_CONFIG_MMAP_SIZE:case a.SQLITE_CONFIG_MULTITHREAD:case a.SQLITE_CONFIG_MUTEX:case a.SQLITE_CONFIG_PAGECACHE:case a.SQLITE_CONFIG_PCACHE2:case a.SQLITE_CONFIG_PCACHE:case a.SQLITE_CONFIG_PCACHE_HDRSZ:case a.SQLITE_CONFIG_PMASZ:case a.SQLITE_CONFIG_SERIALIZED:case a.SQLITE_CONFIG_SINGLETHREAD:case a.SQLITE_CONFIG_SQLLOG:case a.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return a.SQLITE_NOTFOUND}};{const P=new Set;a.sqlite3_auto_extension=function(y){if(y instanceof Function)y=c.installFunction("i(ppp)",y);else if(arguments.length!==1||!c.isPtr(y))return a.SQLITE_MISUSE;const g=c.exports.sqlite3_auto_extension(y);return y!==arguments[0]&&(g===0?P.add(y):c.uninstallFunction(y)),g},a.sqlite3_cancel_auto_extension=function(y){return!y||arguments.length!==1||!c.isPtr(y)?0:c.exports.sqlite3_cancel_auto_extension(y)},a.sqlite3_reset_auto_extension=function(){c.exports.sqlite3_reset_auto_extension();for(const y of P)c.uninstallFunction(y);P.clear()}}const se=a.sqlite3_vfs_find("kvvfs");if(se)if(d.isUIThread()){const P=new a.sqlite3_kvvfs_methods(c.exports.sqlite3_wasm_kvvfs_methods());delete a.sqlite3_kvvfs_methods;const y=c.exports.sqlite3_wasm_kvvfsMakeKeyOnPstack,g=c.pstack,E=N=>c.peek(N)===115?sessionStorage:localStorage,O={xRead:(N,U,$,G)=>{const M=g.pointer,fe=c.scopedAllocPush();try{const _=y(N,U);if(!_)return-3;const S=c.cstrToJs(_),T=E(N).getItem(S);if(!T)return-1;const H=T.length;if(G<=0)return H;if(G===1)return c.poke($,0),H;const w=c.scopedAllocCString(T);return G>H+1&&(G=H+1),c.heap8u().copyWithin($,w,w+G-1),c.poke($+G-1,0),G-1}catch(_){return console.error("kvstorageRead()",_),-2}finally{g.restore(M),c.scopedAllocPop(fe)}},xWrite:(N,U,$)=>{const G=g.pointer;try{const M=y(N,U);if(!M)return 1;const fe=c.cstrToJs(M);return E(N).setItem(fe,c.cstrToJs($)),0}catch(M){return console.error("kvstorageWrite()",M),a.SQLITE_IOERR}finally{g.restore(G)}},xDelete:(N,U)=>{const $=g.pointer;try{const G=y(N,U);return G?(E(N).removeItem(c.cstrToJs(G)),0):1}catch(G){return console.error("kvstorageDelete()",G),a.SQLITE_IOERR}finally{g.restore($)}}};for(const N of Object.keys(O))P[P.memberKey(N)]=c.installFunction(P.memberSignature(N),O[N])}else a.sqlite3_vfs_unregister(se);c.xWrap.FuncPtrAdapter.warnOnUse=!0}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.45.1",libVersionNumber:3045001,sourceId:"2024-01-30 16:01:20 e876e51a0ed5c5b3126f52e532044363a014bc594cfefa87ffb5b82257cc467a",downloadVersion:3450100}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...w)=>{throw new i.SQLite3Error(...w)},a=i.capi,c=i.wasm,d=i.util,q=new WeakMap,I=new WeakMap,L=(w,x,f)=>{const p=Object.getOwnPropertyDescriptor(w,x);return p?p.value:f},J=function(w,x){return x&&(w instanceof y&&(w=w.pointer),l(x,"sqlite3 result code",x+":",w?a.sqlite3_errmsg(w):a.sqlite3_errstr(x))),arguments[0]},ee=c.installFunction("i(ippp)",function(w,x,f,p){a.SQLITE_TRACE_STMT===w&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+x+":",c.cstrToJs(p))}.bind({counter:0})),se=Object.create(null),P=function w(...x){if(!w._name2vfs){w._name2vfs=Object.create(null);const ue=typeof importScripts=="function"?qe=>l("The VFS for",qe,"is only available in the main window thread."):!1;w._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:ue||(()=>"local")},w._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:ue||(()=>"session")}}const f=w.normalizeArgs(...x);let p=f.filename,m=f.vfs,D=f.flags;(typeof p!="string"&&typeof p!="number"||typeof D!="string"||m&&typeof m!="string"&&typeof m!="number")&&(i.config.error("Invalid DB ctor args",f,arguments),l("Invalid arguments for DB constructor."));let K=typeof p=="number"?c.cstrToJs(p):p;const oe=w._name2vfs[K];oe&&(m=oe.vfs,p=K=oe.filename(K));let ce,pe=0;D.indexOf("c")>=0&&(pe|=a.SQLITE_OPEN_CREATE|a.SQLITE_OPEN_READWRITE),D.indexOf("w")>=0&&(pe|=a.SQLITE_OPEN_READWRITE),pe===0&&(pe|=a.SQLITE_OPEN_READONLY),pe|=a.SQLITE_OPEN_EXRESCODE;const he=c.pstack.pointer;try{const ue=c.pstack.allocPtr();let qe=a.sqlite3_open_v2(p,ue,pe,m||0);ce=c.peekPtr(ue),J(ce,qe),a.sqlite3_extended_result_codes(ce,1),D.indexOf("t")>=0&&a.sqlite3_trace_v2(ce,a.SQLITE_TRACE_STMT,ee,ce)}catch(ue){throw ce&&a.sqlite3_close_v2(ce),ue}finally{c.pstack.restore(he)}this.filename=K,q.set(this,ce),I.set(this,Object.create(null));try{const ue=a.sqlite3_js_db_vfs(ce);ue||l("Internal error: cannot get VFS for new db handle.");const qe=se[ue];qe instanceof Function?qe(this,i):qe&&J(ce,a.sqlite3_exec(ce,qe,0,0,0))}catch(ue){throw this.close(),ue}};P.setVfsPostOpenSql=function(w,x){se[w]=x},P.normalizeArgs=function(w=":memory:",x="c",f=null){const p={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(p,arguments[0]),p.flags===void 0&&(p.flags="c"),p.vfs===void 0&&(p.vfs=null),p.filename===void 0&&(p.filename=":memory:")):(p.filename=w,p.flags=x,p.vfs=f),p};const y=function(...w){P.apply(this,w)};y.dbCtorHelper=P;const g={null:1,number:2,string:3,boolean:4,blob:5};g.undefined==g.null,c.bigIntEnabled&&(g.bigint=g.number);const E=function(){g!==arguments[2]&&l(a.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],q.set(this,arguments[1]),this.parameterCount=a.sqlite3_bind_parameter_count(this.pointer)},O=function(w){return w.pointer||l("DB has been closed."),w},N=function(w,x){return(x!==(x|0)||x<0||x>=w.columnCount)&&l("Column index",x,"is out of range."),w},U=function(w,x){const f=Object.create(null);switch(f.opt=Object.create(null),x.length){case 1:typeof x[0]=="string"||d.isSQLableTypedArray(x[0])||Array.isArray(x[0])?f.sql=x[0]:x[0]&&typeof x[0]=="object"&&(f.opt=x[0],f.sql=f.opt.sql);break;case 2:f.sql=x[0],f.opt=x[1];break;default:l("Invalid argument count for exec().")}f.sql=d.flexibleString(f.sql),typeof f.sql!="string"&&l("Missing SQL argument or unsupported SQL value type.");const p=f.opt;switch(p.returnValue){case"resultRows":p.resultRows||(p.resultRows=[]),f.returnVal=()=>p.resultRows;break;case"saveSql":p.saveSql||(p.saveSql=[]),f.returnVal=()=>p.saveSql;break;case void 0:case"this":f.returnVal=()=>w;break;default:l("Invalid returnValue value:",p.returnValue)}if(!p.callback&&!p.returnValue&&p.rowMode!==void 0&&(p.resultRows||(p.resultRows=[]),f.returnVal=()=>p.resultRows),p.callback||p.resultRows)switch(p.rowMode===void 0?"array":p.rowMode){case"object":f.cbArg=m=>m.get(Object.create(null));break;case"array":f.cbArg=m=>m.get([]);break;case"stmt":Array.isArray(p.resultRows)&&l("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),f.cbArg=m=>m;break;default:if(d.isInt32(p.rowMode)){f.cbArg=m=>m.get(p.rowMode);break}else if(typeof p.rowMode=="string"&&p.rowMode.length>1&&p.rowMode[0]==="$"){const m=p.rowMode.substr(1);f.cbArg=D=>{const K=D.get(Object.create(null))[m];return K===void 0?l(a.SQLITE_NOTFOUND,"exec(): unknown result column:",m):K};break}l("Invalid rowMode:",p.rowMode)}return f},$=(w,x,f,...p)=>{const m=w.prepare(x);try{const D=m.bind(f).step()?m.get(...p):void 0;return m.reset(),D}finally{m.finalize()}},G=(w,x,f,p)=>w.exec({sql:x,bind:f,rowMode:p,returnValue:"resultRows"});y.checkRc=(w,x)=>J(w,x),y.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return O(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const w=this.pointer;if(Object.keys(I.get(this)).forEach((x,f)=>{if(f&&f.pointer)try{f.finalize()}catch{}}),q.delete(this),I.delete(this),a.sqlite3_close_v2(w),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(w=!1,x=!1){const f=O(this).pointer;return w?x?a.sqlite3_total_changes64(f):a.sqlite3_total_changes(f):x?a.sqlite3_changes64(f):a.sqlite3_changes(f)},dbFilename:function(w="main"){return a.sqlite3_db_filename(O(this).pointer,w)},dbName:function(w=0){return a.sqlite3_db_name(O(this).pointer,w)},dbVfsName:function(w=0){let x;const f=a.sqlite3_js_db_vfs(O(this).pointer,w);if(f){const p=new a.sqlite3_vfs(f);try{x=c.cstrToJs(p.$zName)}finally{p.dispose()}}return x},prepare:function(w){O(this);const x=c.pstack.pointer;let f,p;try{f=c.pstack.alloc(8),y.checkRc(this,a.sqlite3_prepare_v2(this.pointer,w,-1,f,null)),p=c.peekPtr(f)}finally{c.pstack.restore(x)}p||l("Cannot prepare empty SQL.");const m=new E(this,p,g);return I.get(this)[p]=m,m},exec:function(){O(this);const w=U(this,arguments);if(!w.sql)return l("exec() requires an SQL string.");const x=w.opt,f=x.callback,p=Array.isArray(x.resultRows)?x.resultRows:void 0;let m,D=x.bind,K=!!(w.cbArg||x.columnNames||p);const oe=c.scopedAllocPush(),ce=Array.isArray(x.saveSql)?x.saveSql:void 0;try{const pe=d.isSQLableTypedArray(w.sql);let he=pe?w.sql.byteLength:c.jstrlen(w.sql);const ue=c.scopedAlloc(2*c.ptrSizeof+(he+1)),qe=ue+c.ptrSizeof;let Te=qe+c.ptrSizeof;const Ce=Te+he;for(pe?c.heap8().set(w.sql,Te):c.jstrcpy(w.sql,c.heap8(),Te,he,!1),c.poke(Te+he,0);Te&&c.peek(Te,"i8");){c.pokePtr([ue,qe],0),y.checkRc(this,a.sqlite3_prepare_v3(this.pointer,Te,he,0,ue,qe));const tt=c.peekPtr(ue);if(Te=c.peekPtr(qe),he=Ce-Te,!!tt){if(ce&&ce.push(a.sqlite3_sql(tt).trim()),m=new E(this,tt,g),D&&m.parameterCount&&(m.bind(D),D=null),K&&m.columnCount){let ht=Array.isArray(x.columnNames)?0:1;if(K=!1,w.cbArg||p){for(;m.step();m._lockedByExec=!1){ht++===0&&m.getColumnNames(x.columnNames),m._lockedByExec=!0;const F=w.cbArg(m);if(p&&p.push(F),f&&f.call(x,F,m)===!1)break}m._lockedByExec=!1}ht===0&&m.getColumnNames(x.columnNames)}else m.step();m.reset().finalize(),m=null}}}finally{c.scopedAllocPop(oe),m&&(delete m._lockedByExec,m.finalize())}return w.returnVal()},createFunction:function(x,f,p){const m=F=>F instanceof Function;switch(arguments.length){case 1:p=x,x=p.name,f=p.xFunc||0;break;case 2:m(f)||(p=f,f=p.xFunc||0);break}p||(p={}),typeof x!="string"&&l("Invalid arguments: missing function name.");let D=p.xStep||0,K=p.xFinal||0;const oe=p.xValue||0,ce=p.xInverse||0;let pe;m(f)?(pe=!1,(m(D)||m(K))&&l("Ambiguous arguments: scalar or aggregate?"),D=K=null):m(D)?(m(K)||l("Missing xFinal() callback for aggregate or window UDF."),f=null):m(K)?l("Missing xStep() callback for aggregate or window UDF."):l("Missing function-type properties."),pe===!1?(m(oe)||m(ce))&&l("xValue and xInverse are not permitted for non-window UDFs."):m(oe)?(m(ce)||l("xInverse must be provided if xValue is."),pe=!0):m(ce)&&l("xValue must be provided if xInverse is.");const he=p.pApp;he!=null&&(typeof he!="number"||!d.isInt32(he))&&l("Invalid value for pApp property. Must be a legal WASM pointer value.");const ue=p.xDestroy||0;ue&&!m(ue)&&l("xDestroy property must be a function.");let qe=0;L(p,"deterministic")&&(qe|=a.SQLITE_DETERMINISTIC),L(p,"directOnly")&&(qe|=a.SQLITE_DIRECTONLY),L(p,"innocuous")&&(qe|=a.SQLITE_INNOCUOUS),x=x.toLowerCase();const Te=f||D,Ce=L(p,"arity"),tt=typeof Ce=="number"?Ce:Te.length?Te.length-1:0;let ht;return pe?ht=a.sqlite3_create_window_function(this.pointer,x,tt,a.SQLITE_UTF8|qe,he||0,D,K,oe,ce,ue):ht=a.sqlite3_create_function_v2(this.pointer,x,tt,a.SQLITE_UTF8|qe,he||0,f,D,K,ue),y.checkRc(this,ht),this},selectValue:function(w,x,f){return $(this,w,x,0,f)},selectValues:function(w,x,f){const p=this.prepare(w),m=[];try{for(p.bind(x);p.step();)m.push(p.get(0,f));p.reset()}finally{p.finalize()}return m},selectArray:function(w,x){return $(this,w,x,[])},selectObject:function(w,x){return $(this,w,x,{})},selectArrays:function(w,x){return G(this,w,x,"array")},selectObjects:function(w,x){return G(this,w,x,"object")},openStatementCount:function(){return this.pointer?Object.keys(I.get(this)).length:0},transaction:function(w){let x="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&l(a.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),x+=" "+arguments[0],w=arguments[1]),O(this).exec(x);try{const f=w(this);return this.exec("COMMIT"),f}catch(f){throw this.exec("ROLLBACK"),f}},savepoint:function(w){O(this).exec("SAVEPOINT oo1");try{const x=w(this);return this.exec("RELEASE oo1"),x}catch(x){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),x}},checkRc:function(w){return J(this,w)}};const M=function(w){return w.pointer||l("Stmt has been closed."),w},fe=function(w){let x=g[w==null?"null":typeof w];switch(x){case g.boolean:case g.null:case g.number:case g.string:return x;case g.bigint:if(c.bigIntEnabled)return x;default:return d.isBindableTypedArray(w)?g.blob:void 0}},_=function(w){return fe(w)||l("Unsupported bind() argument type:",typeof w)},S=function(w,x){const f=typeof x=="number"?x:a.sqlite3_bind_parameter_index(w.pointer,x);return f===0||!d.isInt32(f)?l("Invalid bind() parameter name: "+x):(f<1||f>w.parameterCount)&&l("Bind index",x,"is out of range."),f},T=function(w,x){return w._lockedByExec&&l("Operation is illegal when statement is locked:",x),w},H=function w(x,f,p,m){T(M(x),"bind()"),w._||(w._tooBigInt=K=>l("BigInt value is too big to store without precision loss:",K),w._={string:function(K,oe,ce,pe){const[he,ue]=c.allocCString(ce,!0);return(pe?a.sqlite3_bind_blob:a.sqlite3_bind_text)(K.pointer,oe,he,ue,a.SQLITE_WASM_DEALLOC)}}),_(m),f=S(x,f);let D=0;switch(m==null?g.null:p){case g.null:D=a.sqlite3_bind_null(x.pointer,f);break;case g.string:D=w._.string(x,f,m,!1);break;case g.number:{let K;d.isInt32(m)?K=a.sqlite3_bind_int:typeof m=="bigint"?d.bigIntFits64(m)?c.bigIntEnabled?K=a.sqlite3_bind_int64:d.bigIntFitsDouble(m)?(m=Number(m),K=a.sqlite3_bind_double):w._tooBigInt(m):w._tooBigInt(m):(m=Number(m),c.bigIntEnabled&&Number.isInteger(m)?K=a.sqlite3_bind_int64:K=a.sqlite3_bind_double),D=K(x.pointer,f,m);break}case g.boolean:D=a.sqlite3_bind_int(x.pointer,f,m?1:0);break;case g.blob:{if(typeof m=="string"){D=w._.string(x,f,m,!0);break}else m instanceof ArrayBuffer?m=new Uint8Array(m):d.isBindableTypedArray(m)||l("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const K=c.alloc(m.byteLength||1);c.heap8().set(m.byteLength?m:[0],K),D=a.sqlite3_bind_blob(x.pointer,f,K,m.byteLength,a.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",m),l("Unsupported bind() argument type: "+typeof m)}return D&&y.checkRc(x.db.pointer,D),x._mayGet=!1,x};E.prototype={finalize:function(){if(this.pointer){T(this,"finalize()");const w=a.sqlite3_finalize(this.pointer);return delete I.get(this.db)[this.pointer],q.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,w}},clearBindings:function(){return T(M(this),"clearBindings()"),a.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(w){T(this,"reset()"),w&&this.clearBindings();const x=a.sqlite3_reset(M(this).pointer);return this._mayGet=!1,J(this.db,x),this},bind:function(){M(this);let w,x;switch(arguments.length){case 1:w=1,x=arguments[0];break;case 2:w=arguments[0],x=arguments[1];break;default:l("Invalid bind() arguments.")}return x===void 0?this:(this.parameterCount||l("This statement has no bindable parameters."),this._mayGet=!1,x===null?H(this,w,g.null,x):Array.isArray(x)?(arguments.length!==1&&l("When binding an array, an index argument is not permitted."),x.forEach((f,p)=>H(this,p+1,_(f),f)),this):(x instanceof ArrayBuffer&&(x=new Uint8Array(x)),typeof x=="object"&&!d.isBindableTypedArray(x)?(arguments.length!==1&&l("When binding an object, an index argument is not permitted."),Object.keys(x).forEach(f=>H(this,f,_(x[f]),x[f])),this):H(this,w,_(x),x)))},bindAsBlob:function(w,x){M(this),arguments.length===1&&(x=w,w=1);const f=_(x);return g.string!==f&&g.blob!==f&&g.null!==f&&l("Invalid value type for bindAsBlob()"),H(this,w,g.blob,x)},step:function(){T(this,"step()");const w=a.sqlite3_step(M(this).pointer);switch(w){case a.SQLITE_DONE:return this._mayGet=!1;case a.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,i.config.warn("sqlite3_step() rc=",w,a.sqlite3_js_rc_str(w),"SQL =",a.sqlite3_sql(this.pointer)),y.checkRc(this.db.pointer,w)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const w=this.step();return this.reset(),w}finally{try{this.finalize()}catch{}}},get:function(w,x){if(M(this)._mayGet||l("Stmt.step() has not (recently) returned true."),Array.isArray(w)){let f=0;const p=this.columnCount;for(;f<p;)w[f]=this.get(f++);return w}else if(w&&typeof w=="object"){let f=0;const p=this.columnCount;for(;f<p;)w[a.sqlite3_column_name(this.pointer,f)]=this.get(f++);return w}switch(N(this,w),x===void 0?a.sqlite3_column_type(this.pointer,w):x){case a.SQLITE_NULL:return null;case a.SQLITE_INTEGER:if(c.bigIntEnabled){const f=a.sqlite3_column_int64(this.pointer,w);return f>=Number.MIN_SAFE_INTEGER&&f<=Number.MAX_SAFE_INTEGER?Number(f).valueOf():f}else{const f=a.sqlite3_column_double(this.pointer,w);return(f>Number.MAX_SAFE_INTEGER||f<Number.MIN_SAFE_INTEGER)&&l("Integer is out of range for JS integer range: "+f),d.isInt32(f)?f|0:f}case a.SQLITE_FLOAT:return a.sqlite3_column_double(this.pointer,w);case a.SQLITE_TEXT:return a.sqlite3_column_text(this.pointer,w);case a.SQLITE_BLOB:{const f=a.sqlite3_column_bytes(this.pointer,w),p=a.sqlite3_column_blob(this.pointer,w),m=new Uint8Array(f);return f&&m.set(c.heap8u().slice(p,p+f),0),f&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(m.buffer),m}default:l("Don't know how to translate","type of result column #"+w+".")}l("Not reached.")},getInt:function(w){return this.get(w,a.SQLITE_INTEGER)},getFloat:function(w){return this.get(w,a.SQLITE_FLOAT)},getString:function(w){return this.get(w,a.SQLITE_TEXT)},getBlob:function(w){return this.get(w,a.SQLITE_BLOB)},getJSON:function(w){const x=this.get(w,a.SQLITE_STRING);return x===null?x:JSON.parse(x)},getColumnName:function(w){return a.sqlite3_column_name(N(M(this),w).pointer,w)},getColumnNames:function(w=[]){N(M(this),0);const x=this.columnCount;for(let f=0;f<x;++f)w.push(a.sqlite3_column_name(this.pointer,f));return w},getParamIndex:function(w){return M(this).parameterCount?a.sqlite3_bind_parameter_index(this.pointer,w):void 0}};{const w={enumerable:!0,get:function(){return q.get(this)},set:()=>l("The pointer property is read-only.")};Object.defineProperty(E.prototype,"pointer",w),Object.defineProperty(y.prototype,"pointer",w)}if(Object.defineProperty(E.prototype,"columnCount",{enumerable:!1,get:function(){return a.sqlite3_column_count(this.pointer)},set:()=>l("The columnCount property is read-only.")}),i.oo1={DB:y,Stmt:E},d.isUIThread()){i.oo1.JsStorageDb=function(x="session"){x!=="session"&&x!=="local"&&l("JsStorageDb db name must be one of 'session' or 'local'."),P.call(this,{filename:x,flags:"c",vfs:"kvvfs"})};const w=i.oo1.JsStorageDb;w.prototype=Object.create(y.prototype),w.clearStorage=a.sqlite3_js_kvvfs_clear,w.prototype.clearStorage=function(){return w.clearStorage(O(this).filename)},w.storageSize=a.sqlite3_js_kvvfs_size,w.prototype.storageSize=function(){return w.storageSize(O(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.initWorker1API=function(){const l=(...y)=>{throw new Error(y.join(" "))};globalThis.WorkerGlobalScope instanceof Function||l("initWorker1API() must be run from a Worker thread.");const a=this.sqlite3||l("Missing this.sqlite3 object."),c=a.oo1.DB,d=function(y){let g=q.idMap.get(y);return g||(g="db#"+ ++q.idSeq+"@"+y.pointer,q.idMap.set(y,g),g)},q={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(y){const g=new c(y);return this.dbs[d(g)]=g,this.dbList.indexOf(g)<0&&this.dbList.push(g),g},close:function(y,g){if(y){delete this.dbs[d(y)];const E=y.filename,O=a.wasm.sqlite3_wasm_db_vfs(y.pointer,0);y.close();const N=this.dbList.indexOf(y);N>=0&&this.dbList.splice(N,1),g&&E&&O&&a.wasm.sqlite3_wasm_vfs_unlink(O,E)}},post:function(y,g){g&&g.length?(globalThis.postMessage(y,Array.from(g)),g.length=0):globalThis.postMessage(y)},dbs:Object.create(null),getDb:function(y,g=!0){return this.dbs[y]||(g?l("Unknown (or closed) DB ID:",y):void 0)}},I=function(y=q.dbList[0]){return y&&y.pointer?y:l("DB is not opened.")},L=function(y,g=!0){const E=q.getDb(y.dbId,!1)||q.dbList[0];return g?I(E):E},J=function(){return q.dbList[0]&&d(q.dbList[0])},ee=function(y){const g=/^file:.+(vfs=(\w+))/.exec(y);return a.capi.sqlite3_vfs_find(g?g[2]:0)},se=y=>y===""||y[0]===":",P={open:function(y){const g=Object.create(null),E=y.args||Object.create(null);E.simulateError&&l("Throwing because of simulateError flag.");const O=Object.create(null);let N,U;if(g.vfs=E.vfs,se(E.filename)?g.filename=E.filename||"":(g.filename=E.filename,N=E.byteArray,N&&(U=ee(E.filename))),U){let G;try{G=a.wasm.allocFromTypedArray(N);const M=a.wasm.sqlite3_wasm_vfs_create_file(U,g.filename,G,N.byteLength);M&&a.SQLite3Error.toss(M)}catch(M){throw new a.SQLite3Error(M.name+" creating "+E.filename+": "+M.message,{cause:M})}finally{G&&a.wasm.dealloc(G)}}const $=q.open(g);return O.filename=$.filename,O.persistent=!!a.capi.sqlite3_js_db_uses_vfs($.pointer,"opfs"),O.dbId=d($),O.vfs=$.dbVfsName(),O},close:function(y){const g=L(y,!1),E={filename:g&&g.filename};if(g){const O=y.args&&typeof y.args=="object"?!!y.args.unlink:!1;q.close(g,O)}return E},exec:function(y){const g=typeof y.args=="string"?{sql:y.args}:y.args||Object.create(null);g.rowMode==="stmt"?l("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):g.sql||l("'exec' requires input SQL.");const E=L(y);(g.callback||Array.isArray(g.resultRows))&&(E._blobXfer=q.xfer);const O=g.callback;let N=0;const U=!!g.columnNames;typeof O=="string"&&(U||(g.columnNames=[]),g.callback=function($,G){q.post({type:O,columnNames:g.columnNames,rowNumber:++N,row:$},q.xfer)});try{const $=g.countChanges?E.changes(!0,g.countChanges===64):void 0;E.exec(g),$!==void 0&&(g.changeCount=E.changes(!0,g.countChanges===64)-$),g.callback instanceof Function&&(g.callback=O,q.post({type:O,columnNames:g.columnNames,rowNumber:null,row:void 0}))}finally{delete E._blobXfer,g.callback&&(g.callback=O)}return g},"config-get":function(){const y=Object.create(null),g=a.config;return["bigIntEnabled"].forEach(function(E){Object.getOwnPropertyDescriptor(g,E)&&(y[E]=g[E])}),y.version=a.version,y.vfsList=a.capi.sqlite3_js_vfs_list(),y.opfsEnabled=!!a.opfs,y},export:function(y){const g=L(y),E={byteArray:a.capi.sqlite3_js_db_export(g.pointer),filename:g.filename,mimetype:"application/x-sqlite3"};return q.xfer.push(E.byteArray.buffer),E},toss:function(y){l("Testing worker exception")},"opfs-tree":async function(y){return a.opfs||l("OPFS support is unavailable."),await a.opfs.treeList()}};globalThis.onmessage=async function(y){y=y.data;let g,E=y.dbId,O=y.type;const N=performance.now();try{P.hasOwnProperty(O)&&P[O]instanceof Function?g=await P[O](y):l("Unknown db worker message type:",y.type)}catch(U){O="error",g={operation:y.type,message:U.message,errorClass:U.name,input:y},U.stack&&(g.stack=typeof U.stack=="string"?U.stack.split(/\n\s*/):U.stack)}E||(E=g.dbId||J()),q.post({type:O,dbId:E,messageId:y.messageId,workerReceivedTime:N,workerRespondTime:performance.now(),departureTime:y.departureTime,result:g},q.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}.bind({sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=i.wasm,a=i.capi,c=i.util.toss3,d=Object.create(null),q=Object.create(null),I=i.StructBinder;i.vfs=d,i.vtab=q;const L=a.sqlite3_index_info;L.prototype.nthConstraint=function(y,g=!1){if(y<0||y>=this.$nConstraint)return!1;const E=this.$aConstraint+L.sqlite3_index_constraint.structInfo.sizeof*y;return g?E:new L.sqlite3_index_constraint(E)},L.prototype.nthConstraintUsage=function(y,g=!1){if(y<0||y>=this.$nConstraint)return!1;const E=this.$aConstraintUsage+L.sqlite3_index_constraint_usage.structInfo.sizeof*y;return g?E:new L.sqlite3_index_constraint_usage(E)},L.prototype.nthOrderBy=function(y,g=!1){if(y<0||y>=this.$nOrderBy)return!1;const E=this.$aOrderBy+L.sqlite3_index_orderby.structInfo.sizeof*y;return g?E:new L.sqlite3_index_orderby(E)};const J=function y(g,E,O,N=y.installMethodArgcCheck){if(g instanceof I.StructType?!(O instanceof Function)&&!l.isPtr(O)&&c("Usage errror: expecting a Function or WASM pointer to one."):c("Usage error: target object is-not-a StructType."),arguments.length===1)return(M,fe)=>y(g,M,fe,N);y.argcProxy||(y.argcProxy=function(M,fe,_,S){return function(...T){return _.length!==arguments.length&&c("Argument mismatch for",M.structInfo.name+"::"+fe+": Native signature is:",S),_.apply(this,T)}},y.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((M,fe)=>{if(typeof M=="number")try{l.uninstallFunction(M)}catch{}}),delete this.ondispose.__removeFuncList)});const U=g.memberSignature(E);U.length<2&&c("Member",E,"does not have a function pointer signature:",U);const $=g.memberKey(E),G=N&&!l.isPtr(O)?y.argcProxy(g,$,O,U):O;if(l.isPtr(G))G&&!l.functionEntry(G)&&c("Pointer",G,"is not a WASM function table entry."),g[$]=G;else{const M=l.installFunction(G,g.memberSignature(E,!0));g[$]=M,(!g.ondispose||!g.ondispose.__removeFuncList)&&(g.addOnDispose("ondispose.__removeFuncList handler",y.removeFuncList),g.ondispose.__removeFuncList=[]),g.ondispose.__removeFuncList.push($,M)}return(M,fe)=>y(g,M,fe,N)};J.installMethodArgcCheck=!1;const ee=function(y,g,E=J.installMethodArgcCheck){const O=new Map;for(const N of Object.keys(g)){const U=g[N],$=O.get(U);if($){const G=y.memberKey(N);y[G]=y[y.memberKey($)]}else J(y,N,U,E),O.set(U,N)}return y};I.StructType.prototype.installMethod=function(g,E,O=J.installMethodArgcCheck){return arguments.length<3&&g&&typeof g=="object"?ee(this,...arguments):J(this,...arguments)},I.StructType.prototype.installMethods=function(y,g=J.installMethodArgcCheck){return ee(this,y,g)},a.sqlite3_vfs.prototype.registerVfs=function(y=!1){this instanceof i.capi.sqlite3_vfs||c("Expecting a sqlite3_vfs-type argument.");const g=a.sqlite3_vfs_register(this,y?1:0);return g&&c("sqlite3_vfs_register(",this,") failed with rc",g),this.pointer!==a.sqlite3_vfs_find(this.$zName)&&c("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},d.installVfs=function(y){let g=0;const E=["io","vfs"];for(const O of E){const N=y[O];N&&(++g,ee(N.struct,N.methods,!!N.applyArgcCheck),O==="vfs"&&(!N.struct.$zName&&typeof N.name=="string"&&N.struct.addOnDispose(N.struct.$zName=l.allocCString(N.name)),N.struct.registerVfs(!!N.asDefault)))}return g||c("Misuse: installVfs() options object requires at least","one of:",E),this};const se=function(y,g){return function(E,O=!1){if(arguments.length===0&&(E=new g),E instanceof g)return this.set(E.pointer,E),E;l.isPtr(E)||i.SQLite3Error.toss("Invalid argument to",y+"()");let N=this.get(E);return O&&this.delete(E),N}.bind(new Map)},P=function(y,g){const E=se(y,g);return Object.assign(Object.create(null),{StructType:g,create:O=>{const N=E();return l.pokePtr(O,N.pointer),N},get:O=>E(O),unget:O=>E(O,!0),dispose:O=>{const N=E(O,!0);N&&N.dispose()}})};q.xVtab=P("xVtab",a.sqlite3_vtab),q.xCursor=P("xCursor",a.sqlite3_vtab_cursor),q.xIndexInfo=y=>new a.sqlite3_index_info(y),q.xError=function y(g,E,O){if(y.errorReporter instanceof Function)try{y.errorReporter("sqlite3_module::"+g+"(): "+E.message)}catch{}let N;return E instanceof i.WasmAllocError?N=a.SQLITE_NOMEM:arguments.length>2?N=O:E instanceof i.SQLite3Error&&(N=E.resultCode),N||a.SQLITE_ERROR},q.xError.errorReporter=console.error.bind(console),q.xRowid=(y,g)=>l.poke(y,g,"i64"),q.setupModule=function(y){let g=!1;const E=this instanceof a.sqlite3_module?this:y.struct||(g=new a.sqlite3_module);try{const O=y.methods||c("Missing 'methods' object.");for(const N of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const U=N[0],$=N[1];O[U]===!0?O[U]=O[$]:O[$]===!0&&(O[$]=O[U])}if(y.catchExceptions){const N=function(G,M){return["xConnect","xCreate"].indexOf(G)>=0?function(fe,_,S,T,H,w){try{return M(...arguments)||0}catch(x){return x instanceof i.WasmAllocError||(l.dealloc(l.peekPtr(w)),l.pokePtr(w,l.allocCString(x.message))),q.xError(G,x)}}:function(...fe){try{return M(...fe)||0}catch(_){return q.xError(G,_)}}},U=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],$=Object.create(null);for(const G of U){const M=O[G];if(M instanceof Function)G==="xConnect"&&O.xCreate===M?$[G]=O.xCreate:G==="xCreate"&&O.xConnect===M?$[G]=O.xConnect:$[G]=N(G,M);else continue}ee(E,$,!1)}else ee(E,O,!!y.applyArgcCheck);if(E.$iVersion===0){let N;typeof y.iVersion=="number"?N=y.iVersion:E.$xShadowName?N=3:E.$xSavePoint||E.$xRelease||E.$xRollbackTo?N=2:N=1,E.$iVersion=N}}catch(O){throw g&&g.dispose(),O}return E},a.sqlite3_module.prototype.setupModule=function(y){return q.setupModule.call(this,y)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=function a(c){if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory)return Promise.reject(new Error("Missing required OPFS APIs."));(!c||typeof c!="object")&&(c=Object.create(null));const d=new URL(globalThis.location.href).searchParams;return d.has("opfs-disable")?Promise.resolve(i):(c.verbose===void 0&&(c.verbose=d.has("opfs-verbose")?+d.get("opfs-verbose")||2:1),c.sanityChecks===void 0&&(c.sanityChecks=d.has("opfs-sanity-check")),c.proxyUri===void 0&&(c.proxyUri=a.defaultProxyUri),typeof c.proxyUri=="function"&&(c.proxyUri=c.proxyUri()),new Promise(function(I,L){const J=[i.config.error,i.config.warn,i.config.log],ee=(F,...z)=>{c.verbose>F&&J[F]("OPFS syncer:",...z)},se=(...F)=>ee(2,...F),P=(...F)=>ee(1,...F),y=(...F)=>ee(0,...F),g=i.util.toss,E=i.capi,O=i.util,N=i.wasm,U=E.sqlite3_vfs,$=E.sqlite3_file,G=E.sqlite3_io_methods,M=Object.create(null),fe=()=>globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&navigator?.storage?.getDirectory;M.metrics={dump:function(){let F,z=0,j=0,te=0;for(F in m.opIds){const Z=D[F];z+=Z.count,j+=Z.time,te+=Z.wait,Z.avgTime=Z.count&&Z.time?Z.time/Z.count:0,Z.avgWait=Z.count&&Z.wait?Z.wait/Z.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",D,`
Total of`,z,"op(s) for",j,"ms (incl. "+te+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",D.s11n),x.postMessage({type:"opfs-async-metrics"})},reset:function(){let F;const z=te=>te.count=te.time=te.wait=0;for(F in m.opIds)z(D[F]=Object.create(null));let j=D.s11n=Object.create(null);j=j.serialize=Object.create(null),j.count=j.time=0,j=D.s11n.deserialize=Object.create(null),j.count=j.time=0}};const _=new G,S=new U().addOnDispose(()=>_.dispose());let T;const H=F=>(T=!0,S.dispose(),L(F)),w=()=>(T=!1,I(i)),x=new Worker(new URL(""+new URL("sqlite3-opfs-async-proxy-oRRWdEq1.js",import.meta.url).href,import.meta.url));setTimeout(()=>{T===void 0&&H(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),x._originalOnError=x.onerror,x.onerror=function(F){y("Error initializing OPFS asyncer:",F),H(new Error("Loading OPFS async Worker failed for unknown reasons."))};const f=E.sqlite3_vfs_find(null),p=f?new U(f):null;_.$iVersion=1,S.$iVersion=2,S.$szOsFile=E.sqlite3_file.structInfo.sizeof,S.$mxPathname=1024,S.$zName=N.allocCString("opfs"),S.$xDlOpen=S.$xDlError=S.$xDlSym=S.$xDlClose=null,S.addOnDispose("$zName",S.$zName,"cleanup default VFS wrapper",()=>p?p.dispose():null);const m=Object.create(null);m.verbose=c.verbose,m.littleEndian=(()=>{const F=new ArrayBuffer(2);return new DataView(F).setInt16(0,256,!0),new Int16Array(F)[0]===256})(),m.asyncIdleWaitTime=150,m.asyncS11nExceptions=1,m.fileBufferSize=1024*64,m.sabS11nOffset=m.fileBufferSize,m.sabS11nSize=S.$mxPathname*2,m.sabIO=new SharedArrayBuffer(m.fileBufferSize+m.sabS11nSize),m.opIds=Object.create(null);const D=Object.create(null);{let F=0;m.opIds.whichOp=F++,m.opIds.rc=F++,m.opIds.xAccess=F++,m.opIds.xClose=F++,m.opIds.xDelete=F++,m.opIds.xDeleteNoWait=F++,m.opIds.xFileSize=F++,m.opIds.xLock=F++,m.opIds.xOpen=F++,m.opIds.xRead=F++,m.opIds.xSleep=F++,m.opIds.xSync=F++,m.opIds.xTruncate=F++,m.opIds.xUnlock=F++,m.opIds.xWrite=F++,m.opIds.mkdir=F++,m.opIds["opfs-async-metrics"]=F++,m.opIds["opfs-async-shutdown"]=F++,m.opIds.retry=F++,m.sabOP=new SharedArrayBuffer(F*4),M.metrics.reset()}m.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(F=>{(m.sq3Codes[F]=E[F])===void 0&&g("Maintenance required: not found:",F)}),m.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,defaultUnlockAsap:!1});const K=(F,...z)=>{const j=m.opIds[F]||g("Invalid op ID:",F);m.s11n.serialize(...z),Atomics.store(m.sabOPView,m.opIds.rc,-1),Atomics.store(m.sabOPView,m.opIds.whichOp,j),Atomics.notify(m.sabOPView,m.opIds.whichOp);const te=performance.now();Atomics.wait(m.sabOPView,m.opIds.rc,-1);const Z=Atomics.load(m.sabOPView,m.opIds.rc);if(D[F].wait+=performance.now()-te,Z&&m.asyncS11nExceptions){const ae=m.s11n.deserialize();ae&&y(F+"() async error:",...ae)}return Z};M.debug={asyncShutdown:()=>{P("Shutting down OPFS async listener. The OPFS VFS will no longer work."),K("opfs-async-shutdown")},asyncRestart:()=>{P("Attempting to restart OPFS VFS async listener. Might work, might not."),x.postMessage({type:"opfs-async-restart"})}};const oe=()=>{if(m.s11n)return m.s11n;const F=new TextDecoder,z=new TextEncoder("utf-8"),j=new Uint8Array(m.sabIO,m.sabS11nOffset,m.sabS11nSize),te=new DataView(m.sabIO,m.sabS11nOffset,m.sabS11nSize);m.s11n=Object.create(null);const Z=Object.create(null);Z.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Z.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Z.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Z.string={id:4};const ae=R=>Z[typeof R]||g("Maintenance required: this value type cannot be serialized.",R),le=R=>{switch(R){case Z.number.id:return Z.number;case Z.bigint.id:return Z.bigint;case Z.boolean.id:return Z.boolean;case Z.string.id:return Z.string;default:g("Invalid type ID:",R)}};return m.s11n.deserialize=function(R=!1){++D.s11n.deserialize.count;const k=performance.now(),b=j[0],C=b?[]:null;if(b){const W=[];let B=1,ne,de,ge;for(ne=0;ne<b;++ne,++B)W.push(le(j[B]));for(ne=0;ne<b;++ne){const Me=W[ne];Me.getter?(ge=te[Me.getter](B,m.littleEndian),B+=Me.size):(de=te.getInt32(B,m.littleEndian),B+=4,ge=F.decode(j.slice(B,B+de)),B+=de),C.push(ge)}}return R&&(j[0]=0),D.s11n.deserialize.time+=performance.now()-k,C},m.s11n.serialize=function(...R){const k=performance.now();if(++D.s11n.serialize.count,R.length){const b=[];let C=0,W=1;for(j[0]=R.length&255;C<R.length;++C,++W)b.push(ae(R[C])),j[W]=b[C].id;for(C=0;C<R.length;++C){const B=b[C];if(B.setter)te[B.setter](W,R[C],m.littleEndian),W+=B.size;else{const ne=z.encode(R[C]);te.setInt32(W,ne.byteLength,m.littleEndian),W+=4,j.set(ne,W),W+=ne.byteLength}}}else j[0]=0;D.s11n.serialize.time+=performance.now()-k},m.s11n},ce=function F(z=16){F._chars||(F._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",F._n=F._chars.length);const j=[];let te=0;for(;te<z;++te){const Z=Math.random()*(F._n*64)%F._n|0;j[te]=F._chars[Z]}return j.join("")},pe=Object.create(null),he=Object.create(null);he.op=void 0,he.start=void 0;const ue=F=>{he.start=performance.now(),he.op=F,++D[F].count},qe=()=>D[he.op].time+=performance.now()-he.start,Te={xCheckReservedLock:function(F,z){const j=pe[F];return N.poke(z,j.lockType?1:0,"i32"),0},xClose:function(F){ue("xClose");let z=0;const j=pe[F];return j&&(delete pe[F],z=K("xClose",F),j.sq3File&&j.sq3File.dispose()),qe(),z},xDeviceCharacteristics:function(F){return E.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(F,z,j){return E.SQLITE_NOTFOUND},xFileSize:function(F,z){ue("xFileSize");let j=K("xFileSize",F);if(j==0)try{const te=m.s11n.deserialize()[0];N.poke(z,te,"i64")}catch(te){y("Unexpected error reading xFileSize() result:",te),j=m.sq3Codes.SQLITE_IOERR}return qe(),j},xLock:function(F,z){ue("xLock");const j=pe[F];let te=0;return j.lockType?j.lockType=z:(te=K("xLock",F,z),te===0&&(j.lockType=z)),qe(),te},xRead:function(F,z,j,te){ue("xRead");const Z=pe[F];let ae;try{ae=K("xRead",F,j,Number(te)),(ae===0||E.SQLITE_IOERR_SHORT_READ===ae)&&N.heap8u().set(Z.sabView.subarray(0,j),z)}catch(le){y("xRead(",arguments,") failed:",le,Z),ae=E.SQLITE_IOERR_READ}return qe(),ae},xSync:function(F,z){ue("xSync"),++D.xSync.count;const j=K("xSync",F,z);return qe(),j},xTruncate:function(F,z){ue("xTruncate");const j=K("xTruncate",F,Number(z));return qe(),j},xUnlock:function(F,z){ue("xUnlock");const j=pe[F];let te=0;return E.SQLITE_LOCK_NONE===z&&j.lockType&&(te=K("xUnlock",F,z)),te===0&&(j.lockType=z),qe(),te},xWrite:function(F,z,j,te){ue("xWrite");const Z=pe[F];let ae;try{Z.sabView.set(N.heap8u().subarray(z,z+j)),ae=K("xWrite",F,j,Number(te))}catch(le){y("xWrite(",arguments,") failed:",le,Z),ae=E.SQLITE_IOERR_WRITE}return qe(),ae}},Ce={xAccess:function(F,z,j,te){ue("xAccess");const Z=K("xAccess",N.cstrToJs(z));return N.poke(te,Z?0:1,"i32"),qe(),0},xCurrentTime:function(F,z){return N.poke(z,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(F,z){return N.poke(z,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(F,z,j){ue("xDelete");const te=K("xDelete",N.cstrToJs(z),j,!1);return qe(),te},xFullPathname:function(F,z,j,te){return N.cstrncpy(te,z,j)<j?0:E.SQLITE_CANTOPEN},xGetLastError:function(F,z,j){return P("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(z,j,te,Z,ae){ue("xOpen");let le=0;j===0?j=ce():typeof j=="number"&&(E.sqlite3_uri_boolean(j,"opfs-unlock-asap",0)&&(le|=m.opfsFlags.OPFS_UNLOCK_ASAP),j=N.cstrToJs(j));const R=Object.create(null);R.fid=te,R.filename=j,R.sab=new SharedArrayBuffer(m.fileBufferSize),R.flags=Z;const k=K("xOpen",te,j,Z,le);return k||(R.readOnly&&N.poke(ae,E.SQLITE_OPEN_READONLY,"i32"),pe[te]=R,R.sabView=m.sabFileBufView,R.sq3File=new $(te),R.sq3File.$pMethods=_.pointer,R.lockType=E.SQLITE_LOCK_NONE),qe(),k}};p&&(S.$xRandomness=p.$xRandomness,S.$xSleep=p.$xSleep),S.$xRandomness||(Ce.xRandomness=function(F,z,j){const te=N.heap8u();let Z=0;for(;Z<z;++Z)te[j+Z]=Math.random()*255e3&255;return Z}),S.$xSleep||(Ce.xSleep=function(F,z){return Atomics.wait(m.sabOPView,m.opIds.xSleep,0,z),0}),M.getResolvedPath=function(F,z){const j=new URL(F,"file://irrelevant").pathname;return z?j.split("/").filter(te=>!!te):j},M.getDirForFilename=async function(z,j=!1){const te=M.getResolvedPath(z,!0),Z=te.pop();let ae=M.rootDirectory;for(const le of te)le&&(ae=await ae.getDirectoryHandle(le,{create:!!j}));return[ae,Z]},M.mkdir=async function(F){try{return await M.getDirForFilename(F+"/filepart",!0),!0}catch{return!1}},M.entryExists=async function(F){try{const[z,j]=await M.getDirForFilename(F);return await z.getFileHandle(j),!0}catch{return!1}},M.randomFilename=ce,M.registerVfs=(F=!1)=>N.exports.sqlite3_vfs_register(S.pointer,F?1:0),M.treeList=async function(){const F=async function j(te,Z){Z.name=te.name,Z.dirs=[],Z.files=[];for await(const ae of te.values())if(ae.kind==="directory"){const le=Object.create(null);Z.dirs.push(le),await j(ae,le)}else Z.files.push(ae.name)},z=Object.create(null);return await F(M.rootDirectory,z),z},M.rmfr=async function(){const F=M.rootDirectory,z={recurse:!0};for await(const j of F.values())F.removeEntry(j.name,z)},M.unlink=async function(F,z=!1,j=!1){try{const[te,Z]=await M.getDirForFilename(F,!1);return await te.removeEntry(Z,{recursive:z}),!0}catch(te){if(j)throw new Error("unlink(",arguments[0],") failed: "+te.message,{cause:te});return!1}},M.traverse=async function(F){const z={recursive:!0,directory:M.rootDirectory};typeof F=="function"&&(F={callback:F}),F=Object.assign(z,F||{}),async function te(Z,ae){for await(const le of Z.values()){if(F.callback(le,Z,ae)===!1)return!1;if(F.recursive&&le.kind==="directory"&&await te(le,ae+1)===!1)break}}(F.directory,0)};const tt=async function(F,z){const[j,te]=await M.getDirForFilename(F,!0);let ae=await(await j.getFileHandle(te,{create:!0})).createSyncAccessHandle(),le=0,R,k=!1;try{for(ae.truncate(0);(R=await z())!==void 0;)R instanceof ArrayBuffer&&(R=new Uint8Array(R)),le===0&&R.byteLength>=15&&(O.affirmDbHeader(R),k=!0),ae.write(R,{at:le}),le+=R.byteLength;if((le<512||le%512!==0)&&g("Input size",le,"is not correct for an SQLite database."),!k){const b=new Uint8Array(20);ae.read(b,{at:0}),O.affirmDbHeader(b)}return ae.write(new Uint8Array([1,1]),{at:18}),le}catch(b){throw await ae.close(),ae=void 0,await j.removeEntry(te).catch(()=>{}),b}finally{ae&&await ae.close()}};if(M.importDb=async function(F,z){if(z instanceof Function)return tt(F,z);z instanceof ArrayBuffer&&(z=new Uint8Array(z)),O.affirmIsDb(z);const j=z.byteLength,[te,Z]=await M.getDirForFilename(F,!0);let ae,le=0;try{return ae=await(await te.getFileHandle(Z,{create:!0})).createSyncAccessHandle(),ae.truncate(0),le=ae.write(z,{at:0}),le!=j&&g("Expected to write "+j+" bytes but wrote "+le+"."),ae.write(new Uint8Array([1,1]),{at:18}),le}catch(R){throw ae&&(await ae.close(),ae=void 0),await te.removeEntry(Z).catch(()=>{}),R}finally{ae&&await ae.close()}},i.oo1){const F=function(...z){const j=i.oo1.DB.dbCtorHelper.normalizeArgs(...z);j.vfs=S.$zName,i.oo1.DB.dbCtorHelper.call(this,j)};F.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=F,F.importDb=M.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenSql(S.pointer,function(z,j){j.capi.sqlite3_busy_timeout(z,1e4),j.capi.sqlite3_exec(z,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}const ht=function(){const F=N.scopedAllocPush(),z=new $;try{const j=z.pointer,te=E.SQLITE_OPEN_CREATE|E.SQLITE_OPEN_READWRITE|E.SQLITE_OPEN_MAIN_DB,Z=N.scopedAlloc(8),ae="/sanity/check/file"+ce(8),le=N.scopedAllocCString(ae);let R;if(m.s11n.serialize("This is ä string."),R=m.s11n.deserialize(),se("deserialize() says:",R),R[0]!=="This is ä string."&&g("String d13n error."),Ce.xAccess(S.pointer,le,0,Z),R=N.peek(Z,"i32"),se("xAccess(",ae,") exists ?=",R),R=Ce.xOpen(S.pointer,le,j,te,Z),se("open rc =",R,"state.sabOPView[xOpen] =",m.sabOPView[m.opIds.xOpen]),R!==0){y("open failed with code",R);return}Ce.xAccess(S.pointer,le,0,Z),R=N.peek(Z,"i32"),R||g("xAccess() failed to detect file."),R=Te.xSync(z.pointer,0),R&&g("sync failed w/ rc",R),R=Te.xTruncate(z.pointer,1024),R&&g("truncate failed w/ rc",R),N.poke(Z,0,"i64"),R=Te.xFileSize(z.pointer,Z),R&&g("xFileSize failed w/ rc",R),se("xFileSize says:",N.peek(Z,"i64")),R=Te.xWrite(z.pointer,le,10,1),R&&g("xWrite() failed!");const k=N.scopedAlloc(16);R=Te.xRead(z.pointer,k,6,2),N.poke(k+6,0);let b=N.cstrToJs(k);se("xRead() got:",b),b!=="sanity"&&g("Unexpected xRead() value."),Ce.xSleep&&(se("xSleep()ing before close()ing..."),Ce.xSleep(S.pointer,2e3),se("waking up from xSleep()")),R=Te.xClose(j),se("xClose rc =",R,"sabOPView =",m.sabOPView),se("Deleting file:",ae),Ce.xDelete(S.pointer,le,4660),Ce.xAccess(S.pointer,le,0,Z),R=N.peek(Z,"i32"),R&&g("Expecting 0 from xAccess(",ae,") after xDelete()."),P("End of OPFS sanity checks.")}finally{z.dispose(),N.scopedAllocPop(F)}};x.onmessage=function({data:F}){switch(F.type){case"opfs-unavailable":H(new Error(F.payload.join(" ")));break;case"opfs-async-loaded":x.postMessage({type:"opfs-async-init",args:m});break;case"opfs-async-inited":{if(T===!0)break;try{i.vfs.installVfs({io:{struct:_,methods:Te},vfs:{struct:S,methods:Ce}}),m.sabOPView=new Int32Array(m.sabOP),m.sabFileBufView=new Uint8Array(m.sabIO,0,m.fileBufferSize),m.sabS11nView=new Uint8Array(m.sabIO,m.sabS11nOffset,m.sabS11nSize),oe(),c.sanityChecks&&(P("Running sanity checks because of opfs-sanity-check URL arg..."),ht()),fe()?navigator.storage.getDirectory().then(z=>{x.onerror=x._originalOnError,delete x._originalOnError,i.opfs=M,M.rootDirectory=z,se("End of OPFS sqlite3_vfs setup.",S),w()}).catch(H):w()}catch(z){y(z),H(z)}break}default:{const z="Unexpected message from the OPFS async worker: "+JSON.stringify(F);y(z),H(new Error(z));break}}}}))};l.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async a=>{try{let c=l.defaultProxyUri;return a.scriptInfo.sqlite3Dir&&(l.defaultProxyUri=a.scriptInfo.sqlite3Dir+c),l().catch(d=>{a.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",d.message)})}catch(c){return a.config.error("installOpfsVfs() exception:",c),Promise.reject(c)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){var he,ue,qe,Te,Ce,tt,ht,F,z,j,te,Z,ts,le;const l=i.util.toss,a=i.util.toss3,c=Object.create(null),d=i.capi,q=i.util,I=i.wasm,L=4096,J=512,ee=4,se=8,P=J+ee,y=J,g=P,E=L,O=d.SQLITE_OPEN_MAIN_DB|d.SQLITE_OPEN_MAIN_JOURNAL|d.SQLITE_OPEN_SUPER_JOURNAL|d.SQLITE_OPEN_WAL,N=".opaque",U=()=>Math.random().toString(36).slice(2),$=new TextDecoder,G=new TextEncoder,M=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),fe=[i.config.error,i.config.warn,i.config.log];i.config.log;const _=i.config.warn;i.config.error;const S=new Map,T=R=>S.get(R),H=(R,k)=>{k?S.set(R,k):S.delete(R)},w=new Map,x=R=>w.get(R),f=(R,k)=>{k?w.set(R,k):w.delete(R)},p={xCheckReservedLock:function(R,k){const b=x(R);return b.log("xCheckReservedLock"),b.storeErr(),I.poke32(k,1),0},xClose:function(R){const k=x(R);k.storeErr();const b=k.getOFileForS3File(R);if(b)try{k.log(`xClose ${b.path}`),k.mapS3FileToOFile(R,!1),b.sah.flush(),b.flags&d.SQLITE_OPEN_DELETEONCLOSE&&k.deletePath(b.path)}catch(C){return k.storeErr(C,d.SQLITE_IOERR)}return 0},xDeviceCharacteristics:function(R){return d.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(R,k,b){return d.SQLITE_NOTFOUND},xFileSize:function(R,k){const b=x(R);b.log("xFileSize");const W=b.getOFileForS3File(R).sah.getSize()-E;return I.poke64(k,BigInt(W)),0},xLock:function(R,k){const b=x(R);b.log(`xLock ${k}`),b.storeErr();const C=b.getOFileForS3File(R);return C.lockType=k,0},xRead:function(R,k,b,C){const W=x(R);W.storeErr();const B=W.getOFileForS3File(R);W.log(`xRead ${B.path} ${b} @ ${C}`);try{const ne=B.sah.read(I.heap8u().subarray(k,k+b),{at:E+Number(C)});return ne<b?(I.heap8u().fill(0,k+ne,k+b),d.SQLITE_IOERR_SHORT_READ):0}catch(ne){return W.storeErr(ne,d.SQLITE_IOERR)}},xSectorSize:function(R){return L},xSync:function(R,k){const b=x(R);b.log(`xSync ${k}`),b.storeErr();const C=b.getOFileForS3File(R);try{return C.sah.flush(),0}catch(W){return b.storeErr(W,d.SQLITE_IOERR)}},xTruncate:function(R,k){const b=x(R);b.log(`xTruncate ${k}`),b.storeErr();const C=b.getOFileForS3File(R);try{return C.sah.truncate(E+Number(k)),0}catch(W){return b.storeErr(W,d.SQLITE_IOERR)}},xUnlock:function(R,k){const b=x(R);b.log("xUnlock");const C=b.getOFileForS3File(R);return C.lockType=k,0},xWrite:function(R,k,b,C){const W=x(R);W.storeErr();const B=W.getOFileForS3File(R);W.log(`xWrite ${B.path} ${b} ${C}`);try{const ne=B.sah.write(I.heap8u().subarray(k,k+b),{at:E+Number(C)});return b===ne?0:l("Unknown write() failure.")}catch(ne){return W.storeErr(ne,d.SQLITE_IOERR)}}},m=new d.sqlite3_io_methods;m.$iVersion=1,i.vfs.installVfs({io:{struct:m,methods:p}});const D={xAccess:function(R,k,b,C){const W=T(R);W.storeErr();try{const B=W.getPath(k);I.poke32(C,W.hasFilename(B)?1:0)}catch{I.poke32(C,0)}return 0},xCurrentTime:function(R,k){return I.poke(k,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(R,k){return I.poke(k,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(R,k,b){const C=T(R);C.log(`xDelete ${I.cstrToJs(k)}`),C.storeErr();try{return C.deletePath(C.getPath(k)),0}catch(W){return C.storeErr(W),d.SQLITE_IOERR_DELETE}},xFullPathname:function(R,k,b,C){return I.cstrncpy(C,k,b)<b?0:d.SQLITE_CANTOPEN},xGetLastError:function(R,k,b){const C=T(R),W=C.popErr();if(C.log(`xGetLastError ${k} e =`,W),W){const B=I.scopedAllocPush();try{const[ne,de]=I.scopedAllocCString(W.message,!0);I.cstrncpy(b,ne,k),de>k&&I.poke8(b+k-1,0)}catch{return d.SQLITE_NOMEM}finally{I.scopedAllocPop(B)}}return W?W.sqlite3Rc||d.SQLITE_IOERR:0},xOpen:function(k,b,C,W,B){const ne=T(k);try{ne.log(`xOpen ${I.cstrToJs(b)} ${W}`);const de=b&&I.peek8(b)?ne.getPath(b):U();let ge=ne.getSAHForPath(de);!ge&&W&d.SQLITE_OPEN_CREATE&&(ne.getFileCount()<ne.getCapacity()?(ge=ne.nextAvailableSAH(),ne.setAssociatedPath(ge,de,W)):l("SAH pool is full. Cannot create file",de)),ge||l("file not found:",de);const Me={path:de,flags:W,sah:ge};ne.mapS3FileToOFile(C,Me),Me.lockType=d.SQLITE_LOCK_NONE;const un=new d.sqlite3_file(C);return un.$pMethods=m.pointer,un.dispose(),I.poke32(B,W),0}catch(de){return ne.storeErr(de),d.SQLITE_CANTOPEN}}},K=function(R){i.capi.sqlite3_vfs_find(R)&&a("VFS name is already registered:",R);const k=new d.sqlite3_vfs,b=d.sqlite3_vfs_find(null),C=b?new d.sqlite3_vfs(b):null;return k.$iVersion=2,k.$szOsFile=d.sqlite3_file.structInfo.sizeof,k.$mxPathname=J,k.addOnDispose(k.$zName=I.allocCString(R),()=>H(k.pointer,0)),C&&(k.$xRandomness=C.$xRandomness,k.$xSleep=C.$xSleep,C.dispose()),!k.$xRandomness&&!D.xRandomness&&(D.xRandomness=function(W,B,ne){const de=I.heap8u();let ge=0;for(;ge<B;++ge)de[ne+ge]=Math.random()*255e3&255;return ge}),!k.$xSleep&&!D.xSleep&&(D.xSleep=(W,B)=>0),i.vfs.installVfs({vfs:{struct:k,methods:D}}),k};class oe{constructor(k=Object.create(null)){Q(this,Z);Qe(this,"vfsDir");Q(this,he,void 0);Q(this,ue,void 0);Q(this,qe,void 0);Q(this,Te,new Map);Q(this,Ce,new Map);Q(this,tt,new Set);Q(this,ht,new Map);Q(this,F,new Uint8Array(P));Q(this,z,void 0);Q(this,j,void 0);Q(this,te,void 0);X(this,te,k.verbosity??M.verbosity),this.vfsName=k.name||M.name,X(this,j,K(this.vfsName)),H(s(this,j).pointer,this),this.vfsDir=k.directory||"."+this.vfsName,X(this,z,new DataView(s(this,F).buffer,s(this,F).byteOffset)),this.isReady=this.reset(!!(k.clearOnInit??M.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(k.initialCapacity||M.initialCapacity)})}log(...k){Pe(this,Z,ts).call(this,2,...k)}warn(...k){Pe(this,Z,ts).call(this,1,...k)}error(...k){Pe(this,Z,ts).call(this,0,...k)}getVfs(){return s(this,j)}getCapacity(){return s(this,Te).size}getFileCount(){return s(this,Ce).size}getFileNames(){const k=[],b=s(this,Ce).keys();for(const C of b)k.push(C);return k}async addCapacity(k){for(let b=0;b<k;++b){const C=U(),B=await(await s(this,ue).getFileHandle(C,{create:!0})).createSyncAccessHandle();s(this,Te).set(B,C),this.setAssociatedPath(B,"",0)}return this.getCapacity()}async reduceCapacity(k){let b=0;for(const C of Array.from(s(this,tt))){if(b===k||this.getFileCount()===this.getCapacity())break;const W=s(this,Te).get(C);C.close(),await s(this,ue).removeEntry(W),s(this,Te).delete(C),s(this,tt).delete(C),++b}return b}releaseAccessHandles(){for(const k of s(this,Te).keys())k.close();s(this,Te).clear(),s(this,Ce).clear(),s(this,tt).clear()}async acquireAccessHandles(k){const b=[];for await(const[C,W]of s(this,ue))W.kind==="file"&&b.push([C,W]);return Promise.all(b.map(async([C,W])=>{try{const B=await W.createSyncAccessHandle();if(s(this,Te).set(B,C),k)B.truncate(E),this.setAssociatedPath(B,"",0);else{const ne=this.getAssociatedPath(B);ne?s(this,Ce).set(ne,B):s(this,tt).add(B)}}catch(B){throw this.storeErr(B),this.releaseAccessHandles(),B}}))}getAssociatedPath(k){k.read(s(this,F),{at:0});const b=s(this,z).getUint32(y);if(s(this,F)[0]&&(b&d.SQLITE_OPEN_DELETEONCLOSE||!(b&O)))return _(`Removing file with unexpected flags ${b.toString(16)}`,s(this,F)),this.setAssociatedPath(k,"",0),"";const C=new Uint32Array(se/4);k.read(C,{at:g});const W=this.computeDigest(s(this,F));if(C.every((B,ne)=>B===W[ne])){const B=s(this,F).findIndex(ne=>ne===0);return B===0&&k.truncate(E),B?$.decode(s(this,F).subarray(0,B)):""}else return _("Disassociating file with bad digest."),this.setAssociatedPath(k,"",0),""}setAssociatedPath(k,b,C){const W=G.encodeInto(b,s(this,F));J<=W.written+1&&l("Path too long:",b),s(this,F).fill(0,W.written,J),s(this,z).setUint32(y,C);const B=this.computeDigest(s(this,F));k.write(s(this,F),{at:0}),k.write(B,{at:g}),k.flush(),b?(s(this,Ce).set(b,k),s(this,tt).delete(k)):(k.truncate(E),s(this,tt).add(k))}computeDigest(k){let b=3735928559,C=1103547991;for(const W of k)b=31*b+W*307,C=31*C+W*307;return new Uint32Array([b>>>0,C>>>0])}async reset(k){await this.isReady;let b=await navigator.storage.getDirectory(),C;for(const W of this.vfsDir.split("/"))W&&(C=b,b=await b.getDirectoryHandle(W,{create:!0}));return X(this,he,b),X(this,qe,C),X(this,ue,await s(this,he).getDirectoryHandle(N,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(k)}getPath(k){return I.isPtr(k)&&(k=I.cstrToJs(k)),(k instanceof URL?k:new URL(k,"file://localhost/")).pathname}deletePath(k){const b=s(this,Ce).get(k);return b&&(s(this,Ce).delete(k),this.setAssociatedPath(b,"",0)),!!b}storeErr(k,b){return k&&(k.sqlite3Rc=b||d.SQLITE_IOERR,this.error(k)),this.$error=k,b}popErr(){const k=this.$error;return this.$error=void 0,k}nextAvailableSAH(){const[k]=s(this,tt).keys();return k}getOFileForS3File(k){return s(this,ht).get(k)}mapS3FileToOFile(k,b){b?(s(this,ht).set(k,b),f(k,this)):(s(this,ht).delete(k),f(k,!1))}hasFilename(k){return s(this,Ce).has(k)}getSAHForPath(k){return s(this,Ce).get(k)}async removeVfs(){if(!s(this,j).pointer||!s(this,ue))return!1;d.sqlite3_vfs_unregister(s(this,j).pointer),s(this,j).dispose();try{this.releaseAccessHandles(),await s(this,he).removeEntry(N,{recursive:!0}),X(this,ue,void 0),await s(this,qe).removeEntry(s(this,he).name,{recursive:!0}),X(this,he,X(this,qe,void 0))}catch(k){i.config.error(this.vfsName,"removeVfs() failed:",k)}return!0}exportFile(k){const b=s(this,Ce).get(k)||l("File not found:",k),C=b.getSize()-E,W=new Uint8Array(C>0?C:0);if(C>0){const B=b.read(W,{at:E});B!=C&&l("Expected to read "+C+" bytes but read "+B+".")}return W}async importDbChunked(k,b){const C=s(this,Ce).get(k)||this.nextAvailableSAH()||l("No available handles to import to.");C.truncate(0);let W=0,B,ne=!1;try{for(;(B=await b())!==void 0;)B instanceof ArrayBuffer&&(B=new Uint8Array(B)),W===0&&B.byteLength>=15&&(q.affirmDbHeader(B),ne=!0),C.write(B,{at:E+W}),W+=B.byteLength;if((W<512||W%512!==0)&&l("Input size",W,"is not correct for an SQLite database."),!ne){const de=new Uint8Array(20);C.read(de,{at:0}),q.affirmDbHeader(de)}C.write(new Uint8Array([1,1]),{at:E+18})}catch(de){throw this.setAssociatedPath(C,"",0),de}return this.setAssociatedPath(C,k,d.SQLITE_OPEN_MAIN_DB),W}importDb(k,b){if(b instanceof ArrayBuffer)b=new Uint8Array(b);else if(b instanceof Function)return this.importDbChunked(k,b);const C=s(this,Ce).get(k)||this.nextAvailableSAH()||l("No available handles to import to."),W=b.byteLength;(W<512||W%512!=0)&&l("Byte array size is invalid for an SQLite db.");const B="SQLite format 3";for(let de=0;de<B.length;++de)B.charCodeAt(de)!==b[de]&&l("Input does not contain an SQLite database header.");const ne=C.write(b,{at:E});return ne!=W?(this.setAssociatedPath(C,"",0),l("Expected to write "+W+" bytes but wrote "+ne+".")):(C.write(new Uint8Array([1,1]),{at:E+18}),this.setAssociatedPath(C,k,d.SQLITE_OPEN_MAIN_DB)),ne}}he=new WeakMap,ue=new WeakMap,qe=new WeakMap,Te=new WeakMap,Ce=new WeakMap,tt=new WeakMap,ht=new WeakMap,F=new WeakMap,z=new WeakMap,j=new WeakMap,te=new WeakMap,Z=new WeakSet,ts=function(k,...b){s(this,te)>k&&fe[k](this.vfsName+":",...b)};class ce{constructor(k){Q(this,le,void 0);X(this,le,k),this.vfsName=k.vfsName}async addCapacity(k){return s(this,le).addCapacity(k)}async reduceCapacity(k){return s(this,le).reduceCapacity(k)}getCapacity(){return s(this,le).getCapacity(s(this,le))}getFileCount(){return s(this,le).getFileCount()}getFileNames(){return s(this,le).getFileNames()}async reserveMinimumCapacity(k){const b=s(this,le).getCapacity();return b<k?s(this,le).addCapacity(k-b):b}exportFile(k){return s(this,le).exportFile(k)}importDb(k,b){return s(this,le).importDb(k,b)}async wipeFiles(){return s(this,le).reset(!0)}unlink(k){return s(this,le).deletePath(k)}async removeVfs(){return s(this,le).removeVfs()}}le=new WeakMap;const pe=async()=>{const R=await navigator.storage.getDirectory(),k=".opfs-sahpool-sync-check-"+U(),W=(await(await R.getFileHandle(k,{create:!0})).createSyncAccessHandle()).close();return await W,await R.removeEntry(k),W?.then&&l("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(R=Object.create(null)){const k=R.name||M.name;return c[k]?c[k]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!navigator?.storage?.getDirectory?c[k]=Promise.reject(new Error("Missing required OPFS APIs.")):c[k]=pe().then(async function(){if(R.$testThrowInInit)throw R.$testThrowInInit;const b=new oe(R);return b.isReady.then(async()=>{const C=new ce(b);if(i.oo1){const W=i.oo1,B=b.getVfs(),ne=function(...de){const ge=W.DB.dbCtorHelper.normalizeArgs(...de);ge.vfs=B.$zName,W.DB.dbCtorHelper.call(this,ge)};ne.prototype=Object.create(W.DB.prototype),C.OpfsSAHPoolDb=ne,W.DB.dbCtorHelper.setVfsPostOpenSql(B.pointer,function(de,ge){ge.capi.sqlite3_exec(de,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return b.log("VFS initialized."),C}).catch(async C=>(await b.removeVfs().catch(()=>{}),C))}).catch(b=>c[k]=Promise.reject(b))}}),typeof o<"u"){const i=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?o.asm:wasmExports,memory:o.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=i;let l;try{l=globalThis.sqlite3ApiBootstrap()}catch(a){throw console.error("sqlite3ApiBootstrap() error:",a),a}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}o.sqlite3=l}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),r.ready}})();const Vd=function(){const t=Zo;if(!t)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:globalThis?.document?.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:globalThis?.location?.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...r)=>console.warn("sqlite3.debugModule:",...r):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const r=e.moduleScript.src.split("/");r.pop(),e.sqlite3Dir=r.join("/")+"/"}if(globalThis.sqlite3InitModule=function r(...n){return t(...n).then(A=>{const V=A.sqlite3;V.scriptInfo=e,r.__isUnderTest&&(V.__isUnderTest=!0);const re=V.asyncPostInit;return delete V.asyncPostInit,re()}).catch(A=>{throw console.error("Exception loading sqlite3 module:",A),A})},globalThis.sqlite3InitModule.ready=t.ready,globalThis.sqlite3InitModuleState.moduleScript){const r=globalThis.sqlite3InitModuleState;let n=r.moduleScript.src.split("/");n.pop(),r.scriptDir=n.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();Zo=Vd;var Hd=Zo;globalThis.sqlite3Worker1Promiser=function t(e=t.defaultConfig){if(arguments.length===1&&typeof arguments[0]=="function"){const ie=e;e=Object.assign(Object.create(null),t.defaultConfig),e.onready=ie}else e=Object.assign(Object.create(null),t.defaultConfig,e);const r=Object.create(null),n=function(){},A=e.onerror||n,V=e.debug||n,re=e.generateMessageId?void 0:Object.create(null),Se=e.generateMessageId||function(ie){return ie.type+"#"+(re[ie.type]=(re[ie.type]||0)+1)},Le=(...ie)=>{throw new Error(ie.join(" "))};e.worker||(e.worker=t.defaultConfig.worker),typeof e.worker=="function"&&(e.worker=e.worker());let He;return e.worker.onmessage=function(ie){ie=ie.data,V("worker1.onmessage",ie);let Ee=r[ie.messageId];if(!Ee){if(ie&&ie.type==="sqlite3-api"&&ie.result==="worker1-ready"){e.onready&&e.onready();return}if(Ee=r[ie.type],Ee&&Ee.onrow){Ee.onrow(ie);return}e.onunhandled?e.onunhandled(arguments[0]):A("sqlite3Worker1Promiser() unhandled worker message:",ie);return}switch(delete r[ie.messageId],ie.type){case"error":Ee.reject(ie);return;case"open":He||(He=ie.dbId);break;case"close":ie.dbId===He&&(He=void 0);break}try{Ee.resolve(ie)}catch(Ne){Ee.reject(Ne)}},function(){let ie;arguments.length===1?ie=arguments[0]:arguments.length===2?(ie=Object.create(null),ie.type=arguments[0],ie.args=arguments[1],ie.dbId=ie.args.dbId):Le("Invalid arugments for sqlite3Worker1Promiser()-created factory."),!ie.dbId&&ie.type!=="open"&&(ie.dbId=He),ie.messageId=Se(ie),ie.departureTime=performance.now();const Ee=Object.create(null);Ee.message=ie;let Ne;ie.type==="exec"&&ie.args&&(typeof ie.args.callback=="function"?(Ne=ie.messageId+":row",Ee.onrow=ie.args.callback,ie.args.callback=Ne,r[Ne]=Ee):typeof ie.args.callback=="string"&&Le("exec callback may not be a string when using the Promise interface."));let Ot=new Promise(function(Zt,Mt){Ee.resolve=Zt,Ee.reject=Mt,r[ie.messageId]=Ee,V("Posting",ie.type,"message to Worker dbId="+(He||"default")+":",ie),e.worker.postMessage(ie)});return Ne&&(Ot=Ot.finally(()=>delete r[Ne])),Ot}};globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL(""+new URL("sqlite3-worker1-bundler-friendly-Xlp_Kpi_.js",import.meta.url).href,import.meta.url),{type:"module"})},onerror:(...t)=>console.error("worker1 promiser error",...t)};var $d=class extends Vo{constructor(e){super();Qe(this,"serializer");this.serializer=e}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:n,...A}=r,V=this.serializer(n);return n===V?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...A,value:V}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Hl=t=>{if($l(t)||typeof t=="string")return t;if(typeof t=="boolean")return`${t}`;if(t instanceof Date)return t.toISOString();try{return JSON.stringify(t)}catch{return t}},Jd=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/,Gd=t=>{if($l(t))return t;if(typeof t=="string"){if(t==="true")return!0;if(t==="false")return!1;if(Jd.test(t))return new Date(t);if(t.startsWith("{")&&t.endsWith("}")||t.startsWith("[")&&t.endsWith("]"))try{return JSON.parse(t)}catch{}return t}};function $l(t){return t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t}var Kd=class{constructor(t={}){Qe(this,"transformer");Qe(this,"deserializer");Qe(this,"skipNodeSet");Qe(this,"ctx");const{deserializer:e=Gd,serializer:r=Hl,skipNodeKind:n=[]}=t;this.transformer=new $d(r),this.deserializer=e,n.length&&(this.skipNodeSet=new Set(n),this.ctx=new WeakSet)}transformQuery({node:t,queryId:e}){return this.skipNodeSet?.has(t.kind)?(this.ctx?.add(e),t):this.transformer.transformNode(t)}async transformResult({result:t,queryId:e}){return this.ctx?.has(e)?t:{...t,rows:t.rows.map(r=>Object.fromEntries(Object.entries(r).map(([n,A])=>[n,this.deserializer(A)])))}}};function $a(t){const{logger:e,merge:r,logQueryNode:n}=t;return A=>{const{level:V,queryDurationMillis:re,query:{parameters:Se,sql:Le,query:He}}=A,ie=V==="error"?A.error:void 0;let Ee=Le.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&Se.forEach(Ot=>{Ee=Ee.replace("?",JSON.stringify(Ot))});const Ne={sql:Ee,params:Se,duration:re,error:ie};n&&(Ne.queryNode=He),e(Ne)}}async function Xd(t){const{rows:e}=await t.executeQuery(fr.raw("PRAGMA integrity_check"));if(!e.length)throw new Error("fail to check integrity");return e[0].integrity_check==="ok"}async function Ja(t,e){if(e)return await t.executeQuery(fr.raw(`PRAGMA user_version = ${e}`)),e;const{rows:r}=await t.executeQuery(fr.raw("PRAGMA user_version"));if(!r.length)throw new Error("fail to get DBVersion");return r[0].user_version}function Yd(t){return`__pre_${t}`}function Zd(t,e=r=>r){return{setParam:r=>{let n;return(A,V)=>{if(!n){const{parameters:re,sql:Se,query:Le}=r({qb:t,param:Yd}).compile();n={sql:Se,query:V?.(Le)||{kind:Le.kind},parameters:re}}return{...n,parameters:n.parameters.map(re=>typeof re=="string"&&re.startsWith("__pre_")?e(A[re.slice(6)]):re)}}}}}async function ef(t,e){const r=e||`sp_${Date.now()%1e8}`;return await ct`savepoint ${ct.raw(r)}`.execute(t),{release:async()=>{await ct`release savepoint ${ct.raw(r)}`.execute(t)},rollback:async()=>{await ct`rollback to savepoint ${ct.raw(r)}`.execute(t)}}}async function tf(t,e,r){const{release:n,rollback:A}=await ef(t,r);try{const V=await e(t);return await n(),V}catch(V){throw await A(),V}}var nf=class extends Error{constructor(){super("db file maybe broken")}};function rf(t){return t.toOperationNode().kind==="SelectQueryNode"}var sf=class{constructor(t){Qe(this,"kysely");Qe(this,"trxCount",0);Qe(this,"trx");Qe(this,"logger");Qe(this,"serializer",Hl);const{dialect:e,logger:r,onQuery:n,plugins:A=[],serializerPluginOptions:V}=t;this.logger=r,V?.serializer&&(this.serializer=V.serializer),A.push(new Kd(V));let re;n===!0?re=$a({logger:this.logger?.debug||console.log,merge:!0}):n&&(re=$a(n)),this.kysely=new vi({dialect:e,log:re,plugins:A})}async updateTableSchema(t,e){try{if(e&&!await Xd(this.kysely))return this.logger?.error("integrity check fail"),{ready:!1,error:new nf};const r=await t(this.kysely,this.logger);return this.logger?.info("table updated"),r}catch(r){return this.logError(r,"sync table fail"),{ready:!1,error:r}}}getDB(){return this.trx||this.kysely}logError(t,e){e&&this.logger?.error(e,t instanceof Error?t:void 0)}async transaction(t,e={}){return this.trx?(this.trxCount++,this.logger?.debug(`run in savepoint: sp_${this.trxCount}`),await tf(this.trx,t,`sp_${this.trxCount}`).then(async r=>(await e.onCommit?.(r),r)).catch(async r=>{await e.onRollback?.(r),this.logError(r,e.errorMsg)}).finally(()=>this.trxCount--)):await this.kysely.transaction().execute(async r=>(this.trx=r,this.logger?.debug("run in transaction"),await t(r))).then(async r=>(await e.onCommit?.(r),r)).catch(async r=>{await e.onRollback?.(r),this.logError(r,e.errorMsg)}).finally(()=>this.trx=void 0)}async execute(t){return typeof t=="function"?await t(this.getDB()).execute():await this.getDB().executeQuery(t)}async executeTakeFirst(t){let e=t(this.getDB());return rf(e)&&(e=e.limit(1)),await e.executeTakeFirstOrThrow()}precompile(t){return this.logger?.debug?.("precompile"),Zd(t(this.kysely),this.serializer)}async raw(t,e){return typeof t=="string"?await this.getDB().executeQuery(fr.raw(t,e)):await t.execute(this.getDB())}async optimize(t){await this.raw(t?"vacuum":"pragma optimize")}async destroy(){this.logger?.info("destroyed"),await this.kysely.destroy(),this.trx=void 0}},Jl="__TIME_TRIGGER__";function of(t,e){const{create:r,update:n}=e?.timeTrigger||{},A={type:"date",defaultTo:Jl};return r===!0?t.createAt=A:r&&(t[r]=A),n===!0?t.updateAt={...A,notNull:0}:n&&(t[n]={...A,notNull:0}),{columns:t,...e}}function Gl(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function Wo(t){return Array.isArray(t)?t:[t]}function af(t){return typeof t=="function"}async function Gi(t,e){await t.schema.dropTable(e).execute()}async function Ga(t,e,r){const{index:n,...A}=r,V=await Do(t,e,A);await Xl(t,e,V),await Kl(t,e,n)}async function Kl(t,e,r){for(const n of r||[]){const A=Wo(n);await t.schema.createIndex(`idx_${e}_${A.join("_")}`).on(e).columns(A).ifNotExists().execute()}}async function Do(t,e,{columns:r,primary:n,timeTrigger:A,unique:V},re=!1){const Se=A?{triggerKey:"rowid",update:void 0}:void 0;let Le=!1,He=t.schema.createTable(e);re&&(He=He.temporary());for(const[ie,Ee]of Object.entries(r)){let Ne="text";const{type:Ot,notNull:Zt,defaultTo:Mt}=Ee,En=Gl(Ot);Ne=En.dataType,He=He.addColumn(ie,Ne,It=>En.isIncrements?(Le=!0,Se&&(Se.triggerKey=ie),It.autoIncrement().primaryKey()):Mt===Jl?(Se&&Zt===0&&(Se.update=ie),It.defaultTo(ct`CURRENT_TIMESTAMP`)):(Zt===!0&&(It=It.notNull()),Mt!==void 0&&(It=It.defaultTo(af(Mt)?Mt(ct):Mt)),It))}if(!Le&&n){const ie=Wo(n);He=He.addPrimaryKeyConstraint(`pk#${ie.join("#")}`,ie)}for(const ie of V||[]){const Ee=Wo(ie);He=He.addUniqueConstraint(`un#${Ee.join("#")}`,Ee)}return await He.ifNotExists().execute(),Se}async function Xl(t,e,r){if(!r||!r.update)return;const{triggerKey:n,update:A}=r,V=`tgr_${e}_${A}`;await ct`create trigger if not exists ${ct.ref(V)}
after update
on ${ct.table(e)}
begin
  update ${ct.table(e)}
  set ${ct.ref(A)} = CURRENT_TIMESTAMP
  where ${ct.ref(n)} = NEW.${ct.ref(n)};
end`.execute(t)}function lf(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/gi,[,n,A]=t.replace(/\r?\n/g,"").match(e),V={columns:{},name:n,primary:void 0,unique:[]},re=A.matchAll(r);for(const Se of re){const[,Le,He,ie]=Se;if(Le.startsWith("pk#")){const[,...Ee]=Le.split("#");V.primary=Ee}else if(Le.startsWith("un#")){const[,...Ee]=Le.split("#");V.unique.push(Ee)}else V.columns[Le]={type:He,notNull:!!ie}}return V}async function cf(t,e=[]){const r=await t.selectFrom("sqlite_master").where("type","in",["table","trigger","index"]).where("name","!=",jl).where("name","!=",zl).where("name","not like","sqlite_%").$if(!!e.length,A=>A.where(V=>V.and(e.map(re=>V("name","not like",`${re}%`))))).select(["name","sql","type"]).$castTo().execute(),n={existTables:{},indexList:[],triggerList:[]};for(const{name:A,sql:V,type:re}of r)V&&(re==="table"?n.existTables[A]=lf(V):re==="index"?n.indexList.push(A):n.triggerList.push(A));return n}async function uf(t,e,r={},n){const{reserveOldData:A,truncateIfExists:V=[],log:re,version:{current:Se,skipSyncWhenSame:Le}={},excludeTablePrefix:He,onSyncSuccess:ie,onSyncFail:Ee}=r;if(Se){if(Le&&Se===await Ja(t))return{ready:!0};await Ja(t,Se)}const Ne=Be=>re&&n?.debug(Be),{existTables:Ot,indexList:Zt,triggerList:Mt}=await cf(t,He);Ne("====== update tables start ======");const En=new Set(Array.isArray(V)?V:V?Object.keys(Ot):[]);return await t.transaction().execute(async Be=>{for(const We of Zt)await Be.schema.dropIndex(We).ifExists().execute();for(const We of Mt)await ct`drop trigger if exists ${ct.ref(We)}`.execute(Be);for(const[We,gt]of Object.entries(Ot))if(!(We in e))Ne(`remove table: ${We}`),await Gi(Be,We);else{Ne(`diff table: ${We}`);try{await It(Be,We,gt,e[We])}catch(ln){throw n?.error(`fail to sync ${We}`,ln),ln}}for(const[We,gt]of Object.entries(e))We in Ot||(Ne(`create table: ${We}`),await Ga(Be,We,gt))}).then(()=>(ie?.(t),Ne("======= update tables success ======="),{ready:!0})).catch(Be=>(Ee?.(Be),Ne("======= update tables fail ======="),{ready:!1,error:Be}));async function It(Be,We,gt,ln){if(En.has(We)){await Gi(Be,We),await Ga(Be,We,ln),Ne("clear and sync structure");return}const{index:oo,...Qi}=ln,Qt=df(gt.columns,ln.columns);if(Qt.length===Object.keys(gt.columns).length){Ne("same table structure, skip");return}Ne("different table structure, update");const pr=`_temp_${We}`;await Do(Be,pr,gt,!0),await Be.insertInto(pr).expression(_r=>_r.selectFrom(We).selectAll()).execute(),await Gi(Be,We);const mr=await Do(Be,We,Qi);Qt.length&&await Be.insertInto(We).columns(Qt).expression(_r=>_r.selectFrom(pr).select(Qt)).execute(),await Kl(Be,We,oo),await Xl(Be,We,mr),!A&&await Gi(Be,pr),Ne(`restore columns: ${Qt}`)}}function df(t,e){const r=[];for(const[n,A]of Object.entries(e))n in t&&Gl(A.type).dataType===t[n].type&&(A.notNull||!1)===(t[n].notNull||!1)&&r.push(n);return r}function ff(t,e={}){const{log:r}=e;return(n,A)=>uf(n,t,e,r?A:void 0)}const hf={test:of({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function pf(t){const e=new sf({dialect:t}),r=await e.updateTableSchema(ff(hf));if(!r.ready)throw r.error;console.log(await e.raw("PRAGMA table_info('test')"));for(let n=0;n<10;n++)await e.transaction(async()=>{await e.transaction(async()=>{if(n>8)throw console.log("test rollback"),new Error("test rollback");await e.execute(A=>A.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}))})});return e.execute(n=>n.selectFrom("test").selectAll()).then(async n=>(await e.destroy(),console.log(n),n))}const mf=new zd({database:async()=>{const t=(await Hd()).oo1;if(!t)return Promise.reject("fail to load sqlite");const e="/test.db";return t.OpfsDb?(console.log("support OPFS"),new t.OpfsDb(e)):(console.log("doesn't support OPFS"),new t.DB(e))}});onmessage=()=>{console.log("start official wasm test"),pf(mf).then(t=>{t?.forEach(e=>console.log("[official wasm]",e))})};
